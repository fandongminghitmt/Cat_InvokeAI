import{g as Xf,a as RD,b as NG,r as h,i as AL,c as eye,d as tye,e as Ay,f as nye,h as sye,j as iye,k as oye,l as aye,m as PL,u as FG,n as rye,o as Uk,w as lye,p as cye,t as dye,q as ae,s as ur,v as De,x as M,y as BG,z as zG,A as VG,B as uye,C as Ft,D as le,E as Ut,F as $G,G as pe,H as GG,I as hye,J as Xn,K as eo,L as HG,M as OD,N as WG,O as ND,P as zc,Q as Kd,R as ko,S as Py,T as UG,U as qG,V as FD,W as KG,X as ZG,Y as BD,Z as XG,_ as YG,$ as zD,a0 as QG,a1 as JG,a2 as $w,a3 as eH,a4 as tH,a5 as It,a6 as VD,a7 as at,a8 as ts,a9 as Ze,aa as ni,ab as mi,ac as cu,ad as $D,ae as a,af as ye,ag as Gw,ah as os,ai as nH,aj as sH,ak as iH,al as oH,am as F2,an as aH,ao as B2,ap as rH,aq as un,ar as rt,as as oo,at as Vc,au as lH,av as cH,aw as GD,ax as dH,ay as ve,az as wo,aA as uH,aB as z2,aC as ce,aD as HD,aE as pye,aF as Vr,aG as WD,aH as Hw,aI as Ww,aJ as yo,aK as ee,aL as Oi,aM as V2,aN as fye,aO as mye,aP as Zd,aQ as hn,aR as Tv,aS as If,aT as Yf,aU as Lh,aV as _s,aW as NA,aX as cn,aY as gye,aZ as vye,a_ as rh,a$ as yye,b0 as bye,b1 as xye,b2 as UD,b3 as qD,b4 as Uw,b5 as Cye,b6 as hH,b7 as KD,b8 as Qf,b9 as wye,ba as _ye,bb as ZD,bc as XD,bd as Sye,be as Jf,bf as YD,bg as pH,bh as kye,bi as Iye,bj as jye,bk as Q,bl as $n,bm as yl,bn as Xd,bo as em,bp as Rh,bq as Ty,br as Eye,bs as FA,bt as BA,bu as Yn,bv as bo,bw as Aye,bx as Pye,by as QD,bz as qc,bA as $l,bB as fH,bC as Tye,bD as ir,bE as TL,bF as od,bG as qw,bH as Ba,bI as fi,bJ as ba,bK as Dye,bL as jf,bM as Dv,bN as Ai,bO as Kw,bP as mH,bQ as gH,bR as Yd,bS as vH,bT as _o,bU as du,bV as JD,bW as Dl,bX as eM,bY as Mv,bZ as zA,b_ as $c,b$ as cg,c0 as Tp,c1 as D0,c2 as Zw,c3 as $r,c4 as _l,c5 as tM,c6 as Dy,c7 as Mye,c8 as VA,c9 as uu,ca as yH,cb as DL,cc as qk,cd as Kk,ce as Zk,cf as ML,cg as Xw,ch as tm,ci as q,cj as he,ck as Sr,cl as Lye,cm as qu,cn as Eb,co as nM,cp as Ri,cq as Gc,cr as Rye,cs as bH,ct as Uo,cu as Ui,cv as sM,cw as LL,cx as Oye,cy as A,cz as Je,cA as ao,cB as iM,cC as Oh,cD as Nye,cE as vt,cF as hu,cG as Nh,cH as oM,cI as aM,cJ as rM,cK as Gr,cL as n2,cM as xH,cN as Fye,cO as CH,cP as nm,cQ as sm,cR as Bye,cS as $A,cT as Lv,cU as wH,cV as fh,cW as zye,cX as go,cY as to,cZ as _H,c_ as Vye,c$ as $ye,d0 as st,d1 as Gye,d2 as Ku,d3 as Hye,d4 as Wye,d5 as Yw,d6 as Uye,d7 as qye,d8 as Kye,d9 as lM,da as SH,db as Zye,dc as ct,dd as Cn,de as $e,df as Ie,dg as Ds,dh as gi,di as Et,dj as ss,dk as My,dl as Rv,dm as cM,dn as Xye,dp as Yye,dq as kH,dr as Qye,ds as GA,dt as RL,du as IH,dv as dM,dw as jH,dx as EH,dy as AH,dz as uM,dA as Jye,dB as Ly,dC as e1e,dD as Gl,dE as t1e,dF as Qw,dG as Qd,dH as n1e,dI as Ko,dJ as Jw,dK as PH,dL as TH,dM as DH,dN as MH,dO as LH,dP as hM,dQ as s1e,dR as OL,dS as $2,dT as i1e,dU as o1e,dV as a1e,dW as r1e,dX as l1e,dY as NL,dZ as c1e,d_ as d1e,d$ as HA,e0 as WA,e1 as UA,e2 as RH,e3 as pM,e4 as OH,e5 as u1e,e6 as NH,e7 as h1e,e8 as FH,e9 as p1e,ea as BH,eb as zH,ec as VH,ed as $H,ee as GH,ef as HH,eg as qA,eh as WH,ei as f1e,ej as UH,ek as m1e,el as qH,em as g1e,en as KH,eo as ZH,ep as XH,eq as v1e,er as YH,es as y1e,et as QH,eu as b1e,ev as JH,ew as Ef,ex as x1e,ey as Nd,ez as C1e,eA as w1e,eB as Ry,eC as G2,eD as Io,eE as or,eF as Jd,eG as _1e,eH as S1e,eI as FL,eJ as fM,eK as te,eL as pt,eM as eW,eN as e_,eO as Zo,eP as ro,eQ as Xo,eR as lo,eS as Yr,eT as vi,eU as Qr,eV as mM,eW as tW,eX as ne,eY as Mi,eZ as At,e_ as zn,e$ as xc,f0 as Li,f1 as rn,f2 as k1e,f3 as nW,f4 as sW,f5 as mt,f6 as iW,f7 as ke,f8 as Pt,f9 as I1e,fa as oW,fb as yi,fc as Ni,fd as Ls,fe as aW,ff as bi,fg as rW,fh as Fi,fi as Nn,fj as j1e,fk as E1e,fl as it,fm as Pe,fn as A1e,fo as lW,fp as t_,fq as P1e,fr as T1e,fs as D1e,ft as M1e,fu as L1e,fv as R1e,fw as O1e,fx as N1e,fy as F1e,fz as B1e,fA as gM,fB as n_,fC as s_,fD as i_,fE as vM,fF as cW,fG as be,fH as Yi,fI as He,fJ as pu,fK as dW,fL as z1e,fM as An,fN as Pn,fO as Zt,fP as ec,fQ as V1e,fR as im,fS as Oy,fT as uW,fU as o_,fV as fu,fW as M0,fX as Ny,fY as hW,fZ as oe,f_ as mu,f$ as $1e,g0 as pW,g1 as us,g2 as G1e,g3 as fW,g4 as BL,g5 as tc,g6 as Nt,g7 as Hr,g8 as mW,g9 as gW,ga as H1e,gb as W1e,gc as U1e,gd as Bi,ge as vW,gf as q1e,gg as Ms,gh as _t,gi as K1e,gj as Z1e,gk as X1e,gl as lh,gm as no,gn as Y1e,go as Q1e,gp as J1e,gq as ebe,gr as yW,gs as tbe,gt as bW,gu as a_,gv as Jr,gw as jo,gx as nbe,gy as sbe,gz as zL,gA as ibe,gB as Zu,gC as obe,gD as abe,gE as rbe,gF as lbe,gG as cbe,gH as dbe,gI as ube,gJ as r_,gK as l_,gL as hbe,gM as pbe,gN as fbe,gO as mbe,gP as gbe,gQ as c_,gR as vbe,gS as ybe,gT as bbe,gU as xbe,gV as d_,gW as xW,gX as Cbe,gY as CW,gZ as wbe,g_ as wW,g$ as _be,h0 as Sbe,h1 as _W,h2 as kbe,h3 as Ibe,h4 as jbe,h5 as Ebe,h6 as Abe,h7 as Ys,h8 as Ya,h9 as Pbe,ha as hr,hb as Tbe,hc as u_,hd as h_,he as Dbe,hf as SW,hg as kW,hh as yM,hi as IW,hj as Mbe,hk as Lbe,hl as Rbe,hm as pf,hn as Obe,ho as Nbe,hp as Fbe,hq as Bbe,hr as bM,hs as jW,ht as zbe,hu as KA,hv as Vbe,hw as xa,hx as mh,hy as ZA,hz as s2,hA as EW,hB as AW,hC as PW,hD as i2,hE as $be,hF as co,hG as TW,hH as DW,hI as MW,hJ as Gbe,hK as LW,hL as RW,hM as OW,hN as Hbe,hO as NW,hP as Wbe,hQ as FW,hR as p_,hS as Ube,hT as VL,hU as qbe,hV as BW,hW as Kbe,hX as Zbe,hY as Xbe,hZ as Ybe,h_ as Qbe,h$ as Hc,i0 as Jbe,i1 as exe,i2 as txe,i3 as nxe,i4 as sxe,i5 as ixe,i6 as zW,i7 as VW,i8 as $W,i9 as GW,ia as oxe,ib as axe,ic as rxe,id as lp,ie as lxe,ig as cxe,ih as dxe,ii as $L,ij as uxe,ik as hxe,il as pxe,im as HW,io as fxe,ip as eu,iq as WW,ir as xM,is as UW,it as CM,iu as qW,iv as mxe,iw as gxe,ix as vxe,iy as yxe,iz as bxe,iA as xxe,iB as Fy,iC as om,iD as KW,iE as Cxe,iF as f_,iG as wxe,iH as _xe,iI as XA,iJ as Sxe,iK as kxe,iL as wM,iM as _M,iN as ZW,iO as GL,iP as SM,iQ as kM,iR as Ixe,iS as XW,iT as jxe,iU as Exe,iV as Axe,iW as YW,iX as IM,iY as Pxe,iZ as Txe,i_ as H2,i$ as am,j0 as QW,j1 as By,j2 as Dxe,j3 as Mxe,j4 as m_,j5 as Lxe,j6 as Rxe,j7 as Oxe,j8 as Nxe,j9 as Fxe,ja as Bxe,jb as zxe,jc as HL,jd as Vxe,je as $xe,jf as Xk,jg as Gxe,jh as Hxe,ji as jM,jj as rm,jk as JW,jl as eU,jm as Wxe,jn as Uxe,jo as qxe,jp as Kxe,jq as Zxe,jr as tU,js as EM,jt as Yk,ju as Xxe,jv as Yxe,jw as Qxe,jx as AM,jy as zy,jz as Jxe,jA as Vy,jB as $y,jC as Qs,jD as Gy,jE as Js,jF as W2,jG as nU,jH as e2e,jI as PM,jJ as sU,jK as t2e,jL as iU,jM as oU,jN as aU,jO as rU,jP as n2e,jQ as TM,jR as g_,jS as s2e,jT as kn,jU as bt,jV as i2e,jW as Hy,jX as lU,jY as cU,jZ as dU,j_ as uU,j$ as o2e,k0 as a2e,k1 as hU,k2 as r2e,k3 as pU,k4 as fU,k5 as mU,k6 as l2e,k7 as c2e,k8 as gU,k9 as d2e,ka as u2e,kb as h2e,kc as p2e,kd as f2e,ke as m2e,kf as g2e,kg as v2e,kh as y2e,ki as b2e,kj as x2e,kk as DM,kl as o2,km as C2e,kn as MM,ko as lm,kp as LM,kq as vU,kr as w2e,ks as _2e,kt as RM,ku as S2e,kv as yU,kw as k2e,kx as OM,ky as I2e,kz as j2e,kA as E2e,kB as A2e,kC as P2e,kD as T2e,kE as D2e,kF as M2e,kG as Ab,kH as L2e,kI as R2e,kJ as O2e,kK as bU,kL as N2e,kM as F2e,kN as B2e,kO as z2e,kP as V2e,kQ as $2e,kR as G2e,kS as H2e,kT as xU,kU as CU,kV as wU,kW as _U,kX as W2e,kY as U2e,kZ as SU,k_ as kU,k$ as Kc,l0 as cm,l1 as q2e,l2 as K2e,l3 as Z2e,l4 as X2e,l5 as Y2e,l6 as Q2e,l7 as J2e,l8 as IU,l9 as eCe,la as Wy,lb as tCe,lc as Qk,ld as nCe,le as sCe,lf as iCe,lg as oCe,lh as aCe,li as rCe,lj as lCe,lk as cCe,ll as dCe,lm as uCe,ln as hCe,lo as pCe,lp as fCe,lq as mCe,lr as Ks,ls as gCe,lt as jU,lu as EU,lv as AU,lw as Uy,lx as Hl,ly as PU,lz as Fh,lA as NM,lB as FM,lC as vCe,lD as yCe,lE as v_,lF as bCe,lG as xCe,lH as gu,lI as Bh,lJ as CCe,lK as wCe,lL as _Ce,lM as SCe,lN as kCe,lO as ICe,lP as TU,lQ as jCe,lR as ECe,lS as DU,lT as MU,lU as ACe,lV as qy,lW as PCe,lX as LU,lY as TCe,lZ as Pc,l_ as DCe,l$ as MCe,m0 as RU,m1 as LCe,m2 as RCe,m3 as OCe,m4 as NCe,m5 as FCe,m6 as BCe,m7 as zCe,m8 as VCe,m9 as OU,ma as $Ce,mb as Af,mc as BM,md as WL,me as GCe,mf as NU,mg as FU,mh as Ky,mi as HCe,mj as U2,mk as BU,ml as Vo,mm as WCe,mn as YA,mo as QA,mp as UL,mq as UCe,mr as qCe,ms as KCe,mt as JA,mu as ZCe,mv as zU,mw as VU,mx as qL,my as Dp,mz as XCe,mA as YCe,mB as QCe,mC as JCe,mD as ewe,mE as KL,mF as Jk,mG as ZL,mH as XL,mI as YL,mJ as QL,mK as $U,mL as Pb,mM as GU,mN as kc,mO as HU,mP as WU,mQ as UU,mR as qU,mS as KU,mT as twe,mU as nwe,mV as swe,mW as JL,mX as eR,mY as q2,mZ as ZU,m_ as iwe,m$ as owe,n0 as XU,n1 as awe,n2 as rwe,n3 as lwe,n4 as cwe,n5 as dwe,n6 as YU,n7 as QU,n8 as zM,n9 as VM,na as uwe,nb as hwe,nc as pwe,nd as fwe,ne as mwe,nf as gwe,ng as vwe,nh as ywe,ni as bwe,nj as xwe,nk as Cwe,nl as JU,nm as K2,nn as wwe,no as _we,np as Swe,nq as kwe,nr as $M,ns as J0,nt as tR,nu as Iwe,nv as eP,nw as eq,nx as jwe,ny as Ewe,nz as Awe,nA as Pwe,nB as Twe,nC as Dwe,nD as Mwe,nE as Lwe,nF as Rwe,nG as Owe,nH as Nwe,nI as Fwe,nJ as Bwe,nK as zwe,nL as Vwe,nM as $we,nN as Gwe,nO as Hwe,nP as Wwe,nQ as tq,nR as nq,nS as sq,nT as iq,nU as Uwe,nV as oq,nW as qwe,nX as L0,nY as Kwe,nZ as aq,n_ as GM,n$ as rq,o0 as Zwe,o1 as y_,o2 as lq,o3 as Xwe,o4 as b_,o5 as Ywe,o6 as Qwe,o7 as Jwe,o8 as x_,o9 as e_e,oa as HM,ob as nR,oc as C_,od as WM,oe as t_e,of as cq,og as n_e,oh as sR,oi as dq,oj as s_e,ok as iR,ol as Zy,om as uq,on as hq,oo as pq,op as zh,oq as i_e,or as o_e,os as a_e,ot as fq,ou as mq,ov as r_e,ow as l_e,ox as c_e,oy as d_e,oz as u_e,oA as h_e,oB as p_e,oC as f_e,oD as m_e,oE as g_e,oF as v_e,oG as y_e,oH as tP,oI as dm,oJ as UM,oK as b_e,oL as x_e,oM as Xy,oN as C_e,oO as w_e,oP as __e,oQ as S_e,oR as k_e,oS as I_e,oT as j_e,oU as E_e,oV as A_e,oW as P_e,oX as T_e,oY as D_e,oZ as M_e,o_ as oR,o$ as L_e,p0 as R_e,p1 as O_e,p2 as gq,p3 as vq,p4 as yq,p5 as R0,p6 as O0,p7 as bq,p8 as xq,p9 as Cq,pa as N_e,pb as F_e,pc as B_e,pd as z_e,pe as V_e,pf as $_e,pg as G_e,ph as H_e,pi as W_e,pj as wq,pk as U_e,pl as q_e,pm as K_e,pn as Pf,po as Mp,pp as Tb,pq as xd,pr as ff,ps as pa,pt as qM,pu as gh,pv as Ml,pw as vh,px as w_,py as Zc,pz as Z_e,pA as _q,pB as Sq,pC as kq,pD as __,pE as Iq,pF as jq,pG as X_e,pH as Y_e,pI as Q_e,pJ as J_e,pK as eSe,pL as tSe,pM as nP,pN as KM,pO as Zp,pP as Eq,pQ as Aq,pR as Pq,pS as nSe,pT as ZM,pU as Tq,pV as ar,pW as Dq,pX as XM,pY as Xc,pZ as um,p_ as YM,p$ as Mq,q0 as sSe,q1 as hm,q2 as jd,q3 as Ed,q4 as Lq,q5 as iSe,q6 as oSe,q7 as Rq,q8 as QM,q9 as Ga,qa as sP,qb as aR,qc as iP,qd as S_,qe as aSe,qf as rSe,qg as lSe,qh as JM,qi as cSe,qj as dSe,qk as Oq,ql as k_,qm as Z2,qn as uSe,qo as rR,qp as hSe,qq as eI,qr as lR,qs as cR,qt as dR,qu as uR,qv as pSe,qw as hR,qx as fSe,qy as pR,qz as mSe,qA as tI,qB as fR,qC as mR,qD as gR,qE as gSe,qF as nI,qG as vR,qH as vSe,qI as yR,qJ as bR,qK as xR,qL as X2,qM as ySe,qN as bSe,qO as xSe,qP as CSe,qQ as wSe,qR as _Se,qS as SSe,qT as Nq,qU as kSe,qV as ISe,qW as jSe,qX as ESe,qY as ASe,qZ as PSe,q_ as TSe,q$ as DSe,r0 as MSe,r1 as LSe,r2 as RSe,r3 as OSe,r4 as NSe,r5 as FSe,r6 as BSe,r7 as zSe,r8 as VSe,r9 as Fq,ra as $Se,rb as GSe,rc as HSe,rd as e4,re as WSe,rf as USe,rg as CR,rh as sI,ri as qSe,rj as KSe,rk as ZSe,rl as XSe,rm as YSe,rn as QSe,ro as JSe,rp as eke,rq as Bq,rr as zq,rs as Vq,rt as $q,ru as Gq,rv as Hq,rw as tke,rx as nke,ry as wR,rz as _R,rA as ske,rB as ike,rC as oke,rD as ake,rE as Wq,rF as rke,rG as lke,rH as cke,rI as dke,rJ as uke,rK as t4,rL as hke,rM as Fs,rN as Uq,rO as pke,rP as oP,rQ as fke,rR as mke,rS as gke,rT as qq,rU as vke,rV as Kq,rW as yke,rX as bke,rY as Zq,rZ as Xq,r_ as Yq,r$ as xke,s0 as Qq,s1 as Jq,s2 as eK,s3 as tK,s4 as nK,s5 as Cke,s6 as wke,s7 as sK,s8 as _ke,s9 as Ske,sa as kke,sb as Ike,sc as iK,sd as jke,se as Eke,sf as Ake,sg as Pke,sh as Tke,si as Dke,sj as Mke,sk as Lke,sl as Rke,sm as Oke,sn as Nke,so as oK,sp as Fke,sq as Bke,sr as zke,ss as Vke,st as SR}from"./index-tByNT7fL.js";var iI,kR;function $ke(){return kR||(kR=1,iI={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),iI}var Gke=$ke();const Hke=Xf(Gke);var Wke=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function IR(e){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=e.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(t.name=n[1],(Hke[n[1]]||e.charAt(e.length-2)==="/")&&(t.voidElement=!0),t.name.startsWith("!--"))){var s=e.indexOf("-->");return{type:"comment",comment:s!==-1?e.slice(4,s):""}}for(var i=new RegExp(Wke),o=null;(o=i.exec(e))!==null;)if(o[0].trim())if(o[1]){var r=o[1].trim(),l=[r,""];r.indexOf("=")>-1&&(l=r.split("=")),t.attrs[l[0]]=l[1],i.lastIndex--}else o[2]&&(t.attrs[o[2]]=o[3].trim().substring(1,o[3].length-1));return t}var Uke=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,qke=/^\s*$/,Kke=Object.create(null);function aK(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?function(n){var s=[];for(var i in n)s.push(i+'="'+n[i]+'"');return s.length?" "+s.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce(aK,"")+"</"+t.name+">";case"comment":return e+"<!--"+t.comment+"-->"}}var Zke={parse:function(e,t){t||(t={}),t.components||(t.components=Kke);var n,s=[],i=[],o=-1,r=!1;if(e.indexOf("<")!==0){var l=e.indexOf("<");s.push({type:"text",content:l===-1?e:e.substring(0,l)})}return e.replace(Uke,function(c,d){if(r){if(c!=="</"+n.name+">")return;r=!1}var u,p=c.charAt(1)!=="/",m=c.startsWith("<!--"),f=d+c.length,g=e.charAt(f);if(m){var v=IR(c);return o<0?(s.push(v),s):((u=i[o]).children.push(v),s)}if(p&&(o++,(n=IR(c)).type==="tag"&&t.components[n.name]&&(n.type="component",r=!0),n.voidElement||r||!g||g==="<"||n.children.push({type:"text",content:e.slice(f,e.indexOf("<",f))}),o===0&&s.push(n),(u=i[o-1])&&u.children.push(n),i[o]=n),(!p||n.voidElement)&&(o>-1&&(n.voidElement||n.name===c.slice(2,-1))&&(o--,n=o===-1?s:i[o]),!r&&g!=="<"&&g)){u=o===-1?s:i[o].children;var b=e.indexOf("<",f),C=e.slice(f,b===-1?void 0:b);qke.test(C)&&(C=" "),(b>-1&&o+u.length>=0||C!==" ")&&u.push({type:"text",content:C})}}),s},stringify:function(e){return e.reduce(function(t,n){return t+aK("",n)},"")}};const a2=(e,t,n,s)=>{const i=[n,{code:t,...s||{}}];if(e?.services?.logger?.forward)return e.services.logger.forward(i,"warn","react-i18next::",!0);Qa(i[0])&&(i[0]=`react-i18next:: ${i[0]}`),e?.services?.logger?.warn?e.services.logger.warn(...i):console?.warn&&console.warn(...i)},jR={},Ov=(e,t,n,s)=>{Qa(n)&&jR[n]||(Qa(n)&&(jR[n]=new Date),a2(e,t,n,s))},rK=(e,t)=>()=>{if(e.isInitialized)t();else{const n=()=>{setTimeout(()=>{e.off("initialized",n)},0),t()};e.on("initialized",n)}},aP=(e,t,n)=>{e.loadNamespaces(t,rK(e,n))},ER=(e,t,n,s)=>{if(Qa(n)&&(n=[n]),e.options.preload&&e.options.preload.indexOf(t)>-1)return aP(e,n,s);n.forEach(i=>{e.options.ns.indexOf(i)<0&&e.options.ns.push(i)}),e.loadLanguages(t,rK(e,s))},Xke=(e,t,n={})=>!t.languages||!t.languages.length?(Ov(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(e,{lng:n.lng,precheck:(s,i)=>{if(n.bindI18n?.indexOf("languageChanging")>-1&&s.services.backendConnector.backend&&s.isLanguageChangingTo&&!i(s.isLanguageChangingTo,e))return!1}}),Qa=e=>typeof e=="string",Ad=e=>typeof e=="object"&&e!==null,oI=(e,t)=>{if(!e)return!1;const n=e.props?.children??e.children;return t?n.length>0:!!n},aI=e=>{if(!e)return[];const t=e.props?.children??e.children;return e.props?.i18nIsDynamicList?Xp(t):t},Yke=e=>Array.isArray(e)&&e.every(h.isValidElement),Xp=e=>Array.isArray(e)?e:[e],Qke=(e,t)=>{const n={...t};return n.props=Object.assign(e.props,t.props),n},lK=(e,t,n,s)=>{if(!e)return"";let i="";const o=Xp(e),r=t?.transSupportBasicHtmlNodes?t.transKeepBasicHtmlNodesFor??[]:[];return o.forEach((l,c)=>{if(Qa(l)){i+=`${l}`;return}if(h.isValidElement(l)){const{props:d,type:u}=l,p=Object.keys(d).length,m=r.indexOf(u)>-1,f=d.children;if(!f&&m&&!p){i+=`<${u}/>`;return}if(!f&&(!m||p)||d.i18nIsDynamicList){i+=`<${c}></${c}>`;return}if(m&&p===1&&Qa(f)){i+=`<${u}>${f}</${u}>`;return}const g=lK(f,t,n,s);i+=`<${c}>${g}</${c}>`;return}if(l===null){a2(n,"TRANS_NULL_VALUE","Passed in a null value as child",{i18nKey:s});return}if(Ad(l)){const{format:d,...u}=l,p=Object.keys(u);if(p.length===1){const m=d?`${p[0]}, ${d}`:p[0];i+=`{{${m}}}`;return}a2(n,"TRANS_INVALID_OBJ","Invalid child - Object should only have keys {{ value, format }} (format is optional).",{i18nKey:s,child:l});return}a2(n,"TRANS_INVALID_VAR","Passed in a variable like {number} - pass variables for interpolation as full objects like {{number}}.",{i18nKey:s,child:l})}),i},Jke=(e,t,n,s,i,o,r)=>{if(n==="")return[];const l=i.transKeepBasicHtmlNodesFor||[],c=n&&new RegExp(l.map(C=>`<${C}`).join("|")).test(n);if(!e&&!t&&!c&&!r)return[n];const d=t??{},u=C=>{Xp(C).forEach(x=>{Qa(x)||(oI(x)?u(aI(x)):Ad(x)&&!h.isValidElement(x)&&Object.assign(d,x))})};u(e);const p=Zke.parse(`<0>${n}</0>`),m={...d,...o},f=(C,y,x)=>{const w=aI(C),_=v(w,y.children,x);return Yke(w)&&_.length===0||C.props?.i18nIsDynamicList?w:_},g=(C,y,x,w,_)=>{C.dummy?(C.children=y,x.push(h.cloneElement(C,{key:w},_?void 0:y))):x.push(...h.Children.map([C],S=>{const I={...S.props};return delete I.i18nIsDynamicList,h.createElement(S.type,{...I,key:w,ref:S.props.ref??S.ref},_?null:y)}))},v=(C,y,x)=>{const w=Xp(C);return Xp(y).reduce((S,I,k)=>{const E=I.children?.[0]?.content&&s.services.interpolator.interpolate(I.children[0].content,m,s.language);if(I.type==="tag"){let j=w[parseInt(I.name,10)];!j&&t&&(j=t[I.name]),x.length===1&&!j&&(j=x[0][I.name]),j||(j={});const P=Object.keys(I.attrs).length!==0?Qke({props:I.attrs},j):j,D=h.isValidElement(P),O=D&&oI(I,!0)&&!I.voidElement,N=c&&Ad(P)&&P.dummy&&!D,F=Ad(t)&&Object.hasOwnProperty.call(t,I.name);if(Qa(P)){const X=s.services.interpolator.interpolate(P,m,s.language);S.push(X)}else if(oI(P)||O){const X=f(P,I,x);g(P,X,S,k)}else if(N){const X=v(w,I.children,x);g(P,X,S,k)}else if(Number.isNaN(parseFloat(I.name)))if(F){const X=f(P,I,x);g(P,X,S,k,I.voidElement)}else if(i.transSupportBasicHtmlNodes&&l.indexOf(I.name)>-1)if(I.voidElement)S.push(h.createElement(I.name,{key:`${I.name}-${k}`}));else{const X=v(w,I.children,x);S.push(h.createElement(I.name,{key:`${I.name}-${k}`},X))}else if(I.voidElement)S.push(`<${I.name} />`);else{const X=v(w,I.children,x);S.push(`<${I.name}>${X}</${I.name}>`)}else if(Ad(P)&&!D){const X=I.children[0]?E:null;X&&S.push(X)}else g(P,E,S,k,I.children.length!==1||!E)}else if(I.type==="text"){const j=i.transWrapTextNodes,P=r?i.unescape(s.services.interpolator.interpolate(I.content,m,s.language)):s.services.interpolator.interpolate(I.content,m,s.language);j?S.push(h.createElement(j,{key:`${I.name}-${k}`},P)):S.push(P)}return S},[])},b=v([{dummy:!0,children:e||[]}],p,Xp(e||[]));return aI(b[0])},cK=(e,t,n)=>{const s=e.key||t,i=h.cloneElement(e,{key:s});if(!i.props||!i.props.children||n.indexOf(`${t}/>`)<0&&n.indexOf(`${t} />`)<0)return i;function o(){return h.createElement(h.Fragment,null,i)}return h.createElement(o,{key:s})},eIe=(e,t)=>e.map((n,s)=>cK(n,s,t)),tIe=(e,t)=>{const n={};return Object.keys(e).forEach(s=>{Object.assign(n,{[s]:cK(e[s],s,t)})}),n},nIe=(e,t,n,s)=>e?Array.isArray(e)?eIe(e,t):Ad(e)?tIe(e,t):(Ov(n,"TRANS_INVALID_COMPONENTS",'<Trans /> "components" prop expects an object or array',{i18nKey:s}),null):null,sIe=e=>!Ad(e)||Array.isArray(e)?!1:Object.keys(e).reduce((t,n)=>t&&Number.isNaN(Number.parseFloat(n)),!0);function iIe({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o={},values:r,defaults:l,components:c,ns:d,i18n:u,t:p,shouldUnescape:m,...f}){const g=u||RD();if(!g)return Ov(g,"NO_I18NEXT_INSTANCE","Trans: You need to pass in an i18next instance using i18nextReactModule",{i18nKey:s}),e;const v=p||g.t.bind(g)||(N=>N),b={...NG(),...g.options?.react};let C=d||v.ns||g.options?.defaultNS;C=Qa(C)?[C]:C||["translation"];const y=lK(e,b,g,s),x=l||y||b.transEmptyNodeValue||s,{hashTransKey:w}=b,_=s||(w?w(y||x):y||x);g.options?.interpolation?.defaultVariables&&(r=r&&Object.keys(r).length>0?{...r,...g.options.interpolation.defaultVariables}:{...g.options.interpolation.defaultVariables});const S=r||t!==void 0&&!g.options?.interpolation?.alwaysFormat||!e?o.interpolation:{interpolation:{...o.interpolation,prefix:"#$?",suffix:"?$#"}},I={...o,context:i||o.context,count:t,...r,...S,defaultValue:x,ns:C},k=_?v(_,I):x,E=nIe(c,k,g,s);let j=E||e,P=null;sIe(E)&&(P=E,j=e);const D=Jke(j,P,k,g,b,I,m),O=n??b.defaultTransParent;return O?h.createElement(O,f,D):D}const dK=h.createContext();class oIe{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}function Bn({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o={},values:r,defaults:l,components:c,ns:d,i18n:u,t:p,shouldUnescape:m,...f}){const{i18n:g,defaultNS:v}=h.useContext(dK)||{},b=u||g||RD(),C=p||b?.t.bind(b);return iIe({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o,values:r,defaults:l,components:c,ns:d||C?.ns||v||b?.options?.defaultNS,i18n:b,t:p,shouldUnescape:m,...f})}const aIe=(e,t)=>{const n=h.useRef();return h.useEffect(()=>{n.current=e},[e,t]),n.current},uK=(e,t,n,s)=>e.getFixedT(t,n,s),rIe=(e,t,n,s)=>h.useCallback(uK(e,t,n,s),[e,t,n,s]),T=(e,t={})=>{const{i18n:n}=t,{i18n:s,defaultNS:i}=h.useContext(dK)||{},o=n||s||RD();if(o&&!o.reportNamespaces&&(o.reportNamespaces=new oIe),!o){Ov(o,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const w=(S,I)=>Qa(I)?I:Ad(I)&&Qa(I.defaultValue)?I.defaultValue:Array.isArray(S)?S[S.length-1]:S,_=[w,{},!1];return _.t=w,_.i18n={},_.ready=!1,_}o.options.react?.wait&&Ov(o,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const r={...NG(),...o.options.react,...t},{useSuspense:l,keyPrefix:c}=r;let d=i||o.options?.defaultNS;d=Qa(d)?[d]:d||["translation"],o.reportNamespaces.addUsedNamespaces?.(d);const u=(o.isInitialized||o.initializedStoreOnce)&&d.every(w=>Xke(w,o,r)),p=rIe(o,t.lng||null,r.nsMode==="fallback"?d:d[0],c),m=()=>p,f=()=>uK(o,t.lng||null,r.nsMode==="fallback"?d:d[0],c),[g,v]=h.useState(m);let b=d.join();t.lng&&(b=`${t.lng}${b}`);const C=aIe(b),y=h.useRef(!0);h.useEffect(()=>{const{bindI18n:w,bindI18nStore:_}=r;y.current=!0,!u&&!l&&(t.lng?ER(o,t.lng,d,()=>{y.current&&v(f)}):aP(o,d,()=>{y.current&&v(f)})),u&&C&&C!==b&&y.current&&v(f);const S=()=>{y.current&&v(f)};return w&&o?.on(w,S),_&&o?.store.on(_,S),()=>{y.current=!1,o&&w?.split(" ").forEach(I=>o.off(I,S)),_&&o&&_.split(" ").forEach(I=>o.store.off(I,S))}},[o,b]),h.useEffect(()=>{y.current&&u&&v(m)},[o,c,u]);const x=[g,o,u];if(x.t=g,x.i18n=o,x.ready=u,u||!u&&!l)return x;throw new Promise(w=>{t.lng?ER(o,t.lng,d,()=>w()):aP(o,d,()=>w())})};let rI=(e,t)=>{Array.isArray(e)||(e=[e]);let n=[],s,i=()=>{s&&s();let o=e.map(r=>r.get());s=t(...o)};return n=e.map(o=>o.listen(i)),i(),()=>{n.forEach(o=>o()),s&&s()}};function lIe(e){return Array.isArray(e)?e:Array.from(e)}function cIe(e,t){const n=new Set(t);return e.filter(s=>!n.has(s))}function dIe(e,...t){if(!AL(e))return[];const n=lIe(e),s=[];for(let i=0;i<t.length;i++){const o=t[i];AL(o)&&s.push(...Array.from(o))}return cIe(n,s)}function uIe(e){return eye(e)?NaN:Number(e)}function r2(e){return e?(e=uIe(e),e===1/0||e===-1/0?(e<0?-1:1)*Number.MAX_VALUE:e===e?e:0):e===0?e:0}function hIe(e){const t=r2(e),n=t%1;return n?t-n:t}function pIe(e,t,n){return tye(n)&&(typeof t=="number"&&Ay(n)&&nye(t)&&t<n.length||typeof t=="string"&&t in n)?sye(n[t],e):!1}function Tf(e){return typeof e=="string"||e instanceof String}function hK(e,t=1){const n=[],s=Math.floor(t);if(!Ay(e))return n;const i=(o,r)=>{for(let l=0;l<o.length;l++){const c=o[l];r<s&&(Array.isArray(c)||c?.[Symbol.isConcatSpreadable]||c!==null&&typeof c=="object"&&Object.prototype.toString.call(c)==="[object Arguments]")?Array.isArray(c)?i(c,r+1):i(Array.from(c),r+1):n.push(c)}};return i(Array.from(e),0),n}function fIe(e,t=1){return hK(e,t)}function Wr(e,t){if(!e)return[];const n=Ay(e)||Array.isArray(e)?iye(0,e.length):Object.keys(e),s=oye(t??aye),i=new Array(n.length);for(let o=0;o<n.length;o++){const r=n[o],l=e[r];i[o]=s(l,r,e)}return i}function mIe(e,t){if(PL(e))return[];const n=PL(t)?Wr(e):Wr(e,t);return fIe(n,1)}function pK(e){if(typeof e!="function")throw new TypeError("Expected a function");return function(...t){return!e.apply(this,t)}}function gIe(e,t){const n=[];for(let s=0;s<e.length;s++){const i=e[s];n.every(r=>!t(r,i))&&n.push(i)}return n}function fK(e,t){return Ay(e)?typeof t=="function"?gIe(Array.from(e),t):FG(Array.from(e)):[]}function pr(e,t=0,n={}){typeof n!="object"&&(n={});let s=null,i=null,o=null,r=0,l=null,c;const{leading:d=!1,trailing:u=!0,maxWait:p}=n,m="maxWait"in n,f=m?Math.max(Number(p)||0,t):0,g=_=>(s!==null&&(c=e.apply(i,s)),s=i=null,r=_,c),v=_=>(r=_,l=setTimeout(x,t),d&&s!==null?g(_):c),b=_=>(l=null,u&&s!==null?g(_):c),C=_=>{if(o===null)return!0;const S=_-o,I=S>=t||S<0,k=m&&_-r>=f;return I||k},y=_=>{const S=o===null?0:_-o,I=t-S,k=f-(_-r);return m?Math.min(I,k):I},x=()=>{const _=Date.now();if(C(_))return b(_);l=setTimeout(x,y(_))},w=function(..._){const S=Date.now(),I=C(S);if(s=_,i=this,o=S,I){if(l===null)return v(S);if(m)return clearTimeout(l),l=setTimeout(x,t),g(S)}return l===null&&(l=setTimeout(x,t)),c};return w.cancel=()=>{l!==null&&clearTimeout(l),r=0,o=s=i=l=null},w.flush=()=>l===null?c:b(Date.now()),w}function I_(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");const n=function(...i){const o=t?t.apply(this,i):i[0],r=n.cache;if(r.has(o))return r.get(o);const l=e.apply(this,i);return n.cache=r.set(o,l)||r,l},s=I_.Cache||Map;return n.cache=new s,n}I_.Cache=Map;function rP(e,t=0,n={}){const{leading:s=!0,trailing:i=!0}=n;return pr(e,t,{leading:s,maxWait:t,trailing:i})}function vIe(e,t,n=0){if(t=Number(t),Object.is(t,-0)&&(t="-0"),n=Math.min(Number.parseInt(n,10),292),n){const[s,i=0]=t.toString().split("e");let o=Math[e](+`${s}e${Number(i)+n}`);Object.is(o,-0)&&(o="-0");const[r,l=0]=o.toString().split("e");return+`${r}e${Number(l)-n}`}return Math[e](Number(t))}function yIe(e,t,n){n&&typeof n!="number"&&pIe(e,t,n)&&(t=n=void 0),e=r2(e),t===void 0?(t=e,e=0):t=r2(t),n=n===void 0?e<t?1:-1:r2(n);const s=Math.max(Math.ceil((t-e)/(n||1)),0),i=new Array(s);for(let o=0;o<s;o++)i[o]=e,e+=n;return i}function Vh(e,t=0){return vIe("round",e,t)}function mK(...e){}function bIe(e){return typeof Buffer<"u"&&Buffer.isBuffer(e)}function xIe(e){const t=e?.constructor,n=typeof t=="function"?t.prototype:Object.prototype;return e===n}function CIe(e,t){if(e=hIe(e),e<1||!Number.isSafeInteger(e))return[];const n=new Array(e);for(let s=0;s<e;s++)n[s]=typeof t=="function"?t(s):s;return n}function wIe(e){if(Ay(e))return _Ie(e);const t=Object.keys(Object(e));return xIe(e)?t.filter(n=>n!=="constructor"):t}function _Ie(e){const t=CIe(e.length,s=>`${s}`),n=new Set(t);return bIe(e)&&(n.add("offset"),n.add("parent")),rye(e)&&(n.add("buffer"),n.add("byteLength"),n.add("byteOffset")),[...t,...Object.keys(e).filter(s=>!n.has(s))]}function SIe(e,...t){e=Object(e);for(let n=0;n<t.length;n++){const s=t[n];s!=null&&lP(e,s,new WeakMap)}return e}function lP(e,t,n){for(const s in t){const i=t[s],o=e[s];if(!Object.hasOwn(e,s)||o===void 0)if(n.has(i))e[s]=n.get(i);else if(Uk(i)){const l={};n.set(i,l),e[s]=l,lP(l,i,n)}else e[s]=i;else if(Uk(o)&&Uk(i)){const l=n.has(i);(!l||l&&n.get(i)!==o)&&(n.set(i,o),lP(o,i,n))}}}function kIe(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function IIe(e){const t=lye(e);if(t.length===0)return"";const[n,...s]=t;return`${n.toLowerCase()}${s.map(i=>kIe(i)).join("")}`}function jIe(e){return IIe(cye(e))}function EIe(e){return e.substring(0,1).toUpperCase()+e.substring(1)}function Cd(e){return EIe(dye(e))}function gK(e){return Object.keys(e)}function Y2(e,t,{signal:n,edges:s}={}){let i,o=null;const r=s!=null&&s.includes("leading"),l=s==null||s.includes("trailing"),c=()=>{o!==null&&(e.apply(i,o),i=void 0,o=null)},d=()=>{l&&c(),f()};let u=null;const p=()=>{u!=null&&clearTimeout(u),u=setTimeout(()=>{u=null,d()},t)},m=()=>{u!==null&&(clearTimeout(u),u=null)},f=()=>{m(),i=void 0,o=null},g=()=>{m(),c()},v=function(...b){if(n?.aborted)return;i=this,o=b;const C=u==null;p(),r&&C&&c()};return v.schedule=p,v.cancel=f,v.flush=g,n?.addEventListener("abort",f,{once:!0}),v}const lI=new Set;function mn(e){h.useEffect(()=>(ae(!lI.has(e),`There should be only one instance of ${e}`),lI.add(e),()=>{lI.delete(e)}),[e])}const AR=document.title,AIe="assets/images/invoke-favicon.svg",PIe="assets/images/invoke-alert-favicon.svg",TIe={selectFromResult:e=>({queueSize:e.data?e.data.queue.pending+e.data.queue.in_progress:0})},DIe=e=>{document.title=e>0?`(${e}) ${AR}`:AR;const t=document.getElementById("invoke-favicon");t instanceof HTMLLinkElement&&(t.href=e>0?PIe:AIe)},MIe=()=>{mn("useSyncFaviconQueueStatus");const{queueSize:e}=ur(void 0,TIe);h.useEffect(()=>{DIe(e)},[e])},vK=De("ltr"),LIe=()=>{mn("useSyncLangDirection");const{i18n:e,t}=T();h.useEffect(()=>{const n=e.dir();vK.set(n),document.body.dir=n},[e,t])},RIe=()=>{mn("useSyncLoggingConfig");const e=M(BG),t=M(zG),n=M(VG);h.useLayoutEffect(()=>{uye(n,e,t)},[n,e,t])},yK=Ft("system").child({filePath:"common/hooks/focus.ts"}),OIe=["launchpad","viewer","gallery","boards","layers","canvas","workflows","progress","settings"],mf=OIe.reduce((e,t)=>(e[t]=new Set,e),{}),j_=De(null),NIe=gK(mf).reduce((e,t)=>(e[`$${t}`]=Ut(j_,n=>n===t),e),{}),tu=e=>{j_.set(e),yK.trace(`Focus changed: ${e}`)},Yy=()=>j_.get(),Qy=(e,t,n)=>{h.useEffect(()=>{if(!t.current)return;const{focusOnMount:s=!1}={focusOnMount:!1,...n},i=t.current;return mf[e].add(i),s&&tu(e),()=>{mf[e].delete(i),mf[e].size===0&&j_.get()===e&&tu(null)}},[n,t,e])},So=e=>le(NIe[`$${e}`]),PR=e=>{const t=document.activeElement;if(!(t instanceof HTMLElement))return;const n=[];for(const i of gK(mf))for(const o of mf[i])o.contains(t)&&n.push({region:i,element:o});if(n.length===0)return;n.sort((i,o)=>o.element.contains(i.element)?-1:i.element.contains(o.element)?1:0);const s=n[0]?.region;if(!s){yK.warn("No focused region found");return}tu(s)},FIe=()=>{mn("useFocusRegionWatcher"),h.useEffect(()=>(window.addEventListener("focus",PR,{capture:!0}),()=>{window.removeEventListener("focus",PR,{capture:!0})}),[])},BIe="chakra-ui:close-tooltip",zIe=()=>{h.useEffect(()=>{const e=()=>{document.dispatchEvent(new window.CustomEvent(BIe))};return document.addEventListener("drag",e),()=>{document.removeEventListener("drag",e)}},[])},E_=De(null),ks=De(!1),Sl=De(null),bK=Ut(Sl,e=>e?n4(e):null),n4=e=>{let t=e.message;return e.percentage&&(t+=` (${Vh(e.percentage*100)}%)`),t},xK=()=>{const{t:e}=T(),{data:t}=ur(),n=le(ks),[s,{isLoading:i}]=$G({fixedCacheKey:"clearQueue"});return{trigger:h.useCallback(async()=>{if(t?.queue.total)try{await s().unwrap(),pe({id:"QUEUE_CLEAR_SUCCEEDED",title:e("queue.clearSucceeded"),status:"success"})}catch{pe({id:"QUEUE_CLEAR_FAILED",title:e("queue.clearFailed"),status:"error"})}},[t?.queue.total,s,e]),isLoading:i,isDisabled:!n||!t?.queue.total}},CK=()=>{const{currentQueueItemId:e}=GG(void 0,{selectFromResult:({data:t})=>({currentQueueItemId:t?.item_id??null})});return e},VIe={withToast:!0},$Ie=()=>{const e=le(ks),[t,{isLoading:n}]=hye(),{t:s}=T();return{trigger:h.useCallback(async(o,r)=>{const{withToast:l}={...VIe,...r};try{await t({item_id:o}).unwrap(),l&&pe({id:"QUEUE_CANCEL_SUCCEEDED",title:s("queue.cancelSucceeded"),status:"success"})}catch{l&&pe({id:"QUEUE_CANCEL_FAILED",title:s("queue.cancelFailed"),status:"error"})}},[s,t]),isLoading:n,isDisabled:!e}},s4=()=>{const e=CK(),t=$Ie();return{trigger:h.useCallback(()=>{e!==null&&t.trigger(e)},[e,t]),isLoading:t.isLoading,isDisabled:t.isDisabled||e===null}};class wK{value;constructor(t){this.value=t}isOk(){return!0}isErr(){return!1}}class _K{error;constructor(t){this.error=t}isOk(){return!1}isErr(){return!0}}function Jy(e){try{return new wK(e())}catch(t){return new _K(t instanceof Error?t:new Ll(t))}}async function Kn(e){try{const t=await e();return new wK(t)}catch(t){return new _K(t instanceof Error?t:new Ll(t))}}class Ll extends Error{error;constructor(t){super("Wrapped Error"),this.name=this.constructor.name,this.error=t}static wrap(t){return t instanceof Error?t:new Ll(t)}}const cI=Ft("workflows").child({filePath:"features/nodes/util/graph/buildNodesGraph.ts"}),GIe=(e,t)=>{const{value:n}=e;if(n==="auto"||!n){const s=ko(t);return s==="none"?void 0:{board_id:s}}if(n!=="none")return n},HIe=(e,t)=>{const{nodes:n,edges:s}=Xn(e),i=n.filter(eo).filter(HG),o=i.reduce((u,p)=>{const{id:m,data:f}=p,{type:g,inputs:v,isIntermediate:b}=f,C=t[g];if(!C)return cI.warn({id:m,type:g},"Node template not found!"),u;const y=OD(v,(w,_,S)=>{const I=C.inputs[S];return I?(WG(I)&&ND(_)?w[S]=GIe(_,e):w[S]=_.value,w):(cI.warn({id:m,name:S},"Field template not found!"),w)},{});y.use_cache=p.data.useCache;const x={type:g,id:m,...y,is_intermediate:b};return Object.assign(u,{[m]:x}),u},{}),r=i.map(({id:u})=>u),c=s.filter(u=>u.type!=="collapsed").filter(u=>r.includes(u.source)&&r.includes(u.target)).reduce((u,p)=>{const{source:m,target:f,sourceHandle:g,targetHandle:v}=p;return!g||!v?(cI.warn({source:m,target:f,sourceHandle:g,targetHandle:v},"Missing source or taget handle for edge"),u):(u.push({source:{node_id:m,field:g},destination:{node_id:f,field:v}}),u)},[]);return c.forEach(u=>{const p=o[u.destination.node_id],m=u.destination.field;o[u.destination.node_id]=zc(p,m)}),{id:Kd(),nodes:o,edges:c}},yd=async e=>{const{node:t,dispatch:n,nodesState:s}=e,{nodes:i,edges:o}=s,r=i.filter(eo);if(t.data.type==="image_batch"){ae(Py(t.data.inputs.images));const l=t.data.inputs.images.value??[],c=o.find(m=>m.target===t.id&&m.targetHandle==="images");if(!c)return l??[];const d=r.find(m=>m.id===c.source);ae(d,"Missing edge from image generator to image batch");const u=d.data.inputs.generator;return ae(UG(u),"Invalid image generator field"),await qG(u,n)}else if(t.data.type==="string_batch"){ae(FD(t.data.inputs.strings));const l=t.data.inputs.strings.value,c=o.find(m=>m.target===t.id&&m.targetHandle==="strings");if(!c)return l??[];const d=r.find(m=>m.id===c.source);ae(d,"Missing edge from string generator to string batch");const u=d.data.inputs.generator;return ae(KG(u),"Invalid string generator"),await ZG(u,n)}else if(t.data.type==="float_batch"){ae(BD(t.data.inputs.floats));const l=t.data.inputs.floats.value,c=o.find(m=>m.target===t.id&&m.targetHandle==="floats");if(!c)return l??[];const d=r.find(m=>m.id===c.source);ae(d,"Missing edge from float generator to float batch");const u=d.data.inputs.generator;return ae(XG(u),"Invalid float generator"),YG(u)}else if(t.data.type==="integer_batch"){ae(zD(t.data.inputs.integers));const l=t.data.inputs.integers.value,c=o.find(m=>m.target===t.id&&m.targetHandle==="integers");if(!c)return l??[];const d=r.find(m=>m.id===c.source);ae(d,"Missing edge from integer generator to integer batch");const u=d.data.inputs.generator;return ae(QG(u),"Invalid integer generator field"),JG(u)}ae(!1,"Invalid batch node type")},WIe=async(e,t)=>{const{nodes:n}=e,s=n.filter(eo).filter($w),i=s.filter(y=>y.data.inputs.batch_group_id?.value==="None"),o=s.filter(y=>y.data.inputs.batch_group_id?.value==="Group 1"),r=s.filter(y=>y.data.inputs.batch_group_id?.value==="Group 2"),l=s.filter(y=>y.data.inputs.batch_group_id?.value==="Group 3"),c=s.filter(y=>y.data.inputs.batch_group_id?.value==="Group 4"),d=s.filter(y=>y.data.inputs.batch_group_id?.value==="Group 5"),u=await Promise.all(i.map(async y=>(await yd({nodesState:e,dispatch:t,node:y})).length)),p=await Promise.all(o.map(async y=>(await yd({nodesState:e,dispatch:t,node:y})).length)),m=await Promise.all(r.map(async y=>(await yd({nodesState:e,dispatch:t,node:y})).length)),f=await Promise.all(l.map(async y=>(await yd({nodesState:e,dispatch:t,node:y})).length)),g=await Promise.all(c.map(async y=>(await yd({nodesState:e,dispatch:t,node:y})).length)),v=await Promise.all(d.map(async y=>(await yd({nodesState:e,dispatch:t,node:y})).length)),b=[...u,...p,...m,...f,...g,...v];if(b.length===0)return"NO_BATCHES";if(b.some(y=>y===0))return"EMPTY_BATCHES";for(const y of[p,m,f,g,v])if(y.length!==0&&y.some(x=>x!==y[0]))return"MISMATCHED_BATCH_GROUP";return[...u,p[0]??1,m[0]??1,f[0]??1,g[0]??1,v[0]??1].reduce((y,x)=>y*x,1)};function i4(e){return e instanceof Object&&"name"in e&&(e.name==="ZodError"||e.name==="$ZodError")&&"issues"in e&&Array.isArray(e.issues)}var UIe="ZodValidationError",cP=class extends Error{name;details;constructor(e,t){super(e,t),this.name=UIe,this.details=qIe(t)}toString(){return this.message}};function qIe(e){if(e){const t=e.cause;if(i4(t))return t.issues}return[]}function KIe(e){return e.length!==0}var ZIe={issueSeparator:"; "},XIe=e=>e.message,SK={prefix:"Validation error",prefixSeparator:": ",maxIssuesInMessage:99,issueSeparator:ZIe.issueSeparator,error:XIe};function YIe(e={}){const t={...SK,...e},n=t.error;return function(i){const o=i.slice(0,t.maxIssuesInMessage).map(n).join(t.issueSeparator);return QIe(o,t)}}function QIe(e,t){return t.prefix!=null?e.length>0?[t.prefix,e].join(t.prefixSeparator):t.prefix:e.length>0?e:SK.prefix}function kK(e,t={}){if(!i4(e))throw new TypeError(`Invalid zodError param; expected instance of ZodError. Did you mean to use the "${tje.name}" method instead?`);return IK(e,t)}function IK(e,t={}){const n=e.issues;let s;return KIe(n)?s=JIe(t)(n):s=e.message,new cP(s,{cause:e})}function JIe(e){return"messageBuilder"in e?e.messageBuilder:YIe(e)}var eje=(e={})=>t=>i4(t)?IK(t,e):t instanceof Error?new cP(t.message,{cause:t}):new cP("Unknown error");function tje(e,t={}){return eje(t)(e)}const nje=Ft("workflows").child({filePath:"features/nodes/util/workflow/buildWorkflow.ts"}),sje=["name","author","description","version","contact","tags","notes","exposedFields","meta","id","form"],o4=e=>{const{nodes:t,edges:n,...s}=e,o={...eH(s,sje),nodes:[],edges:[]};for(const r of t)if(eo(r)&&r.type){const{id:l,type:c,data:d,position:u}=r;o.nodes.push({id:l,type:c,data:d,position:u})}else if(tH(r)&&r.type){const{id:l,type:c,data:d,position:u}=r;o.nodes.push({id:l,type:c,data:d,position:u})}for(const r of n)if(r.type==="default"&&r.sourceHandle&&r.targetHandle){const{id:l,type:c,source:d,target:u,sourceHandle:p,targetHandle:m,hidden:f}=r;o.edges.push({id:l,type:c,source:d,target:u,sourceHandle:p,targetHandle:m,hidden:f})}else if(r.type==="collapsed"){const{id:l,type:c,source:d,target:u}=r;o.edges.push({id:l,type:c,source:d,target:u})}return It(o)},ije=e=>{const t=o4(e),n=VD.safeParse(t);if(!n.success){const{message:s}=kK(n.error,{prefix:at.t("nodes.unableToValidateWorkflow")});return nje.warn({workflow:ts(t)},s),null}return n.data},a4=()=>{const e=Ze();return h.useCallback(()=>{const n=Xn(e.getState());return o4(n)},[e])},oje=async(e,t)=>{const n=Xn(e),s=[],o=n.nodes.filter(eo).filter($w),r=$D(o,l=>l.data.inputs.batch_group_id?.value);for(const[l,c]of Object.entries(r)){const d=[];for(const u of c){const p=await yd({nodesState:n,node:u,dispatch:t}),m=u.data.type==="image_batch"?"image":"value",f=n.edges.filter(g=>g.source===u.id&&g.sourceHandle===m);if(l!=="None")for(const g of f){if(!g.targetHandle)break;d.push({node_path:g.target,field_name:g.targetHandle,items:p})}else{const g=[];for(const v of f){if(!v.targetHandle)break;g.push({node_path:v.target,field_name:v.targetHandle,items:p})}g.length>0&&s.push(g)}}l!=="None"&&d.length>0&&s.push(d)}return s},aje=async(e,t,n)=>{const{dispatch:s,getState:i}=e,o=i(),r=Xn(o),l=HIe(o,t),c=ije(r);c&&delete c.id;const d=o.params.iterations,u=await oje(o,s),p={batch:{graph:l,workflow:c,runs:d,origin:"workflows",destination:"gallery",data:u},prepend:n},f=await s(mi.endpoints.enqueueBatch.initiate(p,{...cu,track:!1})).unwrap();return{batchConfig:p,enqueueResult:f}},rje=()=>{const e=Ze();return h.useCallback(n=>aje(e,ni.get(),n),[e])},Lp=De(!1),yh=De(null),jK=h.createContext(null),fa=h.memo(({children:e})=>{const t=le(yh);return t?a.jsx(jK.Provider,{value:t,children:e}):null});fa.displayName="CanvasManagerProviderGate";const Tt=()=>{const e=h.useContext(jK);return ae(e,"useCanvasManagerContext must be used within a CanvasManagerProviderGate"),e},pm=()=>le(yh),Zs={UNSUPPORTED_MODEL:"controlLayers.warnings.unsupportedModel",RG_NO_PROMPTS_OR_IP_ADAPTERS:"controlLayers.warnings.rgNoPromptsOrIPAdapters",RG_NEGATIVE_PROMPT_NOT_SUPPORTED:"controlLayers.warnings.rgNegativePromptNotSupported",RG_REFERENCE_IMAGES_NOT_SUPPORTED:"controlLayers.warnings.rgReferenceImagesNotSupported",RG_AUTO_NEGATIVE_NOT_SUPPORTED:"controlLayers.warnings.rgAutoNegativeNotSupported",RG_NO_REGION:"controlLayers.warnings.rgNoRegion",IP_ADAPTER_NO_MODEL_SELECTED:"controlLayers.warnings.ipAdapterNoModelSelected",IP_ADAPTER_INCOMPATIBLE_BASE_MODEL:"controlLayers.warnings.ipAdapterIncompatibleBaseModel",IP_ADAPTER_NO_IMAGE_SELECTED:"controlLayers.warnings.ipAdapterNoImageSelected",CONTROL_ADAPTER_NO_MODEL_SELECTED:"controlLayers.warnings.controlAdapterNoModelSelected",CONTROL_ADAPTER_INCOMPATIBLE_BASE_MODEL:"controlLayers.warnings.controlAdapterIncompatibleBaseModel",CONTROL_ADAPTER_NO_CONTROL:"controlLayers.warnings.controlAdapterNoControl",FLUX_FILL_NO_WORKY_WITH_CONTROL_LORA:"controlLayers.warnings.fluxFillIncompatibleWithControlLoRA"},r4=(e,t)=>{const n=[];if(e.objects.length===0&&n.push(Zs.RG_NO_REGION),e.positivePrompt===null&&e.negativePrompt===null&&e.referenceImages.length===0&&n.push(Zs.RG_NO_PROMPTS_OR_IP_ADAPTERS),t){if(t.base==="sd-3"||t.base==="sd-2")return n.push(Zs.UNSUPPORTED_MODEL),n;t.base==="flux"&&(e.negativePrompt!==null&&n.push(Zs.RG_NEGATIVE_PROMPT_NOT_SUPPORTED),e.autoNegative&&n.push(Zs.RG_AUTO_NEGATIVE_NOT_SUPPORTED)),t.base==="z-image"&&(e.referenceImages.length>0&&n.push(Zs.RG_REFERENCE_IMAGES_NOT_SUPPORTED),e.autoNegative&&n.push(Zs.RG_AUTO_NEGATIVE_NOT_SUPPORTED)),e.referenceImages.forEach(({config:s})=>{s.model?s.model.base!==t.base&&n.push(Zs.IP_ADAPTER_INCOMPATIBLE_BASE_MODEL):n.push(Zs.IP_ADAPTER_NO_MODEL_SELECTED),s.image||n.push(Zs.IP_ADAPTER_NO_IMAGE_SELECTED)})}return n},dP=(e,t)=>!(!e||!t||e.base!==t.base||e.base==="flux"&&(e.name.toLowerCase().includes("kontext")||t.name.toLowerCase().includes("kontext"))&&e.key!==t.key),vu=(e,t)=>{const n=[];if(t){if(t.base==="sd-3"||t.base==="sd-2")return n.push(Zs.UNSUPPORTED_MODEL),n;const{config:s}=e;s.model?dP(s.model,t)||n.push(Zs.IP_ADAPTER_INCOMPATIBLE_BASE_MODEL):n.push(Zs.IP_ADAPTER_NO_MODEL_SELECTED),e.config.image||n.push(Zs.IP_ADAPTER_NO_IMAGE_SELECTED)}return n},e1=(e,t)=>{const n=[];return e.objects.length===0&&n.push(Zs.CONTROL_ADAPTER_NO_CONTROL),e.controlAdapter.model?t&&(t.base==="sd-3"||t.base==="sd-2"?n.push(Zs.UNSUPPORTED_MODEL):e.controlAdapter.model.base!==t.base?n.push(Zs.CONTROL_ADAPTER_INCOMPATIBLE_BASE_MODEL):t.base==="flux"&&t.variant==="dev_fill"&&e.controlAdapter.model.type==="control_lora"&&n.push(Zs.FLUX_FILL_NO_WORKY_WITH_CONTROL_LORA)):n.push(Zs.CONTROL_ADAPTER_NO_MODEL_SELECTED),n},EK=(e,t)=>[],AK=(e,t)=>[],lje=/.*\{[\s\S]*\}.*/,A_=e=>lje.test(e),cje=(e,t)=>{const n=[],{minItems:s,maxItems:i}=t,o=e.length;return s!==void 0&&s>0&&o===0?n.push(ye("parameters.invoke.collectionEmpty")):(s!==void 0&&o<s&&n.push(ye("parameters.invoke.collectionTooFewItems",{count:o,minItems:s})),i!==void 0&&o>i&&n.push(ye("parameters.invoke.collectionTooManyItems",{count:o,maxItems:i}))),n},dje=(e,t)=>{const n=[],{minItems:s,maxItems:i,minLength:o,maxLength:r}=t,l=e.length;s!==void 0&&s>0&&l===0?n.push(ye("parameters.invoke.collectionEmpty")):(s!==void 0&&l<s&&n.push(ye("parameters.invoke.collectionTooFewItems",{count:l,minItems:s})),i!==void 0&&l>i&&n.push(ye("parameters.invoke.collectionTooManyItems",{count:l,maxItems:i})));for(const c of e)r!==void 0&&c.length>r&&n.push(ye("parameters.invoke.collectionStringTooLong",{value:e,maxLength:r})),o!==void 0&&c.length<o&&n.push(ye("parameters.invoke.collectionStringTooShort",{value:e,minLength:o}));return n},TR=(e,t)=>{const n=[],{minItems:s,maxItems:i,minimum:o,maximum:r,exclusiveMinimum:l,exclusiveMaximum:c,multipleOf:d}=t,u=e.length;s!==void 0&&s>0&&u===0?n.push(ye("parameters.invoke.collectionEmpty")):(s!==void 0&&u<s&&n.push(ye("parameters.invoke.collectionTooFewItems",{count:u,minItems:s})),i!==void 0&&u>i&&n.push(ye("parameters.invoke.collectionTooManyItems",{count:u,maxItems:i})));for(const p of e)r!==void 0&&p>r&&n.push(ye("parameters.invoke.collectionNumberGTMax",{value:e,maximum:r})),o!==void 0&&p<o&&n.push(ye("parameters.invoke.collectionNumberLTMin",{value:e,minimum:o})),c!==void 0&&p>=c&&n.push(ye("parameters.invoke.collectionNumberGTExclusiveMax",{value:e,exclusiveMaximum:c})),l!==void 0&&p<=l&&n.push(ye("parameters.invoke.collectionNumberLTExclusiveMin",{value:e,exclusiveMinimum:l})),d!==void 0&&p%d!==0&&n.push(ye("parameters.invoke.collectionNumberNotMultipleOf",{value:e,multipleOf:d}));return n},DR=(e,t)=>{const n=[],{minimum:s,maximum:i,exclusiveMinimum:o,exclusiveMaximum:r,multipleOf:l}=t;return i!==void 0&&e>i&&n.push(ye("parameters.invoke.collectionNumberGTMax",{value:e,maximum:i})),s!==void 0&&e<s&&n.push(ye("parameters.invoke.collectionNumberLTMin",{value:e,minimum:s})),r!==void 0&&e>=r&&n.push(ye("parameters.invoke.collectionNumberGTExclusiveMax",{value:e,exclusiveMaximum:r})),o!==void 0&&e<=o&&n.push(ye("parameters.invoke.collectionNumberLTExclusiveMin",{value:e,exclusiveMinimum:o})),l!==void 0&&e%l!==0&&n.push(ye("parameters.invoke.collectionNumberNotMultipleOf",{value:e,multipleOf:l})),n},uje=(e,t,n,s)=>`${e.data.label||t.title} -> ${n.label||s.title}`,hje=(e,t,n)=>s=>({type:"field-error",nodeId:e,fieldName:t,prefix:n,issue:s}),PK=(e,t,n,s,i)=>{const o=[],r=uje(e,t,n,s),l=hje(e.data.id,n.name,r),c=e.data.id,d=n.name,u=i.edges.find(p=>p.target===c&&p.targetHandle===d)!==void 0;return s.required&&!u&&n.value===void 0?o.push({type:"field-error",nodeId:c,fieldName:d,prefix:r,issue:"parameters.invoke.missingInputForField"}):u||n.value!==void 0&&(nH(s)&&Py(n)?o.push(...cje(n.value,s).map(l)):sH(s)&&FD(n)?o.push(...dje(n.value,s).map(l)):iH(s)&&zD(n)?o.push(...TR(n.value,s).map(l)):oH(s)&&BD(n)?o.push(...TR(n.value,s).map(l)):F2(s)&&aH(n)?o.push(...DR(n.value,s).map(l)):B2(s)&&rH(n)&&o.push(...DR(n.value,s).map(l))),o},pje=(e,t,n)=>{const s=[],i=n.nodes.find(r=>r.id===e);ae(eo(i),`Node ${e} is not an invocation node`);const o=t[i.data.type];if(!o)return s.push({type:"node-error",nodeId:e,issue:ye("parameters.invoke.missingNodeTemplate")}),s;for(const[r,l]of Object.entries(i.data.inputs)){const c=o.inputs[r];if(!c){s.push({type:"node-error",nodeId:e,issue:ye("parameters.invoke.missingFieldTemplate")});continue}s.push(...PK(i,o,l,c,n))}return s.length===0?os:s},Xu=Gw({}),fje=(e,t)=>{for(const n of e.nodes){const s=[];if(!eo(n))continue;const i=t[n.data.type];if(!i){s.push({type:"node-error",nodeId:n.id,issue:ye("parameters.invoke.missingNodeTemplate")}),Xu.setKey(n.id,s);continue}for(const[o,r]of Object.entries(n.data.inputs)){const l=i.inputs[o];if(!l){s.push({type:"node-error",nodeId:n.id,issue:ye("parameters.invoke.missingFieldTemplate")}),Xu.setKey(n.id,s);continue}s.push(...PK(n,i,r,l,e))}if(s.length===0){Xu.setKey(n.id,os);continue}Xu.setKey(n.id,s)}},mje=Y2(fje,300),gje=()=>{const e=M(Xn),t=le(ni);h.useEffect(()=>{mje(e,t)},[e,t])},Rp={reference_image:"controlLayers.referenceImage",inpaint_mask:"controlLayers.inpaintMask",regional_guidance:"controlLayers.regionalGuidance",raster_layer:"controlLayers.rasterLayer",control_layer:"controlLayers.controlLayer"},Ic=De([]),P_=Ut(Ic,e=>e.length===0),vje=pr(async e=>{const{tab:t,isConnected:n,canvas:s,params:i,refImages:o,dynamicPrompts:r,canvasIsFiltering:l,canvasIsTransforming:c,canvasIsRasterizing:d,canvasIsCompositing:u,canvasIsSelectingObject:p,nodes:m,workflowSettings:f,templates:g,upscale:v,loras:b,store:C}=e;if(t==="generate"){const y=wo(C.getState()),x=await bje({isConnected:n,model:y,params:i,refImages:o,dynamicPrompts:r,loras:b});Ic.set(x)}else if(t==="canvas"){const y=wo(C.getState()),x=await wje({isConnected:n,model:y,canvas:s,params:i,refImages:o,dynamicPrompts:r,canvasIsFiltering:l,canvasIsTransforming:c,canvasIsRasterizing:d,canvasIsCompositing:u,canvasIsSelectingObject:p,loras:b});Ic.set(x)}else if(t==="workflows"){const y=await xje({dispatch:C.dispatch,nodesState:m,workflowSettingsState:f,isConnected:n,templates:g});Ic.set(y)}else if(t==="upscaling"){const y=Cje({isConnected:n,upscale:v,params:i,loras:b});Ic.set(y)}else Ic.set(os)},300),yje=()=>{mn("useReadinessWatcher");const e=Ze(),t=pm(),n=M(un),s=M(rt),i=M(oo),o=M(Vc),r=M(lH),l=M(Xn),c=M(cH),d=M(GD),u=M(dH),p=le(ni),m=le(ks),f=le(t?.stateApi.$isFiltering??Lp),g=le(t?.stateApi.$isTransforming??Lp),v=le(t?.stateApi.$isRasterizing??Lp),b=le(t?.stateApi.$isSegmenting??Lp),C=le(t?.compositor.$isBusy??Lp);h.useEffect(()=>{vje({tab:n,isConnected:m,canvas:s,params:i,refImages:o,dynamicPrompts:r,canvasIsFiltering:f,canvasIsTransforming:g,canvasIsRasterizing:v,canvasIsCompositing:C,canvasIsSelectingObject:b,nodes:l,workflowSettings:c,templates:p,upscale:d,loras:u,store:e})},[e,s,o,C,f,v,b,g,r,m,l,i,n,p,d,c,u])},T_=e=>({content:e("parameters.invoke.systemDisconnected")}),bje=e=>{const{isConnected:t,model:n,params:s,refImages:i,loras:o,dynamicPrompts:r}=e,{positivePrompt:l}=s,c=[];if(t||c.push(T_(at.t)),r.prompts.length===0&&A_(l)&&c.push({content:at.t("parameters.invoke.noPrompts")}),n||c.push({content:at.t("parameters.invoke.noModelSelected")}),n?.base==="flux"&&(s.t5EncoderModel||c.push({content:at.t("parameters.invoke.noT5EncoderModelSelected")}),s.clipEmbedModel||c.push({content:at.t("parameters.invoke.noCLIPEmbedModelSelected")}),s.fluxVAE||c.push({content:at.t("parameters.invoke.noFLUXVAEModelSelected")})),n?.base==="z-image"&&(s.zImageVaeModel!==null||s.zImageQwen3SourceModel!==null||c.push({content:at.t("parameters.invoke.noZImageVaeSourceSelected")}),s.zImageQwen3EncoderModel!==null||s.zImageQwen3SourceModel!==null||c.push({content:at.t("parameters.invoke.noZImageQwen3EncoderSourceSelected")})),n){for(const d of o.filter(({isEnabled:u})=>u===!0))if(n.base!==d.model.base){c.push({content:at.t("parameters.invoke.incompatibleLoRAs")});break}}return n&&uH.includes(n.base)&&i.entities.filter(({isEnabled:u})=>u).forEach((u,p)=>{const m=p+1,g=`${at.t(Rp.reference_image)} #${m}`,v=vu(u,n);if(v.length){const b=Cd(v.map(C=>at.t(C)).join(", "));c.push({prefix:g,content:b})}}),c},xje=async e=>{const{dispatch:t,nodesState:n,workflowSettingsState:s,isConnected:i,templates:o}=e,r=[];if(i||r.push(T_(at.t)),s.shouldValidateGraph){const{nodes:l,edges:c}=n,d=l.filter(eo),u=d.filter($w);d.filter(HG).length||r.push({content:at.t("parameters.invoke.noNodesInGraph")});for(const m of u)c.find(f=>f.source===m.id)===void 0&&r.push({content:at.t("parameters.invoke.batchNodeNotConnected",{label:m.data.label})});if(u.length>0){const m=[],f=$D(u,g=>g.data.inputs.batch_group_id?.value);for(const[g,v]of Object.entries(f)){const b=[];for(const C of v){const y=(await yd({dispatch:t,nodesState:n,node:C})).length;g==="None"?m.push(y):b.push(y)}b.some(C=>C!==b[0])&&r.push({content:at.t("parameters.invoke.batchNodeCollectionSizeMismatch",{batchGroupId:g})}),b[0]!==void 0&&m.push(b[0])}m.some(g=>g===0)&&r.push({content:at.t("parameters.invoke.batchNodeEmptyCollection")})}d.forEach(m=>{if(!eo(m))return;const f=pje(m.data.id,o,n);for(const g of f)g.type==="node-error"?r.push({content:g.issue}):r.push({prefix:g.prefix,content:g.issue})})}return r},Cje=e=>{const{isConnected:t,upscale:n,params:s,loras:i}=e,o=[];t||o.push(T_(at.t)),n.upscaleInitialImage||o.push({content:at.t("upscaling.missingUpscaleInitialImage")});const r=s.model;if(r&&!["sd-1","sdxl"].includes(r.base))o.push({content:at.t("upscaling.incompatibleBaseModel")});else if(r||o.push({content:at.t("parameters.invoke.noModelSelected")}),n.upscaleModel||o.push({content:at.t("upscaling.missingUpscaleModel")}),n.tileControlnetModel||o.push({content:at.t("upscaling.missingTileControlNetModel")}),r){for(const l of i.filter(({isEnabled:c})=>c===!0))if(r.base!==l.model.base){o.push({content:at.t("parameters.invoke.incompatibleLoRAs")});break}}return o},wje=e=>{const{isConnected:t,model:n,canvas:s,params:i,refImages:o,loras:r,dynamicPrompts:l,canvasIsFiltering:c,canvasIsTransforming:d,canvasIsRasterizing:u,canvasIsCompositing:p,canvasIsSelectingObject:m}=e,{positivePrompt:f}=i,g=[];if(t||g.push(T_(at.t)),c&&g.push({content:at.t("parameters.invoke.canvasIsFiltering")}),d&&g.push({content:at.t("parameters.invoke.canvasIsTransforming")}),u&&g.push({content:at.t("parameters.invoke.canvasIsRasterizing")}),p&&g.push({content:at.t("parameters.invoke.canvasIsCompositing")}),m&&g.push({content:at.t("parameters.invoke.canvasIsSelectingObject")}),l.prompts.length===0&&A_(f)&&g.push({content:at.t("parameters.invoke.noPrompts")}),n||g.push({content:at.t("parameters.invoke.noModelSelected")}),n?.base==="flux"){i.t5EncoderModel||g.push({content:at.t("parameters.invoke.noT5EncoderModelSelected")}),i.clipEmbedModel||g.push({content:at.t("parameters.invoke.noCLIPEmbedModelSelected")}),i.fluxVAE||g.push({content:at.t("parameters.invoke.noFLUXVAEModelSelected")});const{bbox:C}=s,y=z2("flux");C.scaleMethod==="none"?(C.rect.width%y!==0&&g.push({content:at.t("parameters.invoke.modelIncompatibleBboxWidth",{model:"FLUX",width:C.rect.width,multiple:y})}),C.rect.height%y!==0&&g.push({content:at.t("parameters.invoke.modelIncompatibleBboxHeight",{model:"FLUX",height:C.rect.height,multiple:y})})):(C.scaledSize.width%y!==0&&g.push({content:at.t("parameters.invoke.modelIncompatibleScaledBboxWidth",{model:"FLUX",width:C.scaledSize.width,multiple:y})}),C.scaledSize.height%y!==0&&g.push({content:at.t("parameters.invoke.modelIncompatibleScaledBboxHeight",{model:"FLUX",height:C.scaledSize.height,multiple:y})}))}if(n?.base==="cogview4"){const{bbox:C}=s,y=z2("cogview4");C.scaleMethod==="none"?(C.rect.width%y!==0&&g.push({content:at.t("parameters.invoke.modelIncompatibleBboxWidth",{model:"CogView4",width:C.rect.width,multiple:y})}),C.rect.height%y!==0&&g.push({content:at.t("parameters.invoke.modelIncompatibleBboxHeight",{model:"CogView4",height:C.rect.height,multiple:y})})):(C.scaledSize.width%y!==0&&g.push({content:at.t("parameters.invoke.modelIncompatibleScaledBboxWidth",{model:"CogView4",width:C.scaledSize.width,multiple:y})}),C.scaledSize.height%y!==0&&g.push({content:at.t("parameters.invoke.modelIncompatibleScaledBboxHeight",{model:"CogView4",height:C.scaledSize.height,multiple:y})}))}if(n?.base==="z-image"&&(i.zImageVaeModel!==null||i.zImageQwen3SourceModel!==null||g.push({content:at.t("parameters.invoke.noZImageVaeSourceSelected")}),i.zImageQwen3EncoderModel!==null||i.zImageQwen3SourceModel!==null||g.push({content:at.t("parameters.invoke.noZImageQwen3EncoderSourceSelected")})),n){for(const C of r.filter(({isEnabled:y})=>y===!0))if(n.base!==C.model.base){g.push({content:at.t("parameters.invoke.incompatibleLoRAs")});break}}const v=s.controlLayers.entities.filter(C=>C.isEnabled),b=v.filter(C=>C.controlAdapter?.model?.type==="control_lora").length;return n?.base==="flux"&&b>1&&g.push({content:at.t("parameters.invoke.fluxModelMultipleControlLoRAs")}),v.forEach((C,y)=>{const x=at.t("controlLayers.layer_one"),w=y+1,_=at.t(Rp.control_layer),S=`${x} #${w} (${_})`,I=e1(C,n);if(I.length){const k=Cd(I.map(E=>at.t(E)).join(", "));g.push({prefix:S,content:k})}}),n&&uH.includes(n.base)&&o.entities.filter(({isEnabled:y})=>y).forEach((y,x)=>{const w=x+1,S=`${at.t(Rp.reference_image)} #${w}`,I=vu(y,n);if(I.length){const k=Cd(I.map(E=>at.t(E)).join(", "));g.push({prefix:S,content:k})}}),s.regionalGuidance.entities.filter(C=>C.isEnabled).forEach((C,y)=>{const x=at.t("controlLayers.layer_one"),w=y+1,_=at.t(Rp[C.type]),S=`${x} #${w} (${_})`,I=r4(C,n);if(I.length){const k=Cd(I.map(E=>at.t(E)).join(", "));g.push({prefix:S,content:k})}}),s.rasterLayers.entities.filter(C=>C.isEnabled).forEach((C,y)=>{const x=at.t("controlLayers.layer_one"),w=y+1,_=at.t(Rp[C.type]),S=`${x} #${w} (${_})`,I=EK();if(I.length){const k=Cd(I.map(E=>at.t(E)).join(", "));g.push({prefix:S,content:k})}}),s.inpaintMasks.entities.filter(C=>C.isEnabled).forEach((C,y)=>{const x=at.t("controlLayers.layer_one"),w=y+1,_=at.t(Rp[C.type]),S=`${x} #${w} (${_})`,I=AK();if(I.length){const k=Cd(I.map(E=>at.t(E)).join(", "));g.push({prefix:S,content:k})}}),g},_je=ve(oo,lH,(e,t)=>A_(e.positivePrompt)?t.prompts.length:1),TK=()=>{let e,t;return{promise:new Promise((s,i)=>{e=s,t=i}),resolve:e,reject:t}};class DK{}class Fd extends DK{constructor(t,n,s){super(),this.viewId=t,this.groupId=n,this.panelId=s}}class ev extends DK{constructor(t,n){super(),this.viewId=t,this.paneId=n}}class Wl{constructor(){}static getInstance(){return Wl.INSTANCE}hasData(t){return t&&t===this.proto}clearData(t){this.hasData(t)&&(this.proto=void 0,this.data=void 0)}getData(t){if(this.hasData(t))return this.data}setData(t,n){n&&(this.data=t,this.proto=n)}}Wl.INSTANCE=new Wl;function Wi(){const e=Wl.getInstance();if(e.hasData(Fd.prototype))return e.getData(Fd.prototype)[0]}function dg(){const e=Wl.getInstance();if(e.hasData(ev.prototype))return e.getData(ev.prototype)[0]}var ch;(function(e){e.any=(...t)=>n=>{const s=t.map(i=>i(n));return{dispose:()=>{s.forEach(i=>{i.dispose()})}}}})(ch||(ch={}));class l4{constructor(){this._defaultPrevented=!1}get defaultPrevented(){return this._defaultPrevented}preventDefault(){this._defaultPrevented=!0}}class MK{constructor(){this._isAccepted=!1}get isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}}class Sje{constructor(){this.events=new Map}get size(){return this.events.size}add(t,n){this.events.set(t,n)}delete(t){this.events.delete(t)}clear(){this.events.clear()}}class Q2{static create(){var t;return new Q2((t=new Error().stack)!==null&&t!==void 0?t:"")}constructor(t){this.value=t}print(){console.warn("dockview: stacktrace",this.value)}}class kje{constructor(t,n){this.callback=t,this.stacktrace=n}}let Ce=class fl{static setLeakageMonitorEnabled(t){t!==fl.ENABLE_TRACKING&&fl.MEMORY_LEAK_WATCHER.clear(),fl.ENABLE_TRACKING=t}get value(){return this._last}constructor(t){this.options=t,this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=t=>{var n;!((n=this.options)===null||n===void 0)&&n.replay&&this._last!==void 0&&t(this._last);const s=new kje(t,fl.ENABLE_TRACKING?Q2.create():void 0);return this._listeners.push(s),{dispose:()=>{const i=this._listeners.indexOf(s);i>-1&&this._listeners.splice(i,1)}}},fl.ENABLE_TRACKING&&fl.MEMORY_LEAK_WATCHER.add(this._event,Q2.create())),this._event}fire(t){var n;!((n=this.options)===null||n===void 0)&&n.replay&&(this._last=t);for(const s of this._listeners)s.callback(t)}dispose(){this._disposed||(this._disposed=!0,this._listeners.length>0&&(fl.ENABLE_TRACKING&&queueMicrotask(()=>{var t;for(const n of this._listeners)console.warn("dockview: stacktrace",(t=n.stacktrace)===null||t===void 0?void 0:t.print())}),this._listeners=[]),fl.ENABLE_TRACKING&&this._event&&fl.MEMORY_LEAK_WATCHER.delete(this._event))}};Ce.ENABLE_TRACKING=!1;Ce.MEMORY_LEAK_WATCHER=new Sje;function Vt(e,t,n,s){return e.addEventListener(t,n,s),{dispose:()=>{e.removeEventListener(t,n,s)}}}class MR{constructor(){this._onFired=new Ce,this._currentFireCount=0,this._queued=!1,this.onEvent=t=>{const n=this._currentFireCount;return this._onFired.event(()=>{this._currentFireCount>n&&t()})}}fire(){this._currentFireCount++,!this._queued&&(this._queued=!0,queueMicrotask(()=>{this._queued=!1,this._onFired.fire()}))}dispose(){this._onFired.dispose()}}var Bs;(function(e){e.NONE={dispose:()=>{}};function t(n){return{dispose:()=>{n()}}}e.from=t})(Bs||(Bs={}));class jt{get isDisposed(){return this._isDisposed}constructor(...t){this._isDisposed=!1,this._disposables=t}addDisposables(...t){t.forEach(n=>this._disposables.push(n))}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposables.forEach(t=>t.dispose()),this._disposables=[])}}class so{constructor(){this._disposable=Bs.NONE}set value(t){this._disposable&&this._disposable.dispose(),this._disposable=t}dispose(){this._disposable&&(this._disposable.dispose(),this._disposable=Bs.NONE)}}class Ije extends jt{constructor(t){super(),this._onDidChange=new Ce,this.onDidChange=this._onDidChange.event,this._value=null,this.addDisposables(this._onDidChange,D_(t,n=>{const s=n.target.scrollWidth>n.target.clientWidth,i=n.target.scrollHeight>n.target.clientHeight;this._value={hasScrollX:s,hasScrollY:i},this._onDidChange.fire(this._value)}))}}function D_(e,t){const n=new ResizeObserver(s=>{requestAnimationFrame(()=>{const i=s[0];t(i)})});return n.observe(e),{dispose:()=>{n.unobserve(e),n.disconnect()}}}const Nv=(e,...t)=>{for(const n of t)e.classList.contains(n)&&e.classList.remove(n)},M_=(e,...t)=>{for(const n of t)e.classList.contains(n)||e.classList.add(n)},wt=(e,t,n)=>{const s=e.classList.contains(t);n&&!s&&e.classList.add(t),!n&&s&&e.classList.remove(t)};function uP(e,t){for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function LK(e){return new jje(e)}class jje extends jt{constructor(t){super(),this._onDidFocus=new Ce,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new Ce,this.onDidBlur=this._onDidBlur.event,this.addDisposables(this._onDidFocus,this._onDidBlur);let n=uP(document.activeElement,t),s=!1;const i=()=>{s=!1,n||(n=!0,this._onDidFocus.fire())},o=()=>{n&&(s=!0,window.setTimeout(()=>{s&&(s=!1,n=!1,this._onDidBlur.fire())},0))};this._refreshStateHandler=()=>{uP(document.activeElement,t)!==n&&(n?o():i())},this.addDisposables(Vt(t,"focus",i,!0)),this.addDisposables(Vt(t,"blur",o,!0))}refreshState(){this._refreshStateHandler()}}const RK="dv-quasiPreventDefault";function Eje(e){e[RK]=!0}function LR(e){return e[RK]}function Aje(e,t){const n=Array.from(t);for(const s of n){if(s.href){const o=e.createElement("link");o.href=s.href,o.type=s.type,o.rel="stylesheet",e.head.appendChild(o)}let i=[];try{s.cssRules&&(i=Array.from(s.cssRules).map(o=>o.cssText))}catch{}for(const o of i){const r=e.createElement("style");r.appendChild(e.createTextNode(o)),e.head.appendChild(r)}}}function hP(e){const{left:t,top:n,width:s,height:i}=e.getBoundingClientRect();return{left:t+window.scrollX,top:n+window.scrollY,width:s,height:i}}function Pje(e){let t=e;for(;t?.parentNode;){if(t.parentNode===document)return!0;t.parentNode instanceof DocumentFragment?t=t.parentNode.host:t=t.parentNode}return!1}function Tje(e,t){e.setAttribute("data-testid",t)}function Dje(e){const t=[];function n(s){if(s.nodeType===Node.ELEMENT_NODE){e.includes(s.tagName)&&t.push(s),s.shadowRoot&&n(s.shadowRoot);for(const i of s.children)n(i)}}return n(document.documentElement),t}function J2(e=document){const t=Dje(["IFRAME","WEBVIEW"]),n=new WeakMap;for(const s of t)n.set(s,s.style.pointerEvents),s.style.pointerEvents="none";return{release:()=>{var s;for(const i of t)i.style.pointerEvents=(s=n.get(i))!==null&&s!==void 0?s:"auto";t.splice(0,t.length)}}}function Mje(e){function t(i){const o=[];for(let r=0;r<i.classList.length;r++)o.push(i.classList.item(r));return o}let n,s=e;for(;s!==null&&(n=t(s).find(i=>i.startsWith("dockview-theme-")),typeof n!="string");)s=s.parentElement;return n}class L_{constructor(t){this.element=t,this._classNames=[]}setClassNames(t){for(const n of this._classNames)wt(this.element,n,!1);this._classNames=t.split(" ").filter(n=>n.trim().length>0);for(const n of this._classNames)wt(this.element,n,!0)}}const OK=100;function Lje(e,t){const n=hP(e),s=hP(t);return!(n.left<s.left||n.left+n.width>s.left+s.width)}function Rje(e){const t=new Ce;let n=e.screenX,s=e.screenY,i;const o=()=>{if(e.closed)return;const r=e.screenX,l=e.screenY;(r!==n||l!==s)&&(clearTimeout(i),i=setTimeout(()=>{t.fire()},OK),n=r,s=l),requestAnimationFrame(o)};return o(),t}function Oje(e,t){let n;return new jt(Vt(e,"resize",()=>{clearTimeout(n),n=setTimeout(()=>{t()},OK)}))}function Nje(e,t,n={buffer:10}){const s=n.buffer,i=e.getBoundingClientRect(),o=t.getBoundingClientRect();let r=0,l=0;const c=i.left-o.left,d=i.top-o.top,u=i.bottom-o.bottom,p=i.right-o.right;c<s?r=s-c:p>s&&(r=-s-p),d<s?l=s-d:u>s&&(l=-u-s),(r!==0||l!==0)&&(e.style.transform=`translate(${r}px, ${l}px)`)}function Fje(e){let t=e;for(;t&&(t.style.zIndex==="auto"||t.style.zIndex==="");)t=t.parentElement;return t}function Tc(e){if(e.length===0)throw new Error("Invalid tail call");return[e.slice(0,e.length-1),e[e.length-1]]}function NK(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function dI(e,t){const n=e.indexOf(t);n>-1&&(e.splice(n,1),e.unshift(t))}function Db(e,t){const n=e.indexOf(t);n>-1&&(e.splice(n,1),e.push(t))}function Bje(e,t){for(let n=0;n<e.length;n++){const s=e[n];if(t(s))return n}return-1}function uI(e,t){const n=e.findIndex(s=>s===t);return n>-1?(e.splice(n,1),!0):!1}const es=(e,t,n)=>t>n?t:Math.min(n,Math.max(e,t)),c4=()=>{let e=1;return{next:()=>(e++).toString()}},br=(e,t)=>{const n=[];if(typeof t!="number"&&(t=e,e=0),e<=t)for(let s=e;s<t;s++)n.push(s);else for(let s=e;s>t;s--)n.push(s);return n};class zje{set size(t){this._size=t}get size(){return this._size}get cachedVisibleSize(){return this._cachedVisibleSize}get visible(){return typeof this._cachedVisibleSize>"u"}get minimumSize(){return this.visible?this.view.minimumSize:0}get viewMinimumSize(){return this.view.minimumSize}get maximumSize(){return this.visible?this.view.maximumSize:0}get viewMaximumSize(){return this.view.maximumSize}get priority(){return this.view.priority}get snap(){return!!this.view.snap}set enabled(t){this.container.style.pointerEvents=t?"":"none"}constructor(t,n,s,i){this.container=t,this.view=n,this.disposable=i,this._cachedVisibleSize=void 0,typeof s=="number"?(this._size=s,this._cachedVisibleSize=void 0,t.classList.add("visible")):(this._size=0,this._cachedVisibleSize=s.cachedVisibleSize)}setVisible(t,n){var s;t!==this.visible&&(t?(this.size=es((s=this._cachedVisibleSize)!==null&&s!==void 0?s:0,this.viewMinimumSize,this.viewMaximumSize),this._cachedVisibleSize=void 0):(this._cachedVisibleSize=typeof n=="number"?n:this.size,this.size=0),this.container.classList.toggle("visible",t),this.view.setVisible&&this.view.setVisible(t))}dispose(){return this.disposable.dispose(),this.view}}var Ke;(function(e){e.HORIZONTAL="HORIZONTAL",e.VERTICAL="VERTICAL"})(Ke||(Ke={}));var Ra;(function(e){e[e.MAXIMUM=0]="MAXIMUM",e[e.MINIMUM=1]="MINIMUM",e[e.DISABLED=2]="DISABLED",e[e.ENABLED=3]="ENABLED"})(Ra||(Ra={}));var Hn;(function(e){e.Low="low",e.High="high",e.Normal="normal"})(Hn||(Hn={}));var Wa;(function(e){e.Distribute={type:"distribute"};function t(s){return{type:"split",index:s}}e.Split=t;function n(s){return{type:"invisible",cachedVisibleSize:s}}e.Invisible=n})(Wa||(Wa={}));class Fv{get contentSize(){return this._contentSize}get size(){return this._size}set size(t){this._size=t}get orthogonalSize(){return this._orthogonalSize}set orthogonalSize(t){this._orthogonalSize=t}get length(){return this.viewItems.length}get proportions(){return this._proportions?[...this._proportions]:void 0}get orientation(){return this._orientation}set orientation(t){this._orientation=t;const n=this.size;this.size=this.orthogonalSize,this.orthogonalSize=n,Nv(this.element,"dv-horizontal","dv-vertical"),this.element.classList.add(this.orientation==Ke.HORIZONTAL?"dv-horizontal":"dv-vertical")}get minimumSize(){return this.viewItems.reduce((t,n)=>t+n.minimumSize,0)}get maximumSize(){return this.length===0?Number.POSITIVE_INFINITY:this.viewItems.reduce((t,n)=>t+n.maximumSize,0)}get startSnappingEnabled(){return this._startSnappingEnabled}set startSnappingEnabled(t){this._startSnappingEnabled!==t&&(this._startSnappingEnabled=t,this.updateSashEnablement())}get endSnappingEnabled(){return this._endSnappingEnabled}set endSnappingEnabled(t){this._endSnappingEnabled!==t&&(this._endSnappingEnabled=t,this.updateSashEnablement())}get disabled(){return this._disabled}set disabled(t){this._disabled=t,wt(this.element,"dv-splitview-disabled",t)}get margin(){return this._margin}set margin(t){this._margin=t,wt(this.element,"dv-splitview-has-margin",t!==0)}constructor(t,n){var s,i;this.container=t,this.viewItems=[],this.sashes=[],this._size=0,this._orthogonalSize=0,this._contentSize=0,this._proportions=void 0,this._startSnappingEnabled=!0,this._endSnappingEnabled=!0,this._disabled=!1,this._margin=0,this._onDidSashEnd=new Ce,this.onDidSashEnd=this._onDidSashEnd.event,this._onDidAddView=new Ce,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new Ce,this.onDidRemoveView=this._onDidRemoveView.event,this.resize=(o,r,l=this.viewItems.map(g=>g.size),c,d,u=Number.NEGATIVE_INFINITY,p=Number.POSITIVE_INFINITY,m,f)=>{if(o<0||o>this.viewItems.length)return 0;const g=br(o,-1),v=br(o+1,this.viewItems.length);if(d)for(const F of d)dI(g,F),dI(v,F);if(c)for(const F of c)Db(g,F),Db(v,F);const b=g.map(F=>this.viewItems[F]),C=g.map(F=>l[F]),y=v.map(F=>this.viewItems[F]),x=v.map(F=>l[F]),w=g.reduce((F,X)=>F+this.viewItems[X].minimumSize-l[X],0),_=g.reduce((F,X)=>F+this.viewItems[X].maximumSize-l[X],0),S=v.length===0?Number.POSITIVE_INFINITY:v.reduce((F,X)=>F+l[X]-this.viewItems[X].minimumSize,0),I=v.length===0?Number.NEGATIVE_INFINITY:v.reduce((F,X)=>F+l[X]-this.viewItems[X].maximumSize,0),k=Math.max(w,I),E=Math.min(S,_);let j=!1;if(m){const F=this.viewItems[m.index],X=r>=m.limitDelta;j=X!==F.visible,F.setVisible(X,m.size)}if(!j&&f){const F=this.viewItems[f.index],X=r<f.limitDelta;j=X!==F.visible,F.setVisible(X,f.size)}if(j)return this.resize(o,r,l,c,d,u,p);const P=es(r,k,E);let D=0,O=P;for(let F=0;F<b.length;F++){const X=b[F],L=es(C[F]+O,X.minimumSize,X.maximumSize),V=L-C[F];D+=V,O-=V,X.size=L}let N=D;for(let F=0;F<y.length;F++){const X=y[F],L=es(x[F]-N,X.minimumSize,X.maximumSize),V=L-x[F];N+=V,X.size=L}return r},this._orientation=(s=n.orientation)!==null&&s!==void 0?s:Ke.VERTICAL,this.element=this.createContainer(),this.margin=(i=n.margin)!==null&&i!==void 0?i:0,this.proportionalLayout=n.proportionalLayout===void 0?!0:!!n.proportionalLayout,this.viewContainer=this.createViewContainer(),this.sashContainer=this.createSashContainer(),this.element.appendChild(this.sashContainer),this.element.appendChild(this.viewContainer),this.container.appendChild(this.element),this.style(n.styles),n.descriptor&&(this._size=n.descriptor.size,n.descriptor.views.forEach((o,r)=>{const l=o.visible===void 0||o.visible?o.size:{type:"invisible",cachedVisibleSize:o.size},c=o.view;this.addView(c,l,r,!0)}),this._contentSize=this.viewItems.reduce((o,r)=>o+r.size,0),this.saveProportions())}style(t){t?.separatorBorder==="transparent"?(Nv(this.element,"dv-separator-border"),this.element.style.removeProperty("--dv-separator-border")):(M_(this.element,"dv-separator-border"),t?.separatorBorder&&this.element.style.setProperty("--dv-separator-border",t.separatorBorder))}isViewVisible(t){if(t<0||t>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[t].visible}setViewVisible(t,n){if(t<0||t>=this.viewItems.length)throw new Error("Index out of bounds");const s=this.viewItems[t];s.setVisible(n,s.size),this.distributeEmptySpace(t),this.layoutViews(),this.saveProportions()}getViewSize(t){return t<0||t>=this.viewItems.length?-1:this.viewItems[t].size}resizeView(t,n){if(t<0||t>=this.viewItems.length)return;const s=br(this.viewItems.length).filter(l=>l!==t),i=[...s.filter(l=>this.viewItems[l].priority===Hn.Low),t],o=s.filter(l=>this.viewItems[l].priority===Hn.High),r=this.viewItems[t];n=Math.round(n),n=es(n,r.minimumSize,Math.min(r.maximumSize,this._size)),r.size=n,this.relayout(i,o)}getViews(){return this.viewItems.map(t=>t.view)}onDidChange(t,n){const s=this.viewItems.indexOf(t);if(s<0||s>=this.viewItems.length)return;n=typeof n=="number"?n:t.size,n=es(n,t.minimumSize,t.maximumSize),t.size=n;const i=br(this.viewItems.length).filter(l=>l!==s),o=[...i.filter(l=>this.viewItems[l].priority===Hn.Low),s],r=i.filter(l=>this.viewItems[l].priority===Hn.High);this.relayout([...o,s],r)}addView(t,n={type:"distribute"},s=this.viewItems.length,i){const o=document.createElement("div");o.className="dv-view",o.appendChild(t.element);let r;typeof n=="number"?r=n:n.type==="split"?r=this.getViewSize(n.index)/2:n.type==="invisible"?r={cachedVisibleSize:n.cachedVisibleSize}:r=t.minimumSize;const l=t.onDidChange(d=>this.onDidChange(c,d.size)),c=new zje(o,t,r,{dispose:()=>{l.dispose(),this.viewContainer.removeChild(o)}});if(s===this.viewItems.length?this.viewContainer.appendChild(o):this.viewContainer.insertBefore(o,this.viewContainer.children.item(s)),this.viewItems.splice(s,0,c),this.viewItems.length>1){const d=document.createElement("div");d.className="dv-sash";const u=m=>{for(const F of this.viewItems)F.enabled=!1;const f=J2(),g=this._orientation===Ke.HORIZONTAL?m.clientX:m.clientY,v=Bje(this.sashes,F=>F.container===d),b=this.viewItems.map(F=>F.size);let C,y;const x=br(v,-1),w=br(v+1,this.viewItems.length),_=x.reduce((F,X)=>F+(this.viewItems[X].minimumSize-b[X]),0),S=x.reduce((F,X)=>F+(this.viewItems[X].viewMaximumSize-b[X]),0),I=w.length===0?Number.POSITIVE_INFINITY:w.reduce((F,X)=>F+(b[X]-this.viewItems[X].minimumSize),0),k=w.length===0?Number.NEGATIVE_INFINITY:w.reduce((F,X)=>F+(b[X]-this.viewItems[X].viewMaximumSize),0),E=Math.max(_,k),j=Math.min(I,S),P=this.findFirstSnapIndex(x),D=this.findFirstSnapIndex(w);if(typeof P=="number"){const F=this.viewItems[P],X=Math.floor(F.viewMinimumSize/2);C={index:P,limitDelta:F.visible?E-X:E+X,size:F.size}}if(typeof D=="number"){const F=this.viewItems[D],X=Math.floor(F.viewMinimumSize/2);y={index:D,limitDelta:F.visible?j+X:j-X,size:F.size}}const O=F=>{const L=(this._orientation===Ke.HORIZONTAL?F.clientX:F.clientY)-g;this.resize(v,L,b,void 0,void 0,E,j,C,y),this.distributeEmptySpace(),this.layoutViews()},N=()=>{for(const F of this.viewItems)F.enabled=!0;f.release(),this.saveProportions(),document.removeEventListener("pointermove",O),document.removeEventListener("pointerup",N),document.removeEventListener("pointercancel",N),this._onDidSashEnd.fire(void 0)};document.addEventListener("pointermove",O),document.addEventListener("pointerup",N),document.addEventListener("pointercancel",N)};d.addEventListener("pointerdown",u);const p={container:d,disposable:()=>{d.removeEventListener("pointerdown",u),this.sashContainer.removeChild(d)}};this.sashContainer.appendChild(d),this.sashes.push(p)}i||this.relayout([s]),!i&&typeof n!="number"&&n.type==="distribute"&&this.distributeViewSizes(),this._onDidAddView.fire(t)}distributeViewSizes(){const t=[];let n=0;for(const l of this.viewItems)l.maximumSize-l.minimumSize>0&&(t.push(l),n+=l.size);const s=Math.floor(n/t.length);for(const l of t)l.size=es(s,l.minimumSize,l.maximumSize);const i=br(this.viewItems.length),o=i.filter(l=>this.viewItems[l].priority===Hn.Low),r=i.filter(l=>this.viewItems[l].priority===Hn.High);this.relayout(o,r)}removeView(t,n,s=!1){const i=this.viewItems.splice(t,1)[0];if(i.dispose(),this.viewItems.length>=1){const o=Math.max(t-1,0);this.sashes.splice(o,1)[0].disposable()}return s||this.relayout(),n&&n.type==="distribute"&&this.distributeViewSizes(),this._onDidRemoveView.fire(i.view),i.view}getViewCachedVisibleSize(t){if(t<0||t>=this.viewItems.length)throw new Error("Index out of bounds");return this.viewItems[t].cachedVisibleSize}moveView(t,n){const s=this.getViewCachedVisibleSize(t),i=typeof s>"u"?this.getViewSize(t):Wa.Invisible(s),o=this.removeView(t,void 0,!0);this.addView(o,i,n)}layout(t,n){const s=Math.max(this.size,this._contentSize);if(this.size=t,this.orthogonalSize=n,this.proportions){let i=0;for(let o=0;o<this.viewItems.length;o++){const r=this.viewItems[o],l=this.proportions[o];typeof l=="number"?i+=l:t-=r.size}for(let o=0;o<this.viewItems.length;o++){const r=this.viewItems[o],l=this.proportions[o];typeof l=="number"&&i>0&&(r.size=es(Math.round(l*t/i),r.minimumSize,r.maximumSize))}}else{const i=br(this.viewItems.length),o=i.filter(l=>this.viewItems[l].priority===Hn.Low),r=i.filter(l=>this.viewItems[l].priority===Hn.High);this.resize(this.viewItems.length-1,t-s,void 0,o,r)}this.distributeEmptySpace(),this.layoutViews()}relayout(t,n){const s=this.viewItems.reduce((i,o)=>i+o.size,0);this.resize(this.viewItems.length-1,this._size-s,void 0,t,n),this.distributeEmptySpace(),this.layoutViews(),this.saveProportions()}distributeEmptySpace(t){const n=this.viewItems.reduce((l,c)=>l+c.size,0);let s=this.size-n;const i=br(this.viewItems.length-1,-1),o=i.filter(l=>this.viewItems[l].priority===Hn.Low),r=i.filter(l=>this.viewItems[l].priority===Hn.High);for(const l of r)dI(i,l);for(const l of o)Db(i,l);typeof t=="number"&&Db(i,t);for(let l=0;s!==0&&l<i.length;l++){const c=this.viewItems[i[l]],d=es(c.size+s,c.minimumSize,c.maximumSize),u=d-c.size;s-=u,c.size=d}}saveProportions(){this.proportionalLayout&&this._contentSize>0&&(this._proportions=this.viewItems.map(t=>t.visible?t.size/this._contentSize:void 0))}layoutViews(){if(this._contentSize=this.viewItems.reduce((c,d)=>c+d.size,0),this.updateSashEnablement(),this.viewItems.length===0)return;const t=this.viewItems.filter(c=>c.visible),n=Math.max(0,t.length-1),s=this.margin*n/Math.max(1,t.length);let i=0;const o=[],r=4,l=this.viewItems.reduce((c,d,u)=>{const p=d.visible?1:0;return u===0?c.push(p):c.push(c[u-1]+p),c},[]);this.viewItems.forEach((c,d)=>{i+=this.viewItems[d].size,o.push(i);const u=c.visible?c.size-s:0,p=Math.max(0,l[d]-1),m=d===0||p===0?0:o[d-1]+p/n*s;if(d<this.viewItems.length-1){const f=c.visible?m+u-r/2+this.margin/2:m;this._orientation===Ke.HORIZONTAL&&(this.sashes[d].container.style.left=`${f}px`,this.sashes[d].container.style.top="0px"),this._orientation===Ke.VERTICAL&&(this.sashes[d].container.style.left="0px",this.sashes[d].container.style.top=`${f}px`)}this._orientation===Ke.HORIZONTAL&&(c.container.style.width=`${u}px`,c.container.style.left=`${m}px`,c.container.style.top="",c.container.style.height=""),this._orientation===Ke.VERTICAL&&(c.container.style.height=`${u}px`,c.container.style.top=`${m}px`,c.container.style.width="",c.container.style.left=""),c.view.layout(c.size-s,this._orthogonalSize)})}findFirstSnapIndex(t){for(const n of t){const s=this.viewItems[n];if(s.visible&&s.snap)return n}for(const n of t){const s=this.viewItems[n];if(s.visible&&s.maximumSize-s.minimumSize>0)return;if(!s.visible&&s.snap)return n}}updateSashEnablement(){let t=!1;const n=this.viewItems.map(c=>t=c.size-c.minimumSize>0||t);t=!1;const s=this.viewItems.map(c=>t=c.maximumSize-c.size>0||t),i=[...this.viewItems].reverse();t=!1;const o=i.map(c=>t=c.size-c.minimumSize>0||t).reverse();t=!1;const r=i.map(c=>t=c.maximumSize-c.size>0||t).reverse();let l=0;for(let c=0;c<this.sashes.length;c++){const d=this.sashes[c],u=this.viewItems[c];l+=u.size;const p=!(n[c]&&r[c+1]),m=!(s[c]&&o[c+1]);if(p&&m){const f=br(c,-1),g=br(c+1,this.viewItems.length),v=this.findFirstSnapIndex(f),b=this.findFirstSnapIndex(g),C=typeof v=="number"&&!this.viewItems[v].visible,y=typeof b=="number"&&!this.viewItems[b].visible;C&&o[c]&&(l>0||this.startSnappingEnabled)?this.updateSash(d,Ra.MINIMUM):y&&n[c]&&(l<this._contentSize||this.endSnappingEnabled)?this.updateSash(d,Ra.MAXIMUM):this.updateSash(d,Ra.DISABLED)}else p&&!m?this.updateSash(d,Ra.MINIMUM):!p&&m?this.updateSash(d,Ra.MAXIMUM):this.updateSash(d,Ra.ENABLED)}}updateSash(t,n){wt(t.container,"dv-disabled",n===Ra.DISABLED),wt(t.container,"dv-enabled",n===Ra.ENABLED),wt(t.container,"dv-maximum",n===Ra.MAXIMUM),wt(t.container,"dv-minimum",n===Ra.MINIMUM)}createViewContainer(){const t=document.createElement("div");return t.className="dv-view-container",t}createSashContainer(){const t=document.createElement("div");return t.className="dv-sash-container",t}createContainer(){const t=document.createElement("div"),n=this._orientation===Ke.HORIZONTAL?"dv-horizontal":"dv-vertical";return t.className=`dv-split-view-container ${n}`,t}dispose(){this._onDidSashEnd.dispose(),this._onDidAddView.dispose(),this._onDidRemoveView.dispose();for(let t=0;t<this.element.children.length;t++)if(this.element.children.item(t)===this.element){this.element.removeChild(this.element);break}for(const t of this.viewItems)t.dispose();this.element.remove()}}const pP=Object.keys({orientation:void 0,descriptor:void 0,proportionalLayout:void 0,styles:void 0,margin:void 0,disableAutoResizing:void 0,className:void 0});class RR extends jt{get onDidAddView(){return this.splitview.onDidAddView}get onDidRemoveView(){return this.splitview.onDidRemoveView}get minimumSize(){return this.splitview.minimumSize}get maximumSize(){return this.splitview.maximumSize}get orientation(){return this.splitview.orientation}get size(){return this.splitview.size}get orthogonalSize(){return this.splitview.orthogonalSize}constructor(t,n){var s;super(),this.paneItems=[],this.skipAnimation=!1,this._onDidChange=new Ce,this.onDidChange=this._onDidChange.event,this._orientation=(s=n.orientation)!==null&&s!==void 0?s:Ke.VERTICAL,this.element=document.createElement("div"),this.element.className="dv-pane-container",t.appendChild(this.element),this.splitview=new Fv(this.element,{orientation:this._orientation,proportionalLayout:!1,descriptor:n.descriptor}),this.getPanes().forEach(i=>{const o=new jt(i.onDidChangeExpansionState(()=>{this.setupAnimation(),this._onDidChange.fire(void 0)})),r={pane:i,disposable:{dispose:()=>{o.dispose()}}};this.paneItems.push(r),i.orthogonalSize=this.splitview.orthogonalSize}),this.addDisposables(this._onDidChange,this.splitview.onDidSashEnd(()=>{this._onDidChange.fire(void 0)}),this.splitview.onDidAddView(()=>{this._onDidChange.fire()}),this.splitview.onDidRemoveView(()=>{this._onDidChange.fire()}))}setViewVisible(t,n){this.splitview.setViewVisible(t,n)}addPane(t,n,s=this.splitview.length,i=!1){const o=t.onDidChangeExpansionState(()=>{this.setupAnimation(),this._onDidChange.fire(void 0)}),r={pane:t,disposable:{dispose:()=>{o.dispose()}}};this.paneItems.splice(s,0,r),t.orthogonalSize=this.splitview.orthogonalSize,this.splitview.addView(t,n,s,i)}getViewSize(t){return this.splitview.getViewSize(t)}getPanes(){return this.splitview.getViews()}removePane(t,n={skipDispose:!1}){const s=this.paneItems.splice(t,1)[0];return this.splitview.removeView(t),n.skipDispose||(s.disposable.dispose(),s.pane.dispose()),s}moveView(t,n){if(t===n)return;const s=this.removePane(t,{skipDispose:!0});this.skipAnimation=!0;try{this.addPane(s.pane,s.pane.size,n,!1)}finally{this.skipAnimation=!1}}layout(t,n){this.splitview.layout(t,n)}setupAnimation(){this.skipAnimation||(this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=void 0),M_(this.element,"dv-animated"),this.animationTimer=setTimeout(()=>{this.animationTimer=void 0,Nv(this.element,"dv-animated")},200))}dispose(){super.dispose(),this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=void 0),this.paneItems.forEach(t=>{t.disposable.dispose(),t.pane.dispose()}),this.paneItems=[],this.splitview.dispose(),this.element.remove()}}class ii{get minimumWidth(){return this.view.minimumWidth}get maximumWidth(){return this.view.maximumWidth}get minimumHeight(){return this.view.minimumHeight}get maximumHeight(){return this.view.maximumHeight}get priority(){return this.view.priority}get snap(){return this.view.snap}get minimumSize(){return this.orientation===Ke.HORIZONTAL?this.minimumHeight:this.minimumWidth}get maximumSize(){return this.orientation===Ke.HORIZONTAL?this.maximumHeight:this.maximumWidth}get minimumOrthogonalSize(){return this.orientation===Ke.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maximumOrthogonalSize(){return this.orientation===Ke.HORIZONTAL?this.maximumWidth:this.maximumHeight}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get element(){return this.view.element}get width(){return this.orientation===Ke.HORIZONTAL?this.orthogonalSize:this.size}get height(){return this.orientation===Ke.HORIZONTAL?this.size:this.orthogonalSize}constructor(t,n,s,i=0){this.view=t,this.orientation=n,this._onDidChange=new Ce,this.onDidChange=this._onDidChange.event,this._orthogonalSize=s,this._size=i,this._disposable=this.view.onDidChange(o=>{o?this._onDidChange.fire({size:this.orientation===Ke.VERTICAL?o.width:o.height,orthogonalSize:this.orientation===Ke.VERTICAL?o.height:o.width}):this._onDidChange.fire({})})}setVisible(t){this.view.setVisible&&this.view.setVisible(t)}layout(t,n){this._size=t,this._orthogonalSize=n,this.view.layout(this.width,this.height)}dispose(){this._onDidChange.dispose(),this._disposable.dispose()}}class bs extends jt{get width(){return this.orientation===Ke.HORIZONTAL?this.size:this.orthogonalSize}get height(){return this.orientation===Ke.HORIZONTAL?this.orthogonalSize:this.size}get minimumSize(){return this.children.length===0?0:Math.max(...this.children.map((t,n)=>this.splitview.isViewVisible(n)?t.minimumOrthogonalSize:0))}get maximumSize(){return Math.min(...this.children.map((t,n)=>this.splitview.isViewVisible(n)?t.maximumOrthogonalSize:Number.POSITIVE_INFINITY))}get minimumOrthogonalSize(){return this.splitview.minimumSize}get maximumOrthogonalSize(){return this.splitview.maximumSize}get orthogonalSize(){return this._orthogonalSize}get size(){return this._size}get minimumWidth(){return this.orientation===Ke.HORIZONTAL?this.minimumOrthogonalSize:this.minimumSize}get minimumHeight(){return this.orientation===Ke.HORIZONTAL?this.minimumSize:this.minimumOrthogonalSize}get maximumWidth(){return this.orientation===Ke.HORIZONTAL?this.maximumOrthogonalSize:this.maximumSize}get maximumHeight(){return this.orientation===Ke.HORIZONTAL?this.maximumSize:this.maximumOrthogonalSize}get priority(){if(this.children.length===0)return Hn.Normal;const t=this.children.map(n=>typeof n.priority>"u"?Hn.Normal:n.priority);return t.some(n=>n===Hn.High)?Hn.High:t.some(n=>n===Hn.Low)?Hn.Low:Hn.Normal}get disabled(){return this.splitview.disabled}set disabled(t){this.splitview.disabled=t}get margin(){return this.splitview.margin}set margin(t){this.splitview.margin=t,this.children.forEach(n=>{n instanceof bs&&(n.margin=t)})}constructor(t,n,s,i,o,r,l,c){if(super(),this.orientation=t,this.proportionalLayout=n,this.styles=s,this._childrenDisposable=Bs.NONE,this.children=[],this._onDidChange=new Ce,this.onDidChange=this._onDidChange.event,this._onDidVisibilityChange=new Ce,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._orthogonalSize=o,this._size=i,this.element=document.createElement("div"),this.element.className="dv-branch-node",!c)this.splitview=new Fv(this.element,{orientation:this.orientation,proportionalLayout:n,styles:s,margin:l}),this.splitview.layout(this.size,this.orthogonalSize);else{const d={views:c.map(u=>({view:u.node,size:u.node.size,visible:u.node instanceof ii&&u.visible!==void 0?u.visible:!0})),size:this.orthogonalSize};this.children=c.map(u=>u.node),this.splitview=new Fv(this.element,{orientation:this.orientation,descriptor:d,proportionalLayout:n,styles:s,margin:l})}this.disabled=r,this.addDisposables(this._onDidChange,this._onDidVisibilityChange,this.splitview.onDidSashEnd(()=>{this._onDidChange.fire({})})),this.setupChildrenEvents()}setVisible(t){}isChildVisible(t){if(t<0||t>=this.children.length)throw new Error("Invalid index");return this.splitview.isViewVisible(t)}setChildVisible(t,n){if(t<0||t>=this.children.length)throw new Error("Invalid index");if(this.splitview.isViewVisible(t)===n)return;const s=this.splitview.contentSize===0;this.splitview.setViewVisible(t,n);const i=this.splitview.contentSize===0;(n&&s||!n&&i)&&this._onDidVisibilityChange.fire({visible:n})}moveChild(t,n){if(t===n)return;if(t<0||t>=this.children.length)throw new Error("Invalid from index");t<n&&n--,this.splitview.moveView(t,n);const s=this._removeChild(t);this._addChild(s,n)}getChildSize(t){if(t<0||t>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewSize(t)}resizeChild(t,n){if(t<0||t>=this.children.length)throw new Error("Invalid index");this.splitview.resizeView(t,n)}layout(t,n){this._size=n,this._orthogonalSize=t,this.splitview.layout(n,t)}addChild(t,n,s,i){if(s<0||s>this.children.length)throw new Error("Invalid index");this.splitview.addView(t,n,s,i),this._addChild(t,s)}getChildCachedVisibleSize(t){if(t<0||t>=this.children.length)throw new Error("Invalid index");return this.splitview.getViewCachedVisibleSize(t)}removeChild(t,n){if(t<0||t>=this.children.length)throw new Error("Invalid index");return this.splitview.removeView(t,n),this._removeChild(t)}_addChild(t,n){this.children.splice(n,0,t),this.setupChildrenEvents()}_removeChild(t){const[n]=this.children.splice(t,1);return this.setupChildrenEvents(),n}setupChildrenEvents(){this._childrenDisposable.dispose(),this._childrenDisposable=new jt(ch.any(...this.children.map(t=>t.onDidChange))(t=>{this._onDidChange.fire({size:t.orthogonalSize})}),...this.children.map((t,n)=>t instanceof bs?t.onDidVisibilityChange(({visible:s})=>{this.setChildVisible(n,s)}):Bs.NONE))}dispose(){this._childrenDisposable.dispose(),this.splitview.dispose(),this.children.forEach(t=>t.dispose()),super.dispose()}}function fP(e,t){if(e instanceof ii)return e;if(e instanceof bs)return fP(e.children[t?e.children.length-1:0],t);throw new Error("invalid node")}function FK(e,t,n){if(e instanceof bs){const s=new bs(e.orientation,e.proportionalLayout,e.styles,t,n,e.disabled,e.margin);for(let i=e.children.length-1;i>=0;i--){const o=e.children[i];s.addChild(FK(o,o.size,o.orthogonalSize),o.size,0,!0)}return s}else return new ii(e.view,e.orientation,n)}function mP(e,t,n){if(e instanceof bs){const s=new bs(kl(e.orientation),e.proportionalLayout,e.styles,t,n,e.disabled,e.margin);let i=0;for(let o=e.children.length-1;o>=0;o--){const r=e.children[o],l=r instanceof bs?r.orthogonalSize:r.size;let c=e.size===0?0:Math.round(t*l/e.size);i+=c,o===0&&(c+=t-i),s.addChild(mP(r,n,c),c,0,!0)}return s}else return new ii(e.view,kl(e.orientation),n)}function Vje(e){const t=e.parentElement;if(!t)throw new Error("Invalid grid element");let n=t.firstElementChild,s=0;for(;n!==e&&n!==t.lastElementChild&&n;)n=n.nextElementSibling,s++;return s}function fs(e){const t=e.parentElement;if(!t)throw new Error("Invalid grid element");if(/\bdv-grid-view\b/.test(t.className))return[];const n=Vje(t),s=t.parentElement.parentElement.parentElement;return[...fs(s),n]}function bl(e,t,n){const s=Gje(e,t),i=$je(n);if(s===i){const[o,r]=Tc(t);let l=r;return(n==="right"||n==="bottom")&&(l+=1),[...o,l]}else{const o=n==="right"||n==="bottom"?1:0;return[...t,o]}}function $je(e){return e==="top"||e==="bottom"?Ke.VERTICAL:Ke.HORIZONTAL}function Gje(e,t){return t.length%2===0?kl(e):e}const kl=e=>e===Ke.HORIZONTAL?Ke.VERTICAL:Ke.HORIZONTAL;function Hje(e){return!!e.children}const gP=(e,t)=>{const n=t===Ke.VERTICAL?e.box.width:e.box.height;return Hje(e)?{type:"branch",data:e.children.map(s=>gP(s,kl(t))),size:n}:typeof e.cachedVisibleSize=="number"?{type:"leaf",data:e.view.toJSON(),size:e.cachedVisibleSize,visible:!1}:{type:"leaf",data:e.view.toJSON(),size:n}};class Wje{get length(){return this._root?this._root.children.length:0}get orientation(){return this.root.orientation}set orientation(t){if(this.root.orientation===t)return;const{size:n,orthogonalSize:s}=this.root;this.root=mP(this.root,s,n),this.root.layout(n,s)}get width(){return this.root.width}get height(){return this.root.height}get minimumWidth(){return this.root.minimumWidth}get minimumHeight(){return this.root.minimumHeight}get maximumWidth(){return this.root.maximumHeight}get maximumHeight(){return this.root.maximumHeight}get locked(){return this._locked}set locked(t){this._locked=t;const n=[this.root];for(;n.length>0;){const s=n.pop();s instanceof bs&&(s.disabled=t,n.push(...s.children))}}get margin(){return this._margin}set margin(t){this._margin=t,this.root.margin=t}maximizedView(){var t;return(t=this._maximizedNode)===null||t===void 0?void 0:t.leaf.view}hasMaximizedView(){return this._maximizedNode!==void 0}maximizeView(t){var n;const s=fs(t.element),[i,o]=this.getNode(s);if(!(o instanceof ii)||((n=this._maximizedNode)===null||n===void 0?void 0:n.leaf)===o)return;this.hasMaximizedView()&&this.exitMaximizedView(),gP(this.getView(),this.orientation);const r=[];function l(c,d){for(let u=0;u<c.children.length;u++){const p=c.children[u];p instanceof ii?p!==d&&(c.isChildVisible(u)?c.setChildVisible(u,!1):r.push(p)):l(p,d)}}l(this.root,o),this._maximizedNode={leaf:o,hiddenOnMaximize:r},this._onDidMaximizedNodeChange.fire({view:o.view,isMaximized:!0})}exitMaximizedView(){if(!this._maximizedNode)return;const t=this._maximizedNode.hiddenOnMaximize;function n(i){for(let o=i.children.length-1;o>=0;o--){const r=i.children[o];r instanceof ii?t.includes(r)||i.setChildVisible(o,!0):n(r)}}n(this.root);const s=this._maximizedNode.leaf;this._maximizedNode=void 0,this._onDidMaximizedNodeChange.fire({view:s.view,isMaximized:!1})}serialize(){const t=this.maximizedView();let n;t&&(n=fs(t.element)),this.hasMaximizedView()&&this.exitMaximizedView();const i={root:gP(this.getView(),this.orientation),width:this.width,height:this.height,orientation:this.orientation};return n&&(i.maximizedNode={location:n}),t&&this.maximizeView(t),i}dispose(){this.disposable.dispose(),this._onDidChange.dispose(),this._onDidMaximizedNodeChange.dispose(),this._onDidViewVisibilityChange.dispose(),this.root.dispose(),this._maximizedNode=void 0,this.element.remove()}clear(){const t=this.root.orientation;this.root=new bs(t,this.proportionalLayout,this.styles,this.root.size,this.root.orthogonalSize,this.locked,this.margin)}deserialize(t,n){const s=t.orientation,i=s===Ke.VERTICAL?t.height:t.width;if(this._deserialize(t.root,s,n,i),this.layout(t.width,t.height),t.maximizedNode){const o=t.maximizedNode.location,[r,l]=this.getNode(o);if(!(l instanceof ii))return;this.maximizeView(l.view)}}_deserialize(t,n,s,i){this.root=this._deserializeNode(t,n,s,i)}_deserializeNode(t,n,s,i){var o;let r;if(t.type==="branch"){const c=t.data.map(d=>({node:this._deserializeNode(d,kl(n),s,t.size),visible:d.visible}));r=new bs(n,this.proportionalLayout,this.styles,t.size,i,this.locked,this.margin,c)}else{const l=s.fromJSON(t);typeof t.visible=="boolean"&&((o=l.setVisible)===null||o===void 0||o.call(l,t.visible)),r=new ii(l,n,i,t.size)}return r}get root(){return this._root}set root(t){const n=this._root;n&&(n.dispose(),this._maximizedNode=void 0,this.element.removeChild(n.element)),this._root=t,this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(s=>{this._onDidChange.fire(s)})}normalize(){if(!this._root||this._root.children.length!==1)return;const t=this.root,n=t.children[0];if(n instanceof ii)return;t.element.remove();const s=t.removeChild(0);t.dispose(),s.dispose(),this._root=FK(n,n.size,n.orthogonalSize),this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(i=>{this._onDidChange.fire(i)})}insertOrthogonalSplitviewAtRoot(){if(!this._root)return;const t=this.root;if(t.element.remove(),this._root=new bs(kl(t.orientation),this.proportionalLayout,this.styles,this.root.orthogonalSize,this.root.size,this.locked,this.margin),t.children.length!==0)if(t.children.length===1){const n=t.children[0];t.removeChild(0).dispose(),t.dispose(),this._root.addChild(mP(n,n.orthogonalSize,n.size),Wa.Distribute,0)}else this._root.addChild(t,Wa.Distribute,0);this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange(n=>{this._onDidChange.fire(n)})}next(t){return this.progmaticSelect(t)}previous(t){return this.progmaticSelect(t,!0)}getView(t){const n=t?this.getNode(t)[1]:this.root;return this._getViews(n,this.orientation)}_getViews(t,n,s){const i={height:t.height,width:t.width};if(t instanceof ii)return{box:i,view:t.view,cachedVisibleSize:s};const o=[];for(let r=0;r<t.children.length;r++){const l=t.children[r],c=t.getChildCachedVisibleSize(r);o.push(this._getViews(l,kl(n),c))}return{box:i,children:o}}progmaticSelect(t,n=!1){const[s,i]=this.getNode(t);if(!(i instanceof ii))throw new Error("invalid location");for(let o=s.length-1;o>-1;o--){const r=s[o],l=t[o]||0;if(n?l-1>-1:l+1<r.children.length)return fP(r.children[n?l-1:l+1],n)}return fP(this.root,n)}constructor(t,n,s,i,o){this.proportionalLayout=t,this.styles=n,this._locked=!1,this._margin=0,this._maximizedNode=void 0,this.disposable=new so,this._onDidChange=new Ce,this.onDidChange=this._onDidChange.event,this._onDidViewVisibilityChange=new Ce,this.onDidViewVisibilityChange=this._onDidViewVisibilityChange.event,this._onDidMaximizedNodeChange=new Ce,this.onDidMaximizedNodeChange=this._onDidMaximizedNodeChange.event,this.element=document.createElement("div"),this.element.className="dv-grid-view",this._locked=i??!1,this._margin=o??0,this.root=new bs(s,t,n,0,0,this.locked,this.margin)}isViewVisible(t){const[n,s]=Tc(t),[,i]=this.getNode(n);if(!(i instanceof bs))throw new Error("Invalid from location");return i.isChildVisible(s)}setViewVisible(t,n){this.hasMaximizedView()&&this.exitMaximizedView();const[s,i]=Tc(t),[,o]=this.getNode(s);if(!(o instanceof bs))throw new Error("Invalid from location");this._onDidViewVisibilityChange.fire(),o.setChildVisible(i,n)}moveView(t,n,s){this.hasMaximizedView()&&this.exitMaximizedView();const[,i]=this.getNode(t);if(!(i instanceof bs))throw new Error("Invalid location");i.moveChild(n,s)}addView(t,n,s){this.hasMaximizedView()&&this.exitMaximizedView();const[i,o]=Tc(s),[r,l]=this.getNode(i);if(l instanceof bs){const c=new ii(t,kl(l.orientation),l.orthogonalSize);l.addChild(c,n,o)}else{const[c,...d]=[...r].reverse(),[u,...p]=[...i].reverse();let m=0;const f=c.getChildCachedVisibleSize(u);typeof f=="number"&&(m=Wa.Invisible(f)),c.removeChild(u).dispose();const v=new bs(l.orientation,this.proportionalLayout,this.styles,l.size,l.orthogonalSize,this.locked,this.margin);c.addChild(v,l.size,u);const b=new ii(l.view,c.orientation,l.size);v.addChild(b,m,0),typeof n!="number"&&n.type==="split"&&(n={type:"split",index:0});const C=new ii(t,c.orientation,l.size);v.addChild(C,n,o)}}remove(t,n){const s=fs(t.element);return this.removeView(s,n)}removeView(t,n){this.hasMaximizedView()&&this.exitMaximizedView();const[s,i]=Tc(t),[o,r]=this.getNode(s);if(!(r instanceof bs))throw new Error("Invalid location");const l=r.children[i];if(!(l instanceof ii))throw new Error("Invalid location");if(r.removeChild(i,n),l.dispose(),r.children.length!==1)return l.view;const c=r.children[0];if(o.length===0)return c instanceof ii||(r.removeChild(0,n),this.root=c),l.view;const[d,...u]=[...o].reverse(),[p,...m]=[...s].reverse(),f=r.isChildVisible(0);r.removeChild(0,n);const g=d.children.map((v,b)=>d.getChildSize(b));if(d.removeChild(p,n).dispose(),c instanceof bs){g.splice(p,1,...c.children.map(v=>v.size));for(let v=0;v<c.children.length;v++){const b=c.children[v];d.addChild(b,b.size,p+v)}for(;c.children.length>0;)c.removeChild(0)}else{const v=new ii(c.view,kl(c.orientation),c.size),b=f?c.orthogonalSize:Wa.Invisible(c.orthogonalSize);d.addChild(v,b,p)}c.dispose();for(let v=0;v<g.length;v++)d.resizeChild(v,g[v]);return l.view}layout(t,n){const[s,i]=this.root.orientation===Ke.HORIZONTAL?[n,t]:[t,n];this.root.layout(s,i)}getNode(t,n=this.root,s=[]){if(t.length===0)return[s,n];if(!(n instanceof bs))throw new Error("Invalid location");const[i,...o]=t;if(i<0||i>=n.children.length)throw new Error("Invalid location");const r=n.children[i];return s.push(n),this.getNode(o,r,s)}}const vP=Object.keys({disableAutoResizing:void 0,proportionalLayout:void 0,orientation:void 0,hideBorders:void 0,className:void 0});class d4 extends jt{get element(){return this._element}get disableResizing(){return this._disableResizing}set disableResizing(t){this._disableResizing=t}constructor(t,n=!1){super(),this._disableResizing=n,this._element=t,this.addDisposables(D_(this._element,s=>{if(this.isDisposed||this.disableResizing||!this._element.offsetParent||!Pje(this._element))return;const{width:i,height:o}=s.contentRect;this.layout(i,o)}))}}const Uje=c4();function eC(e){switch(e){case"left":return"left";case"right":return"right";case"above":return"top";case"below":return"bottom";case"within":default:return"center"}}class BK extends d4{get id(){return this._id}get size(){return this._groups.size}get groups(){return Array.from(this._groups.values()).map(t=>t.value)}get width(){return this.gridview.width}get height(){return this.gridview.height}get minimumHeight(){return this.gridview.minimumHeight}get maximumHeight(){return this.gridview.maximumHeight}get minimumWidth(){return this.gridview.minimumWidth}get maximumWidth(){return this.gridview.maximumWidth}get activeGroup(){return this._activeGroup}get locked(){return this.gridview.locked}set locked(t){this.gridview.locked=t}constructor(t,n){var s;super(document.createElement("div"),n.disableAutoResizing),this._id=Uje.next(),this._groups=new Map,this._onDidRemove=new Ce,this.onDidRemove=this._onDidRemove.event,this._onDidAdd=new Ce,this.onDidAdd=this._onDidAdd.event,this._onDidMaximizedChange=new Ce,this.onDidMaximizedChange=this._onDidMaximizedChange.event,this._onDidActiveChange=new Ce,this.onDidActiveChange=this._onDidActiveChange.event,this._bufferOnDidLayoutChange=new MR,this.onDidLayoutChange=this._bufferOnDidLayoutChange.onEvent,this._onDidViewVisibilityChangeMicroTaskQueue=new MR,this.onDidViewVisibilityChangeMicroTaskQueue=this._onDidViewVisibilityChangeMicroTaskQueue.onEvent,this.element.style.height="100%",this.element.style.width="100%",this._classNames=new L_(this.element),this._classNames.setClassNames((s=n.className)!==null&&s!==void 0?s:""),t.appendChild(this.element),this.gridview=new Wje(!!n.proportionalLayout,n.styles,n.orientation,n.locked,n.margin),this.gridview.locked=!!n.locked,this.element.appendChild(this.gridview.element),this.layout(0,0,!0),this.addDisposables(this.gridview.onDidMaximizedNodeChange(i=>{this._onDidMaximizedChange.fire({panel:i.view,isMaximized:i.isMaximized})}),this.gridview.onDidViewVisibilityChange(()=>this._onDidViewVisibilityChangeMicroTaskQueue.fire()),this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.layout(this.width,this.height,!0)}),Bs.from(()=>{var i;(i=this.element.parentElement)===null||i===void 0||i.removeChild(this.element)}),this.gridview.onDidChange(()=>{this._bufferOnDidLayoutChange.fire()}),ch.any(this.onDidAdd,this.onDidRemove,this.onDidActiveChange)(()=>{this._bufferOnDidLayoutChange.fire()}),this._onDidMaximizedChange,this._onDidViewVisibilityChangeMicroTaskQueue,this._bufferOnDidLayoutChange)}setVisible(t,n){this.gridview.setViewVisible(fs(t.element),n),this._bufferOnDidLayoutChange.fire()}isVisible(t){return this.gridview.isViewVisible(fs(t.element))}updateOptions(t){var n,s,i,o;t.proportionalLayout,t.orientation&&(this.gridview.orientation=t.orientation),"disableResizing"in t&&(this.disableResizing=(n=t.disableAutoResizing)!==null&&n!==void 0?n:!1),"locked"in t&&(this.locked=(s=t.locked)!==null&&s!==void 0?s:!1),"margin"in t&&(this.gridview.margin=(i=t.margin)!==null&&i!==void 0?i:0),"className"in t&&this._classNames.setClassNames((o=t.className)!==null&&o!==void 0?o:"")}maximizeGroup(t){this.gridview.maximizeView(t),this.doSetGroupActive(t)}isMaximizedGroup(t){return this.gridview.maximizedView()===t}exitMaximizedGroup(){this.gridview.exitMaximizedView()}hasMaximizedGroup(){return this.gridview.hasMaximizedView()}doAddGroup(t,n=[0],s){this.gridview.addView(t,s??Wa.Distribute,n),this._onDidAdd.fire(t)}doRemoveGroup(t,n){if(!this._groups.has(t.id))throw new Error("invalid operation");const s=this._groups.get(t.id),i=this.gridview.remove(t,Wa.Distribute);if(s&&!n?.skipDispose&&(s.disposable.dispose(),s.value.dispose(),this._groups.delete(t.id),this._onDidRemove.fire(t)),!n?.skipActive&&this._activeGroup===t){const o=Array.from(this._groups.values());this.doSetGroupActive(o.length>0?o[0].value:void 0)}return i}getPanel(t){var n;return(n=this._groups.get(t))===null||n===void 0?void 0:n.value}doSetGroupActive(t){this._activeGroup!==t&&(this._activeGroup&&this._activeGroup.setActive(!1),t&&t.setActive(!0),this._activeGroup=t,this._onDidActiveChange.fire(t))}removeGroup(t){this.doRemoveGroup(t)}moveToNext(t){var n;if(t||(t={}),!t.group){if(!this.activeGroup)return;t.group=this.activeGroup}const s=fs(t.group.element),i=(n=this.gridview.next(s))===null||n===void 0?void 0:n.view;this.doSetGroupActive(i)}moveToPrevious(t){var n;if(t||(t={}),!t.group){if(!this.activeGroup)return;t.group=this.activeGroup}const s=fs(t.group.element),i=(n=this.gridview.previous(s))===null||n===void 0?void 0:n.view;this.doSetGroupActive(i)}layout(t,n,s){(s||t!==this.width||n!==this.height)&&(this.gridview.element.style.height=`${n}px`,this.gridview.element.style.width=`${t}px`,this.gridview.layout(t,n))}dispose(){this._onDidActiveChange.dispose(),this._onDidAdd.dispose(),this._onDidRemove.dispose();for(const t of this.groups)t.dispose();this.gridview.dispose(),super.dispose()}}class zK{get minimumSize(){return this.component.minimumSize}get maximumSize(){return this.component.maximumSize}get width(){return this.component.width}get height(){return this.component.height}get length(){return this.component.length}get orientation(){return this.component.orientation}get panels(){return this.component.panels}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidAddView(){return this.component.onDidAddView}get onDidRemoveView(){return this.component.onDidRemoveView}constructor(t){this.component=t}removePanel(t,n){this.component.removePanel(t,n)}focus(){this.component.focus()}getPanel(t){return this.component.getPanel(t)}layout(t,n){return this.component.layout(t,n)}addPanel(t){return this.component.addPanel(t)}movePanel(t,n){this.component.movePanel(t,n)}fromJSON(t){this.component.fromJSON(t)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(t){this.component.updateOptions(t)}dispose(){this.component.dispose()}}class Bv{get minimumSize(){return this.component.minimumSize}get maximumSize(){return this.component.maximumSize}get width(){return this.component.width}get height(){return this.component.height}get panels(){return this.component.panels}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidAddView(){return this.component.onDidAddView}get onDidRemoveView(){return this.component.onDidRemoveView}get onDidDrop(){return this.component.onDidDrop}get onUnhandledDragOverEvent(){return this.component.onUnhandledDragOverEvent}constructor(t){this.component=t}removePanel(t){this.component.removePanel(t)}getPanel(t){return this.component.getPanel(t)}movePanel(t,n){this.component.movePanel(t,n)}focus(){this.component.focus()}layout(t,n){this.component.layout(t,n)}addPanel(t){return this.component.addPanel(t)}fromJSON(t){this.component.fromJSON(t)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(t){this.component.updateOptions(t)}dispose(){this.component.dispose()}}class VK{get width(){return this.component.width}get height(){return this.component.height}get minimumHeight(){return this.component.minimumHeight}get maximumHeight(){return this.component.maximumHeight}get minimumWidth(){return this.component.minimumWidth}get maximumWidth(){return this.component.maximumWidth}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidAddPanel(){return this.component.onDidAddGroup}get onDidRemovePanel(){return this.component.onDidRemoveGroup}get onDidActivePanelChange(){return this.component.onDidActiveGroupChange}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get panels(){return this.component.groups}get orientation(){return this.component.orientation}set orientation(t){this.component.updateOptions({orientation:t})}constructor(t){this.component=t}focus(){this.component.focus()}layout(t,n,s=!1){this.component.layout(t,n,s)}addPanel(t){return this.component.addPanel(t)}removePanel(t,n){this.component.removePanel(t,n)}movePanel(t,n){this.component.movePanel(t,n)}getPanel(t){return this.component.getPanel(t)}fromJSON(t){return this.component.fromJSON(t)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}updateOptions(t){this.component.updateOptions(t)}dispose(){this.component.dispose()}}class zv{get id(){return this.component.id}get width(){return this.component.width}get height(){return this.component.height}get minimumHeight(){return this.component.minimumHeight}get maximumHeight(){return this.component.maximumHeight}get minimumWidth(){return this.component.minimumWidth}get maximumWidth(){return this.component.maximumWidth}get size(){return this.component.size}get totalPanels(){return this.component.totalPanels}get onDidActiveGroupChange(){return this.component.onDidActiveGroupChange}get onDidAddGroup(){return this.component.onDidAddGroup}get onDidRemoveGroup(){return this.component.onDidRemoveGroup}get onDidActivePanelChange(){return this.component.onDidActivePanelChange}get onDidAddPanel(){return this.component.onDidAddPanel}get onDidRemovePanel(){return this.component.onDidRemovePanel}get onDidMovePanel(){return this.component.onDidMovePanel}get onDidLayoutFromJSON(){return this.component.onDidLayoutFromJSON}get onDidLayoutChange(){return this.component.onDidLayoutChange}get onDidDrop(){return this.component.onDidDrop}get onWillDrop(){return this.component.onWillDrop}get onWillShowOverlay(){return this.component.onWillShowOverlay}get onWillDragGroup(){return this.component.onWillDragGroup}get onWillDragPanel(){return this.component.onWillDragPanel}get onUnhandledDragOverEvent(){return this.component.onUnhandledDragOverEvent}get onDidPopoutGroupSizeChange(){return this.component.onDidPopoutGroupSizeChange}get onDidPopoutGroupPositionChange(){return this.component.onDidPopoutGroupPositionChange}get onDidOpenPopoutWindowFail(){return this.component.onDidOpenPopoutWindowFail}get panels(){return this.component.panels}get groups(){return this.component.groups}get activePanel(){return this.component.activePanel}get activeGroup(){return this.component.activeGroup}constructor(t){this.component=t}focus(){this.component.focus()}getPanel(t){return this.component.getGroupPanel(t)}layout(t,n,s=!1){this.component.layout(t,n,s)}addPanel(t){return this.component.addPanel(t)}removePanel(t){this.component.removePanel(t)}addGroup(t){return this.component.addGroup(t)}closeAllGroups(){return this.component.closeAllGroups()}removeGroup(t){this.component.removeGroup(t)}getGroup(t){return this.component.getPanel(t)}addFloatingGroup(t,n){return this.component.addFloatingGroup(t,n)}fromJSON(t){this.component.fromJSON(t)}toJSON(){return this.component.toJSON()}clear(){this.component.clear()}moveToNext(t){this.component.moveToNext(t)}moveToPrevious(t){this.component.moveToPrevious(t)}maximizeGroup(t){this.component.maximizeGroup(t.group)}hasMaximizedGroup(){return this.component.hasMaximizedGroup()}exitMaximizedGroup(){this.component.exitMaximizedGroup()}get onDidMaximizedGroupChange(){return this.component.onDidMaximizedGroupChange}addPopoutGroup(t,n){return this.component.addPopoutGroup(t,n)}updateOptions(t){this.component.updateOptions(t)}dispose(){this.component.dispose()}}class u4 extends jt{constructor(t,n){super(),this.el=t,this.disabled=n,this.dataDisposable=new so,this.pointerEventsDisposable=new so,this._onDragStart=new Ce,this.onDragStart=this._onDragStart.event,this.addDisposables(this._onDragStart,this.dataDisposable,this.pointerEventsDisposable),this.configure()}setDisabled(t){this.disabled=t}isCancelled(t){return!1}configure(){this.addDisposables(this._onDragStart,Vt(this.el,"dragstart",t=>{if(t.defaultPrevented||this.isCancelled(t)||this.disabled){t.preventDefault();return}const n=J2();this.pointerEventsDisposable.value={dispose:()=>{n.release()}},this.el.classList.add("dv-dragged"),setTimeout(()=>this.el.classList.remove("dv-dragged"),0),this.dataDisposable.value=this.getData(t),this._onDragStart.fire(t),t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.items.length>0||t.dataTransfer.setData("text/plain",""))}),Vt(this.el,"dragend",()=>{this.pointerEventsDisposable.dispose(),setTimeout(()=>{this.dataDisposable.dispose()},0)}))}}class $K extends jt{constructor(t,n){super(),this.element=t,this.callbacks=n,this.target=null,this.registerListeners()}onDragEnter(t){this.target=t.target,this.callbacks.onDragEnter(t)}onDragOver(t){t.preventDefault(),this.callbacks.onDragOver&&this.callbacks.onDragOver(t)}onDragLeave(t){this.target===t.target&&(this.target=null,this.callbacks.onDragLeave(t))}onDragEnd(t){this.target=null,this.callbacks.onDragEnd(t)}onDrop(t){this.callbacks.onDrop(t)}registerListeners(){this.addDisposables(Vt(this.element,"dragenter",t=>{this.onDragEnter(t)},!0)),this.addDisposables(Vt(this.element,"dragover",t=>{this.onDragOver(t)},!0)),this.addDisposables(Vt(this.element,"dragleave",t=>{this.onDragLeave(t)})),this.addDisposables(Vt(this.element,"dragend",t=>{this.onDragEnd(t)})),this.addDisposables(Vt(this.element,"drop",t=>{this.onDrop(t)}))}}function qje(e,t){const{top:n,left:s,width:i,height:o}=t,r=`${Math.round(n)}px`,l=`${Math.round(s)}px`,c=`${Math.round(i)}px`,d=`${Math.round(o)}px`;e.style.top=r,e.style.left=l,e.style.width=c,e.style.height=d,e.style.visibility="visible",(!e.style.transform||e.style.transform==="")&&(e.style.transform="translate3d(0, 0, 0)")}function Kje(e,t){const{top:n,left:s,width:i,height:o}=t;e.style.top=n,e.style.left=s,e.style.width=i,e.style.height=o,e.style.visibility="visible",(!e.style.transform||e.style.transform==="")&&(e.style.transform="translate3d(0, 0, 0)")}function Zje(e,t){const{top:n,left:s,width:i,height:o}=t,r=`${Math.round(n)}px`,l=`${Math.round(s)}px`,c=`${Math.round(i)}px`,d=`${Math.round(o)}px`;return e.style.top!==r||e.style.left!==l||e.style.width!==c||e.style.height!==d}class Xje extends l4{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}constructor(t){super(),this.options=t}}function OR(e){switch(e){case"above":return"top";case"below":return"bottom";case"left":return"left";case"right":return"right";case"within":return"center";default:throw new Error(`invalid direction '${e}'`)}}function Yje(e){switch(e){case"top":return"above";case"bottom":return"below";case"left":return"left";case"right":return"right";case"center":return"within";default:throw new Error(`invalid position '${e}'`)}}const Qje={value:20,type:"percentage"},Jje={value:50,type:"percentage"},eEe=100,tEe=100;class Mr extends jt{get disabled(){return this._disabled}set disabled(t){this._disabled=t}get state(){return this._state}constructor(t,n){super(),this.element=t,this.options=n,this._onDrop=new Ce,this.onDrop=this._onDrop.event,this._onWillShowOverlay=new Ce,this.onWillShowOverlay=this._onWillShowOverlay.event,this._disabled=!1,this._acceptedTargetZonesSet=new Set(this.options.acceptedTargetZones),this.dnd=new $K(this.element,{onDragEnter:()=>{var s,i,o;(o=(i=(s=this.options).getOverrideTarget)===null||i===void 0?void 0:i.call(s))===null||o===void 0||o.getElements()},onDragOver:s=>{var i,o,r,l,c,d,u;Mr.ACTUAL_TARGET=this;const p=(o=(i=this.options).getOverrideTarget)===null||o===void 0?void 0:o.call(i);if(this._acceptedTargetZonesSet.size===0){if(p)return;this.removeDropTarget();return}const m=(c=(l=(r=this.options).getOverlayOutline)===null||l===void 0?void 0:l.call(r))!==null&&c!==void 0?c:this.element,f=m.offsetWidth,g=m.offsetHeight;if(f===0||g===0)return;const v=s.currentTarget.getBoundingClientRect(),b=((d=s.clientX)!==null&&d!==void 0?d:0)-v.left,C=((u=s.clientY)!==null&&u!==void 0?u:0)-v.top,y=this.calculateQuadrant(this._acceptedTargetZonesSet,b,C,f,g);if(this.isAlreadyUsed(s)||y===null){this.removeDropTarget();return}if(!this.options.canDisplayOverlay(s,y)){if(p)return;this.removeDropTarget();return}const x=new Xje({nativeEvent:s,position:y});if(this._onWillShowOverlay.fire(x),x.defaultPrevented){this.removeDropTarget();return}this.markAsUsed(s),p||this.targetElement||(this.targetElement=document.createElement("div"),this.targetElement.className="dv-drop-target-dropzone",this.overlayElement=document.createElement("div"),this.overlayElement.className="dv-drop-target-selection",this._state="center",this.targetElement.appendChild(this.overlayElement),m.classList.add("dv-drop-target"),m.append(this.targetElement)),this.toggleClasses(y,f,g),this._state=y},onDragLeave:()=>{var s,i;!((i=(s=this.options).getOverrideTarget)===null||i===void 0)&&i.call(s)||this.removeDropTarget()},onDragEnd:s=>{var i,o;const r=(o=(i=this.options).getOverrideTarget)===null||o===void 0?void 0:o.call(i);r&&Mr.ACTUAL_TARGET===this&&this._state&&(s.stopPropagation(),this._onDrop.fire({position:this._state,nativeEvent:s})),this.removeDropTarget(),r?.clear()},onDrop:s=>{var i,o,r;s.preventDefault();const l=this._state;this.removeDropTarget(),(r=(o=(i=this.options).getOverrideTarget)===null||o===void 0?void 0:o.call(i))===null||r===void 0||r.clear(),l&&(s.stopPropagation(),this._onDrop.fire({position:l,nativeEvent:s}))}}),this.addDisposables(this._onDrop,this._onWillShowOverlay,this.dnd)}setTargetZones(t){this._acceptedTargetZonesSet=new Set(t)}setOverlayModel(t){this.options.overlayModel=t}dispose(){this.removeDropTarget(),super.dispose()}markAsUsed(t){t[Mr.USED_EVENT_ID]=!0}isAlreadyUsed(t){const n=t[Mr.USED_EVENT_ID];return typeof n=="boolean"&&n}toggleClasses(t,n,s){var i,o,r,l,c,d,u;const p=(o=(i=this.options).getOverrideTarget)===null||o===void 0?void 0:o.call(i);if(!p&&!this.overlayElement)return;const m=n<eEe,f=s<tEe,g=t==="left",v=t==="right",b=t==="top",C=t==="bottom",y=!m&&v,x=!m&&g,w=!f&&b,_=!f&&C;let S=1;const I=(l=(r=this.options.overlayModel)===null||r===void 0?void 0:r.size)!==null&&l!==void 0?l:Jje;if(I.type==="percentage"?S=es(I.value,0,100)/100:((y||x)&&(S=es(0,I.value,n)/n),(w||_)&&(S=es(0,I.value,s)/s)),p){const E=(u=(d=(c=this.options).getOverlayOutline)===null||d===void 0?void 0:d.call(c))!==null&&u!==void 0?u:this.element,j=E.getBoundingClientRect(),P=p.getElements(void 0,E),D=P.root,O=P.overlay,N=D.getBoundingClientRect(),F=j.top-N.top,X=j.left-N.left,L={top:F,left:X,width:n,height:s};if(y?(L.left=X+n*(1-S),L.width=n*S):x?L.width=n*S:w?L.height=s*S:_&&(L.top=F+s*(1-S),L.height=s*S),m&&g&&(L.width=4),m&&v&&(L.left=X+n-4,L.width=4),!Zje(O,L))return;qje(O,L),O.className=`dv-drop-target-anchor${this.options.className?` ${this.options.className}`:""}`,wt(O,"dv-drop-target-left",g),wt(O,"dv-drop-target-right",v),wt(O,"dv-drop-target-top",b),wt(O,"dv-drop-target-bottom",C),wt(O,"dv-drop-target-center",t==="center"),P.changed&&(wt(O,"dv-drop-target-anchor-container-changed",!0),setTimeout(()=>{wt(O,"dv-drop-target-anchor-container-changed",!1)},10));return}if(!this.overlayElement)return;const k={top:"0px",left:"0px",width:"100%",height:"100%"};y?(k.left=`${100*(1-S)}%`,k.width=`${100*S}%`):x?k.width=`${100*S}%`:w?k.height=`${100*S}%`:_&&(k.top=`${100*(1-S)}%`,k.height=`${100*S}%`),Kje(this.overlayElement,k),wt(this.overlayElement,"dv-drop-target-small-vertical",f),wt(this.overlayElement,"dv-drop-target-small-horizontal",m),wt(this.overlayElement,"dv-drop-target-left",g),wt(this.overlayElement,"dv-drop-target-right",v),wt(this.overlayElement,"dv-drop-target-top",b),wt(this.overlayElement,"dv-drop-target-bottom",C),wt(this.overlayElement,"dv-drop-target-center",t==="center")}calculateQuadrant(t,n,s,i,o){var r,l;const c=(l=(r=this.options.overlayModel)===null||r===void 0?void 0:r.activationSize)!==null&&l!==void 0?l:Qje;return c.type==="percentage"?nEe(t,n,s,i,o,c.value):sEe(t,n,s,i,o,c.value)}removeDropTarget(){var t;this.targetElement&&(this._state=void 0,(t=this.targetElement.parentElement)===null||t===void 0||t.classList.remove("dv-drop-target"),this.targetElement.remove(),this.targetElement=void 0,this.overlayElement=void 0)}}Mr.USED_EVENT_ID="__dockview_droptarget_event_is_used__";function nEe(e,t,n,s,i,o){const r=100*t/s,l=100*n/i;return e.has("left")&&r<o?"left":e.has("right")&&r>100-o?"right":e.has("top")&&l<o?"top":e.has("bottom")&&l>100-o?"bottom":e.has("center")?"center":null}function sEe(e,t,n,s,i,o){return e.has("left")&&t<o?"left":e.has("right")&&t>s-o?"right":e.has("top")&&n<o?"top":e.has("bottom")&&n>i-o?"bottom":e.has("center")?"center":null}const yP=Object.keys({disableAutoResizing:void 0,disableDnd:void 0,className:void 0});class iEe extends MK{constructor(t,n,s,i){super(),this.nativeEvent=t,this.position=n,this.getData=s,this.panel=i}}class GK extends l4{constructor(){super()}}class HK extends jt{get isFocused(){return this._isFocused}get isActive(){return this._isActive}get isVisible(){return this._isVisible}get width(){return this._width}get height(){return this._height}constructor(t,n){super(),this.id=t,this.component=n,this._isFocused=!1,this._isActive=!1,this._isVisible=!0,this._width=0,this._height=0,this._parameters={},this.panelUpdatesDisposable=new so,this._onDidDimensionChange=new Ce,this.onDidDimensionsChange=this._onDidDimensionChange.event,this._onDidChangeFocus=new Ce,this.onDidFocusChange=this._onDidChangeFocus.event,this._onWillFocus=new Ce,this.onWillFocus=this._onWillFocus.event,this._onDidVisibilityChange=new Ce,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._onWillVisibilityChange=new Ce,this.onWillVisibilityChange=this._onWillVisibilityChange.event,this._onDidActiveChange=new Ce,this.onDidActiveChange=this._onDidActiveChange.event,this._onActiveChange=new Ce,this.onActiveChange=this._onActiveChange.event,this._onDidParametersChange=new Ce,this.onDidParametersChange=this._onDidParametersChange.event,this.addDisposables(this.onDidFocusChange(s=>{this._isFocused=s.isFocused}),this.onDidActiveChange(s=>{this._isActive=s.isActive}),this.onDidVisibilityChange(s=>{this._isVisible=s.isVisible}),this.onDidDimensionsChange(s=>{this._width=s.width,this._height=s.height}),this.panelUpdatesDisposable,this._onDidDimensionChange,this._onDidChangeFocus,this._onDidVisibilityChange,this._onDidActiveChange,this._onWillFocus,this._onActiveChange,this._onWillFocus,this._onWillVisibilityChange,this._onDidParametersChange)}getParameters(){return this._parameters}initialize(t){this.panelUpdatesDisposable.value=this._onDidParametersChange.event(n=>{this._parameters=n,t.update({params:n})})}setVisible(t){this._onWillVisibilityChange.fire({isVisible:t})}setActive(){this._onActiveChange.fire()}updateParameters(t){this._onDidParametersChange.fire(t)}}class WK extends HK{constructor(t,n){super(t,n),this._onDidConstraintsChangeInternal=new Ce,this.onDidConstraintsChangeInternal=this._onDidConstraintsChangeInternal.event,this._onDidConstraintsChange=new Ce({replay:!0}),this.onDidConstraintsChange=this._onDidConstraintsChange.event,this._onDidSizeChange=new Ce,this.onDidSizeChange=this._onDidSizeChange.event,this.addDisposables(this._onDidConstraintsChangeInternal,this._onDidConstraintsChange,this._onDidSizeChange)}setConstraints(t){this._onDidConstraintsChangeInternal.fire(t)}setSize(t){this._onDidSizeChange.fire(t)}}class oEe extends WK{set pane(t){this._pane=t}constructor(t,n){super(t,n),this._onDidExpansionChange=new Ce({replay:!0}),this.onDidExpansionChange=this._onDidExpansionChange.event,this._onMouseEnter=new Ce({}),this.onMouseEnter=this._onMouseEnter.event,this._onMouseLeave=new Ce({}),this.onMouseLeave=this._onMouseLeave.event,this.addDisposables(this._onDidExpansionChange,this._onMouseEnter,this._onMouseLeave)}setExpanded(t){var n;(n=this._pane)===null||n===void 0||n.setExpanded(t)}get isExpanded(){var t;return!!(!((t=this._pane)===null||t===void 0)&&t.isExpanded())}}class h4 extends jt{get element(){return this._element}get width(){return this._width}get height(){return this._height}get params(){var t;return(t=this._params)===null||t===void 0?void 0:t.params}constructor(t,n,s){super(),this.id=t,this.component=n,this.api=s,this._height=0,this._width=0,this._element=document.createElement("div"),this._element.tabIndex=-1,this._element.style.outline="none",this._element.style.height="100%",this._element.style.width="100%",this._element.style.overflow="hidden";const i=LK(this._element);this.addDisposables(this.api,i.onDidFocus(()=>{this.api._onDidChangeFocus.fire({isFocused:!0})}),i.onDidBlur(()=>{this.api._onDidChangeFocus.fire({isFocused:!1})}),i)}focus(){const t=new GK;this.api._onWillFocus.fire(t),!t.defaultPrevented&&this._element.focus()}layout(t,n){this._width=t,this._height=n,this.api._onDidDimensionChange.fire({width:t,height:n}),this.part&&this._params&&this.part.update(this._params.params)}init(t){this._params=t,this.part=this.getComponent()}update(t){var n,s;this._params=Object.assign(Object.assign({},this._params),{params:Object.assign(Object.assign({},(n=this._params)===null||n===void 0?void 0:n.params),t.params)});for(const i of Object.keys(t.params))t.params[i]===void 0&&delete this._params.params[i];(s=this.part)===null||s===void 0||s.update({params:this._params.params})}toJSON(){var t,n;const s=(n=(t=this._params)===null||t===void 0?void 0:t.params)!==null&&n!==void 0?n:{};return{id:this.id,component:this.component,params:Object.keys(s).length>0?s:void 0}}dispose(){var t;this.api.dispose(),(t=this.part)===null||t===void 0||t.dispose(),super.dispose()}}class aEe extends h4{set orientation(t){this._orientation=t}get orientation(){return this._orientation}get minimumSize(){const t=this.headerSize,s=this.isExpanded()?this._minimumBodySize:0;return t+s}get maximumSize(){const t=this.headerSize,s=this.isExpanded()?this._maximumBodySize:0;return t+s}get size(){return this._size}get orthogonalSize(){return this._orthogonalSize}set orthogonalSize(t){this._orthogonalSize=t}get minimumBodySize(){return this._minimumBodySize}set minimumBodySize(t){this._minimumBodySize=typeof t=="number"?t:0}get maximumBodySize(){return this._maximumBodySize}set maximumBodySize(t){this._maximumBodySize=typeof t=="number"?t:Number.POSITIVE_INFINITY}get headerVisible(){return this._headerVisible}set headerVisible(t){this._headerVisible=t,this.header.style.display=t?"":"none"}constructor(t){super(t.id,t.component,new oEe(t.id,t.component)),this._onDidChangeExpansionState=new Ce({replay:!0}),this.onDidChangeExpansionState=this._onDidChangeExpansionState.event,this._onDidChange=new Ce,this.onDidChange=this._onDidChange.event,this._orthogonalSize=0,this._size=0,this._isExpanded=!1,this.api.pane=this,this.api.initialize(this),this.headerSize=t.headerSize,this.headerComponent=t.headerComponent,this._minimumBodySize=t.minimumBodySize,this._maximumBodySize=t.maximumBodySize,this._isExpanded=t.isExpanded,this._headerVisible=t.isHeaderVisible,this._onDidChangeExpansionState.fire(this.isExpanded()),this._orientation=t.orientation,this.element.classList.add("dv-pane"),this.addDisposables(this.api.onWillVisibilityChange(n=>{const{isVisible:s}=n,{accessor:i}=this._params;i.setVisible(this,s)}),this.api.onDidSizeChange(n=>{this._onDidChange.fire({size:n.size})}),Vt(this.element,"mouseenter",n=>{this.api._onMouseEnter.fire(n)}),Vt(this.element,"mouseleave",n=>{this.api._onMouseLeave.fire(n)})),this.addDisposables(this._onDidChangeExpansionState,this.onDidChangeExpansionState(n=>{this.api._onDidExpansionChange.fire({isExpanded:n})}),this.api.onDidFocusChange(n=>{this.header&&(n.isFocused?M_(this.header,"focused"):Nv(this.header,"focused"))})),this.renderOnce()}setVisible(t){this.api._onDidVisibilityChange.fire({isVisible:t})}setActive(t){this.api._onDidActiveChange.fire({isActive:t})}isExpanded(){return this._isExpanded}setExpanded(t){this._isExpanded!==t&&(this._isExpanded=t,t?(this.animationTimer&&clearTimeout(this.animationTimer),this.body&&this.element.appendChild(this.body)):this.animationTimer=setTimeout(()=>{var n;(n=this.body)===null||n===void 0||n.remove()},200),this._onDidChange.fire(t?{size:this.width}:{}),this._onDidChangeExpansionState.fire(t))}layout(t,n){this._size=t,this._orthogonalSize=n;const[s,i]=this.orientation===Ke.HORIZONTAL?[t,n]:[n,t];super.layout(s,i)}init(t){var n,s;super.init(t),typeof t.minimumBodySize=="number"&&(this.minimumBodySize=t.minimumBodySize),typeof t.maximumBodySize=="number"&&(this.maximumBodySize=t.maximumBodySize),this.bodyPart=this.getBodyComponent(),this.headerPart=this.getHeaderComponent(),this.bodyPart.init(Object.assign(Object.assign({},t),{api:this.api})),this.headerPart.init(Object.assign(Object.assign({},t),{api:this.api})),(n=this.body)===null||n===void 0||n.append(this.bodyPart.element),(s=this.header)===null||s===void 0||s.append(this.headerPart.element),typeof t.isExpanded=="boolean"&&this.setExpanded(t.isExpanded)}toJSON(){const t=this._params;return Object.assign(Object.assign({},super.toJSON()),{headerComponent:this.headerComponent,title:t.title})}renderOnce(){this.header=document.createElement("div"),this.header.tabIndex=0,this.header.className="dv-pane-header",this.header.style.height=`${this.headerSize}px`,this.header.style.lineHeight=`${this.headerSize}px`,this.header.style.minHeight=`${this.headerSize}px`,this.header.style.maxHeight=`${this.headerSize}px`,this.element.appendChild(this.header),this.body=document.createElement("div"),this.body.className="dv-pane-body",this.element.appendChild(this.body)}getComponent(){return{update:t=>{var n,s;(n=this.bodyPart)===null||n===void 0||n.update({params:t}),(s=this.headerPart)===null||s===void 0||s.update({params:t})},dispose:()=>{var t,n;(t=this.bodyPart)===null||t===void 0||t.dispose(),(n=this.headerPart)===null||n===void 0||n.dispose()}}}}class rEe extends aEe{constructor(t){super({id:t.id,component:t.component,headerComponent:t.headerComponent,orientation:t.orientation,isExpanded:t.isExpanded,isHeaderVisible:!0,headerSize:t.headerSize,minimumBodySize:t.minimumBodySize,maximumBodySize:t.maximumBodySize}),this._onDidDrop=new Ce,this.onDidDrop=this._onDidDrop.event,this._onUnhandledDragOverEvent=new Ce,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this.accessor=t.accessor,this.addDisposables(this._onDidDrop,this._onUnhandledDragOverEvent),t.disableDnd||this.initDragFeatures()}initDragFeatures(){if(!this.header)return;const t=this.id,n=this.accessor.id;this.header.draggable=!0,this.handler=new class extends u4{getData(){return Wl.getInstance().setData([new ev(n,t)],ev.prototype),{dispose:()=>{Wl.getInstance().clearData(ev.prototype)}}}}(this.header),this.target=new Mr(this.element,{acceptedTargetZones:["top","bottom"],overlayModel:{activationSize:{type:"percentage",value:50}},canDisplayOverlay:(s,i)=>{const o=dg();if(o&&o.paneId!==this.id&&o.viewId===this.accessor.id)return!0;const r=new iEe(s,i,dg,this);return this._onUnhandledDragOverEvent.fire(r),r.isAccepted}}),this.addDisposables(this._onDidDrop,this.handler,this.target,this.target.onDrop(s=>{this.onDrop(s)}))}onDrop(t){const n=dg();if(!n||n.viewId!==this.accessor.id){this._onDidDrop.fire(Object.assign(Object.assign({},t),{panel:this,api:new Bv(this.accessor),getData:dg}));return}const s=this._params.containerApi,i=n.paneId,o=s.getPanel(i);if(!o){this._onDidDrop.fire(Object.assign(Object.assign({},t),{panel:this,getData:dg,api:new Bv(this.accessor)}));return}const r=s.panels,l=r.indexOf(o);let c=s.panels.indexOf(this);(t.position==="left"||t.position==="top")&&(c=Math.max(0,c-1)),(t.position==="right"||t.position==="bottom")&&(l>c&&c++,c=Math.min(r.length-1,c)),s.movePanel(l,c)}}class lEe extends jt{get element(){return this._element}constructor(t,n){super(),this.accessor=t,this.group=n,this.disposable=new so,this._onDidFocus=new Ce,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new Ce,this.onDidBlur=this._onDidBlur.event,this._element=document.createElement("div"),this._element.className="dv-content-container",this._element.tabIndex=-1,this.addDisposables(this._onDidFocus,this._onDidBlur);const s=n.dropTargetContainer;this.dropTarget=new Mr(this.element,{getOverlayOutline:()=>{var i;return((i=t.options.theme)===null||i===void 0?void 0:i.dndPanelOverlay)==="group"?this.element.parentElement:null},className:"dv-drop-target-content",acceptedTargetZones:["top","bottom","left","right","center"],canDisplayOverlay:(i,o)=>{if(this.group.locked==="no-drop-target"||this.group.locked&&o==="center")return!1;const r=Wi();return!r&&i.shiftKey&&this.group.location.type!=="floating"?!1:r&&r.viewId===this.accessor.id?!0:this.group.canDisplayOverlay(i,o,"content")},getOverrideTarget:s?()=>s.model:void 0}),this.addDisposables(this.dropTarget)}show(){this.element.style.display=""}hide(){this.element.style.display="none"}renderPanel(t,n={asActive:!0}){const s=n.asActive||this.panel&&this.group.isPanelActive(this.panel);this.panel&&this.panel.view.content.element.parentElement===this._element&&this._element.removeChild(this.panel.view.content.element),this.panel=t;let i;switch(t.api.renderer){case"onlyWhenVisible":this.group.renderContainer.detatch(t),this.panel&&s&&this._element.appendChild(this.panel.view.content.element),i=this._element;break;case"always":t.view.content.element.parentElement===this._element&&this._element.removeChild(t.view.content.element),i=this.group.renderContainer.attach({panel:t,referenceContainer:this});break;default:throw new Error(`dockview: invalid renderer type '${t.api.renderer}'`)}if(s){const o=LK(i),r=new jt;r.addDisposables(o,o.onDidFocus(()=>this._onDidFocus.fire()),o.onDidBlur(()=>this._onDidBlur.fire())),this.disposable.value=r}}openPanel(t){this.panel!==t&&this.renderPanel(t)}layout(t,n){}closePanel(){var t;this.panel&&this.panel.api.renderer==="onlyWhenVisible"&&((t=this.panel.view.content.element.parentElement)===null||t===void 0||t.removeChild(this.panel.view.content.element)),this.panel=void 0}dispose(){this.disposable.dispose(),super.dispose()}}function UK(e,t,n){var s,i;M_(t,"dv-dragged"),t.style.top="-9999px",document.body.appendChild(t),e.setDragImage(t,(s=n?.x)!==null&&s!==void 0?s:0,(i=n?.y)!==null&&i!==void 0?i:0),setTimeout(()=>{Nv(t,"dv-dragged"),t.remove()},0)}class cEe extends u4{constructor(t,n,s,i,o){super(t,o),this.accessor=n,this.group=s,this.panel=i,this.panelTransfer=Wl.getInstance()}getData(t){return this.panelTransfer.setData([new Fd(this.accessor.id,this.group.id,this.panel.id)],Fd.prototype),{dispose:()=>{this.panelTransfer.clearData(Fd.prototype)}}}}class dEe extends jt{get element(){return this._element}constructor(t,n,s){super(),this.panel=t,this.accessor=n,this.group=s,this.content=void 0,this._onPointDown=new Ce,this.onPointerDown=this._onPointDown.event,this._onDropped=new Ce,this.onDrop=this._onDropped.event,this._onDragStart=new Ce,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="dv-tab",this._element.tabIndex=0,this._element.draggable=!this.accessor.options.disableDnd,wt(this.element,"dv-inactive-tab",!0),this.dragHandler=new cEe(this._element,this.accessor,this.group,this.panel,!!this.accessor.options.disableDnd),this.dropTarget=new Mr(this._element,{acceptedTargetZones:["left","right"],overlayModel:{activationSize:{value:50,type:"percentage"}},canDisplayOverlay:(i,o)=>{if(this.group.locked)return!1;const r=Wi();return r&&this.accessor.id===r.viewId?!0:this.group.model.canDisplayOverlay(i,o,"tab")},getOverrideTarget:()=>{var i;return(i=s.model.dropTargetContainer)===null||i===void 0?void 0:i.model}}),this.onWillShowOverlay=this.dropTarget.onWillShowOverlay,this.addDisposables(this._onPointDown,this._onDropped,this._onDragStart,this.dragHandler.onDragStart(i=>{if(i.dataTransfer){const o=getComputedStyle(this.element),r=this.element.cloneNode(!0);Array.from(o).forEach(l=>r.style.setProperty(l,o.getPropertyValue(l),o.getPropertyPriority(l))),r.style.position="absolute",UK(i.dataTransfer,r,{y:-10,x:30})}this._onDragStart.fire(i)}),this.dragHandler,Vt(this._element,"pointerdown",i=>{this._onPointDown.fire(i)}),this.dropTarget.onDrop(i=>{this._onDropped.fire(i)}),this.dropTarget)}setActive(t){wt(this.element,"dv-active-tab",t),wt(this.element,"dv-inactive-tab",!t)}setContent(t){this.content&&this._element.removeChild(this.content.element),this.content=t,this._element.appendChild(this.content.element)}updateDragAndDropState(){this._element.draggable=!this.accessor.options.disableDnd,this.dragHandler.setDisabled(!!this.accessor.options.disableDnd)}dispose(){super.dispose()}}class R_{get kind(){return this.options.kind}get nativeEvent(){return this.event.nativeEvent}get position(){return this.event.position}get defaultPrevented(){return this.event.defaultPrevented}get panel(){return this.options.panel}get api(){return this.options.api}get group(){return this.options.group}preventDefault(){this.event.preventDefault()}getData(){return this.options.getData()}constructor(t,n){this.event=t,this.options=n}}class uEe extends u4{constructor(t,n,s,i){super(t,i),this.accessor=n,this.group=s,this.panelTransfer=Wl.getInstance(),this.addDisposables(Vt(t,"pointerdown",o=>{o.shiftKey&&Eje(o)},!0))}isCancelled(t){return this.group.api.location.type==="floating"&&!t.shiftKey}getData(t){const n=t.dataTransfer;this.panelTransfer.setData([new Fd(this.accessor.id,this.group.id,null)],Fd.prototype);const s=window.getComputedStyle(this.el),i=s.getPropertyValue("--dv-activegroup-visiblepanel-tab-background-color"),o=s.getPropertyValue("--dv-activegroup-visiblepanel-tab-color");if(n){const r=document.createElement("div");r.style.backgroundColor=i,r.style.color=o,r.style.padding="2px 8px",r.style.height="24px",r.style.fontSize="11px",r.style.lineHeight="20px",r.style.borderRadius="12px",r.style.position="absolute",r.style.pointerEvents="none",r.style.top="-9999px",r.textContent=`Multiple Panels (${this.group.size})`,UK(n,r,{y:-10,x:30})}return{dispose:()=>{this.panelTransfer.clearData(Fd.prototype)}}}}class hEe extends jt{get element(){return this._element}constructor(t,n){super(),this.accessor=t,this.group=n,this._onDrop=new Ce,this.onDrop=this._onDrop.event,this._onDragStart=new Ce,this.onDragStart=this._onDragStart.event,this._element=document.createElement("div"),this._element.className="dv-void-container",this._element.draggable=!this.accessor.options.disableDnd,wt(this._element,"dv-draggable",!this.accessor.options.disableDnd),this.addDisposables(this._onDrop,this._onDragStart,Vt(this._element,"pointerdown",()=>{this.accessor.doSetGroupActive(this.group)})),this.handler=new uEe(this._element,t,n,!!this.accessor.options.disableDnd),this.dropTarget=new Mr(this._element,{acceptedTargetZones:["center"],canDisplayOverlay:(s,i)=>{const o=Wi();return o&&this.accessor.id===o.viewId?!0:n.model.canDisplayOverlay(s,i,"header_space")},getOverrideTarget:()=>{var s;return(s=n.model.dropTargetContainer)===null||s===void 0?void 0:s.model}}),this.onWillShowOverlay=this.dropTarget.onWillShowOverlay,this.addDisposables(this.handler,this.handler.onDragStart(s=>{this._onDragStart.fire(s)}),this.dropTarget.onDrop(s=>{this._onDrop.fire(s)}),this.dropTarget)}updateDragAndDropState(){this._element.draggable=!this.accessor.options.disableDnd,wt(this._element,"dv-draggable",!this.accessor.options.disableDnd),this.handler.setDisabled(!!this.accessor.options.disableDnd)}}class O_ extends jt{get element(){return this._element}constructor(t){super(),this.scrollableElement=t,this._scrollLeft=0,this._element=document.createElement("div"),this._element.className="dv-scrollable",this._horizontalScrollbar=document.createElement("div"),this._horizontalScrollbar.className="dv-scrollbar-horizontal",this.element.appendChild(t),this.element.appendChild(this._horizontalScrollbar),this.addDisposables(Vt(this.element,"wheel",n=>{this._scrollLeft+=n.deltaY*O_.MouseWheelSpeed,this.calculateScrollbarStyles()}),Vt(this._horizontalScrollbar,"pointerdown",n=>{n.preventDefault(),wt(this.element,"dv-scrollable-scrolling",!0);const s=n.clientX,i=this._scrollLeft,o=l=>{const c=l.clientX-s,{clientWidth:d}=this.element,{scrollWidth:u}=this.scrollableElement,p=d/u;this._scrollLeft=i+c/p,this.calculateScrollbarStyles()},r=()=>{wt(this.element,"dv-scrollable-scrolling",!1),document.removeEventListener("pointermove",o),document.removeEventListener("pointerup",r),document.removeEventListener("pointercancel",r)};document.addEventListener("pointermove",o),document.addEventListener("pointerup",r),document.addEventListener("pointercancel",r)}),Vt(this.element,"scroll",()=>{this.calculateScrollbarStyles()}),Vt(this.scrollableElement,"scroll",()=>{this._scrollLeft=this.scrollableElement.scrollLeft,this.calculateScrollbarStyles()}),D_(this.element,()=>{wt(this.element,"dv-scrollable-resizing",!0),this._animationTimer&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(()=>{clearTimeout(this._animationTimer),wt(this.element,"dv-scrollable-resizing",!1)},500),this.calculateScrollbarStyles()}))}calculateScrollbarStyles(){const{clientWidth:t}=this.element,{scrollWidth:n}=this.scrollableElement;if(n>t){const i=t*(t/n);this._horizontalScrollbar.style.width=`${i}px`,this._scrollLeft=es(this._scrollLeft,0,this.scrollableElement.scrollWidth-t),this.scrollableElement.scrollLeft=this._scrollLeft;const o=this._scrollLeft/(n-t);this._horizontalScrollbar.style.left=`${(t-i)*o}px`}else this._horizontalScrollbar.style.width="0px",this._horizontalScrollbar.style.left="0px",this._scrollLeft=0}}O_.MouseWheelSpeed=1;class pEe extends jt{get showTabsOverflowControl(){return this._showTabsOverflowControl}set showTabsOverflowControl(t){if(this._showTabsOverflowControl!=t&&(this._showTabsOverflowControl=t,t)){const n=new Ije(this._tabsList);this._observerDisposable.value=new jt(n,n.onDidChange(s=>{const i=s.hasScrollX||s.hasScrollY;this.toggleDropdown({reset:!i})}),Vt(this._tabsList,"scroll",()=>{this.toggleDropdown({reset:!1})}))}}get element(){return this._element}get panels(){return this._tabs.map(t=>t.value.panel.id)}get size(){return this._tabs.length}get tabs(){return this._tabs.map(t=>t.value)}constructor(t,n,s){if(super(),this.group=t,this.accessor=n,this._observerDisposable=new so,this._tabs=[],this.selectedIndex=-1,this._showTabsOverflowControl=!1,this._onTabDragStart=new Ce,this.onTabDragStart=this._onTabDragStart.event,this._onDrop=new Ce,this.onDrop=this._onDrop.event,this._onWillShowOverlay=new Ce,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onOverflowTabsChange=new Ce,this.onOverflowTabsChange=this._onOverflowTabsChange.event,this._tabsList=document.createElement("div"),this._tabsList.className="dv-tabs-container dv-horizontal",this.showTabsOverflowControl=s.showTabsOverflowControl,n.options.scrollbars==="native")this._element=this._tabsList;else{const i=new O_(this._tabsList);this._element=i.element,this.addDisposables(i)}this.addDisposables(this._onOverflowTabsChange,this._observerDisposable,this._onWillShowOverlay,this._onDrop,this._onTabDragStart,Vt(this.element,"pointerdown",i=>{if(i.defaultPrevented)return;i.button===0&&this.accessor.doSetGroupActive(this.group)}),Bs.from(()=>{for(const{value:i,disposable:o}of this._tabs)o.dispose(),i.dispose();this._tabs=[]}))}indexOf(t){return this._tabs.findIndex(n=>n.value.panel.id===t)}isActive(t){return this.selectedIndex>-1&&this._tabs[this.selectedIndex].value===t}setActivePanel(t){let n=0;for(const s of this._tabs){const i=t.id===s.value.panel.id;if(s.value.setActive(i),i){const o=s.value.element,r=o.parentElement;(n<r.scrollLeft||n+o.clientWidth>r.scrollLeft+r.clientWidth)&&(r.scrollLeft=n)}n+=s.value.element.clientWidth}}openPanel(t,n=this._tabs.length){if(this._tabs.find(r=>r.value.panel.id===t.id))return;const s=new dEe(t,this.accessor,this.group);s.setContent(t.view.tab);const i=new jt(s.onDragStart(r=>{this._onTabDragStart.fire({nativeEvent:r,panel:t})}),s.onPointerDown(r=>{if(r.defaultPrevented)return;const l=!this.accessor.options.disableFloatingGroups,c=this.group.api.location.type==="floating"&&this.size===1;if(l&&!c&&r.shiftKey){r.preventDefault();const d=this.accessor.getGroupPanel(s.panel.id),{top:u,left:p}=s.element.getBoundingClientRect(),{top:m,left:f}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(d,{x:p-f,y:u-m,inDragMode:!0});return}switch(r.button){case 0:this.group.activePanel!==t&&this.group.model.openPanel(t);break}}),s.onDrop(r=>{this._onDrop.fire({event:r.nativeEvent,index:this._tabs.findIndex(l=>l.value===s)})}),s.onWillShowOverlay(r=>{this._onWillShowOverlay.fire(new R_(r,{kind:"tab",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:Wi}))})),o={value:s,disposable:i};this.addTab(o,n)}delete(t){const n=this.indexOf(t),s=this._tabs.splice(n,1)[0],{value:i,disposable:o}=s;o.dispose(),i.dispose(),i.element.remove()}addTab(t,n=this._tabs.length){if(n<0||n>this._tabs.length)throw new Error("invalid location");this._tabsList.insertBefore(t.value.element,this._tabsList.children[n]),this._tabs=[...this._tabs.slice(0,n),t,...this._tabs.slice(n)],this.selectedIndex<0&&(this.selectedIndex=n)}toggleDropdown(t){const n=t.reset?[]:this._tabs.filter(s=>!Lje(s.value.element,this._tabsList)).map(s=>s.value.panel.id);this._onOverflowTabsChange.fire({tabs:n,reset:t.reset})}updateDragAndDropState(){for(const t of this._tabs)t.value.updateDragAndDropState()}}const p4=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttributeNS(null,"height",e.height),t.setAttributeNS(null,"width",e.width),t.setAttributeNS(null,"viewBox",e.viewbox),t.setAttributeNS(null,"aria-hidden","false"),t.setAttributeNS(null,"focusable","false"),t.classList.add("dv-svg");const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttributeNS(null,"d",e.path),t.appendChild(n),t},fEe=()=>p4({width:"11",height:"11",viewbox:"0 0 28 28",path:"M2.1 27.3L0 25.2L11.55 13.65L0 2.1L2.1 0L13.65 11.55L25.2 0L27.3 2.1L15.75 13.65L27.3 25.2L25.2 27.3L13.65 15.75L2.1 27.3Z"}),mEe=()=>p4({width:"11",height:"11",viewbox:"0 0 24 15",path:"M12 14.15L0 2.15L2.15 0L12 9.9L21.85 0.0499992L24 2.2L12 14.15Z"}),qK=()=>p4({width:"11",height:"11",viewbox:"0 0 15 25",path:"M2.15 24.1L0 21.95L9.9 12.05L0 2.15L2.15 0L14.2 12.05L2.15 24.1Z"});function gEe(){const e=document.createElement("div");e.className="dv-tabs-overflow-dropdown-default";const t=document.createElement("span");t.textContent="";const n=qK();return e.appendChild(n),e.appendChild(t),{element:e,update:s=>{t.textContent=`${s.tabs}`}}}class vEe extends jt{get onTabDragStart(){return this.tabs.onTabDragStart}get panels(){return this.tabs.panels}get size(){return this.tabs.size}get hidden(){return this._hidden}set hidden(t){this._hidden=t,this.element.style.display=t?"none":""}get element(){return this._element}constructor(t,n){super(),this.accessor=t,this.group=n,this._hidden=!1,this.dropdownPart=null,this._overflowTabs=[],this._dropdownDisposable=new so,this._onDrop=new Ce,this.onDrop=this._onDrop.event,this._onGroupDragStart=new Ce,this.onGroupDragStart=this._onGroupDragStart.event,this._onWillShowOverlay=new Ce,this.onWillShowOverlay=this._onWillShowOverlay.event,this._element=document.createElement("div"),this._element.className="dv-tabs-and-actions-container",wt(this._element,"dv-full-width-single-tab",this.accessor.options.singleTabMode==="fullwidth"),this.rightActionsContainer=document.createElement("div"),this.rightActionsContainer.className="dv-right-actions-container",this.leftActionsContainer=document.createElement("div"),this.leftActionsContainer.className="dv-left-actions-container",this.preActionsContainer=document.createElement("div"),this.preActionsContainer.className="dv-pre-actions-container",this.tabs=new pEe(n,t,{showTabsOverflowControl:!t.options.disableTabsOverflowList}),this.voidContainer=new hEe(this.accessor,this.group),this._element.appendChild(this.preActionsContainer),this._element.appendChild(this.tabs.element),this._element.appendChild(this.leftActionsContainer),this._element.appendChild(this.voidContainer.element),this._element.appendChild(this.rightActionsContainer),this.addDisposables(this.tabs.onDrop(s=>this._onDrop.fire(s)),this.tabs.onWillShowOverlay(s=>this._onWillShowOverlay.fire(s)),t.onDidOptionsChange(()=>{this.tabs.showTabsOverflowControl=!t.options.disableTabsOverflowList}),this.tabs.onOverflowTabsChange(s=>{this.toggleDropdown(s)}),this.tabs,this._onWillShowOverlay,this._onDrop,this._onGroupDragStart,this.voidContainer,this.voidContainer.onDragStart(s=>{this._onGroupDragStart.fire({nativeEvent:s,group:this.group})}),this.voidContainer.onDrop(s=>{this._onDrop.fire({event:s.nativeEvent,index:this.tabs.size})}),this.voidContainer.onWillShowOverlay(s=>{this._onWillShowOverlay.fire(new R_(s,{kind:"header_space",panel:this.group.activePanel,api:this.accessor.api,group:this.group,getData:Wi}))}),Vt(this.voidContainer.element,"pointerdown",s=>{if(s.defaultPrevented)return;if(!this.accessor.options.disableFloatingGroups&&s.shiftKey&&this.group.api.location.type!=="floating"){s.preventDefault();const{top:o,left:r}=this.element.getBoundingClientRect(),{top:l,left:c}=this.accessor.element.getBoundingClientRect();this.accessor.addFloatingGroup(this.group,{x:r-c+20,y:o-l+20,inDragMode:!0})}}))}show(){this.hidden||(this.element.style.display="")}hide(){this._element.style.display="none"}setRightActionsElement(t){this.rightActions!==t&&(this.rightActions&&(this.rightActions.remove(),this.rightActions=void 0),t&&(this.rightActionsContainer.appendChild(t),this.rightActions=t))}setLeftActionsElement(t){this.leftActions!==t&&(this.leftActions&&(this.leftActions.remove(),this.leftActions=void 0),t&&(this.leftActionsContainer.appendChild(t),this.leftActions=t))}setPrefixActionsElement(t){this.preActions!==t&&(this.preActions&&(this.preActions.remove(),this.preActions=void 0),t&&(this.preActionsContainer.appendChild(t),this.preActions=t))}isActive(t){return this.tabs.isActive(t)}indexOf(t){return this.tabs.indexOf(t)}setActive(t){}delete(t){this.tabs.delete(t),this.updateClassnames()}setActivePanel(t){this.tabs.setActivePanel(t)}openPanel(t,n=this.tabs.size){this.tabs.openPanel(t,n),this.updateClassnames()}closePanel(t){this.delete(t.id)}updateClassnames(){wt(this._element,"dv-single-tab",this.size===1)}toggleDropdown(t){const n=t.reset?[]:t.tabs;if(this._overflowTabs=n,this._overflowTabs.length>0&&this.dropdownPart){this.dropdownPart.update({tabs:n.length});return}if(this._overflowTabs.length===0){this._dropdownDisposable.dispose();return}const s=document.createElement("div");s.className="dv-tabs-overflow-dropdown-root";const i=gEe();i.update({tabs:n.length}),this.dropdownPart=i,s.appendChild(i.element),this.rightActionsContainer.prepend(s),this._dropdownDisposable.value=new jt(Bs.from(()=>{var o,r;s.remove(),(r=(o=this.dropdownPart)===null||o===void 0?void 0:o.dispose)===null||r===void 0||r.call(o),this.dropdownPart=null}),Vt(s,"pointerdown",o=>{o.preventDefault()},{capture:!0}),Vt(s,"click",o=>{const r=document.createElement("div");r.style.overflow="auto",r.className="dv-tabs-overflow-container";for(const c of this.tabs.tabs.filter(d=>this._overflowTabs.includes(d.panel.id))){const d=this.group.panels.find(f=>f===c.panel),p=d.view.createTabRenderer("headerOverflow").element,m=document.createElement("div");wt(m,"dv-tab",!0),wt(m,"dv-active-tab",d.api.isActive),wt(m,"dv-inactive-tab",!d.api.isActive),m.addEventListener("click",f=>{this.accessor.popupService.close(),!f.defaultPrevented&&(c.element.scrollIntoView(),c.panel.api.setActive())}),m.appendChild(p),r.appendChild(m)}const l=Fje(s);this.accessor.popupService.openPopover(r,{x:o.clientX,y:o.clientY,zIndex:l?.style.zIndex?`calc(${l.style.zIndex} * 2)`:void 0})}))}updateDragAndDropState(){this.tabs.updateDragAndDropState(),this.voidContainer.updateDragAndDropState()}}class KK extends MK{constructor(t,n,s,i,o){super(),this.nativeEvent=t,this.target=n,this.position=s,this.getData=i,this.group=o}}const bP=Object.keys({disableAutoResizing:void 0,hideBorders:void 0,singleTabMode:void 0,disableFloatingGroups:void 0,floatingGroupBounds:void 0,popoutUrl:void 0,defaultRenderer:void 0,debug:void 0,rootOverlayModel:void 0,locked:void 0,disableDnd:void 0,className:void 0,noPanelsOverlay:void 0,dndEdges:void 0,theme:void 0,disableTabsOverflowList:void 0,scrollbars:void 0});function yEe(e){return!!e.referencePanel}function bEe(e){return!!e.referenceGroup}function xEe(e){return!!e.referencePanel}function CEe(e){return!!e.referenceGroup}class f4 extends l4{get nativeEvent(){return this.options.nativeEvent}get position(){return this.options.position}get panel(){return this.options.panel}get group(){return this.options.group}get api(){return this.options.api}constructor(t){super(),this.options=t}getData(){return this.options.getData()}}class ZK extends f4{get kind(){return this._kind}constructor(t){super(t),this._kind=t.kind}}class wEe extends jt{get element(){throw new Error("dockview: not supported")}get activePanel(){return this._activePanel}get locked(){return this._locked}set locked(t){this._locked=t,wt(this.container,"dv-locked-groupview",t==="no-drop-target"||t)}get isActive(){return this._isGroupActive}get panels(){return this._panels}get size(){return this._panels.length}get isEmpty(){return this._panels.length===0}get hasWatermark(){return!!(this.watermark&&this.container.contains(this.watermark.element))}get header(){return this.tabsContainer}get isContentFocused(){return document.activeElement?uP(document.activeElement,this.contentContainer.element):!1}get location(){return this._location}set location(t){switch(this._location=t,wt(this.container,"dv-groupview-floating",!1),wt(this.container,"dv-groupview-popout",!1),t.type){case"grid":this.contentContainer.dropTarget.setTargetZones(["top","bottom","left","right","center"]);break;case"floating":this.contentContainer.dropTarget.setTargetZones(["center"]),this.contentContainer.dropTarget.setTargetZones(t?["center"]:["top","bottom","left","right","center"]),wt(this.container,"dv-groupview-floating",!0);break;case"popout":this.contentContainer.dropTarget.setTargetZones(["center"]),wt(this.container,"dv-groupview-popout",!0);break}this.groupPanel.api._onDidLocationChange.fire({location:this.location})}constructor(t,n,s,i,o){var r;super(),this.container=t,this.accessor=n,this.id=s,this.options=i,this.groupPanel=o,this._isGroupActive=!1,this._locked=!1,this._location={type:"grid"},this.mostRecentlyUsed=[],this._overwriteRenderContainer=null,this._overwriteDropTargetContainer=null,this._onDidChange=new Ce,this.onDidChange=this._onDidChange.event,this._width=0,this._height=0,this._panels=[],this._panelDisposables=new Map,this._onMove=new Ce,this.onMove=this._onMove.event,this._onDidDrop=new Ce,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new Ce,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new Ce,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onTabDragStart=new Ce,this.onTabDragStart=this._onTabDragStart.event,this._onGroupDragStart=new Ce,this.onGroupDragStart=this._onGroupDragStart.event,this._onDidAddPanel=new Ce,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidPanelTitleChange=new Ce,this.onDidPanelTitleChange=this._onDidPanelTitleChange.event,this._onDidPanelParametersChange=new Ce,this.onDidPanelParametersChange=this._onDidPanelParametersChange.event,this._onDidRemovePanel=new Ce,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidActivePanelChange=new Ce,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onUnhandledDragOverEvent=new Ce,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,wt(this.container,"dv-groupview",!0),this._api=new zv(this.accessor),this.tabsContainer=new vEe(this.accessor,this.groupPanel),this.contentContainer=new lEe(this.accessor,this),t.append(this.tabsContainer.element,this.contentContainer.element),this.header.hidden=!!i.hideHeader,this.locked=(r=i.locked)!==null&&r!==void 0?r:!1,this.addDisposables(this._onTabDragStart,this._onGroupDragStart,this._onWillShowOverlay,this.tabsContainer.onTabDragStart(l=>{this._onTabDragStart.fire(l)}),this.tabsContainer.onGroupDragStart(l=>{this._onGroupDragStart.fire(l)}),this.tabsContainer.onDrop(l=>{this.handleDropEvent("header",l.event,"center",l.index)}),this.contentContainer.onDidFocus(()=>{this.accessor.doSetGroupActive(this.groupPanel)}),this.contentContainer.onDidBlur(()=>{}),this.contentContainer.dropTarget.onDrop(l=>{this.handleDropEvent("content",l.nativeEvent,l.position)}),this.tabsContainer.onWillShowOverlay(l=>{this._onWillShowOverlay.fire(l)}),this.contentContainer.dropTarget.onWillShowOverlay(l=>{this._onWillShowOverlay.fire(new R_(l,{kind:"content",panel:this.activePanel,api:this._api,group:this.groupPanel,getData:Wi}))}),this._onMove,this._onDidChange,this._onDidDrop,this._onWillDrop,this._onDidAddPanel,this._onDidRemovePanel,this._onDidActivePanelChange,this._onUnhandledDragOverEvent,this._onDidPanelTitleChange,this._onDidPanelParametersChange)}focusContent(){this.contentContainer.element.focus()}set renderContainer(t){this.panels.forEach(n=>{this.renderContainer.detatch(n)}),this._overwriteRenderContainer=t,this.panels.forEach(n=>{this.rerender(n)})}get renderContainer(){var t;return(t=this._overwriteRenderContainer)!==null&&t!==void 0?t:this.accessor.overlayRenderContainer}set dropTargetContainer(t){this._overwriteDropTargetContainer=t}get dropTargetContainer(){var t;return(t=this._overwriteDropTargetContainer)!==null&&t!==void 0?t:this.accessor.rootDropTargetContainer}initialize(){this.options.panels&&this.options.panels.forEach(t=>{this.doAddPanel(t)}),this.options.activePanel&&this.openPanel(this.options.activePanel),this.setActive(this.isActive,!0),this.updateContainer(),this.accessor.options.createRightHeaderActionComponent&&(this._rightHeaderActions=this.accessor.options.createRightHeaderActionComponent(this.groupPanel),this.addDisposables(this._rightHeaderActions),this._rightHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setRightActionsElement(this._rightHeaderActions.element)),this.accessor.options.createLeftHeaderActionComponent&&(this._leftHeaderActions=this.accessor.options.createLeftHeaderActionComponent(this.groupPanel),this.addDisposables(this._leftHeaderActions),this._leftHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setLeftActionsElement(this._leftHeaderActions.element)),this.accessor.options.createPrefixHeaderActionComponent&&(this._prefixHeaderActions=this.accessor.options.createPrefixHeaderActionComponent(this.groupPanel),this.addDisposables(this._prefixHeaderActions),this._prefixHeaderActions.init({containerApi:this._api,api:this.groupPanel.api,group:this.groupPanel}),this.tabsContainer.setPrefixActionsElement(this._prefixHeaderActions.element))}rerender(t){this.contentContainer.renderPanel(t,{asActive:!1})}indexOf(t){return this.tabsContainer.indexOf(t.id)}toJSON(){var t;const n={views:this.tabsContainer.panels,activeView:(t=this._activePanel)===null||t===void 0?void 0:t.id,id:this.id};return this.locked!==!1&&(n.locked=this.locked),this.header.hidden&&(n.hideHeader=!0),n}moveToNext(t){t||(t={}),t.panel||(t.panel=this.activePanel);const n=t.panel?this.panels.indexOf(t.panel):-1;let s;if(n<this.panels.length-1)s=n+1;else if(!t.suppressRoll)s=0;else return;this.openPanel(this.panels[s])}moveToPrevious(t){if(t||(t={}),t.panel||(t.panel=this.activePanel),!t.panel)return;const n=this.panels.indexOf(t.panel);let s;if(n>0)s=n-1;else if(!t.suppressRoll)s=this.panels.length-1;else return;this.openPanel(this.panels[s])}containsPanel(t){return this.panels.includes(t)}init(t){}update(t){}focus(){var t;(t=this._activePanel)===null||t===void 0||t.focus()}openPanel(t,n={}){(typeof n.index!="number"||n.index>this.panels.length)&&(n.index=this.panels.length);const s=!!n.skipSetActive;if(t.updateParentGroup(this.groupPanel,{skipSetActive:n.skipSetActive}),this.doAddPanel(t,n.index,{skipSetActive:s}),this._activePanel===t){this.contentContainer.renderPanel(t,{asActive:!0});return}s||this.doSetActivePanel(t),n.skipSetGroupActive||this.accessor.doSetGroupActive(this.groupPanel),n.skipSetActive||this.updateContainer()}removePanel(t,n={skipSetActive:!1}){const s=typeof t=="string"?t:t.id,i=this._panels.find(o=>o.id===s);if(!i)throw new Error("invalid operation");return this._removePanel(i,n)}closeAllPanels(){if(this.panels.length>0){const t=[...this.panels];for(const n of t)this.doClose(n)}else this.accessor.removeGroup(this.groupPanel)}closePanel(t){this.doClose(t)}doClose(t){const n=this.panels.length===1&&this.accessor.groups.length===1;this.accessor.removePanel(t,n&&this.accessor.options.noPanelsOverlay==="emptyGroup"?{removeEmptyGroup:!1}:void 0)}isPanelActive(t){return this._activePanel===t}updateActions(t){this.tabsContainer.setRightActionsElement(t)}setActive(t,n=!1){!n&&this.isActive===t||(this._isGroupActive=t,wt(this.container,"dv-active-group",t),wt(this.container,"dv-inactive-group",!t),this.tabsContainer.setActive(this.isActive),!this._activePanel&&this.panels.length>0&&this.doSetActivePanel(this.panels[0]),this.updateContainer())}layout(t,n){var s;this._width=t,this._height=n,this.contentContainer.layout(this._width,this._height),!((s=this._activePanel)===null||s===void 0)&&s.layout&&this._activePanel.layout(this._width,this._height)}_removePanel(t,n){const s=this._activePanel===t;if(this.doRemovePanel(t),s&&this.panels.length>0){const i=this.mostRecentlyUsed[0];this.openPanel(i,{skipSetActive:n.skipSetActive,skipSetGroupActive:n.skipSetActiveGroup})}return this._activePanel&&this.panels.length===0&&this.doSetActivePanel(void 0),n.skipSetActive||this.updateContainer(),t}doRemovePanel(t){const n=this.panels.indexOf(t);if(this._activePanel===t&&this.contentContainer.closePanel(),this.tabsContainer.delete(t.id),this._panels.splice(n,1),this.mostRecentlyUsed.includes(t)){const i=this.mostRecentlyUsed.indexOf(t);this.mostRecentlyUsed.splice(i,1)}const s=this._panelDisposables.get(t.id);s&&(s.dispose(),this._panelDisposables.delete(t.id)),this._onDidRemovePanel.fire({panel:t})}doAddPanel(t,n=this.panels.length,s={skipSetActive:!1}){const o=this._panels.indexOf(t)>-1;this.tabsContainer.show(),this.contentContainer.show(),this.tabsContainer.openPanel(t,n),s.skipSetActive||this.contentContainer.openPanel(t),!o&&(this.updateMru(t),this.panels.splice(n,0,t),this._panelDisposables.set(t.id,new jt(t.api.onDidTitleChange(r=>this._onDidPanelTitleChange.fire(r)),t.api.onDidParametersChange(r=>this._onDidPanelParametersChange.fire(r)))),this._onDidAddPanel.fire({panel:t}))}doSetActivePanel(t){this._activePanel!==t&&(this._activePanel=t,t&&(this.tabsContainer.setActivePanel(t),t.layout(this._width,this._height),this.updateMru(t),this._onDidActivePanelChange.fire({panel:t})))}updateMru(t){this.mostRecentlyUsed.includes(t)&&this.mostRecentlyUsed.splice(this.mostRecentlyUsed.indexOf(t),1),this.mostRecentlyUsed=[t,...this.mostRecentlyUsed]}updateContainer(){var t,n;if(this.panels.forEach(s=>s.runEvents()),this.isEmpty&&!this.watermark){const s=this.accessor.createWatermarkComponent();s.init({containerApi:this._api,group:this.groupPanel}),this.watermark=s,Vt(this.watermark.element,"pointerdown",()=>{this.isActive||this.accessor.doSetGroupActive(this.groupPanel)}),this.contentContainer.element.appendChild(this.watermark.element)}!this.isEmpty&&this.watermark&&(this.watermark.element.remove(),(n=(t=this.watermark).dispose)===null||n===void 0||n.call(t),this.watermark=void 0)}canDisplayOverlay(t,n,s){const i=new KK(t,s,n,Wi,this.accessor.getPanel(this.id));return this._onUnhandledDragOverEvent.fire(i),i.isAccepted}handleDropEvent(t,n,s,i){if(this.locked==="no-drop-target")return;function o(){switch(t){case"header":return typeof i=="number"?"tab":"header_space";case"content":return"content"}}const r=typeof i=="number"?this.panels[i]:void 0,l=new ZK({nativeEvent:n,position:s,panel:r,getData:()=>Wi(),kind:o(),group:this.groupPanel,api:this._api});if(this._onWillDrop.fire(l),l.defaultPrevented)return;const c=Wi();if(c&&c.viewId===this.accessor.id){if(t==="content"&&c.groupId===this.id&&(s==="center"||c.panelId===null)||t==="header"&&c.groupId===this.id&&c.panelId===null)return;if(c.panelId===null){const{groupId:f}=c;this._onMove.fire({target:s,groupId:f,index:i});return}if(this.tabsContainer.indexOf(c.panelId)!==-1&&this.tabsContainer.size===1)return;const{groupId:u,panelId:p}=c;if(this.id===u&&!s&&this.tabsContainer.indexOf(p)===i)return;this._onMove.fire({target:s,groupId:c.groupId,itemId:c.panelId,index:i})}else this._onDidDrop.fire(new f4({nativeEvent:n,position:s,panel:r,getData:()=>Wi(),group:this.groupPanel,api:this._api}))}updateDragAndDropState(){this.tabsContainer.updateDragAndDropState()}dispose(){var t,n,s;super.dispose(),(t=this.watermark)===null||t===void 0||t.element.remove(),(s=(n=this.watermark)===null||n===void 0?void 0:n.dispose)===null||s===void 0||s.call(n),this.watermark=void 0;for(const i of this.panels)i.dispose();this.tabsContainer.dispose(),this.contentContainer.dispose()}}class m4 extends HK{constructor(t,n,s){super(t,n),this._onDidConstraintsChangeInternal=new Ce,this.onDidConstraintsChangeInternal=this._onDidConstraintsChangeInternal.event,this._onDidConstraintsChange=new Ce,this.onDidConstraintsChange=this._onDidConstraintsChange.event,this._onDidSizeChange=new Ce,this.onDidSizeChange=this._onDidSizeChange.event,this.addDisposables(this._onDidConstraintsChangeInternal,this._onDidConstraintsChange,this._onDidSizeChange),s&&this.initialize(s)}setConstraints(t){this._onDidConstraintsChangeInternal.fire(t)}setSize(t){this._onDidSizeChange.fire(t)}}class Fo extends h4{get priority(){return this._priority}get snap(){return this._snap}get minimumWidth(){return this.__minimumWidth()}get minimumHeight(){return this.__minimumHeight()}get maximumHeight(){return this.__maximumHeight()}get maximumWidth(){return this.__maximumWidth()}__minimumWidth(){const t=typeof this._minimumWidth=="function"?this._minimumWidth():this._minimumWidth;return t!==this._evaluatedMinimumWidth&&(this._evaluatedMinimumWidth=t,this.updateConstraints()),t}__maximumWidth(){const t=typeof this._maximumWidth=="function"?this._maximumWidth():this._maximumWidth;return t!==this._evaluatedMaximumWidth&&(this._evaluatedMaximumWidth=t,this.updateConstraints()),t}__minimumHeight(){const t=typeof this._minimumHeight=="function"?this._minimumHeight():this._minimumHeight;return t!==this._evaluatedMinimumHeight&&(this._evaluatedMinimumHeight=t,this.updateConstraints()),t}__maximumHeight(){const t=typeof this._maximumHeight=="function"?this._maximumHeight():this._maximumHeight;return t!==this._evaluatedMaximumHeight&&(this._evaluatedMaximumHeight=t,this.updateConstraints()),t}get isActive(){return this.api.isActive}get isVisible(){return this.api.isVisible}constructor(t,n,s,i){super(t,n,i??new m4(t,n)),this._evaluatedMinimumWidth=0,this._evaluatedMaximumWidth=Number.MAX_SAFE_INTEGER,this._evaluatedMinimumHeight=0,this._evaluatedMaximumHeight=Number.MAX_SAFE_INTEGER,this._minimumWidth=0,this._minimumHeight=0,this._maximumWidth=Number.MAX_SAFE_INTEGER,this._maximumHeight=Number.MAX_SAFE_INTEGER,this._snap=!1,this._onDidChange=new Ce,this.onDidChange=this._onDidChange.event,typeof s?.minimumWidth=="number"&&(this._minimumWidth=s.minimumWidth),typeof s?.maximumWidth=="number"&&(this._maximumWidth=s.maximumWidth),typeof s?.minimumHeight=="number"&&(this._minimumHeight=s.minimumHeight),typeof s?.maximumHeight=="number"&&(this._maximumHeight=s.maximumHeight),this.api.initialize(this),this.addDisposables(this.api.onWillVisibilityChange(o=>{const{isVisible:r}=o,{accessor:l}=this._params;l.setVisible(this,r)}),this.api.onActiveChange(()=>{const{accessor:o}=this._params;o.doSetGroupActive(this)}),this.api.onDidConstraintsChangeInternal(o=>{(typeof o.minimumWidth=="number"||typeof o.minimumWidth=="function")&&(this._minimumWidth=o.minimumWidth),(typeof o.minimumHeight=="number"||typeof o.minimumHeight=="function")&&(this._minimumHeight=o.minimumHeight),(typeof o.maximumWidth=="number"||typeof o.maximumWidth=="function")&&(this._maximumWidth=o.maximumWidth),(typeof o.maximumHeight=="number"||typeof o.maximumHeight=="function")&&(this._maximumHeight=o.maximumHeight)}),this.api.onDidSizeChange(o=>{this._onDidChange.fire({height:o.height,width:o.width})}),this._onDidChange)}setVisible(t){this.api._onDidVisibilityChange.fire({isVisible:t})}setActive(t){this.api._onDidActiveChange.fire({isActive:t})}init(t){t.maximumHeight&&(this._maximumHeight=t.maximumHeight),t.minimumHeight&&(this._minimumHeight=t.minimumHeight),t.maximumWidth&&(this._maximumWidth=t.maximumWidth),t.minimumWidth&&(this._minimumWidth=t.minimumWidth),this._priority=t.priority,this._snap=!!t.snap,super.init(t),typeof t.isVisible=="boolean"&&this.setVisible(t.isVisible)}updateConstraints(){this.api._onDidConstraintsChange.fire({minimumWidth:this._evaluatedMinimumWidth,maximumWidth:this._evaluatedMaximumWidth,minimumHeight:this._evaluatedMinimumHeight,maximumHeight:this._evaluatedMaximumHeight})}toJSON(){const t=super.toJSON(),n=i=>i===Number.MAX_SAFE_INTEGER?void 0:i,s=i=>i<=0?void 0:i;return Object.assign(Object.assign({},t),{minimumHeight:s(this.minimumHeight),maximumHeight:n(this.maximumHeight),minimumWidth:s(this.minimumWidth),maximumWidth:n(this.maximumWidth),snap:this.snap,priority:this.priority})}}const ug="dockview: DockviewGroupPanelApiImpl not initialized";class _Ee extends m4{get location(){if(!this._group)throw new Error(ug);return this._group.model.location}constructor(t,n){super(t,"__dockviewgroup__"),this.accessor=n,this._onDidLocationChange=new Ce,this.onDidLocationChange=this._onDidLocationChange.event,this._onDidActivePanelChange=new Ce,this.onDidActivePanelChange=this._onDidActivePanelChange.event,this.addDisposables(this._onDidLocationChange,this._onDidActivePanelChange)}close(){if(this._group)return this.accessor.removeGroup(this._group)}getWindow(){return this.location.type==="popout"?this.location.getWindow():window}moveTo(t){var n,s,i,o;if(!this._group)throw new Error(ug);const r=(n=t.group)!==null&&n!==void 0?n:this.accessor.addGroup({direction:Yje((s=t.position)!==null&&s!==void 0?s:"right"),skipSetActive:(i=t.skipSetActive)!==null&&i!==void 0?i:!1});this.accessor.moveGroupOrPanel({from:{groupId:this._group.id},to:{group:r,position:t.group&&(o=t.position)!==null&&o!==void 0?o:"center",index:t.index},skipSetActive:t.skipSetActive})}maximize(){if(!this._group)throw new Error(ug);this.location.type==="grid"&&this.accessor.maximizeGroup(this._group)}isMaximized(){if(!this._group)throw new Error(ug);return this.accessor.isMaximizedGroup(this._group)}exitMaximized(){if(!this._group)throw new Error(ug);this.isMaximized()&&this.accessor.exitMaximizedGroup()}initialize(t){this._group=t}}const SEe=100,kEe=100;class NR extends Fo{get minimumWidth(){var t;const n=(t=this.activePanel)===null||t===void 0?void 0:t.minimumWidth;return typeof n=="number"?n:super.__minimumWidth()}get minimumHeight(){var t;const n=(t=this.activePanel)===null||t===void 0?void 0:t.minimumHeight;return typeof n=="number"?n:super.__minimumHeight()}get maximumWidth(){var t;const n=(t=this.activePanel)===null||t===void 0?void 0:t.maximumWidth;return typeof n=="number"?n:super.__maximumWidth()}get maximumHeight(){var t;const n=(t=this.activePanel)===null||t===void 0?void 0:t.maximumHeight;return typeof n=="number"?n:super.__maximumHeight()}get panels(){return this._model.panels}get activePanel(){return this._model.activePanel}get size(){return this._model.size}get model(){return this._model}get locked(){return this._model.locked}set locked(t){this._model.locked=t}get header(){return this._model.header}constructor(t,n,s){var i,o,r,l,c,d;super(n,"groupview_default",{minimumHeight:(o=(i=s.constraints)===null||i===void 0?void 0:i.minimumHeight)!==null&&o!==void 0?o:kEe,minimumWidth:(l=(r=s.constraints)===null||r===void 0?void 0:r.maximumHeight)!==null&&l!==void 0?l:SEe,maximumHeight:(c=s.constraints)===null||c===void 0?void 0:c.maximumHeight,maximumWidth:(d=s.constraints)===null||d===void 0?void 0:d.maximumWidth},new _Ee(n,t)),this.api.initialize(this),this._model=new wEe(this.element,t,n,s,this),this.addDisposables(this.model.onDidActivePanelChange(u=>{this.api._onDidActivePanelChange.fire(u)}))}focus(){this.api.isActive||this.api.setActive(),super.focus()}initialize(){this._model.initialize()}setActive(t){super.setActive(t),this.model.setActive(t)}layout(t,n){super.layout(t,n),this.model.layout(t,n)}getComponent(){return this._model}toJSON(){return this.model.toJSON()}}const IEe={className:"dockview-theme-abyss"};class jEe extends m4{get location(){return this.group.api.location}get title(){return this.panel.title}get isGroupActive(){return this.group.isActive}get renderer(){return this.panel.renderer}set group(t){const n=this._group;this._group!==t&&(this._group=t,this._onDidGroupChange.fire({}),this.setupGroupEventListeners(n),this._onDidLocationChange.fire({location:this.group.api.location}))}get group(){return this._group}get tabComponent(){return this._tabComponent}constructor(t,n,s,i,o){super(t.id,i),this.panel=t,this.accessor=s,this._onDidTitleChange=new Ce,this.onDidTitleChange=this._onDidTitleChange.event,this._onDidActiveGroupChange=new Ce,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._onDidGroupChange=new Ce,this.onDidGroupChange=this._onDidGroupChange.event,this._onDidRendererChange=new Ce,this.onDidRendererChange=this._onDidRendererChange.event,this._onDidLocationChange=new Ce,this.onDidLocationChange=this._onDidLocationChange.event,this.groupEventsDisposable=new so,this._tabComponent=o,this.initialize(t),this._group=n,this.setupGroupEventListeners(),this.addDisposables(this.groupEventsDisposable,this._onDidRendererChange,this._onDidTitleChange,this._onDidGroupChange,this._onDidActiveGroupChange,this._onDidLocationChange)}getWindow(){return this.group.api.getWindow()}moveTo(t){var n,s;this.accessor.moveGroupOrPanel({from:{groupId:this._group.id,panelId:this.panel.id},to:{group:(n=t.group)!==null&&n!==void 0?n:this._group,position:t.group&&(s=t.position)!==null&&s!==void 0?s:"center",index:t.index},skipSetActive:t.skipSetActive})}setTitle(t){this.panel.setTitle(t)}setRenderer(t){this.panel.setRenderer(t)}close(){this.group.model.closePanel(this.panel)}maximize(){this.group.api.maximize()}isMaximized(){return this.group.api.isMaximized()}exitMaximized(){this.group.api.exitMaximized()}setupGroupEventListeners(t){var n;let s=(n=t?.isActive)!==null&&n!==void 0?n:!1;this.groupEventsDisposable.value=new jt(this.group.api.onDidVisibilityChange(i=>{const o=!i.isVisible&&this.isVisible,r=i.isVisible&&!this.isVisible,l=this.group.model.isPanelActive(this.panel);(o||r&&l)&&this._onDidVisibilityChange.fire(i)}),this.group.api.onDidLocationChange(i=>{this.group===this.panel.group&&this._onDidLocationChange.fire(i)}),this.group.api.onDidActiveChange(()=>{this.group===this.panel.group&&s!==this.isGroupActive&&(s=this.isGroupActive,this._onDidActiveGroupChange.fire({isActive:this.isGroupActive}))}))}}class Op extends jt{get params(){return this._params}get title(){return this._title}get group(){return this._group}get renderer(){var t;return(t=this._renderer)!==null&&t!==void 0?t:this.accessor.renderer}get minimumWidth(){return this._minimumWidth}get minimumHeight(){return this._minimumHeight}get maximumWidth(){return this._maximumWidth}get maximumHeight(){return this._maximumHeight}constructor(t,n,s,i,o,r,l,c){super(),this.id=t,this.accessor=i,this.containerApi=o,this.view=l,this._renderer=c.renderer,this._group=r,this._minimumWidth=c.minimumWidth,this._minimumHeight=c.minimumHeight,this._maximumWidth=c.maximumWidth,this._maximumHeight=c.maximumHeight,this.api=new jEe(this,this._group,i,n,s),this.addDisposables(this.api.onActiveChange(()=>{i.setActivePanel(this)}),this.api.onDidSizeChange(d=>{this.group.api.setSize(d)}),this.api.onDidRendererChange(()=>{this.group.model.rerender(this)}))}init(t){this._params=t.params,this.view.init(Object.assign(Object.assign({},t),{api:this.api,containerApi:this.containerApi})),this.setTitle(t.title)}focus(){const t=new GK;this.api._onWillFocus.fire(t),!t.defaultPrevented&&(this.api.isActive||this.api.setActive())}toJSON(){return{id:this.id,contentComponent:this.view.contentComponent,tabComponent:this.view.tabComponent,params:Object.keys(this._params||{}).length>0?this._params:void 0,title:this.title,renderer:this._renderer,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,minimumWidth:this._minimumWidth,maximumWidth:this._maximumWidth}}setTitle(t){t!==this.title&&(this._title=t,this.api._onDidTitleChange.fire({title:t}))}setRenderer(t){t!==this.renderer&&(this._renderer=t,this.api._onDidRendererChange.fire({renderer:t}))}update(t){var n;this._params=Object.assign(Object.assign({},(n=this._params)!==null&&n!==void 0?n:{}),t.params);for(const s of Object.keys(t.params))t.params[s]===void 0&&delete this._params[s];this.view.update({params:this._params})}updateParentGroup(t,n){this._group=t,this.api.group=this._group;const s=this._group.model.isPanelActive(this),i=this.group.api.isActive&&s;n?.skipSetActive||this.api.isActive!==i&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&s}),this.api.isVisible!==s&&this.api._onDidVisibilityChange.fire({isVisible:s})}runEvents(){const t=this._group.model.isPanelActive(this),n=this.group.api.isActive&&t;this.api.isActive!==n&&this.api._onDidActiveChange.fire({isActive:this.group.api.isActive&&t}),this.api.isVisible!==t&&this.api._onDidVisibilityChange.fire({isVisible:t})}layout(t,n){this.api._onDidDimensionChange.fire({width:t,height:n}),this.view.layout(t,n)}dispose(){this.api.dispose(),this.view.dispose()}}class FR extends jt{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="dv-default-tab",this._content=document.createElement("div"),this._content.className="dv-default-tab-content",this.action=document.createElement("div"),this.action.className="dv-default-tab-action",this.action.appendChild(fEe()),this._element.appendChild(this._content),this._element.appendChild(this.action),this.render()}init(t){this._title=t.title,this.addDisposables(t.api.onDidTitleChange(n=>{this._title=n.title,this.render()}),Vt(this.action,"pointerdown",n=>{n.preventDefault()}),Vt(this.action,"click",n=>{n.defaultPrevented||(n.preventDefault(),t.api.close())})),this.render()}render(){var t;this._content.textContent!==this._title&&(this._content.textContent=(t=this._title)!==null&&t!==void 0?t:"")}}class XK{get content(){return this._content}get tab(){return this._tab}constructor(t,n,s,i){this.accessor=t,this.id=n,this.contentComponent=s,this.tabComponent=i,this._content=this.createContentComponent(this.id,s),this._tab=this.createTabComponent(this.id,i)}createTabRenderer(t){var n;const s=this.createTabComponent(this.id,this.tabComponent);return this._params&&s.init(Object.assign(Object.assign({},this._params),{tabLocation:t})),this._updateEvent&&((n=s.update)===null||n===void 0||n.call(s,this._updateEvent)),s}init(t){this._params=t,this.content.init(t),this.tab.init(Object.assign(Object.assign({},t),{tabLocation:"header"}))}layout(t,n){var s,i;(i=(s=this.content).layout)===null||i===void 0||i.call(s,t,n)}update(t){var n,s,i,o;this._updateEvent=t,(s=(n=this.content).update)===null||s===void 0||s.call(n,t),(o=(i=this.tab).update)===null||o===void 0||o.call(i,t)}dispose(){var t,n,s,i;(n=(t=this.content).dispose)===null||n===void 0||n.call(t),(i=(s=this.tab).dispose)===null||i===void 0||i.call(s)}createContentComponent(t,n){return this.accessor.options.createComponent({id:t,name:n})}createTabComponent(t,n){const s=n??this.accessor.options.defaultTabComponent;if(s){if(this.accessor.options.createTabComponent){const i=this.accessor.options.createTabComponent({id:t,name:s});return i||new FR}console.warn(`dockview: tabComponent '${n}' was not found. falling back to the default tab.`)}return new FR}}class EEe{constructor(t){this.accessor=t}fromJSON(t,n){var s,i;const o=t.id,r=t.params,l=t.title,c=t.view,d=c?c.content.id:(s=t.contentComponent)!==null&&s!==void 0?s:"unknown",u=c?(i=c.tab)===null||i===void 0?void 0:i.id:t.tabComponent,p=new XK(this.accessor,o,d,u),m=new Op(o,d,u,this.accessor,new zv(this.accessor),n,p,{renderer:t.renderer,minimumWidth:t.minimumWidth,minimumHeight:t.minimumHeight,maximumWidth:t.maximumWidth,maximumHeight:t.maximumHeight});return m.init({title:l??o,params:r??{}}),m}}class AEe extends jt{get element(){return this._element}constructor(){super(),this._element=document.createElement("div"),this._element.className="dv-watermark"}init(t){}}class PEe{constructor(){this._orderedList=[]}push(t){this._orderedList=[...this._orderedList.filter(n=>n!==t),t],this.update()}destroy(t){this._orderedList=this._orderedList.filter(n=>n!==t),this.update()}update(){for(let t=0;t<this._orderedList.length;t++)this._orderedList[t].setAttribute("aria-level",`${t}`),this._orderedList[t].style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${t*2})`}}const Mb=new PEe;let g4=class N0 extends jt{set minimumInViewportWidth(t){this.options.minimumInViewportWidth=t}set minimumInViewportHeight(t){this.options.minimumInViewportHeight=t}get element(){return this._element}get isVisible(){return this._isVisible}constructor(t){super(),this.options=t,this._element=document.createElement("div"),this._onDidChange=new Ce,this.onDidChange=this._onDidChange.event,this._onDidChangeEnd=new Ce,this.onDidChangeEnd=this._onDidChangeEnd.event,this.addDisposables(this._onDidChange,this._onDidChangeEnd),this._element.className="dv-resize-container",this._isVisible=!0,this.setupResize("top"),this.setupResize("bottom"),this.setupResize("left"),this.setupResize("right"),this.setupResize("topleft"),this.setupResize("topright"),this.setupResize("bottomleft"),this.setupResize("bottomright"),this._element.appendChild(this.options.content),this.options.container.appendChild(this._element),this.setBounds(Object.assign(Object.assign(Object.assign(Object.assign({height:this.options.height,width:this.options.width},"top"in this.options&&{top:this.options.top}),"bottom"in this.options&&{bottom:this.options.bottom}),"left"in this.options&&{left:this.options.left}),"right"in this.options&&{right:this.options.right})),Mb.push(this._element)}setVisible(t){t!==this.isVisible&&(this._isVisible=t,wt(this.element,"dv-hidden",!this.isVisible))}bringToFront(){Mb.push(this._element)}setBounds(t={}){typeof t.height=="number"&&(this._element.style.height=`${t.height}px`),typeof t.width=="number"&&(this._element.style.width=`${t.width}px`),"top"in t&&typeof t.top=="number"&&(this._element.style.top=`${t.top}px`,this._element.style.bottom="auto",this.verticalAlignment="top"),"bottom"in t&&typeof t.bottom=="number"&&(this._element.style.bottom=`${t.bottom}px`,this._element.style.top="auto",this.verticalAlignment="bottom"),"left"in t&&typeof t.left=="number"&&(this._element.style.left=`${t.left}px`,this._element.style.right="auto",this.horiziontalAlignment="left"),"right"in t&&typeof t.right=="number"&&(this._element.style.right=`${t.right}px`,this._element.style.left="auto",this.horiziontalAlignment="right");const n=this.options.container.getBoundingClientRect(),s=this._element.getBoundingClientRect(),i=Math.max(0,this.getMinimumWidth(s.width)),o=Math.max(0,this.getMinimumHeight(s.height));if(this.verticalAlignment==="top"){const r=es(s.top-n.top,-o,Math.max(0,n.height-s.height+o));this._element.style.top=`${r}px`,this._element.style.bottom="auto"}if(this.verticalAlignment==="bottom"){const r=es(n.bottom-s.bottom,-o,Math.max(0,n.height-s.height+o));this._element.style.bottom=`${r}px`,this._element.style.top="auto"}if(this.horiziontalAlignment==="left"){const r=es(s.left-n.left,-i,Math.max(0,n.width-s.width+i));this._element.style.left=`${r}px`,this._element.style.right="auto"}if(this.horiziontalAlignment==="right"){const r=es(n.right-s.right,-i,Math.max(0,n.width-s.width+i));this._element.style.right=`${r}px`,this._element.style.left="auto"}this._onDidChange.fire()}toJSON(){const t=this.options.container.getBoundingClientRect(),n=this._element.getBoundingClientRect(),s={};return this.verticalAlignment==="top"?s.top=parseFloat(this._element.style.top):this.verticalAlignment==="bottom"?s.bottom=parseFloat(this._element.style.bottom):s.top=n.top-t.top,this.horiziontalAlignment==="left"?s.left=parseFloat(this._element.style.left):this.horiziontalAlignment==="right"?s.right=parseFloat(this._element.style.right):s.left=n.left-t.left,s.width=n.width,s.height=n.height,s}setupDrag(t,n={inDragMode:!1}){const s=new so,i=()=>{let o=null;const r=J2();s.value=new jt({dispose:()=>{r.release()}},Vt(window,"pointermove",l=>{const c=this.options.container.getBoundingClientRect(),d=l.clientX-c.left,u=l.clientY-c.top;wt(this._element,"dv-resize-container-dragging",!0);const p=this._element.getBoundingClientRect();o===null&&(o={x:l.clientX-p.left,y:l.clientY-p.top});const m=Math.max(0,this.getMinimumWidth(p.width)),f=Math.max(0,this.getMinimumHeight(p.height)),g=es(u-o.y,-f,Math.max(0,c.height-p.height+f)),v=es(o.y-u+c.height-p.height,-f,Math.max(0,c.height-p.height+f)),b=es(d-o.x,-m,Math.max(0,c.width-p.width+m)),C=es(o.x-d+c.width-p.width,-m,Math.max(0,c.width-p.width+m)),y={};g<=v?y.top=g:y.bottom=v,b<=C?y.left=b:y.right=C,this.setBounds(y)}),Vt(window,"pointerup",()=>{wt(this._element,"dv-resize-container-dragging",!1),s.dispose(),this._onDidChangeEnd.fire()}))};this.addDisposables(s,Vt(t,"pointerdown",o=>{if(o.defaultPrevented){o.preventDefault();return}LR(o)||i()}),Vt(this.options.content,"pointerdown",o=>{o.defaultPrevented||LR(o)||o.shiftKey&&i()}),Vt(this.options.content,"pointerdown",()=>{Mb.push(this._element)},!0)),n.inDragMode&&i()}setupResize(t){const n=document.createElement("div");n.className=`dv-resize-handle-${t}`,this._element.appendChild(n);const s=new so;this.addDisposables(s,Vt(n,"pointerdown",i=>{i.preventDefault();let o=null;const r=J2();s.value=new jt(Vt(window,"pointermove",l=>{const c=this.options.container.getBoundingClientRect(),d=this._element.getBoundingClientRect(),u=l.clientY-c.top,p=l.clientX-c.left;o===null&&(o={originalY:u,originalHeight:d.height,originalX:p,originalWidth:d.width});let m,f,g,v,b,C;const y=()=>{m=es(u,-Number.MAX_VALUE,o.originalY+o.originalHeight>c.height?this.getMinimumHeight(c.height):Math.max(0,o.originalY+o.originalHeight-N0.MINIMUM_HEIGHT)),g=o.originalY+o.originalHeight-m,f=c.height-m-g},x=()=>{m=o.originalY-o.originalHeight,g=es(u-m,m<0&&typeof this.options.minimumInViewportHeight=="number"?-m+this.options.minimumInViewportHeight:N0.MINIMUM_HEIGHT,Number.MAX_VALUE),f=c.height-m-g},w=()=>{v=es(p,-Number.MAX_VALUE,o.originalX+o.originalWidth>c.width?this.getMinimumWidth(c.width):Math.max(0,o.originalX+o.originalWidth-N0.MINIMUM_WIDTH)),C=o.originalX+o.originalWidth-v,b=c.width-v-C},_=()=>{v=o.originalX-o.originalWidth,C=es(p-v,v<0&&typeof this.options.minimumInViewportWidth=="number"?-v+this.options.minimumInViewportWidth:N0.MINIMUM_WIDTH,Number.MAX_VALUE),b=c.width-v-C};switch(t){case"top":y();break;case"bottom":x();break;case"left":w();break;case"right":_();break;case"topleft":y(),w();break;case"topright":y(),_();break;case"bottomleft":x(),w();break;case"bottomright":x(),_();break}const S={};m<=f?S.top=m:S.bottom=f,v<=b?S.left=v:S.right=b,S.height=g,S.width=C,this.setBounds(S)}),{dispose:()=>{r.release()}},Vt(window,"pointerup",()=>{s.dispose(),this._onDidChangeEnd.fire()}))}))}getMinimumWidth(t){return typeof this.options.minimumInViewportWidth=="number"?t-this.options.minimumInViewportWidth:0}getMinimumHeight(t){return typeof this.options.minimumInViewportHeight=="number"?t-this.options.minimumInViewportHeight:0}dispose(){Mb.destroy(this._element),this._element.remove(),super.dispose()}};g4.MINIMUM_HEIGHT=20;g4.MINIMUM_WIDTH=20;class TEe extends jt{constructor(t,n){super(),this.group=t,this.overlay=n,this.addDisposables(n)}position(t){this.overlay.setBounds(t)}}const Lb=100,ad={left:100,top:100,width:300,height:300},DEe=100;class MEe{constructor(){this.cache=new Map,this.currentFrameId=0,this.rafId=null}getPosition(t){const n=this.cache.get(t);if(n&&n.frameId===this.currentFrameId)return n.rect;this.scheduleFrameUpdate();const s=hP(t);return this.cache.set(t,{rect:s,frameId:this.currentFrameId}),s}invalidate(){this.currentFrameId++}scheduleFrameUpdate(){this.rafId||(this.rafId=requestAnimationFrame(()=>{this.currentFrameId++,this.rafId=null}))}}function LEe(){const e=document.createElement("div");return e.tabIndex=-1,e}class BR extends jt{constructor(t,n){super(),this.element=t,this.accessor=n,this.map={},this._disposed=!1,this.positionCache=new MEe,this.pendingUpdates=new Set,this.addDisposables(Bs.from(()=>{for(const s of Object.values(this.map))s.disposable.dispose(),s.destroy.dispose();this._disposed=!0}))}updateAllPositions(){if(!this._disposed){this.positionCache.invalidate();for(const t of Object.values(this.map))t.panel.api.isVisible&&t.resize&&t.resize()}}detatch(t){if(this.map[t.api.id]){const{disposable:n,destroy:s}=this.map[t.api.id];return n.dispose(),s.dispose(),delete this.map[t.api.id],!0}return!1}attach(t){const{panel:n,referenceContainer:s}=t;if(!this.map[n.api.id]){const u=LEe();u.className="dv-render-overlay",this.map[n.api.id]={panel:n,disposable:Bs.NONE,destroy:Bs.NONE,element:u}}const i=this.map[n.api.id].element;n.view.content.element.parentElement!==i&&i.appendChild(n.view.content.element),i.parentElement!==this.element&&this.element.appendChild(i);const o=()=>{const u=n.api.id;this.pendingUpdates.has(u)||(this.pendingUpdates.add(u),requestAnimationFrame(()=>{if(this.pendingUpdates.delete(u),this.isDisposed||!this.map[u])return;const p=this.positionCache.getPosition(s.element),m=this.positionCache.getPosition(this.element),f=p.left-m.left,g=p.top-m.top,v=p.width,b=p.height;i.style.left=`${f}px`,i.style.top=`${g}px`,i.style.width=`${v}px`,i.style.height=`${b}px`,wt(i,"dv-render-overlay-float",n.group.api.location.type==="floating")}))},r=()=>{n.api.isVisible&&(this.positionCache.invalidate(),o()),i.style.display=n.api.isVisible?"":"none"},l=new so,c=()=>{n.api.location.type==="floating"?queueMicrotask(()=>{const u=this.accessor.floatingGroups.find(g=>g.group===n.api.group);if(!u)return;const p=u.overlay.element,m=()=>{const g=Number(p.getAttribute("aria-level"));i.style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${g*2+1})`},f=new MutationObserver(()=>{m()});l.value=Bs.from(()=>f.disconnect()),f.observe(p,{attributeFilter:["aria-level"],attributes:!0}),m()}):i.style.zIndex=""},d=new jt(l,new $K(i,{onDragEnd:u=>{s.dropTarget.dnd.onDragEnd(u)},onDragEnter:u=>{s.dropTarget.dnd.onDragEnter(u)},onDragLeave:u=>{s.dropTarget.dnd.onDragLeave(u)},onDrop:u=>{s.dropTarget.dnd.onDrop(u)},onDragOver:u=>{s.dropTarget.dnd.onDragOver(u)}}),n.api.onDidVisibilityChange(()=>{r()}),n.api.onDidDimensionsChange(()=>{n.api.isVisible&&o()}),n.api.onDidLocationChange(()=>{c()}));return this.map[n.api.id].destroy=Bs.from(()=>{var u;n.view.content.element.parentElement===i&&i.removeChild(n.view.content.element),(u=i.parentElement)===null||u===void 0||u.removeChild(i)}),c(),queueMicrotask(()=>{this.isDisposed||r()}),this.map[n.api.id].disposable.dispose(),this.map[n.api.id].disposable=d,this.map[n.api.id].resize=o,i}}var REe=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function l(u){try{d(s.next(u))}catch(p){r(p)}}function c(u){try{d(s.throw(u))}catch(p){r(p)}}function d(u){u.done?o(u.value):i(u.value).then(l,c)}d((s=s.apply(e,t||[])).next())})};class OEe extends jt{get window(){var t,n;return(n=(t=this._window)===null||t===void 0?void 0:t.value)!==null&&n!==void 0?n:null}constructor(t,n,s){super(),this.target=t,this.className=n,this.options=s,this._onWillClose=new Ce,this.onWillClose=this._onWillClose.event,this._onDidClose=new Ce,this.onDidClose=this._onDidClose.event,this._window=null,this.addDisposables(this._onWillClose,this._onDidClose,{dispose:()=>{this.close()}})}dimensions(){if(!this._window)return null;const t=this._window.value.screenX,n=this._window.value.screenY,s=this._window.value.innerWidth,i=this._window.value.innerHeight;return{top:n,left:t,width:s,height:i}}close(){var t,n;this._window&&(this._onWillClose.fire(),(n=(t=this.options).onWillClose)===null||n===void 0||n.call(t,{id:this.target,window:this._window.value}),this._window.disposable.dispose(),this._window=null,this._onDidClose.fire())}open(){var t,n;return REe(this,void 0,void 0,function*(){if(this._window)throw new Error("instance of popout window is already open");const s=`${this.options.url}`,i=Object.entries({top:this.options.top,left:this.options.left,width:this.options.width,height:this.options.height}).map(([c,d])=>`${c}=${d}`).join(","),o=window.open(s,this.target,i);if(!o)return null;const r=new jt;this._window={value:o,disposable:r},r.addDisposables(Bs.from(()=>{o.close()}),Vt(window,"beforeunload",()=>{this.close()}));const l=this.createPopoutWindowContainer();return this.className&&l.classList.add(this.className),(n=(t=this.options).onDidOpen)===null||n===void 0||n.call(t,{id:this.target,window:o}),new Promise((c,d)=>{o.addEventListener("unload",u=>{}),o.addEventListener("load",()=>{try{const u=o.document;u.title=document.title,u.body.appendChild(l),Aje(u,window.document.styleSheets),Vt(o,"beforeunload",()=>{this.close()}),c(l)}catch(u){d(u)}})})})}createPopoutWindowContainer(){const t=document.createElement("div");return t.classList.add("dv-popout-window"),t.id="dv-popout-window",t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.top="0px",t.style.left="0px",t}}class NEe extends jt{constructor(t){super(),this.accessor=t,this.init()}init(){const t=new Set,n=new Set;this.addDisposables(this.accessor.onDidAddPanel(s=>{if(t.has(s.api.id))throw new Error(`dockview: Invalid event sequence. [onDidAddPanel] called for panel ${s.api.id} but panel already exists`);t.add(s.api.id)}),this.accessor.onDidRemovePanel(s=>{if(t.has(s.api.id))t.delete(s.api.id);else throw new Error(`dockview: Invalid event sequence. [onDidRemovePanel] called for panel ${s.api.id} but panel does not exists`)}),this.accessor.onDidAddGroup(s=>{if(n.has(s.api.id))throw new Error(`dockview: Invalid event sequence. [onDidAddGroup] called for group ${s.api.id} but group already exists`);n.add(s.api.id)}),this.accessor.onDidRemoveGroup(s=>{if(n.has(s.api.id))n.delete(s.api.id);else throw new Error(`dockview: Invalid event sequence. [onDidRemoveGroup] called for group ${s.api.id} but group does not exists`)}))}}class FEe extends jt{constructor(t){super(),this.root=t,this._active=null,this._activeDisposable=new so,this._element=document.createElement("div"),this._element.className="dv-popover-anchor",this._element.style.position="relative",this.root.prepend(this._element),this.addDisposables(Bs.from(()=>{this.close()}),this._activeDisposable)}openPopover(t,n){var s;this.close();const i=document.createElement("div");i.style.position="absolute",i.style.zIndex=(s=n.zIndex)!==null&&s!==void 0?s:"var(--dv-overlay-z-index)",i.appendChild(t);const o=this._element.getBoundingClientRect(),r=o.left,l=o.top;i.style.top=`${n.y-l}px`,i.style.left=`${n.x-r}px`,this._element.appendChild(i),this._active=i,this._activeDisposable.value=new jt(Vt(window,"pointerdown",c=>{var d;const u=c.target;if(!(u instanceof HTMLElement))return;let p=u;for(;p&&p!==i;)p=(d=p?.parentElement)!==null&&d!==void 0?d:null;p||this.close()})),requestAnimationFrame(()=>{Nje(i,this.root)})}close(){this._active&&(this._active.remove(),this._activeDisposable.dispose(),this._active=null)}}class zR extends jt{get disabled(){return this._disabled}set disabled(t){var n;this.disabled!==t&&(this._disabled=t,t&&((n=this.model)===null||n===void 0||n.clear()))}get model(){if(!this.disabled)return{clear:()=>{var t;this._model&&((t=this._model.root.parentElement)===null||t===void 0||t.removeChild(this._model.root)),this._model=void 0},exists:()=>!!this._model,getElements:(t,n)=>{const s=this._outline!==n;if(this._outline=n,this._model)return this._model.changed=s,this._model;const i=this.createContainer(),o=this.createAnchor();if(this._model={root:i,overlay:o,changed:s},i.appendChild(o),this.element.appendChild(i),t?.target instanceof HTMLElement){const r=t.target.getBoundingClientRect(),l=this.element.getBoundingClientRect();o.style.left=`${r.left-l.left}px`,o.style.top=`${r.top-l.top}px`}return this._model}}}constructor(t,n){super(),this.element=t,this._disabled=!1,this._disabled=n.disabled,this.addDisposables(Bs.from(()=>{var s;(s=this.model)===null||s===void 0||s.clear()}))}createContainer(){const t=document.createElement("div");return t.className="dv-drop-target-container",t}createAnchor(){const t=document.createElement("div");return t.className="dv-drop-target-anchor",t.style.visibility="hidden",t}}const VR={activationSize:{type:"pixels",value:10},size:{type:"pixels",value:20}};function Rb(e){const t=e.from.activePanel;[...e.from.panels].map(s=>{const i=e.from.model.removePanel(s);return e.from.model.renderContainer.detatch(s),i}).forEach(s=>{e.to.model.openPanel(s,{skipSetActive:t!==s,skipSetGroupActive:!0})})}class BEe extends BK{get orientation(){return this.gridview.orientation}get totalPanels(){return this.panels.length}get panels(){return this.groups.flatMap(t=>t.panels)}get options(){return this._options}get activePanel(){const t=this.activeGroup;if(t)return t.activePanel}get renderer(){var t;return(t=this.options.defaultRenderer)!==null&&t!==void 0?t:"onlyWhenVisible"}get api(){return this._api}get floatingGroups(){return this._floatingGroups}get popoutRestorationPromise(){return this._popoutRestorationPromise}constructor(t,n){var s,i,o;super(t,{proportionalLayout:!0,orientation:Ke.HORIZONTAL,styles:n.hideBorders?{separatorBorder:"transparent"}:void 0,disableAutoResizing:n.disableAutoResizing,locked:n.locked,margin:(i=(s=n.theme)===null||s===void 0?void 0:s.gap)!==null&&i!==void 0?i:0,className:n.className}),this.nextGroupId=c4(),this._deserializer=new EEe(this),this._watermark=null,this._onWillDragPanel=new Ce,this.onWillDragPanel=this._onWillDragPanel.event,this._onWillDragGroup=new Ce,this.onWillDragGroup=this._onWillDragGroup.event,this._onDidDrop=new Ce,this.onDidDrop=this._onDidDrop.event,this._onWillDrop=new Ce,this.onWillDrop=this._onWillDrop.event,this._onWillShowOverlay=new Ce,this.onWillShowOverlay=this._onWillShowOverlay.event,this._onUnhandledDragOverEvent=new Ce,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this._onDidRemovePanel=new Ce,this.onDidRemovePanel=this._onDidRemovePanel.event,this._onDidAddPanel=new Ce,this.onDidAddPanel=this._onDidAddPanel.event,this._onDidPopoutGroupSizeChange=new Ce,this.onDidPopoutGroupSizeChange=this._onDidPopoutGroupSizeChange.event,this._onDidPopoutGroupPositionChange=new Ce,this.onDidPopoutGroupPositionChange=this._onDidPopoutGroupPositionChange.event,this._onDidOpenPopoutWindowFail=new Ce,this.onDidOpenPopoutWindowFail=this._onDidOpenPopoutWindowFail.event,this._onDidLayoutFromJSON=new Ce,this.onDidLayoutFromJSON=this._onDidLayoutFromJSON.event,this._onDidActivePanelChange=new Ce({replay:!0}),this.onDidActivePanelChange=this._onDidActivePanelChange.event,this._onDidMovePanel=new Ce,this.onDidMovePanel=this._onDidMovePanel.event,this._onDidMaximizedGroupChange=new Ce,this.onDidMaximizedGroupChange=this._onDidMaximizedGroupChange.event,this._floatingGroups=[],this._popoutGroups=[],this._popoutRestorationPromise=Promise.resolve(),this._onDidRemoveGroup=new Ce,this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidAddGroup=new Ce,this.onDidAddGroup=this._onDidAddGroup.event,this._onDidOptionsChange=new Ce,this.onDidOptionsChange=this._onDidOptionsChange.event,this._onDidActiveGroupChange=new Ce,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._moving=!1,this._options=n,this.popupService=new FEe(this.element),this._themeClassnames=new L_(this.element),this._api=new zv(this),this.rootDropTargetContainer=new zR(this.element,{disabled:!0}),this.overlayRenderContainer=new BR(this.gridview.element,this),this._rootDropTarget=new Mr(this.element,{className:"dv-drop-target-edge",canDisplayOverlay:(r,l)=>{const c=Wi();if(c)return c.viewId!==this.id?!1:l==="center"?this.gridview.length===0:!0;if(l==="center"&&this.gridview.length!==0)return!1;const d=new KK(r,"edge",l,Wi);return this._onUnhandledDragOverEvent.fire(d),d.isAccepted},acceptedTargetZones:["top","bottom","left","right","center"],overlayModel:(o=n.rootOverlayModel)!==null&&o!==void 0?o:VR,getOverrideTarget:()=>{var r;return(r=this.rootDropTargetContainer)===null||r===void 0?void 0:r.model}}),this.updateDropTargetModel(n),wt(this.gridview.element,"dv-dockview",!0),wt(this.element,"dv-debug",!!n.debug),this.updateTheme(),this.updateWatermark(),n.debug&&this.addDisposables(new NEe(this)),this.addDisposables(this.rootDropTargetContainer,this.overlayRenderContainer,this._onWillDragPanel,this._onWillDragGroup,this._onWillShowOverlay,this._onDidActivePanelChange,this._onDidAddPanel,this._onDidRemovePanel,this._onDidLayoutFromJSON,this._onDidDrop,this._onWillDrop,this._onDidMovePanel,this._onDidAddGroup,this._onDidRemoveGroup,this._onDidActiveGroupChange,this._onUnhandledDragOverEvent,this._onDidMaximizedGroupChange,this._onDidOptionsChange,this._onDidPopoutGroupSizeChange,this._onDidPopoutGroupPositionChange,this._onDidOpenPopoutWindowFail,this.onDidViewVisibilityChangeMicroTaskQueue(()=>{this.updateWatermark()}),this.onDidAdd(r=>{this._moving||this._onDidAddGroup.fire(r)}),this.onDidRemove(r=>{this._moving||this._onDidRemoveGroup.fire(r)}),this.onDidActiveChange(r=>{this._moving||this._onDidActiveGroupChange.fire(r)}),this.onDidMaximizedChange(r=>{this._onDidMaximizedGroupChange.fire({group:r.panel,isMaximized:r.isMaximized})}),ch.any(this.onDidAdd,this.onDidRemove)(()=>{this.updateWatermark()}),ch.any(this.onDidAddPanel,this.onDidRemovePanel,this.onDidAddGroup,this.onDidRemove,this.onDidMovePanel,this.onDidActivePanelChange,this.onDidPopoutGroupPositionChange,this.onDidPopoutGroupSizeChange)(()=>{this._bufferOnDidLayoutChange.fire()}),Bs.from(()=>{for(const r of[...this._floatingGroups])r.dispose();for(const r of[...this._popoutGroups])r.disposable.dispose()}),this._rootDropTarget,this._rootDropTarget.onWillShowOverlay(r=>{this.gridview.length>0&&r.position==="center"||this._onWillShowOverlay.fire(new R_(r,{kind:"edge",panel:void 0,api:this._api,group:void 0,getData:Wi}))}),this._rootDropTarget.onDrop(r=>{var l;const c=new ZK({nativeEvent:r.nativeEvent,position:r.position,panel:void 0,api:this._api,group:void 0,getData:Wi,kind:"edge"});if(this._onWillDrop.fire(c),c.defaultPrevented)return;const d=Wi();d?this.moveGroupOrPanel({from:{groupId:d.groupId,panelId:(l=d.panelId)!==null&&l!==void 0?l:void 0},to:{group:this.orthogonalize(r.position),position:"center"}}):this._onDidDrop.fire(new f4({nativeEvent:r.nativeEvent,position:r.position,panel:void 0,api:this._api,group:void 0,getData:Wi}))}),this._rootDropTarget)}setVisible(t,n){switch(t.api.location.type){case"grid":super.setVisible(t,n);break;case"floating":{const s=this.floatingGroups.find(i=>i.group===t);s&&(s.overlay.setVisible(n),t.api._onDidVisibilityChange.fire({isVisible:n}));break}case"popout":console.warn("dockview: You cannot hide a group that is in a popout window");break}}addPopoutGroup(t,n){var s,i,o,r,l;if(t instanceof Op&&t.group.size===1)return this.addPopoutGroup(t.group,n);const c=Mje(this.gridview.element),d=this.element;function u(){return n?.position?n.position:t instanceof NR?t.element.getBoundingClientRect():t.group?t.group.element.getBoundingClientRect():d.getBoundingClientRect()}const p=u(),m=(i=(s=n?.overridePopoutGroup)===null||s===void 0?void 0:s.id)!==null&&i!==void 0?i:this.getNextGroupId(),f=new OEe(`${this.id}-${m}`,c??"",{url:(l=(o=n?.popoutUrl)!==null&&o!==void 0?o:(r=this.options)===null||r===void 0?void 0:r.popoutUrl)!==null&&l!==void 0?l:"/popout.html",left:window.screenX+p.left,top:window.screenY+p.top,width:p.width,height:p.height,onDidOpen:n?.onDidOpen,onWillClose:n?.onWillClose}),g=new jt(f,f.onDidClose(()=>{g.dispose()}));return f.open().then(v=>{var b;if(f.isDisposed)return!1;const C=n?.referenceGroup?n.referenceGroup:t instanceof Op?t.group:t,y=t.api.location.type,x=C.element.parentElement!==null;let w;if(x?n?.overridePopoutGroup?w=n.overridePopoutGroup:(w=this.createGroup({id:m}),v&&this._onDidAddGroup.fire(w)):w=C,v===null)return console.error("dockview: failed to create popout. perhaps you need to allow pop-ups for this website"),g.dispose(),this._onDidOpenPopoutWindowFail.fire(),this.movingLock(()=>Rb({from:w,to:C})),C.api.isVisible||C.api.setVisible(!0),!1;const _=document.createElement("div");_.className="dv-overlay-render-container";const S=new BR(_,this);w.model.renderContainer=S,w.layout(f.window.innerWidth,f.window.innerHeight);let I;if(!n?.overridePopoutGroup&&x)if(t instanceof Op)this.movingLock(()=>{const N=C.model.removePanel(t);w.model.openPanel(N)});else switch(this.movingLock(()=>Rb({from:C,to:w})),y){case"grid":C.api.setVisible(!1);break;case"floating":case"popout":I=(b=this._floatingGroups.find(N=>N.group.api.id===t.api.id))===null||b===void 0?void 0:b.overlay.toJSON(),this.removeGroup(C);break}v.classList.add("dv-dockview"),v.style.overflow="hidden",v.appendChild(_),v.appendChild(w.element);const k=document.createElement("div"),E=new zR(k,{disabled:this.rootDropTargetContainer.disabled});v.appendChild(k),w.model.dropTargetContainer=E,w.model.location={type:"popout",getWindow:()=>f.window,popoutUrl:n?.popoutUrl},x&&t.api.location.type==="grid"&&t.api.setVisible(!1),this.doSetGroupAndPanelActive(w),g.addDisposables(w.api.onDidActiveChange(N=>{var F;N.isActive&&((F=f.window)===null||F===void 0||F.focus())}),w.api.onWillFocus(()=>{var N;(N=f.window)===null||N===void 0||N.focus()}));let j;const P=x&&C&&this.getPanel(C.id),D={window:f,popoutGroup:w,referenceGroup:P?C.id:void 0,disposable:{dispose:()=>(g.dispose(),j)}},O=Rje(f.window);return g.addDisposables(O,Oje(f.window,()=>{this._onDidPopoutGroupSizeChange.fire({width:f.window.innerWidth,height:f.window.innerHeight,group:w})}),O.event(()=>{this._onDidPopoutGroupPositionChange.fire({screenX:f.window.screenX,screenY:f.window.screenX,group:w})}),Vt(f.window,"resize",()=>{w.layout(f.window.innerWidth,f.window.innerHeight)}),S,Bs.from(()=>{if(!this.isDisposed){if(x&&this.getPanel(C.id))this.movingLock(()=>Rb({from:w,to:C})),C.api.isVisible||C.api.setVisible(!0),this.getPanel(w.id)&&this.doRemoveGroup(w,{skipPopoutAssociated:!0});else if(this.getPanel(w.id)){if(w.model.renderContainer=this.overlayRenderContainer,w.model.dropTargetContainer=this.rootDropTargetContainer,j=w,!this._popoutGroups.find(F=>F.popoutGroup===w))return;I?this.addFloatingGroup(w,{height:I.height,width:I.width,position:I}):(this.doRemoveGroup(w,{skipDispose:!0,skipActive:!0,skipPopoutReturn:!0}),w.model.location={type:"grid"},this.movingLock(()=>{this.doAddGroup(w,[0])})),this.doSetGroupAndPanelActive(w)}}})),this._popoutGroups.push(D),this.updateWatermark(),!0}).catch(v=>(console.error("dockview: failed to create popout.",v),!1))}addFloatingGroup(t,n){var s,i,o,r,l;let c;if(t instanceof Op)c=this.createGroup(),this._onDidAddGroup.fire(c),this.movingLock(()=>this.removePanel(t,{removeEmptyGroup:!0,skipDispose:!0,skipSetActiveGroup:!0})),this.movingLock(()=>c.model.openPanel(t,{skipSetGroupActive:!0}));else{c=t;const v=(s=this._popoutGroups.find(y=>y.popoutGroup===c))===null||s===void 0?void 0:s.referenceGroup,b=v?this.getPanel(v):void 0;typeof n?.skipRemoveGroup=="boolean"&&n.skipRemoveGroup||(b?(this.movingLock(()=>Rb({from:t,to:b})),this.doRemoveGroup(t,{skipPopoutReturn:!0,skipPopoutAssociated:!0}),this.doRemoveGroup(b,{skipDispose:!0}),c=b):this.doRemoveGroup(t,{skipDispose:!0,skipPopoutReturn:!0,skipPopoutAssociated:!1}))}function d(){if(n?.position){const v={};return"left"in n.position?v.left=Math.max(n.position.left,0):"right"in n.position?v.right=Math.max(n.position.right,0):v.left=ad.left,"top"in n.position?v.top=Math.max(n.position.top,0):"bottom"in n.position?v.bottom=Math.max(n.position.bottom,0):v.top=ad.top,typeof n.width=="number"?v.width=Math.max(n.width,0):v.width=ad.width,typeof n.height=="number"?v.height=Math.max(n.height,0):v.height=ad.height,v}return{left:typeof n?.x=="number"?Math.max(n.x,0):ad.left,top:typeof n?.y=="number"?Math.max(n.y,0):ad.top,width:typeof n?.width=="number"?Math.max(n.width,0):ad.width,height:typeof n?.height=="number"?Math.max(n.height,0):ad.height}}const u=d(),p=new g4(Object.assign(Object.assign({container:this.gridview.element,content:c.element},u),{minimumInViewportWidth:this.options.floatingGroupBounds==="boundedWithinViewport"?void 0:(o=(i=this.options.floatingGroupBounds)===null||i===void 0?void 0:i.minimumWidthWithinViewport)!==null&&o!==void 0?o:Lb,minimumInViewportHeight:this.options.floatingGroupBounds==="boundedWithinViewport"?void 0:(l=(r=this.options.floatingGroupBounds)===null||r===void 0?void 0:r.minimumHeightWithinViewport)!==null&&l!==void 0?l:Lb})),m=c.element.querySelector(".dv-void-container");if(!m)throw new Error("failed to find drag handle");p.setupDrag(m,{inDragMode:typeof n?.inDragMode=="boolean"?n.inDragMode:!1});const f=new TEe(c,p),g=new jt(c.api.onDidActiveChange(v=>{v.isActive&&p.bringToFront()}),D_(c.element,v=>{const{width:b,height:C}=v.contentRect;c.layout(b,C)}));f.addDisposables(p.onDidChange(()=>{c.layout(c.width,c.height)}),p.onDidChangeEnd(()=>{this._bufferOnDidLayoutChange.fire()}),c.onDidChange(v=>{p.setBounds({height:v?.height,width:v?.width})}),{dispose:()=>{g.dispose(),uI(this._floatingGroups,f),c.model.location={type:"grid"},this.updateWatermark()}}),this._floatingGroups.push(f),c.model.location={type:"floating"},n?.skipActiveGroup||this.doSetGroupAndPanelActive(c),this.updateWatermark()}orthogonalize(t,n){switch(this.gridview.normalize(),t){case"top":case"bottom":this.gridview.orientation===Ke.HORIZONTAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break;case"left":case"right":this.gridview.orientation===Ke.VERTICAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break}switch(t){case"top":case"left":case"center":return this.createGroupAtLocation([0],void 0,n);case"bottom":case"right":return this.createGroupAtLocation([this.gridview.length],void 0,n);default:throw new Error(`unsupported position ${t}`)}}updateOptions(t){var n,s;if(super.updateOptions(t),"floatingGroupBounds"in t)for(const r of this._floatingGroups){switch(t.floatingGroupBounds){case"boundedWithinViewport":r.overlay.minimumInViewportHeight=void 0,r.overlay.minimumInViewportWidth=void 0;break;case void 0:r.overlay.minimumInViewportHeight=Lb,r.overlay.minimumInViewportWidth=Lb;break;default:r.overlay.minimumInViewportHeight=(n=t.floatingGroupBounds)===null||n===void 0?void 0:n.minimumHeightWithinViewport,r.overlay.minimumInViewportWidth=(s=t.floatingGroupBounds)===null||s===void 0?void 0:s.minimumWidthWithinViewport}r.overlay.setBounds()}this.updateDropTargetModel(t);const i=this.options.disableDnd;this._options=Object.assign(Object.assign({},this.options),t);const o=this.options.disableDnd;i!==o&&this.updateDragAndDropState(),"theme"in t&&this.updateTheme(),this.layout(this.gridview.width,this.gridview.height,!0)}layout(t,n,s){if(super.layout(t,n,s),this._floatingGroups)for(const i of this._floatingGroups)i.overlay.setBounds()}updateDragAndDropState(){for(const t of this.groups)t.model.updateDragAndDropState()}focus(){var t;(t=this.activeGroup)===null||t===void 0||t.focus()}getGroupPanel(t){return this.panels.find(n=>n.id===t)}setActivePanel(t){t.group.model.openPanel(t),this.doSetGroupAndPanelActive(t.group)}moveToNext(t={}){var n;if(!t.group){if(!this.activeGroup)return;t.group=this.activeGroup}if(t.includePanel&&t.group&&t.group.activePanel!==t.group.panels[t.group.panels.length-1]){t.group.model.moveToNext({suppressRoll:!0});return}const s=fs(t.group.element),i=(n=this.gridview.next(s))===null||n===void 0?void 0:n.view;this.doSetGroupAndPanelActive(i)}moveToPrevious(t={}){var n;if(!t.group){if(!this.activeGroup)return;t.group=this.activeGroup}if(t.includePanel&&t.group&&t.group.activePanel!==t.group.panels[0]){t.group.model.moveToPrevious({suppressRoll:!0});return}const s=fs(t.group.element),i=(n=this.gridview.previous(s))===null||n===void 0?void 0:n.view;i&&this.doSetGroupAndPanelActive(i)}toJSON(){var t;const n=this.gridview.serialize(),s=this.panels.reduce((l,c)=>(l[c.id]=c.toJSON(),l),{}),i=this._floatingGroups.map(l=>({data:l.group.toJSON(),position:l.overlay.toJSON()})),o=this._popoutGroups.map(l=>({data:l.popoutGroup.toJSON(),gridReferenceGroup:l.referenceGroup,position:l.window.dimensions(),url:l.popoutGroup.api.location.type==="popout"?l.popoutGroup.api.location.popoutUrl:void 0})),r={grid:n,panels:s,activeGroup:(t=this.activeGroup)===null||t===void 0?void 0:t.id};return i.length>0&&(r.floatingGroups=i),o.length>0&&(r.popoutGroups=o),r}fromJSON(t){var n,s;if(this.clear(),typeof t!="object"||t===null)throw new Error("serialized layout must be a non-null object");const{grid:i,panels:o,activeGroup:r}=t;if(i.root.type!=="branch"||!Array.isArray(i.root.data))throw new Error("root must be of type branch");try{const l=this.width,c=this.height,d=f=>{const{id:g,locked:v,hideHeader:b,views:C,activeView:y}=f;if(typeof g!="string")throw new Error("group id must be of type string");const x=this.createGroup({id:g,locked:!!v,hideHeader:!!b});this._onDidAddGroup.fire(x);const w=[];for(const _ of C){const S=this._deserializer.fromJSON(o[_],x);w.push(S)}for(let _=0;_<C.length;_++){const S=w[_],I=typeof y=="string"&&y===S.id;x.model.openPanel(S,{skipSetActive:!I,skipSetGroupActive:!0})}return!x.activePanel&&x.panels.length>0&&x.model.openPanel(x.panels[x.panels.length-1],{skipSetGroupActive:!0}),x};this.gridview.deserialize(i,{fromJSON:f=>d(f.data)}),this.layout(l,c,!0);const u=(n=t.floatingGroups)!==null&&n!==void 0?n:[];for(const f of u){const{data:g,position:v}=f,b=d(g);this.addFloatingGroup(b,{position:v,width:v.width,height:v.height,skipRemoveGroup:!0,inDragMode:!1})}const p=(s=t.popoutGroups)!==null&&s!==void 0?s:[],m=[];p.forEach((f,g)=>{const{data:v,position:b,gridReferenceGroup:C,url:y}=f,x=d(v),w=new Promise(_=>{setTimeout(()=>{this.addPopoutGroup(x,{position:b??void 0,overridePopoutGroup:C?x:void 0,referenceGroup:C?this.getPanel(C):void 0,popoutUrl:y}),_()},g*DEe)});m.push(w)}),this._popoutRestorationPromise=Promise.all(m).then(()=>{});for(const f of this._floatingGroups)f.overlay.setBounds();if(typeof r=="string"){const f=this.getPanel(r);f&&this.doSetGroupAndPanelActive(f)}}catch(l){console.error("dockview: failed to deserialize layout. Reverting changes",l);for(const c of this.groups)for(const d of c.panels)this.removePanel(d,{removeEmptyGroup:!1,skipDispose:!1});for(const c of this.groups)c.dispose(),this._groups.delete(c.id),this._onDidRemoveGroup.fire(c);for(const c of[...this._floatingGroups])c.dispose();throw this.clear(),l}this.updateWatermark(),requestAnimationFrame(()=>{this.overlayRenderContainer.updateAllPositions()}),this._onDidLayoutFromJSON.fire()}clear(){const t=Array.from(this._groups.values()).map(s=>s.value),n=!!this.activeGroup;for(const s of t)this.removeGroup(s,{skipActive:!0});n&&this.doSetGroupAndPanelActive(void 0),this.gridview.clear()}closeAllGroups(){for(const t of this._groups.entries()){const[n,s]=t;s.value.model.closeAllPanels()}}addPanel(t){var n,s;if(this.panels.find(c=>c.id===t.id))throw new Error(`panel with id ${t.id} already exists`);let i;if(t.position&&t.floating)throw new Error("you can only provide one of: position, floating as arguments to .addPanel(...)");const o={width:t.initialWidth,height:t.initialHeight};let r;if(t.position)if(yEe(t.position)){const c=typeof t.position.referencePanel=="string"?this.getGroupPanel(t.position.referencePanel):t.position.referencePanel;if(r=t.position.index,!c)throw new Error(`referencePanel '${t.position.referencePanel}' does not exist`);i=this.findGroup(c)}else if(bEe(t.position)){if(i=typeof t.position.referenceGroup=="string"?(n=this._groups.get(t.position.referenceGroup))===null||n===void 0?void 0:n.value:t.position.referenceGroup,r=t.position.index,!i)throw new Error(`referenceGroup '${t.position.referenceGroup}' does not exist`)}else{const c=this.orthogonalize(OR(t.position.direction)),d=this.createPanel(t,c);return c.model.openPanel(d,{skipSetActive:t.inactive,skipSetGroupActive:t.inactive,index:r}),t.inactive||this.doSetGroupAndPanelActive(c),c.api.setSize({height:o?.height,width:o?.width}),d}else i=this.activeGroup;let l;if(i){const c=eC(((s=t.position)===null||s===void 0?void 0:s.direction)||"within");if(t.floating){const d=this.createGroup();this._onDidAddGroup.fire(d);const u=typeof t.floating=="object"&&t.floating!==null?t.floating:{};this.addFloatingGroup(d,Object.assign(Object.assign({},u),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),l=this.createPanel(t,d),d.model.openPanel(l,{skipSetActive:t.inactive,skipSetGroupActive:t.inactive,index:r})}else if(i.api.location.type==="floating"||c==="center")l=this.createPanel(t,i),i.model.openPanel(l,{skipSetActive:t.inactive,skipSetGroupActive:t.inactive,index:r}),i.api.setSize({width:o?.width,height:o?.height}),t.inactive||this.doSetGroupAndPanelActive(i);else{const d=fs(i.element),u=bl(this.gridview.orientation,d,c),p=this.createGroupAtLocation(u,this.orientationAtLocation(u)===Ke.VERTICAL?o?.height:o?.width);l=this.createPanel(t,p),p.model.openPanel(l,{skipSetActive:t.inactive,skipSetGroupActive:t.inactive,index:r}),t.inactive||this.doSetGroupAndPanelActive(p)}}else if(t.floating){const c=this.createGroup();this._onDidAddGroup.fire(c);const d=typeof t.floating=="object"&&t.floating!==null?t.floating:{};this.addFloatingGroup(c,Object.assign(Object.assign({},d),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),l=this.createPanel(t,c),c.model.openPanel(l,{skipSetActive:t.inactive,skipSetGroupActive:t.inactive,index:r})}else{const c=this.createGroupAtLocation([0],this.gridview.orientation===Ke.VERTICAL?o?.height:o?.width);l=this.createPanel(t,c),c.model.openPanel(l,{skipSetActive:t.inactive,skipSetGroupActive:t.inactive,index:r}),t.inactive||this.doSetGroupAndPanelActive(c)}return l}removePanel(t,n={removeEmptyGroup:!0}){const s=t.group;if(!s)throw new Error(`cannot remove panel ${t.id}. it's missing a group.`);s.model.removePanel(t,{skipSetActiveGroup:n.skipSetActiveGroup}),n.skipDispose||(t.group.model.renderContainer.detatch(t),t.dispose()),s.size===0&&n.removeEmptyGroup&&this.removeGroup(s,{skipActive:n.skipSetActiveGroup})}createWatermarkComponent(){return this.options.createWatermarkComponent?this.options.createWatermarkComponent():new AEe}updateWatermark(){var t,n;if(this.groups.filter(s=>s.api.location.type==="grid"&&s.api.isVisible).length===0){if(!this._watermark){this._watermark=this.createWatermarkComponent(),this._watermark.init({containerApi:new zv(this)});const s=document.createElement("div");s.className="dv-watermark-container",Tje(s,"watermark-component"),s.appendChild(this._watermark.element),this.gridview.element.appendChild(s)}}else this._watermark&&(this._watermark.element.parentElement.remove(),(n=(t=this._watermark).dispose)===null||n===void 0||n.call(t),this._watermark=null)}addGroup(t){var n;if(t){let s;if(xEe(t)){const d=typeof t.referencePanel=="string"?this.panels.find(u=>u.id===t.referencePanel):t.referencePanel;if(!d)throw new Error(`reference panel ${t.referencePanel} does not exist`);if(s=this.findGroup(d),!s)throw new Error(`reference group for reference panel ${t.referencePanel} does not exist`)}else if(CEe(t)){if(s=typeof t.referenceGroup=="string"?(n=this._groups.get(t.referenceGroup))===null||n===void 0?void 0:n.value:t.referenceGroup,!s)throw new Error(`reference group ${t.referenceGroup} does not exist`)}else{const d=this.orthogonalize(OR(t.direction),t);return t.skipSetActive||this.doSetGroupAndPanelActive(d),d}const i=eC(t.direction||"within"),o=fs(s.element),r=bl(this.gridview.orientation,o,i),l=this.createGroup(t),c=this.getLocationOrientation(r)===Ke.VERTICAL?t.initialHeight:t.initialWidth;return this.doAddGroup(l,r,c),t.skipSetActive||this.doSetGroupAndPanelActive(l),l}else{const s=this.createGroup(t);return this.doAddGroup(s),this.doSetGroupAndPanelActive(s),s}}getLocationOrientation(t){return t.length%2==0&&this.gridview.orientation===Ke.HORIZONTAL?Ke.HORIZONTAL:Ke.VERTICAL}removeGroup(t,n){this.doRemoveGroup(t,n)}doRemoveGroup(t,n){var s;const i=[...t.panels];if(!n?.skipDispose)for(const l of i)this.removePanel(l,{removeEmptyGroup:!1,skipDispose:(s=n?.skipDispose)!==null&&s!==void 0?s:!1});const o=this.activePanel;if(t.api.location.type==="floating"){const l=this._floatingGroups.find(c=>c.group===t);if(l){if(n?.skipDispose||(l.group.dispose(),this._groups.delete(t.id),this._onDidRemoveGroup.fire(t)),uI(this._floatingGroups,l),l.dispose(),!n?.skipActive&&this._activeGroup===t){const c=Array.from(this._groups.values());this.doSetGroupAndPanelActive(c.length>0?c[0].value:void 0)}return l.group}throw new Error("failed to find floating group")}if(t.api.location.type==="popout"){const l=this._popoutGroups.find(c=>c.popoutGroup===t);if(l){if(!n?.skipDispose){if(!n?.skipPopoutAssociated){const d=l.referenceGroup?this.getPanel(l.referenceGroup):void 0;d&&d.panels.length===0&&this.removeGroup(d)}l.popoutGroup.dispose(),this._groups.delete(t.id),this._onDidRemoveGroup.fire(t)}uI(this._popoutGroups,l);const c=l.disposable.dispose();if(!n?.skipPopoutReturn&&c&&(this.doAddGroup(c,[0]),this.doSetGroupAndPanelActive(c)),!n?.skipActive&&this._activeGroup===t){const d=Array.from(this._groups.values());this.doSetGroupAndPanelActive(d.length>0?d[0].value:void 0)}return this.updateWatermark(),l.popoutGroup}throw new Error("failed to find popout group")}const r=super.doRemoveGroup(t,n);return n?.skipActive||this.activePanel!==o&&this._onDidActivePanelChange.fire(this.activePanel),r}movingLock(t){const n=this._moving;try{return this._moving=!0,t()}finally{this._moving=n}}moveGroupOrPanel(t){var n;const s=t.to.group,i=t.from.groupId,o=t.from.panelId,r=t.to.position,l=t.to.index,c=i?(n=this._groups.get(i))===null||n===void 0?void 0:n.value:void 0;if(!c)throw new Error(`Failed to find group id ${i}`);if(o===void 0){this.moveGroup({from:{group:c},to:{group:s,position:r},skipSetActive:t.skipSetActive});return}if(!r||r==="center"){const d=this.movingLock(()=>c.model.removePanel(o,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!d)throw new Error(`No panel with id ${o}`);c.model.size===0&&this.doRemoveGroup(c,{skipActive:!0});const u=s.model.size===0;this.movingLock(()=>{var p;return s.model.openPanel(d,{index:l,skipSetActive:((p=t.skipSetActive)!==null&&p!==void 0?p:!1)&&!u,skipSetGroupActive:!0})}),t.skipSetActive||this.doSetGroupAndPanelActive(s),this._onDidMovePanel.fire({panel:d,from:c})}else{const d=fs(s.element),u=bl(this.gridview.orientation,d,r);if(c.size<2){const[p,m]=Tc(u);if(c.api.location.type==="grid"){const b=fs(c.element),[C,y]=Tc(b);if(NK(C,p)){this.gridview.moveView(C,y,m),this._onDidMovePanel.fire({panel:this.getGroupPanel(o),from:c});return}}if(c.api.location.type==="popout"){const b=this._popoutGroups.find(x=>x.popoutGroup===c),C=this.movingLock(()=>b.popoutGroup.model.removePanel(b.popoutGroup.panels[0],{skipSetActive:!0,skipSetActiveGroup:!0}));this.doRemoveGroup(c,{skipActive:!0});const y=this.createGroupAtLocation(u);this.movingLock(()=>y.model.openPanel(C)),this.doSetGroupAndPanelActive(y),this._onDidMovePanel.fire({panel:this.getGroupPanel(o),from:c});return}const f=this.movingLock(()=>this.doRemoveGroup(c,{skipActive:!0,skipDispose:!0})),g=fs(s.element),v=bl(this.gridview.orientation,g,r);this.movingLock(()=>this.doAddGroup(f,v)),this.doSetGroupAndPanelActive(f),this._onDidMovePanel.fire({panel:this.getGroupPanel(o),from:c})}else{const p=this.movingLock(()=>c.model.removePanel(o,{skipSetActive:!1,skipSetActiveGroup:!0}));if(!p)throw new Error(`No panel with id ${o}`);const m=bl(this.gridview.orientation,d,r),f=this.createGroupAtLocation(m);this.movingLock(()=>f.model.openPanel(p,{skipSetGroupActive:!0})),this.doSetGroupAndPanelActive(f),this._onDidMovePanel.fire({panel:p,from:c})}}}moveGroup(t){const n=t.from.group,s=t.to.group,i=t.to.position;if(i==="center"){const o=n.activePanel,r=this.movingLock(()=>[...n.panels].map(l=>n.model.removePanel(l.id,{skipSetActive:!0})));n?.model.size===0&&this.doRemoveGroup(n,{skipActive:!0}),this.movingLock(()=>{for(const l of r)s.model.openPanel(l,{skipSetActive:l!==o,skipSetGroupActive:!0})}),t.skipSetActive!==!0?this.doSetGroupAndPanelActive(s):this.activePanel||this.doSetGroupAndPanelActive(s)}else{switch(n.api.location.type){case"grid":this.gridview.removeView(fs(n.element));break;case"floating":{const o=this._floatingGroups.find(r=>r.group===n);if(!o)throw new Error("failed to find floating group");o.dispose();break}case"popout":{const o=this._popoutGroups.find(l=>l.popoutGroup===n);if(!o)throw new Error("failed to find popout group");const r=this._popoutGroups.indexOf(o);if(r>=0&&this._popoutGroups.splice(r,1),o.referenceGroup){const l=this.getPanel(o.referenceGroup);l&&!l.api.isVisible&&this.doRemoveGroup(l,{skipActive:!0})}o.window.dispose(),s.api.location.type==="grid"?(n.model.renderContainer=this.overlayRenderContainer,n.model.dropTargetContainer=this.rootDropTargetContainer,n.model.location={type:"grid"}):s.api.location.type==="floating"&&(n.model.renderContainer=this.overlayRenderContainer,n.model.dropTargetContainer=this.rootDropTargetContainer,n.model.location={type:"floating"});break}}if(s.api.location.type==="grid"){const o=fs(s.element),r=bl(this.gridview.orientation,o,i);let l;switch(this.gridview.orientation){case Ke.VERTICAL:l=o.length%2==0?n.api.width:n.api.height;break;case Ke.HORIZONTAL:l=o.length%2==0?n.api.height:n.api.width;break}this.gridview.addView(n,l,r)}else if(s.api.location.type==="floating"){const o=this._floatingGroups.find(r=>r.group===s);if(o){const r=o.overlay.toJSON();let l,c;"left"in r?l=r.left+50:"right"in r?l=Math.max(0,r.right-r.width-50):l=50,"top"in r?c=r.top+50:"bottom"in r?c=Math.max(0,r.bottom-r.height-50):c=50,this.addFloatingGroup(n,{height:r.height,width:r.width,position:{left:l,top:c}})}}}if(n.panels.forEach(o=>{this._onDidMovePanel.fire({panel:o,from:n})}),t.skipSetActive===!1){const o=s??n;this.doSetGroupAndPanelActive(o)}}doSetGroupActive(t){super.doSetGroupActive(t);const n=this.activePanel;!this._moving&&n!==this._onDidActivePanelChange.value&&this._onDidActivePanelChange.fire(n)}doSetGroupAndPanelActive(t){super.doSetGroupActive(t);const n=this.activePanel;t&&this.hasMaximizedGroup()&&!this.isMaximizedGroup(t)&&this.exitMaximizedGroup(),!this._moving&&n!==this._onDidActivePanelChange.value&&this._onDidActivePanelChange.fire(n)}getNextGroupId(){let t=this.nextGroupId.next();for(;this._groups.has(t);)t=this.nextGroupId.next();return t}createGroup(t){t||(t={});let n=t?.id;if(n&&this._groups.has(t.id)&&(console.warn(`dockview: Duplicate group id ${t?.id}. reassigning group id to avoid errors`),n=void 0),!n)for(n=this.nextGroupId.next();this._groups.has(n);)n=this.nextGroupId.next();const s=new NR(this,n,t);if(s.init({params:{},accessor:this}),!this._groups.has(s.id)){const i=new jt(s.model.onTabDragStart(o=>{this._onWillDragPanel.fire(o)}),s.model.onGroupDragStart(o=>{this._onWillDragGroup.fire(o)}),s.model.onMove(o=>{const{groupId:r,itemId:l,target:c,index:d}=o;this.moveGroupOrPanel({from:{groupId:r,panelId:l},to:{group:s,position:c,index:d}})}),s.model.onDidDrop(o=>{this._onDidDrop.fire(o)}),s.model.onWillDrop(o=>{this._onWillDrop.fire(o)}),s.model.onWillShowOverlay(o=>{if(this.options.disableDnd){o.preventDefault();return}this._onWillShowOverlay.fire(o)}),s.model.onUnhandledDragOverEvent(o=>{this._onUnhandledDragOverEvent.fire(o)}),s.model.onDidAddPanel(o=>{this._moving||this._onDidAddPanel.fire(o.panel)}),s.model.onDidRemovePanel(o=>{this._moving||this._onDidRemovePanel.fire(o.panel)}),s.model.onDidActivePanelChange(o=>{this._moving||o.panel===this.activePanel&&this._onDidActivePanelChange.value!==o.panel&&this._onDidActivePanelChange.fire(o.panel)}),ch.any(s.model.onDidPanelTitleChange,s.model.onDidPanelParametersChange)(()=>{this._bufferOnDidLayoutChange.fire()}));this._groups.set(s.id,{value:s,disposable:i})}return s.initialize(),s}createPanel(t,n){var s,i,o;const r=t.component,l=(s=t.tabComponent)!==null&&s!==void 0?s:this.options.defaultTabComponent,c=new XK(this,t.id,r,l),d=new Op(t.id,r,l,this,this._api,n,c,{renderer:t.renderer,minimumWidth:t.minimumWidth,minimumHeight:t.minimumHeight,maximumWidth:t.maximumWidth,maximumHeight:t.maximumHeight});return d.init({title:(i=t.title)!==null&&i!==void 0?i:t.id,params:(o=t?.params)!==null&&o!==void 0?o:{}}),d}createGroupAtLocation(t,n,s){const i=this.createGroup(s);return this.doAddGroup(i,t,n),i}findGroup(t){var n;return(n=Array.from(this._groups.values()).find(s=>s.value.model.containsPanel(t)))===null||n===void 0?void 0:n.value}orientationAtLocation(t){const n=this.gridview.orientation;return t.length%2==1?n:kl(n)}updateDropTargetModel(t){"dndEdges"in t&&(this._rootDropTarget.disabled=typeof t.dndEdges=="boolean"&&t.dndEdges===!1,typeof t.dndEdges=="object"&&t.dndEdges!==null?this._rootDropTarget.setOverlayModel(t.dndEdges):this._rootDropTarget.setOverlayModel(VR)),"rootOverlayModel"in t&&this.updateDropTargetModel({dndEdges:t.dndEdges})}updateTheme(){var t,n;const s=(t=this._options.theme)!==null&&t!==void 0?t:IEe;switch(this._themeClassnames.setClassNames(s.className),this.gridview.margin=(n=s.gap)!==null&&n!==void 0?n:0,s.dndOverlayMounting){case"absolute":this.rootDropTargetContainer.disabled=!1;break;case"relative":default:this.rootDropTargetContainer.disabled=!0;break}}}class zEe extends BK{get orientation(){return this.gridview.orientation}set orientation(t){this.gridview.orientation=t}get options(){return this._options}get deserializer(){return this._deserializer}set deserializer(t){this._deserializer=t}constructor(t,n){var s;super(t,{proportionalLayout:(s=n.proportionalLayout)!==null&&s!==void 0?s:!0,orientation:n.orientation,styles:n.hideBorders?{separatorBorder:"transparent"}:void 0,disableAutoResizing:n.disableAutoResizing,className:n.className}),this._onDidLayoutfromJSON=new Ce,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidRemoveGroup=new Ce,this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidAddGroup=new Ce,this.onDidAddGroup=this._onDidAddGroup.event,this._onDidActiveGroupChange=new Ce,this.onDidActiveGroupChange=this._onDidActiveGroupChange.event,this._options=n,this.addDisposables(this._onDidAddGroup,this._onDidRemoveGroup,this._onDidActiveGroupChange,this.onDidAdd(i=>{this._onDidAddGroup.fire(i)}),this.onDidRemove(i=>{this._onDidRemoveGroup.fire(i)}),this.onDidActiveChange(i=>{this._onDidActiveGroupChange.fire(i)}))}updateOptions(t){super.updateOptions(t);const n=typeof t.orientation=="string"&&this.gridview.orientation!==t.orientation;this._options=Object.assign(Object.assign({},this.options),t),n&&(this.gridview.orientation=t.orientation),this.layout(this.gridview.width,this.gridview.height,!0)}removePanel(t){this.removeGroup(t)}toJSON(){var t;return{grid:this.gridview.serialize(),activePanel:(t=this.activeGroup)===null||t===void 0?void 0:t.id}}setVisible(t,n){this.gridview.setViewVisible(fs(t.element),n)}setActive(t){this._groups.forEach((n,s)=>{n.value.setActive(t===n.value)})}focus(){var t;(t=this.activeGroup)===null||t===void 0||t.focus()}fromJSON(t){this.clear();const{grid:n,activePanel:s}=t;try{const i=[],o=this.width,r=this.height;if(this.gridview.deserialize(n,{fromJSON:l=>{const{data:c}=l,d=this.options.createComponent({id:c.id,name:c.component});return i.push(()=>d.init({params:c.params,minimumWidth:c.minimumWidth,maximumWidth:c.maximumWidth,minimumHeight:c.minimumHeight,maximumHeight:c.maximumHeight,priority:c.priority,snap:!!c.snap,accessor:this,isVisible:l.visible})),this._onDidAddGroup.fire(d),this.registerPanel(d),d}}),this.layout(o,r,!0),i.forEach(l=>l()),typeof s=="string"){const l=this.getPanel(s);l&&this.doSetGroupActive(l)}}catch(i){for(const o of this.groups)o.dispose(),this._groups.delete(o.id),this._onDidRemoveGroup.fire(o);throw this.clear(),i}this._onDidLayoutfromJSON.fire()}clear(){const t=this.activeGroup,n=Array.from(this._groups.values());for(const s of n)s.disposable.dispose(),this.doRemoveGroup(s.value,{skipActive:!0});t&&this.doSetGroupActive(void 0),this.gridview.clear()}movePanel(t,n){var s;let i;const o=this.gridview.remove(t),r=(s=this._groups.get(n.reference))===null||s===void 0?void 0:s.value;if(!r)throw new Error(`reference group ${n.reference} does not exist`);const l=eC(n.direction);if(l==="center")throw new Error(`${l} not supported as an option`);{const c=fs(r.element);i=bl(this.gridview.orientation,c,l)}this.doAddGroup(o,i,n.size)}addPanel(t){var n,s,i,o;let r=(n=t.location)!==null&&n!==void 0?n:[0];if(!((s=t.position)===null||s===void 0)&&s.referencePanel){const c=(i=this._groups.get(t.position.referencePanel))===null||i===void 0?void 0:i.value;if(!c)throw new Error(`reference group ${t.position.referencePanel} does not exist`);const d=eC(t.position.direction);if(d==="center")throw new Error(`${d} not supported as an option`);{const u=fs(c.element);r=bl(this.gridview.orientation,u,d)}}const l=this.options.createComponent({id:t.id,name:t.component});return l.init({params:(o=t.params)!==null&&o!==void 0?o:{},minimumWidth:t.minimumWidth,maximumWidth:t.maximumWidth,minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight,priority:t.priority,snap:!!t.snap,accessor:this,isVisible:!0}),this.registerPanel(l),this.doAddGroup(l,r,t.size),this.doSetGroupActive(l),l}registerPanel(t){const n=new jt(t.api.onDidFocusChange(s=>{s.isFocused&&this._groups.forEach(i=>{const o=i.value;o!==t?o.setActive(!1):o.setActive(!0)})}));this._groups.set(t.id,{value:t,disposable:n})}moveGroup(t,n,s){const i=this.getPanel(n);if(!i)throw new Error("invalid operation");const o=fs(t.element),r=bl(this.gridview.orientation,o,s),[l,c]=Tc(r),d=fs(i.element),[u,p]=Tc(d);if(NK(u,l)){this.gridview.moveView(u,p,c);return}const m=this.doRemoveGroup(i,{skipActive:!0,skipDispose:!0}),f=fs(t.element),g=bl(this.gridview.orientation,f,s);this.doAddGroup(m,g)}removeGroup(t){super.removeGroup(t)}dispose(){super.dispose(),this._onDidLayoutfromJSON.dispose()}}class VEe extends d4{get panels(){return this.splitview.getViews()}get options(){return this._options}get length(){return this._panels.size}get orientation(){return this.splitview.orientation}get splitview(){return this._splitview}set splitview(t){this._splitview&&this._splitview.dispose(),this._splitview=t,this._splitviewChangeDisposable.value=new jt(this._splitview.onDidSashEnd(()=>{this._onDidLayoutChange.fire(void 0)}),this._splitview.onDidAddView(n=>this._onDidAddView.fire(n)),this._splitview.onDidRemoveView(n=>this._onDidRemoveView.fire(n)))}get minimumSize(){return this.splitview.minimumSize}get maximumSize(){return this.splitview.maximumSize}get height(){return this.splitview.orientation===Ke.HORIZONTAL?this.splitview.orthogonalSize:this.splitview.size}get width(){return this.splitview.orientation===Ke.HORIZONTAL?this.splitview.size:this.splitview.orthogonalSize}constructor(t,n){var s;super(document.createElement("div"),n.disableAutoResizing),this._splitviewChangeDisposable=new so,this._panels=new Map,this._onDidLayoutfromJSON=new Ce,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidAddView=new Ce,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new Ce,this.onDidRemoveView=this._onDidRemoveView.event,this._onDidLayoutChange=new Ce,this.onDidLayoutChange=this._onDidLayoutChange.event,this.element.style.height="100%",this.element.style.width="100%",this._classNames=new L_(this.element),this._classNames.setClassNames((s=n.className)!==null&&s!==void 0?s:""),t.appendChild(this.element),this._options=n,this.splitview=new Fv(this.element,n),this.addDisposables(this._onDidAddView,this._onDidLayoutfromJSON,this._onDidRemoveView,this._onDidLayoutChange)}updateOptions(t){var n,s;"className"in t&&this._classNames.setClassNames((n=t.className)!==null&&n!==void 0?n:""),"disableResizing"in t&&(this.disableResizing=(s=t.disableAutoResizing)!==null&&s!==void 0?s:!1),typeof t.orientation=="string"&&(this.splitview.orientation=t.orientation),this._options=Object.assign(Object.assign({},this.options),t),this.splitview.layout(this.splitview.size,this.splitview.orthogonalSize)}focus(){var t;(t=this._activePanel)===null||t===void 0||t.focus()}movePanel(t,n){this.splitview.moveView(t,n)}setVisible(t,n){const s=this.panels.indexOf(t);this.splitview.setViewVisible(s,n)}setActive(t,n){this._activePanel=t,this.panels.filter(s=>s!==t).forEach(s=>{s.api._onDidActiveChange.fire({isActive:!1}),n||s.focus()}),t.api._onDidActiveChange.fire({isActive:!0}),n||t.focus()}removePanel(t,n){const s=this._panels.get(t.id);if(!s)throw new Error(`unknown splitview panel ${t.id}`);s.dispose(),this._panels.delete(t.id);const i=this.panels.findIndex(l=>l===t);this.splitview.removeView(i,n).dispose();const r=this.panels;r.length>0&&this.setActive(r[r.length-1])}getPanel(t){return this.panels.find(n=>n.id===t)}addPanel(t){var n;if(this._panels.has(t.id))throw new Error(`panel ${t.id} already exists`);const s=this.options.createComponent({id:t.id,name:t.component});s.orientation=this.splitview.orientation,s.init({params:(n=t.params)!==null&&n!==void 0?n:{},minimumSize:t.minimumSize,maximumSize:t.maximumSize,snap:t.snap,priority:t.priority,accessor:this});const i=typeof t.size=="number"?t.size:Wa.Distribute,o=typeof t.index=="number"?t.index:void 0;return this.splitview.addView(s,i,o),this.doAddView(s),this.setActive(s),s}layout(t,n){const[s,i]=this.splitview.orientation===Ke.HORIZONTAL?[t,n]:[n,t];this.splitview.layout(s,i)}doAddView(t){const n=t.api.onDidFocusChange(s=>{s.isFocused&&this.setActive(t,!0)});this._panels.set(t.id,n)}toJSON(){var t;return{views:this.splitview.getViews().map((s,i)=>({size:this.splitview.getViewSize(i),data:s.toJSON(),snap:!!s.snap,priority:s.priority})),activeView:(t=this._activePanel)===null||t===void 0?void 0:t.id,size:this.splitview.size,orientation:this.splitview.orientation}}fromJSON(t){this.clear();const{views:n,orientation:s,size:i,activeView:o}=t,r=[],l=this.width,c=this.height;if(this.splitview=new Fv(this.element,{orientation:s,proportionalLayout:this.options.proportionalLayout,descriptor:{size:i,views:n.map(d=>{const u=d.data;if(this._panels.has(u.id))throw new Error(`panel ${u.id} already exists`);const p=this.options.createComponent({id:u.id,name:u.component});return r.push(()=>{var m;p.init({params:(m=u.params)!==null&&m!==void 0?m:{},minimumSize:u.minimumSize,maximumSize:u.maximumSize,snap:d.snap,priority:d.priority,accessor:this})}),p.orientation=s,this.doAddView(p),setTimeout(()=>{this._onDidAddView.fire(p)},0),{size:d.size,view:p}})}}),this.layout(l,c),r.forEach(d=>d()),typeof o=="string"){const d=this.getPanel(o);d&&this.setActive(d)}this._onDidLayoutfromJSON.fire()}clear(){for(const t of this._panels.values())t.dispose();for(this._panels.clear();this.splitview.length>0;)this.splitview.removeView(0,Wa.Distribute,!0).dispose()}dispose(){for(const n of this._panels.values())n.dispose();this._panels.clear();const t=this.splitview.getViews();this._splitviewChangeDisposable.dispose(),this.splitview.dispose();for(const n of t)n.dispose();this.element.remove(),super.dispose()}}class $R extends jt{get element(){return this._element}constructor(){super(),this._expandedIcon=mEe(),this._collapsedIcon=qK(),this.disposable=new so,this.apiRef={api:null},this._element=document.createElement("div"),this.element.className="dv-default-header",this._content=document.createElement("span"),this._expander=document.createElement("div"),this._expander.className="dv-pane-header-icon",this.element.appendChild(this._expander),this.element.appendChild(this._content),this.addDisposables(Vt(this._element,"click",()=>{var t;(t=this.apiRef.api)===null||t===void 0||t.setExpanded(!this.apiRef.api.isExpanded)}))}init(t){this.apiRef.api=t.api,this._content.textContent=t.title,this.updateIcon(),this.disposable.value=t.api.onDidExpansionChange(()=>{this.updateIcon()})}updateIcon(){var t;const n=!!(!((t=this.apiRef.api)===null||t===void 0)&&t.isExpanded);wt(this._expander,"collapsed",!n),n?(this._expander.contains(this._collapsedIcon)&&this._collapsedIcon.remove(),this._expander.contains(this._expandedIcon)||this._expander.appendChild(this._expandedIcon)):(this._expander.contains(this._expandedIcon)&&this._expandedIcon.remove(),this._expander.contains(this._collapsedIcon)||this._expander.appendChild(this._collapsedIcon))}update(t){}dispose(){this.disposable.dispose(),super.dispose()}}const $Ee=c4(),GR=22,HR=0,WR=Number.MAX_SAFE_INTEGER;class UR extends rEe{constructor(t){super({accessor:t.accessor,id:t.id,component:t.component,headerComponent:t.headerComponent,orientation:t.orientation,isExpanded:t.isExpanded,disableDnd:t.disableDnd,headerSize:t.headerSize,minimumBodySize:t.minimumBodySize,maximumBodySize:t.maximumBodySize}),this.options=t}getBodyComponent(){return this.options.body}getHeaderComponent(){return this.options.header}}class GEe extends d4{get id(){return this._id}get panels(){return this.paneview.getPanes()}set paneview(t){this._paneview=t,this._disposable.value=new jt(this._paneview.onDidChange(()=>{this._onDidLayoutChange.fire(void 0)}),this._paneview.onDidAddView(n=>this._onDidAddView.fire(n)),this._paneview.onDidRemoveView(n=>this._onDidRemoveView.fire(n)))}get paneview(){return this._paneview}get minimumSize(){return this.paneview.minimumSize}get maximumSize(){return this.paneview.maximumSize}get height(){return this.paneview.orientation===Ke.HORIZONTAL?this.paneview.orthogonalSize:this.paneview.size}get width(){return this.paneview.orientation===Ke.HORIZONTAL?this.paneview.size:this.paneview.orthogonalSize}get options(){return this._options}constructor(t,n){var s;super(document.createElement("div"),n.disableAutoResizing),this._id=$Ee.next(),this._disposable=new so,this._viewDisposables=new Map,this._onDidLayoutfromJSON=new Ce,this.onDidLayoutFromJSON=this._onDidLayoutfromJSON.event,this._onDidLayoutChange=new Ce,this.onDidLayoutChange=this._onDidLayoutChange.event,this._onDidDrop=new Ce,this.onDidDrop=this._onDidDrop.event,this._onDidAddView=new Ce,this.onDidAddView=this._onDidAddView.event,this._onDidRemoveView=new Ce,this.onDidRemoveView=this._onDidRemoveView.event,this._onUnhandledDragOverEvent=new Ce,this.onUnhandledDragOverEvent=this._onUnhandledDragOverEvent.event,this.element.style.height="100%",this.element.style.width="100%",this.addDisposables(this._onDidLayoutChange,this._onDidLayoutfromJSON,this._onDidDrop,this._onDidAddView,this._onDidRemoveView,this._onUnhandledDragOverEvent),this._classNames=new L_(this.element),this._classNames.setClassNames((s=n.className)!==null&&s!==void 0?s:""),t.appendChild(this.element),this._options=n,this.paneview=new RR(this.element,{orientation:Ke.VERTICAL}),this.addDisposables(this._disposable)}setVisible(t,n){const s=this.panels.indexOf(t);this.paneview.setViewVisible(s,n)}focus(){}updateOptions(t){var n,s;"className"in t&&this._classNames.setClassNames((n=t.className)!==null&&n!==void 0?n:""),"disableResizing"in t&&(this.disableResizing=(s=t.disableAutoResizing)!==null&&s!==void 0?s:!1),this._options=Object.assign(Object.assign({},this.options),t)}addPanel(t){var n,s;const i=this.options.createComponent({id:t.id,name:t.component});let o;t.headerComponent&&this.options.createHeaderComponent&&(o=this.options.createHeaderComponent({id:t.id,name:t.headerComponent})),o||(o=new $R);const r=new UR({id:t.id,component:t.component,headerComponent:t.headerComponent,header:o,body:i,orientation:Ke.VERTICAL,isExpanded:!!t.isExpanded,disableDnd:!!this.options.disableDnd,accessor:this,headerSize:(n=t.headerSize)!==null&&n!==void 0?n:GR,minimumBodySize:HR,maximumBodySize:WR});this.doAddPanel(r);const l=typeof t.size=="number"?t.size:Wa.Distribute,c=typeof t.index=="number"?t.index:void 0;return r.init({params:(s=t.params)!==null&&s!==void 0?s:{},minimumBodySize:t.minimumBodySize,maximumBodySize:t.maximumBodySize,isExpanded:t.isExpanded,title:t.title,containerApi:new Bv(this),accessor:this}),this.paneview.addPane(r,l,c),r.orientation=this.paneview.orientation,r}removePanel(t){const s=this.panels.findIndex(i=>i===t);this.paneview.removePane(s),this.doRemovePanel(t)}movePanel(t,n){this.paneview.moveView(t,n)}getPanel(t){return this.panels.find(n=>n.id===t)}layout(t,n){const[s,i]=this.paneview.orientation===Ke.HORIZONTAL?[t,n]:[n,t];this.paneview.layout(s,i)}toJSON(){const t=i=>i===Number.MAX_SAFE_INTEGER||i===Number.POSITIVE_INFINITY?void 0:i,n=i=>i<=0?void 0:i;return{views:this.paneview.getPanes().map((i,o)=>({size:this.paneview.getViewSize(o),data:i.toJSON(),minimumSize:n(i.minimumBodySize),maximumSize:t(i.maximumBodySize),headerSize:i.headerSize,expanded:i.isExpanded()})),size:this.paneview.size}}fromJSON(t){this.clear();const{views:n,size:s}=t,i=[],o=this.width,r=this.height;this.paneview=new RR(this.element,{orientation:Ke.VERTICAL,descriptor:{size:s,views:n.map(l=>{var c,d,u;const p=l.data,m=this.options.createComponent({id:p.id,name:p.component});let f;p.headerComponent&&this.options.createHeaderComponent&&(f=this.options.createHeaderComponent({id:p.id,name:p.headerComponent})),f||(f=new $R);const g=new UR({id:p.id,component:p.component,headerComponent:p.headerComponent,header:f,body:m,orientation:Ke.VERTICAL,isExpanded:!!l.expanded,disableDnd:!!this.options.disableDnd,accessor:this,headerSize:(c=l.headerSize)!==null&&c!==void 0?c:GR,minimumBodySize:(d=l.minimumSize)!==null&&d!==void 0?d:HR,maximumBodySize:(u=l.maximumSize)!==null&&u!==void 0?u:WR});return this.doAddPanel(g),i.push(()=>{var v;g.init({params:(v=p.params)!==null&&v!==void 0?v:{},minimumBodySize:l.minimumSize,maximumBodySize:l.maximumSize,title:p.title,isExpanded:!!l.expanded,containerApi:new Bv(this),accessor:this}),g.orientation=this.paneview.orientation}),setTimeout(()=>{this._onDidAddView.fire(g)},0),{size:l.size,view:g}})}}),this.layout(o,r),i.forEach(l=>l()),this._onDidLayoutfromJSON.fire()}clear(){for(const[t,n]of this._viewDisposables.entries())n.dispose();this._viewDisposables.clear(),this.paneview.dispose()}doAddPanel(t){const n=new jt(t.onDidDrop(s=>{this._onDidDrop.fire(s)}),t.onUnhandledDragOverEvent(s=>{this._onUnhandledDragOverEvent.fire(s)}));this._viewDisposables.set(t.id,n)}doRemovePanel(t){const n=this._viewDisposables.get(t.id);n&&(n.dispose(),this._viewDisposables.delete(t.id))}dispose(){super.dispose();for(const[t,n]of this._viewDisposables.entries())n.dispose();this._viewDisposables.clear(),this.element.remove(),this.paneview.dispose()}}class HEe extends h4{get priority(){return this._priority}set orientation(t){this._orientation=t}get orientation(){return this._orientation}get minimumSize(){const t=typeof this._minimumSize=="function"?this._minimumSize():this._minimumSize;return t!==this._evaluatedMinimumSize&&(this._evaluatedMinimumSize=t,this.updateConstraints()),t}get maximumSize(){const t=typeof this._maximumSize=="function"?this._maximumSize():this._maximumSize;return t!==this._evaluatedMaximumSize&&(this._evaluatedMaximumSize=t,this.updateConstraints()),t}get snap(){return this._snap}constructor(t,n){super(t,n,new WK(t,n)),this._evaluatedMinimumSize=0,this._evaluatedMaximumSize=Number.POSITIVE_INFINITY,this._minimumSize=0,this._maximumSize=Number.POSITIVE_INFINITY,this._snap=!1,this._onDidChange=new Ce,this.onDidChange=this._onDidChange.event,this.api.initialize(this),this.addDisposables(this._onDidChange,this.api.onWillVisibilityChange(s=>{const{isVisible:i}=s,{accessor:o}=this._params;o.setVisible(this,i)}),this.api.onActiveChange(()=>{const{accessor:s}=this._params;s.setActive(this)}),this.api.onDidConstraintsChangeInternal(s=>{(typeof s.minimumSize=="number"||typeof s.minimumSize=="function")&&(this._minimumSize=s.minimumSize),(typeof s.maximumSize=="number"||typeof s.maximumSize=="function")&&(this._maximumSize=s.maximumSize),this.updateConstraints()}),this.api.onDidSizeChange(s=>{this._onDidChange.fire({size:s.size})}))}setVisible(t){this.api._onDidVisibilityChange.fire({isVisible:t})}setActive(t){this.api._onDidActiveChange.fire({isActive:t})}layout(t,n){const[s,i]=this.orientation===Ke.HORIZONTAL?[t,n]:[n,t];super.layout(s,i)}init(t){super.init(t),this._priority=t.priority,t.minimumSize&&(this._minimumSize=t.minimumSize),t.maximumSize&&(this._maximumSize=t.maximumSize),t.snap&&(this._snap=t.snap)}toJSON(){const t=s=>s===Number.MAX_SAFE_INTEGER||s===Number.POSITIVE_INFINITY?void 0:s,n=s=>s<=0?void 0:s;return Object.assign(Object.assign({},super.toJSON()),{minimumSize:n(this.minimumSize),maximumSize:t(this.maximumSize)})}updateConstraints(){this.api._onDidConstraintsChange.fire({maximumSize:this._evaluatedMaximumSize,minimumSize:this._evaluatedMinimumSize})}}function WEe(e,t){return new BEe(e,t).api}function UEe(e,t){const n=new VEe(e,t);return new zK(n)}function qEe(e,t){const n=new zEe(e,t);return new VK(n)}function KEe(e,t){const n=new GEe(e,t);return new Bv(n)}const YK=(e,t)=>{const[n,s]=ce.useState(),i=ce.useRef(e.componentProps);return ce.useImperativeHandle(t,()=>({update:o=>{i.current=Object.assign(Object.assign({},i.current),o),s(Date.now())}}),[]),ce.createElement(e.component,i.current)};YK.displayName="DockviewReactJsBridge";const ZEe=(()=>{let e=1;return{next:()=>`dockview_react_portal_key_${(e++).toString()}`}})(),XEe=ce.createContext({});class $h{constructor(t,n,s,i,o){this.parent=t,this.portalStore=n,this.component=s,this.parameters=i,this.context=o,this._initialProps={},this.disposed=!1,this.createPortal()}update(t){if(this.disposed)throw new Error("invalid operation: resource is already disposed");this.componentInstance?this.componentInstance.update(t):this._initialProps=Object.assign(Object.assign({},this._initialProps),t)}createPortal(){if(this.disposed)throw new Error("invalid operation: resource is already disposed");if(!YEe(this.component))throw new Error("Dockview: Only React.memo(...), React.ForwardRef(...) and functional components are accepted as components");const t=ce.createElement(ce.forwardRef(YK),{component:this.component,componentProps:this.parameters,ref:i=>{this.componentInstance=i,Object.keys(this._initialProps).length>0&&(this.componentInstance.update(this._initialProps),this._initialProps={})}}),n=this.context?ce.createElement(XEe.Provider,{value:this.context},t):t,s=HD.createPortal(n,this.parent,ZEe.next());this.ref={portal:s,disposable:this.portalStore.addPortal(s)}}dispose(){var t;(t=this.ref)===null||t===void 0||t.disposable.dispose(),this.disposed=!0}}const N_=()=>{const[e,t]=ce.useState([]);ce.useDebugValue(`Portal count: ${e.length}`);const n=ce.useCallback(s=>{t(o=>[...o,s]);let i=!1;return Bs.from(()=>{if(i)throw new Error("invalid operation: resource already disposed");i=!0,t(o=>o.filter(r=>r!==s))})},[]);return[e,n]};function YEe(e){return typeof e=="function"||!!e?.$$typeof}class qR{get element(){return this._element}constructor(t,n,s){this.id=t,this.component=n,this.reactPortalStore=s,this._onDidFocus=new Ce,this.onDidFocus=this._onDidFocus.event,this._onDidBlur=new Ce,this.onDidBlur=this._onDidBlur.event,this._element=document.createElement("div"),this._element.className="dv-react-part",this._element.style.height="100%",this._element.style.width="100%"}focus(){}init(t){this.part=new $h(this.element,this.reactPortalStore,this.component,{params:t.params,api:t.api,containerApi:t.containerApi})}update(t){var n;(n=this.part)===null||n===void 0||n.update({params:t.params})}layout(t,n){}dispose(){var t;this._onDidFocus.dispose(),this._onDidBlur.dispose(),(t=this.part)===null||t===void 0||t.dispose()}}class KR{get element(){return this._element}constructor(t,n,s){this.id=t,this.component=n,this.reactPortalStore=s,this._element=document.createElement("div"),this._element.className="dv-react-part",this._element.style.height="100%",this._element.style.width="100%"}focus(){}init(t){this.part=new $h(this.element,this.reactPortalStore,this.component,{params:t.params,api:t.api,containerApi:t.containerApi,tabLocation:t.tabLocation})}update(t){var n;(n=this.part)===null||n===void 0||n.update({params:t.params})}layout(t,n){}dispose(){var t;(t=this.part)===null||t===void 0||t.dispose()}}class ZR{get element(){return this._element}constructor(t,n,s){this.id=t,this.component=n,this.reactPortalStore=s,this._element=document.createElement("div"),this._element.className="dv-react-part",this._element.style.height="100%",this._element.style.width="100%"}init(t){this.part=new $h(this.element,this.reactPortalStore,this.component,{group:t.group,containerApi:t.containerApi})}focus(){}update(t){var n,s,i;this.parameters&&(this.parameters.params=t.params),(n=this.part)===null||n===void 0||n.update({params:(i=(s=this.parameters)===null||s===void 0?void 0:s.params)!==null&&i!==void 0?i:{}})}layout(t,n){}dispose(){var t;(t=this.part)===null||t===void 0||t.dispose()}}class QEe{get element(){return this._element}get part(){return this._part}constructor(t,n,s){this.component=t,this.reactPortalStore=n,this._group=s,this.mutableDisposable=new so,this._element=document.createElement("div"),this._element.className="dv-react-part",this._element.style.height="100%",this._element.style.width="100%"}init(t){this.mutableDisposable.value=new jt(this._group.model.onDidAddPanel(()=>{this.updatePanels()}),this._group.model.onDidRemovePanel(()=>{this.updatePanels()}),this._group.model.onDidActivePanelChange(()=>{this.updateActivePanel()}),t.api.onDidActiveChange(()=>{this.updateGroupActive()})),this._part=new $h(this.element,this.reactPortalStore,this.component,{api:t.api,containerApi:t.containerApi,panels:this._group.model.panels,activePanel:this._group.model.activePanel,isGroupActive:this._group.api.isActive,group:this._group})}dispose(){var t;this.mutableDisposable.dispose(),(t=this._part)===null||t===void 0||t.dispose()}update(t){var n;(n=this._part)===null||n===void 0||n.update(t.params)}updatePanels(){this.update({params:{panels:this._group.model.panels}})}updateActivePanel(){this.update({params:{activePanel:this._group.model.activePanel}})}updateGroupActive(){this.update({params:{isGroupActive:this._group.api.isActive}})}}function cp(e,t){return e?n=>new QEe(e,t,n):void 0}const Ob="props.defaultTabComponent";function JEe(e){return bP.reduce((n,s)=>(s in e&&(n[s]=e[s]),n),{})}const t1=ce.forwardRef((e,t)=>{const n=ce.useRef(null),s=ce.useRef(),[i,o]=N_();ce.useImperativeHandle(t,()=>n.current,[]);const r=ce.useRef({});return ce.useEffect(()=>{const l={};bP.forEach(c=>{const d=c,u=e[d];d in e&&u!==r.current[d]&&(l[d]=u)}),s.current&&s.current.updateOptions(l),r.current=e},bP.map(l=>e[l])),ce.useEffect(()=>{var l;if(!n.current)return;const c=(l=e.tabComponents)!==null&&l!==void 0?l:{};e.defaultTabComponent&&(c[Ob]=e.defaultTabComponent);const d={createLeftHeaderActionComponent:cp(e.leftHeaderActionsComponent,{addPortal:o}),createRightHeaderActionComponent:cp(e.rightHeaderActionsComponent,{addPortal:o}),createPrefixHeaderActionComponent:cp(e.prefixHeaderActionsComponent,{addPortal:o}),createComponent:f=>new qR(f.id,e.components[f.name],{addPortal:o}),createTabComponent(f){return new KR(f.id,c[f.name],{addPortal:o})},createWatermarkComponent:e.watermarkComponent?()=>new ZR("watermark",e.watermarkComponent,{addPortal:o}):void 0,defaultTabComponent:e.defaultTabComponent?Ob:void 0},u=WEe(n.current,Object.assign(Object.assign({},JEe(e)),d)),{clientWidth:p,clientHeight:m}=n.current;return u.layout(p,m),e.onReady&&e.onReady({api:u}),s.current=u,()=>{s.current=void 0,u.dispose()}},[]),ce.useEffect(()=>{if(!s.current)return()=>{};const l=s.current.onDidDrop(c=>{e.onDidDrop&&e.onDidDrop(c)});return()=>{l.dispose()}},[e.onDidDrop]),ce.useEffect(()=>{if(!s.current)return()=>{};const l=s.current.onWillDrop(c=>{e.onWillDrop&&e.onWillDrop(c)});return()=>{l.dispose()}},[e.onWillDrop]),ce.useEffect(()=>{s.current&&s.current.updateOptions({createComponent:l=>new qR(l.id,e.components[l.name],{addPortal:o})})},[e.components]),ce.useEffect(()=>{var l;if(!s.current)return;const c=(l=e.tabComponents)!==null&&l!==void 0?l:{};e.defaultTabComponent&&(c[Ob]=e.defaultTabComponent),s.current.updateOptions({defaultTabComponent:e.defaultTabComponent?Ob:void 0,createTabComponent(d){return new KR(d.id,c[d.name],{addPortal:o})}})},[e.tabComponents,e.defaultTabComponent]),ce.useEffect(()=>{s.current&&s.current.updateOptions({createWatermarkComponent:e.watermarkComponent?()=>new ZR("watermark",e.watermarkComponent,{addPortal:o}):void 0})},[e.watermarkComponent]),ce.useEffect(()=>{s.current&&s.current.updateOptions({createRightHeaderActionComponent:cp(e.rightHeaderActionsComponent,{addPortal:o})})},[e.rightHeaderActionsComponent]),ce.useEffect(()=>{s.current&&s.current.updateOptions({createLeftHeaderActionComponent:cp(e.leftHeaderActionsComponent,{addPortal:o})})},[e.leftHeaderActionsComponent]),ce.useEffect(()=>{s.current&&s.current.updateOptions({createPrefixHeaderActionComponent:cp(e.prefixHeaderActionsComponent,{addPortal:o})})},[e.prefixHeaderActionsComponent]),ce.createElement("div",{style:{height:"100%",width:"100%"},ref:n},i)});t1.displayName="DockviewComponent";class XR extends HEe{constructor(t,n,s,i){super(t,n),this.reactComponent=s,this.reactPortalStore=i}getComponent(){var t,n;return new $h(this.element,this.reactPortalStore,this.reactComponent,{params:(n=(t=this._params)===null||t===void 0?void 0:t.params)!==null&&n!==void 0?n:{},api:this.api,containerApi:new zK(this._params.accessor)})}}function eAe(e){return pP.reduce((n,s)=>(s in e&&(n[s]=e[s]),n),{})}const tAe=ce.forwardRef((e,t)=>{const n=ce.useRef(null),s=ce.useRef(),[i,o]=N_();ce.useImperativeHandle(t,()=>n.current,[]);const r=ce.useRef({});return ce.useEffect(()=>{const l={};pP.forEach(c=>{const d=c,u=e[d];d in e&&u!==r.current[d]&&(l[d]=u)}),s.current&&s.current.updateOptions(l),r.current=e},pP.map(l=>e[l])),ce.useEffect(()=>{if(!n.current)return()=>{};const l={createComponent:p=>new XR(p.id,p.name,e.components[p.name],{addPortal:o})},c=UEe(n.current,Object.assign(Object.assign({},eAe(e)),l)),{clientWidth:d,clientHeight:u}=n.current;return c.layout(d,u),e.onReady&&e.onReady({api:c}),s.current=c,()=>{s.current=void 0,c.dispose()}},[]),ce.useEffect(()=>{s.current&&s.current.updateOptions({createComponent:l=>new XR(l.id,l.name,e.components[l.name],{addPortal:o})})},[e.components]),ce.createElement("div",{style:{height:"100%",width:"100%"},ref:n},i)});tAe.displayName="SplitviewComponent";class YR extends Fo{constructor(t,n,s,i){super(t,n),this.reactComponent=s,this.reactPortalStore=i}getComponent(){var t,n;return new $h(this.element,this.reactPortalStore,this.reactComponent,{params:(n=(t=this._params)===null||t===void 0?void 0:t.params)!==null&&n!==void 0?n:{},api:this.api,containerApi:new VK(this._params.accessor)})}}function nAe(e){return vP.reduce((n,s)=>(s in e&&(n[s]=e[s]),n),{})}const Eo=ce.forwardRef((e,t)=>{const n=ce.useRef(null),s=ce.useRef(),[i,o]=N_();ce.useImperativeHandle(t,()=>n.current,[]);const r=ce.useRef({});return ce.useEffect(()=>{const l={};vP.forEach(c=>{const d=c,u=e[d];d in e&&u!==r.current[d]&&(l[d]=u)}),s.current&&s.current.updateOptions(l),r.current=e},vP.map(l=>e[l])),ce.useEffect(()=>{if(!n.current)return()=>{};const l={createComponent:p=>new YR(p.id,p.name,e.components[p.name],{addPortal:o})},c=qEe(n.current,Object.assign(Object.assign({},nAe(e)),l)),{clientWidth:d,clientHeight:u}=n.current;return c.layout(d,u),e.onReady&&e.onReady({api:c}),s.current=c,()=>{s.current=void 0,c.dispose()}},[]),ce.useEffect(()=>{s.current&&s.current.updateOptions({createComponent:l=>new YR(l.id,l.name,e.components[l.name],{addPortal:o})})},[e.components]),ce.createElement("div",{style:{height:"100%",width:"100%"},ref:n},i)});Eo.displayName="GridviewComponent";class Nb{get element(){return this._element}constructor(t,n,s){this.id=t,this.component=n,this.reactPortalStore=s,this._element=document.createElement("div"),this._element.style.height="100%",this._element.style.width="100%"}init(t){this.part=new $h(this.element,this.reactPortalStore,this.component,{params:t.params,api:t.api,title:t.title,containerApi:t.containerApi})}toJSON(){return{id:this.id}}update(t){var n;(n=this.part)===null||n===void 0||n.update(t.params)}dispose(){var t;(t=this.part)===null||t===void 0||t.dispose()}}function sAe(e){return yP.reduce((n,s)=>(s in e&&(n[s]=e[s]),n),{})}const iAe=ce.forwardRef((e,t)=>{const n=ce.useRef(null),s=ce.useRef(),[i,o]=N_();ce.useImperativeHandle(t,()=>n.current,[]);const r=ce.useRef({});return ce.useEffect(()=>{const l={};yP.forEach(c=>{const d=c,u=e[d];d in e&&u!==r.current[d]&&(l[d]=u)}),s.current&&s.current.updateOptions(l),r.current=e},yP.map(l=>e[l])),ce.useEffect(()=>{var l;if(!n.current)return()=>{};const c=(l=e.headerComponents)!==null&&l!==void 0?l:{},d={createComponent:f=>new Nb(f.id,e.components[f.name],{addPortal:o}),createHeaderComponent:f=>new Nb(f.id,c[f.name],{addPortal:o})},u=KEe(n.current,Object.assign(Object.assign({},sAe(e)),d)),{clientWidth:p,clientHeight:m}=n.current;return u.layout(p,m),e.onReady&&e.onReady({api:u}),s.current=u,()=>{s.current=void 0,u.dispose()}},[]),ce.useEffect(()=>{s.current&&s.current.updateOptions({createComponent:l=>new Nb(l.id,e.components[l.name],{addPortal:o})})},[e.components]),ce.useEffect(()=>{var l;if(!s.current)return;const c=(l=e.headerComponents)!==null&&l!==void 0?l:{};s.current.updateOptions({createHeaderComponent:d=>new Nb(d.id,c[d.name],{addPortal:o})})},[e.headerComponents]),ce.useEffect(()=>{if(!s.current)return()=>{};const l=s.current.onDidDrop(c=>{e.onDidDrop&&e.onDidDrop(c)});return()=>{l.dispose()}},[e.onDidDrop]),ce.createElement("div",{style:{height:"100%",width:"100%"},ref:n},i)});iAe.displayName="PaneviewComponent";const qi="left",rr="main",Ki="right",ka="launchpad",Zn="workspace",cs="viewer",Ia="boards",ja="gallery",xP="layers",lr="settings",CP="models",wP="queue",F_="tab-default",fm="tab-progress",yu="tab-launchpad",QK="tab-canvas-viewer",JK="tab-canvas-workspace",ma=420,Pi=420,n1=36,oAe=128,B_=232,s1=36,aAe=128,i1=232,rAe=36,lAe=36,cAe=300,Qt=Ft("system").child({filePath:"features/ui/layouts/navigation-api.ts"});class dAe{panels=new Map;waiters=new Map;_$isLoading=De(!1);$isLoading=this._$isLoading;_prevActiveDockviewPanel=new Map;_currentActiveDockviewPanel=new Map;_disposablesForTab=new Map;_addDisposeForTab=(t,n)=>{let s=this._disposablesForTab.get(t);s||(s=new Set,this._disposablesForTab.set(t,s)),s.add(n)};KEY_SEPARATOR=":";_app=null;_$isConnected=De(!1);$isConnected=this._$isConnected;connectToApp=t=>{this._app=t,this._$isConnected.set(!0)};disconnectFromApp=()=>{this._app=null,this._$isConnected.set(!1)};_showFakeLoadingScreen=()=>{Qt.trace("Showing fake loading screen for tab switch"),this._$isLoading.set(!0),this._hideLoadingScreenDebounced()};_hideLoadingScreenDebounced=Y2(()=>{Qt.trace("Hiding fake loading screen for tab switch"),this._$isLoading.set(!1)},cAe);switchToTab=t=>this._app?t===this._app.activeTab.get()?(Qt.trace(`Already on tab: ${t}`),!0):(Qt.trace(`Switching to tab: ${t}`),this._showFakeLoadingScreen(),this._app.activeTab.set(t),!0):(Qt.error("No app connected to switch tabs"),!1);_registerPanel=(t,n,s)=>{const i=this._getPanelKey(t,n);this.panels.set(i,s);const o=this.waiters.get(i);return o&&(o.timeoutId&&clearTimeout(o.timeoutId),o.deferred.resolve(),this.waiters.delete(i)),Qt.trace(`Registered panel ${i}`),()=>{this.panels.delete(i),Qt.trace(`Unregistered panel ${i}`)}};registerContainer=(t,n,s,i)=>{if(!this._app){Qt.error("App not connected to register view");return}const o=this._getContainerKey(t,n),r=this._app.storage.get(o);if(r)try{s.fromJSON(r),Qt.trace({stored:ts(r)},`Restored view ${o} from storage`)}catch(l){Qt.error({error:ts(l)},`Failed to restore view ${o} from storage`),this._app.storage.delete(o),i(),this._app.storage.set(o,s.toJSON())}else i(),Qt.trace(`Initialized ${o} from scratch`),this._app.storage.set(o,s.toJSON());for(const l of s.panels)this._registerPanel(t,l.id,l);if(s instanceof zv){this._currentActiveDockviewPanel.set(t,s.activePanel?.id??null),this._prevActiveDockviewPanel.set(t,null);const{dispose:l}=s.onDidActivePanelChange(c=>{const d=this._currentActiveDockviewPanel.get(t);this._prevActiveDockviewPanel.set(t,d??null),this._currentActiveDockviewPanel.set(t,c?.id??null)});this._addDisposeForTab(t,l)}s.onDidLayoutChange(Y2(()=>{this._app?.storage.set(o,s.toJSON())},300)),Qt.trace(`Registered view ${o}`)};waitForPanel=(t,n,s=2e3)=>{const i=this._getPanelKey(t,n);if(this.panels.has(i))return Promise.resolve();const o=this.waiters.get(i);if(o)return o.deferred.promise;const r=TK(),l=setTimeout(()=>{this.waiters.get(i)&&(this.waiters.delete(i),r.reject(new Error(`Panel ${i} registration timed out after ${s}ms`)))},s);return this.waiters.set(i,{deferred:r,timeoutId:l}),r.promise};_getTabPrefix=t=>`${t}${this.KEY_SEPARATOR}`;_getPanelPrefix=t=>`${this._getTabPrefix(t)}panel${this.KEY_SEPARATOR}`;_getPanelKey=(t,n)=>`${this._getPanelPrefix(t)}${n}`;_getContainerPrefix=t=>`${this._getTabPrefix(t)}container${this.KEY_SEPARATOR}`;_getContainerKey=(t,n)=>`${this._getContainerPrefix(t)}${n}`;focusPanel=async(t,n,s=2e3)=>{try{this.switchToTab(t),await this.waitForPanel(t,n,s);const i=this._getPanelKey(t,n),o=this.panels.get(i);return o?(o.api.setActive(),Qt.trace(`Focused panel ${i}`),!0):(Qt.error(`Panel ${i} not found after waiting`),!1)}catch{return Qt.error(`Failed to focus panel ${n} in tab ${t}`),!1}};focusPanelInActiveTab=(t,n=2e3)=>{const s=this._app?.activeTab.get()??null;return s?this.focusPanel(s,t,n):(Qt.error("No active tab found"),Promise.resolve(!1))};_expandPanel=(t,n)=>{t.api.setConstraints({maximumWidth:Number.MAX_SAFE_INTEGER,minimumWidth:n}),t.api.setSize({width:n})};_collapsePanel=t=>{t.api.setConstraints({maximumWidth:0,minimumWidth:0}),t.api.setSize({width:0})};getPanel=(t,n)=>{const s=this._getPanelKey(t,n);return this.panels.get(s)};expandLeftPanel=()=>{const t=this._app?.activeTab.get()??null;if(!t)return Qt.warn("No active tab found to expand left panel"),!1;const n=this.getPanel(t,qi);return n?n instanceof Fo?(this._expandPanel(n,ma),!0):(Qt.error("Right panels must be instances of GridviewPanel"),!1):(Qt.warn(`Left panel not found in active tab "${t}"`),!1)};toggleLeftPanel=()=>{const t=this._app?.activeTab.get()??null;if(!t)return Qt.warn("No active tab found to toggle left panel"),!1;const n=this.getPanel(t,qi);return n?n instanceof Fo?(n.width===0?this._expandPanel(n,ma):this._collapsePanel(n),!0):(Qt.error("Right panels must be instances of GridviewPanel"),!1):(Qt.warn(`Left panel not found in active tab "${t}"`),!1)};expandRightPanel=()=>{const t=this._app?.activeTab.get()??null;if(!t)return Qt.warn("No active tab found to expand right panel"),!1;const n=this.getPanel(t,Ki);return n?n instanceof Fo?(this._expandPanel(n,Pi),!0):(Qt.error("Right panels must be instances of GridviewPanel"),!1):(Qt.warn(`Right panel not found in active tab "${t}"`),!1)};toggleRightPanel=()=>{const t=this._app?.activeTab.get()??null;if(!t)return Qt.warn("No active tab found to toggle right panel"),!1;const n=this.getPanel(t,Ki);return n?n instanceof Fo?(n.width===0?this._expandPanel(n,Pi):this._collapsePanel(n),!0):(Qt.error("Right panels must be instances of GridviewPanel"),!1):(Qt.warn(`Right panel not found in active tab "${t}"`),!1)};toggleLeftAndRightPanels=()=>{const t=this._app?.activeTab.get()??null;if(!t)return Qt.warn("No active tab found to toggle right panel"),!1;const n=this.getPanel(t,qi),s=this.getPanel(t,Ki);if(!s||!n)return Qt.warn(`Right and/or left panel not found in tab "${t}"`),!1;if(!(n instanceof Fo)||!(s instanceof Fo))return Qt.error("Left and right panels must be instances of GridviewPanel"),!1;const i=n.width===0,o=s.width===0;return i||o?(this._expandPanel(n,ma),this._expandPanel(s,Pi)):(this._collapsePanel(n),this._collapsePanel(s)),!0};resetLeftAndRightPanels=()=>{const t=this._app?.activeTab.get()??null;if(!t)return Qt.warn("No active tab found to toggle right panel"),!1;const n=this.getPanel(t,qi),s=this.getPanel(t,Ki);return!s||!n?(Qt.warn(`Right and/or left panel not found in tab "${t}"`),!1):!(n instanceof Fo)||!(s instanceof Fo)?(Qt.error("Left and right panels must be instances of GridviewPanel"),!1):(n.api.setConstraints({maximumWidth:Number.MAX_SAFE_INTEGER,minimumWidth:ma}),n.api.setSize({width:ma}),s.api.setConstraints({maximumWidth:Number.MAX_SAFE_INTEGER,minimumWidth:Pi}),s.api.setSize({width:Pi}),!0)};toggleViewerPanel=()=>{const t=this._app?.activeTab.get()??null;if(!t)return Qt.warn("No active tab found for viewer toggle"),Promise.resolve(!1);const n=this._prevActiveDockviewPanel.get(t),s=this._currentActiveDockviewPanel.get(t);let i;return s!==cs?i=cs:n&&n!==cs?i=n:i=ka,this.getRegisteredPanels(t).includes(i)?this.focusPanel(t,i):Promise.resolve(!1)};isPanelRegistered=(t,n)=>{const s=this._getPanelKey(t,n);return this.panels.has(s)};getRegisteredPanels=t=>{const n=this._getPanelPrefix(t);return Array.from(this.panels.keys()).filter(s=>s.startsWith(n)).map(s=>s.substring(n.length))};unregisterTab=t=>{const n=this._getPanelPrefix(t),s=Array.from(this.panels.keys()).filter(o=>o.startsWith(n));for(const o of s)this.panels.delete(o);const i=Array.from(this.waiters.keys()).filter(o=>o.startsWith(n));for(const o of i){const r=this.waiters.get(o);r&&(r.timeoutId&&clearTimeout(r.timeoutId),r.deferred.reject(new Error(`Panel registration cancelled - tab ${t} was unregistered`))),this.waiters.delete(o)}this._prevActiveDockviewPanel.delete(t),this._currentActiveDockviewPanel.delete(t),this._disposablesForTab.get(t)?.forEach(o=>{try{o()}catch(r){Qt.error({error:ts(r)},`Error disposing resource for tab ${t}`)}}),this._disposablesForTab.delete(t),Qt.trace(`Unregistered all panels for tab ${t}`)}}const Ne=new dAe;function eZ(e){const t=e.message.match(/Wrong assertion encountered: "(.*)"/);return t?t[1]??null:null}const QR=({count:e,start:t,min:n=WD,max:s=Vr})=>{const i=t??pye(n,s),o=[];for(let r=i;r<i+e;r++)o.push(r%s);return o},uAe=e=>{const{seedBehaviour:t,iterations:n,prompts:s}=e;return t==="PER_PROMPT"?yIe(n).flatMap(()=>s):s},v4=e=>{const{state:t,g:n,base:s,prepend:i,positivePromptNode:o,seedNode:r,origin:l,destination:c}=e,{iterations:d,shouldRandomizeSeed:u,seed:p}=t.params,{prompts:m,seedBehaviour:f}=t.dynamicPrompts,g=[],v=[],b=[];if(r&&f==="PER_PROMPT"){const x=QR({count:m.length*d,start:u?void 0:p});v.push({node_path:r.id,field_name:"value",items:x})}else if(r&&f==="PER_ITERATION"){const x=QR({count:d,start:u?void 0:p});b.push({node_path:r.id,field_name:"value",items:x}),g.push(b)}const C=uAe({seedBehaviour:f,iterations:d,prompts:m});return v.push({node_path:o.id,field_name:"value",items:C}),g.push(v),{prepend:i,batch:{graph:n.getGraph(),runs:1,data:g,origin:l,destination:c}}},mm=async({g:e,state:t,manager:n,l2i:s,i2l:i,noise:o,denoise:r,vaeSource:l})=>{const{denoising_start:c,denoising_end:d}=Hw(t);r.denoising_start=c,r.denoising_end=d;const{originalSize:u,scaledSize:p,rect:m}=Ww(t);r.type==="cogview4_denoise"||r.type==="flux_denoise"||r.type==="sd3_denoise"||r.type==="z_image_denoise"?(r.width=p.width,r.height=p.height):(ae(r.type==="denoise_latents"),ae(o,"SD1.5/SD2/SDXL graphs require a noise node to be passed in"),o.width=p.width,o.height=p.height);const f=n.compositor.getVisibleAdaptersOfType("raster_layer"),{image_name:g}=await n.compositor.getCompositeImageDTO(f,m,{is_intermediate:!0,silent:!0});if(yo(p,u))return i.image={image_name:g},e.addEdge(l,"vae",i,"vae"),e.addEdge(i,"latents",r,"latents"),s;{const v=e.addNode({type:"img_resize",id:ee("initial_image_resize_in"),image:{image_name:g},...p}),b=e.addNode({type:"img_resize",id:ee("initial_image_resize_out"),...u});return e.addEdge(l,"vae",i,"vae"),e.addEdge(v,"image",i,"image"),e.addEdge(i,"latents",r,"latents"),e.addEdge(s,"image",b,"image"),b}},gm=async({g:e,state:t,manager:n,l2i:s,i2l:i,noise:o,denoise:r,vaeSource:l,modelLoader:c,seed:d})=>{const{denoising_start:u,denoising_end:p}=Hw(t);r.denoising_start=u,r.denoising_end=p;const m=oo(t),f=Oi(t),{originalSize:g,scaledSize:v,rect:b}=Ww(t);r.type==="cogview4_denoise"||r.type==="flux_denoise"||r.type==="sd3_denoise"||r.type==="z_image_denoise"?(r.width=v.width,r.height=v.height):(ae(r.type==="denoise_latents"),ae(o,"SD1.5/SD2/SDXL graphs require a noise node to be passed in"),o.width=v.width,o.height=v.height);const C=n.compositor.getVisibleAdaptersOfType("raster_layer"),y=await n.compositor.getCompositeImageDTO(C,b,{is_intermediate:!0,silent:!0}),x=n.compositor.getVisibleAdaptersOfType("inpaint_mask"),w=x.filter(k=>k.state.noiseLevel!==void 0);let _=null;w.length>0&&(_=await n.compositor.getGrayscaleMaskCompositeImageDTO(w,b,"noiseLevel",f.preserveMask,{is_intermediate:!0,silent:!0}));const S=await n.compositor.getGrayscaleMaskCompositeImageDTO(x,b,"denoiseLimit",f.preserveMask,{is_intermediate:!0,silent:!0});if(!yo(v,g)){const k=e.addNode({type:"img_resize",id:ee("resize_image_to_scaled_size"),image:{image_name:y.image_name},...v});if(_){const N=e.addNode({id:ee("resize_noise_mask_to_scaled_size"),type:"img_resize",image:{image_name:_.image_name},...v}),F=e.addNode({type:"img_noise",id:ee("add_inpaint_noise"),noise_type:"gaussian",amount:1,noise_color:!0});e.addEdge(d,"value",F,"seed"),e.addEdge(k,"image",F,"image"),e.addEdge(N,"image",F,"mask"),e.addEdge(F,"image",i,"image")}else e.addEdge(k,"image",i,"image");const E=e.addNode({id:ee("resize_mask_to_scaled_size"),type:"img_resize",image:{image_name:S.image_name},...v}),j=e.addNode({id:ee("resize_image_to_original_size"),type:"img_resize",...g}),P=e.addNode({id:ee("resize_mask_to_original_size"),type:"img_resize",...g}),D=e.addNode({id:ee("create_gradient_mask"),type:"create_gradient_mask",coherence_mode:m.canvasCoherenceMode,minimum_denoise:m.canvasCoherenceMinDenoise,edge_radius:m.canvasCoherenceEdgeSize,fp32:i.type==="i2l"?i.fp32:!1}),O=e.addNode({type:"expand_mask_with_fade",id:ee("expand_mask_with_fade"),fade_size_px:m.maskBlur});if(e.addEdge(i,"latents",r,"latents"),e.addEdge(l,"vae",i,"vae"),e.addEdge(l,"vae",D,"vae"),V2(c)||e.addEdge(c,"unet",D,"unet"),e.addEdge(k,"image",D,"image"),e.addEdge(E,"image",D,"mask"),e.addEdge(D,"denoise_mask",r,"denoise_mask"),e.addEdge(s,"image",j,"image"),e.addEdge(D,"expanded_mask_area",O,"mask"),e.addEdge(O,"image",P,"image"),f.outputOnlyMaskedRegions){const N=e.addNode({type:"apply_mask_to_image",id:ee("apply_mask_to_image"),invert_mask:!0});return e.addEdge(P,"image",N,"mask"),e.addEdge(j,"image",N,"image"),N}else{const N=e.addNode({type:"invokeai_img_blend",id:ee("image_layer_blend"),layer_base:{image_name:y.image_name}});return e.addEdge(j,"image",N,"layer_upper"),e.addEdge(P,"image",N,"mask"),N}}else{if(_){const j=e.addNode({type:"img_noise",id:ee("add_inpaint_noise"),image:{image_name:y.image_name},noise_type:"gaussian",amount:1,noise_color:!0,mask:{image_name:_.image_name}});e.addEdge(d,"value",j,"seed"),e.addEdge(j,"image",i,"image")}else i.image={image_name:y.image_name};const k=e.addNode({id:ee("create_gradient_mask"),type:"create_gradient_mask",coherence_mode:m.canvasCoherenceMode,minimum_denoise:m.canvasCoherenceMinDenoise,edge_radius:m.canvasCoherenceEdgeSize,fp32:i.type==="i2l"?i.fp32:!1,image:{image_name:y.image_name},mask:{image_name:S.image_name}});e.addEdge(i,"latents",r,"latents"),e.addEdge(l,"vae",i,"vae"),e.addEdge(l,"vae",k,"vae"),V2(c)||e.addEdge(c,"unet",k,"unet"),e.addEdge(k,"denoise_mask",r,"denoise_mask");const E=e.addNode({type:"expand_mask_with_fade",id:ee("expand_mask_with_fade"),fade_size_px:m.maskBlur});if(e.addEdge(k,"expanded_mask_area",E,"mask"),f.outputOnlyMaskedRegions){const j=e.addNode({type:"apply_mask_to_image",id:ee("apply_mask_to_image"),invert_mask:!0});return e.addEdge(E,"image",j,"mask"),e.addEdge(s,"image",j,"image"),j}else{const j=e.addNode({type:"invokeai_img_blend",id:ee("image_layer_blend"),layer_base:{image_name:y.image_name}});return e.addEdge(s,"image",j,"layer_upper"),e.addEdge(E,"image",j,"mask"),j}}},vm=(e,t)=>{const n=e.addNode({type:"img_nsfw",id:ee("nsfw_checker")});return e.addEdge(t,"image",n,"image"),n},ym=async({g:e,state:t,manager:n,l2i:s,i2l:i,noise:o,denoise:r,vaeSource:l,modelLoader:c,seed:d})=>{const{denoising_start:u,denoising_end:p}=Hw(t);r.denoising_start=u,r.denoising_end=p;const m=oo(t),f=Oi(t),{originalSize:g,scaledSize:v,rect:b}=Ww(t);r.type==="cogview4_denoise"||r.type==="flux_denoise"||r.type==="sd3_denoise"||r.type==="z_image_denoise"?(r.width=v.width,r.height=v.height):(ae(r.type==="denoise_latents"),ae(o,"SD1.5/SD2/SDXL graphs require a noise node to be passed in"),o.width=v.width,o.height=v.height);const C=n.compositor.getVisibleAdaptersOfType("raster_layer"),y=await n.compositor.getCompositeImageDTO(C,b,{is_intermediate:!0,silent:!0}),x=n.compositor.getVisibleAdaptersOfType("inpaint_mask"),w=x.filter(E=>E.state.noiseLevel!==void 0);let _=null;w.length>0&&(_=await n.compositor.getGrayscaleMaskCompositeImageDTO(w,b,"noiseLevel",f.preserveMask,{is_intermediate:!0,silent:!0}));const S=await n.compositor.getGrayscaleMaskCompositeImageDTO(x,b,"denoiseLimit",f.preserveMask,{is_intermediate:!0,silent:!0}),I=fye(e,m);if(!yo(v,g)){const E=e.addNode({id:ee("image_alpha_to_mask"),type:"tomask",image:{image_name:y.image_name}}),j=e.addNode({id:ee("mask_combine"),type:"mask_combine",mask1:{image_name:S.image_name}});e.addEdge(E,"image",j,"mask2");const P=e.addNode({id:ee("resize_mask_to_scaled_size"),type:"img_resize",...v});e.addEdge(j,"image",P,"image");const D=e.addNode({id:ee("resize_image_to_scaled_size"),type:"img_resize",image:{image_name:y.image_name},...v});e.addEdge(D,"image",I,"image");const O=e.addNode({id:ee("create_gradient_mask"),type:"create_gradient_mask",coherence_mode:m.canvasCoherenceMode,minimum_denoise:m.canvasCoherenceMinDenoise,edge_radius:m.canvasCoherenceEdgeSize,fp32:i.type==="i2l"?i.fp32:!1});if(e.addEdge(I,"image",O,"image"),e.addEdge(P,"image",O,"mask"),e.addEdge(l,"vae",O,"vae"),V2(c)||e.addEdge(c,"unet",O,"unet"),e.addEdge(O,"denoise_mask",r,"denoise_mask"),_){const L=e.addNode({id:ee("resize_noise_mask_to_scaled_size"),type:"img_resize",image:{image_name:_.image_name},...v}),V=e.addNode({type:"img_noise",id:ee("add_inpaint_noise"),noise_type:"gaussian",amount:1,noise_color:!0});e.addEdge(d,"value",V,"seed"),e.addEdge(L,"image",V,"mask"),e.addEdge(I,"image",V,"image"),e.addEdge(V,"image",i,"image")}else e.addEdge(I,"image",i,"image");e.addEdge(l,"vae",i,"vae"),e.addEdge(i,"latents",r,"latents");const N=e.addNode({id:ee("resize_image_to_original_size"),type:"img_resize",...g}),F=e.addNode({id:ee("resize_mask_to_original_size"),type:"img_resize",...g}),X=e.addNode({type:"expand_mask_with_fade",id:ee("expand_mask_with_fade"),fade_size_px:m.maskBlur});if(e.addEdge(s,"image",N,"image"),e.addEdge(O,"expanded_mask_area",X,"mask"),e.addEdge(X,"image",F,"image"),f.outputOnlyMaskedRegions){const L=e.addNode({type:"apply_mask_to_image",id:ee("apply_mask_to_image"),invert_mask:!0});return e.addEdge(F,"image",L,"mask"),e.addEdge(N,"image",L,"image"),L}else{const L=e.addNode({type:"invokeai_img_blend",id:ee("image_layer_blend"),layer_base:{image_name:y.image_name}});return e.addEdge(N,"image",L,"layer_upper"),e.addEdge(F,"image",L,"mask"),L}}else{I.image={image_name:y.image_name};const E=e.addNode({id:ee("image_alpha_to_mask"),type:"tomask",image:{image_name:y.image_name}}),j=e.addNode({id:ee("mask_combine"),type:"mask_combine",mask1:{image_name:S.image_name}}),P=e.addNode({id:ee("create_gradient_mask"),type:"create_gradient_mask",coherence_mode:m.canvasCoherenceMode,minimum_denoise:m.canvasCoherenceMinDenoise,edge_radius:m.canvasCoherenceEdgeSize,fp32:i.type==="i2l"?i.fp32:!1,image:{image_name:y.image_name}});if(e.addEdge(E,"image",j,"mask2"),e.addEdge(j,"image",P,"mask"),_){const O=e.addNode({type:"img_noise",id:ee("add_inpaint_noise"),image:y.image_name?{image_name:y.image_name}:void 0,noise_type:"gaussian",amount:1,noise_color:!0,mask:{image_name:_.image_name}});e.addEdge(d,"value",O,"seed"),e.addEdge(I,"image",O,"image"),e.addEdge(O,"image",i,"image")}else e.addEdge(I,"image",i,"image");e.addEdge(i,"latents",r,"latents"),e.addEdge(l,"vae",i,"vae"),e.addEdge(l,"vae",P,"vae"),V2(c)||e.addEdge(c,"unet",P,"unet"),e.addEdge(P,"denoise_mask",r,"denoise_mask");const D=e.addNode({type:"expand_mask_with_fade",id:ee("expand_mask_with_fade"),fade_size_px:m.maskBlur});if(e.addEdge(P,"expanded_mask_area",D,"mask"),f.outputOnlyMaskedRegions){const O=e.addNode({type:"apply_mask_to_image",id:ee("apply_mask_to_image"),invert_mask:!0});return e.addEdge(D,"image",O,"mask"),e.addEdge(s,"image",O,"image"),O}else{const O=e.addNode({type:"invokeai_img_blend",id:ee("image_layer_blend"),layer_base:{image_name:y.image_name}});return e.addEdge(s,"image",O,"layer_upper"),e.addEdge(D,"image",O,"mask"),O}}},bm=({g:e,state:t,noise:n,denoise:s,l2i:i})=>{s.denoising_start=0,s.denoising_end=1;const{originalSize:o,scaledSize:r}=mye(t);if(s.type==="cogview4_denoise"||s.type==="flux_denoise"||s.type==="sd3_denoise"||s.type==="z_image_denoise"?(s.width=r.width,s.height=r.height):(ae(s.type==="denoise_latents"),ae(n,"SD1.5/SD2/SDXL graphs require a noise node to be passed in"),n.width=r.width,n.height=r.height),e.upsertMetadata({width:o.width,height:o.height}),yo(r,o))return i;{const l=e.addNode({id:ee("resize_image_to_original_size"),type:"img_resize",...o});return e.addEdge(i,"image",l,"image"),l}},xm=(e,t)=>{const n=e.addNode({type:"img_watermark",id:ee("watermarker")});return e.addEdge(t,"image",n,"image"),n},hAe=Ft("system").child({filePath:"features/nodes/util/graph/generation/buildCogView4Graph.ts"}),tZ=async e=>{const{generationMode:t,state:n,manager:s}=e;hAe.debug({generationMode:t,manager:s?.id},"Building CogView4 graph");const i=wo(n);ae(i,"No model selected"),ae(i.base==="cogview4","Selected model is not a CogView4 model");const o=oo(n),{cfgScale:r,steps:l}=o,c=Zd(n),d=new hn(ee("cogview4_graph")),u=d.addNode({type:"cogview4_model_loader",id:ee("cogview4_model_loader"),model:i}),p=d.addNode({id:ee("positive_prompt"),type:"string"}),m=d.addNode({type:"cogview4_text_encoder",id:ee("pos_prompt")}),f=d.addNode({type:"cogview4_text_encoder",id:ee("neg_prompt"),prompt:c.negative}),g=d.addNode({id:ee("seed"),type:"integer"}),v=d.addNode({type:"cogview4_denoise",id:ee("denoise_latents"),cfg_scale:r,steps:l}),b=d.addNode({type:"cogview4_l2i",id:ee("l2i")});d.addEdge(u,"transformer",v,"transformer"),d.addEdge(u,"glm_encoder",m,"glm_encoder"),d.addEdge(u,"glm_encoder",f,"glm_encoder"),d.addEdge(u,"vae",b,"vae"),d.addEdge(p,"value",m,"prompt"),d.addEdge(m,"conditioning",v,"positive_conditioning"),d.addEdge(f,"conditioning",v,"negative_conditioning"),d.addEdge(g,"value",v,"seed"),d.addEdge(v,"latents",b,"latents");const C=await Tv(i.key,If);ae(C.base==="cogview4"),d.upsertMetadata({cfg_scale:r,negative_prompt:c.negative,model:hn.getModelMetadataField(C),steps:l}),d.addEdgeToMetadata(g,"value","seed"),d.addEdgeToMetadata(p,"value","positive_prompt");let y=b;if(t==="txt2img")y=bm({g:d,state:n,denoise:v,l2i:b}),d.upsertMetadata({generation_mode:"cogview4_txt2img"});else if(t==="img2img"){ae(s!==null);const x=d.addNode({type:"cogview4_i2l",id:ee("cogview4_i2l")});y=await mm({g:d,state:n,manager:s,denoise:v,l2i:b,i2l:x,vaeSource:u}),d.upsertMetadata({generation_mode:"cogview4_img2img"})}else if(t==="inpaint"){ae(s!==null);const x=d.addNode({type:"cogview4_i2l",id:ee("cogview4_i2l")});y=await gm({g:d,state:n,manager:s,l2i:b,i2l:x,denoise:v,vaeSource:u,modelLoader:u,seed:g}),d.upsertMetadata({generation_mode:"cogview4_inpaint"})}else if(t==="outpaint"){ae(s!==null);const x=d.addNode({type:"cogview4_i2l",id:ee("cogview4_i2l")});y=await ym({g:d,state:n,manager:s,l2i:b,i2l:x,denoise:v,vaeSource:u,modelLoader:u,seed:g}),d.upsertMetadata({generation_mode:"cogview4_outpaint"})}else ae(!1);return n.system.shouldUseNSFWChecker&&(y=vm(d,y)),n.system.shouldUseWatermarker&&(y=xm(d,y)),d.updateNode(y,Yf(n)),un(n)==="canvas"&&d.upsertMetadata(Lh(n)),d.setMetadataReceivingNode(y),{g:d,seed:g,positivePrompt:p}},pAe=async({state:e,g:t,manager:n,l2i:s,denoise:i})=>{const{denoising_start:o,denoising_end:r}=Hw(e);i.denoising_start=o,i.denoising_end=r;const{originalSize:l,scaledSize:c,rect:d}=Ww(e);i.width=c.width,i.height=c.height;const u=oo(e),p=Oi(e),m=n.compositor.getVisibleAdaptersOfType("raster_layer"),f=await n.compositor.getCompositeImageDTO(m,d,{is_intermediate:!0,silent:!0}),g=n.compositor.getVisibleAdaptersOfType("inpaint_mask"),v=await n.compositor.getCompositeImageDTO(g,d,{is_intermediate:!0,silent:!0}),b=t.addNode({type:"flux_fill",id:ee("flux_fill")});if(!yo(c,l)){const y=t.addNode({id:ee("alpha_to_mask"),type:"tomask",image:{image_name:v.image_name},invert:!p.preserveMask}),x=t.addNode({id:ee("image_alpha_to_mask"),type:"tomask",image:{image_name:f.image_name}}),w=t.addNode({id:ee("mask_combine"),type:"mask_combine"});t.addEdge(y,"image",w,"mask1"),t.addEdge(x,"image",w,"mask2");const _=t.addNode({id:ee("resize_mask_to_scaled_size"),type:"img_resize",...c});t.addEdge(w,"image",_,"image");const S=t.addNode({type:"image_mask_to_tensor",id:ee("image_mask_to_tensor")});t.addEdge(_,"image",S,"image"),t.addEdge(S,"mask",b,"mask");const I=t.addNode({id:ee("resize_image_to_scaled_size"),type:"img_resize",image:{image_name:f.image_name},...c});t.addEdge(I,"image",b,"image"),t.addEdge(b,"fill_cond",i,"fill_conditioning");const k=t.addNode({id:ee("resize_image_to_original_size"),type:"img_resize",...l});t.addEdge(s,"image",k,"image");const E=t.addNode({type:"expand_mask_with_fade",id:ee("expand_mask_with_fade"),fade_size_px:u.maskBlur});if(t.addEdge(w,"image",E,"mask"),p.outputOnlyMaskedRegions){const j=t.addNode({type:"apply_mask_to_image",id:ee("apply_mask_to_image"),invert_mask:!0});return t.addEdge(E,"image",j,"mask"),t.addEdge(k,"image",j,"image"),j}else{const j=t.addNode({type:"invokeai_img_blend",id:ee("image_layer_blend"),layer_base:{image_name:f.image_name}});return t.addEdge(k,"image",j,"layer_upper"),t.addEdge(E,"image",j,"mask"),j}}else{const y=t.addNode({id:ee("alpha_to_mask"),type:"tomask",image:{image_name:v.image_name},invert:!p.preserveMask}),x=t.addNode({id:ee("image_alpha_to_mask"),type:"tomask",image:{image_name:f.image_name}}),w=t.addNode({id:ee("mask_combine"),type:"mask_combine"});t.addEdge(y,"image",w,"mask1"),t.addEdge(x,"image",w,"mask2");const _=t.addNode({type:"image_mask_to_tensor",id:ee("image_mask_to_tensor")});t.addEdge(w,"image",_,"image"),t.addEdge(_,"mask",b,"mask"),b.image={image_name:f.image_name},t.addEdge(b,"fill_cond",i,"fill_conditioning");const S=t.addNode({type:"expand_mask_with_fade",id:ee("expand_mask_with_fade"),fade_size_px:u.maskBlur});if(t.addEdge(w,"image",S,"mask"),p.outputOnlyMaskedRegions){const I=t.addNode({type:"apply_mask_to_image",id:ee("apply_mask_to_image"),invert_mask:!0});return t.addEdge(S,"image",I,"mask"),t.addEdge(s,"image",I,"image"),I}else{const I=t.addNode({type:"invokeai_img_blend",id:ee("image_layer_blend"),layer_base:{image_name:f.image_name}});return t.addEdge(s,"image",I,"layer_upper"),t.addEdge(S,"image",I,"mask"),I}}},fAe=(e,t,n,s,i)=>{const o=e.loras.loras.filter(u=>u.isEnabled&&u.model.base==="flux");if(o.length===0)return;const l=[],c=t.addNode({id:ee("lora_collector"),type:"collect"}),d=t.addNode({type:"flux_lora_collection_loader",id:ee("flux_lora_collection_loader")});t.addEdge(c,"collection",d,"loras"),t.addEdge(s,"transformer",d,"transformer"),t.addEdge(s,"clip",d,"clip"),t.addEdge(s,"t5_encoder",d,"t5_encoder"),t.deleteEdgesTo(n,["transformer"]),t.deleteEdgesTo(i,["clip","t5_encoder"]),t.addEdge(d,"transformer",n,"transformer"),t.addEdge(d,"clip",i,"clip"),t.addEdge(d,"t5_encoder",i,"t5_encoder");for(const u of o){const{weight:p}=u,m=_s.parse(u.model),f=t.addNode({type:"lora_selector",id:ee("lora_selector"),lora:m,weight:p});l.push({model:m,weight:p}),t.addEdge(f,"lora",c,"item")}t.upsertMetadata({loras:l})},mAe=({entities:e,g:t,collector:n,model:s})=>{const i=e.filter(r=>r.isEnabled).filter(r=>NA(r.config)).filter(r=>vu(r,s).length===0),o={addedFLUXReduxes:0};for(const{id:r,config:l}of i)ae(NA(l),"This should have been filtered out"),o.addedFLUXReduxes++,gAe(r,l,t,n);return t.upsertMetadata({ref_images:i},"merge"),o},nZ={lowest:{downsampling_factor:5,weight:1},low:{downsampling_factor:4,weight:1},medium:{downsampling_factor:3,weight:1},high:{downsampling_factor:2,weight:1},highest:{downsampling_factor:1,weight:1}},gAe=(e,t,n,s)=>{const{model:i,image:o}=t;ae(o,"FLUX Redux image is required"),ae(i,"FLUX Redux model is required");const r=n.addNode({id:`flux_redux_${e}`,type:"flux_redux",redux_model:i,image:{image_name:o.crop?.image.image_name??o.original.image.image_name},...nZ[t.imageInfluence??"highest"]});n.addEdge(r,"redux_cond",s,"item")},vAe=Ft("system").child({filePath:"features/nodes/util/graph/generation/addRegions.ts"}),z_=async({manager:e,regions:t,g:n,bbox:s,model:i,posCond:o,negCond:r,posCondCollect:l,negCondCollect:c,ipAdapterCollect:d,fluxReduxCollect:u})=>{const p=i.base==="sdxl",m=i.base==="flux",f=i.base==="z-image",g=t.filter(b=>b.isEnabled).filter(b=>r4(b,i).length===0),v=[];for(const b of g){const C={addedPositivePrompt:!1,addedNegativePrompt:!1,addedAutoNegativePositivePrompt:!1,addedIPAdapters:0,addedFLUXReduxes:0},y=await Kn(()=>{const _=e.adapters.regionMasks.get(b.id);return ae(_,"Adapter not found"),_.renderer.rasterize({rect:s,attrs:{opacity:1,filters:[]}})});if(y.isErr()){vAe.warn({error:cn(y.error)},"Error rasterizing region mask");continue}const x=y.value,w=n.addNode({type:"alpha_mask_to_tensor",id:ee("prompt_region_mask_to_tensor"),image:{image_name:x.image_name}});if(b.positivePrompt){C.addedPositivePrompt=!0;let _;if(p?_=n.addNode({type:"sdxl_compel_prompt",id:ee("prompt_region_positive_cond"),prompt:b.positivePrompt,style:b.positivePrompt}):m?_=n.addNode({type:"flux_text_encoder",id:ee("prompt_region_positive_cond"),prompt:b.positivePrompt}):f?_=n.addNode({type:"z_image_text_encoder",id:ee("prompt_region_positive_cond"),prompt:b.positivePrompt}):_=n.addNode({type:"compel",id:ee("prompt_region_positive_cond"),prompt:b.positivePrompt}),n.addEdge(w,"mask",_,"mask"),n.addEdge(_,"conditioning",l,"item"),o.type==="compel")for(const S of n.getEdgesTo(o,["clip","mask"])){const I=It(S);I.destination.node_id=_.id,n.addEdgeFromObj(I)}else if(o.type==="sdxl_compel_prompt")for(const S of n.getEdgesTo(o,["clip","clip2","mask"])){const I=It(S);I.destination.node_id=_.id,n.addEdgeFromObj(I)}else if(o.type==="flux_text_encoder")for(const S of n.getEdgesTo(o,["clip","t5_encoder","t5_max_seq_len","mask"])){const I=It(S);I.destination.node_id=_.id,n.addEdgeFromObj(I)}else if(o.type==="z_image_text_encoder")for(const S of n.getEdgesTo(o,["qwen3_encoder","mask"])){const I=It(S);I.destination.node_id=_.id,n.addEdgeFromObj(I)}else ae(!1,"Unsupported positive conditioning node type.")}if(b.negativePrompt){ae(r,"Negative conditioning node is required if there is a negative prompt"),ae(c,"Negative conditioning collector is required if there is a negative prompt"),C.addedNegativePrompt=!0;let _;if(p?_=n.addNode({type:"sdxl_compel_prompt",id:ee("prompt_region_negative_cond"),prompt:b.negativePrompt,style:b.negativePrompt}):m?_=n.addNode({type:"flux_text_encoder",id:ee("prompt_region_negative_cond"),prompt:b.negativePrompt}):f?_=n.addNode({type:"z_image_text_encoder",id:ee("prompt_region_negative_cond"),prompt:b.negativePrompt}):_=n.addNode({type:"compel",id:ee("prompt_region_negative_cond"),prompt:b.negativePrompt}),n.addEdge(w,"mask",_,"mask"),n.addEdge(_,"conditioning",c,"item"),r.type==="compel")for(const S of n.getEdgesTo(r,["clip","mask"])){const I=It(S);I.destination.node_id=_.id,n.addEdgeFromObj(I)}else if(r.type==="sdxl_compel_prompt")for(const S of n.getEdgesTo(r,["clip","clip2","mask"])){const I=It(S);I.destination.node_id=_.id,n.addEdgeFromObj(I)}else if(r.type==="flux_text_encoder")for(const S of n.getEdgesTo(r,["clip","t5_encoder","t5_max_seq_len","mask"])){const I=It(S);I.destination.node_id=_.id,n.addEdgeFromObj(I)}else if(r.type==="z_image_text_encoder")for(const S of n.getEdgesTo(r,["qwen3_encoder","mask"])){const I=It(S);I.destination.node_id=_.id,n.addEdgeFromObj(I)}else ae(!1,"Unsupported negative conditioning node type.")}if(b.autoNegative&&b.positivePrompt){ae(c,"Negative conditioning collector is required if there is an auto-negative setting"),C.addedAutoNegativePositivePrompt=!0;const _=n.addNode({id:ee("prompt_region_invert_tensor_mask"),type:"invert_tensor_mask"});n.addEdge(w,"mask",_,"mask");let S;if(p?S=n.addNode({type:"sdxl_compel_prompt",id:ee("prompt_region_positive_cond_inverted"),prompt:b.positivePrompt,style:b.positivePrompt}):m?S=n.addNode({type:"flux_text_encoder",id:ee("prompt_region_positive_cond_inverted"),prompt:b.positivePrompt}):f?S=n.addNode({type:"z_image_text_encoder",id:ee("prompt_region_positive_cond_inverted"),prompt:b.positivePrompt}):S=n.addNode({type:"compel",id:ee("prompt_region_positive_cond_inverted"),prompt:b.positivePrompt}),n.addEdge(_,"mask",S,"mask"),n.addEdge(S,"conditioning",c,"item"),o.type==="compel")for(const I of n.getEdgesTo(o,["clip","mask"])){const k=It(I);k.destination.node_id=S.id,n.addEdgeFromObj(k)}else if(o.type==="sdxl_compel_prompt")for(const I of n.getEdgesTo(o,["clip","clip2","mask"])){const k=It(I);k.destination.node_id=S.id,n.addEdgeFromObj(k)}else if(o.type==="flux_text_encoder")for(const I of n.getEdgesTo(o,["clip","t5_encoder","t5_max_seq_len","mask"])){const k=It(I);k.destination.node_id=S.id,n.addEdgeFromObj(k)}else if(o.type==="z_image_text_encoder")for(const I of n.getEdgesTo(o,["qwen3_encoder","mask"])){const k=It(I);k.destination.node_id=S.id,n.addEdgeFromObj(k)}else ae(!1,"Unsupported positive conditioning node type.")}for(const{id:_,config:S}of b.referenceImages)if(gye(S)){ae(!m,"Regional IP adapters are not supported for FLUX."),C.addedIPAdapters++;const{weight:I,model:k,clipVisionModel:E,method:j,beginEndStepPct:P,image:D}=S;ae(k,"IP Adapter model is required"),ae(D,"IP Adapter image is required");const O=n.addNode({id:`ip_adapter_${_}`,type:"ip_adapter",weight:I,method:j,ip_adapter_model:k,clip_vision_model:E,begin_step_percent:P[0],end_step_percent:P[1],image:{image_name:D.image_name}});n.addEdge(w,"mask",O,"mask"),n.addEdge(O,"ip_adapter",d,"item")}else if(vye(S)){ae(m,"Regional FLUX Redux requires FLUX."),ae(u!==null,"FLUX Redux collector is required."),C.addedFLUXReduxes++;const{model:I,image:k}=S;ae(I,"FLUX Redux model is required"),ae(k,"FLUX Redux image is required");const E=n.addNode({id:`flux_redux_${_}`,type:"flux_redux",redux_model:I,image:{image_name:k.image_name},...nZ[S.imageInfluence??"highest"]});n.addEdge(w,"mask",E,"mask"),n.addEdge(E,"redux_cond",u,"item")}v.push(C)}return n.upsertMetadata({regions:g}),v};class tC extends Error{constructor(t){super(t),this.name=this.constructor.name}}const V_=Ft("system").child({filePath:"features/nodes/util/graph/generation/addControlAdapters.ts"}),y4=async({manager:e,entities:t,g:n,rect:s,collector:i,model:o})=>{const r=t.filter(c=>c.isEnabled).filter(c=>c.controlAdapter.type==="controlnet").filter(c=>e1(c,o).length===0),l={addedControlNets:0};for(const c of r){const d=await Kn(()=>{const p=e.adapters.controlLayers.get(c.id);return ae(p,"Adapter not found"),p.renderer.rasterize({rect:s,attrs:{opacity:1,filters:[]},bg:"black"})});if(d.isErr()){V_.warn({error:cn(d.error)},"Error rasterizing control layer");continue}const u=d.value;bAe(n,c,u,i),l.addedControlNets++}return l},sZ=async({manager:e,entities:t,g:n,rect:s,collector:i,model:o})=>{const r=t.filter(c=>c.isEnabled).filter(c=>c.controlAdapter.type==="t2i_adapter").filter(c=>e1(c,o).length===0),l={addedT2IAdapters:0};for(const c of r){const d=await Kn(()=>{const p=e.adapters.controlLayers.get(c.id);return ae(p,"Adapter not found"),p.renderer.rasterize({rect:s,attrs:{opacity:1,filters:[]},bg:"black"})});if(d.isErr()){V_.warn({error:cn(d.error)},"Error rasterizing control layer");continue}const u=d.value;xAe(n,c,u,i),l.addedT2IAdapters++}return l},yAe=async({manager:e,entities:t,g:n,rect:s,model:i,denoise:o})=>{const r=t.filter(u=>u.isEnabled).filter(u=>u.controlAdapter.type==="control_lora").filter(u=>e1(u,i).length===0),l=r[0];if(l===void 0)return;ae(i.variant!=="dev_fill","FLUX Control LoRA is not compatible with FLUX Fill."),ae(r.length<=1,"Cannot add more than one FLUX control LoRA.");const c=await Kn(()=>{const u=e.adapters.controlLayers.get(l.id);return ae(u,"Adapter not found"),u.renderer.rasterize({rect:s,attrs:{opacity:1,filters:[]},bg:"black"})});if(c.isErr()){V_.warn({error:cn(c.error)},"Error rasterizing control layer");return}const d=c.value;CAe(n,l,d,o)},bAe=(e,t,n,s)=>{const{id:i,controlAdapter:o}=t;ae(o.type==="controlnet");const{beginEndStepPct:r,model:l,weight:c,controlMode:d}=o;ae(l!==null);const{image_name:u}=n,p=e.addNode({id:`control_net_${i}`,type:l.base==="flux"?"flux_controlnet":"controlnet",begin_step_percent:r[0],end_step_percent:r[1],control_mode:l.base==="flux"?void 0:d,resize_mode:"just_resize",control_model:l,control_weight:c,image:{image_name:u}});e.addEdge(p,"control",s,"item")},xAe=(e,t,n,s)=>{const{id:i,controlAdapter:o}=t;ae(o.type==="t2i_adapter");const{beginEndStepPct:r,model:l,weight:c}=o;ae(l!==null);const{image_name:d}=n,u=e.addNode({id:`t2i_adapter_${i}`,type:"t2i_adapter",begin_step_percent:r[0],end_step_percent:r[1],resize_mode:"just_resize",t2i_adapter_model:l,weight:c,image:{image_name:d}});e.addEdge(u,"t2i_adapter",s,"item")},CAe=(e,t,n,s)=>{const{id:i,controlAdapter:o}=t;ae(o.type==="control_lora");const{model:r,weight:l}=o;ae(r!==null);const{image_name:c}=n,d=e.addNode({id:`control_lora_${i}`,type:"flux_control_lora_loader",lora:r,image:{image_name:c},weight:l});e.addEdge(d,"control_lora",s,"control_lora")},wAe=async({manager:e,entities:t,g:n,rect:s,denoise:i})=>{const o=t.filter(d=>d.isEnabled).filter(d=>d.controlAdapter.type==="z_image_control").filter(d=>d.controlAdapter.model!==null),r=o[0];if(r===void 0)return;ae(o.length<=1,"Cannot add more than one Z-Image control.");const l=await Kn(()=>{const d=e.adapters.controlLayers.get(r.id);return ae(d,"Adapter not found"),d.renderer.rasterize({rect:s,attrs:{opacity:1,filters:[]},bg:"black"})});if(l.isErr()){V_.warn({error:cn(l.error)},"Error rasterizing Z-Image control layer");return}const c=l.value;_Ae(n,r,c,i)},_Ae=(e,t,n,s)=>{const{id:i,controlAdapter:o}=t;ae(o.type==="z_image_control");const{model:r,weight:l,beginEndStepPct:c}=o;ae(r!==null);const{image_name:d}=n,u=e.addNode({id:`z_image_control_${i}`,type:"z_image_control",control_model:r,control_context_scale:l,begin_step_percent:c[0],end_step_percent:c[1],image:{image_name:d}});e.addEdge(u,"control",s,"control")},b4=({entities:e,g:t,collector:n,model:s})=>{const i=e.filter(r=>r.isEnabled).filter(r=>rh(r.config)).filter(r=>vu(r,s).length===0),o={addedIPAdapters:0};for(const{id:r,config:l}of i)ae(rh(l),"This should have been filtered out"),o.addedIPAdapters++,SAe(r,l,t,n);return t.upsertMetadata({ref_images:i},"merge"),o},SAe=(e,t,n,s)=>{const{weight:i,model:o,clipVisionModel:r,method:l,beginEndStepPct:c,image:d}=t;ae(d,"IP Adapter image is required"),ae(o,"IP Adapter model is required");let u;o.base==="flux"?(ae(r==="ViT-L",`ViT-L is the only supported CLIP Vision model for FLUX IP adapter, got ${r}`),u=n.addNode({id:`ip_adapter_${e}`,type:"flux_ip_adapter",weight:i,ip_adapter_model:o,clip_vision_model:r,begin_step_percent:c[0],end_step_percent:c[1],image:{image_name:d.crop?.image.image_name??d.original.image.image_name}})):(ae(r==="ViT-H"||r==="ViT-G","ViT-G and ViT-H are the only supported CLIP Vision models for SD1.5 and SDXL IP adapters"),u=n.addNode({id:`ip_adapter_${e}`,type:"ip_adapter",weight:i,method:l,ip_adapter_model:o,clip_vision_model:r,begin_step_percent:c[0],end_step_percent:c[1],image:{image_name:d.crop?.image.image_name??d.original.image.image_name}})),n.addEdge(u,"ip_adapter",s,"item")},kAe=Ft("system").child({filePath:"features/nodes/util/graph/generation/buildFLUXGraph.ts"}),iZ=async e=>{const{generationMode:t,state:n,manager:s}=e;kAe.debug({generationMode:t,manager:s?.id},"Building FLUX graph");const i=wo(n);ae(i,"No model selected"),ae(i.base==="flux","Selected model is not a FLUX model");const o=oo(n),r=rt(n),l=Vc(n),{guidance:c,steps:d,fluxVAE:u,t5EncoderModel:p,clipEmbedModel:m}=o;ae(p,"No T5 Encoder model found in state"),ae(m,"No CLIP Embed model found in state"),ae(u,"No FLUX VAE model found in state");const f=i.variant==="dev_fill";let g=c;if(f){if(t==="txt2img"||t==="img2img")throw new tC(ye("toast.fluxFillIncompatibleWithT2IAndI2I"));g=30}const v=i.name?.toLowerCase().includes("kontext");if(v&&t!=="txt2img")throw new tC(ye("toast.fluxKontextIncompatibleGenerationMode"));const b=new hn(ee("flux_graph")),C=b.addNode({type:"flux_model_loader",id:ee("flux_model_loader"),model:i,t5_encoder_model:p,clip_embed_model:m,vae_model:u}),y=b.addNode({id:ee("positive_prompt"),type:"string"}),x=b.addNode({type:"flux_text_encoder",id:ee("flux_text_encoder")}),w=b.addNode({type:"collect",id:ee("pos_cond_collect")}),_=b.addNode({id:ee("seed"),type:"integer"}),S=b.addNode({type:"flux_denoise",id:ee("flux_denoise"),guidance:g,num_steps:d}),I=b.addNode({type:"flux_vae_decode",id:ee("flux_vae_decode")});if(b.addEdge(C,"transformer",S,"transformer"),b.addEdge(C,"vae",S,"controlnet_vae"),b.addEdge(C,"vae",I,"vae"),b.addEdge(C,"clip",x,"clip"),b.addEdge(C,"t5_encoder",x,"t5_encoder"),b.addEdge(C,"max_seq_len",x,"t5_max_seq_len"),b.addEdge(y,"value",x,"prompt"),b.addEdge(x,"conditioning",w,"item"),b.addEdge(w,"collection",S,"positive_text_conditioning"),b.addEdge(_,"value",S,"seed"),b.addEdge(S,"latents",I,"latents"),fAe(n,b,S,C,x),b.upsertMetadata({guidance:g,model:hn.getModelMetadataField(i),steps:d,vae:u,t5_encoder:p,clip_embed_model:m}),b.addEdgeToMetadata(_,"value","seed"),b.addEdgeToMetadata(y,"value","positive_prompt"),v){const F=Vc(n).entities.filter(X=>X.isEnabled).filter(X=>yye(X.config)).filter(X=>vu(X,i).length===0);if(F.length>0){const X=b.addNode({type:"collect",id:ee("flux_kontext_collect")});for(const{config:L}of F){const V=b.addNode({id:ee("flux_kontext_image_prep"),type:"flux_kontext_image_prep",images:[bye.parse(L.image?.crop?.image??L.image?.original.image)]}),K=b.addNode({type:"flux_kontext",id:ee("flux_kontext")});b.addEdge(V,"image",K,"image"),b.addEdge(K,"kontext_cond",X,"item")}b.addEdge(X,"collection",S,"kontext_conditioning"),b.upsertMetadata({ref_images:[F]},"merge")}}let k=I;if(f&&(t==="inpaint"||t==="outpaint"))ae(s!==null),k=await pAe({g:b,state:n,manager:s,l2i:I,denoise:S});else if(t==="txt2img")k=bm({g:b,state:n,denoise:S,l2i:I}),b.upsertMetadata({generation_mode:"flux_txt2img"});else if(t==="img2img"){ae(s!==null);const F=b.addNode({type:"flux_vae_encode",id:ee("flux_vae_encode")});k=await mm({g:b,state:n,manager:s,l2i:I,i2l:F,denoise:S,vaeSource:C}),b.upsertMetadata({generation_mode:"flux_img2img"})}else if(t==="inpaint"){ae(s!==null);const F=b.addNode({type:"flux_vae_encode",id:ee("flux_vae_encode")});k=await gm({g:b,state:n,manager:s,l2i:I,i2l:F,denoise:S,vaeSource:C,modelLoader:C,seed:_}),b.upsertMetadata({generation_mode:"flux_inpaint"})}else if(t==="outpaint"){ae(s!==null);const F=b.addNode({type:"flux_vae_encode",id:ee("flux_vae_encode")});k=await ym({g:b,state:n,manager:s,l2i:I,i2l:F,denoise:S,vaeSource:C,modelLoader:C,seed:_}),b.upsertMetadata({generation_mode:"flux_outpaint"})}else ae(!1);if(s!==null){const F=b.addNode({type:"collect",id:ee("control_net_collector")});(await y4({manager:s,entities:r.controlLayers.entities,g:b,rect:r.bbox.rect,collector:F,model:i})).addedControlNets>0?b.addEdge(F,"collection",S,"control"):b.deleteNode(F.id),await yAe({manager:s,entities:r.controlLayers.entities,g:b,rect:r.bbox.rect,denoise:S,model:i})}const E=b.addNode({type:"collect",id:ee("ip_adapter_collector")});let P=b4({entities:l.entities,g:b,collector:E,model:i}).addedIPAdapters;const D=b.addNode({type:"collect",id:ee("ip_adapter_collector")});let N=mAe({entities:l.entities,g:b,collector:D,model:i}).addedFLUXReduxes;if(s!==null){const F=await z_({manager:s,regions:r.regionalGuidance.entities,g:b,bbox:r.bbox.rect,model:i,posCond:x,negCond:null,posCondCollect:w,negCondCollect:null,ipAdapterCollect:E,fluxReduxCollect:D});P+=F.reduce((X,L)=>X+L.addedIPAdapters,0),N+=F.reduce((X,L)=>X+L.addedFLUXReduxes,0)}return P>0?b.addEdge(E,"collection",S,"ip_adapter"):b.deleteNode(E.id),N>0?b.addEdge(D,"collection",S,"redux_conditioning"):b.deleteNode(D.id),n.system.shouldUseNSFWChecker&&(k=vm(b,k)),n.system.shouldUseWatermarker&&(k=xm(b,k)),b.updateNode(k,Yf(n)),un(n)==="canvas"&&b.upsertMetadata(Lh(n)),b.setMetadataReceivingNode(k),{g:b,seed:_,positivePrompt:y}},oZ=(e,t,n,s,i,o,r,l)=>{const c=e.loras.loras.filter(f=>f.isEnabled&&(f.model.base==="sd-1"||f.model.base==="sd-2"));if(c.length===0)return;const u=[],p=t.addNode({type:"collect",id:ee("lora_collector")}),m=t.addNode({type:"lora_collection_loader",id:ee("lora_collection_loader")});t.addEdge(p,"collection",m,"loras"),t.addEdge(i??s,"unet",m,"unet"),t.addEdge(o,"clip",m,"clip"),t.deleteEdgesTo(n,["unet"]),t.deleteEdgesTo(r,["clip"]),t.deleteEdgesTo(l,["clip"]),t.addEdge(m,"unet",n,"unet"),t.addEdge(m,"clip",r,"clip"),t.addEdge(m,"clip",l,"clip");for(const f of c){const{weight:g}=f,v=_s.parse(f.model),b=t.addNode({type:"lora_selector",id:ee("lora_selector"),lora:v,weight:g});u.push({model:v,weight:g}),t.addEdge(b,"lora",p,"item")}t.upsertMetadata({loras:u})},aZ=(e,t,n,s,i)=>{const{seamlessXAxis:o,seamlessYAxis:r}=e.params;if(t.upsertMetadata({seamless_x:o,seamless_y:r}),!o&&!r)return null;const l=t.addNode({type:"seamless",id:ee("seamless"),seamless_x:o,seamless_y:r});return t.deleteEdgesFrom(s,["unet"]),t.deleteEdgesFrom(s,["vae"]),t.addEdge(s,"unet",l,"unet"),t.addEdge(i??s,"vae",l,"vae"),t.addEdge(l,"unet",n,"unet"),l},IAe=Ft("system").child({filePath:"features/nodes/util/graph/generation/buildSD1Graph.ts"}),rZ=async e=>{const{generationMode:t,state:n,manager:s}=e;IAe.debug({generationMode:t,manager:s?.id},"Building SD1/SD2 graph");const i=wo(n);ae(i,"No model selected"),ae(i.base==="sd-1"||i.base==="sd-2","Selected model is not a SDXL model");const o=oo(n),r=rt(n),l=Vc(n),{cfgScale:c,cfgRescaleMultiplier:d,scheduler:u,steps:p,clipSkip:m,shouldUseCpuNoise:f,vaePrecision:g,vae:v}=o,b=g==="fp32",C=Zd(n),y=new hn(ee("sd1_graph")),x=y.addNode({id:ee("seed"),type:"integer"}),w=y.addNode({id:ee("positive_prompt"),type:"string"}),_=y.addNode({type:"main_model_loader",id:ee("sd1_model_loader"),model:i}),S=y.addNode({type:"clip_skip",id:ee("clip_skip"),skipped_layers:m}),I=y.addNode({type:"compel",id:ee("pos_cond")}),k=y.addNode({type:"collect",id:ee("pos_cond_collect")}),E=y.addNode({type:"compel",id:ee("neg_cond"),prompt:C.negative}),j=y.addNode({type:"collect",id:ee("neg_cond_collect")}),P=y.addNode({type:"noise",id:ee("noise"),use_cpu:f}),D=y.addNode({type:"denoise_latents",id:ee("denoise_latents"),cfg_scale:c,cfg_rescale_multiplier:d,scheduler:u,steps:p,denoising_start:0,denoising_end:1}),O=y.addNode({type:"l2i",id:ee("l2i"),fp32:b}),N=v?.base===i.base?y.addNode({type:"vae_loader",id:ee("vae"),vae_model:v}):null;y.addEdge(_,"unet",D,"unet"),y.addEdge(_,"clip",S,"clip"),y.addEdge(S,"clip",I,"clip"),y.addEdge(S,"clip",E,"clip"),y.addEdge(w,"value",I,"prompt"),y.addEdge(I,"conditioning",k,"item"),y.addEdge(k,"collection",D,"positive_conditioning"),y.addEdge(E,"conditioning",j,"item"),y.addEdge(j,"collection",D,"negative_conditioning"),y.addEdge(x,"value",P,"seed"),y.addEdge(P,"noise",D,"noise"),y.addEdge(D,"latents",O,"latents"),y.upsertMetadata({cfg_scale:c,cfg_rescale_multiplier:d,negative_prompt:C.negative,model:hn.getModelMetadataField(i),steps:p,rand_device:f?"cpu":"cuda",scheduler:u,clip_skip:m,vae:v??void 0}),y.addEdgeToMetadata(x,"value","seed"),y.addEdgeToMetadata(w,"value","positive_prompt");const F=aZ(n,y,D,_,N);oZ(n,y,D,_,F,S,I,E);const X=F??N??_;y.addEdge(X,"vae",O,"vae");let L=O;if(t==="txt2img")L=bm({g:y,state:n,noise:P,denoise:D,l2i:O}),y.upsertMetadata({generation_mode:"txt2img"});else if(t==="img2img"){ae(s!==null);const Z=y.addNode({type:"i2l",id:ee("i2l"),fp32:b});L=await mm({g:y,state:n,manager:s,l2i:O,i2l:Z,noise:P,denoise:D,vaeSource:X}),y.upsertMetadata({generation_mode:"img2img"})}else if(t==="inpaint"){ae(s!==null);const Z=y.addNode({type:"i2l",id:ee("i2l"),fp32:b});L=await gm({g:y,state:n,manager:s,l2i:O,i2l:Z,noise:P,denoise:D,vaeSource:X,modelLoader:_,seed:x}),y.upsertMetadata({generation_mode:"inpaint"})}else if(t==="outpaint"){ae(s!==null);const Z=y.addNode({type:"i2l",id:ee("i2l"),fp32:b});L=await ym({g:y,state:n,manager:s,l2i:O,i2l:Z,noise:P,denoise:D,vaeSource:X,modelLoader:_,seed:x}),y.upsertMetadata({generation_mode:"outpaint"})}else ae(!1);if(s!==null){const Z=y.addNode({type:"collect",id:ee("control_net_collector")});(await y4({manager:s,entities:r.controlLayers.entities,g:y,rect:r.bbox.rect,collector:Z,model:i})).addedControlNets>0?y.addEdge(Z,"collection",D,"control"):y.deleteNode(Z.id);const R=y.addNode({type:"collect",id:ee("t2i_adapter_collector")});(await sZ({manager:s,entities:r.controlLayers.entities,g:y,rect:r.bbox.rect,collector:R,model:i})).addedT2IAdapters>0?y.addEdge(R,"collection",D,"t2i_adapter"):y.deleteNode(R.id)}const V=y.addNode({type:"collect",id:ee("ip_adapter_collector")});let U=b4({entities:l.entities,g:y,collector:V,model:i}).addedIPAdapters;if(s!==null){const Z=await z_({manager:s,regions:r.regionalGuidance.entities,g:y,bbox:r.bbox.rect,model:i,posCond:I,negCond:E,posCondCollect:k,negCondCollect:j,ipAdapterCollect:V,fluxReduxCollect:null});U+=Z.reduce((W,R)=>W+R.addedIPAdapters,0)}return U>0?y.addEdge(V,"collection",D,"ip_adapter"):y.deleteNode(V.id),n.system.shouldUseNSFWChecker&&(L=vm(y,L)),n.system.shouldUseWatermarker&&(L=xm(y,L)),y.updateNode(L,Yf(n)),un(n)==="canvas"&&y.upsertMetadata(Lh(n)),y.setMetadataReceivingNode(L),{g:y,seed:x,positivePrompt:w}},jAe=Ft("system").child({filePath:"features/nodes/util/graph/generation/buildSD3Graph.ts"}),lZ=async e=>{const{generationMode:t,state:n,manager:s}=e;jAe.debug({generationMode:t,manager:s?.id},"Building SD3 graph");const i=wo(n);ae(i,"No model found in state"),ae(i.base==="sd-3");const o=oo(n),{cfgScale:r,steps:l,vae:c,t5EncoderModel:d,clipLEmbedModel:u,clipGEmbedModel:p}=o,m=Zd(n),f=new hn(ee("sd3_graph")),g=f.addNode({type:"sd3_model_loader",id:ee("sd3_model_loader"),model:i,t5_encoder_model:d,clip_l_model:u,clip_g_model:p,vae_model:c}),v=f.addNode({id:ee("positive_prompt"),type:"string"}),b=f.addNode({type:"sd3_text_encoder",id:ee("pos_cond")}),C=f.addNode({type:"sd3_text_encoder",id:ee("neg_cond"),prompt:m.negative}),y=f.addNode({id:ee("seed"),type:"integer"}),x=f.addNode({type:"sd3_denoise",id:ee("sd3_denoise"),cfg_scale:r,steps:l,denoising_start:0,denoising_end:1}),w=f.addNode({type:"sd3_l2i",id:ee("l2i")});f.addEdge(g,"transformer",x,"transformer"),f.addEdge(g,"clip_l",b,"clip_l"),f.addEdge(g,"clip_l",C,"clip_l"),f.addEdge(g,"clip_g",b,"clip_g"),f.addEdge(g,"clip_g",C,"clip_g"),f.addEdge(g,"t5_encoder",b,"t5_encoder"),f.addEdge(g,"t5_encoder",C,"t5_encoder"),f.addEdge(g,"vae",w,"vae"),f.addEdge(v,"value",b,"prompt"),f.addEdge(b,"conditioning",x,"positive_conditioning"),f.addEdge(C,"conditioning",x,"negative_conditioning"),f.addEdge(y,"value",x,"seed"),f.addEdge(x,"latents",w,"latents"),f.upsertMetadata({cfg_scale:r,negative_prompt:m.negative,model:hn.getModelMetadataField(i),steps:l,vae:c??void 0}),f.addEdgeToMetadata(y,"value","seed"),f.addEdgeToMetadata(v,"value","positive_prompt");let _=w;if(t==="txt2img")_=bm({g:f,state:n,denoise:x,l2i:w}),f.upsertMetadata({generation_mode:"sd3_txt2img"});else if(t==="img2img"){ae(s!==null);const S=f.addNode({type:"sd3_i2l",id:ee("sd3_i2l")});_=await mm({g:f,state:n,manager:s,l2i:w,i2l:S,denoise:x,vaeSource:g}),f.upsertMetadata({generation_mode:"sd3_img2img"})}else if(t==="inpaint"){ae(s!==null);const S=f.addNode({type:"sd3_i2l",id:ee("sd3_i2l")});_=await gm({g:f,state:n,manager:s,l2i:w,i2l:S,denoise:x,vaeSource:g,modelLoader:g,seed:y}),f.upsertMetadata({generation_mode:"sd3_inpaint"})}else if(t==="outpaint"){ae(s!==null);const S=f.addNode({type:"sd3_i2l",id:ee("sd3_i2l")});_=await ym({g:f,state:n,manager:s,l2i:w,i2l:S,denoise:x,vaeSource:g,modelLoader:g,seed:y}),f.upsertMetadata({generation_mode:"sd3_outpaint"})}else ae(!1);return n.system.shouldUseNSFWChecker&&(_=vm(f,_)),n.system.shouldUseWatermarker&&(_=xm(f,_)),f.updateNode(_,Yf(n)),un(n)==="canvas"&&f.upsertMetadata(Lh(n)),f.setMetadataReceivingNode(_),{g:f,seed:y,positivePrompt:v}},cZ=(e,t,n,s,i,o,r)=>{const l=e.loras.loras.filter(m=>m.isEnabled&&m.model.base==="sdxl");if(l.length===0)return;const d=[],u=t.addNode({id:ee("lora_collector"),type:"collect"}),p=t.addNode({type:"sdxl_lora_collection_loader",id:ee("sdxl_lora_collection_loader")});t.addEdge(u,"collection",p,"loras"),t.addEdge(i??s,"unet",p,"unet"),t.addEdge(s,"clip",p,"clip"),t.addEdge(s,"clip2",p,"clip2"),t.deleteEdgesTo(n,["unet"]),t.deleteEdgesTo(o,["clip","clip2"]),t.deleteEdgesTo(r,["clip","clip2"]),t.addEdge(p,"unet",n,"unet"),t.addEdge(p,"clip",o,"clip"),t.addEdge(p,"clip",r,"clip"),t.addEdge(p,"clip2",o,"clip2"),t.addEdge(p,"clip2",r,"clip2");for(const m of l){const{weight:f}=m,g=_s.parse(m.model),v=t.addNode({type:"lora_selector",id:ee("lora_selector"),lora:g,weight:f});d.push({model:g,weight:f}),t.addEdge(v,"lora",u,"item")}t.upsertMetadata({loras:d})},EAe=async(e,t,n,s,i,o,r)=>{const{refinerModel:l,refinerPositiveAestheticScore:c,refinerNegativeAestheticScore:d,refinerSteps:u,refinerScheduler:p,refinerCFGScale:m,refinerStart:f}=e.params;ae(l,"No refiner model found in state");const g=await Tv(l.key,xye);t.deleteEdgesFrom(n,["latents"]),t.deleteEdgesTo(r,["latents"]);const v=t.addNode({type:"sdxl_refiner_model_loader",id:ee("refiner_model_loader"),model:l}),b=t.addNode({type:"sdxl_refiner_compel_prompt",id:ee("refiner_pos_cond"),style:i.style,aesthetic_score:c}),C=t.addNode({type:"sdxl_refiner_compel_prompt",id:ee("refiner_neg_cond"),style:o.style,aesthetic_score:d}),y=t.addNode({type:"denoise_latents",id:ee("refiner_denoise_latents"),cfg_scale:m,steps:u,scheduler:p,denoising_start:f,denoising_end:1});if(s){const x=t.addNode({type:"seamless",id:ee("refiner_seamless"),seamless_x:s.seamless_x,seamless_y:s.seamless_y});t.addEdge(v,"unet",x,"unet"),t.addEdge(x,"unet",y,"unet")}else t.addEdge(v,"unet",y,"unet");t.addEdge(v,"clip2",b,"clip2"),t.addEdge(v,"clip2",C,"clip2"),t.addEdge(b,"conditioning",y,"positive_conditioning"),t.addEdge(C,"conditioning",y,"negative_conditioning"),t.addEdge(n,"latents",y,"latents"),t.addEdge(y,"latents",r,"latents"),t.upsertMetadata({refiner_model:hn.getModelMetadataField(g),refiner_positive_aesthetic_score:c,refiner_negative_aesthetic_score:d,refiner_cfg_scale:m,refiner_scheduler:p,refiner_start:f,refiner_steps:u})},AAe=Ft("system").child({filePath:"features/nodes/util/graph/generation/buildSDXLGraph.ts"}),dZ=async e=>{const{generationMode:t,state:n,manager:s}=e;AAe.debug({generationMode:t,manager:s?.id},"Building SDXL graph");const i=wo(n);ae(i,"No model selected"),ae(i.base==="sdxl","Selected model is not a SDXL Kontext model");const o=oo(n),r=rt(n),l=Vc(n),{cfgScale:c,cfgRescaleMultiplier:d,scheduler:u,steps:p,shouldUseCpuNoise:m,colorCompensation:f,vaePrecision:g,vae:v,refinerModel:b}=o,C=g==="fp32",y=f?"SDXL":"None",x=Zd(n),w=new hn(ee("sdxl_graph")),_=w.addNode({type:"sdxl_model_loader",id:ee("sdxl_model_loader"),model:i}),S=w.addNode({id:ee("positive_prompt"),type:"string"}),I=w.addNode({type:"sdxl_compel_prompt",id:ee("pos_cond")}),k=w.addNode({type:"collect",id:ee("pos_cond_collect")}),E=w.addNode({type:"sdxl_compel_prompt",id:ee("neg_cond"),prompt:x.negative,style:x.negative}),j=w.addNode({type:"collect",id:ee("neg_cond_collect")}),P=w.addNode({id:ee("seed"),type:"integer"}),D=w.addNode({type:"noise",id:ee("noise"),use_cpu:m}),O=w.addNode({type:"denoise_latents",id:ee("denoise_latents"),cfg_scale:c,cfg_rescale_multiplier:d,scheduler:u,steps:p}),N=w.addNode({type:"l2i",id:ee("l2i"),fp32:C}),F=v?.base===i.base?w.addNode({type:"vae_loader",id:ee("vae"),vae_model:v}):null;w.addEdge(_,"unet",O,"unet"),w.addEdge(_,"clip",I,"clip"),w.addEdge(_,"clip",E,"clip"),w.addEdge(_,"clip2",I,"clip2"),w.addEdge(_,"clip2",E,"clip2"),w.addEdge(S,"value",I,"prompt"),w.addEdge(S,"value",I,"style"),w.addEdge(I,"conditioning",k,"item"),w.addEdge(k,"collection",O,"positive_conditioning"),w.addEdge(E,"conditioning",j,"item"),w.addEdge(j,"collection",O,"negative_conditioning"),w.addEdge(P,"value",D,"seed"),w.addEdge(D,"noise",O,"noise"),w.addEdge(O,"latents",N,"latents"),w.upsertMetadata({cfg_scale:c,cfg_rescale_multiplier:d,model:hn.getModelMetadataField(i),steps:p,rand_device:m?"cpu":"cuda",scheduler:u,negative_prompt:x.negative,vae:v??void 0}),w.addEdgeToMetadata(P,"value","seed"),w.addEdgeToMetadata(S,"value","positive_prompt");const X=aZ(n,w,O,_,F);cZ(n,w,O,_,X,I,E);const L=X??F??_;w.addEdge(L,"vae",N,"vae"),b&&await EAe(n,w,O,X,I,E,N);let V=N;if(t==="txt2img")V=bm({g:w,state:n,noise:D,denoise:O,l2i:N}),w.upsertMetadata({generation_mode:"sdxl_txt2img"});else if(t==="img2img"){ae(s!==null);const W=w.addNode({type:"i2l",id:ee("i2l"),fp32:C,color_compensation:y});V=await mm({g:w,state:n,manager:s,l2i:N,i2l:W,noise:D,denoise:O,vaeSource:L}),w.upsertMetadata({generation_mode:"sdxl_img2img"})}else if(t==="inpaint"){ae(s!==null);const W=w.addNode({type:"i2l",id:ee("i2l"),fp32:C,color_compensation:y});V=await gm({g:w,state:n,manager:s,l2i:N,i2l:W,noise:D,denoise:O,vaeSource:L,modelLoader:_,seed:P}),w.upsertMetadata({generation_mode:"sdxl_inpaint"})}else if(t==="outpaint"){ae(s!==null);const W=w.addNode({type:"i2l",id:ee("i2l"),fp32:C,color_compensation:y});V=await ym({g:w,state:n,manager:s,l2i:N,i2l:W,noise:D,denoise:O,vaeSource:L,modelLoader:_,seed:P}),w.upsertMetadata({generation_mode:"sdxl_outpaint"})}else ae(!1);if(s!==null){const W=w.addNode({type:"collect",id:ee("control_net_collector")});(await y4({manager:s,entities:r.controlLayers.entities,g:w,rect:r.bbox.rect,collector:W,model:i})).addedControlNets>0?w.addEdge(W,"collection",O,"control"):w.deleteNode(W.id);const G=w.addNode({type:"collect",id:ee("t2i_adapter_collector")});(await sZ({manager:s,entities:r.controlLayers.entities,g:w,rect:r.bbox.rect,collector:G,model:i})).addedT2IAdapters>0?w.addEdge(G,"collection",O,"t2i_adapter"):w.deleteNode(G.id)}const K=w.addNode({type:"collect",id:ee("ip_adapter_collector")});let Z=b4({entities:l.entities,g:w,collector:K,model:i}).addedIPAdapters;if(s!==null){const W=await z_({manager:s,regions:r.regionalGuidance.entities,g:w,bbox:r.bbox.rect,model:i,posCond:I,negCond:E,posCondCollect:k,negCondCollect:j,ipAdapterCollect:K,fluxReduxCollect:null});Z+=W.reduce((R,G)=>R+G.addedIPAdapters,0)}return Z>0?w.addEdge(K,"collection",O,"ip_adapter"):w.deleteNode(K.id),n.system.shouldUseNSFWChecker&&(V=vm(w,V)),n.system.shouldUseWatermarker&&(V=xm(w,V)),w.updateNode(V,Yf(n)),un(n)==="canvas"&&w.upsertMetadata(Lh(n)),w.setMetadataReceivingNode(V),{g:w,seed:P,positivePrompt:S}},PAe=(e,t,n,s,i,o)=>{const r=e.loras.loras.filter(p=>p.isEnabled&&p.model.base==="z-image");if(r.length===0)return;const c=[],d=t.addNode({id:ee("lora_collector"),type:"collect"}),u=t.addNode({type:"z_image_lora_collection_loader",id:ee("z_image_lora_collection_loader")});t.addEdge(d,"collection",u,"loras"),t.addEdge(s,"transformer",u,"transformer"),t.addEdge(s,"qwen3_encoder",u,"qwen3_encoder"),t.deleteEdgesTo(n,["transformer"]),t.deleteEdgesTo(i,["qwen3_encoder"]),t.addEdge(u,"transformer",n,"transformer"),t.addEdge(u,"qwen3_encoder",i,"qwen3_encoder"),o!==null&&(t.deleteEdgesTo(o,["qwen3_encoder"]),t.addEdge(u,"qwen3_encoder",o,"qwen3_encoder"));for(const p of r){const{weight:m}=p,f=_s.parse(p.model),g=t.addNode({type:"lora_selector",id:ee("lora_selector"),lora:f,weight:m});c.push({model:f,weight:m}),t.addEdge(g,"lora",d,"item")}t.upsertMetadata({loras:c})},TAe=Ft("system").child({filePath:"features/nodes/util/graph/generation/buildZImageGraph.ts"}),uZ=async e=>{const{generationMode:t,state:n,manager:s}=e;TAe.debug({generationMode:t,manager:s?.id},"Building Z-Image graph");const i=wo(n);ae(i,"No model selected"),ae(i.base==="z-image","Selected model is not a Z-Image model");const o=UD(n),r=qD(n),l=Uw(n),c=o!==null||l!==null,d=r!==null||l!==null;ae(c,"No VAE source: Set either VAE or Qwen3 Source model"),ae(d,"No Qwen3 Encoder source: Set either Qwen3 Encoder or Qwen3 Source model");const u=oo(n),{cfgScale:p,steps:m}=u,f=Zd(n),g=new hn(ee("z_image_graph")),v=g.addNode({type:"z_image_model_loader",id:ee("z_image_model_loader"),model:i,vae_model:o??void 0,qwen3_encoder_model:r??void 0,qwen3_source_model:l??void 0}),b=g.addNode({id:ee("positive_prompt"),type:"string"}),C=g.addNode({type:"z_image_text_encoder",id:ee("pos_prompt")}),y=g.addNode({type:"collect",id:ee("pos_cond_collect")});let x=null,w=null;p>1&&(x=g.addNode({type:"z_image_text_encoder",id:ee("neg_prompt"),prompt:f.negative}),w=g.addNode({type:"collect",id:ee("neg_cond_collect")}));const _=g.addNode({type:"collect",id:ee("ip_adapter_collect")}),S=g.addNode({id:ee("seed"),type:"integer"}),I=g.addNode({type:"z_image_denoise",id:ee("denoise_latents"),guidance_scale:p,steps:m}),k=g.addNode({type:"z_image_l2i",id:ee("l2i")});g.addEdge(v,"transformer",I,"transformer"),g.addEdge(v,"qwen3_encoder",C,"qwen3_encoder"),g.addEdge(v,"vae",k,"vae"),g.addEdge(v,"vae",I,"vae"),g.addEdge(b,"value",C,"prompt"),g.addEdge(C,"conditioning",y,"item"),g.addEdge(y,"collection",I,"positive_conditioning"),x!==null&&w!==null&&(g.addEdge(v,"qwen3_encoder",x,"qwen3_encoder"),g.addEdge(x,"conditioning",w,"item"),g.addEdge(w,"collection",I,"negative_conditioning")),g.addEdge(S,"value",I,"seed"),g.addEdge(I,"latents",k,"latents"),PAe(n,g,I,v,C,x);const E=rt(n);if(s!==null){const D=E.bbox.rect;await wAe({manager:s,entities:E.controlLayers.entities,g,rect:D,denoise:I}),await z_({manager:s,regions:E.regionalGuidance.entities,g,bbox:E.bbox.rect,model:i,posCond:C,negCond:x,posCondCollect:y,negCondCollect:w,ipAdapterCollect:_,fluxReduxCollect:null})}g.deleteNode(_.id);const j=await Tv(i.key,If);ae(j.base==="z-image"),g.upsertMetadata({cfg_scale:p,negative_prompt:f.negative,model:hn.getModelMetadataField(j),steps:m,vae:o??void 0,qwen3_encoder:r??void 0,qwen3_source:l??void 0}),g.addEdgeToMetadata(S,"value","seed"),g.addEdgeToMetadata(b,"value","positive_prompt");let P=k;if(t==="txt2img")P=bm({g,state:n,denoise:I,l2i:k}),g.upsertMetadata({generation_mode:"z_image_txt2img"});else if(t==="img2img"){ae(s!==null);const D=g.addNode({type:"z_image_i2l",id:ee("z_image_i2l")});P=await mm({g,state:n,manager:s,denoise:I,l2i:k,i2l:D,vaeSource:v}),g.upsertMetadata({generation_mode:"z_image_img2img"})}else if(t==="inpaint"){ae(s!==null);const D=g.addNode({type:"z_image_i2l",id:ee("z_image_i2l")});P=await gm({g,state:n,manager:s,l2i:k,i2l:D,denoise:I,vaeSource:v,modelLoader:v,seed:S}),g.upsertMetadata({generation_mode:"z_image_inpaint"})}else if(t==="outpaint"){ae(s!==null);const D=g.addNode({type:"z_image_i2l",id:ee("z_image_i2l")});P=await ym({g,state:n,manager:s,l2i:k,i2l:D,denoise:I,vaeSource:v,modelLoader:v,seed:S}),g.upsertMetadata({generation_mode:"z_image_outpaint"})}else ae(!1);return n.system.shouldUseNSFWChecker&&(P=vm(g,P)),n.system.shouldUseWatermarker&&(P=xm(g,P)),g.updateNode(P,Yf(n)),un(n)==="canvas"&&g.upsertMetadata(Lh(n)),g.setMetadataReceivingNode(P),{g,seed:S,positivePrompt:b}},l2=Ft("generation").child({filePath:"features/queue/hooks/useEnqueueCanvas.ts"}),DAe=async(e,t,n)=>{const{dispatch:s,getState:i}=e,o=i(),r=Cye(o),l=o.params.model;if(!l){l2.error("No model found in state");return}const c=l.base,d=await Kn(async()=>{const y={generationMode:await t.compositor.getGenerationMode(),state:o,manager:t};switch(c){case"sdxl":return await dZ(y);case"sd-1":case"sd-2":return await rZ(y);case"sd-3":return await lZ(y);case"flux":return await iZ(y);case"cogview4":return await tZ(y);case"z-image":return await uZ(y);default:ae(!1,`No graph builders for base ${c}`)}});if(d.isErr()){let C="Failed to build graph",y="error",x=null;d.error instanceof hH?x=eZ(d.error):d.error instanceof tC&&(C="Unsupported generation mode",x=d.error.message,y="warning");const w=cn(d.error);l2.error({error:w},"Failed to build graph"),pe({status:y,title:C,description:x});return}const{g:u,seed:p,positivePrompt:m}=d.value,f=Jy(()=>v4({state:o,g:u,base:c,prepend:n,seedNode:p,positivePromptNode:m,origin:"canvas",destination:r}));if(f.isErr()){l2.error({error:cn(f.error)},"Failed to prepare batch");return}const g=f.value,b=await s(mi.endpoints.enqueueBatch.initiate(g,{...cu,track:!1})).unwrap();return s(KD(Qf(o))),{batchConfig:g,enqueueResult:b}},MAe=()=>{const e=Ze(),t=pm();return h.useCallback(s=>{if(!t){l2.error("Canvas manager is not available");return}return DAe(e,t,s)},[t,e])},hI=Ft("generation").child({filePath:"features/queue/hooks/useEnqueueGenerate.ts"}),LAe=async(e,t)=>{const{dispatch:n,getState:s}=e,i=s(),o=i.params.model;if(!o){hI.error("No model found in state");return}const r=o.base,l=await Kn(async()=>{const v={generationMode:"txt2img",state:i,manager:null};switch(r){case"sdxl":return await dZ(v);case"sd-1":case"sd-2":return await rZ(v);case"sd-3":return await lZ(v);case"flux":return await iZ(v);case"cogview4":return await tZ(v);case"z-image":return await uZ(v);default:ae(!1,`No graph builders for base ${r}`)}});if(l.isErr()){let v="Failed to build graph",b="error",C=null;l.error instanceof hH?C=eZ(l.error):l.error instanceof tC&&(v="Unsupported generation mode",C=l.error.message,b="warning");const y=cn(l.error);hI.error({error:y},"Failed to build graph"),pe({status:b,title:v,description:C});return}const{g:c,seed:d,positivePrompt:u}=l.value,p=Jy(()=>v4({state:i,g:c,base:r,prepend:t,seedNode:d,positivePromptNode:u,origin:"generate",destination:"generate"}));if(p.isErr()){hI.error({error:cn(p.error)},"Failed to prepare batch");return}const m=p.value,g=await n(mi.endpoints.enqueueBatch.initiate(m,{...cu,track:!1})).unwrap();return n(KD(Qf(i))),{batchConfig:m,enqueueResult:g}},RAe=()=>{const e=Ze();return h.useCallback(n=>LAe(e,n),[e])},OAe=async e=>{const{model:t,upscaleCfgScale:n,upscaleScheduler:s,steps:i,vaePrecision:o,vae:r}=e.params,{upscaleModel:l,upscaleInitialImage:c,structure:d,creativity:u,tileControlnetModel:p,scale:m,tileSize:f,tileOverlap:g}=e.upscale;ae(t,"No model selected"),ae(t.base==="sd-1"||t.base==="sdxl","Multi-Diffusion upscaling requires a SD1.5 or SDXL model"),ae(l,"No upscale model found in state"),ae(c,"No initial image found in state"),ae(p,"Tile controlnet is required");const v=new hn,b=v.addNode({id:ee("positive_prompt"),type:"string"}),C=v.addNode({type:"spandrel_image_to_image_autoscale",id:ee("spandrel_autoscale"),image:c,image_to_image_model:l,fit_to_multiple_of_8:!0,scale:m}),y=v.addNode({type:"unsharp_mask",id:ee("unsharp_2"),radius:2,strength:60});v.addEdge(C,"image",y,"image");const x=v.addNode({id:ee("seed"),type:"integer"}),w=v.addNode({type:"noise",id:ee("noise")});v.addEdge(x,"value",w,"seed"),v.addEdge(y,"width",w,"width"),v.addEdge(y,"height",w,"height");const _=v.addNode({type:"i2l",id:ee("i2l"),fp32:o==="fp32",tile_size:f,tiled:!0});v.addEdge(y,"image",_,"image");const S=v.addNode({type:"l2i",id:ee("l2i"),fp32:o==="fp32",tile_size:f,tiled:!0,board:wye(e),is_intermediate:!1}),I=v.addNode({type:"tiled_multi_diffusion_denoise_latents",id:ee("tiled_multidiffusion_denoise_latents"),tile_height:f,tile_width:f,tile_overlap:g,steps:i,cfg_scale:n,scheduler:s,denoising_start:(u*-1+10)*4.99/100,denoising_end:1});let k,E,j;if(t.base==="sdxl"){const L=Zd(e);k=v.addNode({type:"sdxl_compel_prompt",id:ee("pos_cond")}),E=v.addNode({type:"sdxl_compel_prompt",id:ee("neg_cond"),prompt:L.negative,style:L.negative}),j=v.addNode({type:"sdxl_model_loader",id:ee("sdxl_model_loader"),model:t}),v.addEdge(j,"clip",k,"clip"),v.addEdge(j,"clip",E,"clip"),v.addEdge(j,"clip2",k,"clip2"),v.addEdge(j,"clip2",E,"clip2"),v.addEdge(j,"unet",I,"unet"),v.addEdge(b,"value",k,"prompt"),v.addEdge(b,"value",k,"style"),cZ(e,v,I,j,null,k,E),v.upsertMetadata({negative_prompt:L.negative}),v.addEdgeToMetadata(b,"value","positive_prompt")}else{const L=Zd(e);k=v.addNode({type:"compel",id:ee("pos_cond")}),E=v.addNode({type:"compel",id:ee("neg_cond"),prompt:L.negative}),j=v.addNode({type:"main_model_loader",id:ee("sd1_model_loader"),model:t});const V=v.addNode({type:"clip_skip",id:ee("clip_skip")});v.addEdge(j,"clip",V,"clip"),v.addEdge(V,"clip",k,"clip"),v.addEdge(V,"clip",E,"clip"),v.addEdge(j,"unet",I,"unet"),v.addEdge(b,"value",k,"prompt"),oZ(e,v,I,j,null,V,k,E),v.upsertMetadata({negative_prompt:L.negative}),v.addEdgeToMetadata(b,"value","positive_prompt")}const P=await Tv(t.key,If),D=await Tv(l.key,_ye);v.upsertMetadata({cfg_scale:n,model:hn.getModelMetadataField(P),steps:i,scheduler:s,vae:r??void 0,upscale_model:hn.getModelMetadataField(D),creativity:u,structure:d,tile_size:f,tile_overlap:g,upscale_initial_image:{image_name:c.image_name,width:c.width,height:c.height},upscale_scale:m}),v.setMetadataReceivingNode(S),v.addEdgeToMetadata(C,"width","width"),v.addEdgeToMetadata(C,"height","height"),v.addEdgeToMetadata(x,"value","seed");let O;r&&(O=v.addNode({type:"vae_loader",id:ee("vae"),vae_model:r})),v.addEdge(O||j,"vae",_,"vae"),v.addEdge(O||j,"vae",S,"vae"),v.addEdge(w,"noise",I,"noise"),v.addEdge(_,"latents",I,"latents"),v.addEdge(k,"conditioning",I,"positive_conditioning"),v.addEdge(E,"conditioning",I,"negative_conditioning"),v.addEdge(I,"latents",S,"latents");const N=v.addNode({id:"controlnet_1",type:"controlnet",control_model:p,control_mode:"balanced",resize_mode:"just_resize",control_weight:(d+10)*.0325+.3,begin_step_percent:0,end_step_percent:(d+10)*.025+.3});v.addEdge(y,"image",N,"image");const F=v.addNode({id:"controlnet_2",type:"controlnet",control_model:p,control_mode:"balanced",resize_mode:"just_resize",control_weight:((d+10)*.0325+.15)*.45,begin_step_percent:(d+10)*.025+.3,end_step_percent:.85});v.addEdge(y,"image",F,"image");const X=v.addNode({type:"collect",id:ee("controlnet_collector")});return v.addEdge(N,"control",X,"item"),v.addEdge(F,"control",X,"item"),v.addEdge(X,"collection",I,"control"),{g:v,seed:x,positivePrompt:b}},NAe=Ft("generation").child({filePath:"features/queue/hooks/useEnqueueUpscaling.ts"}),FAe=async(e,t)=>{const{dispatch:n,getState:s}=e,i=s(),o=i.params.model;if(!o){NAe.error("No model found in state");return}const r=o.base,{g:l,seed:c,positivePrompt:d}=await OAe(i),u=v4({state:i,g:l,base:r,prepend:t,seedNode:c,positivePromptNode:d,origin:"upscaling",destination:"gallery"}),m=await n(mi.endpoints.enqueueBatch.initiate(u,{...cu,track:!1})).unwrap();return n(KD(Qf(i))),{batchConfig:u,enqueueResult:m}},BAe=()=>{const e=Ze();return h.useCallback(n=>FAe(e,n),[e])},zAe=Ft("generation").child({filePath:"features/queue/hooks/useInvoke.ts"}),$_=()=>{const e=M(un),t=le(P_),n=rje(),s=MAe(),i=RAe(),o=BAe(),r=M(ZD),[l,{isLoading:c}]=XD({...cu,selectFromResult:({isLoading:m})=>({isLoading:m})}),d=h.useCallback(async m=>{if(!t)return;const f=await Kn(async()=>{switch(e){case"workflows":return await n(m);case"canvas":return await s(m);case"generate":return await i(m);case"upscaling":return await o(m);default:throw new Error(`No enqueue handler for tab: ${e}`)}});f.isErr()&&zAe.error({error:cn(f.error)},"Failed to enqueue batch")},[s,i,o,n,t,e]),u=h.useCallback(()=>{d(!1),e==="generate"||e==="upscaling"||e==="canvas"&&r?Ne.focusPanel(e,cs):e==="workflows"?Ne.getPanel("workflows",Zn)?.api.isActive||Ne.focusPanel(e,cs):e==="canvas"&&Ne.focusPanel(e,Zn)},[d,r,e]),p=h.useCallback(()=>{d(!0),e==="generate"||e==="upscaling"||e==="canvas"&&r?Ne.focusPanel(e,cs):e==="workflows"?Ne.getPanel("workflows",Zn)?.api.isActive||Ne.focusPanel(e,cs):e==="canvas"&&Ne.focusPanel(e,Zn)},[d,r,e]);return{enqueueBack:u,enqueueFront:p,isLoading:c,isDisabled:!t,enqueue:d}};function _P(){return _P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_P.apply(this,arguments)}var hZ=["shift","alt","meta","mod","ctrl"],VAe={esc:"escape",return:"enter",".":"period",",":"comma","-":"slash"," ":"space","`":"backquote","#":"backslash","+":"bracketright",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function Pd(e){return(VAe[e]||e).trim().toLowerCase().replace(/key|digit|numpad|arrow/,"")}function $Ae(e){return hZ.includes(e)}function pI(e,t){return t===void 0&&(t=","),e.split(t)}function fI(e,t,n){t===void 0&&(t="+");var s=e.toLocaleLowerCase().split(t).map(function(r){return Pd(r)}),i={alt:s.includes("alt"),ctrl:s.includes("ctrl")||s.includes("control"),shift:s.includes("shift"),meta:s.includes("meta"),mod:s.includes("mod")},o=s.filter(function(r){return!hZ.includes(r)});return _P({},i,{keys:o,description:n})}(function(){typeof document<"u"&&(document.addEventListener("keydown",function(e){e.key!==void 0&&pZ([Pd(e.key),Pd(e.code)])}),document.addEventListener("keyup",function(e){e.key!==void 0&&fZ([Pd(e.key),Pd(e.code)])})),typeof window<"u"&&window.addEventListener("blur",function(){Td.clear()})})();var Td=new Set;function x4(e){return Array.isArray(e)}function GAe(e,t){t===void 0&&(t=",");var n=x4(e)?e:e.split(t);return n.every(function(s){return Td.has(s.trim().toLowerCase())})}function pZ(e){var t=Array.isArray(e)?e:[e];Td.has("meta")&&Td.forEach(function(n){return!$Ae(n)&&Td.delete(n.toLowerCase())}),t.forEach(function(n){return Td.add(n.toLowerCase())})}function fZ(e){var t=Array.isArray(e)?e:[e];e==="meta"?Td.clear():t.forEach(function(n){return Td.delete(n.toLowerCase())})}function HAe(e,t,n){(typeof n=="function"&&n(e,t)||n===!0)&&e.preventDefault()}function WAe(e,t,n){return typeof n=="function"?n(e,t):n===!0||n===void 0}function UAe(e){return mZ(e,["input","textarea","select"])}function mZ(e,t){var n=e.target;t===void 0&&(t=!1);var s=n&&n.tagName;return x4(t)?!!(s&&t&&t.some(function(i){return i.toLowerCase()===s.toLowerCase()})):!!(s&&t&&t===!0)}function qAe(e,t){return e.length===0&&t?(console.warn('A hotkey has the "scopes" option set, however no active scopes were found. If you want to use the global scopes feature, you need to wrap your app in a <HotkeysProvider>'),!0):t?e.some(function(n){return t.includes(n)})||e.includes("*"):!0}var KAe=function(t,n,s){s===void 0&&(s=!1);var i=n.alt,o=n.meta,r=n.mod,l=n.shift,c=n.ctrl,d=n.keys,u=t.key,p=t.code,m=t.ctrlKey,f=t.metaKey,g=t.shiftKey,v=t.altKey,b=Pd(p),C=u.toLowerCase();if(!(d!=null&&d.includes(b))&&!(d!=null&&d.includes(C))&&!["ctrl","control","unknown","meta","alt","shift","os"].includes(b))return!1;if(!s){if(i===!v&&C!=="alt"||l===!g&&C!=="shift")return!1;if(r){if(!f&&!m)return!1}else if(o===!f&&C!=="meta"&&C!=="os"||c===!m&&C!=="ctrl"&&C!=="control")return!1}return d&&d.length===1&&(d.includes(C)||d.includes(b))?!0:d?GAe(d):!d},ZAe=h.createContext(void 0),XAe=function(){return h.useContext(ZAe)};function gZ(e,t){return e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(n,s){return n&&gZ(e[s],t[s])},!0):e===t}var YAe=h.createContext({hotkeys:[],enabledScopes:[],toggleScope:function(){},enableScope:function(){},disableScope:function(){}}),QAe=function(){return h.useContext(YAe)};function JAe(e){var t=h.useRef(void 0);return gZ(t.current,e)||(t.current=e),t.current}var JR=function(t){t.stopPropagation(),t.preventDefault(),t.stopImmediatePropagation()},ePe=typeof window<"u"?h.useLayoutEffect:h.useEffect;function Ul(e,t,n,s){var i=h.useRef(null),o=h.useRef(!1),r=n instanceof Array?s instanceof Array?void 0:s:n,l=x4(e)?e.join(r?.splitKey):e,c=n instanceof Array?n:s instanceof Array?s:void 0,d=h.useCallback(t,c??[]),u=h.useRef(d);c?u.current=d:u.current=t;var p=JAe(r),m=QAe(),f=m.enabledScopes,g=XAe();return ePe(function(){if(!(p?.enabled===!1||!qAe(f,p?.scopes))){var v=function(w,_){var S;if(_===void 0&&(_=!1),!(UAe(w)&&!mZ(w,p?.enableOnFormTags))){if(i.current!==null){var I=i.current.getRootNode();if((I instanceof Document||I instanceof ShadowRoot)&&I.activeElement!==i.current&&!i.current.contains(I.activeElement)){JR(w);return}}(S=w.target)!=null&&S.isContentEditable&&!(p!=null&&p.enableOnContentEditable)||pI(l,p?.splitKey).forEach(function(k){var E,j=fI(k,p?.combinationKey);if(KAe(w,j,p?.ignoreModifiers)||(E=j.keys)!=null&&E.includes("*")){if(p!=null&&p.ignoreEventWhen!=null&&p.ignoreEventWhen(w)||_&&o.current)return;if(HAe(w,j,p?.preventDefault),!WAe(w,j,p?.enabled)){JR(w);return}u.current(w,j),_||(o.current=!0)}})}},b=function(w){w.key!==void 0&&(pZ(Pd(w.code)),(p?.keydown===void 0&&p?.keyup!==!0||p!=null&&p.keydown)&&v(w))},C=function(w){w.key!==void 0&&(fZ(Pd(w.code)),o.current=!1,p!=null&&p.keyup&&v(w,!0))},y=i.current||r?.document||document;return y.addEventListener("keyup",C),y.addEventListener("keydown",b),g&&pI(l,p?.splitKey).forEach(function(x){return g.addHotkey(fI(x,p?.combinationKey,p?.description))}),function(){y.removeEventListener("keyup",C),y.removeEventListener("keydown",b),g&&pI(l,p?.splitKey).forEach(function(x){return g.removeHotkey(fI(x,p?.combinationKey,p?.description))})}}},[l,p,f]),i}const C4=typeof navigator<"u"&&(navigator.userAgentData?.platform??navigator.platform??"").toLowerCase().includes("mac"),tPe=e=>e.map(t=>C4?t.split("+").map(n=>n.replaceAll("mod","cmd").replaceAll("alt","option")):t.split("+").map(n=>n.replaceAll("mod","ctrl"))),w4=()=>{const{t:e}=T(),t=M(Sye);return h.useMemo(()=>{const s={app:{title:e("hotkeys.app.title"),hotkeys:{}},canvas:{title:e("hotkeys.canvas.title"),hotkeys:{}},viewer:{title:e("hotkeys.viewer.title"),hotkeys:{}},gallery:{title:e("hotkeys.gallery.title"),hotkeys:{}},workflows:{title:e("hotkeys.workflows.title"),hotkeys:{}}},i=(o,r,l,c=!0)=>{const d=`${o}.${r}`,u=t[d]??l;s[o].hotkeys[r]={id:r,category:o,title:e(`hotkeys.${o}.${r}.title`),desc:e(`hotkeys.${o}.${r}.desc`),hotkeys:u,defaultHotkeys:l,platformKeys:tPe(u),isEnabled:c}};return i("app","invoke",["mod+enter"]),i("app","invokeFront",["mod+shift+enter"]),i("app","cancelQueueItem",["shift+x"]),i("app","clearQueue",["mod+shift+x"]),i("app","selectGenerateTab",["1"]),i("app","selectCanvasTab",["2"]),i("app","selectUpscalingTab",["3"]),i("app","selectWorkflowsTab",["4"]),i("app","selectModelsTab",["5"]),i("app","selectQueueTab",["6"]),i("app","promptHistoryPrev",["alt+arrowup"]),i("app","promptHistoryNext",["alt+arrowdown"]),i("app","promptWeightUp",["ctrl+arrowup"]),i("app","promptWeightDown",["ctrl+arrowdown"]),i("app","focusPrompt",["alt+a"]),i("app","toggleLeftPanel",["t","o"]),i("app","toggleRightPanel",["g"]),i("app","resetPanelLayout",["shift+r"]),i("app","togglePanels",["f"]),i("canvas","selectBrushTool",["b"]),i("canvas","selectBboxTool",["c"]),i("canvas","decrementToolWidth",["["]),i("canvas","incrementToolWidth",["]"]),i("canvas","selectEraserTool",["e"]),i("canvas","selectMoveTool",["v"]),i("canvas","selectRectTool",["u"]),i("canvas","selectViewTool",["h"]),i("canvas","selectColorPickerTool",["i"]),i("canvas","setFillColorsToDefault",["d"]),i("canvas","toggleFillColor",["x"]),i("canvas","fitLayersToCanvas",["mod+0"]),i("canvas","fitBboxToCanvas",["mod+shift+0"]),i("canvas","fitBboxToLayers",["shift+n"]),i("canvas","setZoomTo100Percent",["mod+1"]),i("canvas","setZoomTo200Percent",["mod+2"]),i("canvas","setZoomTo400Percent",["mod+3"]),i("canvas","setZoomTo800Percent",["mod+4"]),i("canvas","quickSwitch",["q"]),i("canvas","deleteSelected",["delete","backspace"]),i("canvas","resetSelected",["shift+c"]),i("canvas","transformSelected",["shift+t"]),i("canvas","filterSelected",["shift+f"]),i("canvas","invertMask",["shift+v"]),i("canvas","undo",["mod+z"]),i("canvas","redo",["mod+shift+z","mod+y"]),i("canvas","nextEntity",["alt+]"]),i("canvas","prevEntity",["alt+["]),i("canvas","applyFilter",["enter"]),i("canvas","cancelFilter",["esc"]),i("canvas","applyTransform",["enter"]),i("canvas","cancelTransform",["esc"]),i("canvas","applySegmentAnything",["enter"]),i("canvas","cancelSegmentAnything",["esc"]),i("canvas","toggleNonRasterLayers",["shift+h"]),i("canvas","fitBboxToMasks",["shift+b"]),i("canvas","toggleBbox",["shift+o"]),i("workflows","addNode",["shift+a","space"]),i("workflows","copySelection",["mod+c"]),i("workflows","pasteSelection",["mod+v"]),i("workflows","pasteSelectionWithEdges",["mod+shift+v"]),i("workflows","selectAll",["mod+a"]),i("workflows","deleteSelection",["delete","backspace"]),i("workflows","undo",["mod+z"]),i("workflows","redo",["mod+shift+z","mod+y"]),i("viewer","toggleViewer",["z"]),i("viewer","swapImages",["c"]),i("viewer","nextComparisonMode",["m"]),i("viewer","loadWorkflow",["w"]),i("viewer","recallAll",["a"]),i("viewer","recallSeed",["s"]),i("viewer","recallPrompts",["p"]),i("viewer","remix",["r"]),i("viewer","useSize",["d"]),i("viewer","toggleMetadata",["i"]),i("gallery","selectAllOnPage",["mod+a"]),i("gallery","clearSelection",["esc"]),i("gallery","galleryNavUp",["up"]),i("gallery","galleryNavRight",["right"]),i("gallery","galleryNavDown",["down"]),i("gallery","galleryNavLeft",["left"]),i("gallery","galleryNavUpAlt",["alt+up"]),i("gallery","galleryNavRightAlt",["alt+right"]),i("gallery","galleryNavDownAlt",["alt+down"]),i("gallery","galleryNavLeftAlt",["alt+left"]),i("gallery","deleteSelection",["delete","backspace"]),i("gallery","starImage",["."]),s},[t,e])},nPe=()=>{const e=w4();return h.useMemo(()=>{const t=new Map;for(const[n,s]of Object.entries(e))for(const[i,o]of Object.entries(s.hotkeys))for(const r of o.hotkeys)t.set(r,{category:n,id:i,title:o.title,fullId:`${n}.${i}`});return t},[e])},Be=({id:e,category:t,callback:n,options:s,dependencies:i})=>{const o=w4(),r=h.useMemo(()=>{const c=o[t].hotkeys[e];return ae(c!==void 0,`Hotkey ${t}.${e} not found`),c},[t,o,e]),l=h.useMemo(()=>s?{...s,enabled:r.isEnabled?s.enabled:!1}:{enabled:r.isEnabled},[r.isEnabled,s]);return Ul(r.hotkeys,n,l,i)},sPe=e=>{for(const t of Object.values(e))for(const n of Object.values(t.hotkeys))if(n.hotkeys.length!==n.defaultHotkeys.length||!n.hotkeys.every((s,i)=>s===n.defaultHotkeys[i]))return!0;return!1},iPe=()=>{const{dispatch:e,getState:t}=Ze(),n=$_();Be({id:"invoke",category:"app",callback:n.enqueueBack,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]}),Be({id:"invokeFront",category:"app",callback:n.enqueueFront,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]});const s=s4();Be({id:"cancelQueueItem",category:"app",callback:s.trigger,options:{enabled:!s.isDisabled&&!s.isLoading,preventDefault:!0},dependencies:[s]});const i=xK();Be({id:"clearQueue",category:"app",callback:i.trigger,options:{enabled:!i.isDisabled&&!i.isLoading,preventDefault:!0},dependencies:[i]}),Be({id:"selectGenerateTab",category:"app",callback:()=>{Ne.switchToTab("generate")},dependencies:[e]}),Be({id:"selectCanvasTab",category:"app",callback:()=>{Ne.switchToTab("canvas")},dependencies:[e]}),Be({id:"selectUpscalingTab",category:"app",callback:()=>{Ne.switchToTab("upscaling")},dependencies:[e]}),Be({id:"selectWorkflowsTab",category:"app",callback:()=>{Ne.switchToTab("workflows")},dependencies:[e]}),Be({id:"selectModelsTab",category:"app",callback:()=>{Ne.switchToTab("models")},dependencies:[e]}),Be({id:"selectQueueTab",category:"app",callback:()=>{Ne.switchToTab("queue")},dependencies:[e]});const o=Jf();Be({id:"deleteSelection",category:"gallery",callback:()=>{const r=Yy();if(r!=="gallery"&&r!=="viewer")return;const l=YD(t());l.length&&o.delete(l)},dependencies:[t,o]}),Be({id:"toggleViewer",category:"viewer",callback:()=>{Ne.toggleViewerPanel()},dependencies:[]})};function zi(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){t.forEach(function(i){return i()})}}function oPe(e){if(Array.isArray(e))return e}function aPe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,i,o,r,l=[],c=!0,d=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(s=o.call(n)).done)&&(l.push(s.value),l.length!==t);c=!0);}catch(u){d=!0,i=u}finally{try{if(!c&&n.return!=null&&(r=n.return(),Object(r)!==r))return}finally{if(d)throw i}}return l}}function SP(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function vZ(e,t){if(e){if(typeof e=="string")return SP(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?SP(e,t):void 0}}function rPe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _4(e,t){return oPe(e)||aPe(e,t)||vZ(e,t)||rPe()}var mI={},hg={},eO;function yZ(){if(eO)return hg;eO=1,Object.defineProperty(hg,"__esModule",{value:!0}),hg.bind=void 0;function e(t,n){var s=n.type,i=n.listener,o=n.options;return t.addEventListener(s,i,o),function(){t.removeEventListener(s,i,o)}}return hg.bind=e,hg}var Au={},tO;function lPe(){if(tO)return Au;tO=1;var e=Au&&Au.__assign||function(){return e=Object.assign||function(o){for(var r,l=1,c=arguments.length;l<c;l++){r=arguments[l];for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&(o[d]=r[d])}return o},e.apply(this,arguments)};Object.defineProperty(Au,"__esModule",{value:!0}),Au.bindAll=void 0;var t=yZ();function n(o){if(!(typeof o>"u"))return typeof o=="boolean"?{capture:o}:o}function s(o,r){if(r==null)return o;var l=e(e({},o),{options:e(e({},n(r)),n(o.options))});return l}function i(o,r,l){var c=r.map(function(d){var u=s(d,l);return(0,t.bind)(o,u)});return function(){c.forEach(function(u){return u()})}}return Au.bindAll=i,Au}var nO;function cPe(){return nO||(nO=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bindAll=e.bind=void 0;var t=yZ();Object.defineProperty(e,"bind",{enumerable:!0,get:function(){return t.bind}});var n=lPe();Object.defineProperty(e,"bindAll",{enumerable:!0,get:function(){return n.bindAll}})}(mI)),mI}var ql=cPe(),bZ="data-pdnd-honey-pot";function xZ(e){return e instanceof Element&&e.hasAttribute(bZ)}function S4(e){var t=document.elementsFromPoint(e.x,e.y),n=_4(t,2),s=n[0],i=n[1];return s?xZ(s)?i??null:s:null}function Vv(e){"@babel/helpers - typeof";return Vv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vv(e)}function dPe(e,t){if(Vv(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(Vv(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uPe(e){var t=dPe(e,"string");return Vv(t)=="symbol"?t:t+""}function Lr(e,t,n){return(t=uPe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var CZ=2147483647;function sO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function iO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sO(Object(n),!0).forEach(function(s){Lr(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sO(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var $v=2,oO=$v/2;function hPe(e){return{x:Math.floor(e.x),y:Math.floor(e.y)}}function pPe(e){return{x:e.x-oO,y:e.y-oO}}function fPe(e){return{x:Math.max(e.x,0),y:Math.max(e.y,0)}}function mPe(e){return{x:Math.min(e.x,window.innerWidth-$v),y:Math.min(e.y,window.innerHeight-$v)}}function aO(e){var t=e.client,n=mPe(fPe(pPe(hPe(t))));return DOMRect.fromRect({x:n.x,y:n.y,width:$v,height:$v})}function rO(e){var t=e.clientRect;return{left:"".concat(t.left,"px"),top:"".concat(t.top,"px"),width:"".concat(t.width,"px"),height:"".concat(t.height,"px")}}function gPe(e){var t=e.client,n=e.clientRect;return t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height}function vPe(e){var t=e.initial,n=document.createElement("div");n.setAttribute(bZ,"true");var s=aO({client:t});Object.assign(n.style,iO(iO({backgroundColor:"transparent",position:"fixed",padding:0,margin:0,boxSizing:"border-box"},rO({clientRect:s})),{},{pointerEvents:"auto",zIndex:CZ})),document.body.appendChild(n);var i=ql.bind(window,{type:"pointermove",listener:function(r){var l={x:r.clientX,y:r.clientY};s=aO({client:l}),Object.assign(n.style,rO({clientRect:s}))},options:{capture:!0}});return function(r){var l=r.current;if(i(),gPe({client:l,clientRect:s})){n.remove();return}function c(){d(),n.remove()}var d=ql.bindAll(window,[{type:"pointerdown",listener:c},{type:"pointermove",listener:c},{type:"focusin",listener:c},{type:"focusout",listener:c},{type:"dragstart",listener:c},{type:"dragenter",listener:c},{type:"dragover",listener:c}],{capture:!0})}}function yPe(){var e=null;function t(){return e=null,ql.bind(window,{type:"pointermove",listener:function(i){e={x:i.clientX,y:i.clientY}},options:{capture:!0}})}function n(){var s=null;return function(o){var r=o.eventName,l=o.payload;if(r==="onDragStart"){var c=l.location.initial.input,d=e??{x:c.clientX,y:c.clientY};s=vPe({initial:d})}if(r==="onDrop"){var u,p=l.location.current.input;(u=s)===null||u===void 0||u({current:{x:p.clientX,y:p.clientY}}),s=null,e=null}}}return{bindEvents:t,getOnPostDispatch:n}}function bPe(e){if(Array.isArray(e))return SP(e)}function xPe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function CPe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function G_(e){return bPe(e)||xPe(e)||vZ(e)||CPe()}function nu(e){var t=null;return function(){if(!t){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];var r=e.apply(this,i);t={result:r}}return t.result}}var wZ=nu(function(){return navigator.userAgent.includes("Firefox")}),Cm=nu(function(){var t=navigator,n=t.userAgent;return n.includes("AppleWebKit")&&!n.includes("Chrome")}),nC={isLeavingWindow:Symbol("leaving"),isEnteringWindow:Symbol("entering")};function wPe(e){var t=e.dragEnter;return Cm()?t.hasOwnProperty(nC.isEnteringWindow):!1}function _Pe(e){var t=e.dragLeave;return Cm()?t.hasOwnProperty(nC.isLeavingWindow):!1}(function(){if(typeof window>"u"||!Cm())return;function t(){return{enterCount:0,isOverWindow:!1}}var n=t();function s(){n=t()}ql.bindAll(window,[{type:"dragstart",listener:function(){n.enterCount=0,n.isOverWindow=!0}},{type:"drop",listener:s},{type:"dragend",listener:s},{type:"dragenter",listener:function(o){!n.isOverWindow&&n.enterCount===0&&(o[nC.isEnteringWindow]=!0),n.isOverWindow=!0,n.enterCount++}},{type:"dragleave",listener:function(o){n.enterCount--,n.isOverWindow&&n.enterCount===0&&(o[nC.isLeavingWindow]=!0,n.isOverWindow=!1)}}],{capture:!0})})();function SPe(e){return"nodeName"in e}function _Z(e){return SPe(e)&&e.ownerDocument!==document}function kPe(e){var t=e.dragLeave,n=t.type,s=t.relatedTarget;return n!=="dragleave"?!1:Cm()?_Pe({dragLeave:t}):s==null?!0:wZ()?_Z(s):s instanceof HTMLIFrameElement}function k4(e){var t=e.onDragEnd;return[{type:"pointermove",listener:function(){var n=0;return function(){if(n<20){n++;return}t()}}()},{type:"pointerdown",listener:t}]}function tv(e){return{altKey:e.altKey,button:e.button,buttons:e.buttons,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY}}var IPe=function(t){var n=[],s=null,i=function(){for(var r=arguments.length,l=new Array(r),c=0;c<r;c++)l[c]=arguments[c];n=l,!s&&(s=requestAnimationFrame(function(){s=null,t.apply(void 0,n)}))};return i.cancel=function(){s&&(cancelAnimationFrame(s),s=null)},i},gI=IPe(function(e){return e()}),Fb=function(){var e=null;function t(s){var i=requestAnimationFrame(function(){e=null,s()});e={frameId:i,fn:s}}function n(){e&&(cancelAnimationFrame(e.frameId),e.fn(),e=null)}return{schedule:t,flush:n}}();function jPe(e){var t=e.source,n=e.initial,s=e.dispatchEvent,i={dropTargets:[]};function o(l){s(l),i={dropTargets:l.payload.location.current.dropTargets}}var r={start:function(c){var d=c.nativeSetDragImage,u={current:n,previous:i,initial:n};o({eventName:"onGenerateDragPreview",payload:{source:t,location:u,nativeSetDragImage:d}}),Fb.schedule(function(){o({eventName:"onDragStart",payload:{source:t,location:u}})})},dragUpdate:function(c){var d=c.current;Fb.flush(),gI.cancel(),o({eventName:"onDropTargetChange",payload:{source:t,location:{initial:n,previous:i,current:d}}})},drag:function(c){var d=c.current;gI(function(){Fb.flush();var u={initial:n,previous:i,current:d};o({eventName:"onDrag",payload:{source:t,location:u}})})},drop:function(c){var d=c.current,u=c.updatedSourcePayload;Fb.flush(),gI.cancel(),o({eventName:"onDrop",payload:{source:u??t,location:{current:d,previous:i,initial:n}}})}};return r}var kP={isActive:!1};function SZ(){return!kP.isActive}function EPe(e){return e.dataTransfer?e.dataTransfer.setDragImage.bind(e.dataTransfer):null}function APe(e){var t=e.current,n=e.next;if(t.length!==n.length)return!0;for(var s=0;s<t.length;s++)if(t[s].element!==n[s].element)return!0;return!1}function PPe(e){var t=e.event,n=e.dragType,s=e.getDropTargetsOver,i=e.dispatchEvent;if(!SZ())return;var o=TPe({event:t,dragType:n,getDropTargetsOver:s});kP.isActive=!0;var r={current:o};vI({event:t,current:o.dropTargets});var l=jPe({source:n.payload,dispatchEvent:i,initial:o});function c(f){var g=APe({current:r.current.dropTargets,next:f.dropTargets});r.current=f,g&&l.dragUpdate({current:r.current})}function d(f){var g=tv(f),v=xZ(f.target)?S4({x:g.clientX,y:g.clientY}):f.target,b=s({target:v,input:g,source:n.payload,current:r.current.dropTargets});b.length&&(f.preventDefault(),vI({event:f,current:b})),c({dropTargets:b,input:g})}function u(){r.current.dropTargets.length&&c({dropTargets:[],input:r.current.input}),l.drop({current:r.current,updatedSourcePayload:null}),p()}function p(){kP.isActive=!1,m()}var m=ql.bindAll(window,[{type:"dragover",listener:function(g){d(g),l.drag({current:r.current})}},{type:"dragenter",listener:d},{type:"dragleave",listener:function(g){kPe({dragLeave:g})&&(c({input:r.current.input,dropTargets:[]}),n.startedFrom==="external"&&u())}},{type:"drop",listener:function(g){if(r.current={dropTargets:r.current.dropTargets,input:tv(g)},!r.current.dropTargets.length){u();return}g.preventDefault(),vI({event:g,current:r.current.dropTargets}),l.drop({current:r.current,updatedSourcePayload:n.type==="external"?n.getDropPayload(g):null}),p()}},{type:"dragend",listener:function(g){r.current={dropTargets:r.current.dropTargets,input:tv(g)},u()}}].concat(G_(k4({onDragEnd:u}))),{capture:!0});l.start({nativeSetDragImage:EPe(t)})}function vI(e){var t,n=e.event,s=e.current,i=(t=s[0])===null||t===void 0?void 0:t.dropEffect;i!=null&&n.dataTransfer&&(n.dataTransfer.dropEffect=i)}function TPe(e){var t=e.event,n=e.dragType,s=e.getDropTargetsOver,i=tv(t);if(n.startedFrom==="external")return{input:i,dropTargets:[]};var o=s({input:i,source:n.payload,target:t.target,current:[]});return{input:i,dropTargets:o}}var lO={canStart:SZ,start:PPe},IP=new Map;function DPe(e){var t=e.typeKey,n=e.mount,s=IP.get(t);if(s)return s.usageCount++,s;var i={typeKey:t,unmount:n(),usageCount:1};return IP.set(t,i),i}function MPe(e){var t=DPe(e);return function(){t.usageCount--,!(t.usageCount>0)&&(t.unmount(),IP.delete(e.typeKey))}}function kZ(e,t){var n=t.attribute,s=t.value;return e.setAttribute(n,s),function(){return e.removeAttribute(n)}}function cO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function rd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cO(Object(n),!0).forEach(function(s){Lr(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cO(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function yI(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=LPe(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,r=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return r=d.done,d},e:function(d){l=!0,o=d},f:function(){try{r||n.return==null||n.return()}finally{if(l)throw o}}}}function LPe(e,t){if(e){if(typeof e=="string")return dO(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dO(e,t):void 0}}function dO(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function bI(e){return e.slice(0).reverse()}function RPe(e){var t=e.typeKey,n=e.defaultDropEffect,s=new WeakMap,i="data-drop-target-for-".concat(t),o="[".concat(i,"]");function r(f){return s.set(f.element,f),function(){return s.delete(f.element)}}function l(f){var g=zi(kZ(f.element,{attribute:i,value:"true"}),r(f));return nu(g)}function c(f){var g,v,b,C,y=f.source,x=f.target,w=f.input,_=f.result,S=_===void 0?[]:_;if(x==null)return S;if(!(x instanceof Element))return x instanceof Node?c({source:y,target:x.parentElement,input:w,result:S}):S;var I=x.closest(o);if(I==null)return S;var k=s.get(I);if(k==null)return S;var E={input:w,source:y,element:k.element};if(k.canDrop&&!k.canDrop(E))return c({source:y,target:k.element.parentElement,input:w,result:S});var j=(g=(v=k.getData)===null||v===void 0?void 0:v.call(k,E))!==null&&g!==void 0?g:{},P=(b=(C=k.getDropEffect)===null||C===void 0?void 0:C.call(k,E))!==null&&b!==void 0?b:n,D={data:j,element:k.element,dropEffect:P,isActiveDueToStickiness:!1};return c({source:y,target:k.element.parentElement,input:w,result:[].concat(G_(S),[D])})}function d(f){var g=f.eventName,v=f.payload,b=yI(v.location.current.dropTargets),C;try{for(b.s();!(C=b.n()).done;){var y,x=C.value,w=s.get(x.element),_=rd(rd({},v),{},{self:x});w==null||(y=w[g])===null||y===void 0||y.call(w,_)}}catch(S){b.e(S)}finally{b.f()}}var u={onGenerateDragPreview:d,onDrag:d,onDragStart:d,onDrop:d,onDropTargetChange:function(g){var v=g.payload,b=new Set(v.location.current.dropTargets.map(function(L){return L.element})),C=new Set,y=yI(v.location.previous.dropTargets),x;try{for(y.s();!(x=y.n()).done;){var w,_=x.value;C.add(_.element);var S=s.get(_.element),I=b.has(_.element),k=rd(rd({},v),{},{self:_});if(S==null||(w=S.onDropTargetChange)===null||w===void 0||w.call(S,k),!I){var E;S==null||(E=S.onDragLeave)===null||E===void 0||E.call(S,k)}}}catch(L){y.e(L)}finally{y.f()}var j=yI(v.location.current.dropTargets),P;try{for(j.s();!(P=j.n()).done;){var D,O,N=P.value;if(!C.has(N.element)){var F=rd(rd({},v),{},{self:N}),X=s.get(N.element);X==null||(D=X.onDropTargetChange)===null||D===void 0||D.call(X,F),X==null||(O=X.onDragEnter)===null||O===void 0||O.call(X,F)}}}catch(L){j.e(L)}finally{j.f()}}};function p(f){u[f.eventName](f)}function m(f){var g=f.source,v=f.target,b=f.input,C=f.current,y=c({source:g,target:v,input:b});if(y.length>=C.length)return y;for(var x=bI(C),w=bI(y),_=[],S=0;S<x.length;S++){var I,k=x[S],E=w[S];if(E!=null){_.push(E);continue}var j=_[S-1],P=x[S-1];if(j?.element!==P?.element)break;var D=s.get(k.element);if(!D)break;var O={input:b,source:g,element:D.element};if(D.canDrop&&!D.canDrop(O)||!((I=D.getIsSticky)!==null&&I!==void 0&&I.call(D,O)))break;_.push(rd(rd({},k),{},{isActiveDueToStickiness:!0}))}return bI(_)}return{dropTargetForConsumers:l,getIsOver:m,dispatchEvent:p}}function OPe(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=NPe(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,r=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return r=d.done,d},e:function(d){l=!0,o=d},f:function(){try{r||n.return==null||n.return()}finally{if(l)throw o}}}}function NPe(e,t){if(e){if(typeof e=="string")return uO(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?uO(e,t):void 0}}function uO(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function hO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function FPe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hO(Object(n),!0).forEach(function(s){Lr(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hO(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function BPe(){var e=new Set,t=null;function n(o){t&&(!o.canMonitor||o.canMonitor(t.canMonitorArgs))&&t.active.add(o)}function s(o){var r=FPe({},o);e.add(r),n(r);function l(){e.delete(r),t&&t.active.delete(r)}return nu(l)}function i(o){var r=o.eventName,l=o.payload;if(r==="onGenerateDragPreview"){t={canMonitorArgs:{initial:l.location.initial,source:l.source},active:new Set};var c=OPe(e),d;try{for(c.s();!(d=c.n()).done;){var u=d.value;n(u)}}catch(b){c.e(b)}finally{c.f()}}if(t){for(var p=Array.from(t.active),m=0,f=p;m<f.length;m++){var g=f[m];if(t.active.has(g)){var v;(v=g[r])===null||v===void 0||v.call(g,l)}}r==="onDrop"&&(t.active.clear(),t=null)}}return{dispatchEvent:i,monitorForConsumers:s}}function IZ(e){var t=e.typeKey,n=e.mount,s=e.dispatchEventToSource,i=e.onPostDispatch,o=e.defaultDropEffect,r=BPe(),l=RPe({typeKey:t,defaultDropEffect:o});function c(p){s?.(p),l.dispatchEvent(p),r.dispatchEvent(p),i?.(p)}function d(p){var m=p.event,f=p.dragType;lO.start({event:m,dragType:f,getDropTargetsOver:l.getIsOver,dispatchEvent:c})}function u(){function p(){var m={canStart:lO.canStart,start:d};return n(m)}return MPe({typeKey:t,mount:p})}return{registerUsage:u,dropTarget:l.dropTargetForConsumers,monitor:r.monitorForConsumers}}var zPe=nu(function(){return navigator.userAgent.toLocaleLowerCase().includes("android")}),jZ="pdnd:android-fallback",jP="text/plain",VPe="text/uri-list",EZ="application/vnd.pdnd",sC=new WeakMap;function $Pe(e){return sC.set(e.element,e),function(){sC.delete(e.element)}}var pO=yPe(),I4=IZ({typeKey:"element",defaultDropEffect:"move",mount:function(t){return zi(pO.bindEvents(),ql.bind(document,{type:"dragstart",listener:function(s){var i,o,r,l,c,d;if(t.canStart(s)&&!s.defaultPrevented&&s.dataTransfer){var u=s.target;if(!(u instanceof HTMLElement))return null;var p=sC.get(u);if(!p)return null;var m=tv(s),f={element:p.element,dragHandle:(i=p.dragHandle)!==null&&i!==void 0?i:null,input:m};if(p.canDrag&&!p.canDrag(f))return s.preventDefault(),null;if(p.dragHandle){var g=S4({x:m.clientX,y:m.clientY});if(!p.dragHandle.contains(g))return s.preventDefault(),null}var v=(o=(r=p.getInitialDataForExternal)===null||r===void 0?void 0:r.call(p,f))!==null&&o!==void 0?o:null;if(v)for(var b=0,C=Object.entries(v);b<C.length;b++){var y=_4(C[b],2),x=y[0],w=y[1];s.dataTransfer.setData(x,w??"")}zPe()&&!s.dataTransfer.types.includes(jP)&&!s.dataTransfer.types.includes(VPe)&&s.dataTransfer.setData(jP,jZ),s.dataTransfer.setData(EZ,"");var _={element:p.element,dragHandle:(l=p.dragHandle)!==null&&l!==void 0?l:null,data:(c=(d=p.getInitialData)===null||d===void 0?void 0:d.call(p,f))!==null&&c!==void 0?c:{}},S={type:"element",payload:_,startedFrom:"internal"};t.start({event:s,dragType:S})}}}))},dispatchEventToSource:function(t){var n,s,i=t.eventName,o=t.payload;(n=sC.get(o.source.element))===null||n===void 0||(s=n[i])===null||s===void 0||s.call(n,o)},onPostDispatch:pO.getOnPostDispatch()}),o1=I4.dropTarget,Gh=I4.monitor;function wm(e){var t=zi(I4.registerUsage(),$Pe(e),kZ(e.element,{attribute:"draggable",value:"true"}));return nu(t)}ve(QD,qc,(e,t)=>{const{data:n}=e;let s=null;if(n){const o=$l.selectAll(n).filter(fH).sort(l=>l.type==="controlnet"?-1:1);s=o.filter(l=>t?l.base===t:!0)[0]??o[0]??null}const i=s?.type==="t2i_adapter"?It(Tye):It(Rh);return s&&(i.model=_s.parse(s)),i});const a1=e=>{const t=e(),n=wo(t),s=pH(t),i=n?.base;if(i==="flux"&&n?.name?.toLowerCase().includes("kontext")){const l=It(kye);return l.model=_s.parse(n),l}const o=s.find(l=>l.base===i),r=It(Iye);return o&&(r.model=_s.parse(o),o.base==="flux"&&(r.clipVisionModel="ViT-L")),r},r1=e=>{const t=e(),n=wo(t),s=pH(t),i=n?.base,o=s.find(l=>l.base===i),r=It(jye);return o&&(r.model=_s.parse(o),o.base==="flux"&&(r.clipVisionModel="ViT-L")),r},j4=()=>{const e=Q(),t=M($n),n=t?.type==="control_layer"?t.id:void 0;return h.useCallback(()=>{const i={controlAdapter:It(Rh)};e(Ty({isSelected:!0,overrides:i,addAfter:n}))},[e,n])},E4=()=>{const e=Q(),t=M($n),n=t?.type==="raster_layer"?t.id:void 0;return h.useCallback(()=>{e(em({isSelected:!0,addAfter:n}))},[e,n])},A4=()=>{const e=Q(),t=M($n),n=t?.type==="inpaint_mask"?t.id:void 0;return h.useCallback(()=>{e(yl({isSelected:!0,addAfter:n}))},[e,n])},P4=()=>{const e=Q(),t=M($n),n=t?.type==="regional_guidance"?t.id:void 0;return h.useCallback(()=>{e(Xd({isSelected:!0,addAfter:n}))},[e,n])},AZ=()=>{const{dispatch:e,getState:t}=Ze();return h.useCallback(()=>{const s=r1(t),i={referenceImages:[{id:ee("regional_guidance_reference_image"),config:s}]};e(Xd({isSelected:!0,overrides:i}))},[e,t])},PZ=e=>{const{dispatch:t,getState:n}=Ze();return h.useCallback(()=>{const i=r1(n);t(Eye({entityIdentifier:e,overrides:{config:i}}))},[t,e,n])},TZ=e=>{const t=Q();return h.useCallback(()=>{t(FA({entityIdentifier:e,prompt:""}))},[t,e])},DZ=e=>{const t=Q();return h.useCallback(()=>{t(BA({entityIdentifier:e,prompt:""}))},[t,e])},GPe=e=>{const t=Q();return h.useCallback(()=>{t(Aye({entityIdentifier:e}))},[t,e])},HPe=e=>{const t=Q();return h.useCallback(()=>{t(Pye({entityIdentifier:e}))},[t,e])},MZ=e=>Yn(rt,t=>{const n=bo(t,e);return{canAddPositivePrompt:n?.positivePrompt===null,canAddNegativePrompt:n?.negativePrompt===null}}),EP="drop-shadow(0px 0px 4px rgb(0, 0, 0)) drop-shadow(0px 0px 4px rgba(0, 0, 0, 0.3))",LZ=(e,t)=>{if(e.width===0||e.height===0)return{width:t.width,height:t.height};if(t.width<=e.width&&t.height<=e.height)return{width:t.width,height:t.height};const n=e.width/e.height,s=t.width/t.height;let i,o;return s>n?(i=e.width,o=i/s):(o=e.height,i=o*s),{width:i,height:o}},RZ=(e,t,n,s)=>{const i=e==="fill"?t.width:t.width*s.width/n.width,o=e==="fill"?t.height:t.height*s.height/n.height;return{width:i,height:o}},WPe=Yn(ir,e=>{const t=e.selection.at(-1)??null,n=e.imageToCompare;return{firstImage:t,secondImage:n}}),UPe=ve(ir,e=>e.imageToCompare),qPe=new Error("request for lock canceled");var KPe=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function l(u){try{d(s.next(u))}catch(p){r(p)}}function c(u){try{d(s.throw(u))}catch(p){r(p)}}function d(u){u.done?o(u.value):i(u.value).then(l,c)}d((s=s.apply(e,t||[])).next())})};class ZPe{constructor(t,n=qPe){this._value=t,this._cancelError=n,this._queue=[],this._weightedWaiters=[]}acquire(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((s,i)=>{const o={resolve:s,reject:i,weight:t,priority:n},r=OZ(this._queue,l=>n<=l.priority);r===-1&&t<=this._value?this._dispatchItem(o):this._queue.splice(r+1,0,o)})}runExclusive(t){return KPe(this,arguments,void 0,function*(n,s=1,i=0){const[o,r]=yield this.acquire(s,i);try{return yield n(o)}finally{r()}})}waitForUnlock(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,n)?Promise.resolve():new Promise(s=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),XPe(this._weightedWaiters[t-1],{resolve:s,priority:n})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const n=this._value;this._value-=t.weight,t.resolve([n,this._newReleaser(t.weight)])}_newReleaser(t){let n=!1;return()=>{n||(n=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){const n=this._weightedWaiters[t-1];n&&(n.forEach(s=>s.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let n=this._value;n>0;n--){const s=this._weightedWaiters[n-1];if(!s)continue;const i=s.findIndex(o=>o.priority<=t);(i===-1?s:s.splice(0,i)).forEach(o=>o.resolve())}}}_couldLockImmediately(t,n){return(this._queue.length===0||this._queue[0].priority<n)&&t<=this._value}}function XPe(e,t){const n=OZ(e,s=>t.priority<=s.priority);e.splice(n+1,0,t)}function OZ(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}var YPe=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function l(u){try{d(s.next(u))}catch(p){r(p)}}function c(u){try{d(s.throw(u))}catch(p){r(p)}}function d(u){u.done?o(u.value):i(u.value).then(l,c)}d((s=s.apply(e,t||[])).next())})};class H_{constructor(t){this._semaphore=new ZPe(1,t)}acquire(){return YPe(this,arguments,void 0,function*(t=0){const[,n]=yield this._semaphore.acquire(1,t);return n})}runExclusive(t,n=0){return this._semaphore.runExclusive(()=>t(),1,n)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}class Tn{initialize=void 0;getLoggingContext=()=>({...this.parent.getLoggingContext(),path:this.path.join(" > ")});destroy=()=>{this.log.debug("Destroying module")};repr=()=>({id:this.id,type:this.type,path:this.path})}var c2={exports:{}},pg={},xI={},CI={},fO;function Xt(){return fO||(fO=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._registerNode=e.Konva=e.glob=void 0;const t=Math.PI/180;function n(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}e.glob=typeof TL<"u"?TL:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},e.Konva={_global:e.glob,version:"9.3.22",isBrowser:n(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return e.Konva.angleDeg?i*t:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return e.Konva.DD.isDragging},isTransforming(){var i;return(i=e.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!e.Konva.DD.node},releaseCanvasOnDestroy:!0,document:e.glob.document,_injectGlobal(i){e.glob.Konva=i}};const s=i=>{e.Konva[i.prototype.getClassName()]=i};e._registerNode=s,e.Konva._injectGlobal(e.Konva)}(CI)),CI}var wI={},mO;function Is(){return mO||(mO=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Util=e.Transform=void 0;const t=Xt();class n{constructor(w=[1,0,0,1,0,0]){this.dirty=!1,this.m=w&&w.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new n(this.m)}copyInto(w){w.m[0]=this.m[0],w.m[1]=this.m[1],w.m[2]=this.m[2],w.m[3]=this.m[3],w.m[4]=this.m[4],w.m[5]=this.m[5]}point(w){const _=this.m;return{x:_[0]*w.x+_[2]*w.y+_[4],y:_[1]*w.x+_[3]*w.y+_[5]}}translate(w,_){return this.m[4]+=this.m[0]*w+this.m[2]*_,this.m[5]+=this.m[1]*w+this.m[3]*_,this}scale(w,_){return this.m[0]*=w,this.m[1]*=w,this.m[2]*=_,this.m[3]*=_,this}rotate(w){const _=Math.cos(w),S=Math.sin(w),I=this.m[0]*_+this.m[2]*S,k=this.m[1]*_+this.m[3]*S,E=this.m[0]*-S+this.m[2]*_,j=this.m[1]*-S+this.m[3]*_;return this.m[0]=I,this.m[1]=k,this.m[2]=E,this.m[3]=j,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(w,_){const S=this.m[0]+this.m[2]*_,I=this.m[1]+this.m[3]*_,k=this.m[2]+this.m[0]*w,E=this.m[3]+this.m[1]*w;return this.m[0]=S,this.m[1]=I,this.m[2]=k,this.m[3]=E,this}multiply(w){const _=this.m[0]*w.m[0]+this.m[2]*w.m[1],S=this.m[1]*w.m[0]+this.m[3]*w.m[1],I=this.m[0]*w.m[2]+this.m[2]*w.m[3],k=this.m[1]*w.m[2]+this.m[3]*w.m[3],E=this.m[0]*w.m[4]+this.m[2]*w.m[5]+this.m[4],j=this.m[1]*w.m[4]+this.m[3]*w.m[5]+this.m[5];return this.m[0]=_,this.m[1]=S,this.m[2]=I,this.m[3]=k,this.m[4]=E,this.m[5]=j,this}invert(){const w=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),_=this.m[3]*w,S=-this.m[1]*w,I=-this.m[2]*w,k=this.m[0]*w,E=w*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),j=w*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=_,this.m[1]=S,this.m[2]=I,this.m[3]=k,this.m[4]=E,this.m[5]=j,this}getMatrix(){return this.m}decompose(){const w=this.m[0],_=this.m[1],S=this.m[2],I=this.m[3],k=this.m[4],E=this.m[5],j=w*I-_*S,P={x:k,y:E,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(w!=0||_!=0){const D=Math.sqrt(w*w+_*_);P.rotation=_>0?Math.acos(w/D):-Math.acos(w/D),P.scaleX=D,P.scaleY=j/D,P.skewX=(w*S+_*I)/j,P.skewY=0}else if(S!=0||I!=0){const D=Math.sqrt(S*S+I*I);P.rotation=Math.PI/2-(I>0?Math.acos(-S/D):-Math.acos(S/D)),P.scaleX=j/D,P.scaleY=D,P.skewX=0,P.skewY=(w*S+_*I)/j}return P.rotation=e.Util._getRotation(P.rotation),P}}e.Transform=n;const s="[object Array]",i="[object Number]",o="[object String]",r="[object Boolean]",l=Math.PI/180,c=180/Math.PI,d="#",u="",p="0",m="Konva warning: ",f="Konva error: ",g="rgb(",v={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},b=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let C=[];const y=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(x){setTimeout(x,60)};e.Util={_isElement(x){return!!(x&&x.nodeType==1)},_isFunction(x){return!!(x&&x.constructor&&x.call&&x.apply)},_isPlainObject(x){return!!x&&x.constructor===Object},_isArray(x){return Object.prototype.toString.call(x)===s},_isNumber(x){return Object.prototype.toString.call(x)===i&&!isNaN(x)&&isFinite(x)},_isString(x){return Object.prototype.toString.call(x)===o},_isBoolean(x){return Object.prototype.toString.call(x)===r},isObject(x){return x instanceof Object},isValidSelector(x){if(typeof x!="string")return!1;const w=x[0];return w==="#"||w==="."||w===w.toUpperCase()},_sign(x){return x===0||x>0?1:-1},requestAnimFrame(x){C.push(x),C.length===1&&y(function(){const w=C;C=[],w.forEach(function(_){_()})})},createCanvasElement(){const x=document.createElement("canvas");try{x.style=x.style||{}}catch{}return x},createImageElement(){return document.createElement("img")},_isInDocument(x){for(;x=x.parentNode;)if(x==document)return!0;return!1},_urlToImage(x,w){const _=e.Util.createImageElement();_.onload=function(){w(_)},_.src=x},_rgbToHex(x,w,_){return((1<<24)+(x<<16)+(w<<8)+_).toString(16).slice(1)},_hexToRgb(x){x=x.replace(d,u);const w=parseInt(x,16);return{r:w>>16&255,g:w>>8&255,b:w&255}},getRandomColor(){let x=(Math.random()*16777215<<0).toString(16);for(;x.length<6;)x=p+x;return d+x},getRGB(x){let w;return x in v?(w=v[x],{r:w[0],g:w[1],b:w[2]}):x[0]===d?this._hexToRgb(x.substring(1)):x.substr(0,4)===g?(w=b.exec(x.replace(/ /g,"")),{r:parseInt(w[1],10),g:parseInt(w[2],10),b:parseInt(w[3],10)}):{r:0,g:0,b:0}},colorToRGBA(x){return x=x||"black",e.Util._namedColorToRBA(x)||e.Util._hex3ColorToRGBA(x)||e.Util._hex4ColorToRGBA(x)||e.Util._hex6ColorToRGBA(x)||e.Util._hex8ColorToRGBA(x)||e.Util._rgbColorToRGBA(x)||e.Util._rgbaColorToRGBA(x)||e.Util._hslColorToRGBA(x)},_namedColorToRBA(x){const w=v[x.toLowerCase()];return w?{r:w[0],g:w[1],b:w[2],a:1}:null},_rgbColorToRGBA(x){if(x.indexOf("rgb(")===0){x=x.match(/rgb\(([^)]+)\)/)[1];const w=x.split(/ *, */).map(Number);return{r:w[0],g:w[1],b:w[2],a:1}}},_rgbaColorToRGBA(x){if(x.indexOf("rgba(")===0){x=x.match(/rgba\(([^)]+)\)/)[1];const w=x.split(/ *, */).map((_,S)=>_.slice(-1)==="%"?S===3?parseInt(_)/100:parseInt(_)/100*255:Number(_));return{r:w[0],g:w[1],b:w[2],a:w[3]}}},_hex8ColorToRGBA(x){if(x[0]==="#"&&x.length===9)return{r:parseInt(x.slice(1,3),16),g:parseInt(x.slice(3,5),16),b:parseInt(x.slice(5,7),16),a:parseInt(x.slice(7,9),16)/255}},_hex6ColorToRGBA(x){if(x[0]==="#"&&x.length===7)return{r:parseInt(x.slice(1,3),16),g:parseInt(x.slice(3,5),16),b:parseInt(x.slice(5,7),16),a:1}},_hex4ColorToRGBA(x){if(x[0]==="#"&&x.length===5)return{r:parseInt(x[1]+x[1],16),g:parseInt(x[2]+x[2],16),b:parseInt(x[3]+x[3],16),a:parseInt(x[4]+x[4],16)/255}},_hex3ColorToRGBA(x){if(x[0]==="#"&&x.length===4)return{r:parseInt(x[1]+x[1],16),g:parseInt(x[2]+x[2],16),b:parseInt(x[3]+x[3],16),a:1}},_hslColorToRGBA(x){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(x)){const[w,..._]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(x),S=Number(_[0])/360,I=Number(_[1])/100,k=Number(_[2])/100;let E,j,P;if(I===0)return P=k*255,{r:Math.round(P),g:Math.round(P),b:Math.round(P),a:1};k<.5?E=k*(1+I):E=k+I-k*I;const D=2*k-E,O=[0,0,0];for(let N=0;N<3;N++)j=S+1/3*-(N-1),j<0&&j++,j>1&&j--,6*j<1?P=D+(E-D)*6*j:2*j<1?P=E:3*j<2?P=D+(E-D)*(2/3-j)*6:P=D,O[N]=P*255;return{r:Math.round(O[0]),g:Math.round(O[1]),b:Math.round(O[2]),a:1}}},haveIntersection(x,w){return!(w.x>x.x+x.width||w.x+w.width<x.x||w.y>x.y+x.height||w.y+w.height<x.y)},cloneObject(x){const w={};for(const _ in x)this._isPlainObject(x[_])?w[_]=this.cloneObject(x[_]):this._isArray(x[_])?w[_]=this.cloneArray(x[_]):w[_]=x[_];return w},cloneArray(x){return x.slice(0)},degToRad(x){return x*l},radToDeg(x){return x*c},_degToRad(x){return e.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),e.Util.degToRad(x)},_radToDeg(x){return e.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),e.Util.radToDeg(x)},_getRotation(x){return t.Konva.angleDeg?e.Util.radToDeg(x):x},_capitalize(x){return x.charAt(0).toUpperCase()+x.slice(1)},throw(x){throw new Error(f+x)},error(x){console.error(f+x)},warn(x){t.Konva.showWarnings&&console.warn(m+x)},each(x,w){for(const _ in x)w(_,x[_])},_inRange(x,w,_){return w<=x&&x<_},_getProjectionToSegment(x,w,_,S,I,k){let E,j,P;const D=(x-_)*(x-_)+(w-S)*(w-S);if(D==0)E=x,j=w,P=(I-_)*(I-_)+(k-S)*(k-S);else{const O=((I-x)*(_-x)+(k-w)*(S-w))/D;O<0?(E=x,j=w,P=(x-I)*(x-I)+(w-k)*(w-k)):O>1?(E=_,j=S,P=(_-I)*(_-I)+(S-k)*(S-k)):(E=x+O*(_-x),j=w+O*(S-w),P=(E-I)*(E-I)+(j-k)*(j-k))}return[E,j,P]},_getProjectionToLine(x,w,_){const S=e.Util.cloneObject(x);let I=Number.MAX_VALUE;return w.forEach(function(k,E){if(!_&&E===w.length-1)return;const j=w[(E+1)%w.length],P=e.Util._getProjectionToSegment(k.x,k.y,j.x,j.y,x.x,x.y),D=P[0],O=P[1],N=P[2];N<I&&(S.x=D,S.y=O,I=N)}),S},_prepareArrayForTween(x,w,_){const S=[],I=[];if(x.length>w.length){const E=w;w=x,x=E}for(let E=0;E<x.length;E+=2)S.push({x:x[E],y:x[E+1]});for(let E=0;E<w.length;E+=2)I.push({x:w[E],y:w[E+1]});const k=[];return I.forEach(function(E){const j=e.Util._getProjectionToLine(E,S,_);k.push(j.x),k.push(j.y)}),k},_prepareToStringify(x){let w;x.visitedByCircularReferenceRemoval=!0;for(const _ in x)if(x.hasOwnProperty(_)&&x[_]&&typeof x[_]=="object"){if(w=Object.getOwnPropertyDescriptor(x,_),x[_].visitedByCircularReferenceRemoval||e.Util._isElement(x[_]))if(w.configurable)delete x[_];else return null;else if(e.Util._prepareToStringify(x[_])===null)if(w.configurable)delete x[_];else return null}return delete x.visitedByCircularReferenceRemoval,x},_assign(x,w){for(const _ in w)x[_]=w[_];return x},_getFirstPointerId(x){return x.touches?x.changedTouches[0].identifier:x.pointerId||999},releaseCanvas(...x){t.Konva.releaseCanvasOnDestroy&&x.forEach(w=>{w.width=0,w.height=0})},drawRoundedRectPath(x,w,_,S){let I=0,k=0,E=0,j=0;typeof S=="number"?I=k=E=j=Math.min(S,w/2,_/2):(I=Math.min(S[0]||0,w/2,_/2),k=Math.min(S[1]||0,w/2,_/2),j=Math.min(S[2]||0,w/2,_/2),E=Math.min(S[3]||0,w/2,_/2)),x.moveTo(I,0),x.lineTo(w-k,0),x.arc(w-k,k,k,Math.PI*3/2,0,!1),x.lineTo(w,_-j),x.arc(w-j,_-j,j,0,Math.PI/2,!1),x.lineTo(E,_),x.arc(E,_-E,E,Math.PI/2,Math.PI,!1),x.lineTo(0,I),x.arc(I,I,I,Math.PI,Math.PI*3/2,!1)}}}(wI)),wI}var fg={},uc={},hc={},gO;function NZ(){if(gO)return hc;gO=1,Object.defineProperty(hc,"__esModule",{value:!0}),hc.HitContext=hc.SceneContext=hc.Context=void 0;const e=Is(),t=Xt();function n(C){const y=[],x=C.length,w=e.Util;for(let _=0;_<x;_++){let S=C[_];w._isNumber(S)?S=Math.round(S*1e3)/1e3:w._isString(S)||(S=S+""),y.push(S)}return y}const s=",",i="(",o=")",r="([",l="])",c=";",d="()",u="=",p=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],m=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],f=100;let g=class{constructor(y){this.canvas=y,t.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(y){y.fillEnabled()&&this._fill(y)}_fill(y){}strokeShape(y){y.hasStroke()&&this._stroke(y)}_stroke(y){}fillStrokeShape(y){y.attrs.fillAfterStrokeEnabled?(this.strokeShape(y),this.fillShape(y)):(this.fillShape(y),this.strokeShape(y))}getTrace(y,x){let w=this.traceArr,_=w.length,S="",I,k,E,j;for(I=0;I<_;I++)k=w[I],E=k.method,E?(j=k.args,S+=E,y?S+=d:e.Util._isArray(j[0])?S+=r+j.join(s)+l:(x&&(j=j.map(P=>typeof P=="number"?Math.floor(P):P)),S+=i+j.join(s)+o)):(S+=k.property,y||(S+=u+k.val)),S+=c;return S}clearTrace(){this.traceArr=[]}_trace(y){let x=this.traceArr,w;x.push(y),w=x.length,w>=f&&x.shift()}reset(){const y=this.getCanvas().getPixelRatio();this.setTransform(1*y,0,0,1*y,0,0)}getCanvas(){return this.canvas}clear(y){const x=this.getCanvas();y?this.clearRect(y.x||0,y.y||0,y.width||0,y.height||0):this.clearRect(0,0,x.getWidth()/x.pixelRatio,x.getHeight()/x.pixelRatio)}_applyLineCap(y){const x=y.attrs.lineCap;x&&this.setAttr("lineCap",x)}_applyOpacity(y){const x=y.getAbsoluteOpacity();x!==1&&this.setAttr("globalAlpha",x)}_applyLineJoin(y){const x=y.attrs.lineJoin;x&&this.setAttr("lineJoin",x)}setAttr(y,x){this._context[y]=x}arc(y,x,w,_,S,I){this._context.arc(y,x,w,_,S,I)}arcTo(y,x,w,_,S){this._context.arcTo(y,x,w,_,S)}beginPath(){this._context.beginPath()}bezierCurveTo(y,x,w,_,S,I){this._context.bezierCurveTo(y,x,w,_,S,I)}clearRect(y,x,w,_){this._context.clearRect(y,x,w,_)}clip(...y){this._context.clip.apply(this._context,y)}closePath(){this._context.closePath()}createImageData(y,x){const w=arguments;if(w.length===2)return this._context.createImageData(y,x);if(w.length===1)return this._context.createImageData(y)}createLinearGradient(y,x,w,_){return this._context.createLinearGradient(y,x,w,_)}createPattern(y,x){return this._context.createPattern(y,x)}createRadialGradient(y,x,w,_,S,I){return this._context.createRadialGradient(y,x,w,_,S,I)}drawImage(y,x,w,_,S,I,k,E,j){const P=arguments,D=this._context;P.length===3?D.drawImage(y,x,w):P.length===5?D.drawImage(y,x,w,_,S):P.length===9&&D.drawImage(y,x,w,_,S,I,k,E,j)}ellipse(y,x,w,_,S,I,k,E){this._context.ellipse(y,x,w,_,S,I,k,E)}isPointInPath(y,x,w,_){return w?this._context.isPointInPath(w,y,x,_):this._context.isPointInPath(y,x,_)}fill(...y){this._context.fill.apply(this._context,y)}fillRect(y,x,w,_){this._context.fillRect(y,x,w,_)}strokeRect(y,x,w,_){this._context.strokeRect(y,x,w,_)}fillText(y,x,w,_){_?this._context.fillText(y,x,w,_):this._context.fillText(y,x,w)}measureText(y){return this._context.measureText(y)}getImageData(y,x,w,_){return this._context.getImageData(y,x,w,_)}lineTo(y,x){this._context.lineTo(y,x)}moveTo(y,x){this._context.moveTo(y,x)}rect(y,x,w,_){this._context.rect(y,x,w,_)}roundRect(y,x,w,_,S){this._context.roundRect(y,x,w,_,S)}putImageData(y,x,w){this._context.putImageData(y,x,w)}quadraticCurveTo(y,x,w,_){this._context.quadraticCurveTo(y,x,w,_)}restore(){this._context.restore()}rotate(y){this._context.rotate(y)}save(){this._context.save()}scale(y,x){this._context.scale(y,x)}setLineDash(y){this._context.setLineDash?this._context.setLineDash(y):"mozDash"in this._context?this._context.mozDash=y:"webkitLineDash"in this._context&&(this._context.webkitLineDash=y)}getLineDash(){return this._context.getLineDash()}setTransform(y,x,w,_,S,I){this._context.setTransform(y,x,w,_,S,I)}stroke(y){y?this._context.stroke(y):this._context.stroke()}strokeText(y,x,w,_){this._context.strokeText(y,x,w,_)}transform(y,x,w,_,S,I){this._context.transform(y,x,w,_,S,I)}translate(y,x){this._context.translate(y,x)}_enableTrace(){let y=this,x=p.length,w=this.setAttr,_,S;const I=function(k){let E=y[k],j;y[k]=function(){return S=n(Array.prototype.slice.call(arguments,0)),j=E.apply(y,arguments),y._trace({method:k,args:S}),j}};for(_=0;_<x;_++)I(p[_]);y.setAttr=function(){w.apply(y,arguments);const k=arguments[0];let E=arguments[1];(k==="shadowOffsetX"||k==="shadowOffsetY"||k==="shadowBlur")&&(E=E/this.canvas.getPixelRatio()),y._trace({property:k,val:E})}}_applyGlobalCompositeOperation(y){const x=y.attrs.globalCompositeOperation;!x||x==="source-over"||this.setAttr("globalCompositeOperation",x)}};hc.Context=g,m.forEach(function(C){Object.defineProperty(g.prototype,C,{get(){return this._context[C]},set(y){this._context[C]=y}})});class v extends g{constructor(y,{willReadFrequently:x=!1}={}){super(y),this._context=y._canvas.getContext("2d",{willReadFrequently:x})}_fillColor(y){const x=y.fill();this.setAttr("fillStyle",x),y._fillFunc(this)}_fillPattern(y){this.setAttr("fillStyle",y._getFillPattern()),y._fillFunc(this)}_fillLinearGradient(y){const x=y._getLinearGradient();x&&(this.setAttr("fillStyle",x),y._fillFunc(this))}_fillRadialGradient(y){const x=y._getRadialGradient();x&&(this.setAttr("fillStyle",x),y._fillFunc(this))}_fill(y){const x=y.fill(),w=y.getFillPriority();if(x&&w==="color"){this._fillColor(y);return}const _=y.getFillPatternImage();if(_&&w==="pattern"){this._fillPattern(y);return}const S=y.getFillLinearGradientColorStops();if(S&&w==="linear-gradient"){this._fillLinearGradient(y);return}const I=y.getFillRadialGradientColorStops();if(I&&w==="radial-gradient"){this._fillRadialGradient(y);return}x?this._fillColor(y):_?this._fillPattern(y):S?this._fillLinearGradient(y):I&&this._fillRadialGradient(y)}_strokeLinearGradient(y){const x=y.getStrokeLinearGradientStartPoint(),w=y.getStrokeLinearGradientEndPoint(),_=y.getStrokeLinearGradientColorStops(),S=this.createLinearGradient(x.x,x.y,w.x,w.y);if(_){for(let I=0;I<_.length;I+=2)S.addColorStop(_[I],_[I+1]);this.setAttr("strokeStyle",S)}}_stroke(y){const x=y.dash(),w=y.getStrokeScaleEnabled();if(y.hasStroke()){if(!w){this.save();const S=this.getCanvas().getPixelRatio();this.setTransform(S,0,0,S,0,0)}this._applyLineCap(y),x&&y.dashEnabled()&&(this.setLineDash(x),this.setAttr("lineDashOffset",y.dashOffset())),this.setAttr("lineWidth",y.strokeWidth()),y.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),y.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(y):this.setAttr("strokeStyle",y.stroke()),y._strokeFunc(this),w||this.restore()}}_applyShadow(y){var x,w,_;const S=(x=y.getShadowRGBA())!==null&&x!==void 0?x:"black",I=(w=y.getShadowBlur())!==null&&w!==void 0?w:5,k=(_=y.getShadowOffset())!==null&&_!==void 0?_:{x:0,y:0},E=y.getAbsoluteScale(),j=this.canvas.getPixelRatio(),P=E.x*j,D=E.y*j;this.setAttr("shadowColor",S),this.setAttr("shadowBlur",I*Math.min(Math.abs(P),Math.abs(D))),this.setAttr("shadowOffsetX",k.x*P),this.setAttr("shadowOffsetY",k.y*D)}}hc.SceneContext=v;class b extends g{constructor(y){super(y),this._context=y._canvas.getContext("2d",{willReadFrequently:!0})}_fill(y){this.save(),this.setAttr("fillStyle",y.colorKey),y._fillFuncHit(this),this.restore()}strokeShape(y){y.hasHitStroke()&&this._stroke(y)}_stroke(y){if(y.hasHitStroke()){const x=y.getStrokeScaleEnabled();if(!x){this.save();const S=this.getCanvas().getPixelRatio();this.setTransform(S,0,0,S,0,0)}this._applyLineCap(y);const w=y.hitStrokeWidth(),_=w==="auto"?y.strokeWidth():w;this.setAttr("lineWidth",_),this.setAttr("strokeStyle",y.colorKey),y._strokeFuncHit(this),x||this.restore()}}}return hc.HitContext=b,hc}var vO;function W_(){if(vO)return uc;vO=1,Object.defineProperty(uc,"__esModule",{value:!0}),uc.HitCanvas=uc.SceneCanvas=uc.Canvas=void 0;const e=Is(),t=NZ(),n=Xt();let s;function i(){if(s)return s;const c=e.Util.createCanvasElement(),d=c.getContext("2d");return s=function(){const u=n.Konva._global.devicePixelRatio||1,p=d.webkitBackingStorePixelRatio||d.mozBackingStorePixelRatio||d.msBackingStorePixelRatio||d.oBackingStorePixelRatio||d.backingStorePixelRatio||1;return u/p}(),e.Util.releaseCanvas(c),s}let o=class{constructor(d){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const p=(d||{}).pixelRatio||n.Konva.pixelRatio||i();this.pixelRatio=p,this._canvas=e.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(d){const u=this.pixelRatio;this.pixelRatio=d,this.setSize(this.getWidth()/u,this.getHeight()/u)}setWidth(d){this.width=this._canvas.width=d*this.pixelRatio,this._canvas.style.width=d+"px";const u=this.pixelRatio;this.getContext()._context.scale(u,u)}setHeight(d){this.height=this._canvas.height=d*this.pixelRatio,this._canvas.style.height=d+"px";const u=this.pixelRatio;this.getContext()._context.scale(u,u)}getWidth(){return this.width}getHeight(){return this.height}setSize(d,u){this.setWidth(d||0),this.setHeight(u||0)}toDataURL(d,u){try{return this._canvas.toDataURL(d,u)}catch{try{return this._canvas.toDataURL()}catch(m){return e.Util.error("Unable to get data URL. "+m.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};uc.Canvas=o;class r extends o{constructor(d={width:0,height:0,willReadFrequently:!1}){super(d),this.context=new t.SceneContext(this,{willReadFrequently:d.willReadFrequently}),this.setSize(d.width,d.height)}}uc.SceneCanvas=r;class l extends o{constructor(d={width:0,height:0}){super(d),this.hitCanvas=!0,this.context=new t.HitContext(this),this.setSize(d.width,d.height)}}return uc.HitCanvas=l,uc}var _I={},yO;function T4(){return yO||(yO=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DD=void 0;const t=Xt(),n=Is();e.DD={get isDragging(){let s=!1;return e.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(s=!0)}),s},justDragged:!1,get node(){let s;return e.DD._dragElements.forEach(i=>{s=i.node}),s},_dragElements:new Map,_drag(s){const i=[];e.DD._dragElements.forEach((o,r)=>{const{node:l}=o,c=l.getStage();c.setPointersPositions(s),o.pointerId===void 0&&(o.pointerId=n.Util._getFirstPointerId(s));const d=c._changedPointerPositions.find(u=>u.id===o.pointerId);if(d){if(o.dragStatus!=="dragging"){const u=l.dragDistance();if(Math.max(Math.abs(d.x-o.startPointerPos.x),Math.abs(d.y-o.startPointerPos.y))<u||(l.startDrag({evt:s}),!l.isDragging()))return}l._setDragPosition(s,o),i.push(l)}}),i.forEach(o=>{o.fire("dragmove",{type:"dragmove",target:o,evt:s},!0)})},_endDragBefore(s){const i=[];e.DD._dragElements.forEach(o=>{const{node:r}=o,l=r.getStage();if(s&&l.setPointersPositions(s),!l._changedPointerPositions.find(u=>u.id===o.pointerId))return;(o.dragStatus==="dragging"||o.dragStatus==="stopped")&&(e.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,o.dragStatus="stopped");const d=o.node.getLayer()||o.node instanceof t.Konva.Stage&&o.node;d&&i.indexOf(d)===-1&&i.push(d)}),i.forEach(o=>{o.draw()})},_endDragAfter(s){e.DD._dragElements.forEach((i,o)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:s},!0),i.dragStatus!=="dragging"&&e.DD._dragElements.delete(o)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",e.DD._endDragBefore,!0),window.addEventListener("touchend",e.DD._endDragBefore,!0),window.addEventListener("touchcancel",e.DD._endDragBefore,!0),window.addEventListener("mousemove",e.DD._drag),window.addEventListener("touchmove",e.DD._drag),window.addEventListener("mouseup",e.DD._endDragAfter,!1),window.addEventListener("touchend",e.DD._endDragAfter,!1),window.addEventListener("touchcancel",e.DD._endDragAfter,!1))}(_I)),_I}var SI={},Ro={},bO;function nn(){if(bO)return Ro;bO=1,Object.defineProperty(Ro,"__esModule",{value:!0}),Ro.RGBComponent=s,Ro.alphaComponent=i,Ro.getNumberValidator=o,Ro.getNumberOrArrayOfNumbersValidator=r,Ro.getNumberOrAutoValidator=l,Ro.getStringValidator=c,Ro.getStringOrGradientValidator=d,Ro.getFunctionValidator=u,Ro.getNumberArrayValidator=p,Ro.getBooleanValidator=m,Ro.getComponentValidator=f;const e=Xt(),t=Is();function n(g){return t.Util._isString(g)?'"'+g+'"':Object.prototype.toString.call(g)==="[object Number]"||t.Util._isBoolean(g)?g:Object.prototype.toString.call(g)}function s(g){return g>255?255:g<0?0:Math.round(g)}function i(g){return g>1?1:g<1e-4?1e-4:g}function o(){if(e.Konva.isUnminified)return function(g,v){return t.Util._isNumber(g)||t.Util.warn(n(g)+' is a not valid value for "'+v+'" attribute. The value should be a number.'),g}}function r(g){if(e.Konva.isUnminified)return function(v,b){let C=t.Util._isNumber(v),y=t.Util._isArray(v)&&v.length==g;return!C&&!y&&t.Util.warn(n(v)+' is a not valid value for "'+b+'" attribute. The value should be a number or Array<number>('+g+")"),v}}function l(){if(e.Konva.isUnminified)return function(g,v){return t.Util._isNumber(g)||g==="auto"||t.Util.warn(n(g)+' is a not valid value for "'+v+'" attribute. The value should be a number or "auto".'),g}}function c(){if(e.Konva.isUnminified)return function(g,v){return t.Util._isString(g)||t.Util.warn(n(g)+' is a not valid value for "'+v+'" attribute. The value should be a string.'),g}}function d(){if(e.Konva.isUnminified)return function(g,v){const b=t.Util._isString(g),C=Object.prototype.toString.call(g)==="[object CanvasGradient]"||g&&g.addColorStop;return b||C||t.Util.warn(n(g)+' is a not valid value for "'+v+'" attribute. The value should be a string or a native gradient.'),g}}function u(){if(e.Konva.isUnminified)return function(g,v){return t.Util._isFunction(g)||t.Util.warn(n(g)+' is a not valid value for "'+v+'" attribute. The value should be a function.'),g}}function p(){if(e.Konva.isUnminified)return function(g,v){const b=Int8Array?Object.getPrototypeOf(Int8Array):null;return b&&g instanceof b||(t.Util._isArray(g)?g.forEach(function(C){t.Util._isNumber(C)||t.Util.warn('"'+v+'" attribute has non numeric element '+C+". Make sure that all elements are numbers.")}):t.Util.warn(n(g)+' is a not valid value for "'+v+'" attribute. The value should be a array of numbers.')),g}}function m(){if(e.Konva.isUnminified)return function(g,v){return g===!0||g===!1||t.Util.warn(n(g)+' is a not valid value for "'+v+'" attribute. The value should be a boolean.'),g}}function f(g){if(e.Konva.isUnminified)return function(v,b){return v==null||t.Util.isObject(v)||t.Util.warn(n(v)+' is a not valid value for "'+b+'" attribute. The value should be an object with properties '+g),v}}return Ro}var xO;function en(){return xO||(xO=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;const t=Is(),n=nn(),s="get",i="set";e.Factory={addGetterSetter(o,r,l,c,d){e.Factory.addGetter(o,r,l),e.Factory.addSetter(o,r,c,d),e.Factory.addOverloadedGetterSetter(o,r)},addGetter(o,r,l){const c=s+t.Util._capitalize(r);o.prototype[c]=o.prototype[c]||function(){const d=this.attrs[r];return d===void 0?l:d}},addSetter(o,r,l,c){const d=i+t.Util._capitalize(r);o.prototype[d]||e.Factory.overWriteSetter(o,r,l,c)},overWriteSetter(o,r,l,c){const d=i+t.Util._capitalize(r);o.prototype[d]=function(u){return l&&u!==void 0&&u!==null&&(u=l.call(this,u,r)),this._setAttr(r,u),c&&c.call(this),this}},addComponentsGetterSetter(o,r,l,c,d){const u=l.length,p=t.Util._capitalize,m=s+p(r),f=i+p(r);o.prototype[m]=function(){const v={};for(let b=0;b<u;b++){const C=l[b];v[C]=this.getAttr(r+p(C))}return v};const g=(0,n.getComponentValidator)(l);o.prototype[f]=function(v){const b=this.attrs[r];c&&(v=c.call(this,v,r)),g&&g.call(this,v,r);for(const C in v)v.hasOwnProperty(C)&&this._setAttr(r+p(C),v[C]);return v||l.forEach(C=>{this._setAttr(r+p(C),void 0)}),this._fireChangeEvent(r,b,v),d&&d.call(this),this},e.Factory.addOverloadedGetterSetter(o,r)},addOverloadedGetterSetter(o,r){const l=t.Util._capitalize(r),c=i+l,d=s+l;o.prototype[r]=function(){return arguments.length?(this[c](arguments[0]),this):this[d]()}},addDeprecatedGetterSetter(o,r,l,c){t.Util.error("Adding deprecated "+r);const d=s+t.Util._capitalize(r),u=r+" property is deprecated and will be removed soon. Look at Konva change log for more information.";o.prototype[d]=function(){t.Util.error(u);const p=this.attrs[r];return p===void 0?l:p},e.Factory.addSetter(o,r,c,function(){t.Util.error(u)}),e.Factory.addOverloadedGetterSetter(o,r)},backCompat(o,r){t.Util.each(r,function(l,c){const d=o.prototype[c],u=s+t.Util._capitalize(l),p=i+t.Util._capitalize(l);function m(){d.apply(this,arguments),t.Util.error('"'+l+'" method is deprecated and will be removed soon. Use ""'+c+'" instead.')}o.prototype[l]=m,o.prototype[u]=m,o.prototype[p]=m})},afterSetFilter(){this._filterUpToDate=!1}}}(SI)),SI}var CO;function Rs(){if(CO)return fg;CO=1,Object.defineProperty(fg,"__esModule",{value:!0}),fg.Node=void 0;const e=W_(),t=T4(),n=en(),s=Xt(),i=Is(),o=nn(),r="absoluteOpacity",l="allEventListeners",c="absoluteTransform",d="absoluteScale",u="canvas",p="Change",m="children",f="konva",g="listening",v="mouseenter",b="mouseleave",C="pointerenter",y="pointerleave",x="touchenter",w="touchleave",_="set",S="Shape",I=" ",k="stage",E="transform",j="Stage",P="visible",D=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(I);let O=1;class N{constructor(L){this._id=O++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(L),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(L){(L===E||L===c)&&this._cache.get(L)?this._cache.get(L).dirty=!0:L?this._cache.delete(L):this._cache.clear()}_getCache(L,V){let K=this._cache.get(L);return(K===void 0||(L===E||L===c)&&K.dirty===!0)&&(K=V.call(this),this._cache.set(L,K)),K}_calculate(L,V,K){if(!this._attachedDepsListeners.get(L)){const U=V.map(Z=>Z+"Change.konva").join(I);this.on(U,()=>{this._clearCache(L)}),this._attachedDepsListeners.set(L,!0)}return this._getCache(L,K)}_getCanvasCache(){return this._cache.get(u)}_clearSelfAndDescendantCache(L){this._clearCache(L),L===c&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(u)){const{scene:L,filter:V,hit:K,buffer:U}=this._cache.get(u);i.Util.releaseCanvas(L,V,K,U),this._cache.delete(u)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(L){const V=L||{};let K={};(V.x===void 0||V.y===void 0||V.width===void 0||V.height===void 0)&&(K=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let U=Math.ceil(V.width||K.width),Z=Math.ceil(V.height||K.height),W=V.pixelRatio,R=V.x===void 0?Math.floor(K.x):V.x,G=V.y===void 0?Math.floor(K.y):V.y,H=V.offset||0,$=V.drawBorder||!1,z=V.hitCanvasPixelRatio||1;if(!U||!Z){i.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const B=Math.abs(Math.round(K.x)-R)>.5?1:0,Y=Math.abs(Math.round(K.y)-G)>.5?1:0;U+=H*2+B,Z+=H*2+Y,R-=H,G-=H;const ie=new e.SceneCanvas({pixelRatio:W,width:U,height:Z}),ge=new e.SceneCanvas({pixelRatio:W,width:0,height:0,willReadFrequently:!0}),xe=new e.HitCanvas({pixelRatio:z,width:U,height:Z}),we=ie.getContext(),je=xe.getContext(),Re=new e.SceneCanvas({width:ie.width/ie.pixelRatio+Math.abs(R),height:ie.height/ie.pixelRatio+Math.abs(G),pixelRatio:ie.pixelRatio}),Ct=Re.getContext();return xe.isCache=!0,ie.isCache=!0,this._cache.delete(u),this._filterUpToDate=!1,V.imageSmoothingEnabled===!1&&(ie.getContext()._context.imageSmoothingEnabled=!1,ge.getContext()._context.imageSmoothingEnabled=!1),we.save(),je.save(),Ct.save(),we.translate(-R,-G),je.translate(-R,-G),Ct.translate(-R,-G),Re.x=R,Re.y=G,this._isUnderCache=!0,this._clearSelfAndDescendantCache(r),this._clearSelfAndDescendantCache(d),this.drawScene(ie,this,Re),this.drawHit(xe,this),this._isUnderCache=!1,we.restore(),je.restore(),$&&(we.save(),we.beginPath(),we.rect(0,0,U,Z),we.closePath(),we.setAttr("strokeStyle","red"),we.setAttr("lineWidth",5),we.stroke(),we.restore()),this._cache.set(u,{scene:ie,filter:ge,hit:xe,buffer:Re,x:R,y:G}),this._requestDraw(),this}isCached(){return this._cache.has(u)}getClientRect(L){throw new Error('abstract "getClientRect" method call')}_transformedRect(L,V){const K=[{x:L.x,y:L.y},{x:L.x+L.width,y:L.y},{x:L.x+L.width,y:L.y+L.height},{x:L.x,y:L.y+L.height}];let U=1/0,Z=1/0,W=-1/0,R=-1/0;const G=this.getAbsoluteTransform(V);return K.forEach(function(H){const $=G.point(H);U===void 0&&(U=W=$.x,Z=R=$.y),U=Math.min(U,$.x),Z=Math.min(Z,$.y),W=Math.max(W,$.x),R=Math.max(R,$.y)}),{x:U,y:Z,width:W-U,height:R-Z}}_drawCachedSceneCanvas(L){L.save(),L._applyOpacity(this),L._applyGlobalCompositeOperation(this);const V=this._getCanvasCache();L.translate(V.x,V.y);const K=this._getCachedSceneCanvas(),U=K.pixelRatio;L.drawImage(K._canvas,0,0,K.width/U,K.height/U),L.restore()}_drawCachedHitCanvas(L){const V=this._getCanvasCache(),K=V.hit;L.save(),L.translate(V.x,V.y),L.drawImage(K._canvas,0,0,K.width/K.pixelRatio,K.height/K.pixelRatio),L.restore()}_getCachedSceneCanvas(){let L=this.filters(),V=this._getCanvasCache(),K=V.scene,U=V.filter,Z=U.getContext(),W,R,G,H;if(L){if(!this._filterUpToDate){const $=K.pixelRatio;U.setSize(K.width/K.pixelRatio,K.height/K.pixelRatio);try{for(W=L.length,Z.clear(),Z.drawImage(K._canvas,0,0,K.getWidth()/$,K.getHeight()/$),R=Z.getImageData(0,0,U.getWidth(),U.getHeight()),G=0;G<W;G++){if(H=L[G],typeof H!="function"){i.Util.error("Filter should be type of function, but got "+typeof H+" instead. Please check correct filters");continue}H.call(this,R),Z.putImageData(R,0,0)}}catch(z){i.Util.error("Unable to apply filter. "+z.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return U}return K}on(L,V){if(this._cache&&this._cache.delete(l),arguments.length===3)return this._delegate.apply(this,arguments);const K=L.split(I);for(let U=0;U<K.length;U++){const W=K[U].split("."),R=W[0],G=W[1]||"";this.eventListeners[R]||(this.eventListeners[R]=[]),this.eventListeners[R].push({name:G,handler:V})}return this}off(L,V){let K=(L||"").split(I),U=K.length,Z,W,R,G,H,$;if(this._cache&&this._cache.delete(l),!L)for(W in this.eventListeners)this._off(W);for(Z=0;Z<U;Z++)if(R=K[Z],G=R.split("."),H=G[0],$=G[1],H)this.eventListeners[H]&&this._off(H,$,V);else for(W in this.eventListeners)this._off(W,$,V);return this}dispatchEvent(L){const V={target:this,type:L.type,evt:L};return this.fire(L.type,V),this}addEventListener(L,V){return this.on(L,function(K){V.call(this,K.evt)}),this}removeEventListener(L){return this.off(L),this}_delegate(L,V,K){const U=this;this.on(L,function(Z){const W=Z.target.findAncestors(V,!0,U);for(let R=0;R<W.length;R++)Z=i.Util.cloneObject(Z),Z.currentTarget=W[R],K.call(W[R],Z)})}remove(){return this.isDragging()&&this.stopDrag(),t.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(r),this._clearSelfAndDescendantCache(d),this._clearSelfAndDescendantCache(k),this._clearSelfAndDescendantCache(P),this._clearSelfAndDescendantCache(g)}_remove(){this._clearCaches();const L=this.getParent();L&&L.children&&(L.children.splice(this.index,1),L._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(L){const V="get"+i.Util._capitalize(L);return i.Util._isFunction(this[V])?this[V]():this.attrs[L]}getAncestors(){let L=this.getParent(),V=[];for(;L;)V.push(L),L=L.getParent();return V}getAttrs(){return this.attrs||{}}setAttrs(L){return this._batchTransformChanges(()=>{let V,K;if(!L)return this;for(V in L)V!==m&&(K=_+i.Util._capitalize(V),i.Util._isFunction(this[K])?this[K](L[V]):this._setAttr(V,L[V]))}),this}isListening(){return this._getCache(g,this._isListening)}_isListening(L){if(!this.listening())return!1;const K=this.getParent();return K&&K!==L&&this!==L?K._isListening(L):!0}isVisible(){return this._getCache(P,this._isVisible)}_isVisible(L){if(!this.visible())return!1;const K=this.getParent();return K&&K!==L&&this!==L?K._isVisible(L):!0}shouldDrawHit(L,V=!1){if(L)return this._isVisible(L)&&this._isListening(L);const K=this.getLayer();let U=!1;t.DD._dragElements.forEach(W=>{W.dragStatus==="dragging"&&(W.node.nodeType==="Stage"||W.node.getLayer()===K)&&(U=!0)});const Z=!V&&!s.Konva.hitOnDragEnabled&&(U||s.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!Z}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let L=this.getDepth(),V=this,K=0,U,Z,W,R;function G($){for(U=[],Z=$.length,W=0;W<Z;W++)R=$[W],K++,R.nodeType!==S&&(U=U.concat(R.getChildren().slice())),R._id===V._id&&(W=Z);U.length>0&&U[0].getDepth()<=L&&G(U)}const H=this.getStage();return V.nodeType!==j&&H&&G(H.getChildren()),K}getDepth(){let L=0,V=this.parent;for(;V;)L++,V=V.parent;return L}_batchTransformChanges(L){this._batchingTransformChange=!0,L(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(E),this._clearSelfAndDescendantCache(c)),this._needClearTransformCache=!1}setPosition(L){return this._batchTransformChanges(()=>{this.x(L.x),this.y(L.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const L=this.getStage();if(!L)return null;const V=L.getPointerPosition();if(!V)return null;const K=this.getAbsoluteTransform().copy();return K.invert(),K.point(V)}getAbsolutePosition(L){let V=!1,K=this.parent;for(;K;){if(K.isCached()){V=!0;break}K=K.parent}V&&!L&&(L=!0);const U=this.getAbsoluteTransform(L).getMatrix(),Z=new i.Transform,W=this.offset();return Z.m=U.slice(),Z.translate(W.x,W.y),Z.getTranslation()}setAbsolutePosition(L){const{x:V,y:K,...U}=this._clearTransform();this.attrs.x=V,this.attrs.y=K,this._clearCache(E);const Z=this._getAbsoluteTransform().copy();return Z.invert(),Z.translate(L.x,L.y),L={x:this.attrs.x+Z.getTranslation().x,y:this.attrs.y+Z.getTranslation().y},this._setTransform(U),this.setPosition({x:L.x,y:L.y}),this._clearCache(E),this._clearSelfAndDescendantCache(c),this}_setTransform(L){let V;for(V in L)this.attrs[V]=L[V]}_clearTransform(){const L={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,L}move(L){let V=L.x,K=L.y,U=this.x(),Z=this.y();return V!==void 0&&(U+=V),K!==void 0&&(Z+=K),this.setPosition({x:U,y:Z}),this}_eachAncestorReverse(L,V){let K=[],U=this.getParent(),Z,W;if(!(V&&V._id===this._id)){for(K.unshift(this);U&&(!V||U._id!==V._id);)K.unshift(U),U=U.parent;for(Z=K.length,W=0;W<Z;W++)L(K[W])}}rotate(L){return this.rotation(this.rotation()+L),this}moveToTop(){if(!this.parent)return i.Util.warn("Node has no parent. moveToTop function is ignored."),!1;const L=this.index,V=this.parent.getChildren().length;return L<V-1?(this.parent.children.splice(L,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return i.Util.warn("Node has no parent. moveUp function is ignored."),!1;const L=this.index,V=this.parent.getChildren().length;return L<V-1?(this.parent.children.splice(L,1),this.parent.children.splice(L+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return i.Util.warn("Node has no parent. moveDown function is ignored."),!1;const L=this.index;return L>0?(this.parent.children.splice(L,1),this.parent.children.splice(L-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return i.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;const L=this.index;return L>0?(this.parent.children.splice(L,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(L){if(!this.parent)return i.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(L<0||L>=this.parent.children.length)&&i.Util.warn("Unexpected value "+L+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const V=this.index;return this.parent.children.splice(V,1),this.parent.children.splice(L,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(r,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let L=this.opacity();const V=this.getParent();return V&&!V._isUnderCache&&(L*=V.getAbsoluteOpacity()),L}moveTo(L){return this.getParent()!==L&&(this._remove(),L.add(this)),this}toObject(){let L=this.getAttrs(),V,K,U,Z,W;const R={attrs:{},className:this.getClassName()};for(V in L)K=L[V],W=i.Util.isObject(K)&&!i.Util._isPlainObject(K)&&!i.Util._isArray(K),!W&&(U=typeof this[V]=="function"&&this[V],delete L[V],Z=U?U.call(this):null,L[V]=K,Z!==K&&(R.attrs[V]=K));return i.Util._prepareToStringify(R)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(L,V,K){const U=[];V&&this._isMatch(L)&&U.push(this);let Z=this.parent;for(;Z;){if(Z===K)return U;Z._isMatch(L)&&U.push(Z),Z=Z.parent}return U}isAncestorOf(L){return!1}findAncestor(L,V,K){return this.findAncestors(L,V,K)[0]}_isMatch(L){if(!L)return!1;if(typeof L=="function")return L(this);let V=L.replace(/ /g,"").split(","),K=V.length,U,Z;for(U=0;U<K;U++)if(Z=V[U],i.Util.isValidSelector(Z)||(i.Util.warn('Selector "'+Z+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),i.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),i.Util.warn("Konva is awesome, right?")),Z.charAt(0)==="#"){if(this.id()===Z.slice(1))return!0}else if(Z.charAt(0)==="."){if(this.hasName(Z.slice(1)))return!0}else if(this.className===Z||this.nodeType===Z)return!0;return!1}getLayer(){const L=this.getParent();return L?L.getLayer():null}getStage(){return this._getCache(k,this._getStage)}_getStage(){const L=this.getParent();return L?L.getStage():null}fire(L,V={},K){return V.target=V.target||this,K?this._fireAndBubble(L,V):this._fire(L,V),this}getAbsoluteTransform(L){return L?this._getAbsoluteTransform(L):this._getCache(c,this._getAbsoluteTransform)}_getAbsoluteTransform(L){let V;if(L)return V=new i.Transform,this._eachAncestorReverse(function(K){const U=K.transformsEnabled();U==="all"?V.multiply(K.getTransform()):U==="position"&&V.translate(K.x()-K.offsetX(),K.y()-K.offsetY())},L),V;{V=this._cache.get(c)||new i.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(V):V.reset();const K=this.transformsEnabled();if(K==="all")V.multiply(this.getTransform());else if(K==="position"){const U=this.attrs.x||0,Z=this.attrs.y||0,W=this.attrs.offsetX||0,R=this.attrs.offsetY||0;V.translate(U-W,Z-R)}return V.dirty=!1,V}}getAbsoluteScale(L){let V=this;for(;V;)V._isUnderCache&&(L=V),V=V.getParent();const U=this.getAbsoluteTransform(L).decompose();return{x:U.scaleX,y:U.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(E,this._getTransform)}_getTransform(){var L,V;const K=this._cache.get(E)||new i.Transform;K.reset();const U=this.x(),Z=this.y(),W=s.Konva.getAngle(this.rotation()),R=(L=this.attrs.scaleX)!==null&&L!==void 0?L:1,G=(V=this.attrs.scaleY)!==null&&V!==void 0?V:1,H=this.attrs.skewX||0,$=this.attrs.skewY||0,z=this.attrs.offsetX||0,B=this.attrs.offsetY||0;return(U!==0||Z!==0)&&K.translate(U,Z),W!==0&&K.rotate(W),(H!==0||$!==0)&&K.skew(H,$),(R!==1||G!==1)&&K.scale(R,G),(z!==0||B!==0)&&K.translate(-1*z,-1*B),K.dirty=!1,K}clone(L){let V=i.Util.cloneObject(this.attrs),K,U,Z,W,R;for(K in L)V[K]=L[K];const G=new this.constructor(V);for(K in this.eventListeners)for(U=this.eventListeners[K],Z=U.length,W=0;W<Z;W++)R=U[W],R.name.indexOf(f)<0&&(G.eventListeners[K]||(G.eventListeners[K]=[]),G.eventListeners[K].push(R));return G}_toKonvaCanvas(L){L=L||{};const V=this.getClientRect(),K=this.getStage(),U=L.x!==void 0?L.x:Math.floor(V.x),Z=L.y!==void 0?L.y:Math.floor(V.y),W=L.pixelRatio||1,R=new e.SceneCanvas({width:L.width||Math.ceil(V.width)||(K?K.width():0),height:L.height||Math.ceil(V.height)||(K?K.height():0),pixelRatio:W}),G=R.getContext(),H=new e.SceneCanvas({width:R.width/R.pixelRatio+Math.abs(U),height:R.height/R.pixelRatio+Math.abs(Z),pixelRatio:R.pixelRatio});return L.imageSmoothingEnabled===!1&&(G._context.imageSmoothingEnabled=!1),G.save(),(U||Z)&&G.translate(-1*U,-1*Z),this.drawScene(R,void 0,H),G.restore(),R}toCanvas(L){return this._toKonvaCanvas(L)._canvas}toDataURL(L){L=L||{};const V=L.mimeType||null,K=L.quality||null,U=this._toKonvaCanvas(L).toDataURL(V,K);return L.callback&&L.callback(U),U}toImage(L){return new Promise((V,K)=>{try{const U=L?.callback;U&&delete L.callback,i.Util._urlToImage(this.toDataURL(L),function(Z){V(Z),U?.(Z)})}catch(U){K(U)}})}toBlob(L){return new Promise((V,K)=>{try{const U=L?.callback;U&&delete L.callback,this.toCanvas(L).toBlob(Z=>{V(Z),U?.(Z)},L?.mimeType,L?.quality)}catch(U){K(U)}})}setSize(L){return this.width(L.width),this.height(L.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():s.Konva.dragDistance}_off(L,V,K){let U=this.eventListeners[L],Z,W,R;for(Z=0;Z<U.length;Z++)if(W=U[Z].name,R=U[Z].handler,(W!=="konva"||V==="konva")&&(!V||W===V)&&(!K||K===R)){if(U.splice(Z,1),U.length===0){delete this.eventListeners[L];break}Z--}}_fireChangeEvent(L,V,K){this._fire(L+p,{oldVal:V,newVal:K})}addName(L){if(!this.hasName(L)){const V=this.name(),K=V?V+" "+L:L;this.name(K)}return this}hasName(L){if(!L)return!1;const V=this.name();return V?(V||"").split(/\s/g).indexOf(L)!==-1:!1}removeName(L){const V=(this.name()||"").split(/\s/g),K=V.indexOf(L);return K!==-1&&(V.splice(K,1),this.name(V.join(" "))),this}setAttr(L,V){const K=this[_+i.Util._capitalize(L)];return i.Util._isFunction(K)?K.call(this,V):this._setAttr(L,V),this}_requestDraw(){if(s.Konva.autoDrawEnabled){const L=this.getLayer()||this.getStage();L?.batchDraw()}}_setAttr(L,V){const K=this.attrs[L];K===V&&!i.Util.isObject(V)||(V==null?delete this.attrs[L]:this.attrs[L]=V,this._shouldFireChangeEvents&&this._fireChangeEvent(L,K,V),this._requestDraw())}_setComponentAttr(L,V,K){let U;K!==void 0&&(U=this.attrs[L],U||(this.attrs[L]=this.getAttr(L)),this.attrs[L][V]=K,this._fireChangeEvent(L,U,K))}_fireAndBubble(L,V,K){V&&this.nodeType===S&&(V.target=this);const U=[v,b,C,y,x,w];if(!(U.indexOf(L)!==-1&&(K&&(this===K||this.isAncestorOf&&this.isAncestorOf(K))||this.nodeType==="Stage"&&!K))){this._fire(L,V);const W=U.indexOf(L)!==-1&&K&&K.isAncestorOf&&K.isAncestorOf(this)&&!K.isAncestorOf(this.parent);(V&&!V.cancelBubble||!V)&&this.parent&&this.parent.isListening()&&!W&&(K&&K.parent?this._fireAndBubble.call(this.parent,L,V,K):this._fireAndBubble.call(this.parent,L,V))}}_getProtoListeners(L){var V,K,U;const Z=(V=this._cache.get(l))!==null&&V!==void 0?V:{};let W=Z?.[L];if(W===void 0){W=[];let R=Object.getPrototypeOf(this);for(;R;){const G=(U=(K=R.eventListeners)===null||K===void 0?void 0:K[L])!==null&&U!==void 0?U:[];W.push(...G),R=Object.getPrototypeOf(R)}Z[L]=W,this._cache.set(l,Z)}return W}_fire(L,V){V=V||{},V.currentTarget=this,V.type=L;const K=this._getProtoListeners(L);if(K)for(let Z=0;Z<K.length;Z++)K[Z].handler.call(this,V);const U=this.eventListeners[L];if(U)for(let Z=0;Z<U.length;Z++)U[Z].handler.call(this,V)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(L){const V=L?L.pointerId:void 0,K=this.getStage(),U=this.getAbsolutePosition();if(!K)return;const Z=K._getPointerById(V)||K._changedPointerPositions[0]||U;t.DD._dragElements.set(this._id,{node:this,startPointerPos:Z,offset:{x:Z.x-U.x,y:Z.y-U.y},dragStatus:"ready",pointerId:V})}startDrag(L,V=!0){t.DD._dragElements.has(this._id)||this._createDragElement(L);const K=t.DD._dragElements.get(this._id);K.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:L&&L.evt},V)}_setDragPosition(L,V){const K=this.getStage()._getPointerById(V.pointerId);if(!K)return;let U={x:K.x-V.offset.x,y:K.y-V.offset.y};const Z=this.dragBoundFunc();if(Z!==void 0){const W=Z.call(this,U,L);W?U=W:i.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==U.x||this._lastPos.y!==U.y)&&(this.setAbsolutePosition(U),this._requestDraw()),this._lastPos=U}stopDrag(L){const V=t.DD._dragElements.get(this._id);V&&(V.dragStatus="stopped"),t.DD._endDragBefore(L),t.DD._endDragAfter(L)}setDraggable(L){this._setAttr("draggable",L),this._dragChange()}isDragging(){const L=t.DD._dragElements.get(this._id);return L?L.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(L){if(!(!(L.evt.button!==void 0)||s.Konva.dragButtons.indexOf(L.evt.button)>=0)||this.isDragging())return;let U=!1;t.DD._dragElements.forEach(Z=>{this.isAncestorOf(Z.node)&&(U=!0)}),U||this._createDragElement(L)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const V=t.DD._dragElements.get(this._id),K=V&&V.dragStatus==="dragging",U=V&&V.dragStatus==="ready";K?this.stopDrag():U&&t.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(L={x:0,y:0}){const V=this.getStage();if(!V)return!1;const K={x:-L.x,y:-L.y,width:V.width()+2*L.x,height:V.height()+2*L.y};return i.Util.haveIntersection(K,this.getClientRect())}static create(L,V){return i.Util._isString(L)&&(L=JSON.parse(L)),this._createNode(L,V)}static _createNode(L,V){let K=N.prototype.getClassName.call(L),U=L.children,Z,W,R;V&&(L.attrs.container=V),s.Konva[K]||(i.Util.warn('Can not find a node with class name "'+K+'". Fallback to "Shape".'),K="Shape");const G=s.Konva[K];if(Z=new G(L.attrs),U)for(W=U.length,R=0;R<W;R++)Z.add(N._createNode(U[R]));return Z}}fg.Node=N,N.prototype.nodeType="Node",N.prototype._attrsAffectingSize=[],N.prototype.eventListeners={},N.prototype.on.call(N.prototype,D,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(E),this._clearSelfAndDescendantCache(c)}),N.prototype.on.call(N.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(P)}),N.prototype.on.call(N.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(g)}),N.prototype.on.call(N.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(r)});const F=n.Factory.addGetterSetter;return F(N,"zIndex"),F(N,"absolutePosition"),F(N,"position"),F(N,"x",0,(0,o.getNumberValidator)()),F(N,"y",0,(0,o.getNumberValidator)()),F(N,"globalCompositeOperation","source-over",(0,o.getStringValidator)()),F(N,"opacity",1,(0,o.getNumberValidator)()),F(N,"name","",(0,o.getStringValidator)()),F(N,"id","",(0,o.getStringValidator)()),F(N,"rotation",0,(0,o.getNumberValidator)()),n.Factory.addComponentsGetterSetter(N,"scale",["x","y"]),F(N,"scaleX",1,(0,o.getNumberValidator)()),F(N,"scaleY",1,(0,o.getNumberValidator)()),n.Factory.addComponentsGetterSetter(N,"skew",["x","y"]),F(N,"skewX",0,(0,o.getNumberValidator)()),F(N,"skewY",0,(0,o.getNumberValidator)()),n.Factory.addComponentsGetterSetter(N,"offset",["x","y"]),F(N,"offsetX",0,(0,o.getNumberValidator)()),F(N,"offsetY",0,(0,o.getNumberValidator)()),F(N,"dragDistance",void 0,(0,o.getNumberValidator)()),F(N,"width",0,(0,o.getNumberValidator)()),F(N,"height",0,(0,o.getNumberValidator)()),F(N,"listening",!0,(0,o.getBooleanValidator)()),F(N,"preventDefault",!0,(0,o.getBooleanValidator)()),F(N,"filters",void 0,function(X){return this._filterUpToDate=!1,X}),F(N,"visible",!0,(0,o.getBooleanValidator)()),F(N,"transformsEnabled","all",(0,o.getStringValidator)()),F(N,"size"),F(N,"dragBoundFunc"),F(N,"draggable",!1,(0,o.getBooleanValidator)()),n.Factory.backCompat(N,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),fg}var mg={},wO;function U_(){if(wO)return mg;wO=1,Object.defineProperty(mg,"__esModule",{value:!0}),mg.Container=void 0;const e=en(),t=Rs(),n=nn();let s=class extends t.Node{constructor(){super(...arguments),this.children=[]}getChildren(o){const r=this.children||[];return o?r.filter(o):r}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(o=>{o.parent=null,o.index=0,o.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(o=>{o.parent=null,o.index=0,o.destroy()}),this.children=[],this._requestDraw(),this}add(...o){if(o.length===0)return this;if(o.length>1){for(let l=0;l<o.length;l++)this.add(o[l]);return this}const r=o[0];return r.getParent()?(r.moveTo(this),this):(this._validateAdd(r),r.index=this.getChildren().length,r.parent=this,r._clearCaches(),this.getChildren().push(r),this._fire("add",{child:r}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(o){return this._generalFind(o,!1)}findOne(o){const r=this._generalFind(o,!0);return r.length>0?r[0]:void 0}_generalFind(o,r){const l=[];return this._descendants(c=>{const d=c._isMatch(o);return d&&l.push(c),!!(d&&r)}),l}_descendants(o){let r=!1;const l=this.getChildren();for(const c of l){if(r=o(c),r)return!0;if(c.hasChildren()&&(r=c._descendants(o),r))return!0}return!1}toObject(){const o=t.Node.prototype.toObject.call(this);return o.children=[],this.getChildren().forEach(r=>{o.children.push(r.toObject())}),o}isAncestorOf(o){let r=o.getParent();for(;r;){if(r._id===this._id)return!0;r=r.getParent()}return!1}clone(o){const r=t.Node.prototype.clone.call(this,o);return this.getChildren().forEach(function(l){r.add(l.clone())}),r}getAllIntersections(o){const r=[];return this.find("Shape").forEach(l=>{l.isVisible()&&l.intersects(o)&&r.push(l)}),r}_clearSelfAndDescendantCache(o){var r;super._clearSelfAndDescendantCache(o),!this.isCached()&&((r=this.children)===null||r===void 0||r.forEach(function(l){l._clearSelfAndDescendantCache(o)}))}_setChildrenIndices(){var o;(o=this.children)===null||o===void 0||o.forEach(function(r,l){r.index=l}),this._requestDraw()}drawScene(o,r,l){const c=this.getLayer(),d=o||c&&c.getCanvas(),u=d&&d.getContext(),p=this._getCanvasCache(),m=p&&p.scene,f=d&&d.isCache;if(!this.isVisible()&&!f)return this;if(m){u.save();const g=this.getAbsoluteTransform(r).getMatrix();u.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._drawCachedSceneCanvas(u),u.restore()}else this._drawChildren("drawScene",d,r,l);return this}drawHit(o,r){if(!this.shouldDrawHit(r))return this;const l=this.getLayer(),c=o||l&&l.hitCanvas,d=c&&c.getContext(),u=this._getCanvasCache();if(u&&u.hit){d.save();const m=this.getAbsoluteTransform(r).getMatrix();d.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this._drawCachedHitCanvas(d),d.restore()}else this._drawChildren("drawHit",c,r);return this}_drawChildren(o,r,l,c){var d;const u=r&&r.getContext(),p=this.clipWidth(),m=this.clipHeight(),f=this.clipFunc(),g=typeof p=="number"&&typeof m=="number"||f,v=l===this;if(g){u.save();const C=this.getAbsoluteTransform(l);let y=C.getMatrix();u.transform(y[0],y[1],y[2],y[3],y[4],y[5]),u.beginPath();let x;if(f)x=f.call(this,u,this);else{const w=this.clipX(),_=this.clipY();u.rect(w||0,_||0,p,m)}u.clip.apply(u,x),y=C.copy().invert().getMatrix(),u.transform(y[0],y[1],y[2],y[3],y[4],y[5])}const b=!v&&this.globalCompositeOperation()!=="source-over"&&o==="drawScene";b&&(u.save(),u._applyGlobalCompositeOperation(this)),(d=this.children)===null||d===void 0||d.forEach(function(C){C[o](r,l,c)}),b&&u.restore(),g&&u.restore()}getClientRect(o={}){var r;const l=o.skipTransform,c=o.relativeTo;let d,u,p,m,f={x:1/0,y:1/0,width:0,height:0};const g=this;(r=this.children)===null||r===void 0||r.forEach(function(C){if(!C.visible())return;const y=C.getClientRect({relativeTo:g,skipShadow:o.skipShadow,skipStroke:o.skipStroke});y.width===0&&y.height===0||(d===void 0?(d=y.x,u=y.y,p=y.x+y.width,m=y.y+y.height):(d=Math.min(d,y.x),u=Math.min(u,y.y),p=Math.max(p,y.x+y.width),m=Math.max(m,y.y+y.height)))});const v=this.find("Shape");let b=!1;for(let C=0;C<v.length;C++)if(v[C]._isVisible(this)){b=!0;break}return b&&d!==void 0?f={x:d,y:u,width:p-d,height:m-u}:f={x:0,y:0,width:0,height:0},l?f:this._transformedRect(f,c)}};return mg.Container=s,e.Factory.addComponentsGetterSetter(s,"clip",["x","y","width","height"]),e.Factory.addGetterSetter(s,"clipX",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipY",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipWidth",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipHeight",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipFunc"),mg}var kI={},ld={},_O;function FZ(){if(_O)return ld;_O=1,Object.defineProperty(ld,"__esModule",{value:!0}),ld.getCapturedShape=s,ld.createEvent=i,ld.hasPointerCapture=o,ld.setPointerCapture=r,ld.releaseCapture=l;const e=Xt(),t=new Map,n=e.Konva._global.PointerEvent!==void 0;function s(c){return t.get(c)}function i(c){return{evt:c,pointerId:c.pointerId}}function o(c,d){return t.get(c)===d}function r(c,d){l(c),d.getStage()&&(t.set(c,d),n&&d._fire("gotpointercapture",i(new PointerEvent("gotpointercapture"))))}function l(c,d){const u=t.get(c);if(!u)return;const p=u.getStage();p&&p.content,t.delete(c),n&&u._fire("lostpointercapture",i(new PointerEvent("lostpointercapture")))}return ld}var SO;function QPe(){return SO||(SO=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Stage=e.stages=void 0;const t=Is(),n=en(),s=U_(),i=Xt(),o=W_(),r=T4(),l=Xt(),c=FZ(),d="Stage",u="string",p="px",m="mouseout",f="mouseleave",g="mouseover",v="mouseenter",b="mousemove",C="mousedown",y="mouseup",x="pointermove",w="pointerdown",_="pointerup",S="pointercancel",I="lostpointercapture",k="pointerout",E="pointerleave",j="pointerover",P="pointerenter",D="contextmenu",O="touchstart",N="touchend",F="touchmove",X="touchcancel",L="wheel",V=5,K=[[v,"_pointerenter"],[C,"_pointerdown"],[b,"_pointermove"],[y,"_pointerup"],[f,"_pointerleave"],[O,"_pointerdown"],[F,"_pointermove"],[N,"_pointerup"],[X,"_pointercancel"],[g,"_pointerover"],[L,"_wheel"],[D,"_contextmenu"],[w,"_pointerdown"],[x,"_pointermove"],[_,"_pointerup"],[S,"_pointercancel"],[E,"_pointerleave"],[I,"_lostpointercapture"]],U={mouse:{[k]:m,[E]:f,[j]:g,[P]:v,[x]:b,[w]:C,[_]:y,[S]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[k]:"touchout",[E]:"touchleave",[j]:"touchover",[P]:"touchenter",[x]:F,[w]:O,[_]:N,[S]:X,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[k]:k,[E]:E,[j]:j,[P]:P,[x]:x,[w]:w,[_]:_,[S]:S,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},Z=$=>$.indexOf("pointer")>=0?"pointer":$.indexOf("touch")>=0?"touch":"mouse",W=$=>{const z=Z($);if(z==="pointer")return i.Konva.pointerEventsEnabled&&U.pointer;if(z==="touch")return U.touch;if(z==="mouse")return U.mouse};function R($={}){return($.clipFunc||$.clipWidth||$.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),$}const G="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";e.stages=[];class H extends s.Container{constructor(z){super(R(z)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),e.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{R(this.attrs)}),this._checkVisibility()}_validateAdd(z){const B=z.getType()==="Layer",Y=z.getType()==="FastLayer";B||Y||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const z=this.visible()?"":"none";this.content.style.display=z}setContainer(z){if(typeof z===u){let B;if(z.charAt(0)==="."){const Y=z.slice(1);z=document.getElementsByClassName(Y)[0]}else z.charAt(0)!=="#"?B=z:B=z.slice(1),z=document.getElementById(B);if(!z)throw"Can not find container in document with id "+B}return this._setAttr("container",z),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),z.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const z=this.children,B=z.length;for(let Y=0;Y<B;Y++)z[Y].clear();return this}clone(z){return z||(z={}),z.container=typeof document<"u"&&document.createElement("div"),s.Container.prototype.clone.call(this,z)}destroy(){super.destroy();const z=this.content;z&&t.Util._isInDocument(z)&&this.container().removeChild(z);const B=e.stages.indexOf(this);return B>-1&&e.stages.splice(B,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const z=this._pointerPositions[0]||this._changedPointerPositions[0];return z?{x:z.x,y:z.y}:(t.Util.warn(G),null)}_getPointerById(z){return this._pointerPositions.find(B=>B.id===z)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(z){z=z||{},z.x=z.x||0,z.y=z.y||0,z.width=z.width||this.width(),z.height=z.height||this.height();const B=new o.SceneCanvas({width:z.width,height:z.height,pixelRatio:z.pixelRatio||1}),Y=B.getContext()._context,ie=this.children;return(z.x||z.y)&&Y.translate(-1*z.x,-1*z.y),ie.forEach(function(ge){if(!ge.isVisible())return;const xe=ge._toKonvaCanvas(z);Y.drawImage(xe._canvas,z.x,z.y,xe.getWidth()/xe.getPixelRatio(),xe.getHeight()/xe.getPixelRatio())}),B}getIntersection(z){if(!z)return null;const B=this.children,Y=B.length,ie=Y-1;for(let ge=ie;ge>=0;ge--){const xe=B[ge].getIntersection(z);if(xe)return xe}return null}_resizeDOM(){const z=this.width(),B=this.height();this.content&&(this.content.style.width=z+p,this.content.style.height=B+p),this.bufferCanvas.setSize(z,B),this.bufferHitCanvas.setSize(z,B),this.children.forEach(Y=>{Y.setSize({width:z,height:B}),Y.draw()})}add(z,...B){if(arguments.length>1){for(let ie=0;ie<arguments.length;ie++)this.add(arguments[ie]);return this}super.add(z);const Y=this.children.length;return Y>V&&t.Util.warn("The stage has "+Y+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),z.setSize({width:this.width(),height:this.height()}),z.draw(),i.Konva.isBrowser&&this.content.appendChild(z.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(z){return c.hasPointerCapture(z,this)}setPointerCapture(z){c.setPointerCapture(z,this)}releaseCapture(z){c.releaseCapture(z,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&K.forEach(([z,B])=>{this.content.addEventListener(z,Y=>{this[B](Y)},{passive:!1})})}_pointerenter(z){this.setPointersPositions(z);const B=W(z.type);B&&this._fire(B.pointerenter,{evt:z,target:this,currentTarget:this})}_pointerover(z){this.setPointersPositions(z);const B=W(z.type);B&&this._fire(B.pointerover,{evt:z,target:this,currentTarget:this})}_getTargetShape(z){let B=this[z+"targetShape"];return B&&!B.getStage()&&(B=null),B}_pointerleave(z){const B=W(z.type),Y=Z(z.type);if(!B)return;this.setPointersPositions(z);const ie=this._getTargetShape(Y),ge=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;ie&&ge?(ie._fireAndBubble(B.pointerout,{evt:z}),ie._fireAndBubble(B.pointerleave,{evt:z}),this._fire(B.pointerleave,{evt:z,target:this,currentTarget:this}),this[Y+"targetShape"]=null):ge&&(this._fire(B.pointerleave,{evt:z,target:this,currentTarget:this}),this._fire(B.pointerout,{evt:z,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(z){const B=W(z.type),Y=Z(z.type);if(!B)return;this.setPointersPositions(z);let ie=!1;this._changedPointerPositions.forEach(ge=>{const xe=this.getIntersection(ge);if(r.DD.justDragged=!1,i.Konva["_"+Y+"ListenClick"]=!0,!xe||!xe.isListening()){this[Y+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&xe.setPointerCapture(ge.id),this[Y+"ClickStartShape"]=xe,xe._fireAndBubble(B.pointerdown,{evt:z,pointerId:ge.id}),ie=!0;const we=z.type.indexOf("touch")>=0;xe.preventDefault()&&z.cancelable&&we&&z.preventDefault()}),ie||this._fire(B.pointerdown,{evt:z,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(z){const B=W(z.type),Y=Z(z.type);if(!B||(i.Konva.isDragging()&&r.DD.node.preventDefault()&&z.cancelable&&z.preventDefault(),this.setPointersPositions(z),!(!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled)))return;const ge={};let xe=!1;const we=this._getTargetShape(Y);this._changedPointerPositions.forEach(je=>{const Re=c.getCapturedShape(je.id)||this.getIntersection(je),Ct=je.id,Xe={evt:z,pointerId:Ct},Qe=we!==Re;if(Qe&&we&&(we._fireAndBubble(B.pointerout,{...Xe},Re),we._fireAndBubble(B.pointerleave,{...Xe},Re)),Re){if(ge[Re._id])return;ge[Re._id]=!0}Re&&Re.isListening()?(xe=!0,Qe&&(Re._fireAndBubble(B.pointerover,{...Xe},we),Re._fireAndBubble(B.pointerenter,{...Xe},we),this[Y+"targetShape"]=Re),Re._fireAndBubble(B.pointermove,{...Xe})):we&&(this._fire(B.pointerover,{evt:z,target:this,currentTarget:this,pointerId:Ct}),this[Y+"targetShape"]=null)}),xe||this._fire(B.pointermove,{evt:z,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(z){const B=W(z.type),Y=Z(z.type);if(!B)return;this.setPointersPositions(z);const ie=this[Y+"ClickStartShape"],ge=this[Y+"ClickEndShape"],xe={};let we=!1;this._changedPointerPositions.forEach(je=>{const Re=c.getCapturedShape(je.id)||this.getIntersection(je);if(Re){if(Re.releaseCapture(je.id),xe[Re._id])return;xe[Re._id]=!0}const Ct=je.id,Xe={evt:z,pointerId:Ct};let Qe=!1;i.Konva["_"+Y+"InDblClickWindow"]?(Qe=!0,clearTimeout(this[Y+"DblTimeout"])):r.DD.justDragged||(i.Konva["_"+Y+"InDblClickWindow"]=!0,clearTimeout(this[Y+"DblTimeout"])),this[Y+"DblTimeout"]=setTimeout(function(){i.Konva["_"+Y+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),Re&&Re.isListening()?(we=!0,this[Y+"ClickEndShape"]=Re,Re._fireAndBubble(B.pointerup,{...Xe}),i.Konva["_"+Y+"ListenClick"]&&ie&&ie===Re&&(Re._fireAndBubble(B.pointerclick,{...Xe}),Qe&&ge&&ge===Re&&Re._fireAndBubble(B.pointerdblclick,{...Xe}))):(this[Y+"ClickEndShape"]=null,i.Konva["_"+Y+"ListenClick"]&&this._fire(B.pointerclick,{evt:z,target:this,currentTarget:this,pointerId:Ct}),Qe&&this._fire(B.pointerdblclick,{evt:z,target:this,currentTarget:this,pointerId:Ct}))}),we||this._fire(B.pointerup,{evt:z,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+Y+"ListenClick"]=!1,z.cancelable&&Y!=="touch"&&Y!=="pointer"&&z.preventDefault()}_contextmenu(z){this.setPointersPositions(z);const B=this.getIntersection(this.getPointerPosition());B&&B.isListening()?B._fireAndBubble(D,{evt:z}):this._fire(D,{evt:z,target:this,currentTarget:this})}_wheel(z){this.setPointersPositions(z);const B=this.getIntersection(this.getPointerPosition());B&&B.isListening()?B._fireAndBubble(L,{evt:z}):this._fire(L,{evt:z,target:this,currentTarget:this})}_pointercancel(z){this.setPointersPositions(z);const B=c.getCapturedShape(z.pointerId)||this.getIntersection(this.getPointerPosition());B&&B._fireAndBubble(_,c.createEvent(z)),c.releaseCapture(z.pointerId)}_lostpointercapture(z){c.releaseCapture(z.pointerId)}setPointersPositions(z){const B=this._getContentPosition();let Y=null,ie=null;z=z||window.event,z.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(z.touches,ge=>{this._pointerPositions.push({id:ge.identifier,x:(ge.clientX-B.left)/B.scaleX,y:(ge.clientY-B.top)/B.scaleY})}),Array.prototype.forEach.call(z.changedTouches||z.touches,ge=>{this._changedPointerPositions.push({id:ge.identifier,x:(ge.clientX-B.left)/B.scaleX,y:(ge.clientY-B.top)/B.scaleY})})):(Y=(z.clientX-B.left)/B.scaleX,ie=(z.clientY-B.top)/B.scaleY,this.pointerPos={x:Y,y:ie},this._pointerPositions=[{x:Y,y:ie,id:t.Util._getFirstPointerId(z)}],this._changedPointerPositions=[{x:Y,y:ie,id:t.Util._getFirstPointerId(z)}])}_setPointerPosition(z){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(z)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const z=this.content.getBoundingClientRect();return{top:z.top,left:z.left,scaleX:z.width/this.content.clientWidth||1,scaleY:z.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new o.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new o.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!i.Konva.isBrowser)return;const z=this.container();if(!z)throw"Stage has no container. A container is required.";z.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),z.appendChild(this.content),this._resizeDOM()}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(z){z.batchDraw()}),this}}e.Stage=H,H.prototype.nodeType=d,(0,l._registerNode)(H),n.Factory.addGetterSetter(H,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{e.stages.forEach($=>{$.batchDraw()})})}(kI)),kI}var gg={},II={},kO;function xi(){return kO||(kO=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Shape=e.shapes=void 0;const t=Xt(),n=Is(),s=en(),i=Rs(),o=nn(),r=Xt(),l=FZ(),c="hasShadow",d="shadowRGBA",u="patternImage",p="linearGradient",m="radialGradient";let f;function g(){return f||(f=n.Util.createCanvasElement().getContext("2d"),f)}e.shapes={};function v(E){const j=this.attrs.fillRule;j?E.fill(j):E.fill()}function b(E){E.stroke()}function C(E){const j=this.attrs.fillRule;j?E.fill(j):E.fill()}function y(E){E.stroke()}function x(){this._clearCache(c)}function w(){this._clearCache(d)}function _(){this._clearCache(u)}function S(){this._clearCache(p)}function I(){this._clearCache(m)}class k extends i.Node{constructor(j){super(j);let P;for(;P=n.Util.getRandomColor(),!(P&&!(P in e.shapes)););this.colorKey=P,e.shapes[P]=this}getContext(){return n.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return n.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(c,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(u,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const P=g().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(P&&P.setTransform){const D=new n.Transform;D.translate(this.fillPatternX(),this.fillPatternY()),D.rotate(t.Konva.getAngle(this.fillPatternRotation())),D.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),D.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const O=D.getMatrix(),N=typeof DOMMatrix>"u"?{a:O[0],b:O[1],c:O[2],d:O[3],e:O[4],f:O[5]}:new DOMMatrix(O);P.setTransform(N)}return P}}_getLinearGradient(){return this._getCache(p,this.__getLinearGradient)}__getLinearGradient(){const j=this.fillLinearGradientColorStops();if(j){const P=g(),D=this.fillLinearGradientStartPoint(),O=this.fillLinearGradientEndPoint(),N=P.createLinearGradient(D.x,D.y,O.x,O.y);for(let F=0;F<j.length;F+=2)N.addColorStop(j[F],j[F+1]);return N}}_getRadialGradient(){return this._getCache(m,this.__getRadialGradient)}__getRadialGradient(){const j=this.fillRadialGradientColorStops();if(j){const P=g(),D=this.fillRadialGradientStartPoint(),O=this.fillRadialGradientEndPoint(),N=P.createRadialGradient(D.x,D.y,this.fillRadialGradientStartRadius(),O.x,O.y,this.fillRadialGradientEndRadius());for(let F=0;F<j.length;F+=2)N.addColorStop(j[F],j[F+1]);return N}}getShadowRGBA(){return this._getCache(d,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const j=n.Util.colorToRGBA(this.shadowColor());if(j)return"rgba("+j.r+","+j.g+","+j.b+","+j.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const j=this.hitStrokeWidth();return j==="auto"?this.hasStroke():this.strokeEnabled()&&!!j}intersects(j){const P=this.getStage();if(!P)return!1;const D=P.bufferHitCanvas;return D.getContext().clear(),this.drawHit(D,void 0,!0),D.context.getImageData(Math.round(j.x),Math.round(j.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete e.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(j){var P;if(!((P=this.attrs.perfectDrawEnabled)!==null&&P!==void 0?P:!0))return!1;const O=j||this.hasFill(),N=this.hasStroke(),F=this.getAbsoluteOpacity()!==1;if(O&&N&&F)return!0;const X=this.hasShadow(),L=this.shadowForStrokeEnabled();return!!(O&&N&&X&&L)}setStrokeHitEnabled(j){n.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),j?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const j=this.size();return{x:this._centroid?-j.width/2:0,y:this._centroid?-j.height/2:0,width:j.width,height:j.height}}getClientRect(j={}){let P=!1,D=this.getParent();for(;D;){if(D.isCached()){P=!0;break}D=D.getParent()}const O=j.skipTransform,N=j.relativeTo||P&&this.getStage()||void 0,F=this.getSelfRect(),L=!j.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,V=F.width+L,K=F.height+L,U=!j.skipShadow&&this.hasShadow(),Z=U?this.shadowOffsetX():0,W=U?this.shadowOffsetY():0,R=V+Math.abs(Z),G=K+Math.abs(W),H=U&&this.shadowBlur()||0,$=R+H*2,z=G+H*2,B={width:$,height:z,x:-(L/2+H)+Math.min(Z,0)+F.x,y:-(L/2+H)+Math.min(W,0)+F.y};return O?B:this._transformedRect(B,N)}drawScene(j,P,D){const O=this.getLayer(),N=j||O.getCanvas(),F=N.getContext(),X=this._getCanvasCache(),L=this.getSceneFunc(),V=this.hasShadow();let K;const U=P===this;if(!this.isVisible()&&!U)return this;if(X){F.save();const Z=this.getAbsoluteTransform(P).getMatrix();return F.transform(Z[0],Z[1],Z[2],Z[3],Z[4],Z[5]),this._drawCachedSceneCanvas(F),F.restore(),this}if(!L)return this;if(F.save(),this._useBufferCanvas()){K=this.getStage();const Z=D||K.bufferCanvas,W=Z.getContext();W.clear(),W.save(),W._applyLineJoin(this);const R=this.getAbsoluteTransform(P).getMatrix();W.transform(R[0],R[1],R[2],R[3],R[4],R[5]),L.call(this,W,this),W.restore();const G=Z.pixelRatio;V&&F._applyShadow(this),F._applyOpacity(this),F._applyGlobalCompositeOperation(this),F.drawImage(Z._canvas,Z.x||0,Z.y||0,Z.width/G,Z.height/G)}else{if(F._applyLineJoin(this),!U){const Z=this.getAbsoluteTransform(P).getMatrix();F.transform(Z[0],Z[1],Z[2],Z[3],Z[4],Z[5]),F._applyOpacity(this),F._applyGlobalCompositeOperation(this)}V&&F._applyShadow(this),L.call(this,F,this)}return F.restore(),this}drawHit(j,P,D=!1){if(!this.shouldDrawHit(P,D))return this;const O=this.getLayer(),N=j||O.hitCanvas,F=N&&N.getContext(),X=this.hitFunc()||this.sceneFunc(),L=this._getCanvasCache(),V=L&&L.hit;if(this.colorKey||n.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),V){F.save();const U=this.getAbsoluteTransform(P).getMatrix();return F.transform(U[0],U[1],U[2],U[3],U[4],U[5]),this._drawCachedHitCanvas(F),F.restore(),this}if(!X)return this;if(F.save(),F._applyLineJoin(this),!(this===P)){const U=this.getAbsoluteTransform(P).getMatrix();F.transform(U[0],U[1],U[2],U[3],U[4],U[5])}return X.call(this,F,this),F.restore(),this}drawHitFromCache(j=0){const P=this._getCanvasCache(),D=this._getCachedSceneCanvas(),O=P.hit,N=O.getContext(),F=O.getWidth(),X=O.getHeight();N.clear(),N.drawImage(D._canvas,0,0,F,X);try{const L=N.getImageData(0,0,F,X),V=L.data,K=V.length,U=n.Util._hexToRgb(this.colorKey);for(let Z=0;Z<K;Z+=4)V[Z+3]>j?(V[Z]=U.r,V[Z+1]=U.g,V[Z+2]=U.b,V[Z+3]=255):V[Z+3]=0;N.putImageData(L,0,0)}catch(L){n.Util.error("Unable to draw hit graph from cached scene canvas. "+L.message)}return this}hasPointerCapture(j){return l.hasPointerCapture(j,this)}setPointerCapture(j){l.setPointerCapture(j,this)}releaseCapture(j){l.releaseCapture(j,this)}}e.Shape=k,k.prototype._fillFunc=v,k.prototype._strokeFunc=b,k.prototype._fillFuncHit=C,k.prototype._strokeFuncHit=y,k.prototype._centroid=!1,k.prototype.nodeType="Shape",(0,r._registerNode)(k),k.prototype.eventListeners={},k.prototype.on.call(k.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",x),k.prototype.on.call(k.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",w),k.prototype.on.call(k.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",_),k.prototype.on.call(k.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",S),k.prototype.on.call(k.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",I),s.Factory.addGetterSetter(k,"stroke",void 0,(0,o.getStringOrGradientValidator)()),s.Factory.addGetterSetter(k,"strokeWidth",2,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(k,"fillAfterStrokeEnabled",!1),s.Factory.addGetterSetter(k,"hitStrokeWidth","auto",(0,o.getNumberOrAutoValidator)()),s.Factory.addGetterSetter(k,"strokeHitEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(k,"perfectDrawEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(k,"shadowForStrokeEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(k,"lineJoin"),s.Factory.addGetterSetter(k,"lineCap"),s.Factory.addGetterSetter(k,"sceneFunc"),s.Factory.addGetterSetter(k,"hitFunc"),s.Factory.addGetterSetter(k,"dash"),s.Factory.addGetterSetter(k,"dashOffset",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(k,"shadowColor",void 0,(0,o.getStringValidator)()),s.Factory.addGetterSetter(k,"shadowBlur",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(k,"shadowOpacity",1,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(k,"shadowOffset",["x","y"]),s.Factory.addGetterSetter(k,"shadowOffsetX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(k,"shadowOffsetY",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(k,"fillPatternImage"),s.Factory.addGetterSetter(k,"fill",void 0,(0,o.getStringOrGradientValidator)()),s.Factory.addGetterSetter(k,"fillPatternX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(k,"fillPatternY",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(k,"fillLinearGradientColorStops"),s.Factory.addGetterSetter(k,"strokeLinearGradientColorStops"),s.Factory.addGetterSetter(k,"fillRadialGradientStartRadius",0),s.Factory.addGetterSetter(k,"fillRadialGradientEndRadius",0),s.Factory.addGetterSetter(k,"fillRadialGradientColorStops"),s.Factory.addGetterSetter(k,"fillPatternRepeat","repeat"),s.Factory.addGetterSetter(k,"fillEnabled",!0),s.Factory.addGetterSetter(k,"strokeEnabled",!0),s.Factory.addGetterSetter(k,"shadowEnabled",!0),s.Factory.addGetterSetter(k,"dashEnabled",!0),s.Factory.addGetterSetter(k,"strokeScaleEnabled",!0),s.Factory.addGetterSetter(k,"fillPriority","color"),s.Factory.addComponentsGetterSetter(k,"fillPatternOffset",["x","y"]),s.Factory.addGetterSetter(k,"fillPatternOffsetX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(k,"fillPatternOffsetY",0,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(k,"fillPatternScale",["x","y"]),s.Factory.addGetterSetter(k,"fillPatternScaleX",1,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(k,"fillPatternScaleY",1,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(k,"fillLinearGradientStartPoint",["x","y"]),s.Factory.addComponentsGetterSetter(k,"strokeLinearGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(k,"fillLinearGradientStartPointX",0),s.Factory.addGetterSetter(k,"strokeLinearGradientStartPointX",0),s.Factory.addGetterSetter(k,"fillLinearGradientStartPointY",0),s.Factory.addGetterSetter(k,"strokeLinearGradientStartPointY",0),s.Factory.addComponentsGetterSetter(k,"fillLinearGradientEndPoint",["x","y"]),s.Factory.addComponentsGetterSetter(k,"strokeLinearGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(k,"fillLinearGradientEndPointX",0),s.Factory.addGetterSetter(k,"strokeLinearGradientEndPointX",0),s.Factory.addGetterSetter(k,"fillLinearGradientEndPointY",0),s.Factory.addGetterSetter(k,"strokeLinearGradientEndPointY",0),s.Factory.addComponentsGetterSetter(k,"fillRadialGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(k,"fillRadialGradientStartPointX",0),s.Factory.addGetterSetter(k,"fillRadialGradientStartPointY",0),s.Factory.addComponentsGetterSetter(k,"fillRadialGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(k,"fillRadialGradientEndPointX",0),s.Factory.addGetterSetter(k,"fillRadialGradientEndPointY",0),s.Factory.addGetterSetter(k,"fillPatternRotation",0),s.Factory.addGetterSetter(k,"fillRule",void 0,(0,o.getStringValidator)()),s.Factory.backCompat(k,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})}(II)),II}var IO;function BZ(){if(IO)return gg;IO=1,Object.defineProperty(gg,"__esModule",{value:!0}),gg.Layer=void 0;const e=Is(),t=U_(),n=Rs(),s=en(),i=W_(),o=nn(),r=xi(),l=Xt(),c="#",d="beforeDraw",u="draw",p=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],m=p.length;let f=class extends t.Container{constructor(v){super(v),this.canvas=new i.SceneCanvas,this.hitCanvas=new i.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(v){return this.getContext().clear(v),this.getHitCanvas().getContext().clear(v),this}setZIndex(v){super.setZIndex(v);const b=this.getStage();return b&&b.content&&(b.content.removeChild(this.getNativeCanvasElement()),v<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[v+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){n.Node.prototype.moveToTop.call(this);const v=this.getStage();return v&&v.content&&(v.content.removeChild(this.getNativeCanvasElement()),v.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!n.Node.prototype.moveUp.call(this))return!1;const b=this.getStage();return!b||!b.content?!1:(b.content.removeChild(this.getNativeCanvasElement()),this.index<b.children.length-1?b.content.insertBefore(this.getNativeCanvasElement(),b.children[this.index+1].getCanvas()._canvas):b.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(n.Node.prototype.moveDown.call(this)){const v=this.getStage();if(v){const b=v.children;v.content&&(v.content.removeChild(this.getNativeCanvasElement()),v.content.insertBefore(this.getNativeCanvasElement(),b[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(n.Node.prototype.moveToBottom.call(this)){const v=this.getStage();if(v){const b=v.children;v.content&&(v.content.removeChild(this.getNativeCanvasElement()),v.content.insertBefore(this.getNativeCanvasElement(),b[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const v=this.getNativeCanvasElement();return n.Node.prototype.remove.call(this),v&&v.parentNode&&e.Util._isInDocument(v)&&v.parentNode.removeChild(v),this}getStage(){return this.parent}setSize({width:v,height:b}){return this.canvas.setSize(v,b),this.hitCanvas.setSize(v,b),this._setSmoothEnabled(),this}_validateAdd(v){const b=v.getType();b!=="Group"&&b!=="Shape"&&e.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(v){return v=v||{},v.width=v.width||this.getWidth(),v.height=v.height||this.getHeight(),v.x=v.x!==void 0?v.x:this.x(),v.y=v.y!==void 0?v.y:this.y(),n.Node.prototype._toKonvaCanvas.call(this,v)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){e.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){e.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,e.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(v){if(!this.isListening()||!this.isVisible())return null;let b=1,C=!1;for(;;){for(let y=0;y<m;y++){const x=p[y],w=this._getIntersection({x:v.x+x.x*b,y:v.y+x.y*b}),_=w.shape;if(_)return _;if(C=!!w.antialiased,!w.antialiased)break}if(C)b+=1;else return null}}_getIntersection(v){const b=this.hitCanvas.pixelRatio,C=this.hitCanvas.context.getImageData(Math.round(v.x*b),Math.round(v.y*b),1,1).data,y=C[3];if(y===255){const x=e.Util._rgbToHex(C[0],C[1],C[2]),w=r.shapes[c+x];return w?{shape:w}:{antialiased:!0}}else if(y>0)return{antialiased:!0};return{}}drawScene(v,b,C){const y=this.getLayer(),x=v||y&&y.getCanvas();return this._fire(d,{node:this}),this.clearBeforeDraw()&&x.getContext().clear(),t.Container.prototype.drawScene.call(this,x,b,C),this._fire(u,{node:this}),this}drawHit(v,b){const C=this.getLayer(),y=v||C&&C.hitCanvas;return C&&C.clearBeforeDraw()&&C.getHitCanvas().getContext().clear(),t.Container.prototype.drawHit.call(this,y,b),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(v){e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(v)}getHitGraphEnabled(v){return e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const v=this.parent;!!this.hitCanvas._canvas.parentNode?v.content.removeChild(this.hitCanvas._canvas):v.content.appendChild(this.hitCanvas._canvas)}destroy(){return e.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};return gg.Layer=f,f.prototype.nodeType="Layer",(0,l._registerNode)(f),s.Factory.addGetterSetter(f,"imageSmoothingEnabled",!0),s.Factory.addGetterSetter(f,"clearBeforeDraw",!0),s.Factory.addGetterSetter(f,"hitGraphEnabled",!0,(0,o.getBooleanValidator)()),gg}var vg={},jO;function JPe(){if(jO)return vg;jO=1,Object.defineProperty(vg,"__esModule",{value:!0}),vg.FastLayer=void 0;const e=Is(),t=BZ(),n=Xt();let s=class extends t.Layer{constructor(o){super(o),this.listening(!1),e.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return vg.FastLayer=s,s.prototype.nodeType="FastLayer",(0,n._registerNode)(s),vg}var yg={},EO;function D4(){if(EO)return yg;EO=1,Object.defineProperty(yg,"__esModule",{value:!0}),yg.Group=void 0;const e=Is(),t=U_(),n=Xt();let s=class extends t.Container{_validateAdd(o){const r=o.getType();r!=="Group"&&r!=="Shape"&&e.Util.throw("You may only add groups and shapes to groups.")}};return yg.Group=s,s.prototype.nodeType="Group",(0,n._registerNode)(s),yg}var bg={},AO;function M4(){if(AO)return bg;AO=1,Object.defineProperty(bg,"__esModule",{value:!0}),bg.Animation=void 0;const e=Xt(),t=Is(),n=function(){return e.glob.performance&&e.glob.performance.now?function(){return e.glob.performance.now()}:function(){return new Date().getTime()}}();let s=class Np{constructor(o,r){this.id=Np.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:n(),frameRate:0},this.func=o,this.setLayers(r)}setLayers(o){let r=[];return o&&(r=Array.isArray(o)?o:[o]),this.layers=r,this}getLayers(){return this.layers}addLayer(o){const r=this.layers,l=r.length;for(let c=0;c<l;c++)if(r[c]._id===o._id)return!1;return this.layers.push(o),!0}isRunning(){const r=Np.animations,l=r.length;for(let c=0;c<l;c++)if(r[c].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=n(),Np._addAnimation(this),this}stop(){return Np._removeAnimation(this),this}_updateFrameObject(o){this.frame.timeDiff=o-this.frame.lastTime,this.frame.lastTime=o,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(o){this.animations.push(o),this._handleAnimation()}static _removeAnimation(o){const r=o.id,l=this.animations,c=l.length;for(let d=0;d<c;d++)if(l[d].id===r){this.animations.splice(d,1);break}}static _runFrames(){const o={},r=this.animations;for(let l=0;l<r.length;l++){const c=r[l],d=c.layers,u=c.func;c._updateFrameObject(n());const p=d.length;let m;if(u?m=u.call(c,c.frame)!==!1:m=!0,!!m)for(let f=0;f<p;f++){const g=d[f];g._id!==void 0&&(o[g._id]=g)}}for(const l in o)o.hasOwnProperty(l)&&o[l].batchDraw()}static _animationLoop(){const o=Np;o.animations.length?(o._runFrames(),t.Util.requestAnimFrame(o._animationLoop)):o.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,t.Util.requestAnimFrame(this._animationLoop))}};return bg.Animation=s,s.animations=[],s.animIdCounter=0,s.animRunning=!1,bg}var jI={},PO;function eTe(){return PO||(PO=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Easings=e.Tween=void 0;const t=Is(),n=M4(),s=Rs(),i=Xt(),o={node:1,duration:1,easing:1,onFinish:1,yoyo:1},r=1,l=2,c=3,d=["fill","stroke","shadowColor"];let u=0;class p{constructor(g,v,b,C,y,x,w){this.prop=g,this.propFunc=v,this.begin=C,this._pos=C,this.duration=x,this._change=0,this.prevPos=0,this.yoyo=w,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=b,this._change=y-this.begin,this.pause()}fire(g){const v=this[g];v&&v()}setTime(g){g>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():g<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=g,this.update())}getTime(){return this._time}setPosition(g){this.prevPos=this._pos,this.propFunc(g),this._pos=g}getPosition(g){return g===void 0&&(g=this._time),this.func(g,this.begin,this._change,this.duration)}play(){this.state=l,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=c,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(g){this.pause(),this._time=g,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const g=this.getTimer()-this._startTime;this.state===l?this.setTime(g):this.state===c&&this.setTime(this.duration-g)}pause(){this.state=r,this.fire("onPause")}getTimer(){return new Date().getTime()}}class m{constructor(g){const v=this,b=g.node,C=b._id,y=g.easing||e.Easings.Linear,x=!!g.yoyo;let w,_;typeof g.duration>"u"?w=.3:g.duration===0?w=.001:w=g.duration,this.node=b,this._id=u++;const S=b.getLayer()||(b instanceof i.Konva.Stage?b.getLayers():null);S||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new n.Animation(function(){v.tween.onEnterFrame()},S),this.tween=new p(_,function(I){v._tweenFunc(I)},y,0,1,w*1e3,x),this._addListeners(),m.attrs[C]||(m.attrs[C]={}),m.attrs[C][this._id]||(m.attrs[C][this._id]={}),m.tweens[C]||(m.tweens[C]={});for(_ in g)o[_]===void 0&&this._addAttr(_,g[_]);this.reset(),this.onFinish=g.onFinish,this.onReset=g.onReset,this.onUpdate=g.onUpdate}_addAttr(g,v){const b=this.node,C=b._id;let y,x,w,_,S;const I=m.tweens[C][g];I&&delete m.attrs[C][I][g];let k=b.getAttr(g);if(t.Util._isArray(v))if(y=[],x=Math.max(v.length,k.length),g==="points"&&v.length!==k.length&&(v.length>k.length?(_=k,k=t.Util._prepareArrayForTween(k,v,b.closed())):(w=v,v=t.Util._prepareArrayForTween(v,k,b.closed()))),g.indexOf("fill")===0)for(let E=0;E<x;E++)if(E%2===0)y.push(v[E]-k[E]);else{const j=t.Util.colorToRGBA(k[E]);S=t.Util.colorToRGBA(v[E]),k[E]=j,y.push({r:S.r-j.r,g:S.g-j.g,b:S.b-j.b,a:S.a-j.a})}else for(let E=0;E<x;E++)y.push(v[E]-k[E]);else d.indexOf(g)!==-1?(k=t.Util.colorToRGBA(k),S=t.Util.colorToRGBA(v),y={r:S.r-k.r,g:S.g-k.g,b:S.b-k.b,a:S.a-k.a}):y=v-k;m.attrs[C][this._id][g]={start:k,diff:y,end:v,trueEnd:w,trueStart:_},m.tweens[C][g]=this._id}_tweenFunc(g){const v=this.node,b=m.attrs[v._id][this._id];let C,y,x,w,_,S,I,k;for(C in b){if(y=b[C],x=y.start,w=y.diff,k=y.end,t.Util._isArray(x))if(_=[],I=Math.max(x.length,k.length),C.indexOf("fill")===0)for(S=0;S<I;S++)S%2===0?_.push((x[S]||0)+w[S]*g):_.push("rgba("+Math.round(x[S].r+w[S].r*g)+","+Math.round(x[S].g+w[S].g*g)+","+Math.round(x[S].b+w[S].b*g)+","+(x[S].a+w[S].a*g)+")");else for(S=0;S<I;S++)_.push((x[S]||0)+w[S]*g);else d.indexOf(C)!==-1?_="rgba("+Math.round(x.r+w.r*g)+","+Math.round(x.g+w.g*g)+","+Math.round(x.b+w.b*g)+","+(x.a+w.a*g)+")":_=x+w*g;v.setAttr(C,_)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const g=this.node,v=m.attrs[g._id][this._id];v.points&&v.points.trueEnd&&g.setAttr("points",v.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const g=this.node,v=m.attrs[g._id][this._id];v.points&&v.points.trueStart&&g.points(v.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(g){return this.tween.seek(g*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const g=this.node._id,v=this._id,b=m.tweens[g];this.pause(),this.anim&&this.anim.stop();for(const C in b)delete m.tweens[g][C];delete m.attrs[g][v],m.tweens[g]&&(Object.keys(m.tweens[g]).length===0&&delete m.tweens[g],Object.keys(m.attrs[g]).length===0&&delete m.attrs[g])}}e.Tween=m,m.attrs={},m.tweens={},s.Node.prototype.to=function(f){const g=f.onFinish;f.node=this,f.onFinish=function(){this.destroy(),g&&g()},new m(f).play()},e.Easings={BackEaseIn(f,g,v,b){return v*(f/=b)*f*((1.70158+1)*f-1.70158)+g},BackEaseOut(f,g,v,b){return v*((f=f/b-1)*f*((1.70158+1)*f+1.70158)+1)+g},BackEaseInOut(f,g,v,b){let C=1.70158;return(f/=b/2)<1?v/2*(f*f*(((C*=1.525)+1)*f-C))+g:v/2*((f-=2)*f*(((C*=1.525)+1)*f+C)+2)+g},ElasticEaseIn(f,g,v,b,C,y){let x=0;return f===0?g:(f/=b)===1?g+v:(y||(y=b*.3),!C||C<Math.abs(v)?(C=v,x=y/4):x=y/(2*Math.PI)*Math.asin(v/C),-(C*Math.pow(2,10*(f-=1))*Math.sin((f*b-x)*(2*Math.PI)/y))+g)},ElasticEaseOut(f,g,v,b,C,y){let x=0;return f===0?g:(f/=b)===1?g+v:(y||(y=b*.3),!C||C<Math.abs(v)?(C=v,x=y/4):x=y/(2*Math.PI)*Math.asin(v/C),C*Math.pow(2,-10*f)*Math.sin((f*b-x)*(2*Math.PI)/y)+v+g)},ElasticEaseInOut(f,g,v,b,C,y){let x=0;return f===0?g:(f/=b/2)===2?g+v:(y||(y=b*(.3*1.5)),!C||C<Math.abs(v)?(C=v,x=y/4):x=y/(2*Math.PI)*Math.asin(v/C),f<1?-.5*(C*Math.pow(2,10*(f-=1))*Math.sin((f*b-x)*(2*Math.PI)/y))+g:C*Math.pow(2,-10*(f-=1))*Math.sin((f*b-x)*(2*Math.PI)/y)*.5+v+g)},BounceEaseOut(f,g,v,b){return(f/=b)<1/2.75?v*(7.5625*f*f)+g:f<2/2.75?v*(7.5625*(f-=1.5/2.75)*f+.75)+g:f<2.5/2.75?v*(7.5625*(f-=2.25/2.75)*f+.9375)+g:v*(7.5625*(f-=2.625/2.75)*f+.984375)+g},BounceEaseIn(f,g,v,b){return v-e.Easings.BounceEaseOut(b-f,0,v,b)+g},BounceEaseInOut(f,g,v,b){return f<b/2?e.Easings.BounceEaseIn(f*2,0,v,b)*.5+g:e.Easings.BounceEaseOut(f*2-b,0,v,b)*.5+v*.5+g},EaseIn(f,g,v,b){return v*(f/=b)*f+g},EaseOut(f,g,v,b){return-v*(f/=b)*(f-2)+g},EaseInOut(f,g,v,b){return(f/=b/2)<1?v/2*f*f+g:-v/2*(--f*(f-2)-1)+g},StrongEaseIn(f,g,v,b){return v*(f/=b)*f*f*f*f+g},StrongEaseOut(f,g,v,b){return v*((f=f/b-1)*f*f*f*f+1)+g},StrongEaseInOut(f,g,v,b){return(f/=b/2)<1?v/2*f*f*f*f*f+g:v/2*((f-=2)*f*f*f*f+2)+g},Linear(f,g,v,b){return v*f/b+g}}}(jI)),jI}var TO;function tTe(){return TO||(TO=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;const t=Xt(),n=Is(),s=Rs(),i=U_(),o=QPe(),r=BZ(),l=JPe(),c=D4(),d=T4(),u=xi(),p=M4(),m=eTe(),f=NZ(),g=W_();e.Konva=n.Util._assign(t.Konva,{Util:n.Util,Transform:n.Transform,Node:s.Node,Container:i.Container,Stage:o.Stage,stages:o.stages,Layer:r.Layer,FastLayer:l.FastLayer,Group:c.Group,DD:d.DD,Shape:u.Shape,shapes:u.shapes,Animation:p.Animation,Tween:m.Tween,Easings:m.Easings,Context:f.Context,Canvas:g.Canvas}),e.default=e.Konva}(xI)),xI}var xg={},DO;function nTe(){if(DO)return xg;DO=1,Object.defineProperty(xg,"__esModule",{value:!0}),xg.Arc=void 0;const e=en(),t=xi(),n=Xt(),s=nn(),i=Xt();let o=class extends t.Shape{_sceneFunc(l){const c=n.Konva.getAngle(this.angle()),d=this.clockwise();l.beginPath(),l.arc(0,0,this.outerRadius(),0,c,d),l.arc(0,0,this.innerRadius(),c,0,!d),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}getSelfRect(){const l=this.innerRadius(),c=this.outerRadius(),d=this.clockwise(),u=n.Konva.getAngle(d?360-this.angle():this.angle()),p=Math.cos(Math.min(u,Math.PI)),m=1,f=Math.sin(Math.min(Math.max(Math.PI,u),3*Math.PI/2)),g=Math.sin(Math.min(u,Math.PI/2)),v=p*(p>0?l:c),b=m*c,C=f*(f>0?l:c),y=g*(g>0?c:l);return{x:v,y:d?-1*y:C,width:b-v,height:y-C}}};return xg.Arc=o,o.prototype._centroid=!0,o.prototype.className="Arc",o.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"innerRadius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"outerRadius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"angle",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"clockwise",!1,(0,s.getBooleanValidator)()),xg}var Cg={},wg={},MO;function zZ(){if(MO)return wg;MO=1,Object.defineProperty(wg,"__esModule",{value:!0}),wg.Line=void 0;const e=en(),t=Xt(),n=xi(),s=nn();function i(l,c,d,u,p,m,f){const g=Math.sqrt(Math.pow(d-l,2)+Math.pow(u-c,2)),v=Math.sqrt(Math.pow(p-d,2)+Math.pow(m-u,2)),b=f*g/(g+v),C=f*v/(g+v),y=d-b*(p-l),x=u-b*(m-c),w=d+C*(p-l),_=u+C*(m-c);return[y,x,w,_]}function o(l,c){const d=l.length,u=[];for(let p=2;p<d-2;p+=2){const m=i(l[p-2],l[p-1],l[p],l[p+1],l[p+2],l[p+3],c);isNaN(m[0])||(u.push(m[0]),u.push(m[1]),u.push(l[p]),u.push(l[p+1]),u.push(m[2]),u.push(m[3]))}return u}let r=class extends n.Shape{constructor(c){super(c),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(c){const d=this.points(),u=d.length,p=this.tension(),m=this.closed(),f=this.bezier();if(!u)return;let g=0;if(c.beginPath(),c.moveTo(d[0],d[1]),p!==0&&u>4){const v=this.getTensionPoints(),b=v.length;for(g=m?0:4,m||c.quadraticCurveTo(v[0],v[1],v[2],v[3]);g<b-2;)c.bezierCurveTo(v[g++],v[g++],v[g++],v[g++],v[g++],v[g++]);m||c.quadraticCurveTo(v[b-2],v[b-1],d[u-2],d[u-1])}else if(f)for(g=2;g<u;)c.bezierCurveTo(d[g++],d[g++],d[g++],d[g++],d[g++],d[g++]);else for(g=2;g<u;g+=2)c.lineTo(d[g],d[g+1]);m?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():o(this.points(),this.tension())}_getTensionPointsClosed(){const c=this.points(),d=c.length,u=this.tension(),p=i(c[d-2],c[d-1],c[0],c[1],c[2],c[3],u),m=i(c[d-4],c[d-3],c[d-2],c[d-1],c[0],c[1],u),f=o(c,u);return[p[2],p[3]].concat(f).concat([m[0],m[1],c[d-2],c[d-1],m[2],m[3],p[0],p[1],c[0],c[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let c=this.points();if(c.length<4)return{x:c[0]||0,y:c[1]||0,width:0,height:0};this.tension()!==0?c=[c[0],c[1],...this._getTensionPoints(),c[c.length-2],c[c.length-1]]:c=this.points();let d=c[0],u=c[0],p=c[1],m=c[1],f,g;for(let v=0;v<c.length/2;v++)f=c[v*2],g=c[v*2+1],d=Math.min(d,f),u=Math.max(u,f),p=Math.min(p,g),m=Math.max(m,g);return{x:d,y:p,width:u-d,height:m-p}}};return wg.Line=r,r.prototype.className="Line",r.prototype._attrsAffectingSize=["points","bezier","tension"],(0,t._registerNode)(r),e.Factory.addGetterSetter(r,"closed",!1),e.Factory.addGetterSetter(r,"bezier",!1),e.Factory.addGetterSetter(r,"tension",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(r,"points",[],(0,s.getNumberArrayValidator)()),wg}var _g={},EI={},LO;function sTe(){return LO||(LO=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.t2length=e.getQuadraticArcLength=e.getCubicArcLength=e.binomialCoefficients=e.cValues=e.tValues=void 0,e.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],e.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],e.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const t=(r,l,c)=>{let d,u;const m=c/2;d=0;for(let f=0;f<20;f++)u=m*e.tValues[20][f]+m,d+=e.cValues[20][f]*s(r,l,u);return m*d};e.getCubicArcLength=t;const n=(r,l,c)=>{c===void 0&&(c=1);const d=r[0]-2*r[1]+r[2],u=l[0]-2*l[1]+l[2],p=2*r[1]-2*r[0],m=2*l[1]-2*l[0],f=4*(d*d+u*u),g=4*(d*p+u*m),v=p*p+m*m;if(f===0)return c*Math.sqrt(Math.pow(r[2]-r[0],2)+Math.pow(l[2]-l[0],2));const b=g/(2*f),C=v/f,y=c+b,x=C-b*b,w=y*y+x>0?Math.sqrt(y*y+x):0,_=b*b+x>0?Math.sqrt(b*b+x):0,S=b+Math.sqrt(b*b+x)!==0?x*Math.log(Math.abs((y+w)/(b+_))):0;return Math.sqrt(f)/2*(y*w-b*_+S)};e.getQuadraticArcLength=n;function s(r,l,c){const d=i(1,c,r),u=i(1,c,l),p=d*d+u*u;return Math.sqrt(p)}const i=(r,l,c)=>{const d=c.length-1;let u,p;if(d===0)return 0;if(r===0){p=0;for(let m=0;m<=d;m++)p+=e.binomialCoefficients[d][m]*Math.pow(1-l,d-m)*Math.pow(l,m)*c[m];return p}else{u=new Array(d);for(let m=0;m<d;m++)u[m]=d*(c[m+1]-c[m]);return i(r-1,l,u)}},o=(r,l,c)=>{let d=1,u=r/l,p=(r-c(u))/l,m=0;for(;d>.001;){const f=c(u+p),g=Math.abs(r-f)/l;if(g<d)d=g,u+=p;else{const v=c(u-p),b=Math.abs(r-v)/l;b<d?(d=b,u-=p):p/=2}if(m++,m>500)break}return u};e.t2length=o}(EI)),EI}var RO;function L4(){if(RO)return _g;RO=1,Object.defineProperty(_g,"__esModule",{value:!0}),_g.Path=void 0;const e=en(),t=Xt(),n=xi(),s=sTe();let i=class Oo extends n.Shape{constructor(r){super(r),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=Oo.parsePathData(this.data()),this.pathLength=Oo.getPathLength(this.dataArray)}_sceneFunc(r){const l=this.dataArray;r.beginPath();let c=!1;for(let d=0;d<l.length;d++){const u=l[d].command,p=l[d].points;switch(u){case"L":r.lineTo(p[0],p[1]);break;case"M":r.moveTo(p[0],p[1]);break;case"C":r.bezierCurveTo(p[0],p[1],p[2],p[3],p[4],p[5]);break;case"Q":r.quadraticCurveTo(p[0],p[1],p[2],p[3]);break;case"A":const m=p[0],f=p[1],g=p[2],v=p[3],b=p[4],C=p[5],y=p[6],x=p[7],w=g>v?g:v,_=g>v?1:g/v,S=g>v?v/g:1;r.translate(m,f),r.rotate(y),r.scale(_,S),r.arc(0,0,w,b,b+C,1-x),r.scale(1/_,1/S),r.rotate(-y),r.translate(-m,-f);break;case"z":c=!0,r.closePath();break}}!c&&!this.hasFill()?r.strokeShape(this):r.fillStrokeShape(this)}getSelfRect(){let r=[];this.dataArray.forEach(function(f){if(f.command==="A"){const g=f.points[4],v=f.points[5],b=f.points[4]+v;let C=Math.PI/180;if(Math.abs(g-b)<C&&(C=Math.abs(g-b)),v<0)for(let y=g-C;y>b;y-=C){const x=Oo.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],y,0);r.push(x.x,x.y)}else for(let y=g+C;y<b;y+=C){const x=Oo.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],y,0);r.push(x.x,x.y)}}else if(f.command==="C")for(let g=0;g<=1;g+=.01){const v=Oo.getPointOnCubicBezier(g,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3],f.points[4],f.points[5]);r.push(v.x,v.y)}else r=r.concat(f.points)});let l=r[0],c=r[0],d=r[1],u=r[1],p,m;for(let f=0;f<r.length/2;f++)p=r[f*2],m=r[f*2+1],isNaN(p)||(l=Math.min(l,p),c=Math.max(c,p)),isNaN(m)||(d=Math.min(d,m),u=Math.max(u,m));return{x:l,y:d,width:c-l,height:u-d}}getLength(){return this.pathLength}getPointAtLength(r){return Oo.getPointAtLengthOfDataArray(r,this.dataArray)}static getLineLength(r,l,c,d){return Math.sqrt((c-r)*(c-r)+(d-l)*(d-l))}static getPathLength(r){let l=0;for(let c=0;c<r.length;++c)l+=r[c].pathLength;return l}static getPointAtLengthOfDataArray(r,l){let c,d=0,u=l.length;if(!u)return null;for(;d<u&&r>l[d].pathLength;)r-=l[d].pathLength,++d;if(d===u)return c=l[d-1].points.slice(-2),{x:c[0],y:c[1]};if(r<.01)return l[d].command==="M"?(c=l[d].points.slice(0,2),{x:c[0],y:c[1]}):{x:l[d].start.x,y:l[d].start.y};const p=l[d],m=p.points;switch(p.command){case"L":return Oo.getPointOnLine(r,p.start.x,p.start.y,m[0],m[1]);case"C":return Oo.getPointOnCubicBezier((0,s.t2length)(r,Oo.getPathLength(l),w=>(0,s.getCubicArcLength)([p.start.x,m[0],m[2],m[4]],[p.start.y,m[1],m[3],m[5]],w)),p.start.x,p.start.y,m[0],m[1],m[2],m[3],m[4],m[5]);case"Q":return Oo.getPointOnQuadraticBezier((0,s.t2length)(r,Oo.getPathLength(l),w=>(0,s.getQuadraticArcLength)([p.start.x,m[0],m[2]],[p.start.y,m[1],m[3]],w)),p.start.x,p.start.y,m[0],m[1],m[2],m[3]);case"A":const f=m[0],g=m[1],v=m[2],b=m[3],C=m[5],y=m[6];let x=m[4];return x+=C*r/p.pathLength,Oo.getPointOnEllipticalArc(f,g,v,b,x,y)}return null}static getPointOnLine(r,l,c,d,u,p,m){p=p??l,m=m??c;const f=this.getLineLength(l,c,d,u);if(f<1e-10)return{x:l,y:c};if(d===l)return{x:p,y:m+(u>c?r:-r)};const g=(u-c)/(d-l),v=Math.sqrt(r*r/(1+g*g))*(d<l?-1:1),b=g*v;if(Math.abs(m-c-g*(p-l))<1e-10)return{x:p+v,y:m+b};const C=((p-l)*(d-l)+(m-c)*(u-c))/(f*f),y=l+C*(d-l),x=c+C*(u-c),w=this.getLineLength(p,m,y,x),_=Math.sqrt(r*r-w*w),S=Math.sqrt(_*_/(1+g*g))*(d<l?-1:1),I=g*S;return{x:y+S,y:x+I}}static getPointOnCubicBezier(r,l,c,d,u,p,m,f,g){function v(_){return _*_*_}function b(_){return 3*_*_*(1-_)}function C(_){return 3*_*(1-_)*(1-_)}function y(_){return(1-_)*(1-_)*(1-_)}const x=f*v(r)+p*b(r)+d*C(r)+l*y(r),w=g*v(r)+m*b(r)+u*C(r)+c*y(r);return{x,y:w}}static getPointOnQuadraticBezier(r,l,c,d,u,p,m){function f(y){return y*y}function g(y){return 2*y*(1-y)}function v(y){return(1-y)*(1-y)}const b=p*f(r)+d*g(r)+l*v(r),C=m*f(r)+u*g(r)+c*v(r);return{x:b,y:C}}static getPointOnEllipticalArc(r,l,c,d,u,p){const m=Math.cos(p),f=Math.sin(p),g={x:c*Math.cos(u),y:d*Math.sin(u)};return{x:r+(g.x*m-g.y*f),y:l+(g.x*f+g.y*m)}}static parsePathData(r){if(!r)return[];let l=r;const c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];l=l.replace(new RegExp(" ","g"),",");for(let b=0;b<c.length;b++)l=l.replace(new RegExp(c[b],"g"),"|"+c[b]);const d=l.split("|"),u=[],p=[];let m=0,f=0;const g=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let v;for(let b=1;b<d.length;b++){let C=d[b],y=C.charAt(0);for(C=C.slice(1),p.length=0;v=g.exec(C);)p.push(v[0]);const x=[];for(let w=0,_=p.length;w<_;w++){if(p[w]==="00"){x.push(0,0);continue}const S=parseFloat(p[w]);isNaN(S)?x.push(0):x.push(S)}for(;x.length>0&&!isNaN(x[0]);){let w="",_=[];const S=m,I=f;let k,E,j,P,D,O,N,F,X,L;switch(y){case"l":m+=x.shift(),f+=x.shift(),w="L",_.push(m,f);break;case"L":m=x.shift(),f=x.shift(),_.push(m,f);break;case"m":const V=x.shift(),K=x.shift();if(m+=V,f+=K,w="M",u.length>2&&u[u.length-1].command==="z"){for(let U=u.length-2;U>=0;U--)if(u[U].command==="M"){m=u[U].points[0]+V,f=u[U].points[1]+K;break}}_.push(m,f),y="l";break;case"M":m=x.shift(),f=x.shift(),w="M",_.push(m,f),y="L";break;case"h":m+=x.shift(),w="L",_.push(m,f);break;case"H":m=x.shift(),w="L",_.push(m,f);break;case"v":f+=x.shift(),w="L",_.push(m,f);break;case"V":f=x.shift(),w="L",_.push(m,f);break;case"C":_.push(x.shift(),x.shift(),x.shift(),x.shift()),m=x.shift(),f=x.shift(),_.push(m,f);break;case"c":_.push(m+x.shift(),f+x.shift(),m+x.shift(),f+x.shift()),m+=x.shift(),f+=x.shift(),w="C",_.push(m,f);break;case"S":E=m,j=f,k=u[u.length-1],k.command==="C"&&(E=m+(m-k.points[2]),j=f+(f-k.points[3])),_.push(E,j,x.shift(),x.shift()),m=x.shift(),f=x.shift(),w="C",_.push(m,f);break;case"s":E=m,j=f,k=u[u.length-1],k.command==="C"&&(E=m+(m-k.points[2]),j=f+(f-k.points[3])),_.push(E,j,m+x.shift(),f+x.shift()),m+=x.shift(),f+=x.shift(),w="C",_.push(m,f);break;case"Q":_.push(x.shift(),x.shift()),m=x.shift(),f=x.shift(),_.push(m,f);break;case"q":_.push(m+x.shift(),f+x.shift()),m+=x.shift(),f+=x.shift(),w="Q",_.push(m,f);break;case"T":E=m,j=f,k=u[u.length-1],k.command==="Q"&&(E=m+(m-k.points[0]),j=f+(f-k.points[1])),m=x.shift(),f=x.shift(),w="Q",_.push(E,j,m,f);break;case"t":E=m,j=f,k=u[u.length-1],k.command==="Q"&&(E=m+(m-k.points[0]),j=f+(f-k.points[1])),m+=x.shift(),f+=x.shift(),w="Q",_.push(E,j,m,f);break;case"A":P=x.shift(),D=x.shift(),O=x.shift(),N=x.shift(),F=x.shift(),X=m,L=f,m=x.shift(),f=x.shift(),w="A",_=this.convertEndpointToCenterParameterization(X,L,m,f,N,F,P,D,O);break;case"a":P=x.shift(),D=x.shift(),O=x.shift(),N=x.shift(),F=x.shift(),X=m,L=f,m+=x.shift(),f+=x.shift(),w="A",_=this.convertEndpointToCenterParameterization(X,L,m,f,N,F,P,D,O);break}u.push({command:w||y,points:_,start:{x:S,y:I},pathLength:this.calcLength(S,I,w||y,_)})}(y==="z"||y==="Z")&&u.push({command:"z",points:[],start:void 0,pathLength:0})}return u}static calcLength(r,l,c,d){let u,p,m,f;const g=Oo;switch(c){case"L":return g.getLineLength(r,l,d[0],d[1]);case"C":return(0,s.getCubicArcLength)([r,d[0],d[2],d[4]],[l,d[1],d[3],d[5]],1);case"Q":return(0,s.getQuadraticArcLength)([r,d[0],d[2]],[l,d[1],d[3]],1);case"A":u=0;const v=d[4],b=d[5],C=d[4]+b;let y=Math.PI/180;if(Math.abs(v-C)<y&&(y=Math.abs(v-C)),p=g.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],v,0),b<0)for(f=v-y;f>C;f-=y)m=g.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],f,0),u+=g.getLineLength(p.x,p.y,m.x,m.y),p=m;else for(f=v+y;f<C;f+=y)m=g.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],f,0),u+=g.getLineLength(p.x,p.y,m.x,m.y),p=m;return m=g.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],C,0),u+=g.getLineLength(p.x,p.y,m.x,m.y),u}return 0}static convertEndpointToCenterParameterization(r,l,c,d,u,p,m,f,g){const v=g*(Math.PI/180),b=Math.cos(v)*(r-c)/2+Math.sin(v)*(l-d)/2,C=-1*Math.sin(v)*(r-c)/2+Math.cos(v)*(l-d)/2,y=b*b/(m*m)+C*C/(f*f);y>1&&(m*=Math.sqrt(y),f*=Math.sqrt(y));let x=Math.sqrt((m*m*(f*f)-m*m*(C*C)-f*f*(b*b))/(m*m*(C*C)+f*f*(b*b)));u===p&&(x*=-1),isNaN(x)&&(x=0);const w=x*m*C/f,_=x*-f*b/m,S=(r+c)/2+Math.cos(v)*w-Math.sin(v)*_,I=(l+d)/2+Math.sin(v)*w+Math.cos(v)*_,k=function(F){return Math.sqrt(F[0]*F[0]+F[1]*F[1])},E=function(F,X){return(F[0]*X[0]+F[1]*X[1])/(k(F)*k(X))},j=function(F,X){return(F[0]*X[1]<F[1]*X[0]?-1:1)*Math.acos(E(F,X))},P=j([1,0],[(b-w)/m,(C-_)/f]),D=[(b-w)/m,(C-_)/f],O=[(-1*b-w)/m,(-1*C-_)/f];let N=j(D,O);return E(D,O)<=-1&&(N=Math.PI),E(D,O)>=1&&(N=0),p===0&&N>0&&(N=N-2*Math.PI),p===1&&N<0&&(N=N+2*Math.PI),[S,I,m,f,P,N,v,p]}};return _g.Path=i,i.prototype.className="Path",i.prototype._attrsAffectingSize=["data"],(0,t._registerNode)(i),e.Factory.addGetterSetter(i,"data"),_g}var OO;function iTe(){if(OO)return Cg;OO=1,Object.defineProperty(Cg,"__esModule",{value:!0}),Cg.Arrow=void 0;const e=en(),t=zZ(),n=nn(),s=Xt(),i=L4();let o=class extends t.Line{_sceneFunc(l){super._sceneFunc(l);const c=Math.PI*2,d=this.points();let u=d;const p=this.tension()!==0&&d.length>4;p&&(u=this.getTensionPoints());const m=this.pointerLength(),f=d.length;let g,v;if(p){const y=[u[u.length-4],u[u.length-3],u[u.length-2],u[u.length-1],d[f-2],d[f-1]],x=i.Path.calcLength(u[u.length-4],u[u.length-3],"C",y),w=i.Path.getPointOnQuadraticBezier(Math.min(1,1-m/x),y[0],y[1],y[2],y[3],y[4],y[5]);g=d[f-2]-w.x,v=d[f-1]-w.y}else g=d[f-2]-d[f-4],v=d[f-1]-d[f-3];const b=(Math.atan2(v,g)+c)%c,C=this.pointerWidth();this.pointerAtEnding()&&(l.save(),l.beginPath(),l.translate(d[f-2],d[f-1]),l.rotate(b),l.moveTo(0,0),l.lineTo(-m,C/2),l.lineTo(-m,-C/2),l.closePath(),l.restore(),this.__fillStroke(l)),this.pointerAtBeginning()&&(l.save(),l.beginPath(),l.translate(d[0],d[1]),p?(g=(u[0]+u[2])/2-d[0],v=(u[1]+u[3])/2-d[1]):(g=d[2]-d[0],v=d[3]-d[1]),l.rotate((Math.atan2(-v,-g)+c)%c),l.moveTo(0,0),l.lineTo(-m,C/2),l.lineTo(-m,-C/2),l.closePath(),l.restore(),this.__fillStroke(l))}__fillStroke(l){const c=this.dashEnabled();c&&(this.attrs.dashEnabled=!1,l.setLineDash([])),l.fillStrokeShape(this),c&&(this.attrs.dashEnabled=!0)}getSelfRect(){const l=super.getSelfRect(),c=this.pointerWidth()/2;return{x:l.x,y:l.y-c,width:l.width,height:l.height+c*2}}};return Cg.Arrow=o,o.prototype.className="Arrow",(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"pointerLength",10,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"pointerWidth",10,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"pointerAtBeginning",!1),e.Factory.addGetterSetter(o,"pointerAtEnding",!0),Cg}var Sg={},NO;function oTe(){if(NO)return Sg;NO=1,Object.defineProperty(Sg,"__esModule",{value:!0}),Sg.Circle=void 0;const e=en(),t=xi(),n=nn(),s=Xt();let i=class extends t.Shape{_sceneFunc(r){r.beginPath(),r.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(r){this.radius()!==r/2&&this.radius(r/2)}setHeight(r){this.radius()!==r/2&&this.radius(r/2)}};return Sg.Circle=i,i.prototype._centroid=!0,i.prototype.className="Circle",i.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"radius",0,(0,n.getNumberValidator)()),Sg}var kg={},FO;function aTe(){if(FO)return kg;FO=1,Object.defineProperty(kg,"__esModule",{value:!0}),kg.Ellipse=void 0;const e=en(),t=xi(),n=nn(),s=Xt();let i=class extends t.Shape{_sceneFunc(r){const l=this.radiusX(),c=this.radiusY();r.beginPath(),r.save(),l!==c&&r.scale(1,c/l),r.arc(0,0,l,0,Math.PI*2,!1),r.restore(),r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(r){this.radiusX(r/2)}setHeight(r){this.radiusY(r/2)}};return kg.Ellipse=i,i.prototype.className="Ellipse",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,s._registerNode)(i),e.Factory.addComponentsGetterSetter(i,"radius",["x","y"]),e.Factory.addGetterSetter(i,"radiusX",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"radiusY",0,(0,n.getNumberValidator)()),kg}var Ig={},BO;function rTe(){if(BO)return Ig;BO=1,Object.defineProperty(Ig,"__esModule",{value:!0}),Ig.Image=void 0;const e=Is(),t=en(),n=xi(),s=Xt(),i=nn();class o extends n.Shape{constructor(l){super(l),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",c=>{this._removeImageLoad(c.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const l=this.image();l&&l.complete||l&&l.readyState===4||l&&l.addEventListener&&l.addEventListener("load",this._loadListener)}_removeImageLoad(l){l&&l.removeEventListener&&l.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const l=!!this.cornerRadius(),c=this.hasShadow();return l&&c?!0:super._useBufferCanvas(!0)}_sceneFunc(l){const c=this.getWidth(),d=this.getHeight(),u=this.cornerRadius(),p=this.attrs.image;let m;if(p){const f=this.attrs.cropWidth,g=this.attrs.cropHeight;f&&g?m=[p,this.cropX(),this.cropY(),f,g,0,0,c,d]:m=[p,0,0,c,d]}(this.hasFill()||this.hasStroke()||u)&&(l.beginPath(),u?e.Util.drawRoundedRectPath(l,c,d,u):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)),p&&(u&&l.clip(),l.drawImage.apply(l,m))}_hitFunc(l){const c=this.width(),d=this.height(),u=this.cornerRadius();l.beginPath(),u?e.Util.drawRoundedRectPath(l,c,d,u):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)}getWidth(){var l,c;return(l=this.attrs.width)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.width}getHeight(){var l,c;return(l=this.attrs.height)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.height}static fromURL(l,c,d=null){const u=e.Util.createImageElement();u.onload=function(){const p=new o({image:u});c(p)},u.onerror=d,u.crossOrigin="Anonymous",u.src=l}}return Ig.Image=o,o.prototype.className="Image",(0,s._registerNode)(o),t.Factory.addGetterSetter(o,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),t.Factory.addGetterSetter(o,"image"),t.Factory.addComponentsGetterSetter(o,"crop",["x","y","width","height"]),t.Factory.addGetterSetter(o,"cropX",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropY",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropWidth",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropHeight",0,(0,i.getNumberValidator)()),Ig}var Pu={},zO;function lTe(){if(zO)return Pu;zO=1,Object.defineProperty(Pu,"__esModule",{value:!0}),Pu.Tag=Pu.Label=void 0;const e=en(),t=xi(),n=D4(),s=nn(),i=Xt(),o=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],r="Change.konva",l="none",c="up",d="right",u="down",p="left",m=o.length;class f extends n.Group{constructor(b){super(b),this.on("add.konva",function(C){this._addListeners(C.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(b){let C=this,y;const x=function(){C._sync()};for(y=0;y<m;y++)b.on(o[y]+r,x)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let b=this.getText(),C=this.getTag(),y,x,w,_,S,I,k;if(b&&C){switch(y=b.width(),x=b.height(),w=C.pointerDirection(),_=C.pointerWidth(),k=C.pointerHeight(),S=0,I=0,w){case c:S=y/2,I=-1*k;break;case d:S=y+_,I=x/2;break;case u:S=y/2,I=x+k;break;case p:S=-1*_,I=x/2;break}C.setAttrs({x:-1*S,y:-1*I,width:y,height:x}),b.setAttrs({x:-1*S,y:-1*I})}}}Pu.Label=f,f.prototype.className="Label",(0,i._registerNode)(f);class g extends t.Shape{_sceneFunc(b){const C=this.width(),y=this.height(),x=this.pointerDirection(),w=this.pointerWidth(),_=this.pointerHeight(),S=this.cornerRadius();let I=0,k=0,E=0,j=0;typeof S=="number"?I=k=E=j=Math.min(S,C/2,y/2):(I=Math.min(S[0]||0,C/2,y/2),k=Math.min(S[1]||0,C/2,y/2),j=Math.min(S[2]||0,C/2,y/2),E=Math.min(S[3]||0,C/2,y/2)),b.beginPath(),b.moveTo(I,0),x===c&&(b.lineTo((C-w)/2,0),b.lineTo(C/2,-1*_),b.lineTo((C+w)/2,0)),b.lineTo(C-k,0),b.arc(C-k,k,k,Math.PI*3/2,0,!1),x===d&&(b.lineTo(C,(y-_)/2),b.lineTo(C+w,y/2),b.lineTo(C,(y+_)/2)),b.lineTo(C,y-j),b.arc(C-j,y-j,j,0,Math.PI/2,!1),x===u&&(b.lineTo((C+w)/2,y),b.lineTo(C/2,y+_),b.lineTo((C-w)/2,y)),b.lineTo(E,y),b.arc(E,y-E,E,Math.PI/2,Math.PI,!1),x===p&&(b.lineTo(0,(y+_)/2),b.lineTo(-1*w,y/2),b.lineTo(0,(y-_)/2)),b.lineTo(0,I),b.arc(I,I,I,Math.PI,Math.PI*3/2,!1),b.closePath(),b.fillStrokeShape(this)}getSelfRect(){let b=0,C=0,y=this.pointerWidth(),x=this.pointerHeight(),w=this.pointerDirection(),_=this.width(),S=this.height();return w===c?(C-=x,S+=x):w===u?S+=x:w===p?(b-=y*1.5,_+=y):w===d&&(_+=y*1.5),{x:b,y:C,width:_,height:S}}}return Pu.Tag=g,g.prototype.className="Tag",(0,i._registerNode)(g),e.Factory.addGetterSetter(g,"pointerDirection",l),e.Factory.addGetterSetter(g,"pointerWidth",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(g,"pointerHeight",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(g,"cornerRadius",0,(0,s.getNumberOrArrayOfNumbersValidator)(4)),Pu}var jg={},VO;function VZ(){if(VO)return jg;VO=1,Object.defineProperty(jg,"__esModule",{value:!0}),jg.Rect=void 0;const e=en(),t=xi(),n=Xt(),s=Is(),i=nn();let o=class extends t.Shape{_sceneFunc(l){const c=this.cornerRadius(),d=this.width(),u=this.height();l.beginPath(),c?s.Util.drawRoundedRectPath(l,d,u,c):l.rect(0,0,d,u),l.closePath(),l.fillStrokeShape(this)}};return jg.Rect=o,o.prototype.className="Rect",(0,n._registerNode)(o),e.Factory.addGetterSetter(o,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),jg}var Eg={},$O;function cTe(){if($O)return Eg;$O=1,Object.defineProperty(Eg,"__esModule",{value:!0}),Eg.RegularPolygon=void 0;const e=en(),t=xi(),n=nn(),s=Xt();let i=class extends t.Shape{_sceneFunc(r){const l=this._getPoints();r.beginPath(),r.moveTo(l[0].x,l[0].y);for(let c=1;c<l.length;c++)r.lineTo(l[c].x,l[c].y);r.closePath(),r.fillStrokeShape(this)}_getPoints(){const r=this.attrs.sides,l=this.attrs.radius||0,c=[];for(let d=0;d<r;d++)c.push({x:l*Math.sin(d*2*Math.PI/r),y:-1*l*Math.cos(d*2*Math.PI/r)});return c}getSelfRect(){const r=this._getPoints();let l=r[0].x,c=r[0].y,d=r[0].x,u=r[0].y;return r.forEach(p=>{l=Math.min(l,p.x),c=Math.max(c,p.x),d=Math.min(d,p.y),u=Math.max(u,p.y)}),{x:l,y:d,width:c-l,height:u-d}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(r){this.radius(r/2)}setHeight(r){this.radius(r/2)}};return Eg.RegularPolygon=i,i.prototype.className="RegularPolygon",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"radius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"sides",0,(0,n.getNumberValidator)()),Eg}var Ag={},GO;function dTe(){if(GO)return Ag;GO=1,Object.defineProperty(Ag,"__esModule",{value:!0}),Ag.Ring=void 0;const e=en(),t=xi(),n=nn(),s=Xt(),i=Math.PI*2;let o=class extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.innerRadius(),0,i,!1),l.moveTo(this.outerRadius(),0),l.arc(0,0,this.outerRadius(),i,0,!0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}};return Ag.Ring=o,o.prototype.className="Ring",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"outerRadius",0,(0,n.getNumberValidator)()),Ag}var Pg={},HO;function uTe(){if(HO)return Pg;HO=1,Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.Sprite=void 0;const e=en(),t=xi(),n=M4(),s=nn(),i=Xt();let o=class extends t.Shape{constructor(l){super(l),this._updated=!0,this.anim=new n.Animation(()=>{const c=this._updated;return this._updated=!1,c}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(l){const c=this.animation(),d=this.frameIndex(),u=d*4,p=this.animations()[c],m=this.frameOffsets(),f=p[u+0],g=p[u+1],v=p[u+2],b=p[u+3],C=this.image();if((this.hasFill()||this.hasStroke())&&(l.beginPath(),l.rect(0,0,v,b),l.closePath(),l.fillStrokeShape(this)),C)if(m){const y=m[c],x=d*2;l.drawImage(C,f,g,v,b,y[x+0],y[x+1],v,b)}else l.drawImage(C,f,g,v,b,0,0,v,b)}_hitFunc(l){const c=this.animation(),d=this.frameIndex(),u=d*4,p=this.animations()[c],m=this.frameOffsets(),f=p[u+2],g=p[u+3];if(l.beginPath(),m){const v=m[c],b=d*2;l.rect(v[b+0],v[b+1],f,g)}else l.rect(0,0,f,g);l.closePath(),l.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const l=this;this.interval=setInterval(function(){l._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const l=this.getLayer();this.anim.setLayers(l),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const l=this.frameIndex(),c=this.animation(),d=this.animations(),u=d[c],p=u.length/4;l<p-1?this.frameIndex(l+1):this.frameIndex(0)}};return Pg.Sprite=o,o.prototype.className="Sprite",(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"animation"),e.Factory.addGetterSetter(o,"animations"),e.Factory.addGetterSetter(o,"frameOffsets"),e.Factory.addGetterSetter(o,"image"),e.Factory.addGetterSetter(o,"frameIndex",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"frameRate",17,(0,s.getNumberValidator)()),e.Factory.backCompat(o,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),Pg}var Tg={},WO;function hTe(){if(WO)return Tg;WO=1,Object.defineProperty(Tg,"__esModule",{value:!0}),Tg.Star=void 0;const e=en(),t=xi(),n=nn(),s=Xt();let i=class extends t.Shape{_sceneFunc(r){const l=this.innerRadius(),c=this.outerRadius(),d=this.numPoints();r.beginPath(),r.moveTo(0,0-c);for(let u=1;u<d*2;u++){const p=u%2===0?c:l,m=p*Math.sin(u*Math.PI/d),f=-1*p*Math.cos(u*Math.PI/d);r.lineTo(m,f)}r.closePath(),r.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(r){this.outerRadius(r/2)}setHeight(r){this.outerRadius(r/2)}};return Tg.Star=i,i.prototype.className="Star",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"numPoints",5,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"outerRadius",0,(0,n.getNumberValidator)()),Tg}var dp={},UO;function $Z(){if(UO)return dp;UO=1,Object.defineProperty(dp,"__esModule",{value:!0}),dp.Text=void 0,dp.stringToArray=r;const e=Is(),t=en(),n=xi(),s=Xt(),i=nn(),o=Xt();function r(W){return[...W].reduce((R,G,H,$)=>{if(new RegExp("\\p{Emoji}","u").test(G)){const z=$[H+1];z&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test(z)?(R.push(G+z),$[H+1]=""):R.push(G)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(G+($[H+1]||""))?R.push(G+$[H+1]):H>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(G)?R[R.length-1]+=G:G&&R.push(G);return R},[])}const l="auto",c="center",d="inherit",u="justify",p="Change.konva",m="2d",f="-",g="left",v="text",b="Text",C="top",y="bottom",x="middle",w="normal",_="px ",S=" ",I="right",k="rtl",E="word",j="char",P="none",D="",O=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],N=O.length;function F(W){return W.split(",").map(R=>{R=R.trim();const G=R.indexOf(" ")>=0,H=R.indexOf('"')>=0||R.indexOf("'")>=0;return G&&!H&&(R=`"${R}"`),R}).join(", ")}let X;function L(){return X||(X=e.Util.createCanvasElement().getContext(m),X)}function V(W){W.fillText(this._partialText,this._partialTextX,this._partialTextY)}function K(W){W.setAttr("miterLimit",2),W.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function U(W){return W=W||{},!W.fillLinearGradientColorStops&&!W.fillRadialGradientColorStops&&!W.fillPatternImage&&(W.fill=W.fill||"black"),W}class Z extends n.Shape{constructor(R){super(U(R)),this._partialTextX=0,this._partialTextY=0;for(let G=0;G<N;G++)this.on(O[G]+p,this._setTextData);this._setTextData()}_sceneFunc(R){const G=this.textArr,H=G.length;if(!this.text())return;let $=this.padding(),z=this.fontSize(),B=this.lineHeight()*z,Y=this.verticalAlign(),ie=this.direction(),ge=0,xe=this.align(),we=this.getWidth(),je=this.letterSpacing(),Re=this.fill(),Ct=this.textDecoration(),Xe=Ct.indexOf("underline")!==-1,Qe=Ct.indexOf("line-through")!==-1,Dt;ie=ie===d?R.direction:ie;let se=B/2,re=x;if(s.Konva._fixTextRendering){const ue=this.measureSize("M");re="alphabetic",se=(ue.fontBoundingBoxAscent-ue.fontBoundingBoxDescent)/2+B/2}for(ie===k&&R.setAttr("direction",ie),R.setAttr("font",this._getContextFont()),R.setAttr("textBaseline",re),R.setAttr("textAlign",g),Y===x?ge=(this.getHeight()-H*B-$*2)/2:Y===y&&(ge=this.getHeight()-H*B-$*2),R.translate($,ge+$),Dt=0;Dt<H;Dt++){let ue=0,Se=0;const de=G[Dt],me=de.text,Ee=de.width,tt=de.lastInParagraph;if(R.save(),xe===I?ue+=we-Ee-$*2:xe===c&&(ue+=(we-Ee-$*2)/2),Xe){R.save(),R.beginPath();const ut=s.Konva._fixTextRendering?Math.round(z/4):Math.round(z/2),Yt=ue,gn=se+Se+ut;R.moveTo(Yt,gn);const $t=xe===u&&!tt?we-$*2:Ee;R.lineTo(Yt+Math.round($t),gn),R.lineWidth=z/15;const Ws=this._getLinearGradient();R.strokeStyle=Ws||Re,R.stroke(),R.restore()}if(Qe){R.save(),R.beginPath();const ut=s.Konva._fixTextRendering?-Math.round(z/4):0;R.moveTo(ue,se+Se+ut);const Yt=xe===u&&!tt?we-$*2:Ee;R.lineTo(ue+Math.round(Yt),se+Se+ut),R.lineWidth=z/15;const gn=this._getLinearGradient();R.strokeStyle=gn||Re,R.stroke(),R.restore()}if(ie!==k&&(je!==0||xe===u)){const ut=me.split(" ").length-1,Yt=r(me);for(let gn=0;gn<Yt.length;gn++){const $t=Yt[gn];$t===" "&&!tt&&xe===u&&(ue+=(we-$*2-Ee)/ut),this._partialTextX=ue,this._partialTextY=se+Se,this._partialText=$t,R.fillStrokeShape(this),ue+=this.measureSize($t).width+je}}else je!==0&&R.setAttr("letterSpacing",`${je}px`),this._partialTextX=ue,this._partialTextY=se+Se,this._partialText=me,R.fillStrokeShape(this);R.restore(),H>1&&(se+=B)}}_hitFunc(R){const G=this.getWidth(),H=this.getHeight();R.beginPath(),R.rect(0,0,G,H),R.closePath(),R.fillStrokeShape(this)}setText(R){const G=e.Util._isString(R)?R:R==null?"":R+"";return this._setAttr(v,G),this}getWidth(){return this.attrs.width===l||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===l||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(R){var G,H,$,z,B,Y,ie,ge,xe,we,je;let Re=L(),Ct=this.fontSize(),Xe;Re.save(),Re.font=this._getContextFont(),Xe=Re.measureText(R),Re.restore();const Qe=Ct/100;return{actualBoundingBoxAscent:(G=Xe.actualBoundingBoxAscent)!==null&&G!==void 0?G:71.58203125*Qe,actualBoundingBoxDescent:(H=Xe.actualBoundingBoxDescent)!==null&&H!==void 0?H:0,actualBoundingBoxLeft:($=Xe.actualBoundingBoxLeft)!==null&&$!==void 0?$:-7.421875*Qe,actualBoundingBoxRight:(z=Xe.actualBoundingBoxRight)!==null&&z!==void 0?z:75.732421875*Qe,alphabeticBaseline:(B=Xe.alphabeticBaseline)!==null&&B!==void 0?B:0,emHeightAscent:(Y=Xe.emHeightAscent)!==null&&Y!==void 0?Y:100*Qe,emHeightDescent:(ie=Xe.emHeightDescent)!==null&&ie!==void 0?ie:-20*Qe,fontBoundingBoxAscent:(ge=Xe.fontBoundingBoxAscent)!==null&&ge!==void 0?ge:91*Qe,fontBoundingBoxDescent:(xe=Xe.fontBoundingBoxDescent)!==null&&xe!==void 0?xe:21*Qe,hangingBaseline:(we=Xe.hangingBaseline)!==null&&we!==void 0?we:72.80000305175781*Qe,ideographicBaseline:(je=Xe.ideographicBaseline)!==null&&je!==void 0?je:-21*Qe,width:Xe.width,height:Ct}}_getContextFont(){return this.fontStyle()+S+this.fontVariant()+S+(this.fontSize()+_)+F(this.fontFamily())}_addTextLine(R){this.align()===u&&(R=R.trim());const H=this._getTextWidth(R);return this.textArr.push({text:R,width:H,lastInParagraph:!1})}_getTextWidth(R){const G=this.letterSpacing(),H=R.length;return L().measureText(R).width+G*H}_setTextData(){let R=this.text().split(`
`),G=+this.fontSize(),H=0,$=this.lineHeight()*G,z=this.attrs.width,B=this.attrs.height,Y=z!==l&&z!==void 0,ie=B!==l&&B!==void 0,ge=this.padding(),xe=z-ge*2,we=B-ge*2,je=0,Re=this.wrap(),Ct=Re!==P,Xe=Re!==j&&Ct,Qe=this.ellipsis();this.textArr=[],L().font=this._getContextFont();const Dt=Qe?this._getTextWidth(D):0;for(let se=0,re=R.length;se<re;++se){let ue=R[se],Se=this._getTextWidth(ue);if(Y&&Se>xe)for(;ue.length>0;){let de=0,me=r(ue).length,Ee="",tt=0;for(;de<me;){const ut=de+me>>>1,Yt=r(ue),gn=Yt.slice(0,ut+1).join(""),$t=this._getTextWidth(gn);(Qe&&ie&&je+$>we?$t+Dt:$t)<=xe?(de=ut+1,Ee=gn,tt=$t):me=ut}if(Ee){if(Xe){const gn=r(ue),$t=r(Ee),Ws=gn[$t.length],Lo=Ws===S||Ws===f;let ki;if(Lo&&tt<=xe)ki=$t.length;else{const vr=$t.lastIndexOf(S),Da=$t.lastIndexOf(f);ki=Math.max(vr,Da)+1}ki>0&&(de=ki,Ee=gn.slice(0,de).join(""),tt=this._getTextWidth(Ee))}if(Ee=Ee.trimRight(),this._addTextLine(Ee),H=Math.max(H,tt),je+=$,this._shouldHandleEllipsis(je)){this._tryToAddEllipsisToLastLine();break}if(ue=r(ue).slice(de).join("").trimLeft(),ue.length>0&&(Se=this._getTextWidth(ue),Se<=xe)){this._addTextLine(ue),je+=$,H=Math.max(H,Se);break}}else break}else this._addTextLine(ue),je+=$,H=Math.max(H,Se),this._shouldHandleEllipsis(je)&&se<re-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),ie&&je+$>we)break}this.textHeight=G,this.textWidth=H}_shouldHandleEllipsis(R){const G=+this.fontSize(),H=this.lineHeight()*G,$=this.attrs.height,z=$!==l&&$!==void 0,B=this.padding(),Y=$-B*2;return!(this.wrap()!==P)||z&&R+H>Y}_tryToAddEllipsisToLastLine(){const R=this.attrs.width,G=R!==l&&R!==void 0,H=this.padding(),$=R-H*2,z=this.ellipsis(),B=this.textArr[this.textArr.length-1];!B||!z||(G&&(this._getTextWidth(B.text+D)<$||(B.text=B.text.slice(0,B.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(B.text+D))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const R=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,G=this.hasShadow();return R&&G?!0:super._useBufferCanvas()}}return dp.Text=Z,Z.prototype._fillFunc=V,Z.prototype._strokeFunc=K,Z.prototype.className=b,Z.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,o._registerNode)(Z),t.Factory.overWriteSetter(Z,"width",(0,i.getNumberOrAutoValidator)()),t.Factory.overWriteSetter(Z,"height",(0,i.getNumberOrAutoValidator)()),t.Factory.addGetterSetter(Z,"direction",d),t.Factory.addGetterSetter(Z,"fontFamily","Arial"),t.Factory.addGetterSetter(Z,"fontSize",12,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(Z,"fontStyle",w),t.Factory.addGetterSetter(Z,"fontVariant",w),t.Factory.addGetterSetter(Z,"padding",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(Z,"align",g),t.Factory.addGetterSetter(Z,"verticalAlign",C),t.Factory.addGetterSetter(Z,"lineHeight",1,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(Z,"wrap",E),t.Factory.addGetterSetter(Z,"ellipsis",!1,(0,i.getBooleanValidator)()),t.Factory.addGetterSetter(Z,"letterSpacing",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(Z,"text","",(0,i.getStringValidator)()),t.Factory.addGetterSetter(Z,"textDecoration",""),dp}var Dg={},qO;function pTe(){if(qO)return Dg;qO=1,Object.defineProperty(Dg,"__esModule",{value:!0}),Dg.TextPath=void 0;const e=Is(),t=en(),n=xi(),s=L4(),i=$Z(),o=nn(),r=Xt(),l="",c="normal";function d(m){m.fillText(this.partialText,0,0)}function u(m){m.strokeText(this.partialText,0,0)}let p=class extends n.Shape{constructor(f){super(f),this.dummyCanvas=e.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return s.Path.getPathLength(this.dataArray)}_getPointAtLength(f){if(!this.attrs.data)return null;const g=this.pathLength;return f-1>g?null:s.Path.getPointAtLengthOfDataArray(f,this.dataArray)}_readDataAttribute(){this.dataArray=s.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(f){f.setAttr("font",this._getContextFont()),f.setAttr("textBaseline",this.textBaseline()),f.setAttr("textAlign","left"),f.save();const g=this.textDecoration(),v=this.fill(),b=this.fontSize(),C=this.glyphInfo;g==="underline"&&f.beginPath();for(let y=0;y<C.length;y++){f.save();const x=C[y].p0;f.translate(x.x,x.y),f.rotate(C[y].rotation),this.partialText=C[y].text,f.fillStrokeShape(this),g==="underline"&&(y===0&&f.moveTo(0,b/2+1),f.lineTo(b,b/2+1)),f.restore()}g==="underline"&&(f.strokeStyle=v,f.lineWidth=b/20,f.stroke()),f.restore()}_hitFunc(f){f.beginPath();const g=this.glyphInfo;if(g.length>=1){const v=g[0].p0;f.moveTo(v.x,v.y)}for(let v=0;v<g.length;v++){const b=g[v].p1;f.lineTo(b.x,b.y)}f.setAttr("lineWidth",this.fontSize()),f.setAttr("strokeStyle",this.colorKey),f.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(f){return i.Text.prototype.setText.call(this,f)}_getContextFont(){return i.Text.prototype._getContextFont.call(this)}_getTextSize(f){const v=this.dummyCanvas.getContext("2d");v.save(),v.font=this._getContextFont();const b=v.measureText(f);return v.restore(),{width:b.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:f,height:g}=this._getTextSize(this.attrs.text);if(this.textWidth=f,this.textHeight=g,this.glyphInfo=[],!this.attrs.data)return null;const v=this.letterSpacing(),b=this.align(),C=this.kerningFunc(),y=Math.max(this.textWidth+((this.attrs.text||"").length-1)*v,0);let x=0;b==="center"&&(x=Math.max(0,this.pathLength/2-y/2)),b==="right"&&(x=Math.max(0,this.pathLength-y));const w=(0,i.stringToArray)(this.text());let _=x;for(let S=0;S<w.length;S++){const I=this._getPointAtLength(_);if(!I)return;let k=this._getTextSize(w[S]).width+v;if(w[S]===" "&&b==="justify"){const N=this.text().split(" ").length-1;k+=(this.pathLength-y)/N}const E=this._getPointAtLength(_+k);if(!E)return;const j=s.Path.getLineLength(I.x,I.y,E.x,E.y);let P=0;if(C)try{P=C(w[S-1],w[S])*this.fontSize()}catch{P=0}I.x+=P,E.x+=P,this.textWidth+=P;const D=s.Path.getPointOnLine(P+j/2,I.x,I.y,E.x,E.y),O=Math.atan2(E.y-I.y,E.x-I.x);this.glyphInfo.push({transposeX:D.x,transposeY:D.y,text:w[S],rotation:O,p0:I,p1:E}),_+=k}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const f=[];this.glyphInfo.forEach(function(_){f.push(_.p0.x),f.push(_.p0.y),f.push(_.p1.x),f.push(_.p1.y)});let g=f[0]||0,v=f[0]||0,b=f[1]||0,C=f[1]||0,y,x;for(let _=0;_<f.length/2;_++)y=f[_*2],x=f[_*2+1],g=Math.min(g,y),v=Math.max(v,y),b=Math.min(b,x),C=Math.max(C,x);const w=this.fontSize();return{x:g-w/2,y:b-w/2,width:v-g+w,height:C-b+w}}destroy(){return e.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return Dg.TextPath=p,p.prototype._fillFunc=d,p.prototype._strokeFunc=u,p.prototype._fillFuncHit=d,p.prototype._strokeFuncHit=u,p.prototype.className="TextPath",p.prototype._attrsAffectingSize=["text","fontSize","data"],(0,r._registerNode)(p),t.Factory.addGetterSetter(p,"data"),t.Factory.addGetterSetter(p,"fontFamily","Arial"),t.Factory.addGetterSetter(p,"fontSize",12,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(p,"fontStyle",c),t.Factory.addGetterSetter(p,"align","left"),t.Factory.addGetterSetter(p,"letterSpacing",0,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(p,"textBaseline","middle"),t.Factory.addGetterSetter(p,"fontVariant",c),t.Factory.addGetterSetter(p,"text",l),t.Factory.addGetterSetter(p,"textDecoration",""),t.Factory.addGetterSetter(p,"kerningFunc",void 0),Dg}var Mg={},KO;function fTe(){if(KO)return Mg;KO=1,Object.defineProperty(Mg,"__esModule",{value:!0}),Mg.Transformer=void 0;const e=Is(),t=en(),n=Rs(),s=xi(),i=VZ(),o=D4(),r=Xt(),l=nn(),c=Xt(),d="tr-konva",u=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(k=>k+`.${d}`).join(" "),p="nodesRect",m=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],f={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},g="ontouchstart"in r.Konva._global;function v(k,E,j){if(k==="rotater")return j;E+=e.Util.degToRad(f[k]||0);const P=(e.Util.radToDeg(E)%360+360)%360;return e.Util._inRange(P,315+22.5,360)||e.Util._inRange(P,0,22.5)?"ns-resize":e.Util._inRange(P,45-22.5,45+22.5)?"nesw-resize":e.Util._inRange(P,90-22.5,90+22.5)?"ew-resize":e.Util._inRange(P,135-22.5,135+22.5)?"nwse-resize":e.Util._inRange(P,180-22.5,180+22.5)?"ns-resize":e.Util._inRange(P,225-22.5,225+22.5)?"nesw-resize":e.Util._inRange(P,270-22.5,270+22.5)?"ew-resize":e.Util._inRange(P,315-22.5,315+22.5)?"nwse-resize":(e.Util.error("Transformer has unknown angle for cursor detection: "+P),"pointer")}const b=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function C(k){return{x:k.x+k.width/2*Math.cos(k.rotation)+k.height/2*Math.sin(-k.rotation),y:k.y+k.height/2*Math.cos(k.rotation)+k.width/2*Math.sin(k.rotation)}}function y(k,E,j){const P=j.x+(k.x-j.x)*Math.cos(E)-(k.y-j.y)*Math.sin(E),D=j.y+(k.x-j.x)*Math.sin(E)+(k.y-j.y)*Math.cos(E);return{...k,rotation:k.rotation+E,x:P,y:D}}function x(k,E){const j=C(k);return y(k,E,j)}function w(k,E,j){let P=E;for(let D=0;D<k.length;D++){const O=r.Konva.getAngle(k[D]),N=Math.abs(O-E)%(Math.PI*2);Math.min(N,Math.PI*2-N)<j&&(P=O)}return P}let _=0,S=class extends o.Group{constructor(E){super(E),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(u,this.update),this.getNode()&&this.update()}attachTo(E){return this.setNode(E),this}setNode(E){return e.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([E])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return d+this._id}setNodes(E=[]){this._nodes&&this._nodes.length&&this.detach();const j=E.filter(D=>D.isAncestorOf(this)?(e.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=E=j,E.length===1&&this.useSingleNodeRotation()?this.rotation(E[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(D=>{const O=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(D._attrsAffectingSize.length){const N=D._attrsAffectingSize.map(F=>F+"Change."+this._getEventNamespace()).join(" ");D.on(N,O)}D.on(m.map(N=>N+`.${this._getEventNamespace()}`).join(" "),O),D.on(`absoluteTransformChange.${this._getEventNamespace()}`,O),this._proxyDrag(D)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(E){let j;E.on(`dragstart.${this._getEventNamespace()}`,P=>{j=E.getAbsolutePosition(),!this.isDragging()&&E!==this.findOne(".back")&&this.startDrag(P,!1)}),E.on(`dragmove.${this._getEventNamespace()}`,P=>{if(!j)return;const D=E.getAbsolutePosition(),O=D.x-j.x,N=D.y-j.y;this.nodes().forEach(F=>{if(F===E||F.isDragging())return;const X=F.getAbsolutePosition();F.setAbsolutePosition({x:X.x+O,y:X.y+N}),F.startDrag(P)}),j=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(E=>{E.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(p),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(p,this.__getNodeRect)}__getNodeShape(E,j=this.rotation(),P){const D=E.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),O=E.getAbsoluteScale(P),N=E.getAbsolutePosition(P),F=D.x*O.x-E.offsetX()*O.x,X=D.y*O.y-E.offsetY()*O.y,L=(r.Konva.getAngle(E.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),V={x:N.x+F*Math.cos(L)+X*Math.sin(-L),y:N.y+X*Math.cos(L)+F*Math.sin(L),width:D.width*O.x,height:D.height*O.y,rotation:L};return y(V,-r.Konva.getAngle(j),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const j=[];this.nodes().map(L=>{const V=L.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),K=[{x:V.x,y:V.y},{x:V.x+V.width,y:V.y},{x:V.x+V.width,y:V.y+V.height},{x:V.x,y:V.y+V.height}],U=L.getAbsoluteTransform();K.forEach(function(Z){const W=U.point(Z);j.push(W)})});const P=new e.Transform;P.rotate(-r.Konva.getAngle(this.rotation()));let D=1/0,O=1/0,N=-1/0,F=-1/0;j.forEach(function(L){const V=P.point(L);D===void 0&&(D=N=V.x,O=F=V.y),D=Math.min(D,V.x),O=Math.min(O,V.y),N=Math.max(N,V.x),F=Math.max(F,V.y)}),P.invert();const X=P.point({x:D,y:O});return{x:X.x,y:X.y,width:N-D,height:F-O,rotation:r.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),b.forEach(E=>{this._createAnchor(E)}),this._createAnchor("rotater")}_createAnchor(E){const j=new i.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:E+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:g?10:"auto"}),P=this;j.on("mousedown touchstart",function(D){P._handleMouseDown(D)}),j.on("dragstart",D=>{j.stopDrag(),D.cancelBubble=!0}),j.on("dragend",D=>{D.cancelBubble=!0}),j.on("mouseenter",()=>{const D=r.Konva.getAngle(this.rotation()),O=this.rotateAnchorCursor(),N=v(E,D,O);j.getStage().content&&(j.getStage().content.style.cursor=N),this._cursorChange=!0}),j.on("mouseout",()=>{j.getStage().content&&(j.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(j)}_createBack(){const E=new s.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(j,P){const D=P.getParent(),O=D.padding();j.beginPath(),j.rect(-O,-O,P.width()+O*2,P.height()+O*2),j.moveTo(P.width()/2,-O),D.rotateEnabled()&&D.rotateLineVisible()&&j.lineTo(P.width()/2,-D.rotateAnchorOffset()*e.Util._sign(P.height())-O),j.fillStrokeShape(P)},hitFunc:(j,P)=>{if(!this.shouldOverdrawWholeArea())return;const D=this.padding();j.beginPath(),j.rect(-D,-D,P.width()+D*2,P.height()+D*2),j.fillStrokeShape(P)}});this.add(E),this._proxyDrag(E),E.on("dragstart",j=>{j.cancelBubble=!0}),E.on("dragmove",j=>{j.cancelBubble=!0}),E.on("dragend",j=>{j.cancelBubble=!0}),this.on("dragmove",j=>{this.update()})}_handleMouseDown(E){if(this._transforming)return;this._movingAnchorName=E.target.name().split(" ")[0];const j=this._getNodeRect(),P=j.width,D=j.height,O=Math.sqrt(Math.pow(P,2)+Math.pow(D,2));this.sin=Math.abs(D/O),this.cos=Math.abs(P/O),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const N=E.target.getAbsolutePosition(),F=E.target.getStage().getPointerPosition();this._anchorDragOffset={x:F.x-N.x,y:F.y-N.y},_++,this._fire("transformstart",{evt:E.evt,target:this.getNode()}),this._nodes.forEach(X=>{X._fire("transformstart",{evt:E.evt,target:X})})}_handleMouseMove(E){let j,P,D;const O=this.findOne("."+this._movingAnchorName),N=O.getStage();N.setPointersPositions(E);const F=N.getPointerPosition();let X={x:F.x-this._anchorDragOffset.x,y:F.y-this._anchorDragOffset.y};const L=O.getAbsolutePosition();this.anchorDragBoundFunc()&&(X=this.anchorDragBoundFunc()(L,X,E)),O.setAbsolutePosition(X);const V=O.getAbsolutePosition();if(L.x===V.x&&L.y===V.y)return;if(this._movingAnchorName==="rotater"){const $=this._getNodeRect();j=O.x()-$.width/2,P=-O.y()+$.height/2;let z=Math.atan2(-P,j)+Math.PI/2;$.height<0&&(z-=Math.PI);const Y=r.Konva.getAngle(this.rotation())+z,ie=r.Konva.getAngle(this.rotationSnapTolerance()),xe=w(this.rotationSnaps(),Y,ie)-$.rotation,we=x($,xe);this._fitNodesInto(we,E);return}const K=this.shiftBehavior();let U;K==="inverted"?U=this.keepRatio()&&!E.shiftKey:K==="none"?U=this.keepRatio():U=this.keepRatio()||E.shiftKey;let Z=this.centeredScaling()||E.altKey;if(this._movingAnchorName==="top-left"){if(U){const $=Z?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};D=Math.sqrt(Math.pow($.x-O.x(),2)+Math.pow($.y-O.y(),2));const z=this.findOne(".top-left").x()>$.x?-1:1,B=this.findOne(".top-left").y()>$.y?-1:1;j=D*this.cos*z,P=D*this.sin*B,this.findOne(".top-left").x($.x-j),this.findOne(".top-left").y($.y-P)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(O.y());else if(this._movingAnchorName==="top-right"){if(U){const $=Z?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};D=Math.sqrt(Math.pow(O.x()-$.x,2)+Math.pow($.y-O.y(),2));const z=this.findOne(".top-right").x()<$.x?-1:1,B=this.findOne(".top-right").y()>$.y?-1:1;j=D*this.cos*z,P=D*this.sin*B,this.findOne(".top-right").x($.x+j),this.findOne(".top-right").y($.y-P)}var W=O.position();this.findOne(".top-left").y(W.y),this.findOne(".bottom-right").x(W.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(O.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(O.x());else if(this._movingAnchorName==="bottom-left"){if(U){const $=Z?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};D=Math.sqrt(Math.pow($.x-O.x(),2)+Math.pow(O.y()-$.y,2));const z=$.x<O.x()?-1:1,B=O.y()<$.y?-1:1;j=D*this.cos*z,P=D*this.sin*B,O.x($.x-j),O.y($.y+P)}W=O.position(),this.findOne(".top-left").x(W.x),this.findOne(".bottom-right").y(W.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(O.y());else if(this._movingAnchorName==="bottom-right"){if(U){const $=Z?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};D=Math.sqrt(Math.pow(O.x()-$.x,2)+Math.pow(O.y()-$.y,2));const z=this.findOne(".bottom-right").x()<$.x?-1:1,B=this.findOne(".bottom-right").y()<$.y?-1:1;j=D*this.cos*z,P=D*this.sin*B,this.findOne(".bottom-right").x($.x+j),this.findOne(".bottom-right").y($.y+P)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(Z=this.centeredScaling()||E.altKey,Z){const $=this.findOne(".top-left"),z=this.findOne(".bottom-right"),B=$.x(),Y=$.y(),ie=this.getWidth()-z.x(),ge=this.getHeight()-z.y();z.move({x:-B,y:-Y}),$.move({x:ie,y:ge})}const R=this.findOne(".top-left").getAbsolutePosition();j=R.x,P=R.y;const G=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),H=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:j,y:P,width:G,height:H,rotation:r.Konva.getAngle(this.rotation())},E)}_handleMouseUp(E){this._removeEvents(E)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(E){var j;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const P=this.getNode();_--,this._fire("transformend",{evt:E,target:P}),(j=this.getLayer())===null||j===void 0||j.batchDraw(),P&&this._nodes.forEach(D=>{var O;D._fire("transformend",{evt:E,target:D}),(O=D.getLayer())===null||O===void 0||O.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(E,j){const P=this._getNodeRect(),D=1;if(e.Util._inRange(E.width,-this.padding()*2-D,D)){this.update();return}if(e.Util._inRange(E.height,-this.padding()*2-D,D)){this.update();return}const O=new e.Transform;if(O.rotate(r.Konva.getAngle(this.rotation())),this._movingAnchorName&&E.width<0&&this._movingAnchorName.indexOf("left")>=0){const U=O.point({x:-this.padding()*2,y:0});E.x+=U.x,E.y+=U.y,E.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=U.x,this._anchorDragOffset.y-=U.y}else if(this._movingAnchorName&&E.width<0&&this._movingAnchorName.indexOf("right")>=0){const U=O.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=U.x,this._anchorDragOffset.y-=U.y,E.width+=this.padding()*2}if(this._movingAnchorName&&E.height<0&&this._movingAnchorName.indexOf("top")>=0){const U=O.point({x:0,y:-this.padding()*2});E.x+=U.x,E.y+=U.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=U.x,this._anchorDragOffset.y-=U.y,E.height+=this.padding()*2}else if(this._movingAnchorName&&E.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const U=O.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=U.x,this._anchorDragOffset.y-=U.y,E.height+=this.padding()*2}if(this.boundBoxFunc()){const U=this.boundBoxFunc()(P,E);U?E=U:e.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const N=1e7,F=new e.Transform;F.translate(P.x,P.y),F.rotate(P.rotation),F.scale(P.width/N,P.height/N);const X=new e.Transform,L=E.width/N,V=E.height/N;this.flipEnabled()===!1?(X.translate(E.x,E.y),X.rotate(E.rotation),X.translate(E.width<0?E.width:0,E.height<0?E.height:0),X.scale(Math.abs(L),Math.abs(V))):(X.translate(E.x,E.y),X.rotate(E.rotation),X.scale(L,V));const K=X.multiply(F.invert());this._nodes.forEach(U=>{var Z;const W=U.getParent().getAbsoluteTransform(),R=U.getTransform().copy();R.translate(U.offsetX(),U.offsetY());const G=new e.Transform;G.multiply(W.copy().invert()).multiply(K).multiply(W).multiply(R);const H=G.decompose();U.setAttrs(H),(Z=U.getLayer())===null||Z===void 0||Z.batchDraw()}),this.rotation(e.Util._getRotation(E.rotation)),this._nodes.forEach(U=>{this._fire("transform",{evt:j,target:U}),U._fire("transform",{evt:j,target:U})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(E,j){this.findOne(E).setAttrs(j)}update(){var E;const j=this._getNodeRect();this.rotation(e.Util._getRotation(j.rotation));const P=j.width,D=j.height,O=this.enabledAnchors(),N=this.resizeEnabled(),F=this.padding(),X=this.anchorSize(),L=this.find("._anchor");L.forEach(K=>{K.setAttrs({width:X,height:X,offsetX:X/2,offsetY:X/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:X/2+F,offsetY:X/2+F,visible:N&&O.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:P/2,y:0,offsetY:X/2+F,visible:N&&O.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:P,y:0,offsetX:X/2-F,offsetY:X/2+F,visible:N&&O.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:D/2,offsetX:X/2+F,visible:N&&O.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:P,y:D/2,offsetX:X/2-F,visible:N&&O.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:D,offsetX:X/2+F,offsetY:X/2-F,visible:N&&O.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:P/2,y:D,offsetY:X/2-F,visible:N&&O.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:P,y:D,offsetX:X/2-F,offsetY:X/2-F,visible:N&&O.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:P/2,y:-this.rotateAnchorOffset()*e.Util._sign(D)-F,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:P,height:D,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const V=this.anchorStyleFunc();V&&L.forEach(K=>{V(K)}),(E=this.getLayer())===null||E===void 0||E.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const E=this.findOne("."+this._movingAnchorName);E&&E.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),o.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return n.Node.prototype.toObject.call(this)}clone(E){return n.Node.prototype.clone.call(this,E)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};Mg.Transformer=S,S.isTransforming=()=>_>0;function I(k){return k instanceof Array||e.Util.warn("enabledAnchors value should be an array"),k instanceof Array&&k.forEach(function(E){b.indexOf(E)===-1&&e.Util.warn("Unknown anchor name: "+E+". Available names are: "+b.join(", "))}),k||[]}return S.prototype.className="Transformer",(0,c._registerNode)(S),t.Factory.addGetterSetter(S,"enabledAnchors",b,I),t.Factory.addGetterSetter(S,"flipEnabled",!0,(0,l.getBooleanValidator)()),t.Factory.addGetterSetter(S,"resizeEnabled",!0),t.Factory.addGetterSetter(S,"anchorSize",10,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"rotateEnabled",!0),t.Factory.addGetterSetter(S,"rotateLineVisible",!0),t.Factory.addGetterSetter(S,"rotationSnaps",[]),t.Factory.addGetterSetter(S,"rotateAnchorOffset",50,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"rotateAnchorCursor","crosshair"),t.Factory.addGetterSetter(S,"rotationSnapTolerance",5,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"borderEnabled",!0),t.Factory.addGetterSetter(S,"anchorStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(S,"anchorStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"anchorFill","white"),t.Factory.addGetterSetter(S,"anchorCornerRadius",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"borderStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(S,"borderStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"borderDash"),t.Factory.addGetterSetter(S,"keepRatio",!0),t.Factory.addGetterSetter(S,"shiftBehavior","default"),t.Factory.addGetterSetter(S,"centeredScaling",!1),t.Factory.addGetterSetter(S,"ignoreStroke",!1),t.Factory.addGetterSetter(S,"padding",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(S,"nodes"),t.Factory.addGetterSetter(S,"node"),t.Factory.addGetterSetter(S,"boundBoxFunc"),t.Factory.addGetterSetter(S,"anchorDragBoundFunc"),t.Factory.addGetterSetter(S,"anchorStyleFunc"),t.Factory.addGetterSetter(S,"shouldOverdrawWholeArea",!1),t.Factory.addGetterSetter(S,"useSingleNodeRotation",!0),t.Factory.backCompat(S,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),Mg}var Lg={},ZO;function mTe(){if(ZO)return Lg;ZO=1,Object.defineProperty(Lg,"__esModule",{value:!0}),Lg.Wedge=void 0;const e=en(),t=xi(),n=Xt(),s=nn(),i=Xt();let o=class extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.radius(),0,n.Konva.getAngle(this.angle()),this.clockwise()),l.lineTo(0,0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(l){this.radius(l/2)}setHeight(l){this.radius(l/2)}};return Lg.Wedge=o,o.prototype.className="Wedge",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["radius"],(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"radius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"angle",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"clockwise",!1),e.Factory.backCompat(o,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Lg}var Rg={},XO;function gTe(){if(XO)return Rg;XO=1,Object.defineProperty(Rg,"__esModule",{value:!0}),Rg.Blur=void 0;const e=en(),t=Rs(),n=nn();function s(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function r(c,d){const u=c.data,p=c.width,m=c.height;let f,g,v,b,C,y,x,w,_,S,I,k,E,j,P,D,O,N,F,X;const L=d+d+1,V=p-1,K=m-1,U=d+1,Z=U*(U+1)/2,W=new s,R=i[d],G=o[d];let H=null,$=W,z=null,B=null;for(let Y=1;Y<L;Y++)$=$.next=new s,Y===U&&(H=$);$.next=W,v=g=0;for(let Y=0;Y<m;Y++){k=E=j=P=b=C=y=x=0,w=U*(D=u[g]),_=U*(O=u[g+1]),S=U*(N=u[g+2]),I=U*(F=u[g+3]),b+=Z*D,C+=Z*O,y+=Z*N,x+=Z*F,$=W;for(let ie=0;ie<U;ie++)$.r=D,$.g=O,$.b=N,$.a=F,$=$.next;for(let ie=1;ie<U;ie++)f=g+((V<ie?V:ie)<<2),b+=($.r=D=u[f])*(X=U-ie),C+=($.g=O=u[f+1])*X,y+=($.b=N=u[f+2])*X,x+=($.a=F=u[f+3])*X,k+=D,E+=O,j+=N,P+=F,$=$.next;z=W,B=H;for(let ie=0;ie<p;ie++)u[g+3]=F=x*R>>G,F!==0?(F=255/F,u[g]=(b*R>>G)*F,u[g+1]=(C*R>>G)*F,u[g+2]=(y*R>>G)*F):u[g]=u[g+1]=u[g+2]=0,b-=w,C-=_,y-=S,x-=I,w-=z.r,_-=z.g,S-=z.b,I-=z.a,f=v+((f=ie+d+1)<V?f:V)<<2,k+=z.r=u[f],E+=z.g=u[f+1],j+=z.b=u[f+2],P+=z.a=u[f+3],b+=k,C+=E,y+=j,x+=P,z=z.next,w+=D=B.r,_+=O=B.g,S+=N=B.b,I+=F=B.a,k-=D,E-=O,j-=N,P-=F,B=B.next,g+=4;v+=p}for(let Y=0;Y<p;Y++){E=j=P=k=C=y=x=b=0,g=Y<<2,w=U*(D=u[g]),_=U*(O=u[g+1]),S=U*(N=u[g+2]),I=U*(F=u[g+3]),b+=Z*D,C+=Z*O,y+=Z*N,x+=Z*F,$=W;for(let ge=0;ge<U;ge++)$.r=D,$.g=O,$.b=N,$.a=F,$=$.next;let ie=p;for(let ge=1;ge<=d;ge++)g=ie+Y<<2,b+=($.r=D=u[g])*(X=U-ge),C+=($.g=O=u[g+1])*X,y+=($.b=N=u[g+2])*X,x+=($.a=F=u[g+3])*X,k+=D,E+=O,j+=N,P+=F,$=$.next,ge<K&&(ie+=p);g=Y,z=W,B=H;for(let ge=0;ge<m;ge++)f=g<<2,u[f+3]=F=x*R>>G,F>0?(F=255/F,u[f]=(b*R>>G)*F,u[f+1]=(C*R>>G)*F,u[f+2]=(y*R>>G)*F):u[f]=u[f+1]=u[f+2]=0,b-=w,C-=_,y-=S,x-=I,w-=z.r,_-=z.g,S-=z.b,I-=z.a,f=Y+((f=ge+U)<K?f:K)*p<<2,b+=k+=z.r=u[f],C+=E+=z.g=u[f+1],y+=j+=z.b=u[f+2],x+=P+=z.a=u[f+3],z=z.next,w+=D=B.r,_+=O=B.g,S+=N=B.b,I+=F=B.a,k-=D,E-=O,j-=N,P-=F,B=B.next,g+=p}}const l=function(d){const u=Math.round(this.blurRadius());u>0&&r(d,u)};return Rg.Blur=l,e.Factory.addGetterSetter(t.Node,"blurRadius",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Rg}var Og={},YO;function vTe(){if(YO)return Og;YO=1,Object.defineProperty(Og,"__esModule",{value:!0}),Og.Brighten=void 0;const e=en(),t=Rs(),n=nn(),s=function(i){const o=this.brightness()*255,r=i.data,l=r.length;for(let c=0;c<l;c+=4)r[c]+=o,r[c+1]+=o,r[c+2]+=o};return Og.Brighten=s,e.Factory.addGetterSetter(t.Node,"brightness",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Og}var Ng={},QO;function yTe(){if(QO)return Ng;QO=1,Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.Contrast=void 0;const e=en(),t=Rs(),n=nn(),s=function(i){const o=Math.pow((this.contrast()+100)/100,2),r=i.data,l=r.length;let c=150,d=150,u=150;for(let p=0;p<l;p+=4)c=r[p],d=r[p+1],u=r[p+2],c/=255,c-=.5,c*=o,c+=.5,c*=255,d/=255,d-=.5,d*=o,d+=.5,d*=255,u/=255,u-=.5,u*=o,u+=.5,u*=255,c=c<0?0:c>255?255:c,d=d<0?0:d>255?255:d,u=u<0?0:u>255?255:u,r[p]=c,r[p+1]=d,r[p+2]=u};return Ng.Contrast=s,e.Factory.addGetterSetter(t.Node,"contrast",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Ng}var Fg={},JO;function bTe(){if(JO)return Fg;JO=1,Object.defineProperty(Fg,"__esModule",{value:!0}),Fg.Emboss=void 0;const e=en(),t=Rs(),n=Is(),s=nn(),i=function(o){const r=this.embossStrength()*10,l=this.embossWhiteLevel()*255,c=this.embossDirection(),d=this.embossBlend(),u=o.data,p=o.width,m=o.height,f=p*4;let g=0,v=0,b=m;switch(c){case"top-left":g=-1,v=-1;break;case"top":g=-1,v=0;break;case"top-right":g=-1,v=1;break;case"right":g=0,v=1;break;case"bottom-right":g=1,v=1;break;case"bottom":g=1,v=0;break;case"bottom-left":g=1,v=-1;break;case"left":g=0,v=-1;break;default:n.Util.error("Unknown emboss direction: "+c)}do{const C=(b-1)*f;let y=g;b+y<1&&(y=0),b+y>m&&(y=0);const x=(b-1+y)*p*4;let w=p;do{const _=C+(w-1)*4;let S=v;w+S<1&&(S=0),w+S>p&&(S=0);const I=x+(w-1+S)*4,k=u[_]-u[I],E=u[_+1]-u[I+1],j=u[_+2]-u[I+2];let P=k;const D=P>0?P:-P,O=E>0?E:-E,N=j>0?j:-j;if(O>D&&(P=E),N>D&&(P=j),P*=r,d){const F=u[_]+P,X=u[_+1]+P,L=u[_+2]+P;u[_]=F>255?255:F<0?0:F,u[_+1]=X>255?255:X<0?0:X,u[_+2]=L>255?255:L<0?0:L}else{let F=l-P;F<0?F=0:F>255&&(F=255),u[_]=u[_+1]=u[_+2]=F}}while(--w)}while(--b)};return Fg.Emboss=i,e.Factory.addGetterSetter(t.Node,"embossStrength",.5,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossWhiteLevel",.5,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossDirection","top-left",void 0,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossBlend",!1,void 0,e.Factory.afterSetFilter),Fg}var Bg={},eN;function xTe(){if(eN)return Bg;eN=1,Object.defineProperty(Bg,"__esModule",{value:!0}),Bg.Enhance=void 0;const e=en(),t=Rs(),n=nn();function s(o,r,l,c,d){const u=l-r,p=d-c;if(u===0)return c+p/2;if(p===0)return c;let m=(o-r)/u;return m=p*m+c,m}const i=function(o){const r=o.data,l=r.length;let c=r[0],d=c,u,p=r[1],m=p,f,g=r[2],v=g,b;const C=this.enhance();if(C===0)return;for(let k=0;k<l;k+=4)u=r[k+0],u<c?c=u:u>d&&(d=u),f=r[k+1],f<p?p=f:f>m&&(m=f),b=r[k+2],b<g?g=b:b>v&&(v=b);d===c&&(d=255,c=0),m===p&&(m=255,p=0),v===g&&(v=255,g=0);let y,x,w,_,S,I;if(C>0)y=d+C*(255-d),x=c-C*(c-0),w=m+C*(255-m),_=p-C*(p-0),S=v+C*(255-v),I=g-C*(g-0);else{const k=(d+c)*.5;y=d+C*(d-k),x=c+C*(c-k);const E=(m+p)*.5;w=m+C*(m-E),_=p+C*(p-E);const j=(v+g)*.5;S=v+C*(v-j),I=g+C*(g-j)}for(let k=0;k<l;k+=4)r[k+0]=s(r[k+0],c,d,x,y),r[k+1]=s(r[k+1],p,m,_,w),r[k+2]=s(r[k+2],g,v,I,S)};return Bg.Enhance=i,e.Factory.addGetterSetter(t.Node,"enhance",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Bg}var zg={},tN;function CTe(){if(tN)return zg;tN=1,Object.defineProperty(zg,"__esModule",{value:!0}),zg.Grayscale=void 0;const e=function(t){const n=t.data,s=n.length;for(let i=0;i<s;i+=4){const o=.34*n[i]+.5*n[i+1]+.16*n[i+2];n[i]=o,n[i+1]=o,n[i+2]=o}};return zg.Grayscale=e,zg}var Vg={},nN;function wTe(){if(nN)return Vg;nN=1,Object.defineProperty(Vg,"__esModule",{value:!0}),Vg.HSL=void 0;const e=en(),t=Rs(),n=nn();e.Factory.addGetterSetter(t.Node,"hue",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"luminance",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter);const s=function(i){const o=i.data,r=o.length,l=1,c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,u=this.luminance()*127,p=l*c*Math.cos(d*Math.PI/180),m=l*c*Math.sin(d*Math.PI/180),f=.299*l+.701*p+.167*m,g=.587*l-.587*p+.33*m,v=.114*l-.114*p-.497*m,b=.299*l-.299*p-.328*m,C=.587*l+.413*p+.035*m,y=.114*l-.114*p+.293*m,x=.299*l-.3*p+1.25*m,w=.587*l-.586*p-1.05*m,_=.114*l+.886*p-.2*m;let S,I,k,E;for(let j=0;j<r;j+=4)S=o[j+0],I=o[j+1],k=o[j+2],E=o[j+3],o[j+0]=f*S+g*I+v*k+u,o[j+1]=b*S+C*I+y*k+u,o[j+2]=x*S+w*I+_*k+u,o[j+3]=E};return Vg.HSL=s,Vg}var $g={},sN;function _Te(){if(sN)return $g;sN=1,Object.defineProperty($g,"__esModule",{value:!0}),$g.HSV=void 0;const e=en(),t=Rs(),n=nn(),s=function(i){const o=i.data,r=o.length,l=Math.pow(2,this.value()),c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,u=l*c*Math.cos(d*Math.PI/180),p=l*c*Math.sin(d*Math.PI/180),m=.299*l+.701*u+.167*p,f=.587*l-.587*u+.33*p,g=.114*l-.114*u-.497*p,v=.299*l-.299*u-.328*p,b=.587*l+.413*u+.035*p,C=.114*l-.114*u+.293*p,y=.299*l-.3*u+1.25*p,x=.587*l-.586*u-1.05*p,w=.114*l+.886*u-.2*p;for(let _=0;_<r;_+=4){const S=o[_+0],I=o[_+1],k=o[_+2],E=o[_+3];o[_+0]=m*S+f*I+g*k,o[_+1]=v*S+b*I+C*k,o[_+2]=y*S+x*I+w*k,o[_+3]=E}};return $g.HSV=s,e.Factory.addGetterSetter(t.Node,"hue",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"value",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),$g}var Gg={},iN;function STe(){if(iN)return Gg;iN=1,Object.defineProperty(Gg,"__esModule",{value:!0}),Gg.Invert=void 0;const e=function(t){const n=t.data,s=n.length;for(let i=0;i<s;i+=4)n[i]=255-n[i],n[i+1]=255-n[i+1],n[i+2]=255-n[i+2]};return Gg.Invert=e,Gg}var Hg={},oN;function kTe(){if(oN)return Hg;oN=1,Object.defineProperty(Hg,"__esModule",{value:!0}),Hg.Kaleidoscope=void 0;const e=en(),t=Rs(),n=Is(),s=nn(),i=function(l,c,d){const u=l.data,p=c.data,m=l.width,f=l.height,g=d.polarCenterX||m/2,v=d.polarCenterY||f/2;let b=Math.sqrt(g*g+v*v),C=m-g,y=f-v;const x=Math.sqrt(C*C+y*y);b=x>b?x:b;const w=f,_=m,S=360/_*Math.PI/180;for(let I=0;I<_;I+=1){const k=Math.sin(I*S),E=Math.cos(I*S);for(let j=0;j<w;j+=1){C=Math.floor(g+b*j/w*E),y=Math.floor(v+b*j/w*k);let P=(y*m+C)*4;const D=u[P+0],O=u[P+1],N=u[P+2],F=u[P+3];P=(I+j*m)*4,p[P+0]=D,p[P+1]=O,p[P+2]=N,p[P+3]=F}}},o=function(l,c,d){const u=l.data,p=c.data,m=l.width,f=l.height,g=d.polarCenterX||m/2,v=d.polarCenterY||f/2;let b=Math.sqrt(g*g+v*v),C=m-g,y=f-v;const x=Math.sqrt(C*C+y*y);b=x>b?x:b;const w=f,_=m,S=0;let I,k;for(C=0;C<m;C+=1)for(y=0;y<f;y+=1){const E=C-g,j=y-v,P=Math.sqrt(E*E+j*j)*w/b;let D=(Math.atan2(j,E)*180/Math.PI+360+S)%360;D=D*_/360,I=Math.floor(D),k=Math.floor(P);let O=(k*m+I)*4;const N=u[O+0],F=u[O+1],X=u[O+2],L=u[O+3];O=(y*m+C)*4,p[O+0]=N,p[O+1]=F,p[O+2]=X,p[O+3]=L}},r=function(l){const c=l.width,d=l.height;let u,p,m,f,g,v,b,C,y,x,w=Math.round(this.kaleidoscopePower());const _=Math.round(this.kaleidoscopeAngle()),S=Math.floor(c*(_%360)/360);if(w<1)return;const I=n.Util.createCanvasElement();I.width=c,I.height=d;const k=I.getContext("2d").getImageData(0,0,c,d);n.Util.releaseCanvas(I),i(l,k,{polarCenterX:c/2,polarCenterY:d/2});let E=c/Math.pow(2,w);for(;E<=8;)E=E*2,w-=1;E=Math.ceil(E);let j=E,P=0,D=j,O=1;for(S+E>c&&(P=j,D=0,O=-1),p=0;p<d;p+=1)for(u=P;u!==D;u+=O)m=Math.round(u+S)%c,y=(c*p+m)*4,g=k.data[y+0],v=k.data[y+1],b=k.data[y+2],C=k.data[y+3],x=(c*p+u)*4,k.data[x+0]=g,k.data[x+1]=v,k.data[x+2]=b,k.data[x+3]=C;for(p=0;p<d;p+=1)for(j=Math.floor(E),f=0;f<w;f+=1){for(u=0;u<j+1;u+=1)y=(c*p+u)*4,g=k.data[y+0],v=k.data[y+1],b=k.data[y+2],C=k.data[y+3],x=(c*p+j*2-u-1)*4,k.data[x+0]=g,k.data[x+1]=v,k.data[x+2]=b,k.data[x+3]=C;j*=2}o(k,l,{})};return Hg.Kaleidoscope=r,e.Factory.addGetterSetter(t.Node,"kaleidoscopePower",2,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"kaleidoscopeAngle",0,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),Hg}var Wg={},aN;function ITe(){if(aN)return Wg;aN=1,Object.defineProperty(Wg,"__esModule",{value:!0}),Wg.Mask=void 0;const e=en(),t=Rs(),n=nn();function s(m,f,g){let v=(g*m.width+f)*4;const b=[];return b.push(m.data[v++],m.data[v++],m.data[v++],m.data[v++]),b}function i(m,f){return Math.sqrt(Math.pow(m[0]-f[0],2)+Math.pow(m[1]-f[1],2)+Math.pow(m[2]-f[2],2))}function o(m){const f=[0,0,0];for(let g=0;g<m.length;g++)f[0]+=m[g][0],f[1]+=m[g][1],f[2]+=m[g][2];return f[0]/=m.length,f[1]/=m.length,f[2]/=m.length,f}function r(m,f){const g=s(m,0,0),v=s(m,m.width-1,0),b=s(m,0,m.height-1),C=s(m,m.width-1,m.height-1),y=f||10;if(i(g,v)<y&&i(v,C)<y&&i(C,b)<y&&i(b,g)<y){const x=o([v,g,C,b]),w=[];for(let _=0;_<m.width*m.height;_++){const S=i(x,[m.data[_*4],m.data[_*4+1],m.data[_*4+2]]);w[_]=S<y?0:255}return w}}function l(m,f){for(let g=0;g<m.width*m.height;g++)m.data[4*g+3]=f[g]}function c(m,f,g){const v=[1,1,1,1,0,1,1,1,1],b=Math.round(Math.sqrt(v.length)),C=Math.floor(b/2),y=[];for(let x=0;x<g;x++)for(let w=0;w<f;w++){const _=x*f+w;let S=0;for(let I=0;I<b;I++)for(let k=0;k<b;k++){const E=x+I-C,j=w+k-C;if(E>=0&&E<g&&j>=0&&j<f){const P=E*f+j,D=v[I*b+k];S+=m[P]*D}}y[_]=S===255*8?255:0}return y}function d(m,f,g){const v=[1,1,1,1,1,1,1,1,1],b=Math.round(Math.sqrt(v.length)),C=Math.floor(b/2),y=[];for(let x=0;x<g;x++)for(let w=0;w<f;w++){const _=x*f+w;let S=0;for(let I=0;I<b;I++)for(let k=0;k<b;k++){const E=x+I-C,j=w+k-C;if(E>=0&&E<g&&j>=0&&j<f){const P=E*f+j,D=v[I*b+k];S+=m[P]*D}}y[_]=S>=255*4?255:0}return y}function u(m,f,g){const v=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],b=Math.round(Math.sqrt(v.length)),C=Math.floor(b/2),y=[];for(let x=0;x<g;x++)for(let w=0;w<f;w++){const _=x*f+w;let S=0;for(let I=0;I<b;I++)for(let k=0;k<b;k++){const E=x+I-C,j=w+k-C;if(E>=0&&E<g&&j>=0&&j<f){const P=E*f+j,D=v[I*b+k];S+=m[P]*D}}y[_]=S}return y}const p=function(m){const f=this.threshold();let g=r(m,f);return g&&(g=c(g,m.width,m.height),g=d(g,m.width,m.height),g=u(g,m.width,m.height),l(m,g)),m};return Wg.Mask=p,e.Factory.addGetterSetter(t.Node,"threshold",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Wg}var Ug={},rN;function jTe(){if(rN)return Ug;rN=1,Object.defineProperty(Ug,"__esModule",{value:!0}),Ug.Noise=void 0;const e=en(),t=Rs(),n=nn(),s=function(i){const o=this.noise()*255,r=i.data,l=r.length,c=o/2;for(let d=0;d<l;d+=4)r[d+0]+=c-2*c*Math.random(),r[d+1]+=c-2*c*Math.random(),r[d+2]+=c-2*c*Math.random()};return Ug.Noise=s,e.Factory.addGetterSetter(t.Node,"noise",.2,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Ug}var qg={},lN;function ETe(){if(lN)return qg;lN=1,Object.defineProperty(qg,"__esModule",{value:!0}),qg.Pixelate=void 0;const e=en(),t=Is(),n=Rs(),s=nn(),i=function(o){let r=Math.ceil(this.pixelSize()),l=o.width,c=o.height,d=Math.ceil(l/r),u=Math.ceil(c/r),p=o.data;if(r<=0){t.Util.error("pixelSize value can not be <= 0");return}for(let m=0;m<d;m+=1)for(let f=0;f<u;f+=1){let g=0,v=0,b=0,C=0;const y=m*r,x=y+r,w=f*r,_=w+r;let S=0;for(let I=y;I<x;I+=1)if(!(I>=l))for(let k=w;k<_;k+=1){if(k>=c)continue;const E=(l*k+I)*4;g+=p[E+0],v+=p[E+1],b+=p[E+2],C+=p[E+3],S+=1}g=g/S,v=v/S,b=b/S,C=C/S;for(let I=y;I<x;I+=1)if(!(I>=l))for(let k=w;k<_;k+=1){if(k>=c)continue;const E=(l*k+I)*4;p[E+0]=g,p[E+1]=v,p[E+2]=b,p[E+3]=C}}};return qg.Pixelate=i,e.Factory.addGetterSetter(n.Node,"pixelSize",8,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),qg}var Kg={},cN;function ATe(){if(cN)return Kg;cN=1,Object.defineProperty(Kg,"__esModule",{value:!0}),Kg.Posterize=void 0;const e=en(),t=Rs(),n=nn(),s=function(i){const o=Math.round(this.levels()*254)+1,r=i.data,l=r.length,c=255/o;for(let d=0;d<l;d+=1)r[d]=Math.floor(r[d]/c)*c};return Kg.Posterize=s,e.Factory.addGetterSetter(t.Node,"levels",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Kg}var Zg={},dN;function PTe(){if(dN)return Zg;dN=1,Object.defineProperty(Zg,"__esModule",{value:!0}),Zg.RGB=void 0;const e=en(),t=Rs(),n=nn(),s=function(i){const o=i.data,r=o.length,l=this.red(),c=this.green(),d=this.blue();for(let u=0;u<r;u+=4){const p=(.34*o[u]+.5*o[u+1]+.16*o[u+2])/255;o[u]=p*l,o[u+1]=p*c,o[u+2]=p*d,o[u+3]=o[u+3]}};return Zg.RGB=s,e.Factory.addGetterSetter(t.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"blue",0,n.RGBComponent,e.Factory.afterSetFilter),Zg}var Xg={},uN;function TTe(){if(uN)return Xg;uN=1,Object.defineProperty(Xg,"__esModule",{value:!0}),Xg.RGBA=void 0;const e=en(),t=Rs(),n=nn(),s=function(i){const o=i.data,r=o.length,l=this.red(),c=this.green(),d=this.blue(),u=this.alpha();for(let p=0;p<r;p+=4){const m=1-u;o[p]=l*u+o[p]*m,o[p+1]=c*u+o[p+1]*m,o[p+2]=d*u+o[p+2]*m}};return Xg.RGBA=s,e.Factory.addGetterSetter(t.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"blue",0,n.RGBComponent,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i}),Xg}var Yg={},hN;function DTe(){if(hN)return Yg;hN=1,Object.defineProperty(Yg,"__esModule",{value:!0}),Yg.Sepia=void 0;const e=function(t){const n=t.data,s=n.length;for(let i=0;i<s;i+=4){const o=n[i+0],r=n[i+1],l=n[i+2];n[i+0]=Math.min(255,o*.393+r*.769+l*.189),n[i+1]=Math.min(255,o*.349+r*.686+l*.168),n[i+2]=Math.min(255,o*.272+r*.534+l*.131)}};return Yg.Sepia=e,Yg}var Qg={},pN;function MTe(){if(pN)return Qg;pN=1,Object.defineProperty(Qg,"__esModule",{value:!0}),Qg.Solarize=void 0;const e=function(t){const n=t.data,s=t.width,i=t.height,o=s*4;let r=i;do{const l=(r-1)*o;let c=s;do{const d=l+(c-1)*4;let u=n[d],p=n[d+1],m=n[d+2];u>127&&(u=255-u),p>127&&(p=255-p),m>127&&(m=255-m),n[d]=u,n[d+1]=p,n[d+2]=m}while(--c)}while(--r)};return Qg.Solarize=e,Qg}var Jg={},fN;function LTe(){if(fN)return Jg;fN=1,Object.defineProperty(Jg,"__esModule",{value:!0}),Jg.Threshold=void 0;const e=en(),t=Rs(),n=nn(),s=function(i){const o=this.threshold()*255,r=i.data,l=r.length;for(let c=0;c<l;c+=1)r[c]=r[c]<o?0:255};return Jg.Threshold=s,e.Factory.addGetterSetter(t.Node,"threshold",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Jg}var mN;function RTe(){if(mN)return pg;mN=1,Object.defineProperty(pg,"__esModule",{value:!0}),pg.Konva=void 0;const e=tTe(),t=nTe(),n=iTe(),s=oTe(),i=aTe(),o=rTe(),r=lTe(),l=zZ(),c=L4(),d=VZ(),u=cTe(),p=dTe(),m=uTe(),f=hTe(),g=$Z(),v=pTe(),b=fTe(),C=mTe(),y=gTe(),x=vTe(),w=yTe(),_=bTe(),S=xTe(),I=CTe(),k=wTe(),E=_Te(),j=STe(),P=kTe(),D=ITe(),O=jTe(),N=ETe(),F=ATe(),X=PTe(),L=TTe(),V=DTe(),K=MTe(),U=LTe();return pg.Konva=e.Konva.Util._assign(e.Konva,{Arc:t.Arc,Arrow:n.Arrow,Circle:s.Circle,Ellipse:i.Ellipse,Image:o.Image,Label:r.Label,Tag:r.Tag,Line:l.Line,Path:c.Path,Rect:d.Rect,RegularPolygon:u.RegularPolygon,Ring:p.Ring,Sprite:m.Sprite,Star:f.Star,Text:g.Text,TextPath:v.TextPath,Transformer:b.Transformer,Wedge:C.Wedge,Filters:{Blur:y.Blur,Brighten:x.Brighten,Contrast:w.Contrast,Emboss:_.Emboss,Enhance:S.Enhance,Grayscale:I.Grayscale,HSL:k.HSL,HSV:E.HSV,Invert:j.Invert,Kaleidoscope:P.Kaleidoscope,Mask:D.Mask,Noise:O.Noise,Pixelate:N.Pixelate,Posterize:F.Posterize,RGB:X.RGB,RGBA:L.RGBA,Sepia:V.Sepia,Solarize:K.Solarize,Threshold:U.Threshold}}),pg}var OTe=c2.exports,gN;function NTe(){if(gN)return c2.exports;gN=1,Object.defineProperty(OTe,"__esModule",{value:!0});const e=RTe();return c2.exports=e.Konva,c2.exports}var FTe=NTe();const Ae=Xf(FTe),BTe={RECT_CALC_DEBOUNCE_MS:300,ANCHOR_HIT_PADDING:10,OUTLINE_PADDING:0,OUTLINE_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_FILL_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_STROKE_COLOR:"hsl(200 76% 77% / 1)",SCALE_ANCHOR_CORNER_RADIUS_RATIO:.5,SCALE_ANCHOR_STROKE_WIDTH:2,SCALE_ANCHOR_SIZE:8,ROTATE_ANCHOR_FILL_COLOR:"hsl(200 76% 95% / 1)",ROTATE_ANCHOR_STROKE_COLOR:"hsl(200 76% 40% / 1)",ROTATE_ANCHOR_SIZE:12};class Hh extends Tn{type="entity_transformer";id;path;parent;manager;log;config=BTe;$nodeRect=De(od());$pixelRect=De(od());$isPendingRectCalculation=De(!1);subscriptions=new Set;$isTransforming=De(!1);$interactionMode=De("off");$isDragEnabled=De(!1);$isTransformEnabled=De(!1);$isProcessing=De(!1);$silentTransform=De(!1);transformMutex=new H_;static bboxUpdatedCallbacks=new Set;konva;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=t.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={outlineRect:new Ae.Rect({listening:!1,draggable:!1,name:`${this.type}:outline_rect`,stroke:this.config.OUTLINE_COLOR,perfectDrawEnabled:!1,hitStrokeWidth:0}),transformer:new Ae.Transformer({name:`${this.type}:transformer`,visible:!1,listening:!1,rotateEnabled:!0,flipEnabled:!0,keepRatio:!0,shiftBehavior:"inverted",padding:this.config.OUTLINE_PADDING,stroke:this.config.OUTLINE_COLOR,anchorFill:this.config.SCALE_ANCHOR_FILL_COLOR,anchorStroke:this.config.SCALE_ANCHOR_STROKE_COLOR,anchorStrokeWidth:this.config.SCALE_ANCHOR_STROKE_WIDTH,anchorSize:this.config.SCALE_ANCHOR_SIZE,anchorCornerRadius:this.config.SCALE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc,boundBoxFunc:this.boxBoundFunc}),proxyRect:new Ae.Rect({name:`${this.type}:proxy_rect`,listening:!1,draggable:!0})},this.konva.transformer.on("transform",this.syncObjectGroupWithProxyRect),this.konva.transformer.on("transformend",this.snapProxyRectToPixelGrid),this.konva.transformer.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.transformer.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("dragend",this.onDragEnd),this.konva.proxyRect.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.proxyRect.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.subscriptions.add(()=>{this.konva.transformer.off("transform transformend pointerenter pointerleave"),this.konva.proxyRect.off("dragmove dragend pointerenter pointerleave")}),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((n,s)=>{qw(n)||n.scale!==s.scale&&this.syncScale()})),this.subscriptions.add(this.manager.stateApi.$shiftKey.listen(n=>{this.konva.transformer.rotationSnaps(n?[0,45,90,135,180,225,270,315]:[])})),this.subscriptions.add(this.manager.tool.$tool.listen(this.syncInteractionState)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription($n,this.syncInteractionState)),this.subscriptions.add(this.manager.$isBusy.listen(this.syncInteractionState)),this.parent.konva.layer.add(this.konva.outlineRect),this.parent.konva.layer.add(this.konva.proxyRect),this.parent.konva.layer.add(this.konva.transformer)}initialize=()=>{this.log.debug("Initializing module"),this.syncInteractionState()};syncCursorStyle=()=>{this.parent.renderer.hasObjects()?this.manager.stage.setCursor("default"):this.manager.stage.setCursor("not-allowed")};anchorStyleFunc=t=>{t.hasName("rotater")&&t.setAttrs({height:this.config.ROTATE_ANCHOR_SIZE,width:this.config.ROTATE_ANCHOR_SIZE,cornerRadius:this.config.ROTATE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,fill:this.config.ROTATE_ANCHOR_FILL_COLOR,stroke:this.config.SCALE_ANCHOR_FILL_COLOR,offsetX:this.config.ROTATE_ANCHOR_SIZE/2,offsetY:this.config.ROTATE_ANCHOR_SIZE/2}),t.hitFunc(n=>{n.beginPath(),n.rect(-this.config.ANCHOR_HIT_PADDING,-this.config.ANCHOR_HIT_PADDING,t.width()+this.config.ANCHOR_HIT_PADDING*2,t.height()+this.config.ANCHOR_HIT_PADDING*2),n.closePath(),n.fillStrokeShape(t)})};anchorDragBoundFunc=(t,n)=>{if(this.konva.transformer.getActiveAnchor()==="rotater")return n;const s=this.manager.stateApi.$shiftKey.get()?this.manager.stateApi.getPositionGridSize():1,i=this.manager.stage.getScale(),o=this.manager.stage.getPosition(),r=Ba(n.x/i,s),l=Ba(n.y/i,s),c=o.x%(i*s),d=o.y%(i*s),u=r*i+c,p=l*i+d;return{x:u,y:p}};boxBoundFunc=(t,n)=>this.konva.transformer.getActiveAnchor()!=="rotater"?n:this.manager.stateApi.$shiftKey.get()&&Math.abs(n.rotation%(Math.PI/4))>0?t:n;snapProxyRectToPixelGrid=()=>{const t=this.konva.proxyRect.x(),n=this.konva.proxyRect.y(),s=Math.round(t),i=Math.round(n),o=this.konva.proxyRect.width(),r=this.konva.proxyRect.height(),l=this.konva.proxyRect.scaleX(),c=this.konva.proxyRect.scaleY(),d=Math.max(Math.abs(Math.round(o*l)),1),u=Math.max(Math.abs(Math.round(r*c)),1),p=d/o*Math.sign(l),m=u/r*Math.sign(c);this.konva.proxyRect.setAttrs({x:s,y:i,scaleX:p,scaleY:m}),this.syncObjectGroupWithProxyRect()};fitToBboxFill=()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:t}=this.manager.stateApi.getBbox(),n=t.width/this.konva.proxyRect.width(),s=t.height/this.konva.proxyRect.height();this.konva.proxyRect.setAttrs({x:t.x,y:t.y,scaleX:n,scaleY:s,rotation:0}),this.syncObjectGroupWithProxyRect()};fitToBboxContain=()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:t}=this.manager.stateApi.getBbox(),n=this.manager.stateApi.getPositionGridSize(),s=this.konva.proxyRect.width(),i=this.konva.proxyRect.height(),o=t.width/s,r=t.height/i,l=Math.min(o,r),c=s*l,d=i*l,u=t.x+(t.width-c)/2,p=t.y+(t.height-d)/2,m=n>1?Ba(u,n):u,f=n>1?Ba(p,n):p,g=fi(m,t.x,t.x+t.width-c),v=fi(f,t.y,t.y+t.height-d);this.konva.proxyRect.setAttrs({x:g,y:v,scaleX:l,scaleY:l,rotation:0}),this.syncObjectGroupWithProxyRect()};fitToBboxCover=()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:t}=this.manager.stateApi.getBbox(),n=this.manager.stateApi.getPositionGridSize(),s=this.konva.proxyRect.width(),i=this.konva.proxyRect.height(),o=t.width/s,r=t.height/i,l=Math.max(o,r),c=s*l,d=i*l;let u=t.x,p=t.y;if(c>t.width){const m=t.x+(t.width-c)/2;u=n>1?Ba(m,n):m}if(d>t.height){const m=t.y+(t.height-d)/2;p=n>1?Ba(m,n):m}this.konva.proxyRect.setAttrs({x:u,y:p,scaleX:l,scaleY:l,rotation:0}),this.syncObjectGroupWithProxyRect()};onDragMove=()=>{const t=this.manager.stateApi.getPositionGridSize();this.konva.proxyRect.x(Ba(this.konva.proxyRect.x(),t)),this.konva.proxyRect.y(Ba(this.konva.proxyRect.y(),t));const n=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-n,y:this.konva.proxyRect.y()-n}),this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y()})};onDragEnd=()=>{if(this.$isTransforming.get())return;const t=this.$pixelRect.get(),n={x:this.konva.proxyRect.x()-t.x,y:this.konva.proxyRect.y()-t.y};this.log.trace({position:n},"Position changed"),this.manager.stateApi.setEntityPosition({entityIdentifier:this.parent.entityIdentifier,position:n})};nudgeBy=t=>{const n=this.konva.proxyRect.position(),s=ba(n,t);this.konva.proxyRect.setAttrs(s),this.syncObjectGroupWithProxyRect(),this.manager.stateApi.moveEntityBy({entityIdentifier:this.parent.entityIdentifier,offset:t}),this.log.trace({offset:t},"Nudged")};syncObjectGroupWithProxyRect=()=>{this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y(),scaleX:this.konva.proxyRect.scaleX(),scaleY:this.konva.proxyRect.scaleY(),rotation:this.konva.proxyRect.rotation()})};update=(t,n)=>{const s=this.manager.stage.unscale(1),i=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:t.x+n.x-i,y:t.y+n.y-i,width:n.width+i*2,height:n.height+i*2,strokeWidth:s}),this.konva.proxyRect.setAttrs({x:t.x+n.x,y:t.y+n.y,width:n.width,height:n.height})};syncInteractionState=()=>{if(this.log.trace("Syncing interaction state"),this.manager.stagingArea.$isStaging.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.segmentAnything?.$isSegmenting.get()){this.parent.konva.layer.listening(!0),this._setInteractionMode("off");return}if(this.parent.filterer?.$isFiltering.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.manager.stateApi.$isTransforming.get()&&!this.$isTransforming.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const t=this.$pixelRect.get();if(this.$isPendingRectCalculation.get()||t.width===0||t.height===0){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const s=this.manager.tool.$tool.get();if(!this.manager.stateApi.getIsSelected(this.parent.id)){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.$isEmpty.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.$isLocked.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(!this.$isTransforming.get()&&s==="move"){this.parent.konva.layer.listening(!0),this._setInteractionMode("drag");return}if(this.$isTransforming.get()){s==="view"?(this.parent.konva.layer.listening(!1),this._setInteractionMode("off")):(this.parent.konva.layer.listening(!0),this._setInteractionMode("all"));return}this.parent.konva.layer.listening(!1),this._setInteractionMode("off")};syncScale=()=>{const t=this.manager.stage.unscale(1),n=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-n,y:this.konva.proxyRect.y()-n,width:this.konva.proxyRect.width()*this.konva.proxyRect.scaleX()+n*2,height:this.konva.proxyRect.height()*this.konva.proxyRect.scaleY()+n*2,strokeWidth:t}),this.konva.transformer.forceUpdate()};startTransform=async t=>{const n=this.manager.stateApi.$transformingAdapter.get();n&&ae(!1,`Already transforming an entity: ${n.id}`),await this.transformMutex.acquire(),this.log.debug("Starting transform");const{silent:s}={silent:!1,...t};this.$silentTransform.set(s),this.$isTransforming.set(!0),this.manager.stateApi.$transformingAdapter.set(this.parent),this.syncInteractionState()};applyTransform=async()=>{if(!this.$isTransforming.get()){this.log.warn("Cannot apply transform when not transforming. Did you forget to call `await adapter.transformer.startTransform()`?");return}this.log.debug("Applying transform"),this.$isProcessing.set(!0),this._setInteractionMode("off");const t=this.getRelativeRect(),n=await Kn(()=>this.parent.renderer.rasterize({rect:Dye(t),replaceObjects:!0,ignoreCache:!0,attrs:{opacity:1,filters:[]}}));n.isErr()&&(pe({status:"error",title:"Failed to apply transform"}),this.log.error({error:cn(n.error)},"Failed to rasterize entity")),this.requestRectCalculation(),this.stopTransform()};resetTransform=()=>{this.resetScale(),this.updatePosition(),this.updateBbox()};stopTransform=()=>{this.log.debug("Stopping transform"),this.$isTransforming.set(!1),this.resetTransform(),this.syncInteractionState(),this.manager.stateApi.$transformingAdapter.set(null),this.$isProcessing.set(!1),this.transformMutex.release()};resetScale=()=>{const t={scaleX:1,scaleY:1,rotation:0};this.parent.renderer.konva.objectGroup.setAttrs(t),this.parent.bufferRenderer.konva.group.setAttrs(t),this.konva.outlineRect.setAttrs(t),this.konva.proxyRect.setAttrs(t)};updatePosition=t=>{this.log.trace("Updating position");const n=jf(t,"position",this.parent.state.position),s=this.$pixelRect.get(),i={x:n.x+s.x,y:n.y+s.y,offsetX:s.x,offsetY:s.y};this.parent.renderer.konva.objectGroup.setAttrs(i),this.parent.bufferRenderer.konva.group.setAttrs(i),this.update(n,s)};_setInteractionMode=t=>{this.$interactionMode.set(t),t==="drag"?(this._enableDrag(),this._disableTransform(),this._showBboxOutline()):t==="all"?(this._enableDrag(),this._enableTransform(),this._hideBboxOutline()):t==="off"&&(this._disableDrag(),this._disableTransform(),this._hideBboxOutline())};updateBbox=()=>{const t=this.$nodeRect.get(),n=this.$pixelRect.get();if(this.log.trace({nodeRect:t,pixelRect:n},"Updating bbox"),this.$isPendingRectCalculation.get()){this.syncInteractionState();return}if(n.width===0||n.height===0)this.parent.renderer.hasObjects()&&(this.manager.stateApi.resetEntity({entityIdentifier:this.parent.entityIdentifier}),this.syncInteractionState());else{this.syncInteractionState(),this.update(this.parent.state.position,n);const s={x:this.parent.state.position.x+n.x,y:this.parent.state.position.y+n.y,offsetX:n.x,offsetY:n.y};this.parent.renderer.konva.objectGroup.setAttrs(s),this.parent.bufferRenderer.konva.group.setAttrs(s)}Hh.runBboxUpdatedCallbacks(this.parent)};calculateRect=pr(()=>{this.log.debug("Calculating bbox");const t=Jy(()=>this.parent.getCanvas());if(t.isErr()){this.log.error({error:cn(t.error)},"Failed to get canvas, resetting bbox"),this.$nodeRect.set(od()),this.$pixelRect.set(od()),this.$isPendingRectCalculation.set(!1),this.transformMutex.release();return}const n=t.value;if(!this.parent.renderer.hasObjects()){this.log.trace("No objects, resetting bbox"),this.$nodeRect.set(od()),this.$pixelRect.set(od()),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const s=this.parent.renderer.konva.objectGroup.getClientRect({skipTransform:!0});if(!this.parent.renderer.needsPixelBbox()){this.$nodeRect.set({...s}),this.$pixelRect.set({...s}),this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get()},"Got bbox from client rect"),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const i=Dv(n);this.manager.worker.requestBbox({buffer:i.data.buffer,width:i.width,height:i.height},o=>{if(o){const{minX:r,minY:l,maxX:c,maxY:d}=o;this.$nodeRect.set({...s}),this.$pixelRect.set({x:Math.round(s.x)+r,y:Math.round(s.y)+l,width:c-r,height:d-l})}else this.$nodeRect.set(od()),this.$pixelRect.set(od());this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get(),extents:o},"Got bbox from worker"),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release()})},this.config.RECT_CALC_DEBOUNCE_MS);requestRectCalculation=async()=>{await this.transformMutex.acquire(),this.$isPendingRectCalculation.set(!0),this.syncInteractionState(),this.calculateRect()};getRelativeRect=()=>this.konva.proxyRect.getClientRect({relativeTo:this.parent.konva.layer});_enableTransform=()=>{this.$isTransformEnabled.set(!0),this.konva.transformer.visible(!0),this.konva.transformer.listening(!0),this.konva.transformer.nodes([this.konva.proxyRect])};_disableTransform=()=>{this.$isTransformEnabled.set(!1),this.konva.transformer.visible(!1),this.konva.transformer.listening(!1),this.konva.transformer.nodes([])};_enableDrag=()=>{this.$isDragEnabled.set(!0),this.konva.proxyRect.visible(!0),this.konva.proxyRect.listening(!0)};_disableDrag=()=>{this.$isDragEnabled.set(!1),this.konva.proxyRect.visible(!1),this.konva.proxyRect.listening(!1)};_showBboxOutline=()=>{this.konva.outlineRect.visible(!0)};_hideBboxOutline=()=>{this.konva.outlineRect.visible(!1)};static registerBboxUpdatedCallback=t=>{const n=async s=>{const i=await t(s);return i&&this.bboxUpdatedCallbacks.delete(n),i};this.bboxUpdatedCallbacks.add(n)};static runBboxUpdatedCallbacks=t=>{for(const n of this.bboxUpdatedCallbacks)n(t)};repr=()=>({id:this.id,type:this.type,path:this.path,config:this.config,$nodeRect:this.$nodeRect.get(),$pixelRect:this.$pixelRect.get(),$isPendingRectCalculation:this.$isPendingRectCalculation.get(),$isTransforming:this.$isTransforming.get(),$interactionMode:this.$interactionMode.get(),$isDragEnabled:this.$isDragEnabled.get(),$isTransformEnabled:this.$isTransformEnabled.get(),$isProcessing:this.$isProcessing.get(),konva:{transformer:Ai(this.konva.transformer),proxyRect:Ai(this.konva.proxyRect),outlineRect:Ai(this.konva.outlineRect)}});destroy=()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear(),this.konva.outlineRect.destroy(),this.konva.transformer.destroy(),this.konva.proxyRect.destroy()}}const R4=e=>{const{imageDTO:t,id:n,dispatch:s}=e;s(JD({id:n,croppableImage:Dl(t)}))},GZ=e=>{const{imageDTO:t,entityIdentifier:n,referenceImageId:s,dispatch:i}=e;i(eM({entityIdentifier:n,referenceImageId:s,imageDTO:t}))},zTe=e=>{const{imageDTO:t,dispatch:n}=e;n(Mv(du(t)))},VTe=e=>{const{imageDTO:t,fieldIdentifier:n,dispatch:s}=e;s(zA({...n,value:t}))},$Te=e=>{const{image_name:t,dispatch:n}=e;n($c(t))},Ar=async e=>{const{type:t,imageDTO:n,dispatch:s,getState:i,withResize:o,overrides:r}=e,l=i(),{x:c,y:d}=Kw(l),u=mH(l),p=n.width/n.height,m=tM(u),{width:f,height:g}=gH(p,m**2,u);let v;if(o&&(f!==n.width||g!==n.height)){const C=await Yd({file:await vH(n),image_category:"general",is_intermediate:!0,silent:!0,resize_to:{width:f,height:g}});v=_o(C)}else v=_o(n);const b={objects:[v],position:{x:c,y:d},...r};switch(t){case"raster_layer":{s(em({overrides:b,isSelected:!0}));break}case"control_layer":{s(Ty({overrides:{...b,controlAdapter:It(Rh)},isSelected:!0}));break}case"inpaint_mask":{s(yl({overrides:b,isSelected:!0}));break}case"regional_guidance":{s(Xd({overrides:b,isSelected:!0}));break}case"regional_guidance_with_reference_image":{const C=r1(i);C.image=du(n);const y=[{id:ee("regional_guidance_reference_image"),config:C}];s(Xd({overrides:{referenceImages:y},isSelected:!0}));break}}Ne.focusPanel("canvas",Zn)},Dd=async e=>{const{type:t,imageDTO:n,withResize:s=!1,withInpaintMask:i=!1,dispatch:o,getState:r}=e,l=r(),c=mH(l),d=n.width/n.height,u=tM(c),{width:p,height:m}=gH(d,u**2,c);let f;if(s&&(p!==n.width||m!==n.height)){const v=await Yd({file:await vH(n),image_category:"general",is_intermediate:!0,silent:!0,resize_to:{width:p,height:m}});f=_o(v)}else f=_o(n);const g=v=>{Hh.registerBboxUpdatedCallback(b=>b.id!==v?Promise.resolve(!1):(b.manager.stage.fitBboxAndLayersToStage(),Promise.resolve(!0)))};switch(t){case"raster_layer":{const v={id:ee("raster_layer"),objects:[f]};g(v.id),o(cg()),o(D0({x:0,y:0,width:p,height:m})),o(em({overrides:v,isSelected:!0})),i&&o(yl({isSelected:!0,isBookmarked:!0})),o(Tp());break}case"control_layer":{const v={id:ee("control_layer"),objects:[f],controlAdapter:It(Rh)};g(v.id),o(cg()),o(D0({x:0,y:0,width:p,height:m})),o(Ty({overrides:v,isSelected:!0})),i&&o(yl({isSelected:!0,isBookmarked:!0})),o(Tp());break}case"inpaint_mask":{const v={id:ee("inpaint_mask"),objects:[f]};g(v.id),o(cg()),o(D0({x:0,y:0,width:p,height:m})),o(yl({overrides:v,isSelected:!0})),i&&o(yl({isSelected:!0,isBookmarked:!0})),o(Tp());break}case"regional_guidance":{const v={id:ee("regional_guidance"),objects:[f]};g(v.id),o(cg()),o(D0({x:0,y:0,width:p,height:m})),o(Xd({overrides:v,isSelected:!0})),i&&o(yl({isSelected:!0,isBookmarked:!0})),o(Tp());break}case"regional_guidance_with_reference_image":{const v=r1(r);v.image=du(n);const b=[{id:ee("regional_guidance_reference_image"),config:v}];o(cg()),o(Xd({overrides:{referenceImages:b},isSelected:!0})),i&&o(yl({isSelected:!0,isBookmarked:!0})),o(Tp());break}default:ae(!1)}Ne.focusPanel("canvas",Zn)},O4=e=>{const{imageDTO:t,entityIdentifier:n,dispatch:s,getState:i}=e,o=_o(t),{x:r,y:l}=Kw(i());s(Zw({entityIdentifier:n,imageObject:o,position:{x:r,y:l},replaceObjects:!0,isSelected:!0}))},vN=e=>{const{image_names:t,boardId:n,dispatch:s}=e;s($r.endpoints.addImagesToBoard.initiate({image_names:t,board_id:n},{track:!1})),s(_l([]))},yN=e=>{const{image_names:t,dispatch:n}=e;n($r.endpoints.removeImagesFromBoard.initiate({image_names:t},{track:!1})),n(_l([]))},GTe=Ft("dnd").child({filePath:"features/dnd/dnd.ts"}),Ao=e=>{const t=Symbol(e);return{type:e,key:t}},Po=e=>n=>!!n[e],To=(e,t)=>(s,i)=>({[e]:!0,id:i??ee(t),type:t,payload:s}),Bb=Ao("single-image"),Ss={...Bb,typeGuard:Po(Bb.key),getData:To(Bb.key,Bb.type)},zb=Ao("multiple-image"),Rl={...zb,typeGuard:Po(zb.key),getData:To(zb.key,zb.type)},Vb=Ao("single-canvas-entity"),gf={...Vb,typeGuard:Po(Vb.key),getData:To(Vb.key,Vb.type)},$b=Ao("set-global-reference-image"),bh={...$b,typeGuard:Po($b.key),getData:To($b.key,$b.type),isValid:({sourceData:e})=>!!Ss.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{id:i}=t.payload;R4({id:i,imageDTO:s,dispatch:n})}},Gb=Ao("add-global-reference-image"),l1={...Gb,typeGuard:Po(Gb.key),getData:To(Gb.key,Gb.type),isValid:({sourceData:e})=>!!Ss.typeGuard(e),handler:({sourceData:e,dispatch:t,getState:n})=>{const{imageDTO:s}=e.payload,i=a1(n);i.image=Dl(s),t(Dy({overrides:{config:i}}))}},Hb=Ao("set-regional-guidance-reference-image"),Gv={...Hb,typeGuard:Po(Hb.key),getData:To(Hb.key,Hb.type),isValid:({sourceData:e})=>!!Ss.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{entityIdentifier:i,referenceImageId:o}=t.payload;GZ({imageDTO:s,entityIdentifier:i,referenceImageId:o,dispatch:n})}},Wb=Ao("set-upscale-initial-image"),Hv={...Wb,typeGuard:Po(Wb.key),getData:To(Wb.key,Wb.type),isValid:({sourceData:e})=>!!Ss.typeGuard(e),handler:({sourceData:e,dispatch:t})=>{const{imageDTO:n}=e.payload;zTe({imageDTO:n,dispatch:t})}},Ub=Ao("set-node-image-field-image"),AP={...Ub,typeGuard:Po(Ub.key),getData:To(Ub.key,Ub.type),isValid:({sourceData:e})=>!!Ss.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{fieldIdentifier:i}=t.payload;VTe({fieldIdentifier:i,imageDTO:s,dispatch:n})}},qb=Ao("add-images-to-image-collection-node-field"),PP={...qb,typeGuard:Po(qb.key),getData:To(qb.key,qb.type),isValid:({sourceData:e})=>!!(Ss.typeGuard(e)||Rl.typeGuard(e)),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{if(!Ss.typeGuard(e)&&!Rl.typeGuard(e))return;const{fieldIdentifier:i}=t.payload,o=Mye(Xn(s()),i.nodeId,i.fieldName);if(!Py(o)){GTe.warn({fieldIdentifier:i},"Attempted to add images to a non-image field collection");return}const r=o.value?[...o.value]:[];Ss.typeGuard(e)?r.push({image_name:e.payload.imageDTO.image_name}):r.push(...e.payload.image_names.map(l=>({image_name:l}))),n(VA({...i,value:r}))}},Kb=Ao("set-comparison-image"),Wv={...Kb,typeGuard:Po(Kb.key),getData:To(Kb.key,Kb.type),isValid:({sourceData:e,getState:t})=>{if(!Ss.typeGuard(e))return!1;const{firstImage:n,secondImage:s}=WPe(t());return!(e.payload.imageDTO.image_name===n||e.payload.imageDTO.image_name===s)},handler:({sourceData:e,dispatch:t})=>{const{imageDTO:n}=e.payload;$Te({image_name:n.image_name,dispatch:t})}},Zb=Ao("new-canvas-entity-from-image"),Dc={...Zb,typeGuard:Po(Zb.key),getData:To(Zb.key,Zb.type),isValid:({sourceData:e})=>!!Ss.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{type:i,withResize:o}=t.payload,{imageDTO:r}=e.payload;Ar({type:i,imageDTO:r,withResize:o,dispatch:n,getState:s})}},Xb=Ao("new-canvas-from-image"),c1={...Xb,typeGuard:Po(Xb.key),getData:To(Xb.key,Xb.type),isValid:({sourceData:e})=>!!Ss.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{imageDTO:i}=e.payload;Dd({imageDTO:i,dispatch:n,getState:s,...t.payload})}},Yb=Ao("replace-canvas-entity-objects-with-image"),Uv={...Yb,typeGuard:Po(Yb.key),getData:To(Yb.key,Yb.type),isValid:({sourceData:e})=>!!Ss.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{imageDTO:i}=e.payload,{entityIdentifier:o}=t.payload;O4({imageDTO:i,entityIdentifier:o,dispatch:n,getState:s})}},Qb=Ao("add-to-board"),TP={...Qb,typeGuard:Po(Qb.key),getData:To(Qb.key,Qb.type),isValid:({sourceData:e,targetData:t})=>{if(Ss.typeGuard(e)){const n=e.payload.imageDTO.board_id??"none",s=t.payload.boardId;return n!==s}if(Rl.typeGuard(e)){const n=e.payload.board_id,s=t.payload.boardId;return n!==s}return!1},handler:({sourceData:e,targetData:t,dispatch:n})=>{if(Ss.typeGuard(e)){const{imageDTO:s}=e.payload,{boardId:i}=t.payload;vN({image_names:[s.image_name],boardId:i,dispatch:n})}if(Rl.typeGuard(e)){const{image_names:s}=e.payload,{boardId:i}=t.payload;vN({image_names:s,boardId:i,dispatch:n})}}},Jb=Ao("remove-from-board"),DP={...Jb,typeGuard:Po(Jb.key),getData:To(Jb.key,Jb.type),isValid:({sourceData:e})=>Ss.typeGuard(e)?(e.payload.imageDTO.board_id??"none")!=="none":Rl.typeGuard(e)?e.payload.board_id!=="none":!1,handler:({sourceData:e,dispatch:t})=>{if(Ss.typeGuard(e)){const{imageDTO:n}=e.payload;yN({image_names:[n.image_name],dispatch:t})}if(Rl.typeGuard(e)){const{image_names:n}=e.payload;yN({image_names:n,dispatch:t})}}},HTe=[bh,l1,Gv,Hv,AP,PP,Wv,Dc,c1,Uv,TP,DP],AI=Ft("dnd").child({filePath:"features/dnd/useDndMonitor.ts"}),WTe=()=>{mn("useDropMonitor"),h.useEffect(()=>zi(Gh({canMonitor:({source:e})=>{const t=e.data;return!(!Ss.typeGuard(t)&&!Rl.typeGuard(t))},onDrop:({source:e,location:t})=>{const n=t.current.dropTargets[0];if(!n){AI.warn("No dnd target");return}const s=e.data,i=n.data,{dispatch:o,getState:r}=uu();for(const l of HTe){if(!l.typeGuard(i))continue;const c={sourceData:s,targetData:i,dispatch:o,getState:r};if(l.isValid(c)){AI.debug(ts({sourceData:s,targetData:i}),"Handling dnd drop"),l.handler(c);return}}AI.warn(ts({sourceData:s,targetData:i}),"Invalid drop")}})),[])},UTe=1e3,qTe=()=>{const{getState:e,dispatch:t}=Ze(),n=M(Zd),s=M(yH),i=h.useMemo(()=>pr(async(o,r)=>{try{const c=await t(DL.endpoints.dynamicPrompts.initiate({prompt:o,max_prompts:r},{subscribe:!1})).unwrap();t(qk(c.prompts)),t(Kk(c.error)),t(Zk(!1))}catch{t(Zk(!0)),t(ML(!1))}},UTe),[t]);h.useEffect(()=>{const o=e(),r=DL.endpoints.dynamicPrompts.select({prompt:n.positive,max_prompts:s})(o).data;if(r){t(qk(r.prompts)),t(Kk(r.error));return}if(!A_(n.positive)){t(qk([n.positive])),t(Kk(void 0)),t(Zk(!1));return}o.dynamicPrompts.isLoading||t(ML(!0)),i(n.positive,s)},[i,t,e,s,n])},KTe={launchpad:0,urlOrLocal:1,huggingface:2,scanFolder:3,starterModels:4},El=e=>{MP.set(KTe[e])},MP=De(0),d2="starterModels",ZTe=()=>{const{t:e}=T(),[t,n]=h.useState(!1),[s,{data:i}]=Xw(),o=tm();h.useEffect(()=>{if(o.isActive(d2)){if(s.length===0)return;o.close(d2)}i&&s.length===0&&!t&&o({id:d2,title:e("modelManager.noModelsInstalled"),description:a.jsx(XTe,{}),status:"info",isClosable:!0,duration:null,onCloseComplete:()=>n(!0)})},[i,t,s.length,e,o])},XTe=()=>{const{t:e}=T(),t=tm(),n=h.useCallback(()=>{Ne.switchToTab("models"),El("launchpad"),t.close(d2)},[t]);return a.jsxs(q,{fontSize:"md",children:[e("modelManager.noModelsInstalledDesc1")," ",a.jsxs(he,{onClick:n,variant:"link",color:"base.50",flexGrow:0,children:[e("ui.tabs.modelsTab"),"."]})]})},xr=(e="")=>Lye(`workflows/${e}`),d1=Sr.injectEndpoints({endpoints:e=>({getWorkflow:e.query({query:t=>xr(`i/${t}`),providesTags:(t,n,s)=>[{type:"Workflow",id:s},"FetchOnReconnect"]}),deleteWorkflow:e.mutation({query:t=>({url:xr(`i/${t}`),method:"DELETE"}),invalidatesTags:(t,n,s)=>[{type:"Workflow",id:qu},{type:"Workflow",id:s},"WorkflowTags","WorkflowTagCounts","WorkflowCategoryCounts"]}),createWorkflow:e.mutation({query:t=>({url:xr(),method:"POST",body:{workflow:t}}),invalidatesTags:[{type:"Workflow",id:qu},"WorkflowTags","WorkflowTagCounts","WorkflowCategoryCounts"]}),updateWorkflow:e.mutation({query:t=>({url:xr(`i/${t.id}`),method:"PATCH",body:{workflow:t}}),invalidatesTags:(t,n,s)=>[{type:"Workflow",id:s.id},"WorkflowTags","WorkflowTagCounts","WorkflowCategoryCounts"]}),getAllTags:e.query({query:t=>({url:`${xr("tags")}${t?`?${Eb.stringify(t,{arrayFormat:"none"})}`:""}`}),providesTags:["WorkflowTags"]}),getCountsByTag:e.query({query:t=>({url:`${xr("counts_by_tag")}?${Eb.stringify(t,{arrayFormat:"none"})}`}),providesTags:["WorkflowTagCounts"]}),getCountsByCategory:e.query({query:t=>({url:`${xr("counts_by_category")}?${Eb.stringify(t,{arrayFormat:"none"})}`}),providesTags:["WorkflowCategoryCounts"]}),listWorkflowsInfinite:e.infiniteQuery({query:({queryArg:t,pageParam:n})=>({url:`${xr()}?${Eb.stringify({...t,page:n},{arrayFormat:"none"})}`}),infiniteQueryOptions:{initialPageParam:0,getNextPageParam:(t,n,s,i)=>{if(t.pages-1-s>0)return s+1},getPreviousPageParam:(t,n,s,i)=>s>-1?s-1:void 0},providesTags:t=>{const n=["FetchOnReconnect",{type:"Workflow",id:qu}];return t&&n.push(...t.pages.map(({items:s})=>s).flat().map(s=>({type:"Workflow",id:s.workflow_id}))),n}}),updateOpenedAt:e.mutation({query:({workflow_id:t})=>({url:xr(`i/${t}/opened_at`),method:"PUT"}),invalidatesTags:(t,n,{workflow_id:s})=>[{type:"Workflow",id:s},{type:"Workflow",id:qu}]}),setWorkflowThumbnail:e.mutation({query:({workflow_id:t,image:n})=>{const s=new FormData;return s.append("image",n),{url:xr(`i/${t}/thumbnail`),method:"PUT",body:s}},invalidatesTags:(t,n,{workflow_id:s})=>[{type:"Workflow",id:s}]}),deleteWorkflowThumbnail:e.mutation({query:t=>({url:xr(`i/${t}/thumbnail`),method:"DELETE"}),invalidatesTags:(t,n,s)=>[{type:"Workflow",id:s}]})})}),{useUpdateOpenedAtMutation:HZ,useGetAllTagsQuery:YTe,useGetCountsByTagQuery:N4,useGetCountsByCategoryQuery:bN,useLazyGetWorkflowQuery:WZ,useGetWorkflowQuery:UZ,useCreateWorkflowMutation:QTe,useDeleteWorkflowMutation:JTe,useUpdateWorkflowMutation:eDe,useListWorkflowsInfiniteInfiniteQuery:tDe,useSetWorkflowThumbnailMutation:nDe,useDeleteWorkflowThumbnailMutation:sDe}=d1,F4=De(null),iDe=Ut(F4,e=>e??bH),qZ=Ut(F4,e=>e?Gc(e):null),oDe=pr(e=>{F4.set(o4(e))},300),aDe=()=>{mn("useWorkflowBuilderWatcher");const e=M(Xn);h.useEffect(()=>{oDe(e)},[e])},rDe={selectFromResult:({currentData:e})=>e?{serverWorkflowHash:Gc(e.workflow)}:{serverWorkflowHash:null}},_m=()=>{const e=M(nM),t=le(qZ),{serverWorkflowHash:n}=UZ(e??Ri,rDe);return h.useMemo(()=>n===null?!0:t!==n,[t,n])},lDe=Gc({...Rye(),nodes:[],edges:[]}),cDe=()=>{const e=le(qZ);return h.useMemo(()=>e===lDe,[e])},ga=Gw({}),dDe={status:Ui.enum.PENDING,error:null,progress:null,progressImage:null,outputs:[]},q_=e=>{const t=le(ga,e?{keys:[e]}:void 0);return h.useMemo(()=>e?t[e]:void 0,[t,e])},uDe=e=>{ga.setKey(e,void 0)},nv=(e,t)=>{const n=ga.get()[e];n?ga.setKey(e,{...n,...t}):ga.setKey(e,{...It(dDe),nodeId:e,...t})},hDe=Yn(Uo,e=>e.map(t=>t.id)),pDe=()=>{const e=M(hDe);h.useEffect(()=>{const t=ga.get(),n=e.filter(i=>!t[i]),s=Object.keys(t).filter(i=>!e.includes(i));for(const i of n)nv(i);for(const i of s)uDe(i)},[e])},KZ=ve(sM,e=>e.language),fDe=()=>{mn("useNavigationApi");const e=Ze(),t=h.useMemo(()=>({activeTab:{get:()=>un(e.getState()),set:n=>{e.dispatch(Oye(n))}},storage:{get:n=>e.getState().ui.panels[n],set:(n,s)=>{e.dispatch(LL({id:n,state:s}))},delete:n=>{e.dispatch(LL({id:n,state:void 0}))}}}),[e]);h.useEffect(()=>{Ne.connectToApp(t)},[t,e])};var ZZ={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},xN=ce.createContext&&ce.createContext(ZZ),mDe=["attr","size","title"];function gDe(e,t){if(e==null)return{};var n=vDe(e,t),s,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)s=o[i],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function vDe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function iC(){return iC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},iC.apply(this,arguments)}function CN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function oC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?CN(Object(n),!0).forEach(function(s){yDe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CN(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function yDe(e,t,n){return t=bDe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bDe(e){var t=xDe(e,"string");return typeof t=="symbol"?t:t+""}function xDe(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function XZ(e){return e&&e.map((t,n)=>ce.createElement(t.tag,oC({key:n},t.attr),XZ(t.child)))}function fe(e){return t=>ce.createElement(CDe,iC({attr:oC({},e.attr)},t),XZ(e.child))}function CDe(e){var t=n=>{var{attr:s,size:i,title:o}=e,r=gDe(e,mDe),l=i||n.size||"1em",c;return n.className&&(c=n.className),e.className&&(c=(c?c+" ":"")+e.className),ce.createElement("svg",iC({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,s,r,{className:c,style:oC(oC({color:e.color||n.color},n.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),o&&ce.createElement("title",null,o),e.children)};return xN!==void 0?ce.createElement(xN.Consumer,null,n=>t(n)):t(ZZ)}function YZ(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V88a20,20,0,0,0,16,19.6V192a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V107.6A20,20,0,0,0,244,88V64A20,20,0,0,0,224,44ZM36,68H220V84H36ZM52,188V108H204v80Zm112-52a12,12,0,0,1-12,12H104a12,12,0,0,1,0-24h48A12,12,0,0,1,164,136Z"},child:[]}]})(e)}function wDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,184a12,12,0,0,1-24,0A84,84,0,0,0,68.6,124.6L53.11,140H88a12,12,0,0,1,0,24H24a12,12,0,0,1-12-12V88a12,12,0,0,1,24,0v35.16l15.66-15.55A108,108,0,0,1,236,184Z"},child:[]}]})(e)}function K_(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,200a12,12,0,0,1-24,0,84.09,84.09,0,0,0-84-84H61l27.52,27.51a12,12,0,0,1-17,17l-48-48a12,12,0,0,1,0-17l48-48a12,12,0,0,1,17,17L61,92h67A108.12,108.12,0,0,1,236,200Z"},child:[]}]})(e)}function _De(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function Gs(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a100,100,0,0,1-98.66,100H128a99.39,99.39,0,0,1-68.62-27.29,12,12,0,0,1,16.48-17.45,76,76,0,1,0-1.57-109c-.13.13-.25.25-.39.37L54.89,92H72a12,12,0,0,1,0,24H24a12,12,0,0,1-12-12V56a12,12,0,0,1,24,0V76.72L57.48,57.06A100,100,0,0,1,228,128Z"},child:[]}]})(e)}function SDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,152.49l-72,72a12,12,0,0,1-17,0l-72-72a12,12,0,0,1,17-17L116,187V40a12,12,0,0,1,24,0V187l51.51-51.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function kDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H69l51.52,51.51a12,12,0,0,1-17,17l-72-72a12,12,0,0,1,0-17l72-72a12,12,0,0,1,17,17L69,116H216A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function IDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M47.51,112.49a12,12,0,0,1,17-17L116,147V32a12,12,0,0,1,24,0V147l51.51-51.52a12,12,0,0,1,17,17l-72,72a12,12,0,0,1-17,0ZM216,204H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function jDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,143.51a12,12,0,0,1-17,17L140,109V224a12,12,0,0,1-24,0V109L64.49,160.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0ZM216,28H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function EDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.49,136.49l-72,72a12,12,0,0,1-17-17L187,140H40a12,12,0,0,1,0-24H187L135.51,64.48a12,12,0,0,1,17-17l72,72A12,12,0,0,1,224.49,136.49Z"},child:[]}]})(e)}function Z_(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,104a12,12,0,0,1-24,0V69l-59.51,59.51a12,12,0,0,1-17-17L187,52H152a12,12,0,0,1,0-24h64a12,12,0,0,1,12,12Zm-44,24a12,12,0,0,0-12,12v64H52V84h64a12,12,0,0,0,0-24H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V140A12,12,0,0,0,184,128Z"},child:[]}]})(e)}function ADe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,120.49a12,12,0,0,1-17,0L140,69V216a12,12,0,0,1-24,0V69L64.49,120.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0l72,72A12,12,0,0,1,208.49,120.49Z"},child:[]}]})(e)}function PDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V96a12,12,0,0,1-12,12H168a12,12,0,0,1,0-24h19l-7.8-7.8a75.55,75.55,0,0,0-53.32-22.26h-.43A75.49,75.49,0,0,0,72.39,75.57,12,12,0,1,1,55.61,58.41a99.38,99.38,0,0,1,69.87-28.47H126A99.42,99.42,0,0,1,196.2,59.23L204,67V48a12,12,0,0,1,24,0ZM183.61,180.43a75.49,75.49,0,0,1-53.09,21.63h-.43A75.55,75.55,0,0,1,76.77,179.8L69,172H88a12,12,0,0,0,0-24H40a12,12,0,0,0-12,12v48a12,12,0,0,0,24,0V189l7.8,7.8A99.42,99.42,0,0,0,130,226.06h.56a99.38,99.38,0,0,0,69.87-28.47,12,12,0,0,0-16.78-17.16Z"},child:[]}]})(e)}function aC(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M88,108H40A12,12,0,0,1,28,96V48a12,12,0,0,1,24,0V67l7.8-7.8A99.42,99.42,0,0,1,130,29.94h.56a99.38,99.38,0,0,1,69.87,28.47,12,12,0,0,1-16.78,17.16,76,76,0,0,0-106.84.63L69,84H88a12,12,0,0,1,0,24Zm128,40H168a12,12,0,0,0,0,24h19l-7.8,7.8a75.55,75.55,0,0,1-53.32,22.26h-.43a75.49,75.49,0,0,1-53.09-21.63,12,12,0,0,0-16.78,17.16,99.38,99.38,0,0,0,69.87,28.47H126a99.42,99.42,0,0,0,70.16-29.29L204,189v19a12,12,0,0,0,24,0V160A12,12,0,0,0,216,148Z"},child:[]}]})(e)}function QZ(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M120.49,167.51a12,12,0,0,1,0,17l-32,32a12,12,0,0,1-17,0l-32-32a12,12,0,1,1,17-17L68,179V48a12,12,0,0,1,24,0V179l11.51-11.52A12,12,0,0,1,120.49,167.51Zm96-96-32-32a12,12,0,0,0-17,0l-32,32a12,12,0,0,0,17,17L164,77V208a12,12,0,0,0,24,0V77l11.51,11.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function TDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128ZM119.51,96.49a12,12,0,0,0,17,0l32-32a12,12,0,0,0-17-17L140,59V16a12,12,0,0,0-24,0V59L104.49,47.51a12,12,0,0,0-17,17Zm17,63a12,12,0,0,0-17,0l-32,32a12,12,0,0,0,17,17L116,197v43a12,12,0,0,0,24,0V197l11.51,11.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function JZ(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},child:[]}]})(e)}function X_(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M220,48V96a12,12,0,0,1-24,0V77l-35.51,35.52a12,12,0,0,1-17-17L179,60H160a12,12,0,0,1,0-24h48A12,12,0,0,1,220,48ZM95.51,143.51,60,179V160a12,12,0,0,0-24,0v48a12,12,0,0,0,12,12H96a12,12,0,0,0,0-24H77l35.52-35.51a12,12,0,0,0-17-17ZM208,148a12,12,0,0,0-12,12v19l-35.51-35.52a12,12,0,0,0-17,17L179,196H160a12,12,0,0,0,0,24h48a12,12,0,0,0,12-12V160A12,12,0,0,0,208,148ZM77,60H96a12,12,0,0,0,0-24H48A12,12,0,0,0,36,48V96a12,12,0,0,0,24,0V77l35.51,35.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function DDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128ZM104.49,56.48,116,45V88a12,12,0,0,0,24,0V45l11.51,11.51a12,12,0,0,0,17-17l-32-32a12,12,0,0,0-17,0l-32,32a12,12,0,0,0,17,17Zm47,143L140,211V168a12,12,0,0,0-24,0v43l-11.51-11.52a12,12,0,0,0-17,17l32,32a12,12,0,0,0,17,0l32-32a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function eX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.29,182.17a12,12,0,0,1-16.47,4.12L140,149.19V216a12,12,0,0,1-24,0V149.19l-61.82,37.1a12,12,0,1,1-12.35-20.58L104.68,128,41.83,90.29A12,12,0,1,1,54.18,69.71L116,106.81V40a12,12,0,0,1,24,0v66.81l61.82-37.1a12,12,0,1,1,12.35,20.58L151.32,128l62.85,37.71A12,12,0,0,1,218.29,182.17Z"},child:[]}]})(e)}function MDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,28H72A20,20,0,0,0,52,48V224a12,12,0,0,0,18.36,10.18l57.63-36,57.65,36A12,12,0,0,0,204,224V48A20,20,0,0,0,184,28Zm-4,174.35-45.65-28.53a12,12,0,0,0-12.72,0L76,202.35V52H180Z"},child:[]}]})(e)}function nc(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,100a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H176a20,20,0,0,0-20,20v4H100V48A20,20,0,0,0,80,28H48A20,20,0,0,0,28,48V80a20,20,0,0,0,20,20h4v56H48a20,20,0,0,0-20,20v32a20,20,0,0,0,20,20H80a20,20,0,0,0,20-20v-4h56v4a20,20,0,0,0,20,20h32a20,20,0,0,0,20-20V176a20,20,0,0,0-20-20h-4V100ZM180,52h24V76H180ZM52,52H76V76H52ZM76,204H52V180H76Zm128,0H180V180h24Zm-24-48h-4a20,20,0,0,0-20,20v4H100v-4a20,20,0,0,0-20-20H76V100h4a20,20,0,0,0,20-20V76h56v4a20,20,0,0,0,20,20h4Z"},child:[]}]})(e)}function LDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M54.8,119.49A35.06,35.06,0,0,1,49.05,128a35.06,35.06,0,0,1,5.75,8.51C60,147.24,60,159.83,60,172c0,25.94,1.84,32,20,32a12,12,0,0,1,0,24c-19.14,0-32.2-6.9-38.8-20.51C36,196.76,36,184.17,36,172c0-25.94-1.84-32-20-32a12,12,0,0,1,0-24c18.16,0,20-6.06,20-32,0-12.17,0-24.76,5.2-35.49C47.8,34.9,60.86,28,80,28a12,12,0,0,1,0,24c-18.16,0-20,6.06-20,32C60,96.17,60,108.76,54.8,119.49ZM240,116c-18.16,0-20-6.06-20-32,0-12.17,0-24.76-5.2-35.49C208.2,34.9,195.14,28,176,28a12,12,0,0,0,0,24c18.16,0,20,6.06,20,32,0,12.17,0,24.76,5.2,35.49A35.06,35.06,0,0,0,207,128a35.06,35.06,0,0,0-5.75,8.51C196,147.24,196,159.83,196,172c0,25.94-1.84,32-20,32a12,12,0,0,0,0,24c19.14,0,32.2-6.9,38.8-20.51C220,196.76,220,184.17,220,172c0-25.94,1.84-32,20-32a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function RDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.24,213.21C216.12,203,204,180.64,204,152V134.73a19.94,19.94,0,0,0-12.62-18.59l-24.86-9.81a4,4,0,0,1-2.26-5.14l21.33-53A32,32,0,0,0,167.17,6,32.13,32.13,0,0,0,126.25,24.2l-.07.18-21,53.09a3.94,3.94,0,0,1-2.14,2.2,3.89,3.89,0,0,1-3,.06L74.6,69.43A19.89,19.89,0,0,0,52.87,74C31.06,96.43,20,122.68,20,152a115.46,115.46,0,0,0,32.29,80.3A12,12,0,0,0,61,236H232a12,12,0,0,0,5.24-22.79ZM68.19,92.73,91.06,102A28,28,0,0,0,127.5,86.31l20.95-53a8.32,8.32,0,0,1,10.33-4.81,8,8,0,0,1,4.61,10.57,1.17,1.17,0,0,0,0,.11L142,92.29a28.05,28.05,0,0,0,15.68,36.33L180,137.45V152c0,1,0,2.07.05,3.1l-122.44-49A101.91,101.91,0,0,1,68.19,92.73ZM116.74,212a83.73,83.73,0,0,1-22.09-39,12,12,0,0,0-23.25,6,110.27,110.27,0,0,0,14.49,33H66.25A91.53,91.53,0,0,1,44,152a84,84,0,0,1,3.41-24.11l136.67,54.66A86.58,86.58,0,0,0,198.66,212Z"},child:[]}]})(e)}function ODe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,160a12,12,0,0,0,0-24H212V120h12a12,12,0,0,0,0-24H210.45a83.7,83.7,0,0,0-18.78-38.7l16.82-16.81a12,12,0,1,0-17-17l-18,18a83.7,83.7,0,0,0-91.1,0l-18-18a12,12,0,0,0-17,17L64.33,57.3A83.7,83.7,0,0,0,45.55,96H32a12,12,0,0,0,0,24H44v16H32a12,12,0,0,0,0,24H44a83.55,83.55,0,0,0,1.55,16H32a12,12,0,0,0,0,24H54.15a84,84,0,0,0,147.7,0H224a12,12,0,0,0,0-24H210.45A83.55,83.55,0,0,0,212,160ZM128,52a60.1,60.1,0,0,1,57.82,44H70.18A60.1,60.1,0,0,1,128,52Zm12,166.79V148a12,12,0,0,0-24,0v70.79A60.09,60.09,0,0,1,68,160V120H188v40A60.09,60.09,0,0,1,140,218.79Z"},child:[]}]})(e)}function Do(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,104.49l-80,80a12,12,0,0,1-17,0l-80-80a12,12,0,0,1,17-17L128,159l71.51-71.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function tX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M168.49,199.51a12,12,0,0,1-17,17l-80-80a12,12,0,0,1,0-17l80-80a12,12,0,0,1,17,17L97,128Z"},child:[]}]})(e)}function NDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M152.49,119.51a12,12,0,0,1,0,17l-80,80a12,12,0,0,1-17-17L127,128,55.51,56.49a12,12,0,0,1,17-17ZM184,36a12,12,0,0,0-12,12V208a12,12,0,0,0,24,0V48A12,12,0,0,0,184,36Z"},child:[]}]})(e)}function Y_(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"},child:[]}]})(e)}function B4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,168.49a12,12,0,0,1-17,0L128,97,56.49,168.49a12,12,0,0,1-17-17l80-80a12,12,0,0,1,17,0l80,80A12,12,0,0,1,216.49,168.49Z"},child:[]}]})(e)}function Yc(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,80.49l-128,128a12,12,0,0,1-17,0l-56-56a12,12,0,1,1,17-17L96,183,215.51,63.51a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function nX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Z"},child:[]}]})(e)}function FDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,128a108,108,0,0,1-216,0c0-42.52,24.73-81.34,63-98.9A12,12,0,1,1,93,50.91C63.24,64.57,44,94.83,44,128a84,84,0,0,0,168,0c0-33.17-19.24-63.43-49-77.09A12,12,0,1,1,173,29.1C211.27,46.66,236,85.48,236,128Z"},child:[]}]})(e)}function sX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM52,52H76v95.22a24,24,0,1,0,24,0V125l40,40v39H52ZM204,204H164V160a12,12,0,0,0-3.51-8.49L100,91V52h24V72a12,12,0,0,0,3.51,8.49l17.31,17.3a24,24,0,1,0,17-17L148,67V52h56Z"},child:[]}]})(e)}function BDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.68,97.22,34.74,128l36.94,30.78a12,12,0,1,1-15.36,18.44l-48-40a12,12,0,0,1,0-18.44l48-40A12,12,0,0,1,71.68,97.22Zm176,21.56-48-40a12,12,0,1,0-15.36,18.44L221.26,128l-36.94,30.78a12,12,0,1,0,15.36,18.44l48-40a12,12,0,0,0,0-18.44ZM164.1,28.72a12,12,0,0,0-15.38,7.18l-64,176a12,12,0,0,0,7.18,15.37A11.79,11.79,0,0,0,96,228a12,12,0,0,0,11.28-7.9l64-176A12,12,0,0,0,164.1,28.72Z"},child:[]}]})(e)}function ws(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,28H88A12,12,0,0,0,76,40V76H40A12,12,0,0,0,28,88V216a12,12,0,0,0,12,12H168a12,12,0,0,0,12-12V180h36a12,12,0,0,0,12-12V40A12,12,0,0,0,216,28ZM156,204H52V100H156Zm48-48H180V88a12,12,0,0,0-12-12H100V52H204Z"},child:[]}]})(e)}function z4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,192a12,12,0,0,1-12,12H204v28a12,12,0,0,1-24,0V204H64a12,12,0,0,1-12-12V76H24a12,12,0,0,1,0-24H52V24a12,12,0,0,1,24,0V180H232A12,12,0,0,1,244,192ZM104,76h76v76a12,12,0,0,0,24,0V64a12,12,0,0,0-12-12H104a12,12,0,0,0,0,24Z"},child:[]}]})(e)}function iX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,116h-4.72A100.21,100.21,0,0,0,140,28.72V24a12,12,0,0,0-24,0v4.72A100.21,100.21,0,0,0,28.72,116H24a12,12,0,0,0,0,24h4.72A100.21,100.21,0,0,0,116,227.28V232a12,12,0,0,0,24,0v-4.72A100.21,100.21,0,0,0,227.28,140H232a12,12,0,0,0,0-24Zm-92,87v-3a12,12,0,0,0-24,0v3a76.15,76.15,0,0,1-63-63h3a12,12,0,0,0,0-24H53a76.15,76.15,0,0,1,63-63v3a12,12,0,0,0,24,0V53a76.15,76.15,0,0,1,63,63h-3a12,12,0,0,0,0,24h3A76.15,76.15,0,0,1,140,203ZM128,84a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function u1(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.6,62.64l-88-48.17a19.91,19.91,0,0,0-19.2,0l-88,48.17A20,20,0,0,0,20,80.19v95.62a20,20,0,0,0,10.4,17.55l88,48.17a19.89,19.89,0,0,0,19.2,0l88-48.17A20,20,0,0,0,236,175.81V80.19A20,20,0,0,0,225.6,62.64ZM128,36.57,200,76,128,115.4,56,76ZM44,96.79l72,39.4v76.67L44,173.44Zm96,116.07V136.19l72-39.4v76.65Z"},child:[]}]})(e)}function zDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.15,179.17l-46.83-46.82,37.93-13.51.76-.3a20,20,0,0,0-1.76-37.27L54.16,29A20,20,0,0,0,29,54.16L81.27,214.24A20,20,0,0,0,118.54,216c.11-.25.21-.5.3-.76l13.51-37.92,46.83,46.82a20,20,0,0,0,28.28,0l16.69-16.68A20,20,0,0,0,224.15,179.17Zm-30.83,25.17-48.48-48.48A20,20,0,0,0,130.7,150a20.66,20.66,0,0,0-3.74.35A20,20,0,0,0,112.35,162c-.11.25-.21.5-.3.76L100.4,195.5,54.29,54.29l141.21,46.1-32.71,11.66c-.26.09-.51.19-.76.3a20,20,0,0,0-6.17,32.48h0l48.49,48.48Z"},child:[]}]})(e)}function VDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,208a12,12,0,0,1-12,12H160a43.86,43.86,0,0,1-32-13.85A43.86,43.86,0,0,1,96,220H80a12,12,0,0,1,0-24H96a20,20,0,0,0,20-20V140H104a12,12,0,0,1,0-24h12V80A20,20,0,0,0,96,60H80a12,12,0,0,1,0-24H96a43.86,43.86,0,0,1,32,13.85A43.86,43.86,0,0,1,160,36h16a12,12,0,0,1,0,24H160a20,20,0,0,0-20,20v36h12a12,12,0,0,1,0,24H140v36a20,20,0,0,0,20,20h16A12,12,0,0,1,188,208Z"},child:[]}]})(e)}function $De(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,128a16,16,0,1,1-16-16A16,16,0,0,1,144,128ZM60,112a16,16,0,1,0,16,16A16,16,0,0,0,60,112Zm136,0a16,16,0,1,0,16,16A16,16,0,0,0,196,112Z"},child:[]}]})(e)}function GDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M112,60a16,16,0,1,1,16,16A16,16,0,0,1,112,60Zm16,52a16,16,0,1,0,16,16A16,16,0,0,0,128,112Zm0,68a16,16,0,1,0,16,16A16,16,0,0,0,128,180Z"},child:[]}]})(e)}function oX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.51,88.49a12,12,0,0,1,17-17L116,99V24a12,12,0,0,1,24,0V99l27.51-27.52a12,12,0,0,1,17,17l-48,48a12,12,0,0,1-17,0ZM224,116H188a12,12,0,0,0,0,24h32v56H36V140H68a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116Zm-20,52a16,16,0,1,0-16,16A16,16,0,0,0,204,168Z"},child:[]}]})(e)}function Wh(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0Zm-108.49,8.49a12,12,0,0,0,17,0l40-40a12,12,0,0,0-17-17L140,115V32a12,12,0,0,0-24,0v83L96.49,95.51a12,12,0,0,0-17,17Z"},child:[]}]})(e)}function HDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M134.88,6.17a12,12,0,0,0-13.76,0,259,259,0,0,0-42.18,39C50.85,77.43,36,111.63,36,144a92,92,0,0,0,184,0C220,66.64,138.36,8.6,134.88,6.17ZM194.08,160H140V144h56A68,68,0,0,1,194.08,160ZM140,120V104h47a115,115,0,0,1,5.68,16Zm19.3-58.71A197.29,197.29,0,0,1,173.68,80H140V41.46A243.5,243.5,0,0,1,159.3,61.29ZM60,144c0-33.31,20-63.37,36.7-82.71A243.5,243.5,0,0,1,116,41.46V210.92A68.1,68.1,0,0,1,60,144Zm80,66.92V184h42.94A68,68,0,0,1,140,210.92Z"},child:[]}]})(e)}function WDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,204H141l86.84-86.84a28,28,0,0,0,0-39.6L186.43,36.19a28,28,0,0,0-39.6,0L28.19,154.82a28,28,0,0,0,0,39.6l30.06,30.07A12,12,0,0,0,66.74,228H216a12,12,0,0,0,0-24ZM163.8,53.16a4,4,0,0,1,5.66,0l41.38,41.38a4,4,0,0,1,0,5.65L160,151l-47-47ZM71.71,204,45.16,177.45a4,4,0,0,1,0-5.65L96,121l47,47-36,36Z"},child:[]}]})(e)}function V4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M148,200a20,20,0,1,1-20-20A20,20,0,0,1,148,200Zm-20-40a12,12,0,0,0,12-12V48a12,12,0,0,0-24,0V148A12,12,0,0,0,128,160Z"},child:[]}]})(e)}function bu(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M251,123.13c-.37-.81-9.13-20.26-28.48-39.61C196.63,57.67,164,44,128,44S59.37,57.67,33.51,83.52C14.16,102.87,5.4,122.32,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212s68.63-13.66,94.48-39.51c19.36-19.35,28.12-38.79,28.49-39.61A12.08,12.08,0,0,0,251,123.13Zm-46.06,33C183.47,177.27,157.59,188,128,188s-55.47-10.73-76.91-31.88A130.36,130.36,0,0,1,29.52,128,130.45,130.45,0,0,1,51.09,99.89C72.54,78.73,98.41,68,128,68s55.46,10.73,76.91,31.89A130.36,130.36,0,0,1,226.48,128,130.45,130.45,0,0,1,204.91,156.12ZM128,84a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function aX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.42,162A12,12,0,1,1,213.58,174l-16.86-29.5a127.19,127.19,0,0,1-30.17,13.86L171.84,190a12,12,0,0,1-9.87,13.8,11.22,11.22,0,0,1-2,.17,12,12,0,0,1-11.82-10L143,163.17a136.5,136.5,0,0,1-30.06,0L107.84,194A12,12,0,0,1,96,204a11.22,11.22,0,0,1-2-.17A12,12,0,0,1,84.16,190l5.29-31.72a127.19,127.19,0,0,1-30.17-13.86L42.42,174A12,12,0,1,1,21.58,162L40,129.85a159.73,159.73,0,0,1-17.31-18.31A12,12,0,0,1,41.34,96.46C57.38,116.32,85.44,140,128,140s70.62-23.68,86.66-43.54a12,12,0,0,1,18.67,15.08A159.73,159.73,0,0,1,216,129.85Z"},child:[]}]})(e)}function $4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M56.88,31.93A12,12,0,1,0,39.12,48.07l16,17.65C20.67,88.66,5.72,121.58,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212a131.34,131.34,0,0,0,51-10l20.09,22.1a12,12,0,0,0,17.76-16.14ZM128,188c-29.59,0-55.47-10.73-76.91-31.88A130.69,130.69,0,0,1,29.52,128c5.27-9.31,18.79-29.9,42-44.29l90.09,99.11A109.33,109.33,0,0,1,128,188Zm123-55.12c-.36.81-9,20-28,39.16a12,12,0,1,1-17-16.9A130.48,130.48,0,0,0,226.48,128a130.36,130.36,0,0,0-21.57-28.12C183.46,78.73,157.59,68,128,68c-3.35,0-6.7.14-10,.42a12,12,0,1,1-2-23.91c3.93-.34,8-.51,12-.51,36,0,68.63,13.67,94.49,39.52,19.35,19.35,28.11,38.8,28.48,39.61A12.08,12.08,0,0,1,251,132.88Z"},child:[]}]})(e)}function UDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,67.24a39.77,39.77,0,0,0-12.51-28.52C199.91,24,174.71,24.5,159.29,39.93L142.48,56.84a28,28,0,0,0-35.64,3.29l-9,9a20,20,0,0,0-.73,27.49L48.9,144.84A43.76,43.76,0,0,0,37,185.28l-7.5,17.19a17.66,17.66,0,0,0,3.71,19.65,19.9,19.9,0,0,0,22.15,4.19l16.31-7.13a43.88,43.88,0,0,0,39.45-12.09l48.24-48.26a20,20,0,0,0,27.47-.73l9-9a28.06,28.06,0,0,0,3.26-35.72l17.23-17.33A39.69,39.69,0,0,0,228,67.24ZM94.15,190.11a20,20,0,0,1-20,5,11.93,11.93,0,0,0-8.32.47L57,199.38,60.69,191a12,12,0,0,0,.37-8.64,19.92,19.92,0,0,1,4.81-20.55l48.2-48.22,28.28,28.3Zm105.14-111-25.37,25.52a12,12,0,0,0,0,16.95l4.88,4.89a4,4,0,0,1,0,5.66l-6.14,6.15-55-55.05,6.14-6.14a4,4,0,0,1,5.65,0L134.35,82a12,12,0,0,0,8.49,3.51h0A12,12,0,0,0,151.34,82l24.94-25.08c6.3-6.3,16.48-6.63,22.71-.74a16,16,0,0,1,.3,23Z"},child:[]}]})(e)}function qDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.52l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.52ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Zm100.49-60.49a12,12,0,0,1,0,17l-24,24a12,12,0,0,1-17,0l-24-24a12,12,0,0,1,17-17L116,155V124a12,12,0,0,1,24,0v31l3.51-3.52A12,12,0,0,1,160.49,151.51Z"},child:[]}]})(e)}function ex(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.52l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.52ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Z"},child:[]}]})(e)}function Q_(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.51l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.51ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Zm104-60a12,12,0,0,1-12,12H140v12a12,12,0,0,1-24,0V164H104a12,12,0,0,1,0-24h12V128a12,12,0,0,1,24,0v12h12A12,12,0,0,1,164,152Z"},child:[]}]})(e)}function G4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.15,197.71,164,95.81V44h4a12,12,0,0,0,0-24H88a12,12,0,0,0,0,24h4V95.81L30.85,197.71A20,20,0,0,0,48,228H208a20,20,0,0,0,17.15-30.29ZM140,44V99.14a12,12,0,0,0,1.71,6.17l35.13,58.54c-10.79.86-25.15-1.31-43.42-10.56-14-7.08-27.46-11.33-40.27-12.76l21.14-35.22A12,12,0,0,0,116,99.14V44ZM55.06,204,79,164.19c13-1.11,27.62,2.42,43.62,10.52,19.61,9.92,36.25,13.31,49.85,13.31A75.44,75.44,0,0,0,190.11,186l10.83,18Z"},child:[]}]})(e)}function Ol(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M222.14,69.17,186.83,33.86A19.86,19.86,0,0,0,172.69,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V83.31A19.86,19.86,0,0,0,222.14,69.17ZM164,204H92V160h72Zm40,0H188V156a20,20,0,0,0-20-20H88a20,20,0,0,0-20,20v48H52V52H171l33,33ZM164,84a12,12,0,0,1-12,12H96a12,12,0,0,1,0-24h56A12,12,0,0,1,164,84Z"},child:[]}]})(e)}function h1(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M248.49,71.51l-32-32a12,12,0,0,0-17,17L211,68h-3c-52,0-64.8,30.71-75.08,55.38-8.82,21.17-15.45,37.05-42.75,40.09a44,44,0,1,0,.28,24.08c43.34-3.87,55.07-32,64.63-54.93C164.9,109,172,92,208,92h3l-11.52,11.51a12,12,0,0,0,17,17l32-32A12,12,0,0,0,248.49,71.51ZM48,196a20,20,0,1,1,20-20A20,20,0,0,1,48,196Z"},child:[]}]})(e)}function J_(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M248.23,112.31A20,20,0,0,0,232,104H220V88a20,20,0,0,0-20-20H132L105.34,48a20.12,20.12,0,0,0-12-4H40A20,20,0,0,0,20,64V208a12,12,0,0,0,12,12H211.1a12,12,0,0,0,11.33-8l28.49-81.47.06-.17A20,20,0,0,0,248.23,112.31ZM92,68l28.8,21.6A12,12,0,0,0,128,92h68v12H69.77a20,20,0,0,0-18.94,13.58L44,137.15V68ZM202.59,196H48.89l23.72-68H226.37Z"},child:[]}]})(e)}function rX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,56H160L133.33,36a20.12,20.12,0,0,0-12-4H76A20,20,0,0,0,56,52V72H36A20,20,0,0,0,16,92V204a20,20,0,0,0,20,20H188.89A19.13,19.13,0,0,0,208,204.89V184h20.89A19.13,19.13,0,0,0,248,164.89V76A20,20,0,0,0,228,56ZM184,200H40V96H80l28.8,21.6A12,12,0,0,0,116,120h68Zm40-40H208V116a20,20,0,0,0-20-20H120L93.33,76a20.12,20.12,0,0,0-12-4H80V56h40l28.8,21.6A12,12,0,0,0,156,80h68Z"},child:[]}]})(e)}function Sm(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,88a12,12,0,0,1,12-12h32a12,12,0,0,1,12,12v32a12,12,0,0,1-24,0V100H152A12,12,0,0,1,140,88ZM72,180h32a12,12,0,0,0,0-24H84V136a12,12,0,0,0-24,0v32A12,12,0,0,0,72,180ZM236,56V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56Zm-24,4H44V196H212Z"},child:[]}]})(e)}function KDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},child:[]}]})(e)}function ZDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,116H219.22A92.21,92.21,0,0,0,140,36.78V16a12,12,0,0,0-24,0V36.78A92.21,92.21,0,0,0,36.78,116H16a12,12,0,0,0,0,24H36.78A92.21,92.21,0,0,0,116,219.22V240a12,12,0,0,0,24,0V219.22A92.21,92.21,0,0,0,219.22,140H240a12,12,0,0,0,0-24ZM128,196a68,68,0,1,1,68-68A68.07,68.07,0,0,1,128,196Zm0-112a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function lX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M250.18,105.17,186.71,41.25a100.11,100.11,0,0,0-141.43,0l-.13.14L31.37,55.61a12,12,0,1,0,17.24,16.7L62.32,58.16A75.68,75.68,0,0,1,77.49,46.43L119,88,25.85,181.16a20,20,0,0,0,0,28.29l20.69,20.69a20,20,0,0,0,28.28,0L168,137l1.51,1.51h0l23.65,23.66a20,20,0,0,0,28.29,0l28.69-28.7A20,20,0,0,0,250.18,105.17ZM60.68,210.34l-15-15L108,133l15,15ZM140,131l-15-15,19.51-19.51a12,12,0,0,0,0-17L102.24,37.24a75.94,75.94,0,0,1,67.47,20.95l31.44,31.67L178,113l-1.51-1.51a12,12,0,0,0-17,0Zm67.32,11.31L195,130l23.09-23.09,12.3,12.39Z"},child:[]}]})(e)}function XDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,44a32,32,0,0,0-8,1V44a32,32,0,0,0-60.79-14A32,32,0,0,0,76,60v50.83a32,32,0,0,0-52,36.7C55.82,214.6,75.35,244,128,244a92.1,92.1,0,0,0,92-92V76A32,32,0,0,0,188,44Zm8,108a68.08,68.08,0,0,1-68,68c-35.83,0-49.71-14-82.48-83.14-.14-.29-.29-.58-.45-.86a8,8,0,0,1,13.85-8l.21.35,18.68,30A12,12,0,0,0,100,152V60a8,8,0,0,1,16,0v60a12,12,0,0,0,24,0V44a8,8,0,0,1,16,0v76a12,12,0,0,0,24,0V76a8,8,0,0,1,16,0Z"},child:[]}]})(e)}function YDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,20H72A20,20,0,0,0,52,40V76a20.1,20.1,0,0,0,8,16l48,36L60,164a20.1,20.1,0,0,0-8,16v36a20,20,0,0,0,20,20H184a20,20,0,0,0,20-20V180.36a20.13,20.13,0,0,0-7.94-16L147.9,128l48.16-36.4a20.13,20.13,0,0,0,7.94-16V40A20,20,0,0,0,184,20Zm-4,24V60H76V44Zm-52,69L89.33,84h77Zm52,99H76V182l52-39,52,39.33Z"},child:[]}]})(e)}function xh(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,96a16,16,0,1,1,16,16A16,16,0,0,1,144,96Zm92-40V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56ZM44,60v79.72l33.86-33.86a20,20,0,0,1,28.28,0L147.31,147l17.18-17.17a20,20,0,0,1,28.28,0L212,149.09V60Zm0,136H162.34L92,125.66l-48,48Zm168,0V183l-33.37-33.37L164.28,164l32,32Z"},child:[]}]})(e)}function QDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M160,88a16,16,0,1,1,16,16A16,16,0,0,1,160,88Zm76-32V160a20,20,0,0,1-20,20H204v20a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V88A20,20,0,0,1,40,68H60V56A20,20,0,0,1,80,36H216A20,20,0,0,1,236,56ZM180,180H80a20,20,0,0,1-20-20V92H44V196H180Zm-21.66-24L124,121.66,89.66,156ZM212,60H84v67.72l25.86-25.86a20,20,0,0,1,28.28,0L192.28,156H212Z"},child:[]}]})(e)}function JDe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H88A20,20,0,0,0,68,48V60H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V188h12a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM92,52H204v59.72l-9.86-9.86a20,20,0,0,0-28.28,0L103.72,164H92Zm80,152H52V84H68v84a20,20,0,0,0,20,20h84Zm-34.34-40L180,121.66l24,24V164ZM108,88a20,20,0,1,1,20,20A20,20,0,0,1,108,88Z"},child:[]}]})(e)}function km(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M108,84a16,16,0,1,1,16,16A16,16,0,0,1,108,84Zm128,44A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Zm-72,36.68V132a20,20,0,0,0-20-20,12,12,0,0,0-4,23.32V168a20,20,0,0,0,20,20,12,12,0,0,0,4-23.32Z"},child:[]}]})(e)}function eMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V192a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V64A20,20,0,0,0,224,44Zm-4,144H36V68H220ZM52,128a12,12,0,0,1,12-12H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,128Zm0-36A12,12,0,0,1,64,80H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,92Zm0,72a12,12,0,0,1,12-12h8a12,12,0,0,1,0,24H64A12,12,0,0,1,52,164Zm108,0a12,12,0,0,1-12,12H108a12,12,0,0,1,0-24h40A12,12,0,0,1,160,164Zm44,0a12,12,0,0,1-12,12h-8a12,12,0,0,1,0-24h8A12,12,0,0,1,204,164Z"},child:[]}]})(e)}function tMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M180,232a12,12,0,0,1-12,12H88a12,12,0,0,1,0-24h80A12,12,0,0,1,180,232Zm40-128a92.47,92.47,0,0,1-37,73.73,7.81,7.81,0,0,0-3,6.27,20,20,0,0,1-20,20H96a20,20,0,0,1-20-20v-.23a7.76,7.76,0,0,0-3.25-6.2,91.36,91.36,0,0,1-36.75-73C35.73,54.69,76,13.2,125.79,12A92,92,0,0,1,220,104Zm-24,0a68,68,0,0,0-69.65-68C89.56,36.89,59.8,67.56,60,104.39a67.52,67.52,0,0,0,27.18,54h0A32.14,32.14,0,0,1,99.77,180H116V149L87.51,120.49a12,12,0,0,1,17-17L128,127l23.51-23.51a12,12,0,0,1,17,17L140,149v31h16.25a31.89,31.89,0,0,1,12.41-21.49A67.45,67.45,0,0,0,196,104Z"},child:[]}]})(e)}function cX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"},child:[]}]})(e)}function nMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M87.5,151.52l64-64a12,12,0,0,1,17,17l-64,64a12,12,0,0,1-17-17Zm131-114a60.08,60.08,0,0,0-84.87,0L103.51,67.61a12,12,0,0,0,17,17l30.07-30.06a36,36,0,0,1,50.93,50.92L171.4,135.52a12,12,0,1,0,17,17l30.08-30.06A60.09,60.09,0,0,0,218.45,37.55ZM135.52,171.4l-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function sMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128ZM40,76H216a12,12,0,0,0,0-24H40a12,12,0,0,0,0,24ZM216,180H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function H4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,76H100V56a28,28,0,0,1,28-28c13.51,0,25.65,9.62,28.24,22.39a12,12,0,1,0,23.52-4.78C174.87,21.5,153.1,4,128,4A52.06,52.06,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76Zm-4,128H52V100H204Z"},child:[]}]})(e)}function iMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M252,152a12,12,0,0,1-12,12H228v12a12,12,0,0,1-24,0V164H192a12,12,0,0,1,0-24h12V128a12,12,0,0,1,24,0v12h12A12,12,0,0,1,252,152ZM56,76H68V88a12,12,0,0,0,24,0V76h12a12,12,0,1,0,0-24H92V40a12,12,0,0,0-24,0V52H56a12,12,0,0,0,0,24ZM184,188h-4v-4a12,12,0,0,0-24,0v4h-4a12,12,0,0,0,0,24h4v4a12,12,0,0,0,24,0v-4h4a12,12,0,0,0,0-24ZM222.14,82.83,82.82,222.14a20,20,0,0,1-28.28,0L33.85,201.46a20,20,0,0,1,0-28.29L173.17,33.86a20,20,0,0,1,28.28,0l20.69,20.68A20,20,0,0,1,222.14,82.83ZM159,112,144,97,53.65,187.31l15,15Zm43.31-43.31-15-15L161,80l15,15Z"},child:[]}]})(e)}function dX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,215.51,185,168a92.12,92.12,0,1,0-17,17l47.53,47.54a12,12,0,0,0,17-17ZM44,112a68,68,0,1,1,68,68A68.07,68.07,0,0,1,44,112Z"},child:[]}]})(e)}function uX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H80a12,12,0,0,1,0-24h64A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function hX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H124v20a12,12,0,0,1-24,0V124H80a12,12,0,0,1,0-24h20V80a12,12,0,0,1,24,0v20h20A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function oMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,60a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,60Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,124Zm0-112a92.1,92.1,0,0,0-92,92c0,77.36,81.64,135.4,85.12,137.83a12,12,0,0,0,13.76,0,259,259,0,0,0,42.18-39C205.15,170.57,220,136.37,220,104A92.1,92.1,0,0,0,128,12Zm31.3,174.71A249.35,249.35,0,0,1,128,216.89a249.35,249.35,0,0,1-31.3-30.18C80,167.37,60,137.31,60,104a68,68,0,0,1,136,0C196,137.31,176,167.37,159.3,186.71Z"},child:[]}]})(e)}function aMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function rMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236.37,139.4a12,12,0,0,0-12-3A84.07,84.07,0,0,1,119.6,31.59a12,12,0,0,0-15-15A108.86,108.86,0,0,0,49.69,55.07,108,108,0,0,0,136,228a107.09,107.09,0,0,0,64.93-21.69,108.86,108.86,0,0,0,38.44-54.94A12,12,0,0,0,236.37,139.4Zm-49.88,47.74A84,84,0,0,1,68.86,69.51,84.93,84.93,0,0,1,92.27,48.29Q92,52.13,92,56A108.12,108.12,0,0,0,200,164q3.87,0,7.71-.27A84.79,84.79,0,0,1,186.49,187.14Z"},child:[]}]})(e)}function lMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M84,108A12,12,0,0,1,96,96h64a12,12,0,0,1,0,24H96A12,12,0,0,1,84,108Zm32,28H96a12,12,0,0,0,0,24h20a12,12,0,0,0,0-24ZM228,48V156.69a19.86,19.86,0,0,1-5.86,14.14l-51.31,51.31A19.86,19.86,0,0,1,156.69,228H48a20,20,0,0,1-20-20V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48ZM52,204h92V156a12,12,0,0,1,12-12h48V52H52Zm139-36H168v23Z"},child:[]}]})(e)}function pX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,32a12,12,0,0,0-12-12c-44.78,0-90,48.54-115.9,82a64,64,0,0,0-80,62c0,12-3.1,22.71-9.23,31.76A43,43,0,0,1,9.4,206.05a11.88,11.88,0,0,0-4.91,13.38A12.07,12.07,0,0,0,16.11,228h76A64,64,0,0,0,154,148C187.49,122.05,236,76.8,236,32ZM209.62,46.39c-4,12.92-13.15,27.49-26.92,42.91-3,3.39-6.16,6.7-9.35,9.89a104.31,104.31,0,0,0-16.5-16.51c3.19-3.19,6.49-6.32,9.88-9.35C182.15,59.55,196.71,50.43,209.62,46.39ZM92.07,204H42a80.17,80.17,0,0,0,10.14-40,40,40,0,1,1,40,40Zm38.18-91.32c3.12-3.93,6.55-8.09,10.23-12.35a80.52,80.52,0,0,1,15.23,15.24c-4.26,3.68-8.42,7.11-12.35,10.23A64.43,64.43,0,0,0,130.25,112.68Z"},child:[]}]})(e)}function cMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M203.57,51A107.9,107.9,0,0,0,20,128c0,44.72,27.6,82.25,72,97.94A36,36,0,0,0,140,192a12,12,0,0,1,12-12h46.21a35.79,35.79,0,0,0,35.1-28A108.6,108.6,0,0,0,236,127.09,107.23,107.23,0,0,0,203.57,51Zm6.34,95.67a11.91,11.91,0,0,1-11.7,9.3H152a36,36,0,0,0-36,36,12,12,0,0,1-16,11.3c-16.65-5.88-30.65-15.76-40.48-28.56A76,76,0,0,1,44,128a84,84,0,0,1,83.13-84H128a84.35,84.35,0,0,1,84,83.29A84.72,84.72,0,0,1,209.91,146.71ZM144,76a16,16,0,1,1-16-16A16,16,0,0,1,144,76Zm-44,24A16,16,0,1,1,84,84,16,16,0,0,1,100,100Zm0,56a16,16,0,1,1-16-16A16,16,0,0,1,100,156Zm88-56a16,16,0,1,1-16-16A16,16,0,0,1,188,100Z"},child:[]}]})(e)}function Im(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M230.14,70.54,185.46,25.85a20,20,0,0,0-28.29,0L33.86,149.17A19.85,19.85,0,0,0,28,163.31V208a20,20,0,0,0,20,20H92.69a19.86,19.86,0,0,0,14.14-5.86L230.14,98.82a20,20,0,0,0,0-28.28ZM93,180l71-71,11,11-71,71ZM76,163,65,152l71-71,11,11ZM52,173l15.51,15.51h0L83,204H52ZM192,103,153,64l18.34-18.34,39,39Z"},child:[]}]})(e)}function dMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M230.14,70.54,185.46,25.85a20,20,0,0,0-28.29,0L33.86,149.17A19.85,19.85,0,0,0,28,163.31V208a20,20,0,0,0,20,20H92.69a19.86,19.86,0,0,0,14.14-5.86L230.14,98.82a20,20,0,0,0,0-28.28ZM91,204H52V165l84-84,39,39ZM192,103,153,64l18.34-18.34,39,39Z"},child:[]}]})(e)}function W4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M255.62,51.65a12,12,0,0,0-11.27-11.27c-53.27-3.13-96.2,13.36-114.84,44.14-12.14,20-12.56,44.17-1.46,67.3a75.14,75.14,0,0,0-12.28,23l-12.66-12.66c7.19-16.77,6.43-34.11-2.4-48.69C86.73,90.36,54.89,78,15.55,80.27A12,12,0,0,0,4.28,91.55C2,130.89,14.36,162.73,37.45,176.71a49.76,49.76,0,0,0,26,7.27,57.54,57.54,0,0,0,22.7-4.87L112,205v23a12,12,0,0,0,24,0V198.51a51.63,51.63,0,0,1,9.49-29.95,76.82,76.82,0,0,0,32.1,7.39,64.91,64.91,0,0,0,33.89-9.46C242.25,147.85,258.76,104.92,255.62,51.65ZM49.88,156.18c-13.19-8-21.18-27.46-21.83-52.13,24.67.65,44.14,8.64,52.13,21.83a26,26,0,0,1,3.63,17L72.48,131.51a12,12,0,0,0-17,17l11.34,11.34A26.27,26.27,0,0,1,49.88,156.18ZM199.05,146c-10.66,6.45-23,7.67-35.81,3.76l37.25-37.24a12,12,0,0,0-17-17l-37.25,37.24C142.37,120,143.59,107.61,150,97c12.7-21,42.65-33,81.32-33H232C232.14,103,220.14,133.18,199.05,146Z"},child:[]}]})(e)}function Sn(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H140v76a12,12,0,0,1-24,0V140H40a12,12,0,0,1,0-24h76V40a12,12,0,0,1,24,0v76h76A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function uMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,64.49l-144,144a12,12,0,0,1-17-17l144-144a12,12,0,0,1,17,17ZM60,112a12,12,0,0,0,24,0V84h28a12,12,0,0,0,0-24H84V32a12,12,0,0,0-24,0V60H32a12,12,0,0,0,0,24H60Zm164,60H144a12,12,0,0,0,0,24h80a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function hMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M238.15,78.54,177.46,17.86a20,20,0,0,0-28.3,0L97.2,70c-12.43-3.33-36.68-5.72-61.74,14.5a20,20,0,0,0-1.6,29.73l45.46,45.47-39.8,39.8a12,12,0,0,0,17,17l39.8-39.81,45.47,45.46A20,20,0,0,0,155.91,228c.46,0,.93,0,1.4-.05A20,20,0,0,0,171.87,220c4.69-6.23,11-16.13,14.44-28s3.45-22.88.16-33.4l51.7-51.87A20,20,0,0,0,238.15,78.54Zm-74.26,68.79a12,12,0,0,0-2.23,13.84c3.43,6.86,6.9,21-6.28,40.65L54.08,100.53c21.09-14.59,39.53-6.64,41-6a11.67,11.67,0,0,0,13.81-2.29l54.43-54.61,55,55Z"},child:[]}]})(e)}function pMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M56.88,31.93A12,12,0,1,0,39.12,48.07L60,71A76,76,0,0,0,35.46,84.51a20,20,0,0,0-1.6,29.73l45.46,45.47-39.8,39.8a12,12,0,0,0,17,17l39.8-39.81,45.47,45.46A20,20,0,0,0,155.9,228c.47,0,.94,0,1.41-.05A20,20,0,0,0,171.87,220a97.47,97.47,0,0,0,9.54-15.46l17.72,19.49a12,12,0,1,0,17.76-16.14Zm98.49,169.88L54.08,100.52C62,95,70.31,92.12,78.91,91.83l84.51,93A62,62,0,0,1,155.37,201.81Zm82.78-95-39,39.11a12,12,0,1,1-17-16.95l36.19-36.3-55-55L130.59,70.5a12,12,0,0,1-17-16.94l35.57-35.69a20,20,0,0,1,28.3,0l60.69,60.68A20,20,0,0,1,238.15,106.83Z"},child:[]}]})(e)}function U4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M28,64A12,12,0,0,1,40,52H216a12,12,0,0,1,0,24H40A12,12,0,0,1,28,64Zm104,52H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm0,64H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm120-20a12,12,0,0,1-5.64,10.18l-64,40A12,12,0,0,1,164,200V120a12,12,0,0,1,18.36-10.18l64,40A12,12,0,0,1,252,160Zm-34.64,0L188,141.65v36.7Z"},child:[]}]})(e)}function q4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M100,52H40A20,20,0,0,0,20,72v64a20,20,0,0,0,20,20H96v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,100,52Zm-4,80H44V76H96ZM216,52H156a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20h56v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,216,52Zm-4,80H160V76h52Z"},child:[]}]})(e)}function fMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,36H40A20,20,0,0,0,20,56V200a20,20,0,0,0,20,20H216a20,20,0,0,0,20-20V56A20,20,0,0,0,216,36Zm-4,160H44V60H212Z"},child:[]}]})(e)}function mMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M84,48A12,12,0,0,1,72,60H44V72a12,12,0,0,1-24,0V56A20,20,0,0,1,40,36H72A12,12,0,0,1,84,48ZM32,156a12,12,0,0,0,12-12V112a12,12,0,0,0-24,0v32A12,12,0,0,0,32,156Zm40,40H44V184a12,12,0,0,0-24,0v16a20,20,0,0,0,20,20H72a12,12,0,0,0,0-24Zm72,0H112a12,12,0,0,0,0,24h32a12,12,0,0,0,0-24Zm80-24a12,12,0,0,0-12,12v12H184a12,12,0,0,0,0,24h32a20,20,0,0,0,20-20V184A12,12,0,0,0,224,172Zm0-72a12,12,0,0,0-12,12v32a12,12,0,0,0,24,0V112A12,12,0,0,0,224,100Zm-8-64H184a12,12,0,0,0,0,24h28V72a12,12,0,0,0,24,0V56A20,20,0,0,0,216,36Zm-72,0H112a12,12,0,0,0,0,24h32a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function gMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,108H48a12,12,0,0,0-12,12v88a12,12,0,0,0,12,12h88a12,12,0,0,0,12-12V120A12,12,0,0,0,136,108Zm-12,88H60V132h64Zm96-8v12a20,20,0,0,1-20,20H180a12,12,0,0,1,0-24h16v-8a12,12,0,0,1,24,0Zm0-72v24a12,12,0,0,1-24,0V116a12,12,0,0,1,24,0Zm0-60V72a12,12,0,0,1-24,0V60H184a12,12,0,0,1,0-24h16A20,20,0,0,1,220,56Zm-68-8a12,12,0,0,1-12,12H116a12,12,0,0,1,0-24h24A12,12,0,0,1,152,48ZM36,76V56A20,20,0,0,1,56,36H68a12,12,0,0,1,0,24H60V76a12,12,0,0,1-24,0Z"},child:[]}]})(e)}function qv(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M238.15,70.54,185.46,17.86a20,20,0,0,0-28.29,0L17.85,157.17a20,20,0,0,0,0,28.29l52.69,52.68a20,20,0,0,0,28.29,0L238.15,98.83A20,20,0,0,0,238.15,70.54ZM84.68,218.34l-47-47L64,145l23.52,23.52a12,12,0,0,0,17-17L81,128l15-15,23.51,23.52a12,12,0,0,0,17-17L113,96l15-15,23.52,23.52a12,12,0,0,0,17-17L145,64l26.35-26.34,47,47Z"},child:[]}]})(e)}function vMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M243.14,131.54l-32-80h0a12,12,0,0,0-13.73-7.25L140,57V40a12,12,0,0,0-24,0V62.37L53.4,76.29a12,12,0,0,0-8.54,7.25h0l0,0v0l-32,79.92A12,12,0,0,0,12,168c0,12.13,6.2,22.43,17.45,29A55,55,0,0,0,56,204a55,55,0,0,0,26.55-7C93.8,190.43,100,180.13,100,168a12,12,0,0,0-.86-4.46L72.38,96.65,116,87V204H104a12,12,0,0,0,0,24h48a12,12,0,0,0,0-24H140V81.63l40.42-9-23.56,58.9A12,12,0,0,0,156,136c0,12.13,6.2,22.43,17.45,29a53.78,53.78,0,0,0,53.1,0C237.8,158.43,244,148.13,244,136A12,12,0,0,0,243.14,131.54ZM56,180c-3.71,0-18-1.87-19.81-10.18L56,120.31l19.81,49.51C74,178.13,59.71,180,56,180Zm144-32c-3.71,0-18-1.87-19.81-10.18L200,88.31l19.81,49.51C218,146.13,203.71,148,200,148Z"},child:[]}]})(e)}function yMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,80H48a20,20,0,0,0-20,20V208a20,20,0,0,0,20,20H156a20,20,0,0,0,20-20V100A20,20,0,0,0,156,80Zm-4,124H52V104H152ZM132,40a12,12,0,0,1,12-12h16a12,12,0,0,1,0,24H144A12,12,0,0,1,132,40Zm96,8v8a12,12,0,0,1-24,0V52h-4a12,12,0,0,1,0-24h8A20,20,0,0,1,228,48Zm0,48v16a12,12,0,0,1-24,0V96a12,12,0,0,1,24,0Zm0,56v8a20,20,0,0,1-20,20h-8a12,12,0,0,1,0-24h4v-4a12,12,0,0,1,24,0ZM76,56V48A20,20,0,0,1,96,28h8a12,12,0,0,1,0,24h-4v4a12,12,0,0,1-24,0Z"},child:[]}]})(e)}function fX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,216a12,12,0,0,1-12,12H112a12,12,0,0,1,0-24h32A12,12,0,0,1,156,216ZM40,156a12,12,0,0,0,12-12V112a12,12,0,0,0-24,0v32A12,12,0,0,0,40,156Zm32,48H52V184a12,12,0,0,0-24,0v24a20,20,0,0,0,20,20H72a12,12,0,0,0,0-24ZM228,48V208a20,20,0,0,1-20,20H184a12,12,0,0,1,0-24h3L52,69v3a12,12,0,0,1-24,0V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48Zm-24,4H69L204,187Z"},child:[]}]})(e)}function bMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,103.52l-80-80A12,12,0,0,0,140,32V68.74c-25.76,3.12-53.66,15.89-76.75,35.47-29.16,24.74-47.32,56.69-51.14,90A16,16,0,0,0,39.67,207h0c10.46-11.14,47-45.74,100.33-50.42V192a12,12,0,0,0,20.48,8.48l80-80A12,12,0,0,0,240.49,103.52ZM164,163V144a12,12,0,0,0-12-12c-49,0-86.57,21.56-109.79,40.11,7.13-18.16,19.63-35.22,36.57-49.59C101.3,103.41,128.67,92,152,92a12,12,0,0,0,12-12V61l51,51Z"},child:[]}]})(e)}function xMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,36H48A20,20,0,0,0,28,56v56c0,54.29,26.32,87.22,48.4,105.29,23.71,19.39,47.44,26,48.44,26.29a12.1,12.1,0,0,0,6.32,0c1-.28,24.73-6.9,48.44-26.29,22.08-18.07,48.4-51,48.4-105.29V56A20,20,0,0,0,208,36Zm-4,76c0,35.71-13.09,64.69-38.91,86.15A126.28,126.28,0,0,1,128,219.38a126.14,126.14,0,0,1-37.09-21.23C65.09,176.69,52,147.71,52,112V60H204ZM79.51,144.49a12,12,0,1,1,17-17L112,143l47.51-47.52a12,12,0,0,1,17,17l-56,56a12,12,0,0,1-17,0Z"},child:[]}]})(e)}function CMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M243.16,68.85a17.4,17.4,0,0,0-15.26-12l-34.52-2.72L180.12,22.66a17.52,17.52,0,0,0-32.24,0L134.62,54.09l-34.51,2.72a17.39,17.39,0,0,0-9.93,30.62l26.17,22.1-8,33a17.46,17.46,0,0,0,26,19L164,143.66l29.59,17.81a17.46,17.46,0,0,0,26-19l-8-33,26.17-22.1A17.3,17.3,0,0,0,243.16,68.85ZM190.5,96a12,12,0,0,0-3.92,12l6,24.91-22.41-13.5a12.06,12.06,0,0,0-12.38,0l-22.41,13.5,6-24.91a12,12,0,0,0-3.93-12L118,79.48l25.83-2a12,12,0,0,0,10.11-7.3L164,46.2l10.11,23.94a12,12,0,0,0,10.11,7.3l25.82,2Zm-158,88.52a12,12,0,0,1-17-17l51.76-51.75a12,12,0,0,1,17,17Zm63.59-8.57a12,12,0,0,1,0,17l-47.59,47.6a12,12,0,0,1-17-17l47.6-47.59A12,12,0,0,1,96.08,175.92Zm62.44,9.56a12,12,0,0,1,0,17l-38,38a12,12,0,0,1-17-17l38-38A12,12,0,0,1,158.52,185.48Z"},child:[]}]})(e)}function Uh(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,175.51a12,12,0,0,1,0,17l-24,24a12,12,0,0,1-17-17L203,196h-2.09a76.17,76.17,0,0,1-61.85-31.83L97.38,105.78A52.1,52.1,0,0,0,55.06,84H32a12,12,0,0,1,0-24H55.06a76.17,76.17,0,0,1,61.85,31.83l41.71,58.39A52.1,52.1,0,0,0,200.94,172H203l-3.52-3.51a12,12,0,0,1,17-17Zm-95.62-72.62a12,12,0,0,0,16.93-1.13A52,52,0,0,1,200.94,84H203l-3.52,3.51a12,12,0,0,0,17,17l24-24a12,12,0,0,0,0-17l-24-24a12,12,0,0,0-17,17L203,60h-2.09a76,76,0,0,0-57.2,26A12,12,0,0,0,144.87,102.89Zm-33.74,50.22a12,12,0,0,0-16.93,1.13A52,52,0,0,1,55.06,172H32a12,12,0,0,0,0,24H55.06a76,76,0,0,0,57.2-26A12,12,0,0,0,111.13,153.11Z"},child:[]}]})(e)}function mX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M40,92H70.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24H137.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24Zm64-24A12,12,0,1,1,92,80,12,12,0,0,1,104,68Zm112,96H201.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24h94.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24Zm-48,24a12,12,0,1,1,12-12A12,12,0,0,1,168,188Z"},child:[]}]})(e)}function wMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,128a12,12,0,0,1-12,12H48a12,12,0,0,1,0-24h68A12,12,0,0,1,128,128ZM48,76H180a12,12,0,0,0,0-24H48a12,12,0,0,0,0,24Zm52,104H48a12,12,0,0,0,0,24h52a12,12,0,0,0,0-24Zm132.49-20.49a12,12,0,0,0-17,0L196,179V112a12,12,0,0,0-24,0v67l-19.51-19.52a12,12,0,0,0-17,17l40,40a12,12,0,0,0,17,0l40-40A12,12,0,0,0,232.49,159.51Z"},child:[]}]})(e)}function _Me(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M36,128a12,12,0,0,1,12-12h68a12,12,0,0,1,0,24H48A12,12,0,0,1,36,128ZM48,76h52a12,12,0,0,0,0-24H48a12,12,0,0,0,0,24ZM180,180H48a12,12,0,0,0,0,24H180a12,12,0,0,0,0-24ZM232.49,79.51l-40-40a12,12,0,0,0-17,0l-40,40a12,12,0,0,0,17,17L172,77v67a12,12,0,0,0,24,0V77l19.51,19.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function SMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M199,125.31l-49.88-18.39L130.69,57a19.92,19.92,0,0,0-37.38,0L74.92,106.92,25,125.31a19.92,19.92,0,0,0,0,37.38l49.88,18.39L93.31,231a19.92,19.92,0,0,0,37.38,0l18.39-49.88L199,162.69a19.92,19.92,0,0,0,0-37.38Zm-63.38,35.16a12,12,0,0,0-7.11,7.11L112,212.28l-16.47-44.7a12,12,0,0,0-7.11-7.11L43.72,144l44.7-16.47a12,12,0,0,0,7.11-7.11L112,75.72l16.47,44.7a12,12,0,0,0,7.11,7.11L180.28,144ZM140,40a12,12,0,0,1,12-12h12V16a12,12,0,0,1,24,0V28h12a12,12,0,0,1,0,24H188V64a12,12,0,0,1-24,0V52H152A12,12,0,0,1,140,40ZM252,88a12,12,0,0,1-12,12h-4v4a12,12,0,0,1-24,0v-4h-4a12,12,0,0,1,0-24h4V72a12,12,0,0,1,24,0v4h4A12,12,0,0,1,252,88Z"},child:[]}]})(e)}function kMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.36,170A12,12,0,0,1,230,186.37l-96,56a12,12,0,0,1-12.1,0l-96-56a12,12,0,0,1,12.09-20.74l90,52.48L218,165.63A12,12,0,0,1,234.36,170ZM218,117.63,128,170.11,38.05,117.63A12,12,0,0,0,26,138.37l96,56a12,12,0,0,0,12.1,0l96-56A12,12,0,0,0,218,117.63ZM20,80a12,12,0,0,1,6-10.37l96-56a12.06,12.06,0,0,1,12.1,0l96,56a12,12,0,0,1,0,20.74l-96,56a12,12,0,0,1-12.1,0l-96-56A12,12,0,0,1,20,80Zm35.82,0L128,122.11,200.18,80,128,37.89Z"},child:[]}]})(e)}function gX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10.05,110.42l112,64a12,12,0,0,0,11.9,0l112-64a12,12,0,0,0,0-20.84l-112-64a12,12,0,0,0-11.9,0l-112,64a12,12,0,0,0,0,20.84Zm118-60.6L215.81,100,128,150.18,40.19,100Zm122.42,92.23A12,12,0,0,1,246,158.42l-112,64a12,12,0,0,1-11.9,0l-112-64A12,12,0,1,1,22,137.58l106,60.6,106-60.6A12,12,0,0,1,250.42,142.05Z"},child:[]}]})(e)}function eS(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M243,96a20.33,20.33,0,0,0-17.74-14l-56.59-4.57L146.83,24.62a20.36,20.36,0,0,0-37.66,0L87.35,77.44,30.76,82A20.45,20.45,0,0,0,19.1,117.88l43.18,37.24-13.2,55.7A20.37,20.37,0,0,0,79.57,233L128,203.19,176.43,233a20.39,20.39,0,0,0,30.49-22.15l-13.2-55.7,43.18-37.24A20.43,20.43,0,0,0,243,96ZM172.53,141.7a12,12,0,0,0-3.84,11.86L181.58,208l-47.29-29.08a12,12,0,0,0-12.58,0L74.42,208l12.89-54.4a12,12,0,0,0-3.84-11.86L41.2,105.24l55.4-4.47a12,12,0,0,0,10.13-7.38L128,41.89l21.27,51.5a12,12,0,0,0,10.13,7.38l55.4,4.47Z"},child:[]}]})(e)}function Ua(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V152a20,20,0,0,1-20,20H112.92a12,12,0,0,1-17.41,16.49l-20-20a12,12,0,0,1,0-17l20-20A12,12,0,0,1,112.92,148H204V52H100a12,12,0,0,1-24,0V48A20,20,0,0,1,96,28H208A20,20,0,0,1,228,48ZM168,192a12,12,0,0,0-12,12H52V108h91.08a12,12,0,0,0,17.41,16.49l20-20a12,12,0,0,0,0-17l-20-20A12,12,0,0,0,143.08,84H48a20,20,0,0,0-20,20V208a20,20,0,0,0,20,20H160a20,20,0,0,0,20-20v-4A12,12,0,0,0,168,192Z"},child:[]}]})(e)}function K4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M90.86,50.89a12,12,0,0,0-21.72,0l-64,136a12,12,0,0,0,21.71,10.22L42.44,164h75.12l15.58,33.11a12,12,0,0,0,21.72-10.22ZM53.74,140,80,84.18,106.27,140ZM200,84c-13.85,0-24.77,3.86-32.45,11.48a12,12,0,1,0,16.9,17c3-3,8.26-4.52,15.55-4.52,11,0,20,7.18,20,16v4.39A47.28,47.28,0,0,0,200,124c-24.26,0-44,17.94-44,40s19.74,40,44,40a47.18,47.18,0,0,0,22-5.38A12,12,0,0,0,244,192V124C244,101.94,224.26,84,200,84Zm0,96c-11,0-20-7.18-20-16s9-16,20-16,20,7.18,20,16S211,180,200,180Z"},child:[]}]})(e)}function Qc(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H180V36A28,28,0,0,0,152,8H104A28,28,0,0,0,76,36V48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM100,36a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V48H100Zm88,168H68V72H188ZM116,104v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Zm48,0v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function Ea(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM188,204H68V72H188ZM76,20A12,12,0,0,1,88,8h80a12,12,0,0,1,0,24H88A12,12,0,0,1,76,20Z"},child:[]}]})(e)}function qo(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,184a16,16,0,1,1,16-16A16,16,0,0,1,188,184Zm36-68H180a12,12,0,0,0,0,24h40v56H36V140H76a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116ZM88.49,80.49,116,53v75a12,12,0,0,0,24,0V53l27.51,27.52a12,12,0,1,0,17-17l-48-48a12,12,0,0,0-17,0l-48,48a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function p1(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0ZM96.49,80.49,116,61v83a12,12,0,0,0,24,0V61l19.51,19.52a12,12,0,1,0,17-17l-40-40a12,12,0,0,0-17,0l-40,40a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function IMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M169.57,46.11a12,12,0,0,1,15.12-7.7L188,39.48V36a12,12,0,0,1,24,0v3.48l3.31-1.07a12,12,0,1,1,7.42,22.82l-3.31,1.08,2,2.82a12,12,0,1,1-19.41,14.1L200,76.42,198,79.23a12,12,0,1,1-19.41-14.1l2-2.82-3.31-1.08A12,12,0,0,1,169.57,46.11ZM236,128A108,108,0,1,1,128,20a109.19,109.19,0,0,1,18,1.49,12,12,0,0,1-4,23.67A85,85,0,0,0,128,44,83.94,83.94,0,0,0,62.05,179.94a83.48,83.48,0,0,1,29-23.42,52,52,0,1,1,74,0,83.48,83.48,0,0,1,29,23.42A83.57,83.57,0,0,0,212,128a85.2,85.2,0,0,0-1.16-14,12,12,0,0,1,23.67-4A109,109,0,0,1,236,128ZM128,148a28,28,0,1,0-28-28A28,28,0,0,0,128,148Zm0,64a83.53,83.53,0,0,0,48.43-15.43,60,60,0,0,0-96.86,0A83.53,83.53,0,0,0,128,212Z"},child:[]}]})(e)}function jm(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.26,186.1,152.81,34.23h0a28.74,28.74,0,0,0-49.62,0L15.74,186.1a27.45,27.45,0,0,0,0,27.71A28.31,28.31,0,0,0,40.55,228h174.9a28.31,28.31,0,0,0,24.79-14.19A27.45,27.45,0,0,0,240.26,186.1Zm-20.8,15.7a4.46,4.46,0,0,1-4,2.2H40.55a4.46,4.46,0,0,1-4-2.2,3.56,3.56,0,0,1,0-3.73L124,46.2a4.77,4.77,0,0,1,8,0l87.44,151.87A3.56,3.56,0,0,1,219.46,201.8ZM116,136V104a12,12,0,0,1,24,0v32a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,176Z"},child:[]}]})(e)}function jMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-12-80V80a12,12,0,0,1,24,0v52a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,172Z"},child:[]}]})(e)}function fn(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,191.51a12,12,0,0,1-17,17L128,145,64.49,208.49a12,12,0,0,1-17-17L111,128,47.51,64.49a12,12,0,0,1,17-17L128,111l63.51-63.52a12,12,0,0,1,17,17L145,128Z"},child:[]}]})(e)}function EMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M176,80v96H80V80Z",opacity:"0.2"},child:[]},{tag:"path",attr:{d:"M104,40a8,8,0,0,1,8-8h32a8,8,0,0,1,0,16H112A8,8,0,0,1,104,40Zm40,168H112a8,8,0,0,0,0,16h32a8,8,0,0,0,0-16ZM208,32H184a8,8,0,0,0,0,16h24V72a8,8,0,0,0,16,0V48A16,16,0,0,0,208,32Zm8,72a8,8,0,0,0-8,8v32a8,8,0,0,0,16,0V112A8,8,0,0,0,216,104Zm0,72a8,8,0,0,0-8,8v24H184a8,8,0,0,0,0,16h24a16,16,0,0,0,16-16V184A8,8,0,0,0,216,176ZM40,152a8,8,0,0,0,8-8V112a8,8,0,0,0-16,0v32A8,8,0,0,0,40,152Zm32,56H48V184a8,8,0,0,0-16,0v24a16,16,0,0,0,16,16H72a8,8,0,0,0,0-16ZM40,80a8,8,0,0,0,8-8V48H72a8,8,0,0,0,0-16H48A16,16,0,0,0,32,48V72A8,8,0,0,0,40,80ZM176,184H80a8,8,0,0,1-8-8V80a8,8,0,0,1,8-8h96a8,8,0,0,1,8,8v96A8,8,0,0,1,176,184Zm-8-96H88v80h80Z"},child:[]}]})(e)}function AMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,48H32A16,16,0,0,0,16,64V88a16,16,0,0,0,16,16v88a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V104a16,16,0,0,0,16-16V64A16,16,0,0,0,224,48Zm-72,96H104a8,8,0,0,1,0-16h48a8,8,0,0,1,0,16Zm72-56H32V64H224V88Z"},child:[]}]})(e)}function PMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,32H72A16,16,0,0,0,56,48V224a8,8,0,0,0,12.24,6.78L128,193.43l59.77,37.35A8,8,0,0,0,200,224V48A16,16,0,0,0,184,32Z"},child:[]}]})(e)}function vX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,128A104,104,0,1,1,128,24,104.13,104.13,0,0,1,232,128Z"},child:[]}]})(e)}function TMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM92.8,145.6a8,8,0,1,1-9.6,12.8l-32-24a8,8,0,0,1,0-12.8l32-24a8,8,0,0,1,9.6,12.8L69.33,128Zm58.89-71.4-32,112a8,8,0,1,1-15.38-4.4l32-112a8,8,0,0,1,15.38,4.4Zm53.11,60.2-32,24a8,8,0,0,1-9.6-12.8L186.67,128,163.2,110.4a8,8,0,1,1,9.6-12.8l32,24a8,8,0,0,1,0,12.8Z"},child:[]}]})(e)}function yX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32Zm-8,128H176V88a8,8,0,0,0-8-8H96V48H208Z"},child:[]}]})(e)}function DMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128Z"},child:[]}]})(e)}function Z4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM48,100a28,28,0,1,0,28,28A28,28,0,0,0,48,100Zm160,0a28,28,0,1,0,28,28A28,28,0,0,0,208,100Z"},child:[]}]})(e)}function MMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM128,76a28,28,0,1,0-28-28A28,28,0,0,0,128,76Zm0,104a28,28,0,1,0,28,28A28,28,0,0,0,128,180Z"},child:[]}]})(e)}function LMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M247.31,124.76c-.35-.79-8.82-19.58-27.65-38.41C194.57,61.26,162.88,48,128,48S61.43,61.26,36.34,86.35C17.51,105.18,9,124,8.69,124.76a8,8,0,0,0,0,6.5c.35.79,8.82,19.57,27.65,38.4C61.43,194.74,93.12,208,128,208s66.57-13.26,91.66-38.34c18.83-18.83,27.3-37.61,27.65-38.4A8,8,0,0,0,247.31,124.76ZM128,168a40,40,0,1,1,40-40A40,40,0,0,1,128,168Z"},child:[]}]})(e)}function bX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64,123.2,86.4A8,8,0,0,0,128,88h72v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Z"},child:[]}]})(e)}function f1(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.94,107.21a8,8,0,0,0-3.89-5.4l-29.83-17-.12-33.62a8,8,0,0,0-2.83-6.08,111.91,111.91,0,0,0-36.72-20.67,8,8,0,0,0-6.46.59L128,41.85,97.88,25a8,8,0,0,0-6.47-.6A111.92,111.92,0,0,0,54.73,45.15a8,8,0,0,0-2.83,6.07l-.15,33.65-29.83,17a8,8,0,0,0-3.89,5.4,106.47,106.47,0,0,0,0,41.56,8,8,0,0,0,3.89,5.4l29.83,17,.12,33.63a8,8,0,0,0,2.83,6.08,111.91,111.91,0,0,0,36.72,20.67,8,8,0,0,0,6.46-.59L128,214.15,158.12,231a7.91,7.91,0,0,0,3.9,1,8.09,8.09,0,0,0,2.57-.42,112.1,112.1,0,0,0,36.68-20.73,8,8,0,0,0,2.83-6.07l.15-33.65,29.83-17a8,8,0,0,0,3.89-5.4A106.47,106.47,0,0,0,237.94,107.21ZM128,168a40,40,0,1,1,40-40A40,40,0,0,1,128,168Z"},child:[]}]})(e)}function tS(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M213.85,125.46l-112,120a8,8,0,0,1-13.69-7l14.66-73.33L45.19,143.49a8,8,0,0,1-3-13l112-120a8,8,0,0,1,13.69,7L153.18,90.9l57.63,21.61a8,8,0,0,1,3,12.95Z"},child:[]}]})(e)}function X4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96Z"},child:[]}]})(e)}function xX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48V208a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h40A16,16,0,0,1,216,48ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Z"},child:[]}]})(e)}function RMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM51.31,160l90.35-90.35,16.68,16.69L68,176.68ZM48,179.31,76.69,208H48Zm48,25.38L79.31,188l90.35-90.35h0l16.68,16.69Z"},child:[]}]})(e)}function OMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM192,108.68,147.31,64l24-24L216,84.68Z"},child:[]}]})(e)}function CX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"},child:[]}]})(e)}function NMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM80,192H64a16,16,0,0,1-16-16V144a8,8,0,0,1,16,0v32H80a8,8,0,0,1,0,16ZM80,80H64v32a8,8,0,0,1-16,0V80A16,16,0,0,1,64,64H80a8,8,0,0,1,0,16Zm64,112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm0-112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm64,96a16,16,0,0,1-16,16H176a8,8,0,0,1,0-16h16V144a8,8,0,0,1,16,0Zm0-64a8,8,0,0,1-16,0V80H176a8,8,0,0,1,0-16h16a16,16,0,0,1,16,16Z"},child:[]}]})(e)}function wX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M111.59,181.47A8,8,0,0,1,104,192H24a8,8,0,0,1-7.59-10.53l40-120a8,8,0,0,1,15.18,0ZM208,76a52,52,0,1,0-52,52A52.06,52.06,0,0,0,208,76Zm16,68H136a8,8,0,0,0-8,8v56a8,8,0,0,0,8,8h88a8,8,0,0,0,8-8V152A8,8,0,0,0,224,144Z"},child:[]}]})(e)}function nS(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M235.24,84.38l-28.06,23.68,8.56,35.39a13.34,13.34,0,0,1-5.09,13.91,13.54,13.54,0,0,1-15,.69L164,139l-31.65,19.06a13.51,13.51,0,0,1-15-.69,13.32,13.32,0,0,1-5.1-13.91l8.56-35.39L92.76,84.38a13.39,13.39,0,0,1,7.66-23.58l36.94-2.92,14.21-33.66a13.51,13.51,0,0,1,24.86,0l14.21,33.66,36.94,2.92a13.39,13.39,0,0,1,7.66,23.58ZM88.11,111.89a8,8,0,0,0-11.32,0L18.34,170.34a8,8,0,0,0,11.32,11.32l58.45-58.45A8,8,0,0,0,88.11,111.89Zm-.5,61.19L34.34,226.34a8,8,0,0,0,11.32,11.32l53.26-53.27a8,8,0,0,0-11.31-11.31Zm73-1-54.29,54.28a8,8,0,0,0,11.32,11.32l54.28-54.28a8,8,0,0,0-11.31-11.32Z"},child:[]}]})(e)}function Em(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,144a15.78,15.78,0,0,1-10.42,14.94L146,178l-19,51.62a15.92,15.92,0,0,1-29.88,0L78,178l-51.62-19a15.92,15.92,0,0,1,0-29.88L78,110l19-51.62a15.92,15.92,0,0,1,29.88,0L146,110l51.62,19A15.78,15.78,0,0,1,208,144ZM152,48h16V64a8,8,0,0,0,16,0V48h16a8,8,0,0,0,0-16H184V16a8,8,0,0,0-16,0V32H152a8,8,0,0,0,0,16Zm88,32h-8V72a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16h8v8a8,8,0,0,0,16,0V96h8a8,8,0,0,0,0-16Z"},child:[]}]})(e)}function FMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M120,56v48a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V56A16,16,0,0,1,56,40h48A16,16,0,0,1,120,56Zm80-16H152a16,16,0,0,0-16,16v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V56A16,16,0,0,0,200,40Zm-96,96H56a16,16,0,0,0-16,16v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V152A16,16,0,0,0,104,136Zm96,0H152a16,16,0,0,0-16,16v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V152A16,16,0,0,0,200,136Z"},child:[]}]})(e)}function sS(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,114.85l-45,38.83L203,211.75a16.4,16.4,0,0,1-24.5,17.82L128,198.49,77.47,229.57A16.4,16.4,0,0,1,53,211.75l13.76-58.07-45-38.83A16.46,16.46,0,0,1,31.08,86l59-4.76,22.76-55.08a16.36,16.36,0,0,1,30.27,0l22.75,55.08,59,4.76a16.46,16.46,0,0,1,9.37,28.86Z"},child:[]}]})(e)}function BMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M176,56H80a72,72,0,0,0,0,144h96a72,72,0,0,0,0-144Zm0,112a40,40,0,1,1,40-40A40,40,0,0,1,176,168Z"},child:[]}]})(e)}function Y4(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,56a8,8,0,0,1-8,8h-8V208a16,16,0,0,1-16,16H64a16,16,0,0,1-16-16V64H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,56ZM88,32h80a8,8,0,0,0,0-16H88a8,8,0,0,0,0,16Z"},child:[]}]})(e)}function zMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M74.34,77.66a8,8,0,0,1,0-11.32l48-48a8,8,0,0,1,11.32,0l48,48a8,8,0,0,1-11.32,11.32L136,43.31V128a8,8,0,0,1-16,0V43.31L85.66,77.66A8,8,0,0,1,74.34,77.66ZM240,136v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V136a16,16,0,0,1,16-16h68a4,4,0,0,1,4,4v3.46c0,13.45,11,24.79,24.46,24.54A24,24,0,0,0,152,128v-4a4,4,0,0,1,4-4h68A16,16,0,0,1,240,136Zm-40,32a12,12,0,1,0-12,12A12,12,0,0,0,200,168Z"},child:[]}]})(e)}function _X(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,96a72,72,0,0,1-100.94,66L79,222.22c-.12.14-.26.29-.39.42a32,32,0,0,1-45.26-45.26c.14-.13.28-.27.43-.39L94,124.94a72.07,72.07,0,0,1,83.54-98.78,8,8,0,0,1,3.93,13.19L144,80l5.66,26.35L176,112l40.65-37.52a8,8,0,0,1,13.19,3.93A72.6,72.6,0,0,1,232,96Z"},child:[]}]})(e)}function VMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.33,69.52a24,24,0,0,0-14.49-16.4C185.56,39.88,131,40,128,40s-57.56-.12-91.84,13.12a24,24,0,0,0-14.49,16.4C19.08,79.5,16,97.74,16,128s3.08,48.5,5.67,58.48a24,24,0,0,0,14.49,16.41C69,215.56,120.4,216,127.34,216h1.32c6.94,0,58.37-.44,91.18-13.11a24,24,0,0,0,14.49-16.41c2.59-10,5.67-28.22,5.67-58.48S236.92,79.5,234.33,69.52Zm-73.74,65-40,28A8,8,0,0,1,108,156V100a8,8,0,0,1,12.59-6.55l40,28a8,8,0,0,1,0,13.1Z"},child:[]}]})(e)}function $Me(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,80v43.47l36.12,21.67a8,8,0,0,1-8.24,13.72l-40-24A8,8,0,0,1,120,128V80a8,8,0,0,1,16,0Zm-8-48A95.44,95.44,0,0,0,60.08,60.15C52.81,67.51,46.35,74.59,40,82V64a8,8,0,0,0-16,0v40a8,8,0,0,0,8,8H72a8,8,0,0,0,0-16H49c7.15-8.42,14.27-16.35,22.39-24.57a80,80,0,1,1,1.66,114.75,8,8,0,1,0-11,11.64A96,96,0,1,0,128,32Z"},child:[]}]})(e)}function wN(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M104,60A12,12,0,1,1,92,48,12,12,0,0,1,104,60Zm60,12a12,12,0,1,0-12-12A12,12,0,0,0,164,72ZM92,116a12,12,0,1,0,12,12A12,12,0,0,0,92,116Zm72,0a12,12,0,1,0,12,12A12,12,0,0,0,164,116ZM92,184a12,12,0,1,0,12,12A12,12,0,0,0,92,184Zm72,0a12,12,0,1,0,12,12A12,12,0,0,0,164,184Z"},child:[]}]})(e)}function _N(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M72,92A12,12,0,1,1,60,80,12,12,0,0,1,72,92Zm56-12a12,12,0,1,0,12,12A12,12,0,0,0,128,80Zm68,24a12,12,0,1,0-12-12A12,12,0,0,0,196,104ZM60,152a12,12,0,1,0,12,12A12,12,0,0,0,60,152Zm68,0a12,12,0,1,0,12,12A12,12,0,0,0,128,152Zm68,0a12,12,0,1,0,12,12A12,12,0,0,0,196,152Z"},child:[]}]})(e)}function GMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM48,48H208v77.38l-24.69-24.7a16,16,0,0,0-22.62,0L53.37,208H48ZM208,208H76l96-96,36,36v60ZM96,120A24,24,0,1,0,72,96,24,24,0,0,0,96,120Zm0-32a8,8,0,1,1-8,8A8,8,0,0,1,96,88Z"},child:[]}]})(e)}function rC(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,16V158.75l-26.07-26.06a16,16,0,0,0-22.63,0l-20,20-44-44a16,16,0,0,0-22.62,0L40,149.37V56ZM40,172l52-52,80,80H40Zm176,28H194.63l-36-36,20-20L216,181.38V200ZM144,100a12,12,0,1,1,12,12A12,12,0,0,1,144,100Z"},child:[]}]})(e)}function SX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M165.66,90.34a8,8,0,0,1,0,11.32l-64,64a8,8,0,0,1-11.32-11.32l64-64A8,8,0,0,1,165.66,90.34ZM215.6,40.4a56,56,0,0,0-79.2,0L106.34,70.45a8,8,0,0,0,11.32,11.32l30.06-30a40,40,0,0,1,56.57,56.56l-30.07,30.06a8,8,0,0,0,11.31,11.32L215.6,119.6a56,56,0,0,0,0-79.2ZM138.34,174.22l-30.06,30.06a40,40,0,1,1-56.56-56.57l30.05-30.05a8,8,0,0,0-11.32-11.32L40.4,136.4a56,56,0,0,0,79.2,79.2l30.06-30.07a8,8,0,0,0-11.32-11.31Z"},child:[]}]})(e)}function HMe(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}function kX(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,32V64a8,8,0,0,1-16,0V32a8,8,0,0,1,16,0Zm37.25,58.75a8,8,0,0,0,5.66-2.35l22.63-22.62a8,8,0,0,0-11.32-11.32L167.6,77.09a8,8,0,0,0,5.65,13.66ZM224,120H192a8,8,0,0,0,0,16h32a8,8,0,0,0,0-16Zm-45.09,47.6a8,8,0,0,0-11.31,11.31l22.62,22.63a8,8,0,0,0,11.32-11.32ZM128,184a8,8,0,0,0-8,8v32a8,8,0,0,0,16,0V192A8,8,0,0,0,128,184ZM77.09,167.6,54.46,190.22a8,8,0,0,0,11.32,11.32L88.4,178.91A8,8,0,0,0,77.09,167.6ZM72,128a8,8,0,0,0-8-8H32a8,8,0,0,0,0,16H64A8,8,0,0,0,72,128ZM65.78,54.46A8,8,0,0,0,54.46,65.78L77.09,88.4A8,8,0,0,0,88.4,77.09Z"},child:[]}]})(e)}function iS(e){return fe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}const WMe=h.memo(e=>e.image?a.jsx(iM,{w:`${e.image.width}px`,h:"auto",objectFit:"contain",aspectRatio:`${e.image.width}/${e.image.height}`}):a.jsx(A,{opacity:.7,w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",bg:"base.900",children:a.jsx(ao,{size:"xl"})}));WMe.displayName="IAILoadingImageFallback";const On=h.memo(e=>{const{icon:t=xh,boxSize:n=16,...s}=e;return a.jsxs(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",fontSize:"md",...s,children:[t&&a.jsx(Je,{as:t,boxSize:n,opacity:.7}),e.label&&a.jsx(q,{textAlign:"center",children:e.label})]})});On.displayName="IAINoContentFallback";const m1=h.memo(e=>{const{sx:t,...n}=e,s=h.useMemo(()=>({w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",...t}),[t]);return a.jsxs(A,{sx:s,...n,children:[a.jsx(ao,{size:"xl"}),e.label&&a.jsx(q,{textAlign:"center",children:e.label})]})});m1.displayName="IAINoContentFallbackWithSpinner";const IX=h.memo(e=>a.jsx(Je,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",...e,children:a.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})}));IX.displayName="InvokeLogoIcon";const jX=Symbol("LOADING"),UMe=()=>{const{data:e,isLoading:t}=Oh({include_archived:!0}),{data:n,isLoading:s}=Nye({board_id:"none",offset:0,limit:0,is_intermediate:!1});return h.useMemo(()=>t||s?jX:e&&e.length>0&&e.filter(r=>r.image_count>0).length>0?!0:n?n.total>0:!0,[e,n,t,s])},EX=h.memo(()=>{const e=UMe(),[t,{data:n}]=Xw(),{t:s}=T(),i=h.useMemo(()=>n&&t.length===0,[t.length,n]);return e===jX?a.jsx(qMe,{}):e?a.jsx(On,{icon:xh,label:s("gallery.noImageSelected")}):a.jsxs(A,{flexDir:"column",gap:8,alignItems:"center",textAlign:"center",maxW:"400px",children:[a.jsx(IX,{w:32,h:32}),a.jsxs(A,{flexDir:"column",gap:4,alignItems:"center",textAlign:"center",children:[a.jsx(ZMe,{}),i&&a.jsx(XMe,{}),a.jsx(vt,{}),a.jsx(YMe,{})]})]})});EX.displayName="NoContentForViewer";const qMe=()=>a.jsx(A,{position:"relative",width:"full",height:"full",alignItems:"center",justifyContent:"center",children:a.jsx(ao,{label:"Loading",color:"grey",position:"absolute",size:"sm",width:8,height:8,right:4,bottom:4})}),AX=e=>a.jsx(he,{as:aM,variant:"unstyled",isExternal:!0,display:"inline-flex",alignItems:"center",rightIcon:a.jsx(Z_,{}),color:"base.50",mt:-1,...e}),SN=e=>a.jsx(he,{variant:"link",size:"md",onClick:e.onClick,color:"base.50",children:e.children}),KMe=a.jsx(q,{as:"span",color:"base.50",fontSize:"md"}),ZMe=()=>a.jsx(q,{fontSize:"md",color:"base.200",children:a.jsx(Bn,{i18nKey:"newUserExperience.toGetStartedLocal",components:{StrongComponent:KMe}})}),XMe=()=>{const e=h.useCallback(()=>{Ne.switchToTab("models"),El("starterModels")},[]),t=h.useCallback(()=>{Ne.switchToTab("models"),El("urlOrLocal")},[]);return a.jsx(q,{fontSize:"md",color:"base.200",children:a.jsx(Bn,{i18nKey:"newUserExperience.noModelsInstalled",components:{DownloadStarterModelsButton:a.jsx(SN,{onClick:e}),ImportModelsButton:a.jsx(SN,{onClick:t})}})})},YMe=()=>a.jsxs(hu,{status:"warning",borderRadius:"base",fontSize:"md",shadow:"md",w:"fit-content",children:[a.jsx(Nh,{}),a.jsx(oM,{children:a.jsx(Bn,{i18nKey:"newUserExperience.lowVRAMMode",components:{LinkComponent:a.jsx(AX,{href:"https://invoke-ai.github.io/InvokeAI/features/low-vram/"})}})})]}),QMe=e=>e==="OutOfMemoryError"?ye("toast.outOfMemoryError"):ye("toast.serverError");function JMe({errorType:e,errorMessage:t}){const n=h.useMemo(()=>{if(e==="OutOfMemoryError")return a.jsx(Bn,{i18nKey:"toast.outOfMemoryErrorDescLocal",components:{LinkComponent:a.jsx(AX,{href:"https://invoke-ai.github.io/InvokeAI/features/low-vram/"})}});if(t)return`${e}: ${t}`},[t,e]);return a.jsx(A,{flexDir:"column",children:a.jsx(q,{noOfLines:4,fontSize:"md",children:n})})}const up=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,PX=new Set,LP=typeof process=="object"&&process?process:{},TX=(e,t,n,s)=>{typeof LP.emitWarning=="function"?LP.emitWarning(e,t,n,s):console.error(`[${n}] ${t}: ${e}`)};let lC=globalThis.AbortController,kN=globalThis.AbortSignal;if(typeof lC>"u"){kN=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(s,i){this._onabort.push(i)}},lC=class{constructor(){t()}signal=new kN;abort(s){if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const i of this.signal._onabort)i(s);this.signal.onabort?.(s)}}};let e=LP.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const t=()=>{e&&(e=!1,TX("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const e4e=e=>!PX.has(e),md=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),DX=e=>md(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?u2:null:null;class u2 extends Array{constructor(t){super(t),this.fill(0)}}class Yp{heap;length;static#l=!1;static create(t){const n=DX(t);if(!n)return[];Yp.#l=!0;const s=new Yp(t,n);return Yp.#l=!1,s}constructor(t,n){if(!Yp.#l)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}}class jc{#l;#u;#m;#j;#g;#T;#D;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#i;#v;#s;#n;#e;#c;#h;#r;#o;#y;#a;#b;#x;#p;#C;#I;#d;#M;static unsafeExposeInternals(t){return{starts:t.#x,ttls:t.#p,sizes:t.#b,keyMap:t.#s,keyList:t.#n,valList:t.#e,next:t.#c,prev:t.#h,get head(){return t.#r},get tail(){return t.#o},free:t.#y,isBackgroundFetch:n=>t.#t(n),backgroundFetch:(n,s,i,o)=>t.#O(n,s,i,o),moveToTail:n=>t.#P(n),indexes:n=>t.#w(n),rindexes:n=>t.#_(n),isStale:n=>t.#f(n)}}get max(){return this.#l}get maxSize(){return this.#u}get calculatedSize(){return this.#v}get size(){return this.#i}get fetchMethod(){return this.#T}get memoMethod(){return this.#D}get dispose(){return this.#m}get onInsert(){return this.#j}get disposeAfter(){return this.#g}constructor(t){const{max:n=0,ttl:s,ttlResolution:i=1,ttlAutopurge:o,updateAgeOnGet:r,updateAgeOnHas:l,allowStale:c,dispose:d,onInsert:u,disposeAfter:p,noDisposeOnSet:m,noUpdateTTL:f,maxSize:g=0,maxEntrySize:v=0,sizeCalculation:b,fetchMethod:C,memoMethod:y,noDeleteOnFetchRejection:x,noDeleteOnStaleGet:w,allowStaleOnFetchRejection:_,allowStaleOnFetchAbort:S,ignoreFetchAbort:I}=t;if(n!==0&&!md(n))throw new TypeError("max option must be a nonnegative integer");const k=n?DX(n):Array;if(!k)throw new Error("invalid max value: "+n);if(this.#l=n,this.#u=g,this.maxEntrySize=v||this.#u,this.sizeCalculation=b,this.sizeCalculation){if(!this.#u&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(y!==void 0&&typeof y!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#D=y,C!==void 0&&typeof C!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#T=C,this.#I=!!C,this.#s=new Map,this.#n=new Array(n).fill(void 0),this.#e=new Array(n).fill(void 0),this.#c=new k(n),this.#h=new k(n),this.#r=0,this.#o=0,this.#y=Yp.create(n),this.#i=0,this.#v=0,typeof d=="function"&&(this.#m=d),typeof u=="function"&&(this.#j=u),typeof p=="function"?(this.#g=p,this.#a=[]):(this.#g=void 0,this.#a=void 0),this.#C=!!this.#m,this.#M=!!this.#j,this.#d=!!this.#g,this.noDisposeOnSet=!!m,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!x,this.allowStaleOnFetchRejection=!!_,this.allowStaleOnFetchAbort=!!S,this.ignoreFetchAbort=!!I,this.maxEntrySize!==0){if(this.#u!==0&&!md(this.#u))throw new TypeError("maxSize must be a positive integer if specified");if(!md(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#G()}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!w,this.updateAgeOnGet=!!r,this.updateAgeOnHas=!!l,this.ttlResolution=md(i)||i===0?i:1,this.ttlAutopurge=!!o,this.ttl=s||0,this.ttl){if(!md(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#N()}if(this.#l===0&&this.ttl===0&&this.#u===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#u){const E="LRU_CACHE_UNBOUNDED";e4e(E)&&(PX.add(E),TX("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",E,jc))}}getRemainingTTL(t){return this.#s.has(t)?1/0:0}#N(){const t=new u2(this.#l),n=new u2(this.#l);this.#p=t,this.#x=n,this.#F=(o,r,l=up.now())=>{if(n[o]=r!==0?l:0,t[o]=r,r!==0&&this.ttlAutopurge){const c=setTimeout(()=>{this.#f(o)&&this.#S(this.#n[o],"expire")},r+1);c.unref&&c.unref()}},this.#E=o=>{n[o]=t[o]!==0?up.now():0},this.#k=(o,r)=>{if(t[r]){const l=t[r],c=n[r];if(!l||!c)return;o.ttl=l,o.start=c,o.now=s||i();const d=o.now-c;o.remainingTTL=l-d}};let s=0;const i=()=>{const o=up.now();if(this.ttlResolution>0){s=o;const r=setTimeout(()=>s=0,this.ttlResolution);r.unref&&r.unref()}return o};this.getRemainingTTL=o=>{const r=this.#s.get(o);if(r===void 0)return 0;const l=t[r],c=n[r];if(!l||!c)return 1/0;const d=(s||i())-c;return l-d},this.#f=o=>{const r=n[o],l=t[o];return!!l&&!!r&&(s||i())-r>l}}#E=()=>{};#k=()=>{};#F=()=>{};#f=()=>!1;#G(){const t=new u2(this.#l);this.#v=0,this.#b=t,this.#A=n=>{this.#v-=t[n],t[n]=0},this.#B=(n,s,i,o)=>{if(this.#t(s))return 0;if(!md(i))if(o){if(typeof o!="function")throw new TypeError("sizeCalculation must be a function");if(i=o(s,n),!md(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return i},this.#L=(n,s,i)=>{if(t[n]=s,this.#u){const o=this.#u-t[n];for(;this.#v>o;)this.#R(!0)}this.#v+=t[n],i&&(i.entrySize=s,i.totalCalculatedSize=this.#v)}}#A=t=>{};#L=(t,n,s)=>{};#B=(t,n,s,i)=>{if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#w({allowStale:t=this.allowStale}={}){if(this.#i)for(let n=this.#o;!(!this.#z(n)||((t||!this.#f(n))&&(yield n),n===this.#r));)n=this.#h[n]}*#_({allowStale:t=this.allowStale}={}){if(this.#i)for(let n=this.#r;!(!this.#z(n)||((t||!this.#f(n))&&(yield n),n===this.#o));)n=this.#c[n]}#z(t){return t!==void 0&&this.#s.get(this.#n[t])===t}*entries(){for(const t of this.#w())this.#e[t]!==void 0&&this.#n[t]!==void 0&&!this.#t(this.#e[t])&&(yield[this.#n[t],this.#e[t]])}*rentries(){for(const t of this.#_())this.#e[t]!==void 0&&this.#n[t]!==void 0&&!this.#t(this.#e[t])&&(yield[this.#n[t],this.#e[t]])}*keys(){for(const t of this.#w()){const n=this.#n[t];n!==void 0&&!this.#t(this.#e[t])&&(yield n)}}*rkeys(){for(const t of this.#_()){const n=this.#n[t];n!==void 0&&!this.#t(this.#e[t])&&(yield n)}}*values(){for(const t of this.#w())this.#e[t]!==void 0&&!this.#t(this.#e[t])&&(yield this.#e[t])}*rvalues(){for(const t of this.#_())this.#e[t]!==void 0&&!this.#t(this.#e[t])&&(yield this.#e[t])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,n={}){for(const s of this.#w()){const i=this.#e[s],o=this.#t(i)?i.__staleWhileFetching:i;if(o!==void 0&&t(o,this.#n[s],this))return this.get(this.#n[s],n)}}forEach(t,n=this){for(const s of this.#w()){const i=this.#e[s],o=this.#t(i)?i.__staleWhileFetching:i;o!==void 0&&t.call(n,o,this.#n[s],this)}}rforEach(t,n=this){for(const s of this.#_()){const i=this.#e[s],o=this.#t(i)?i.__staleWhileFetching:i;o!==void 0&&t.call(n,o,this.#n[s],this)}}purgeStale(){let t=!1;for(const n of this.#_({allowStale:!0}))this.#f(n)&&(this.#S(this.#n[n],"expire"),t=!0);return t}info(t){const n=this.#s.get(t);if(n===void 0)return;const s=this.#e[n],i=this.#t(s)?s.__staleWhileFetching:s;if(i===void 0)return;const o={value:i};if(this.#p&&this.#x){const r=this.#p[n],l=this.#x[n];if(r&&l){const c=r-(up.now()-l);o.ttl=c,o.start=Date.now()}}return this.#b&&(o.size=this.#b[n]),o}dump(){const t=[];for(const n of this.#w({allowStale:!0})){const s=this.#n[n],i=this.#e[n],o=this.#t(i)?i.__staleWhileFetching:i;if(o===void 0||s===void 0)continue;const r={value:o};if(this.#p&&this.#x){r.ttl=this.#p[n];const l=up.now()-this.#x[n];r.start=Math.floor(Date.now()-l)}this.#b&&(r.size=this.#b[n]),t.unshift([s,r])}return t}load(t){this.clear();for(const[n,s]of t){if(s.start){const i=Date.now()-s.start;s.start=up.now()-i}this.set(n,s.value,s)}}set(t,n,s={}){if(n===void 0)return this.delete(t),this;const{ttl:i=this.ttl,start:o,noDisposeOnSet:r=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:c}=s;let{noUpdateTTL:d=this.noUpdateTTL}=s;const u=this.#B(t,n,s.size||0,l);if(this.maxEntrySize&&u>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.#S(t,"set"),this;let p=this.#i===0?void 0:this.#s.get(t);if(p===void 0)p=this.#i===0?this.#o:this.#y.length!==0?this.#y.pop():this.#i===this.#l?this.#R(!1):this.#i,this.#n[p]=t,this.#e[p]=n,this.#s.set(t,p),this.#c[this.#o]=p,this.#h[p]=this.#o,this.#o=p,this.#i++,this.#L(p,u,c),c&&(c.set="add"),d=!1,this.#M&&this.#j?.(n,t,"add");else{this.#P(p);const m=this.#e[p];if(n!==m){if(this.#I&&this.#t(m)){m.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:f}=m;f!==void 0&&!r&&(this.#C&&this.#m?.(f,t,"set"),this.#d&&this.#a?.push([f,t,"set"]))}else r||(this.#C&&this.#m?.(m,t,"set"),this.#d&&this.#a?.push([m,t,"set"]));if(this.#A(p),this.#L(p,u,c),this.#e[p]=n,c){c.set="replace";const f=m&&this.#t(m)?m.__staleWhileFetching:m;f!==void 0&&(c.oldValue=f)}}else c&&(c.set="update");this.#M&&this.onInsert?.(n,t,n===m?"update":"replace")}if(i!==0&&!this.#p&&this.#N(),this.#p&&(d||this.#F(p,i,o),c&&this.#k(c,p)),!r&&this.#d&&this.#a){const m=this.#a;let f;for(;f=m?.shift();)this.#g?.(...f)}return this}pop(){try{for(;this.#i;){const t=this.#e[this.#r];if(this.#R(!0),this.#t(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(t!==void 0)return t}}finally{if(this.#d&&this.#a){const t=this.#a;let n;for(;n=t?.shift();)this.#g?.(...n)}}}#R(t){const n=this.#r,s=this.#n[n],i=this.#e[n];return this.#I&&this.#t(i)?i.__abortController.abort(new Error("evicted")):(this.#C||this.#d)&&(this.#C&&this.#m?.(i,s,"evict"),this.#d&&this.#a?.push([i,s,"evict"])),this.#A(n),t&&(this.#n[n]=void 0,this.#e[n]=void 0,this.#y.push(n)),this.#i===1?(this.#r=this.#o=0,this.#y.length=0):this.#r=this.#c[n],this.#s.delete(s),this.#i--,n}has(t,n={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=n,o=this.#s.get(t);if(o!==void 0){const r=this.#e[o];if(this.#t(r)&&r.__staleWhileFetching===void 0)return!1;if(this.#f(o))i&&(i.has="stale",this.#k(i,o));else return s&&this.#E(o),i&&(i.has="hit",this.#k(i,o)),!0}else i&&(i.has="miss");return!1}peek(t,n={}){const{allowStale:s=this.allowStale}=n,i=this.#s.get(t);if(i===void 0||!s&&this.#f(i))return;const o=this.#e[i];return this.#t(o)?o.__staleWhileFetching:o}#O(t,n,s,i){const o=n===void 0?void 0:this.#e[n];if(this.#t(o))return o;const r=new lC,{signal:l}=s;l?.addEventListener("abort",()=>r.abort(l.reason),{signal:r.signal});const c={signal:r.signal,options:s,context:i},d=(v,b=!1)=>{const{aborted:C}=r.signal,y=s.ignoreFetchAbort&&v!==void 0;if(s.status&&(C&&!b?(s.status.fetchAborted=!0,s.status.fetchError=r.signal.reason,y&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),C&&!y&&!b)return p(r.signal.reason);const x=f;return this.#e[n]===f&&(v===void 0?x.__staleWhileFetching?this.#e[n]=x.__staleWhileFetching:this.#S(t,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(t,v,c.options))),v},u=v=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=v),p(v)),p=v=>{const{aborted:b}=r.signal,C=b&&s.allowStaleOnFetchAbort,y=C||s.allowStaleOnFetchRejection,x=y||s.noDeleteOnFetchRejection,w=f;if(this.#e[n]===f&&(!x||w.__staleWhileFetching===void 0?this.#S(t,"fetch"):C||(this.#e[n]=w.__staleWhileFetching)),y)return s.status&&w.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),w.__staleWhileFetching;if(w.__returned===w)throw v},m=(v,b)=>{const C=this.#T?.(t,o,c);C&&C instanceof Promise&&C.then(y=>v(y===void 0?void 0:y),b),r.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(v(void 0),s.allowStaleOnFetchAbort&&(v=y=>d(y,!0)))})};s.status&&(s.status.fetchDispatched=!0);const f=new Promise(m).then(d,u),g=Object.assign(f,{__abortController:r,__staleWhileFetching:o,__returned:void 0});return n===void 0?(this.set(t,g,{...c.options,status:void 0}),n=this.#s.get(t)):this.#e[n]=g,g}#t(t){if(!this.#I)return!1;const n=t;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof lC}async fetch(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:c=0,sizeCalculation:d=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:p=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:m=this.allowStaleOnFetchRejection,ignoreFetchAbort:f=this.ignoreFetchAbort,allowStaleOnFetchAbort:g=this.allowStaleOnFetchAbort,context:v,forceRefresh:b=!1,status:C,signal:y}=n;if(!this.#I)return C&&(C.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:o,status:C});const x={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:o,ttl:r,noDisposeOnSet:l,size:c,sizeCalculation:d,noUpdateTTL:u,noDeleteOnFetchRejection:p,allowStaleOnFetchRejection:m,allowStaleOnFetchAbort:g,ignoreFetchAbort:f,status:C,signal:y};let w=this.#s.get(t);if(w===void 0){C&&(C.fetch="miss");const _=this.#O(t,w,x,v);return _.__returned=_}else{const _=this.#e[w];if(this.#t(_)){const j=s&&_.__staleWhileFetching!==void 0;return C&&(C.fetch="inflight",j&&(C.returnedStale=!0)),j?_.__staleWhileFetching:_.__returned=_}const S=this.#f(w);if(!b&&!S)return C&&(C.fetch="hit"),this.#P(w),i&&this.#E(w),C&&this.#k(C,w),_;const I=this.#O(t,w,x,v),E=I.__staleWhileFetching!==void 0&&s;return C&&(C.fetch=S?"stale":"refresh",E&&S&&(C.returnedStale=!0)),E?I.__staleWhileFetching:I.__returned=I}}async forceFetch(t,n={}){const s=await this.fetch(t,n);if(s===void 0)throw new Error("fetch() returned undefined");return s}memo(t,n={}){const s=this.#D;if(!s)throw new Error("no memoMethod provided to constructor");const{context:i,forceRefresh:o,...r}=n,l=this.get(t,r);if(!o&&l!==void 0)return l;const c=s(t,l,{options:r,context:i});return this.set(t,c,r),c}get(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,status:r}=n,l=this.#s.get(t);if(l!==void 0){const c=this.#e[l],d=this.#t(c);return r&&this.#k(r,l),this.#f(l)?(r&&(r.get="stale"),d?(r&&s&&c.__staleWhileFetching!==void 0&&(r.returnedStale=!0),s?c.__staleWhileFetching:void 0):(o||this.#S(t,"expire"),r&&s&&(r.returnedStale=!0),s?c:void 0)):(r&&(r.get="hit"),d?c.__staleWhileFetching:(this.#P(l),i&&this.#E(l),c))}else r&&(r.get="miss")}#V(t,n){this.#h[n]=t,this.#c[t]=n}#P(t){t!==this.#o&&(t===this.#r?this.#r=this.#c[t]:this.#V(this.#h[t],this.#c[t]),this.#V(this.#o,t),this.#o=t)}delete(t){return this.#S(t,"delete")}#S(t,n){let s=!1;if(this.#i!==0){const i=this.#s.get(t);if(i!==void 0)if(s=!0,this.#i===1)this.#$(n);else{this.#A(i);const o=this.#e[i];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#C||this.#d)&&(this.#C&&this.#m?.(o,t,n),this.#d&&this.#a?.push([o,t,n])),this.#s.delete(t),this.#n[i]=void 0,this.#e[i]=void 0,i===this.#o)this.#o=this.#h[i];else if(i===this.#r)this.#r=this.#c[i];else{const r=this.#h[i];this.#c[r]=this.#c[i];const l=this.#c[i];this.#h[l]=this.#h[i]}this.#i--,this.#y.push(i)}}if(this.#d&&this.#a?.length){const i=this.#a;let o;for(;o=i?.shift();)this.#g?.(...o)}return s}clear(){return this.#$("delete")}#$(t){for(const n of this.#_({allowStale:!0})){const s=this.#e[n];if(this.#t(s))s.__abortController.abort(new Error("deleted"));else{const i=this.#n[n];this.#C&&this.#m?.(s,i,t),this.#d&&this.#a?.push([s,i,t])}}if(this.#s.clear(),this.#e.fill(void 0),this.#n.fill(void 0),this.#p&&this.#x&&(this.#p.fill(0),this.#x.fill(0)),this.#b&&this.#b.fill(0),this.#r=0,this.#o=0,this.#y.length=0,this.#v=0,this.#i=0,this.#d&&this.#a){const n=this.#a;let s;for(;s=n?.shift();)this.#g?.(...s)}}}function t4e(e,t,n,s="DESC"){return t?e.starred?s==="DESC"?0:n:s==="DESC"?n:Number.MAX_SAFE_INTEGER:s==="DESC"?0:Number.MAX_SAFE_INTEGER}function n4e(e,t,n,s="DESC"){if(e.image_names.includes(t.image_name))return e;const i=t4e(t,n,e.starred_count,s),o=[...e.image_names];return i>=o.length?o.push(t.image_name):o.splice(i,0,t.image_name),{image_names:o,starred_count:n&&t.starred?e.starred_count+1:e.starred_count,total_count:e.total_count+1}}const PI=Ft("events").child({filePath:"services/events/onInvocationComplete.tsx"}),s4e=["load_image","image"],i4e=(e,t,n)=>{const s=async o=>{if(s4e.includes(o.invocation.type)){PI.trace(`Skipping denylisted node type (${o.invocation.type})`);return}const r=await i(o);if(r.length===0)return;const l={},c=rM(e());for(const v of r){if(v.is_intermediate)return;const b=v.board_id??"none";l[b]=(l[b]||0)+1}const d=[];for(const[v,b]of Gr(l)){const C=n2.endpoints.getBoardImagesTotal.select(v)(e()).data?.total;C!==void 0&&d.push({endpointName:"getBoardImagesTotal",arg:v,value:{total:C+b}})}t(n2.util.upsertQueryEntries(d)),t(n2.util.updateQueryData("listAllBoards",xH(e()),v=>{for(const b of v)b.image_count=b.image_count+(l[b.board_id]??0)}));for(const v of r){const b={categories:Fye(v),board_id:v.board_id??"none"},C={...c,...b};if(t($r.util.updateQueryData("getImageNames",{...c,...b,search_term:""},y=>{const x=n4e(y,v,C.starred_first??!0,C.order_dir);y.image_names=x.image_names,y.starred_count=x.starred_count,y.total_count=x.total_count})),c.search_term){const y={...c,...b};t($r.util.invalidateTags([{type:"ImageNameList",id:Gc(y)}]))}}if(!CH(e()))return;const p=r.at(-1);if(!p)return;const{image_name:m}=p,f=p.board_id??"none",g=nm(e());f!==g?t(sm({boardId:f,select:{selection:[m],galleryView:"images"}})):(Bye(e())!=="images"&&t($A("images")),t(Lv(p.image_name)))},i=async o=>{const{result:r}=o,l=[];for(const[c,d]of Gr(r))if(wH(d)){const u=await fh(d.image_name);u&&l.push(u)}else if(zye(d))for(const u of d){const p=await fh(u.image_name);p&&l.push(p)}return l};return async o=>{if(n.has(o.item_id)){PI.trace({data:o},`Received event for already-finished queue item ${o.item_id}`);return}PI.debug({data:o},`Invocation complete (${o.invocation.type}, ${o.invocation_source_id})`);const r=ga.get()[o.invocation_source_id];if(r){const l=It(r);l.status=Ui.enum.COMPLETED,l.progress!==null&&(l.progress=1),l.outputs.push(o.result),nv(l.nodeId,l)}await s(o),Sl.set(null)}},RP="http://github.com/invoke-ai/InvokeAI",o4e="https://github.com/invoke-ai/InvokeAI/issues",oS="https://discord.gg/ZmtBAhwWhy",IN=Ft("events").child({filePath:"services/events/onModelInstallError.tsx"}),a4e=go.endpoints.listModelInstalls.select(),OP=ee("unauthorized-toast"),jN=ee("forbidden-toast"),r4e=e=>{switch(e){case"invalid":return ye("modelManager.hfTokenInvalid");case"unknown":return ye("modelManager.hfTokenUnableToVerify");case"valid":return"HF Token is valid, but does not have access to model"}},l4e=async e=>{const t=e(go.endpoints.getHFTokenStatus.initiate(void 0,{subscribe:!1}));try{return await t.unwrap()}catch{return null}},c4e=(e,t)=>async n=>{IN.error({data:n},"Model install error");const s=a4e(e()).data;if(n.error==="Unauthorized")if(n.source.type==="hf"){const o=await l4e(t);if(o===null)IN.error("Error getting HF token status");else{const r=r4e(o);pe({id:OP,title:r,description:a.jsx(d4e,{}),status:"error",isClosable:!0,duration:null})}}else n.source.type==="url"?pe({id:OP,title:"Model requires authorization",description:a.jsxs(q,{fontSize:"md",children:[ye("modelManager.urlUnauthorizedErrorMessage"),a.jsx(to,{label:ye("modelManager.urlUnauthorizedErrorMessage2"),href:"https://invoke-ai.github.io/InvokeAI/configuration/#model-marketplace-api-keys"})]}),status:"error",isClosable:!0,duration:null}):ae(!1,"Unexpected unauthorized error for path source");else n.error==="Forbidden"?n.source.type==="hf"?pe({id:jN,title:ye("modelManager.hfForbidden"),description:a.jsxs(q,{fontSize:"md",children:[ye("modelManager.hfForbiddenErrorMessage"),a.jsx(to,{label:n.source.repo_id,href:`https://huggingface.co/${n.source.repo_id}`})]}),status:"error",isClosable:!0,duration:null}):n.source.type==="url"?pe({id:jN,title:ye("modelManager.urlForbidden"),description:ye("modelManager.urlForbiddenErrorMessage"),status:"error",isClosable:!0,duration:null}):ae(!1,"Unexpected forbidden error for path source"):pe({title:"Model install error",description:n.error,status:"error",isClosable:!0,duration:null});const i=s?.find(o=>o.id===n.id);t(i?go.util.updateQueryData("listModelInstalls",void 0,o=>{const r=o.find(l=>l.id===n.id);return r&&(r.status="error",r.error_reason=n.error_type,r.error=n.error),o}):Sr.util.invalidateTags([{type:"ModelInstalls"}]))},d4e=()=>{const{data:e}=_H(),{t}=T(),n=h.useCallback(()=>{Ne.switchToTab("models"),Vye.close(OP)},[]);return e?e==="invalid"?a.jsxs(q,{fontSize:"md",children:[t("modelManager.hfTokenInvalidErrorMessage")," ",t("modelManager.hfTokenRequired")," ",t("modelManager.hfTokenInvalidErrorMessage2"),a.jsxs(he,{onClick:n,variant:"link",color:"base.50",flexGrow:0,children:[t("modelManager.modelManager"),"."]})]}):e==="unknown"?a.jsxs(q,{fontSize:"md",children:[t("modelManager.hfTokenUnableToVerifyErrorMessage")," ",a.jsxs(he,{onClick:n,variant:"link",color:"base.50",flexGrow:0,children:[t("modelManager.modelManager"),"."]})]}):a.jsxs(q,{fontSize:"md",children:[t("modelManager.hfTokenForbiddenErrorMessage")," ",a.jsxs(he,{onClick:n,variant:"link",color:"base.50",flexGrow:0,children:[t("modelManager.modelManager"),"."]})]}):a.jsx(ao,{})},u4e=()=>a.jsx(to,{fontWeight:"semibold",href:oS,display:"inline-flex",label:"Discord"}),h4e=()=>a.jsx(to,{fontWeight:"semibold",href:o4e,display:"inline-flex",label:"GitHub"}),Dn=Ft("events").child({filePath:"services/events/setEventListeners.tsx"}),hp=go.endpoints.listModelInstalls.select(),p4e=({socket:e,store:t,setIsConnected:n})=>{const{dispatch:s,getState:i}=t,o=new jc({max:100});e.on("connect",()=>{Dn.debug("Connected"),n(!0),s($ye()),e.emit("subscribe_queue",{queue_id:"default"}),e.emit("subscribe_bulk_download",{bulk_download_id:"default"}),Sl.set(null)}),e.on("connect_error",c=>{Dn.debug("Connect error"),n(!1),Sl.set(null),c&&c.message&&c.data==="ERR_UNAUTHENTICATED"&&pe({id:`connect-error-${c.message}`,title:c.message,status:"error",duration:1e4})}),e.on("disconnect",()=>{Dn.debug("Disconnected"),Sl.set(null),n(!1)}),e.on("invocation_started",c=>{if(o.has(c.item_id))return;const{invocation_source_id:d,invocation:u}=c;Dn.debug({data:c},`Invocation started (${u.type}, ${d})`);const p=It(ga.get()[d]);p&&(p.status=Ui.enum.IN_PROGRESS,nv(p.nodeId,p))}),e.on("invocation_progress",c=>{if(o.has(c.item_id)){Dn.trace({data:c},`Received event for already-finished queue item ${c.item_id}`);return}const{invocation_source_id:d,invocation:u,image:p,origin:m,percentage:f,message:g}=c;let v="Invocation progress";if(g&&(v+=`: ${g}`),st(f)||(v+=` ${Vh(f*100,2)}%`),v+=` (${u.type}, ${d})`,Dn.trace({data:c},v),Sl.set(c),m==="workflows"){const b=It(ga.get()[d]);b&&(b.status=Ui.enum.IN_PROGRESS,b.progress=f,b.progressImage=p??null,nv(b.nodeId,b))}}),e.on("invocation_error",c=>{if(o.has(c.item_id)){Dn.trace({data:c},`Received event for already-finished queue item ${c.item_id}`);return}const{invocation_source_id:d,invocation:u,error_type:p,error_message:m,error_traceback:f}=c;Dn.error({data:c},`Invocation error (${u.type}, ${d})`);const g=It(ga.get()[d]);g&&(g.status=Ui.enum.FAILED,g.progress=null,g.progressImage=null,g.error={error_type:p,error_message:m,error_traceback:f},nv(g.nodeId,g))});const r=i4e(i,s,o);e.on("invocation_complete",r),e.on("model_load_started",c=>{const{config:d,submodel_type:u}=c,{name:p,base:m,type:f}=d,g=[m,f];u&&g.push(u);const v=`Model load started: ${p} (${g.join(", ")})`;Dn.debug({data:c},v)}),e.on("model_load_complete",c=>{const{config:d,submodel_type:u}=c,{name:p,base:m,type:f}=d,g=[m,f];u&&g.push(u);const v=`Model load complete: ${p} (${g.join(", ")})`;Dn.debug({data:c},v)}),e.on("download_started",c=>{Dn.debug({data:c},"Download started")}),e.on("download_progress",c=>{Dn.trace({data:c},"Download progress")}),e.on("download_complete",c=>{Dn.debug({data:c},"Download complete")}),e.on("download_cancelled",c=>{Dn.warn({data:c},"Download cancelled")}),e.on("download_error",c=>{Dn.error({data:c},"Download error")}),e.on("model_install_started",c=>{Dn.debug({data:c},"Model install started");const{id:d}=c;hp(i()).data?.find(p=>p.id===d)?s(go.util.updateQueryData("listModelInstalls",void 0,p=>{const m=p.find(f=>f.id===d);return m&&(m.status="running"),p})):s(Sr.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_started",c=>{Dn.debug({data:c},"Model install download started");const{id:d}=c;hp(i()).data?.find(p=>p.id===d)?s(go.util.updateQueryData("listModelInstalls",void 0,p=>{const m=p.find(f=>f.id===d);return m&&(m.status="downloading"),p})):s(Sr.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_progress",c=>{Dn.trace({data:c},"Model install download progress");const{bytes:d,total_bytes:u,id:p}=c;hp(i()).data?.find(f=>f.id===p)?s(go.util.updateQueryData("listModelInstalls",void 0,f=>{const g=f.find(v=>v.id===p);return g&&(g.bytes=d,g.total_bytes=u,g.status="downloading"),f})):s(Sr.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_downloads_complete",c=>{Dn.debug({data:c},"Model install downloads complete");const{id:d}=c;hp(i()).data?.find(p=>p.id===d)?s(go.util.updateQueryData("listModelInstalls",void 0,p=>{const m=p.find(f=>f.id===d);return m&&(m.status="downloads_done"),p})):s(Sr.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_complete",c=>{Dn.debug({data:c},"Model install complete");const{id:d,config:u}=c;u.type==="unknown"&&pe({id:"UNKNOWN_MODEL",title:ye("modelManager.unidentifiedModelTitle"),description:a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsx(q,{fontSize:"md",as:"span",children:a.jsx(Bn,{i18nKey:"modelManager.unidentifiedModelMessage"})}),a.jsx(q,{fontSize:"md",as:"span",children:a.jsx(Bn,{i18nKey:"modelManager.unidentifiedModelMessage2",components:{DiscordLink:a.jsx(u4e,{}),GitHubIssuesLink:a.jsx(h4e,{})}})})]}),status:"error",isClosable:!0,duration:null}),hp(i()).data?.find(m=>m.id===d)?s(go.util.updateQueryData("listModelInstalls",void 0,m=>{const f=m.find(g=>g.id===d);return f&&(f.status="completed"),m})):s(Sr.util.invalidateTags([{type:"ModelInstalls"}])),s(Sr.util.invalidateTags([{type:"ModelConfig",id:qu}])),s(Sr.util.invalidateTags([{type:"ModelScanFolderResults",id:qu}]))});const l=c4e(i,s);e.on("model_install_error",l),e.on("model_install_cancelled",c=>{Dn.warn({data:c},"Model install cancelled");const{id:d}=c;hp(i()).data?.find(p=>p.id===d)?s(go.util.updateQueryData("listModelInstalls",void 0,p=>{const m=p.find(f=>f.id===d);return m&&(m.status="cancelled"),p})):s(Sr.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("queue_item_status_changed",c=>{if(o.has(c.item_id)){Dn.trace({data:c},`Received event for already-finished queue item ${c.item_id}`);return}const{item_id:d,status:u,batch_status:p,error_type:m,error_message:f,destination:g,started_at:v,updated_at:b,completed_at:C,error_traceback:y}=c;Dn.debug({data:c},`Queue item ${d} status updated: ${u}`),s(mi.util.updateQueryData("getQueueItem",d,w=>{w.status=u,w.started_at=v,w.updated_at=b,w.completed_at=C,w.error_type=m,w.error_message=f,w.error_traceback=y}));const x=["CurrentSessionQueueItem","NextSessionQueueItem","InvocationCacheStatus",{type:"SessionQueueItem",id:d},{type:"SessionQueueItem",id:qu},{type:"SessionQueueItem",id:Gye},{type:"BatchStatus",id:p.batch_id}];g&&x.push({type:"QueueCountsByDestination",id:g}),s(mi.util.invalidateTags(x)),s(mi.util.updateQueryData("getQueueStatus",void 0,w=>{w.queue=c.queue_status})),s(mi.util.updateQueryData("getBatchStatus",{batch_id:c.batch_id},w=>{Object.assign(w,c.batch_status)})),u==="in_progress"?Ku(ga.get(),w=>{if(!w)return;const _=It(w);_.status=Ui.enum.PENDING,_.error=null,_.progress=null,_.progressImage=null,_.outputs=[],ga.setKey(_.nodeId,_)}):(u==="completed"||u==="failed"||u==="canceled")&&(o.set(d,!0),u==="failed"&&m&&pe({id:`INVOCATION_ERROR_${m}`,title:QMe(m),status:"error",duration:null,updateDescription:!0,description:a.jsx(JMe,{errorType:m,errorMessage:f})}),Sl.set(null))}),e.on("queue_cleared",c=>{Dn.debug({data:c},"Queue cleared")}),e.on("batch_enqueued",c=>{Dn.debug({data:c},"Batch enqueued")}),e.on("queue_items_retried",c=>{Dn.debug({data:c},"Queue items retried")}),e.on("bulk_download_started",c=>{Dn.debug({data:c},"Bulk gallery download preparation started")}),e.on("bulk_download_complete",c=>{Dn.debug({data:c},"Bulk gallery download ready");const{bulk_download_item_name:d}=c,u=`/api/v1/images/download/${d}`;pe({id:d,title:ye("gallery.bulkDownloadReady","Download ready"),status:"success",description:a.jsx(to,{label:ye("gallery.clickToDownload","Click here to download"),href:u,download:d}),duration:null})}),e.on("bulk_download_error",c=>{Dn.error({data:c},"Bulk gallery download error");const{bulk_download_item_name:d,error:u}=c;pe({id:d,title:ye("gallery.bulkDownloadFailed"),status:"error",description:u,duration:null})})},Kl=Object.create(null);Kl.open="0";Kl.close="1";Kl.ping="2";Kl.pong="3";Kl.message="4";Kl.upgrade="5";Kl.noop="6";const h2=Object.create(null);Object.keys(Kl).forEach(e=>{h2[Kl[e]]=e});const NP={type:"error",data:"parser error"},MX=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",LX=typeof ArrayBuffer=="function",RX=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Q4=({type:e,data:t},n,s)=>MX&&t instanceof Blob?n?s(t):EN(t,s):LX&&(t instanceof ArrayBuffer||RX(t))?n?s(t):EN(new Blob([t]),s):s(Kl[e]+(t||"")),EN=(e,t)=>{const n=new FileReader;return n.onload=function(){const s=n.result.split(",")[1];t("b"+(s||""))},n.readAsDataURL(e)};function AN(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let TI;function f4e(e,t){if(MX&&e.data instanceof Blob)return e.data.arrayBuffer().then(AN).then(t);if(LX&&(e.data instanceof ArrayBuffer||RX(e.data)))return t(AN(e.data));Q4(e,!1,n=>{TI||(TI=new TextEncoder),t(TI.encode(n))})}const PN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F0=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<PN.length;e++)F0[PN.charCodeAt(e)]=e;const m4e=e=>{let t=e.length*.75,n=e.length,s,i=0,o,r,l,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const d=new ArrayBuffer(t),u=new Uint8Array(d);for(s=0;s<n;s+=4)o=F0[e.charCodeAt(s)],r=F0[e.charCodeAt(s+1)],l=F0[e.charCodeAt(s+2)],c=F0[e.charCodeAt(s+3)],u[i++]=o<<2|r>>4,u[i++]=(r&15)<<4|l>>2,u[i++]=(l&3)<<6|c&63;return d},g4e=typeof ArrayBuffer=="function",J4=(e,t)=>{if(typeof e!="string")return{type:"message",data:OX(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:v4e(e.substring(1),t)}:h2[n]?e.length>1?{type:h2[n],data:e.substring(1)}:{type:h2[n]}:NP},v4e=(e,t)=>{if(g4e){const n=m4e(e);return OX(n,t)}else return{base64:!0,data:e}},OX=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},NX="",y4e=(e,t)=>{const n=e.length,s=new Array(n);let i=0;e.forEach((o,r)=>{Q4(o,!1,l=>{s[r]=l,++i===n&&t(s.join(NX))})})},b4e=(e,t)=>{const n=e.split(NX),s=[];for(let i=0;i<n.length;i++){const o=J4(n[i],t);if(s.push(o),o.type==="error")break}return s};function x4e(){return new TransformStream({transform(e,t){f4e(e,n=>{const s=n.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const o=new DataView(i.buffer);o.setUint8(0,126),o.setUint16(1,s)}else{i=new Uint8Array(9);const o=new DataView(i.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(s))}e.data&&typeof e.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(n)})}})}let DI;function tx(e){return e.reduce((t,n)=>t+n.length,0)}function nx(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let s=0;for(let i=0;i<t;i++)n[i]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),n}function C4e(e,t){DI||(DI=new TextDecoder);const n=[];let s=0,i=-1,o=!1;return new TransformStream({transform(r,l){for(n.push(r);;){if(s===0){if(tx(n)<1)break;const c=nx(n,1);o=(c[0]&128)===128,i=c[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(tx(n)<2)break;const c=nx(n,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),s=3}else if(s===2){if(tx(n)<8)break;const c=nx(n,8),d=new DataView(c.buffer,c.byteOffset,c.length),u=d.getUint32(0);if(u>Math.pow(2,21)-1){l.enqueue(NP);break}i=u*Math.pow(2,32)+d.getUint32(4),s=3}else{if(tx(n)<i)break;const c=nx(n,i);l.enqueue(J4(o?c:DI.decode(c),t)),s=0}if(i===0||i>e){l.enqueue(NP);break}}}})}const FX=4;function zs(e){if(e)return w4e(e)}function w4e(e){for(var t in zs.prototype)e[t]=zs.prototype[t];return e}zs.prototype.on=zs.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};zs.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};zs.prototype.off=zs.prototype.removeListener=zs.prototype.removeAllListeners=zs.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var s,i=0;i<n.length;i++)if(s=n[i],s===t||s.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};zs.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){n=n.slice(0);for(var s=0,i=n.length;s<i;++s)n[s].apply(this,t)}return this};zs.prototype.emitReserved=zs.prototype.emit;zs.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};zs.prototype.hasListeners=function(e){return!!this.listeners(e).length};const aS=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),Va=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),_4e="arraybuffer";function BX(e,...t){return t.reduce((n,s)=>(e.hasOwnProperty(s)&&(n[s]=e[s]),n),{})}const S4e=Va.setTimeout,k4e=Va.clearTimeout;function rS(e,t){t.useNativeTimers?(e.setTimeoutFn=S4e.bind(Va),e.clearTimeoutFn=k4e.bind(Va)):(e.setTimeoutFn=Va.setTimeout.bind(Va),e.clearTimeoutFn=Va.clearTimeout.bind(Va))}const I4e=1.33;function j4e(e){return typeof e=="string"?E4e(e):Math.ceil((e.byteLength||e.size)*I4e)}function E4e(e){let t=0,n=0;for(let s=0,i=e.length;s<i;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}function zX(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function A4e(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function P4e(e){let t={},n=e.split("&");for(let s=0,i=n.length;s<i;s++){let o=n[s].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}class T4e extends Error{constructor(t,n,s){super(t),this.description=n,this.context=s,this.type="TransportError"}}class e5 extends zs{constructor(t){super(),this.writable=!1,rS(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,s){return super.emitReserved("error",new T4e(t,n,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=J4(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=A4e(t);return n.length?"?"+n:""}}class D4e extends e5{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||n()})),this.writable||(s++,this.once("drain",function(){--s||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};b4e(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,y4e(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=zX()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let VX=!1;try{VX=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const M4e=VX;function L4e(){}class R4e extends D4e{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,n){const s=this.request({method:"POST",data:t});s.on("success",n),s.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,s)=>{this.onError("xhr poll error",n,s)}),this.pollXhr=t}}class Nl extends zs{constructor(t,n,s){super(),this.createRequest=t,rS(this,s),this._opts=s,this._method=s.method||"GET",this._uri=n,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var t;const n=BX(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(n);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=Nl.requestsCount++,Nl.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=L4e,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Nl.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Nl.requestsCount=0;Nl.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",TN);else if(typeof addEventListener=="function"){const e="onpagehide"in Va?"pagehide":"unload";addEventListener(e,TN,!1)}}function TN(){for(let e in Nl.requests)Nl.requests.hasOwnProperty(e)&&Nl.requests[e].abort()}const O4e=function(){const e=$X({xdomain:!1});return e&&e.responseType!==null}();class N4e extends R4e{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=O4e&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Nl($X,this.uri(),t)}}function $X(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||M4e))return new XMLHttpRequest}catch{}if(!t)try{return new Va[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const GX=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class F4e extends e5{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,s=GX?{}:BX(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],i=n===t.length-1;Q4(s,this.supportsBinary,o=>{try{this.doWrite(s,o)}catch{}i&&aS(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=zX()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const MI=Va.WebSocket||Va.MozWebSocket;let B4e=class extends F4e{createSocket(t,n,s){return GX?new MI(t,n,s):n?new MI(t,n):new MI(t)}doWrite(t,n){this.ws.send(n)}};class z4e extends e5{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=C4e(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(n).getReader(),i=x4e();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();const o=()=>{s.read().then(({done:l,value:c})=>{l||(this.onPacket(c),o())}).catch(l=>{})};o();const r={type:"open"};this.query.sid&&(r.data=`{"sid":"${this.query.sid}"}`),this._writer.write(r).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],i=n===t.length-1;this._writer.write(s).then(()=>{i&&aS(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const V4e={websocket:B4e,webtransport:z4e,polling:N4e},$4e=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,G4e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function FP(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),s=e.indexOf("]");n!=-1&&s!=-1&&(e=e.substring(0,n)+e.substring(n,s).replace(/:/g,";")+e.substring(s,e.length));let i=$4e.exec(e||""),o={},r=14;for(;r--;)o[G4e[r]]=i[r]||"";return n!=-1&&s!=-1&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=H4e(o,o.path),o.queryKey=W4e(o,o.query),o}function H4e(e,t){const n=/\/{2,9}/g,s=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function W4e(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,o){i&&(n[i]=o)}),n}const BP=typeof addEventListener=="function"&&typeof removeEventListener=="function",p2=[];BP&&addEventListener("offline",()=>{p2.forEach(e=>e())},!1);class Bd extends zs{constructor(t,n){if(super(),this.binaryType=_4e,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const s=FP(t);n.hostname=s.host,n.secure=s.protocol==="https"||s.protocol==="wss",n.port=s.port,s.query&&(n.query=s.query)}else n.host&&(n.hostname=FP(n.host).host);rS(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(s=>{const i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=P4e(this.opts.query)),BP&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},p2.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=FX,n.transport=t,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&Bd.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Bd.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const i=this.writeBuffer[s].data;if(i&&(n+=j4e(i)),s>0&&n>this._maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,aS(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,s){return this._sendPacket("message",t,n,s),this}send(t,n,s){return this._sendPacket("message",t,n,s),this}_sendPacket(t,n,s,i){if(typeof n=="function"&&(i=n,n=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const o={type:t,data:n,options:s};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}_onError(t){if(Bd.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),BP&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=p2.indexOf(this._offlineEventListener);s!==-1&&p2.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}Bd.protocol=FX;class U4e extends Bd{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),s=!1;Bd.priorWebsocketSuccess=!1;const i=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",p=>{if(!s)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Bd.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(u(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const m=new Error("probe error");m.transport=n.name,this.emitReserved("upgradeError",m)}}))};function o(){s||(s=!0,u(),n.close(),n=null)}const r=p=>{const m=new Error("probe error: "+p);m.transport=n.name,o(),this.emitReserved("upgradeError",m)};function l(){r("transport closed")}function c(){r("socket closed")}function d(p){n&&p.name!==n.name&&o()}const u=()=>{n.removeListener("open",i),n.removeListener("error",r),n.removeListener("close",l),this.off("close",c),this.off("upgrading",d)};n.once("open",i),n.once("error",r),n.once("close",l),this.once("close",c),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{s||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&n.push(t[s]);return n}}let q4e=class extends U4e{constructor(t,n={}){const s=typeof t=="object"?t:n;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>V4e[i]).filter(i=>!!i)),super(t,s)}};function K4e(e,t="",n){let s=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),s=FP(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const o=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+o+":"+s.port+t,s.href=s.protocol+"://"+o+(n&&n.port===s.port?"":":"+s.port),s}const Z4e=typeof ArrayBuffer=="function",X4e=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,HX=Object.prototype.toString,Y4e=typeof Blob=="function"||typeof Blob<"u"&&HX.call(Blob)==="[object BlobConstructor]",Q4e=typeof File=="function"||typeof File<"u"&&HX.call(File)==="[object FileConstructor]";function t5(e){return Z4e&&(e instanceof ArrayBuffer||X4e(e))||Y4e&&e instanceof Blob||Q4e&&e instanceof File}function f2(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,s=e.length;n<s;n++)if(f2(e[n]))return!0;return!1}if(t5(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return f2(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&f2(e[n]))return!0;return!1}function J4e(e){const t=[],n=e.data,s=e;return s.data=zP(n,t),s.attachments=t.length,{packet:s,buffers:t}}function zP(e,t){if(!e)return e;if(t5(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=zP(e[s],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=zP(e[s],t));return n}return e}function e5e(e,t){return e.data=VP(e.data,t),delete e.attachments,e}function VP(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=VP(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=VP(e[n],t));return e}const t5e=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],n5e=5;var on;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(on||(on={}));class s5e{constructor(t){this.replacer=t}encode(t){return(t.type===on.EVENT||t.type===on.ACK)&&f2(t)?this.encodeAsBinary({type:t.type===on.EVENT?on.BINARY_EVENT:on.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===on.BINARY_EVENT||t.type===on.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=J4e(t),s=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(s),i}}function DN(e){return Object.prototype.toString.call(e)==="[object Object]"}class n5 extends zs{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const s=n.type===on.BINARY_EVENT;s||n.type===on.BINARY_ACK?(n.type=s?on.EVENT:on.ACK,this.reconstructor=new i5e(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(t5(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const s={type:Number(t.charAt(0))};if(on[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===on.BINARY_EVENT||s.type===on.BINARY_ACK){const o=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const r=t.substring(o,n);if(r!=Number(r)||t.charAt(n)!=="-")throw new Error("Illegal attachments");s.attachments=Number(r)}if(t.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););s.nsp=t.substring(o,n)}else s.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const r=t.charAt(n);if(r==null||Number(r)!=r){--n;break}if(n===t.length)break}s.id=Number(t.substring(o,n+1))}if(t.charAt(++n)){const o=this.tryParse(t.substr(n));if(n5.isPayloadValid(s.type,o))s.data=o;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case on.CONNECT:return DN(n);case on.DISCONNECT:return n===void 0;case on.CONNECT_ERROR:return typeof n=="string"||DN(n);case on.EVENT:case on.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&t5e.indexOf(n[0])===-1);case on.ACK:case on.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class i5e{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=e5e(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const o5e=Object.freeze(Object.defineProperty({__proto__:null,Decoder:n5,Encoder:s5e,get PacketType(){return on},protocol:n5e},Symbol.toStringTag,{value:"Module"}));function kr(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const a5e=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class WX extends zs{constructor(t,n,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[kr(t,"open",this.onopen.bind(this)),kr(t,"packet",this.onpacket.bind(this)),kr(t,"error",this.onerror.bind(this)),kr(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var s,i,o;if(a5e.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:on.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const u=this.ids++,p=n.pop();this._registerAckCallback(u,p),r.id=u}const l=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,n){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[t]=n;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===t&&this.sendBuffer.splice(l,1);n.call(this,new Error("operation has timed out"))},i),r=(...l)=>{this.io.clearTimeoutFn(o),n.apply(this,l)};r.withError=!0,this.acks[t]=r}emitWithAck(t,...n){return new Promise((s,i)=>{const o=(r,l)=>r?i(r):s(l);o.withError=!0,n.push(o),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...o)=>s!==this._queue[0]?void 0:(i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...o)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:on.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case on.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case on.EVENT:case on.BINARY_EVENT:this.onevent(t);break;case on.ACK:case on.BINARY_ACK:this.onack(t);break;case on.DISCONNECT:this.ondisconnect();break;case on.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const s of n)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let s=!1;return function(...i){s||(s=!0,n.packet({type:on.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:on.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const s of n)s.apply(this,t.data)}}}function Am(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Am.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-n:e+n}return Math.min(e,this.max)|0};Am.prototype.reset=function(){this.attempts=0};Am.prototype.setMin=function(e){this.ms=e};Am.prototype.setMax=function(e){this.max=e};Am.prototype.setJitter=function(e){this.jitter=e};class $P extends zs{constructor(t,n){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,rS(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((s=n.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Am({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||o5e;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new q4e(this.uri,this.opts);const n=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=kr(n,"open",function(){s.onopen(),t&&t()}),o=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),t?t(l):this.maybeReconnectOnOpen()},r=kr(n,"error",o);if(this._timeout!==!1){const l=this._timeout,c=this.setTimeoutFn(()=>{i(),o(new Error("timeout")),n.close()},l);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(r),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(kr(t,"ping",this.onping.bind(this)),kr(t,"data",this.ondata.bind(this)),kr(t,"error",this.onerror.bind(this)),kr(t,"close",this.onclose.bind(this)),kr(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){aS(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new WX(this,t,n),this.nsps[t]=s),s}_destroy(t){const n=Object.keys(this.nsps);for(const s of n)if(this.nsps[s].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let s=0;s<n.length;s++)this.engine.write(n[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const e0={};function m2(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=K4e(e,t.path||"/socket.io"),s=n.source,i=n.id,o=n.path,r=e0[i]&&o in e0[i].nsps,l=t.forceNew||t["force new connection"]||t.multiplex===!1||r;let c;return l?c=new $P(s,t):(e0[i]||(e0[i]=new $P(s,t)),c=e0[i]),n.query&&!t.query&&(t.query=n.queryKey),c.socket(n.path,t)}Object.assign(m2,{Manager:$P,Socket:WX,io:m2,connect:m2});const r5e=()=>{mn("useSocketIO");const e=Ze(),t=h.useMemo(()=>`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}`,[]),n=h.useMemo(()=>({timeout:6e4,path:`${window.location.pathname}ws/socket.io`,autoConnect:!1,forceNew:!0}),[]);h.useEffect(()=>{const s=m2(t,n);E_.set(s),p4e({socket:s,store:e,setIsConnected:ks.set}),s.connect();const i=e.subscribe(()=>{const o=Hye(e.getState()).data;(!o||o.queue.in_progress===0)&&Sl.set(null)});return()=>{i(),s.disconnect()}},[n,t,e])},l5e={destination:"canvas"},UX=h.memo(()=>{const e=M(KZ),t=Q();return fDe(),yje(),r5e(),Wye(),iPe(),Yw(),RIe(),zIe(),WTe(),gje(),LIe(),Uye(l5e),pDe(),h.useEffect(()=>{at.changeLanguage(e)},[e]),h.useEffect(()=>{t(qye())},[t]),h.useEffect(()=>Kye(t),[t]),ZTe(),MIe(),FIe(),aDe(),qTe(),null});UX.displayName="GlobalHookIsolator";const qh=e=>{const t=De(e),n=()=>{t.set(!0)},s=()=>{t.set(!1)},i=l=>{t.set(l)},o=()=>{t.set(!t.get())};return[()=>({isTrue:le(t),setTrue:n,setFalse:s,set:i,toggle:o}),t]},s5=e=>{const[t,n]=h.useState(e),s=h.useCallback(()=>{n(!0)},[n]),i=h.useCallback(()=>{n(!1)},[n]),o=h.useCallback(()=>{n(r=>!r)},[n]);return{isTrue:t,setTrue:s,setFalse:i,set:n,toggle:o}},lS=e=>{const t=De(e),n=()=>{t.set(!0)},s=()=>{t.set(!1)},i=l=>{t.set(l)},o=()=>{t.set(!t.get())};return[()=>({isOpen:le(t),open:n,close:s,set:i,toggle:o}),t]},cS=e=>{const[t,n]=h.useState(e),s=h.useCallback(()=>{n(!0)},[n]),i=h.useCallback(()=>{n(!1)},[n]),o=h.useCallback(()=>{n(r=>!r)},[n]);return{isOpen:t,open:s,close:i,set:n,toggle:o}},[Pm]=lS(!1),sv=De(null),GP=De(!1),c5e=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,cC=e=>{if(typeof e!="string")throw new TypeError("Invalid argument expected string");const t=e.match(c5e);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},MN=e=>e==="*"||e==="x"||e==="X",LN=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},d5e=(e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t],u5e=(e,t)=>{if(MN(e)||MN(t))return 0;const[n,s]=d5e(LN(e),LN(t));return n>s?1:n<s?-1:0},Qp=(e,t)=>{for(let n=0;n<Math.max(e.length,t.length);n++){const s=u5e(e[n]||"0",t[n]||"0");if(s!==0)return s}return 0},h5e=(e,t)=>{const n=cC(e),s=cC(t),i=n.pop(),o=s.pop(),r=Qp(n,s);return r!==0?r:i&&o?Qp(i.split("."),o.split(".")):i||o?i?-1:1:0},HP=(e,t,n)=>{p5e(n);const s=h5e(e,t);return qX[n].includes(s)},qX={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},RN=Object.keys(qX),p5e=e=>{if(typeof e!="string")throw new TypeError(`Invalid operator type, expected string but got ${typeof e}`);if(RN.indexOf(e)===-1)throw new Error(`Invalid operator, expected one of ${RN.join("|")}`)},g2=(e,t)=>{if(t=t.replace(/([><=]+)\s+/g,"$1"),t.includes("||"))return t.split("||").some(b=>g2(e,b));if(t.includes(" - ")){const[b,C]=t.split(" - ",2);return g2(e,`>=${b} <=${C}`)}else if(t.includes(" "))return t.trim().replace(/\s{2,}/g," ").split(" ").every(b=>g2(e,b));const n=t.match(/^([<>=~^]+)/),s=n?n[1]:"=";if(s!=="^"&&s!=="~")return HP(e,t,s);const[i,o,r,,l]=cC(e),[c,d,u,,p]=cC(t),m=[i,o,r],f=[c,d??"x",u??"x"];if(p&&(!l||Qp(m,f)!==0||Qp(l.split("."),p.split("."))===-1))return!1;const g=f.findIndex(b=>b!=="0")+1,v=s==="~"?2:g>1?g:1;return!(Qp(m.slice(0,v),f.slice(0,v))!==0||Qp(m.slice(v),f.slice(v))===-1)},f5e={EnumField:"",BoardField:void 0,BooleanField:!1,ColorField:{r:0,g:0,b:0,a:1},FloatField:0,ImageField:void 0,IntegerField:0,ModelIdentifierField:void 0,SchedulerField:"dpmpp_3m_k",StringField:"",StylePresetField:void 0,FloatGeneratorField:void 0,IntegerGeneratorField:void 0,StringGeneratorField:void 0,ImageGeneratorField:void 0},KX=(e,t)=>({name:t.name,label:"",description:"",value:t.default??jf(f5e,t.type.name)}),ZX=(e,t)=>{const n=Kd(),{type:s}=t,i=OD(t.inputs,(r,l,c)=>{const d=Kd(),u=KX(d,l);return r[c]=u,r},{});return{...lM,id:n,type:"invocation",position:e,data:{id:n,type:s,version:t.version,label:"",notes:"",isOpen:!0,isIntermediate:s!=="save_image",useCache:t.useCache,nodePack:t.nodePack,inputs:i}}},g1=(e,t)=>e.type!==t.type?!0:e.version!==t.version,m5e=(e,t)=>{if(!g1(e.data,t)||e.data.type!==t.type)return!1;const s=Zye.parse(t.version).major;return g2(e.data.version,`^${s}`)},XX=(e,t)=>{if(!m5e(e,t)||e.data.type!==t.type)throw new SH(`Unable to update node ${e.id}`);const s=ZX(e.position,t),i=It(e);return i.data.version=t.version,SIe(i,s),i.data.inputs=eH(i.data.inputs,wIe(s.data.inputs)),i},g5e={BoardField:{name:"BoardField",isCollection:!1,isCollectionOrScalar:!1},boolean:{name:"BooleanField",isCollection:!1,isCollectionOrScalar:!1},BooleanCollection:{name:"BooleanField",isCollection:!0,isCollectionOrScalar:!1},BooleanPolymorphic:{name:"BooleanField",isCollection:!1,isCollectionOrScalar:!0},ColorField:{name:"ColorField",isCollection:!1,isCollectionOrScalar:!1},ColorCollection:{name:"ColorField",isCollection:!0,isCollectionOrScalar:!1},ColorPolymorphic:{name:"ColorField",isCollection:!1,isCollectionOrScalar:!0},ControlNetModelField:{name:"ControlNetModelField",isCollection:!1,isCollectionOrScalar:!1},enum:{name:"EnumField",isCollection:!1,isCollectionOrScalar:!1},float:{name:"FloatField",isCollection:!1,isCollectionOrScalar:!1},FloatCollection:{name:"FloatField",isCollection:!0,isCollectionOrScalar:!1},FloatPolymorphic:{name:"FloatField",isCollection:!1,isCollectionOrScalar:!0},ImageCollection:{name:"ImageField",isCollection:!0,isCollectionOrScalar:!1},ImageField:{name:"ImageField",isCollection:!1,isCollectionOrScalar:!1},ImagePolymorphic:{name:"ImageField",isCollection:!1,isCollectionOrScalar:!0},integer:{name:"IntegerField",isCollection:!1,isCollectionOrScalar:!1},IntegerCollection:{name:"IntegerField",isCollection:!0,isCollectionOrScalar:!1},IntegerPolymorphic:{name:"IntegerField",isCollection:!1,isCollectionOrScalar:!0},IPAdapterModelField:{name:"IPAdapterModelField",isCollection:!1,isCollectionOrScalar:!1},LoRAModelField:{name:"LoRAModelField",isCollection:!1,isCollectionOrScalar:!1},MainModelField:{name:"MainModelField",isCollection:!1,isCollectionOrScalar:!1},Scheduler:{name:"SchedulerField",isCollection:!1,isCollectionOrScalar:!1},SDXLMainModelField:{name:"SDXLMainModelField",isCollection:!1,isCollectionOrScalar:!1},SDXLRefinerModelField:{name:"SDXLRefinerModelField",isCollection:!1,isCollectionOrScalar:!1},string:{name:"StringField",isCollection:!1,isCollectionOrScalar:!1},StringCollection:{name:"StringField",isCollection:!0,isCollectionOrScalar:!1},StringPolymorphic:{name:"StringField",isCollection:!1,isCollectionOrScalar:!0},T2IAdapterModelField:{name:"T2IAdapterModelField",isCollection:!1,isCollectionOrScalar:!1},VaeModelField:{name:"VAEModelField",isCollection:!1,isCollectionOrScalar:!1}},v5e={Any:{name:"AnyField",isCollection:!1,isCollectionOrScalar:!1},ClipField:{name:"ClipField",isCollection:!1,isCollectionOrScalar:!1},Collection:{name:"CollectionField",isCollection:!0,isCollectionOrScalar:!1},CollectionItem:{name:"CollectionItemField",isCollection:!1,isCollectionOrScalar:!1},ConditioningCollection:{name:"ConditioningField",isCollection:!0,isCollectionOrScalar:!1},ConditioningField:{name:"ConditioningField",isCollection:!1,isCollectionOrScalar:!1},ConditioningPolymorphic:{name:"ConditioningField",isCollection:!1,isCollectionOrScalar:!0},ControlCollection:{name:"ControlField",isCollection:!0,isCollectionOrScalar:!1},ControlField:{name:"ControlField",isCollection:!1,isCollectionOrScalar:!1},ControlPolymorphic:{name:"ControlField",isCollection:!1,isCollectionOrScalar:!0},DenoiseMaskField:{name:"DenoiseMaskField",isCollection:!1,isCollectionOrScalar:!1},IPAdapterField:{name:"IPAdapterField",isCollection:!1,isCollectionOrScalar:!1},IPAdapterCollection:{name:"IPAdapterField",isCollection:!0,isCollectionOrScalar:!1},IPAdapterPolymorphic:{name:"IPAdapterField",isCollection:!1,isCollectionOrScalar:!0},LatentsField:{name:"LatentsField",isCollection:!1,isCollectionOrScalar:!1},LatentsCollection:{name:"LatentsField",isCollection:!0,isCollectionOrScalar:!1},LatentsPolymorphic:{name:"LatentsField",isCollection:!1,isCollectionOrScalar:!0},MetadataField:{name:"MetadataField",isCollection:!1,isCollectionOrScalar:!1},MetadataCollection:{name:"MetadataField",isCollection:!0,isCollectionOrScalar:!1},MetadataItemField:{name:"MetadataItemField",isCollection:!1,isCollectionOrScalar:!1},MetadataItemCollection:{name:"MetadataItemField",isCollection:!0,isCollectionOrScalar:!1},MetadataItemPolymorphic:{name:"MetadataItemField",isCollection:!1,isCollectionOrScalar:!0},T2IAdapterField:{name:"T2IAdapterField",isCollection:!1,isCollectionOrScalar:!1},T2IAdapterCollection:{name:"T2IAdapterField",isCollection:!0,isCollectionOrScalar:!1},T2IAdapterPolymorphic:{name:"T2IAdapterField",isCollection:!1,isCollectionOrScalar:!0},UNetField:{name:"UNetField",isCollection:!1,isCollectionOrScalar:!1},VaeField:{name:"VaeField",isCollection:!1,isCollectionOrScalar:!1}},ON={...g5e,...v5e},y5e=Ds(["euler","deis","ddim","ddpm","dpmpp_2s","dpmpp_2m","dpmpp_2m_sde","dpmpp_sde","heun","kdpm_2","lms","pndm","unipc","euler_k","dpmpp_2s_k","dpmpp_2m_k","dpmpp_2m_sde_k","dpmpp_sde_k","heun_k","lms_k","euler_a","kdpm_2_a","lcm"]),i5=Ds(["any","sd-1","sd-2","sdxl","sdxl-refiner"]),b5e=ct({model_name:$e().min(1),base_model:i5,model_type:Ie("main")}),x5e=ct({model_name:$e().min(1),base_model:i5,model_type:Ie("onnx")}),o5=gi([b5e,x5e]),C5e=Ds(["Any","BoardField","boolean","BooleanCollection","BooleanPolymorphic","ClipField","Collection","CollectionItem","ColorCollection","ColorField","ColorPolymorphic","ConditioningCollection","ConditioningField","ConditioningPolymorphic","ControlCollection","ControlField","ControlNetModelField","ControlPolymorphic","DenoiseMaskField","enum","float","FloatCollection","FloatPolymorphic","ImageCollection","ImageField","ImagePolymorphic","integer","IntegerCollection","IntegerPolymorphic","IPAdapterCollection","IPAdapterField","IPAdapterModelField","IPAdapterPolymorphic","LatentsCollection","LatentsField","LatentsPolymorphic","LoRAModelField","MainModelField","MetadataField","MetadataCollection","MetadataItemField","MetadataItemCollection","MetadataItemPolymorphic","ONNXModelField","Scheduler","SDXLMainModelField","SDXLRefinerModelField","string","StringCollection","StringPolymorphic","T2IAdapterCollection","T2IAdapterField","T2IAdapterModelField","T2IAdapterPolymorphic","UNetField","VaeField","VaeModelField"]),YX=ct({id:$e().trim().min(1),name:$e().trim().min(1),type:C5e}),w5e=YX.extend({fieldKind:Ie("output")}),yt=YX.extend({fieldKind:Ie("input"),label:$e()}),Jc=ct({model_name:$e().trim().min(1),base_model:i5}),Tm=ct({image_name:$e().trim().min(1)}),_5e=ct({board_id:$e().trim().min(1)}),dC=ct({latents_name:$e().trim().min(1),seed:Et().int().optional()}),uC=ct({conditioning_name:$e().trim().min(1)}),S5e=ct({mask_name:$e().trim().min(1),masked_latents_name:$e().trim().min(1).optional()}),k5e=yt.extend({type:Ie("integer"),value:Et().int().optional()}),I5e=yt.extend({type:Ie("IntegerCollection"),value:Cn(Et().int()).optional()}),j5e=yt.extend({type:Ie("IntegerPolymorphic"),value:Et().int().optional()}),E5e=yt.extend({type:Ie("float"),value:Et().optional()}),A5e=yt.extend({type:Ie("FloatCollection"),value:Cn(Et()).optional()}),P5e=yt.extend({type:Ie("FloatPolymorphic"),value:Et().optional()}),T5e=yt.extend({type:Ie("string"),value:$e().optional()}),D5e=yt.extend({type:Ie("StringCollection"),value:Cn($e()).optional()}),M5e=yt.extend({type:Ie("StringPolymorphic"),value:$e().optional()}),L5e=yt.extend({type:Ie("boolean"),value:ss().optional()}),R5e=yt.extend({type:Ie("BooleanCollection"),value:Cn(ss()).optional()}),O5e=yt.extend({type:Ie("BooleanPolymorphic"),value:ss().optional()}),N5e=yt.extend({type:Ie("enum"),value:$e().optional()}),F5e=yt.extend({type:Ie("LatentsField"),value:dC.optional()}),B5e=yt.extend({type:Ie("LatentsCollection"),value:Cn(dC).optional()}),z5e=yt.extend({type:Ie("LatentsPolymorphic"),value:gi([dC,Cn(dC)]).optional()}),V5e=yt.extend({type:Ie("DenoiseMaskField"),value:S5e.optional()}),$5e=yt.extend({type:Ie("ConditioningField"),value:uC.optional()}),G5e=yt.extend({type:Ie("ConditioningCollection"),value:Cn(uC).optional()}),H5e=yt.extend({type:Ie("ConditioningPolymorphic"),value:gi([uC,Cn(uC)]).optional()}),W5e=Jc,hC=ct({image:Tm,control_model:W5e,control_weight:gi([Et(),Cn(Et())]).optional(),begin_step_percent:Et().optional(),end_step_percent:Et().optional(),control_mode:Ds(["balanced","more_prompt","more_control","unbalanced"]).optional(),resize_mode:Ds(["just_resize","crop_resize","fill_resize","just_resize_simple"]).optional()}),U5e=yt.extend({type:Ie("ControlField"),value:hC.optional()}),q5e=yt.extend({type:Ie("ControlPolymorphic"),value:gi([hC,Cn(hC)]).optional()}),K5e=yt.extend({type:Ie("ControlCollection"),value:Cn(hC).optional()}),Z5e=Jc,pC=ct({image:Tm,ip_adapter_model:Z5e,weight:Et(),begin_step_percent:Et().optional(),end_step_percent:Et().optional()}),X5e=yt.extend({type:Ie("IPAdapterField"),value:pC.optional()}),Y5e=yt.extend({type:Ie("IPAdapterPolymorphic"),value:gi([pC,Cn(pC)]).optional()}),Q5e=yt.extend({type:Ie("IPAdapterCollection"),value:Cn(pC).optional()}),J5e=Jc,fC=ct({image:Tm,t2i_adapter_model:J5e,weight:gi([Et(),Cn(Et())]).optional(),begin_step_percent:Et().optional(),end_step_percent:Et().optional(),resize_mode:Ds(["just_resize","crop_resize","fill_resize","just_resize_simple"]).optional()}),e6e=yt.extend({type:Ie("T2IAdapterField"),value:fC.optional()}),t6e=yt.extend({type:Ie("T2IAdapterPolymorphic"),value:gi([fC,Cn(fC)]).optional()}),n6e=yt.extend({type:Ie("T2IAdapterCollection"),value:Cn(fC).optional()}),s6e=Ds(["onnx","main","vae","lora","controlnet","embedding"]),i6e=Ds(["unet","text_encoder","text_encoder_2","tokenizer","tokenizer_2","vae","vae_decoder","vae_encoder","scheduler","safety_checker"]),Df=Jc.extend({model_type:s6e,submodel:i6e.optional()}),QX=Df.extend({weight:Et().optional()}),o6e=ct({unet:Df,scheduler:Df,loras:Cn(QX)}),a6e=yt.extend({type:Ie("UNetField"),value:o6e.optional()}),r6e=ct({tokenizer:Df,text_encoder:Df,skipped_layers:Et(),loras:Cn(QX)}),l6e=yt.extend({type:Ie("ClipField"),value:r6e.optional()}),c6e=ct({vae:Df}),d6e=yt.extend({type:Ie("VaeField"),value:c6e.optional()}),u6e=yt.extend({type:Ie("ImageField"),value:Tm.optional()}),h6e=yt.extend({type:Ie("BoardField"),value:_5e.optional()}),p6e=yt.extend({type:Ie("ImagePolymorphic"),value:Tm.optional()}),f6e=yt.extend({type:Ie("ImageCollection"),value:Cn(Tm).optional()}),m6e=yt.extend({type:Ie("MainModelField"),value:o5.optional()}),g6e=yt.extend({type:Ie("SDXLMainModelField"),value:o5.optional()}),v6e=yt.extend({type:Ie("SDXLRefinerModelField"),value:o5.optional()}),y6e=Jc,b6e=yt.extend({type:Ie("VaeModelField"),value:y6e.optional()}),x6e=Jc,C6e=yt.extend({type:Ie("LoRAModelField"),value:x6e.optional()}),w6e=Jc,_6e=yt.extend({type:Ie("ControlNetModelField"),value:w6e.optional()}),S6e=Jc,k6e=yt.extend({type:Ie("IPAdapterModelField"),value:S6e.optional()}),I6e=Jc,j6e=yt.extend({type:Ie("T2IAdapterModelField"),value:I6e.optional()}),E6e=yt.extend({type:Ie("Collection"),value:Cn(My()).optional()}),A6e=yt.extend({type:Ie("CollectionItem"),value:My().optional()}),mC=ct({label:$e(),value:My()}),P6e=yt.extend({type:Ie("MetadataItemField"),value:mC.optional()}),T6e=yt.extend({type:Ie("MetadataItemCollection"),value:Cn(mC).optional()}),D6e=yt.extend({type:Ie("MetadataItemPolymorphic"),value:gi([mC,Cn(mC)]).optional()}),JX=Rv($e(),My()),M6e=yt.extend({type:Ie("MetadataField"),value:JX.optional()}),L6e=yt.extend({type:Ie("MetadataCollection"),value:Cn(JX).optional()}),gC=ct({r:Et().int().min(0).max(255),g:Et().int().min(0).max(255),b:Et().int().min(0).max(255),a:Et().int().min(0).max(255)}),R6e=yt.extend({type:Ie("ColorField"),value:gC.optional()}),O6e=yt.extend({type:Ie("ColorCollection"),value:Cn(gC).optional()}),N6e=yt.extend({type:Ie("ColorPolymorphic"),value:gi([gC,Cn(gC)]).optional()}),F6e=yt.extend({type:Ie("Scheduler"),value:y5e.optional()}),B6e=yt.extend({type:Ie("Any"),value:My().optional()}),z6e=cM("type",[B6e,h6e,R5e,L5e,O5e,l6e,E6e,A6e,R6e,O6e,N6e,$5e,G5e,H5e,U5e,_6e,K5e,q5e,V5e,N5e,A5e,E5e,P5e,f6e,p6e,u6e,I5e,j5e,k5e,X5e,k6e,Q5e,Y5e,F5e,B5e,z5e,C6e,m6e,F6e,g6e,v6e,D5e,M5e,T5e,e6e,j6e,n6e,t6e,a6e,d6e,b6e,P6e,T6e,D6e,M6e,L6e]),V6e=$e().refine(e=>{const[t,n,s]=e.split(".");return t!==void 0&&Number.isInteger(Number(t))&&n!==void 0&&Number.isInteger(Number(n))&&s!==void 0&&Number.isInteger(Number(s))}),$6e=ct({id:$e().trim().min(1),type:$e().trim().min(1),inputs:Rv($e(),z6e),outputs:Rv($e(),w5e),label:$e(),isOpen:ss(),notes:$e(),embedWorkflow:ss(),isIntermediate:ss(),useCache:ss().default(!0),version:V6e.optional()}),G6e=ct({id:$e().trim().min(1),type:Ie("notes"),label:$e(),isOpen:ss(),notes:$e()}),eY=ct({x:Et(),y:Et()}).default({x:0,y:0}),vC=Et().gt(0).nullish(),H6e=ct({id:$e().trim().min(1),type:Ie("invocation"),data:$6e,width:vC,height:vC,position:eY}),W6e=ct({id:$e().trim().min(1),type:Ie("notes"),data:G6e,width:vC,height:vC,position:eY}),U6e=cM("type",[H6e,W6e]),q6e=ct({source:$e().trim().min(1),sourceHandle:$e().trim().min(1),target:$e().trim().min(1),targetHandle:$e().trim().min(1),id:$e().trim().min(1),type:Ie("default")}),K6e=ct({source:$e().trim().min(1),target:$e().trim().min(1),id:$e().trim().min(1),type:Ie("collapsed")}),Z6e=gi([q6e,K6e]),X6e=ct({nodeId:$e().trim().min(1),fieldName:$e().trim().min(1)}),Y6e=ct({name:$e().default(""),author:$e().default(""),description:$e().default(""),version:$e().default(""),contact:$e().default(""),tags:$e().default(""),notes:$e().default(""),nodes:Cn(U6e).default([]),edges:Cn(Z6e).default([]),exposedFields:Cn(X6e).default([]),meta:ct({version:Ie("1.0.0")})}),Q6e=ct({image_name:$e().trim().min(1)}),J6e=ct({board_id:$e().trim().min(1)}),e3e=ct({r:Et().int().min(0).max(255),g:Et().int().min(0).max(255),b:Et().int().min(0).max(255),a:Et().int().min(0).max(255)}),t3e=Ds(["euler","deis","ddim","ddpm","dpmpp_2s","dpmpp_2m","dpmpp_2m_sde","dpmpp_sde","heun","kdpm_2","lms","pndm","unipc","euler_k","dpmpp_2s_k","dpmpp_2m_k","dpmpp_2m_sde_k","dpmpp_sde_k","heun_k","lms_k","euler_a","kdpm_2_a","lcm"]),tY=Ds(["any","sd-1","sd-2","sdxl","sdxl-refiner"]),nY=$e().min(3),Dm=ct({model_name:nY,base_model:tY}),n3e=ct({model_name:nY,base_model:tY,model_type:Ie("main")}),s3e=Dm,i3e=Dm,o3e=Dm,a3e=Dm,r3e=Dm,sY=ct({id:$e().trim().min(1),name:$e().trim().min(1)}),Ci=sY.extend({fieldKind:Ie("input"),label:$e().nullish()}),wi=sY.extend({fieldKind:Ie("output")}),_i=ct({isCollection:ss(),isCollectionOrScalar:ss()}),l3e=ct({nodeId:$e().trim().min(1),fieldName:$e().trim().min(1)}),a5=_i.extend({name:Ie("IntegerField")}),c3e=Et().int(),d3e=Ci.extend({type:a5,value:c3e}),u3e=wi.extend({type:a5}),r5=_i.extend({name:Ie("FloatField")}),h3e=Et(),p3e=Ci.extend({type:r5,value:h3e}),f3e=wi.extend({type:r5}),l5=_i.extend({name:Ie("StringField")}),m3e=$e(),g3e=Ci.extend({type:l5,value:m3e}),v3e=wi.extend({type:l5}),c5=_i.extend({name:Ie("BooleanField")}),y3e=ss(),b3e=Ci.extend({type:c5,value:y3e}),x3e=wi.extend({type:c5}),d5=_i.extend({name:Ie("EnumField")}),C3e=$e(),w3e=Ci.extend({type:d5,value:C3e}),_3e=wi.extend({type:d5}),u5=_i.extend({name:Ie("ImageField")}),S3e=Q6e.optional(),k3e=Ci.extend({type:u5,value:S3e}),I3e=wi.extend({type:u5}),h5=_i.extend({name:Ie("BoardField")}),j3e=J6e.optional(),E3e=Ci.extend({type:h5,value:j3e}),A3e=wi.extend({type:h5}),p5=_i.extend({name:Ie("ColorField")}),P3e=e3e.optional(),T3e=Ci.extend({type:p5,value:P3e}),D3e=wi.extend({type:p5}),f5=_i.extend({name:Ie("MainModelField")}),m5=n3e.optional(),M3e=Ci.extend({type:f5,value:m5}),L3e=wi.extend({type:f5}),g5=_i.extend({name:Ie("SDXLMainModelField")}),R3e=m5,O3e=Ci.extend({type:g5,value:R3e}),N3e=wi.extend({type:g5}),v5=_i.extend({name:Ie("SDXLRefinerModelField")}),F3e=m5,B3e=Ci.extend({type:v5,value:F3e}),z3e=wi.extend({type:v5}),y5=_i.extend({name:Ie("VAEModelField")}),V3e=s3e.optional(),$3e=Ci.extend({type:y5,value:V3e}),G3e=wi.extend({type:y5}),b5=_i.extend({name:Ie("LoRAModelField")}),H3e=i3e.optional(),W3e=Ci.extend({type:b5,value:H3e}),U3e=wi.extend({type:b5}),x5=_i.extend({name:Ie("ControlNetModelField")}),q3e=o3e.optional(),K3e=Ci.extend({type:x5,value:q3e}),Z3e=wi.extend({type:x5}),C5=_i.extend({name:Ie("IPAdapterModelField")}),X3e=a3e.optional(),Y3e=Ci.extend({type:C5,value:X3e}),Q3e=wi.extend({type:C5}),w5=_i.extend({name:Ie("T2IAdapterModelField")}),J3e=r3e.optional(),e8e=Ci.extend({type:w5,value:J3e}),t8e=wi.extend({type:w5}),_5=_i.extend({name:Ie("SchedulerField")}),n8e=t3e.optional(),s8e=Ci.extend({type:_5,value:n8e}),i8e=wi.extend({type:_5}),iY=_i.extend({name:$e().min(1)}),o8e=Xye().catch(void 0),a8e=Ci.extend({type:iY,value:o8e}),r8e=wi.extend({type:iY});gi([a5,r5,l5,c5,d5,u5,h5,f5,g5,v5,y5,b5,x5,C5,w5,p5,_5]);const l8e=gi([d3e,p3e,g3e,b3e,w3e,k3e,E3e,M3e,O3e,B3e,$3e,W3e,K3e,Y3e,e8e,T3e,s8e]),c8e=gi([l8e,a8e]),d8e=gi([u3e,f3e,v3e,x3e,_3e,I3e,A3e,L3e,N3e,z3e,G3e,U3e,Z3e,Q3e,t8e,D3e,i8e]),u8e=gi([d8e,r8e]),LI=Yye().int().min(0),h8e=$e().refine(e=>{const[t,n,s]=e.split(".");return LI.safeParse(t).success&&LI.safeParse(n).success&&LI.safeParse(s).success}),p8e=ct({id:$e().trim().min(1),type:$e().trim().min(1),label:$e(),isOpen:ss(),notes:$e(),isIntermediate:ss(),useCache:ss(),version:h8e,nodePack:$e().min(1).nullish(),inputs:Rv($e(),c8e),outputs:Rv($e(),u8e)}),f8e=ct({id:$e().trim().min(1),type:Ie("notes"),label:$e(),isOpen:ss(),notes:$e()}),oY=ct({x:Et(),y:Et()}).default({x:0,y:0}),yC=Et().gt(0).nullish(),m8e=Ds(["user","default"]),g8e=ct({id:$e().trim().min(1),type:Ie("invocation"),data:p8e,width:yC,height:yC,position:oY}),v8e=ct({id:$e().trim().min(1),type:Ie("notes"),data:f8e,width:yC,height:yC,position:oY}),y8e=gi([g8e,v8e]),aY=ct({id:$e().trim().min(1),source:$e().trim().min(1),target:$e().trim().min(1)}),b8e=aY.extend({type:Ie("default"),sourceHandle:$e().trim().min(1),targetHandle:$e().trim().min(1)}),x8e=aY.extend({type:Ie("collapsed")}),C8e=gi([b8e,x8e]),rY=ct({id:$e().min(1).optional(),name:$e(),author:$e(),description:$e(),version:$e(),contact:$e(),tags:$e(),notes:$e(),nodes:Cn(y8e),edges:Cn(C8e),exposedFields:Cn(l3e),meta:ct({category:m8e.default("user"),version:Ie("2.0.0")})}),w8e=ct({meta:ct({version:Qye})}),_8e=e=>{const t=ni.get();return e.nodes.forEach(n=>{if(n.type==="invocation"){Ku(n.data.inputs,o=>{const r=ON[o.type];if(!r)throw new GA(ye("nodes.unknownFieldType",{type:o.type}));o.type=r}),Ku(n.data.outputs,o=>{const r=ON[o.type];if(!r)throw new GA(ye("nodes.unknownFieldType",{type:o.type}));o.type=r});const s=t[n.data.type],i=s?s.nodePack:ye("common.unknown");n.data.nodePack=i,n.data.version||="1.0.0"}}),e.meta.version="2.0.0",e.meta.category="user",rY.parse(e)},S8e=e=>(e.meta.version="3.0.0",VD.parse(e)),k8e=e=>{if(!w8e.safeParse(e).success)throw new kH(ye("nodes.unableToGetWorkflowVersion"));let n=It(e);if(jf(n,"meta.version")==="1.0.0"){const i=Y6e.parse(n);n=_8e(i)}if(jf(n,"meta.version")==="2.0.0"){const i=rY.parse(n);n=S8e(i)}return VD.parse(n)},I8e=async e=>{const{workflow:t,templates:n,checkImageAccess:s,checkBoardAccess:i,checkModelAccess:o}=e,r=k8e(t),{nodes:l,edges:c}=r,d=[];for(const p of l){if(!RL(p))continue;const m=n[p.data.type];if(!m){const f=ye("nodes.missingTemplate",{node:p.id,type:p.data.type});d.push({message:f,data:ts(p)});continue}if(g1(p.data,m))try{const f=XX(p,m);p.data=f.data}catch{const f=ye("nodes.unableToUpdateNode",{node:p.id,type:p.data.type});d.push({message:f,data:ts({node:p,nodeTemplate:m})});continue}for(const f of Object.values(p.data.inputs)){const g=m.inputs[f.name];if(!g){const v=ye("nodes.missingFieldTemplate");d.push({message:v,data:ts({node:p,nodeTemplate:m,input:f})});continue}if(g.type.name==="ImageField"&&f.value&&IH(f)&&!await s(f.value.image_name)){const b=ye("nodes.imageAccessError",{image_name:f.value.image_name});d.push({message:b,data:ts({node:p,nodeTemplate:m,input:f})}),f.value=void 0}if(g.type.name==="ImageField"&&f.value&&Py(f)){for(const{image_name:v}of[...f.value])if(!await s(v)){const C=ye("nodes.imageAccessError",{image_name:v});d.push({message:C,data:ts({node:p,nodeTemplate:m,input:f})}),f.value=f.value.filter(y=>y.image_name!==v)}}if(g.type.name==="BoardField"&&f.value&&ND(f)){if(f.value==="none"||f.value==="auto")continue;if(!await i(f.value.board_id)){const b=ye("nodes.boardAccessError",{board_id:f.value.board_id});d.push({message:b,data:ts({node:p,nodeTemplate:m,input:f})}),f.value=void 0}}if(dM(g.type)&&f.value&&jH(f)&&!await o(f.value.key)){const b=ye("nodes.modelAccessError",{key:f.value.key});d.push({message:b,data:ts({node:p,nodeTemplate:m,input:f})}),f.value=void 0}}}const u=new Set;for(const p of c){const m=l.find(({id:C})=>C===p.source),f=l.find(({id:C})=>C===p.target),g=m?n[m.data.type]:void 0,v=f?n[f.data.type]:void 0,b=[];if(m||b.push(ye("nodes.sourceNodeDoesNotExist",{node:p.source})),g||b.push(ye("nodes.missingTemplate",{node:p.source,type:m?.data.type})),m&&g&&p.type==="default"&&!(p.sourceHandle in g.outputs)&&b.push(ye("nodes.sourceNodeFieldDoesNotExist",{node:p.source,field:p.sourceHandle})),f||b.push(ye("nodes.targetNodeDoesNotExist",{node:p.target})),v||b.push(ye("nodes.missingTemplate",{node:p.target,type:f?.data.type})),f&&v&&p.type==="default"&&!(p.targetHandle in v.inputs)&&b.push(ye("nodes.targetNodeFieldDoesNotExist",{node:p.target,field:p.targetHandle})),b.length){u.add(p.id);const C=p.type==="default"?`${p.source}.${p.sourceHandle}`:p.source,y=p.type==="default"?`${p.source}.${p.targetHandle}`:p.target;d.push({message:ye("nodes.deletedInvalidEdge",{source:C,target:y}),issues:b,data:p})}}if(r.edges=c.filter(({id:p})=>!u.has(p)),r.exposedFields.length>0&&EH(r.form)){r.form=AH();const p=[...r.exposedFields].reverse();for(const{nodeId:m,fieldName:f}of p){const g=l.find(({id:y})=>y===m);if(!g)continue;const v=n[g.data.type];if(!v)continue;const b=v.inputs[f];if(!b)continue;const C=uM(m,f,b.type);C.data.showDescription=!1,Jye({form:r.form,element:C,parentId:r.form.rootElementId,index:0})}}for(const p of Object.values(r.form.elements)){if(!Ly(p))continue;const{nodeId:m,fieldName:f}=p.data.fieldIdentifier;l.filter(RL).find(({id:b})=>b===m)?.data.inputs[f]||(delete r.form.elements[p.id],d.push({message:ye("nodes.deletedMissingNodeFieldFormElement",{nodeId:m,fieldName:f}),data:{nodeId:m,fieldName:f}}))}return{workflow:r,warnings:d}},j8e=async e=>{const{dispatch:t}=uu();try{return!!await t(go.endpoints.getModelConfig.initiate(e,{forceRefetch:!0,subscribe:!1})).unwrap()}catch{return!1}},E8e=async e=>{const{dispatch:t}=uu();try{return!!await t($r.endpoints.getImageDTO.initiate(e,{forceRefetch:!0,subscribe:!1})).unwrap()}catch{return!1}},A8e=async e=>{const{dispatch:t}=uu();try{return(await t(n2.endpoints.listAllBoards.initiate({include_archived:!0},{forceRefetch:!0,subscribe:!1})).unwrap()).some(i=>i.board_id===e)}catch{return!1}},t0=Ft("workflows").child({filePath:"features/workflowLibrary/hooks/useValidateAndLoadWorkflow.ts"}),dS=()=>{const e=Q();return h.useCallback(async(n,s)=>{try{const i=ni.get(),{workflow:o,warnings:r}=await I8e({workflow:n,templates:i,checkImageAccess:E8e,checkBoardAccess:A8e,checkModelAccess:j8e});return s!=="library"&&delete o.id,ga.set({}),e(e1e(o)),EH(o.form)?(e(Gl("edit")),Ne.focusPanel("workflows",Zn)):(e(Gl("view")),Ne.focusPanel("workflows",cs)),r.length?(pe({id:"WORKFLOW_LOADED",title:ye("toast.loadedWithWarnings"),status:"warning"}),r.forEach(({message:l,...c})=>{t0.warn(c,l)})):pe({id:"WORKFLOW_LOADED",title:ye("toast.workflowLoaded"),status:"success"}),GP.set(!0),o}catch(i){if(i instanceof kH)t0.error({error:cn(i)},i.message),pe({id:"UNABLE_TO_VALIDATE_WORKFLOW",title:ye("nodes.unableToValidateWorkflow"),status:"error",description:i.message});else if(i instanceof GA)t0.error({error:cn(i)},i.message),pe({id:"UNABLE_TO_VALIDATE_WORKFLOW",title:ye("nodes.unableToValidateWorkflow"),status:"error",description:i.message});else if(i instanceof t1e){const{message:o}=kK(i,{prefix:ye("nodes.workflowValidation")});t0.error({error:cn(i)},o),pe({id:"UNABLE_TO_VALIDATE_WORKFLOW",title:ye("nodes.unableToValidateWorkflow"),status:"error",description:o})}else t0.error({error:cn(i)},ye("nodes.unknownErrorValidatingWorkflow")),pe({id:"UNABLE_TO_VALIDATE_WORKFLOW",title:ye("nodes.unableToValidateWorkflow"),status:"error",description:ye("nodes.unknownErrorValidatingWorkflow")});return null}},[e])},lY=Qw("workflowLibrary/workflowDownloaded"),P8e=Qw("workflowLibrary/workflowLoadedFromFile"),T8e=Qw("workflowLibrary/newWorkflowSaved"),D8e=Qw("workflowLibrary/workflowUpdated"),M8e=()=>{const e=Q(),t=dS();return h.useCallback((s,i={})=>new Promise((o,r)=>{const l=new FileReader;l.onload=async()=>{const c=l.result,{onSuccess:d,onError:u,onCompleted:p}=i;try{const m=JSON.parse(c),f=await t(m,"file");if(!f){l.abort(),u?.();return}e(P8e()),d?.(f),o(f)}catch{u?.(),r()}finally{p?.()}},l.readAsText(s)}),[t,e])};var RI,NN;function S5(){if(NN)return RI;NN=1;var e="\0",t="\0",n="";class s{_isDirected=!0;_isMultigraph=!1;_isCompound=!1;_label;_defaultNodeLabelFn=()=>{};_defaultEdgeLabelFn=()=>{};_nodes={};_in={};_preds={};_out={};_sucs={};_edgeObjs={};_edgeLabels={};_nodeCount=0;_edgeCount=0;_parent;_children;constructor(u){u&&(this._isDirected=Object.hasOwn(u,"directed")?u.directed:!0,this._isMultigraph=Object.hasOwn(u,"multigraph")?u.multigraph:!1,this._isCompound=Object.hasOwn(u,"compound")?u.compound:!1),this._isCompound&&(this._parent={},this._children={},this._children[t]={})}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(u){return this._label=u,this}graph(){return this._label}setDefaultNodeLabel(u){return this._defaultNodeLabelFn=u,typeof u!="function"&&(this._defaultNodeLabelFn=()=>u),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var u=this;return this.nodes().filter(p=>Object.keys(u._in[p]).length===0)}sinks(){var u=this;return this.nodes().filter(p=>Object.keys(u._out[p]).length===0)}setNodes(u,p){var m=arguments,f=this;return u.forEach(function(g){m.length>1?f.setNode(g,p):f.setNode(g)}),this}setNode(u,p){return Object.hasOwn(this._nodes,u)?(arguments.length>1&&(this._nodes[u]=p),this):(this._nodes[u]=arguments.length>1?p:this._defaultNodeLabelFn(u),this._isCompound&&(this._parent[u]=t,this._children[u]={},this._children[t][u]=!0),this._in[u]={},this._preds[u]={},this._out[u]={},this._sucs[u]={},++this._nodeCount,this)}node(u){return this._nodes[u]}hasNode(u){return Object.hasOwn(this._nodes,u)}removeNode(u){var p=this;if(Object.hasOwn(this._nodes,u)){var m=f=>p.removeEdge(p._edgeObjs[f]);delete this._nodes[u],this._isCompound&&(this._removeFromParentsChildList(u),delete this._parent[u],this.children(u).forEach(function(f){p.setParent(f)}),delete this._children[u]),Object.keys(this._in[u]).forEach(m),delete this._in[u],delete this._preds[u],Object.keys(this._out[u]).forEach(m),delete this._out[u],delete this._sucs[u],--this._nodeCount}return this}setParent(u,p){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(p===void 0)p=t;else{p+="";for(var m=p;m!==void 0;m=this.parent(m))if(m===u)throw new Error("Setting "+p+" as parent of "+u+" would create a cycle");this.setNode(p)}return this.setNode(u),this._removeFromParentsChildList(u),this._parent[u]=p,this._children[p][u]=!0,this}_removeFromParentsChildList(u){delete this._children[this._parent[u]][u]}parent(u){if(this._isCompound){var p=this._parent[u];if(p!==t)return p}}children(u=t){if(this._isCompound){var p=this._children[u];if(p)return Object.keys(p)}else{if(u===t)return this.nodes();if(this.hasNode(u))return[]}}predecessors(u){var p=this._preds[u];if(p)return Object.keys(p)}successors(u){var p=this._sucs[u];if(p)return Object.keys(p)}neighbors(u){var p=this.predecessors(u);if(p){const f=new Set(p);for(var m of this.successors(u))f.add(m);return Array.from(f.values())}}isLeaf(u){var p;return this.isDirected()?p=this.successors(u):p=this.neighbors(u),p.length===0}filterNodes(u){var p=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});p.setGraph(this.graph());var m=this;Object.entries(this._nodes).forEach(function([v,b]){u(v)&&p.setNode(v,b)}),Object.values(this._edgeObjs).forEach(function(v){p.hasNode(v.v)&&p.hasNode(v.w)&&p.setEdge(v,m.edge(v))});var f={};function g(v){var b=m.parent(v);return b===void 0||p.hasNode(b)?(f[v]=b,b):b in f?f[b]:g(b)}return this._isCompound&&p.nodes().forEach(v=>p.setParent(v,g(v))),p}setDefaultEdgeLabel(u){return this._defaultEdgeLabelFn=u,typeof u!="function"&&(this._defaultEdgeLabelFn=()=>u),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(u,p){var m=this,f=arguments;return u.reduce(function(g,v){return f.length>1?m.setEdge(g,v,p):m.setEdge(g,v),v}),this}setEdge(){var u,p,m,f,g=!1,v=arguments[0];typeof v=="object"&&v!==null&&"v"in v?(u=v.v,p=v.w,m=v.name,arguments.length===2&&(f=arguments[1],g=!0)):(u=v,p=arguments[1],m=arguments[3],arguments.length>2&&(f=arguments[2],g=!0)),u=""+u,p=""+p,m!==void 0&&(m=""+m);var b=r(this._isDirected,u,p,m);if(Object.hasOwn(this._edgeLabels,b))return g&&(this._edgeLabels[b]=f),this;if(m!==void 0&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(u),this.setNode(p),this._edgeLabels[b]=g?f:this._defaultEdgeLabelFn(u,p,m);var C=l(this._isDirected,u,p,m);return u=C.v,p=C.w,Object.freeze(C),this._edgeObjs[b]=C,i(this._preds[p],u),i(this._sucs[u],p),this._in[p][b]=C,this._out[u][b]=C,this._edgeCount++,this}edge(u,p,m){var f=arguments.length===1?c(this._isDirected,arguments[0]):r(this._isDirected,u,p,m);return this._edgeLabels[f]}edgeAsObj(){const u=this.edge(...arguments);return typeof u!="object"?{label:u}:u}hasEdge(u,p,m){var f=arguments.length===1?c(this._isDirected,arguments[0]):r(this._isDirected,u,p,m);return Object.hasOwn(this._edgeLabels,f)}removeEdge(u,p,m){var f=arguments.length===1?c(this._isDirected,arguments[0]):r(this._isDirected,u,p,m),g=this._edgeObjs[f];return g&&(u=g.v,p=g.w,delete this._edgeLabels[f],delete this._edgeObjs[f],o(this._preds[p],u),o(this._sucs[u],p),delete this._in[p][f],delete this._out[u][f],this._edgeCount--),this}inEdges(u,p){var m=this._in[u];if(m){var f=Object.values(m);return p?f.filter(g=>g.v===p):f}}outEdges(u,p){var m=this._out[u];if(m){var f=Object.values(m);return p?f.filter(g=>g.w===p):f}}nodeEdges(u,p){var m=this.inEdges(u,p);if(m)return m.concat(this.outEdges(u,p))}}function i(d,u){d[u]?d[u]++:d[u]=1}function o(d,u){--d[u]||delete d[u]}function r(d,u,p,m){var f=""+u,g=""+p;if(!d&&f>g){var v=f;f=g,g=v}return f+n+g+n+(m===void 0?e:m)}function l(d,u,p,m){var f=""+u,g=""+p;if(!d&&f>g){var v=f;f=g,g=v}var b={v:f,w:g};return m&&(b.name=m),b}function c(d,u){return r(d,u.v,u.w,u.name)}return RI=s,RI}var OI,FN;function L8e(){return FN||(FN=1,OI="2.2.4"),OI}var NI,BN;function R8e(){return BN||(BN=1,NI={Graph:S5(),version:L8e()}),NI}var FI,zN;function O8e(){if(zN)return FI;zN=1;var e=S5();FI={write:t,read:i};function t(o){var r={options:{directed:o.isDirected(),multigraph:o.isMultigraph(),compound:o.isCompound()},nodes:n(o),edges:s(o)};return o.graph()!==void 0&&(r.value=structuredClone(o.graph())),r}function n(o){return o.nodes().map(function(r){var l=o.node(r),c=o.parent(r),d={v:r};return l!==void 0&&(d.value=l),c!==void 0&&(d.parent=c),d})}function s(o){return o.edges().map(function(r){var l=o.edge(r),c={v:r.v,w:r.w};return r.name!==void 0&&(c.name=r.name),l!==void 0&&(c.value=l),c})}function i(o){var r=new e(o.options).setGraph(o.value);return o.nodes.forEach(function(l){r.setNode(l.v,l.value),l.parent&&r.setParent(l.v,l.parent)}),o.edges.forEach(function(l){r.setEdge({v:l.v,w:l.w,name:l.name},l.value)}),r}return FI}var BI,VN;function N8e(){if(VN)return BI;VN=1,BI=e;function e(t){var n={},s=[],i;function o(r){Object.hasOwn(n,r)||(n[r]=!0,i.push(r),t.successors(r).forEach(o),t.predecessors(r).forEach(o))}return t.nodes().forEach(function(r){i=[],o(r),i.length&&s.push(i)}),s}return BI}var zI,$N;function cY(){if($N)return zI;$N=1;class e{_arr=[];_keyIndices={};size(){return this._arr.length}keys(){return this._arr.map(function(n){return n.key})}has(n){return Object.hasOwn(this._keyIndices,n)}priority(n){var s=this._keyIndices[n];if(s!==void 0)return this._arr[s].priority}min(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key}add(n,s){var i=this._keyIndices;if(n=String(n),!Object.hasOwn(i,n)){var o=this._arr,r=o.length;return i[n]=r,o.push({key:n,priority:s}),this._decrease(r),!0}return!1}removeMin(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key}decrease(n,s){var i=this._keyIndices[n];if(s>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[i].priority+" New: "+s);this._arr[i].priority=s,this._decrease(i)}_heapify(n){var s=this._arr,i=2*n,o=i+1,r=n;i<s.length&&(r=s[i].priority<s[r].priority?i:r,o<s.length&&(r=s[o].priority<s[r].priority?o:r),r!==n&&(this._swap(n,r),this._heapify(r)))}_decrease(n){for(var s=this._arr,i=s[n].priority,o;n!==0&&(o=n>>1,!(s[o].priority<i));)this._swap(n,o),n=o}_swap(n,s){var i=this._arr,o=this._keyIndices,r=i[n],l=i[s];i[n]=l,i[s]=r,o[l.key]=n,o[r.key]=s}}return zI=e,zI}var VI,GN;function dY(){if(GN)return VI;GN=1;var e=cY();VI=n;var t=()=>1;function n(i,o,r,l){return s(i,String(o),r||t,l||function(c){return i.outEdges(c)})}function s(i,o,r,l){var c={},d=new e,u,p,m=function(f){var g=f.v!==u?f.v:f.w,v=c[g],b=r(f),C=p.distance+b;if(b<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+f+" Weight: "+b);C<v.distance&&(v.distance=C,v.predecessor=u,d.decrease(g,C))};for(i.nodes().forEach(function(f){var g=f===o?0:Number.POSITIVE_INFINITY;c[f]={distance:g},d.add(f,g)});d.size()>0&&(u=d.removeMin(),p=c[u],p.distance!==Number.POSITIVE_INFINITY);)l(u).forEach(m);return c}return VI}var $I,HN;function F8e(){if(HN)return $I;HN=1;var e=dY();$I=t;function t(n,s,i){return n.nodes().reduce(function(o,r){return o[r]=e(n,r,s,i),o},{})}return $I}var GI,WN;function uY(){if(WN)return GI;WN=1,GI=e;function e(t){var n=0,s=[],i={},o=[];function r(l){var c=i[l]={onStack:!0,lowlink:n,index:n++};if(s.push(l),t.successors(l).forEach(function(p){Object.hasOwn(i,p)?i[p].onStack&&(c.lowlink=Math.min(c.lowlink,i[p].index)):(r(p),c.lowlink=Math.min(c.lowlink,i[p].lowlink))}),c.lowlink===c.index){var d=[],u;do u=s.pop(),i[u].onStack=!1,d.push(u);while(l!==u);o.push(d)}}return t.nodes().forEach(function(l){Object.hasOwn(i,l)||r(l)}),o}return GI}var HI,UN;function B8e(){if(UN)return HI;UN=1;var e=uY();HI=t;function t(n){return e(n).filter(function(s){return s.length>1||s.length===1&&n.hasEdge(s[0],s[0])})}return HI}var WI,qN;function z8e(){if(qN)return WI;qN=1,WI=t;var e=()=>1;function t(s,i,o){return n(s,i||e,o||function(r){return s.outEdges(r)})}function n(s,i,o){var r={},l=s.nodes();return l.forEach(function(c){r[c]={},r[c][c]={distance:0},l.forEach(function(d){c!==d&&(r[c][d]={distance:Number.POSITIVE_INFINITY})}),o(c).forEach(function(d){var u=d.v===c?d.w:d.v,p=i(d);r[c][u]={distance:p,predecessor:c}})}),l.forEach(function(c){var d=r[c];l.forEach(function(u){var p=r[u];l.forEach(function(m){var f=p[c],g=d[m],v=p[m],b=f.distance+g.distance;b<v.distance&&(v.distance=b,v.predecessor=g.predecessor)})})}),r}return WI}var UI,KN;function hY(){if(KN)return UI;KN=1;function e(n){var s={},i={},o=[];function r(l){if(Object.hasOwn(i,l))throw new t;Object.hasOwn(s,l)||(i[l]=!0,s[l]=!0,n.predecessors(l).forEach(r),delete i[l],o.push(l))}if(n.sinks().forEach(r),Object.keys(s).length!==n.nodeCount())throw new t;return o}class t extends Error{constructor(){super(...arguments)}}return UI=e,e.CycleException=t,UI}var qI,ZN;function V8e(){if(ZN)return qI;ZN=1;var e=hY();qI=t;function t(n){try{e(n)}catch(s){if(s instanceof e.CycleException)return!1;throw s}return!0}return qI}var KI,XN;function pY(){if(XN)return KI;XN=1,KI=e;function e(i,o,r){Array.isArray(o)||(o=[o]);var l=i.isDirected()?p=>i.successors(p):p=>i.neighbors(p),c=r==="post"?t:n,d=[],u={};return o.forEach(p=>{if(!i.hasNode(p))throw new Error("Graph does not have node: "+p);c(p,l,u,d)}),d}function t(i,o,r,l){for(var c=[[i,!1]];c.length>0;){var d=c.pop();d[1]?l.push(d[0]):Object.hasOwn(r,d[0])||(r[d[0]]=!0,c.push([d[0],!0]),s(o(d[0]),u=>c.push([u,!1])))}}function n(i,o,r,l){for(var c=[i];c.length>0;){var d=c.pop();Object.hasOwn(r,d)||(r[d]=!0,l.push(d),s(o(d),u=>c.push(u)))}}function s(i,o){for(var r=i.length;r--;)o(i[r],r,i);return i}return KI}var ZI,YN;function $8e(){if(YN)return ZI;YN=1;var e=pY();ZI=t;function t(n,s){return e(n,s,"post")}return ZI}var XI,QN;function G8e(){if(QN)return XI;QN=1;var e=pY();XI=t;function t(n,s){return e(n,s,"pre")}return XI}var YI,JN;function H8e(){if(JN)return YI;JN=1;var e=S5(),t=cY();YI=n;function n(s,i){var o=new e,r={},l=new t,c;function d(p){var m=p.v===c?p.w:p.v,f=l.priority(m);if(f!==void 0){var g=i(p);g<f&&(r[m]=c,l.decrease(m,g))}}if(s.nodeCount()===0)return o;s.nodes().forEach(function(p){l.add(p,Number.POSITIVE_INFINITY),o.setNode(p)}),l.decrease(s.nodes()[0],0);for(var u=!1;l.size()>0;){if(c=l.removeMin(),Object.hasOwn(r,c))o.setEdge(c,r[c]);else{if(u)throw new Error("Input graph is not connected: "+s);u=!0}s.nodeEdges(c).forEach(d)}return o}return YI}var QI,eF;function W8e(){return eF||(eF=1,QI={components:N8e(),dijkstra:dY(),dijkstraAll:F8e(),findCycles:B8e(),floydWarshall:z8e(),isAcyclic:V8e(),postorder:$8e(),preorder:G8e(),prim:H8e(),tarjan:uY(),topsort:hY()}),QI}var JI,tF;function cr(){if(tF)return JI;tF=1;var e=R8e();return JI={Graph:e.Graph,json:O8e(),alg:W8e(),version:e.version},JI}var ej,nF;function U8e(){if(nF)return ej;nF=1;class e{constructor(){let i={};i._next=i._prev=i,this._sentinel=i}dequeue(){let i=this._sentinel,o=i._prev;if(o!==i)return t(o),o}enqueue(i){let o=this._sentinel;i._prev&&i._next&&t(i),i._next=o._next,o._next._prev=i,o._next=i,i._prev=o}toString(){let i=[],o=this._sentinel,r=o._prev;for(;r!==o;)i.push(JSON.stringify(r,n)),r=r._prev;return"["+i.join(", ")+"]"}}function t(s){s._prev._next=s._next,s._next._prev=s._prev,delete s._next,delete s._prev}function n(s,i){if(s!=="_next"&&s!=="_prev")return i}return ej=e,ej}var tj,sF;function q8e(){if(sF)return tj;sF=1;let e=cr().Graph,t=U8e();tj=s;let n=()=>1;function s(d,u){if(d.nodeCount()<=1)return[];let p=r(d,u||n);return i(p.graph,p.buckets,p.zeroIdx).flatMap(f=>d.outEdges(f.v,f.w))}function i(d,u,p){let m=[],f=u[u.length-1],g=u[0],v;for(;d.nodeCount();){for(;v=g.dequeue();)o(d,u,p,v);for(;v=f.dequeue();)o(d,u,p,v);if(d.nodeCount()){for(let b=u.length-2;b>0;--b)if(v=u[b].dequeue(),v){m=m.concat(o(d,u,p,v,!0));break}}}return m}function o(d,u,p,m,f){let g=f?[]:void 0;return d.inEdges(m.v).forEach(v=>{let b=d.edge(v),C=d.node(v.v);f&&g.push({v:v.v,w:v.w}),C.out-=b,l(u,p,C)}),d.outEdges(m.v).forEach(v=>{let b=d.edge(v),C=v.w,y=d.node(C);y.in-=b,l(u,p,y)}),d.removeNode(m.v),g}function r(d,u){let p=new e,m=0,f=0;d.nodes().forEach(b=>{p.setNode(b,{v:b,in:0,out:0})}),d.edges().forEach(b=>{let C=p.edge(b.v,b.w)||0,y=u(b),x=C+y;p.setEdge(b.v,b.w,x),f=Math.max(f,p.node(b.v).out+=y),m=Math.max(m,p.node(b.w).in+=y)});let g=c(f+m+3).map(()=>new t),v=m+1;return p.nodes().forEach(b=>{l(g,v,p.node(b))}),{graph:p,buckets:g,zeroIdx:v}}function l(d,u,p){p.out?p.in?d[p.out-p.in+u].enqueue(p):d[d.length-1].enqueue(p):d[0].enqueue(p)}function c(d){const u=[];for(let p=0;p<d;p++)u.push(p);return u}return tj}var nj,iF;function $s(){if(iF)return nj;iF=1;let e=cr().Graph;nj={addBorderNode:u,addDummyNode:t,applyWithChunking:f,asNonCompoundGraph:s,buildLayerMatrix:l,intersectRect:r,mapValues:S,maxRank:g,normalizeRanks:c,notime:C,partition:v,pick:_,predecessorWeights:o,range:w,removeEmptyRanks:d,simplify:n,successorWeights:i,time:b,uniqueId:x,zipObject:I};function t(k,E,j,P){for(var D=P;k.hasNode(D);)D=x(P);return j.dummy=E,k.setNode(D,j),D}function n(k){let E=new e().setGraph(k.graph());return k.nodes().forEach(j=>E.setNode(j,k.node(j))),k.edges().forEach(j=>{let P=E.edge(j.v,j.w)||{weight:0,minlen:1},D=k.edge(j);E.setEdge(j.v,j.w,{weight:P.weight+D.weight,minlen:Math.max(P.minlen,D.minlen)})}),E}function s(k){let E=new e({multigraph:k.isMultigraph()}).setGraph(k.graph());return k.nodes().forEach(j=>{k.children(j).length||E.setNode(j,k.node(j))}),k.edges().forEach(j=>{E.setEdge(j,k.edge(j))}),E}function i(k){let E=k.nodes().map(j=>{let P={};return k.outEdges(j).forEach(D=>{P[D.w]=(P[D.w]||0)+k.edge(D).weight}),P});return I(k.nodes(),E)}function o(k){let E=k.nodes().map(j=>{let P={};return k.inEdges(j).forEach(D=>{P[D.v]=(P[D.v]||0)+k.edge(D).weight}),P});return I(k.nodes(),E)}function r(k,E){let j=k.x,P=k.y,D=E.x-j,O=E.y-P,N=k.width/2,F=k.height/2;if(!D&&!O)throw new Error("Not possible to find intersection inside of the rectangle");let X,L;return Math.abs(O)*N>Math.abs(D)*F?(O<0&&(F=-F),X=F*D/O,L=F):(D<0&&(N=-N),X=N,L=N*O/D),{x:j+X,y:P+L}}function l(k){let E=w(g(k)+1).map(()=>[]);return k.nodes().forEach(j=>{let P=k.node(j),D=P.rank;D!==void 0&&(E[D][P.order]=j)}),E}function c(k){let E=k.nodes().map(P=>{let D=k.node(P).rank;return D===void 0?Number.MAX_VALUE:D}),j=f(Math.min,E);k.nodes().forEach(P=>{let D=k.node(P);Object.hasOwn(D,"rank")&&(D.rank-=j)})}function d(k){let E=k.nodes().map(N=>k.node(N).rank),j=f(Math.min,E),P=[];k.nodes().forEach(N=>{let F=k.node(N).rank-j;P[F]||(P[F]=[]),P[F].push(N)});let D=0,O=k.graph().nodeRankFactor;Array.from(P).forEach((N,F)=>{N===void 0&&F%O!==0?--D:N!==void 0&&D&&N.forEach(X=>k.node(X).rank+=D)})}function u(k,E,j,P){let D={width:0,height:0};return arguments.length>=4&&(D.rank=j,D.order=P),t(k,"border",D,E)}function p(k,E=m){const j=[];for(let P=0;P<k.length;P+=E){const D=k.slice(P,P+E);j.push(D)}return j}const m=65535;function f(k,E){if(E.length>m){const j=p(E);return k.apply(null,j.map(P=>k.apply(null,P)))}else return k.apply(null,E)}function g(k){const j=k.nodes().map(P=>{let D=k.node(P).rank;return D===void 0?Number.MIN_VALUE:D});return f(Math.max,j)}function v(k,E){let j={lhs:[],rhs:[]};return k.forEach(P=>{E(P)?j.lhs.push(P):j.rhs.push(P)}),j}function b(k,E){let j=Date.now();try{return E()}finally{console.log(k+" time: "+(Date.now()-j)+"ms")}}function C(k,E){return E()}let y=0;function x(k){var E=++y;return k+(""+E)}function w(k,E,j=1){E==null&&(E=k,k=0);let P=O=>O<E;j<0&&(P=O=>E<O);const D=[];for(let O=k;P(O);O+=j)D.push(O);return D}function _(k,E){const j={};for(const P of E)k[P]!==void 0&&(j[P]=k[P]);return j}function S(k,E){let j=E;return typeof E=="string"&&(j=P=>P[E]),Object.entries(k).reduce((P,[D,O])=>(P[D]=j(O,D),P),{})}function I(k,E){return k.reduce((j,P,D)=>(j[P]=E[D],j),{})}return nj}var sj,oF;function K8e(){if(oF)return sj;oF=1;let e=q8e(),t=$s().uniqueId;sj={run:n,undo:i};function n(o){(o.graph().acyclicer==="greedy"?e(o,l(o)):s(o)).forEach(c=>{let d=o.edge(c);o.removeEdge(c),d.forwardName=c.name,d.reversed=!0,o.setEdge(c.w,c.v,d,t("rev"))});function l(c){return d=>c.edge(d).weight}}function s(o){let r=[],l={},c={};function d(u){Object.hasOwn(c,u)||(c[u]=!0,l[u]=!0,o.outEdges(u).forEach(p=>{Object.hasOwn(l,p.w)?r.push(p):d(p.w)}),delete l[u])}return o.nodes().forEach(d),r}function i(o){o.edges().forEach(r=>{let l=o.edge(r);if(l.reversed){o.removeEdge(r);let c=l.forwardName;delete l.reversed,delete l.forwardName,o.setEdge(r.w,r.v,l,c)}})}return sj}var ij,aF;function Z8e(){if(aF)return ij;aF=1;let e=$s();ij={run:t,undo:s};function t(i){i.graph().dummyChains=[],i.edges().forEach(o=>n(i,o))}function n(i,o){let r=o.v,l=i.node(r).rank,c=o.w,d=i.node(c).rank,u=o.name,p=i.edge(o),m=p.labelRank;if(d===l+1)return;i.removeEdge(o);let f,g,v;for(v=0,++l;l<d;++v,++l)p.points=[],g={width:0,height:0,edgeLabel:p,edgeObj:o,rank:l},f=e.addDummyNode(i,"edge",g,"_d"),l===m&&(g.width=p.width,g.height=p.height,g.dummy="edge-label",g.labelpos=p.labelpos),i.setEdge(r,f,{weight:p.weight},u),v===0&&i.graph().dummyChains.push(f),r=f;i.setEdge(r,c,{weight:p.weight},u)}function s(i){i.graph().dummyChains.forEach(o=>{let r=i.node(o),l=r.edgeLabel,c;for(i.setEdge(r.edgeObj,l);r.dummy;)c=i.successors(o)[0],i.removeNode(o),l.points.push({x:r.x,y:r.y}),r.dummy==="edge-label"&&(l.x=r.x,l.y=r.y,l.width=r.width,l.height=r.height),o=c,r=i.node(o)})}return ij}var oj,rF;function bC(){if(rF)return oj;rF=1;const{applyWithChunking:e}=$s();oj={longestPath:t,slack:n};function t(s){var i={};function o(r){var l=s.node(r);if(Object.hasOwn(i,r))return l.rank;i[r]=!0;let c=s.outEdges(r).map(u=>u==null?Number.POSITIVE_INFINITY:o(u.w)-s.edge(u).minlen);var d=e(Math.min,c);return d===Number.POSITIVE_INFINITY&&(d=0),l.rank=d}s.sources().forEach(o)}function n(s,i){return s.node(i.w).rank-s.node(i.v).rank-s.edge(i).minlen}return oj}var aj,lF;function fY(){if(lF)return aj;lF=1;var e=cr().Graph,t=bC().slack;aj=n;function n(r){var l=new e({directed:!1}),c=r.nodes()[0],d=r.nodeCount();l.setNode(c,{});for(var u,p;s(l,r)<d;)u=i(l,r),p=l.hasNode(u.v)?t(r,u):-t(r,u),o(l,r,p);return l}function s(r,l){function c(d){l.nodeEdges(d).forEach(u=>{var p=u.v,m=d===p?u.w:p;!r.hasNode(m)&&!t(l,u)&&(r.setNode(m,{}),r.setEdge(d,m,{}),c(m))})}return r.nodes().forEach(c),r.nodeCount()}function i(r,l){return l.edges().reduce((d,u)=>{let p=Number.POSITIVE_INFINITY;return r.hasNode(u.v)!==r.hasNode(u.w)&&(p=t(l,u)),p<d[0]?[p,u]:d},[Number.POSITIVE_INFINITY,null])[1]}function o(r,l,c){r.nodes().forEach(d=>l.node(d).rank+=c)}return aj}var rj,cF;function X8e(){if(cF)return rj;cF=1;var e=fY(),t=bC().slack,n=bC().longestPath,s=cr().alg.preorder,i=cr().alg.postorder,o=$s().simplify;rj=r,r.initLowLimValues=u,r.initCutValues=l,r.calcCutValue=d,r.leaveEdge=m,r.enterEdge=f,r.exchangeEdges=g;function r(y){y=o(y),n(y);var x=e(y);u(x),l(x,y);for(var w,_;w=m(x);)_=f(x,y,w),g(x,y,w,_)}function l(y,x){var w=i(y,y.nodes());w=w.slice(0,w.length-1),w.forEach(_=>c(y,x,_))}function c(y,x,w){var _=y.node(w),S=_.parent;y.edge(w,S).cutvalue=d(y,x,w)}function d(y,x,w){var _=y.node(w),S=_.parent,I=!0,k=x.edge(w,S),E=0;return k||(I=!1,k=x.edge(S,w)),E=k.weight,x.nodeEdges(w).forEach(j=>{var P=j.v===w,D=P?j.w:j.v;if(D!==S){var O=P===I,N=x.edge(j).weight;if(E+=O?N:-N,b(y,w,D)){var F=y.edge(w,D).cutvalue;E+=O?-F:F}}}),E}function u(y,x){arguments.length<2&&(x=y.nodes()[0]),p(y,{},1,x)}function p(y,x,w,_,S){var I=w,k=y.node(_);return x[_]=!0,y.neighbors(_).forEach(E=>{Object.hasOwn(x,E)||(w=p(y,x,w,E,_))}),k.low=I,k.lim=w++,S?k.parent=S:delete k.parent,w}function m(y){return y.edges().find(x=>y.edge(x).cutvalue<0)}function f(y,x,w){var _=w.v,S=w.w;x.hasEdge(_,S)||(_=w.w,S=w.v);var I=y.node(_),k=y.node(S),E=I,j=!1;I.lim>k.lim&&(E=k,j=!0);var P=x.edges().filter(D=>j===C(y,y.node(D.v),E)&&j!==C(y,y.node(D.w),E));return P.reduce((D,O)=>t(x,O)<t(x,D)?O:D)}function g(y,x,w,_){var S=w.v,I=w.w;y.removeEdge(S,I),y.setEdge(_.v,_.w,{}),u(y),l(y,x),v(y,x)}function v(y,x){var w=y.nodes().find(S=>!x.node(S).parent),_=s(y,w);_=_.slice(1),_.forEach(S=>{var I=y.node(S).parent,k=x.edge(S,I),E=!1;k||(k=x.edge(I,S),E=!0),x.node(S).rank=x.node(I).rank+(E?k.minlen:-k.minlen)})}function b(y,x,w){return y.hasEdge(x,w)}function C(y,x,w){return w.low<=x.lim&&x.lim<=w.lim}return rj}var lj,dF;function Y8e(){if(dF)return lj;dF=1;var e=bC(),t=e.longestPath,n=fY(),s=X8e();lj=i;function i(c){var d=c.graph().ranker;if(d instanceof Function)return d(c);switch(c.graph().ranker){case"network-simplex":l(c);break;case"tight-tree":r(c);break;case"longest-path":o(c);break;case"none":break;default:l(c)}}var o=t;function r(c){t(c),n(c)}function l(c){s(c)}return lj}var cj,uF;function Q8e(){if(uF)return cj;uF=1,cj=e;function e(s){let i=n(s);s.graph().dummyChains.forEach(o=>{let r=s.node(o),l=r.edgeObj,c=t(s,i,l.v,l.w),d=c.path,u=c.lca,p=0,m=d[p],f=!0;for(;o!==l.w;){if(r=s.node(o),f){for(;(m=d[p])!==u&&s.node(m).maxRank<r.rank;)p++;m===u&&(f=!1)}if(!f){for(;p<d.length-1&&s.node(m=d[p+1]).minRank<=r.rank;)p++;m=d[p]}s.setParent(o,m),o=s.successors(o)[0]}})}function t(s,i,o,r){let l=[],c=[],d=Math.min(i[o].low,i[r].low),u=Math.max(i[o].lim,i[r].lim),p,m;p=o;do p=s.parent(p),l.push(p);while(p&&(i[p].low>d||u>i[p].lim));for(m=p,p=r;(p=s.parent(p))!==m;)c.push(p);return{path:l.concat(c.reverse()),lca:m}}function n(s){let i={},o=0;function r(l){let c=o;s.children(l).forEach(r),i[l]={low:c,lim:o++}}return s.children().forEach(r),i}return cj}var dj,hF;function J8e(){if(hF)return dj;hF=1;let e=$s();dj={run:t,cleanup:o};function t(r){let l=e.addDummyNode(r,"root",{},"_root"),c=s(r),d=Object.values(c),u=e.applyWithChunking(Math.max,d)-1,p=2*u+1;r.graph().nestingRoot=l,r.edges().forEach(f=>r.edge(f).minlen*=p);let m=i(r)+1;r.children().forEach(f=>n(r,l,p,m,u,c,f)),r.graph().nodeRankFactor=p}function n(r,l,c,d,u,p,m){let f=r.children(m);if(!f.length){m!==l&&r.setEdge(l,m,{weight:0,minlen:c});return}let g=e.addBorderNode(r,"_bt"),v=e.addBorderNode(r,"_bb"),b=r.node(m);r.setParent(g,m),b.borderTop=g,r.setParent(v,m),b.borderBottom=v,f.forEach(C=>{n(r,l,c,d,u,p,C);let y=r.node(C),x=y.borderTop?y.borderTop:C,w=y.borderBottom?y.borderBottom:C,_=y.borderTop?d:2*d,S=x!==w?1:u-p[m]+1;r.setEdge(g,x,{weight:_,minlen:S,nestingEdge:!0}),r.setEdge(w,v,{weight:_,minlen:S,nestingEdge:!0})}),r.parent(m)||r.setEdge(l,g,{weight:0,minlen:u+p[m]})}function s(r){var l={};function c(d,u){var p=r.children(d);p&&p.length&&p.forEach(m=>c(m,u+1)),l[d]=u}return r.children().forEach(d=>c(d,1)),l}function i(r){return r.edges().reduce((l,c)=>l+r.edge(c).weight,0)}function o(r){var l=r.graph();r.removeNode(l.nestingRoot),delete l.nestingRoot,r.edges().forEach(c=>{var d=r.edge(c);d.nestingEdge&&r.removeEdge(c)})}return dj}var uj,pF;function eLe(){if(pF)return uj;pF=1;let e=$s();uj=t;function t(s){function i(o){let r=s.children(o),l=s.node(o);if(r.length&&r.forEach(i),Object.hasOwn(l,"minRank")){l.borderLeft=[],l.borderRight=[];for(let c=l.minRank,d=l.maxRank+1;c<d;++c)n(s,"borderLeft","_bl",o,l,c),n(s,"borderRight","_br",o,l,c)}}s.children().forEach(i)}function n(s,i,o,r,l,c){let d={width:0,height:0,rank:c,borderType:i},u=l[i][c-1],p=e.addDummyNode(s,"border",d,o);l[i][c]=p,s.setParent(p,r),u&&s.setEdge(u,p,{weight:1})}return uj}var hj,fF;function tLe(){if(fF)return hj;fF=1,hj={adjust:e,undo:t};function e(c){let d=c.graph().rankdir.toLowerCase();(d==="lr"||d==="rl")&&n(c)}function t(c){let d=c.graph().rankdir.toLowerCase();(d==="bt"||d==="rl")&&i(c),(d==="lr"||d==="rl")&&(r(c),n(c))}function n(c){c.nodes().forEach(d=>s(c.node(d))),c.edges().forEach(d=>s(c.edge(d)))}function s(c){let d=c.width;c.width=c.height,c.height=d}function i(c){c.nodes().forEach(d=>o(c.node(d))),c.edges().forEach(d=>{let u=c.edge(d);u.points.forEach(o),Object.hasOwn(u,"y")&&o(u)})}function o(c){c.y=-c.y}function r(c){c.nodes().forEach(d=>l(c.node(d))),c.edges().forEach(d=>{let u=c.edge(d);u.points.forEach(l),Object.hasOwn(u,"x")&&l(u)})}function l(c){let d=c.x;c.x=c.y,c.y=d}return hj}var pj,mF;function nLe(){if(mF)return pj;mF=1;let e=$s();pj=t;function t(n){let s={},i=n.nodes().filter(u=>!n.children(u).length),o=i.map(u=>n.node(u).rank),r=e.applyWithChunking(Math.max,o),l=e.range(r+1).map(()=>[]);function c(u){if(s[u])return;s[u]=!0;let p=n.node(u);l[p.rank].push(u),n.successors(u).forEach(c)}return i.sort((u,p)=>n.node(u).rank-n.node(p).rank).forEach(c),l}return pj}var fj,gF;function sLe(){if(gF)return fj;gF=1;let e=$s().zipObject;fj=t;function t(s,i){let o=0;for(let r=1;r<i.length;++r)o+=n(s,i[r-1],i[r]);return o}function n(s,i,o){let r=e(o,o.map((m,f)=>f)),l=i.flatMap(m=>s.outEdges(m).map(f=>({pos:r[f.w],weight:s.edge(f).weight})).sort((f,g)=>f.pos-g.pos)),c=1;for(;c<o.length;)c<<=1;let d=2*c-1;c-=1;let u=new Array(d).fill(0),p=0;return l.forEach(m=>{let f=m.pos+c;u[f]+=m.weight;let g=0;for(;f>0;)f%2&&(g+=u[f+1]),f=f-1>>1,u[f]+=m.weight;p+=m.weight*g}),p}return fj}var mj,vF;function iLe(){if(vF)return mj;vF=1,mj=e;function e(t,n=[]){return n.map(s=>{let i=t.inEdges(s);if(i.length){let o=i.reduce((r,l)=>{let c=t.edge(l),d=t.node(l.v);return{sum:r.sum+c.weight*d.order,weight:r.weight+c.weight}},{sum:0,weight:0});return{v:s,barycenter:o.sum/o.weight,weight:o.weight}}else return{v:s}})}return mj}var gj,yF;function oLe(){if(yF)return gj;yF=1;let e=$s();gj=t;function t(i,o){let r={};i.forEach((c,d)=>{let u=r[c.v]={indegree:0,in:[],out:[],vs:[c.v],i:d};c.barycenter!==void 0&&(u.barycenter=c.barycenter,u.weight=c.weight)}),o.edges().forEach(c=>{let d=r[c.v],u=r[c.w];d!==void 0&&u!==void 0&&(u.indegree++,d.out.push(r[c.w]))});let l=Object.values(r).filter(c=>!c.indegree);return n(l)}function n(i){let o=[];function r(c){return d=>{d.merged||(d.barycenter===void 0||c.barycenter===void 0||d.barycenter>=c.barycenter)&&s(c,d)}}function l(c){return d=>{d.in.push(c),--d.indegree===0&&i.push(d)}}for(;i.length;){let c=i.pop();o.push(c),c.in.reverse().forEach(r(c)),c.out.forEach(l(c))}return o.filter(c=>!c.merged).map(c=>e.pick(c,["vs","i","barycenter","weight"]))}function s(i,o){let r=0,l=0;i.weight&&(r+=i.barycenter*i.weight,l+=i.weight),o.weight&&(r+=o.barycenter*o.weight,l+=o.weight),i.vs=o.vs.concat(i.vs),i.barycenter=r/l,i.weight=l,i.i=Math.min(o.i,i.i),o.merged=!0}return gj}var vj,bF;function aLe(){if(bF)return vj;bF=1;let e=$s();vj=t;function t(i,o){let r=e.partition(i,g=>Object.hasOwn(g,"barycenter")),l=r.lhs,c=r.rhs.sort((g,v)=>v.i-g.i),d=[],u=0,p=0,m=0;l.sort(s(!!o)),m=n(d,c,m),l.forEach(g=>{m+=g.vs.length,d.push(g.vs),u+=g.barycenter*g.weight,p+=g.weight,m=n(d,c,m)});let f={vs:d.flat(!0)};return p&&(f.barycenter=u/p,f.weight=p),f}function n(i,o,r){let l;for(;o.length&&(l=o[o.length-1]).i<=r;)o.pop(),i.push(l.vs),r++;return r}function s(i){return(o,r)=>o.barycenter<r.barycenter?-1:o.barycenter>r.barycenter?1:i?r.i-o.i:o.i-r.i}return vj}var yj,xF;function rLe(){if(xF)return yj;xF=1;let e=iLe(),t=oLe(),n=aLe();yj=s;function s(r,l,c,d){let u=r.children(l),p=r.node(l),m=p?p.borderLeft:void 0,f=p?p.borderRight:void 0,g={};m&&(u=u.filter(y=>y!==m&&y!==f));let v=e(r,u);v.forEach(y=>{if(r.children(y.v).length){let x=s(r,y.v,c,d);g[y.v]=x,Object.hasOwn(x,"barycenter")&&o(y,x)}});let b=t(v,c);i(b,g);let C=n(b,d);if(m&&(C.vs=[m,C.vs,f].flat(!0),r.predecessors(m).length)){let y=r.node(r.predecessors(m)[0]),x=r.node(r.predecessors(f)[0]);Object.hasOwn(C,"barycenter")||(C.barycenter=0,C.weight=0),C.barycenter=(C.barycenter*C.weight+y.order+x.order)/(C.weight+2),C.weight+=2}return C}function i(r,l){r.forEach(c=>{c.vs=c.vs.flatMap(d=>l[d]?l[d].vs:d)})}function o(r,l){r.barycenter!==void 0?(r.barycenter=(r.barycenter*r.weight+l.barycenter*l.weight)/(r.weight+l.weight),r.weight+=l.weight):(r.barycenter=l.barycenter,r.weight=l.weight)}return yj}var bj,CF;function lLe(){if(CF)return bj;CF=1;let e=cr().Graph,t=$s();bj=n;function n(i,o,r){let l=s(i),c=new e({compound:!0}).setGraph({root:l}).setDefaultNodeLabel(d=>i.node(d));return i.nodes().forEach(d=>{let u=i.node(d),p=i.parent(d);(u.rank===o||u.minRank<=o&&o<=u.maxRank)&&(c.setNode(d),c.setParent(d,p||l),i[r](d).forEach(m=>{let f=m.v===d?m.w:m.v,g=c.edge(f,d),v=g!==void 0?g.weight:0;c.setEdge(f,d,{weight:i.edge(m).weight+v})}),Object.hasOwn(u,"minRank")&&c.setNode(d,{borderLeft:u.borderLeft[o],borderRight:u.borderRight[o]}))}),c}function s(i){for(var o;i.hasNode(o=t.uniqueId("_root")););return o}return bj}var xj,wF;function cLe(){if(wF)return xj;wF=1,xj=e;function e(t,n,s){let i={},o;s.forEach(r=>{let l=t.parent(r),c,d;for(;l;){if(c=t.parent(l),c?(d=i[c],i[c]=l):(d=o,o=l),d&&d!==l){n.setEdge(d,l);return}l=c}})}return xj}var Cj,_F;function dLe(){if(_F)return Cj;_F=1;let e=nLe(),t=sLe(),n=rLe(),s=lLe(),i=cLe(),o=cr().Graph,r=$s();Cj=l;function l(p,m){if(m&&typeof m.customOrder=="function"){m.customOrder(p,l);return}let f=r.maxRank(p),g=c(p,r.range(1,f+1),"inEdges"),v=c(p,r.range(f-1,-1,-1),"outEdges"),b=e(p);if(u(p,b),m&&m.disableOptimalOrderHeuristic)return;let C=Number.POSITIVE_INFINITY,y;for(let x=0,w=0;w<4;++x,++w){d(x%2?g:v,x%4>=2),b=r.buildLayerMatrix(p);let _=t(p,b);_<C&&(w=0,y=Object.assign({},b),C=_)}u(p,y)}function c(p,m,f){return m.map(function(g){return s(p,g,f)})}function d(p,m){let f=new o;p.forEach(function(g){let v=g.graph().root,b=n(g,v,f,m);b.vs.forEach((C,y)=>g.node(C).order=y),i(g,f,b.vs)})}function u(p,m){Object.values(m).forEach(f=>f.forEach((g,v)=>p.node(g).order=v))}return Cj}var wj,SF;function uLe(){if(SF)return wj;SF=1;let e=cr().Graph,t=$s();wj={positionX:f,findType1Conflicts:n,findType2Conflicts:s,addConflict:o,hasConflict:r,verticalAlignment:l,horizontalCompaction:c,alignCoordinates:p,findSmallestWidthAlignment:u,balance:m};function n(b,C){let y={};function x(w,_){let S=0,I=0,k=w.length,E=_[_.length-1];return _.forEach((j,P)=>{let D=i(b,j),O=D?b.node(D).order:k;(D||j===E)&&(_.slice(I,P+1).forEach(N=>{b.predecessors(N).forEach(F=>{let X=b.node(F),L=X.order;(L<S||O<L)&&!(X.dummy&&b.node(N).dummy)&&o(y,F,N)})}),I=P+1,S=O)}),_}return C.length&&C.reduce(x),y}function s(b,C){let y={};function x(_,S,I,k,E){let j;t.range(S,I).forEach(P=>{j=_[P],b.node(j).dummy&&b.predecessors(j).forEach(D=>{let O=b.node(D);O.dummy&&(O.order<k||O.order>E)&&o(y,D,j)})})}function w(_,S){let I=-1,k,E=0;return S.forEach((j,P)=>{if(b.node(j).dummy==="border"){let D=b.predecessors(j);D.length&&(k=b.node(D[0]).order,x(S,E,P,I,k),E=P,I=k)}x(S,E,S.length,k,_.length)}),S}return C.length&&C.reduce(w),y}function i(b,C){if(b.node(C).dummy)return b.predecessors(C).find(y=>b.node(y).dummy)}function o(b,C,y){if(C>y){let w=C;C=y,y=w}let x=b[C];x||(b[C]=x={}),x[y]=!0}function r(b,C,y){if(C>y){let x=C;C=y,y=x}return!!b[C]&&Object.hasOwn(b[C],y)}function l(b,C,y,x){let w={},_={},S={};return C.forEach(I=>{I.forEach((k,E)=>{w[k]=k,_[k]=k,S[k]=E})}),C.forEach(I=>{let k=-1;I.forEach(E=>{let j=x(E);if(j.length){j=j.sort((D,O)=>S[D]-S[O]);let P=(j.length-1)/2;for(let D=Math.floor(P),O=Math.ceil(P);D<=O;++D){let N=j[D];_[E]===E&&k<S[N]&&!r(y,E,N)&&(_[N]=E,_[E]=w[E]=w[N],k=S[N])}}})}),{root:w,align:_}}function c(b,C,y,x,w){let _={},S=d(b,C,y,w),I=w?"borderLeft":"borderRight";function k(P,D){let O=S.nodes(),N=O.pop(),F={};for(;N;)F[N]?P(N):(F[N]=!0,O.push(N),O=O.concat(D(N))),N=O.pop()}function E(P){_[P]=S.inEdges(P).reduce((D,O)=>Math.max(D,_[O.v]+S.edge(O)),0)}function j(P){let D=S.outEdges(P).reduce((N,F)=>Math.min(N,_[F.w]-S.edge(F)),Number.POSITIVE_INFINITY),O=b.node(P);D!==Number.POSITIVE_INFINITY&&O.borderType!==I&&(_[P]=Math.max(_[P],D))}return k(E,S.predecessors.bind(S)),k(j,S.successors.bind(S)),Object.keys(x).forEach(P=>_[P]=_[y[P]]),_}function d(b,C,y,x){let w=new e,_=b.graph(),S=g(_.nodesep,_.edgesep,x);return C.forEach(I=>{let k;I.forEach(E=>{let j=y[E];if(w.setNode(j),k){var P=y[k],D=w.edge(P,j);w.setEdge(P,j,Math.max(S(b,E,k),D||0))}k=E})}),w}function u(b,C){return Object.values(C).reduce((y,x)=>{let w=Number.NEGATIVE_INFINITY,_=Number.POSITIVE_INFINITY;Object.entries(x).forEach(([I,k])=>{let E=v(b,I)/2;w=Math.max(k+E,w),_=Math.min(k-E,_)});const S=w-_;return S<y[0]&&(y=[S,x]),y},[Number.POSITIVE_INFINITY,null])[1]}function p(b,C){let y=Object.values(C),x=t.applyWithChunking(Math.min,y),w=t.applyWithChunking(Math.max,y);["u","d"].forEach(_=>{["l","r"].forEach(S=>{let I=_+S,k=b[I];if(k===C)return;let E=Object.values(k),j=x-t.applyWithChunking(Math.min,E);S!=="l"&&(j=w-t.applyWithChunking(Math.max,E)),j&&(b[I]=t.mapValues(k,P=>P+j))})})}function m(b,C){return t.mapValues(b.ul,(y,x)=>{if(C)return b[C.toLowerCase()][x];{let w=Object.values(b).map(_=>_[x]).sort((_,S)=>_-S);return(w[1]+w[2])/2}})}function f(b){let C=t.buildLayerMatrix(b),y=Object.assign(n(b,C),s(b,C)),x={},w;["u","d"].forEach(S=>{w=S==="u"?C:Object.values(C).reverse(),["l","r"].forEach(I=>{I==="r"&&(w=w.map(P=>Object.values(P).reverse()));let k=(S==="u"?b.predecessors:b.successors).bind(b),E=l(b,w,y,k),j=c(b,w,E.root,E.align,I==="r");I==="r"&&(j=t.mapValues(j,P=>-P)),x[S+I]=j})});let _=u(b,x);return p(x,_),m(x,b.graph().align)}function g(b,C,y){return(x,w,_)=>{let S=x.node(w),I=x.node(_),k=0,E;if(k+=S.width/2,Object.hasOwn(S,"labelpos"))switch(S.labelpos.toLowerCase()){case"l":E=-S.width/2;break;case"r":E=S.width/2;break}if(E&&(k+=y?E:-E),E=0,k+=(S.dummy?C:b)/2,k+=(I.dummy?C:b)/2,k+=I.width/2,Object.hasOwn(I,"labelpos"))switch(I.labelpos.toLowerCase()){case"l":E=I.width/2;break;case"r":E=-I.width/2;break}return E&&(k+=y?E:-E),E=0,k}}function v(b,C){return b.node(C).width}return wj}var _j,kF;function hLe(){if(kF)return _j;kF=1;let e=$s(),t=uLe().positionX;_j=n;function n(i){i=e.asNonCompoundGraph(i),s(i),Object.entries(t(i)).forEach(([o,r])=>i.node(o).x=r)}function s(i){let o=e.buildLayerMatrix(i),r=i.graph().ranksep,l=0;o.forEach(c=>{const d=c.reduce((u,p)=>{const m=i.node(p).height;return u>m?u:m},0);c.forEach(u=>i.node(u).y=l+d/2),l+=d+r})}return _j}var Sj,IF;function pLe(){if(IF)return Sj;IF=1;let e=K8e(),t=Z8e(),n=Y8e(),s=$s().normalizeRanks,i=Q8e(),o=$s().removeEmptyRanks,r=J8e(),l=eLe(),c=tLe(),d=dLe(),u=hLe(),p=$s(),m=cr().Graph;Sj=f;function f(R,G){let H=G&&G.debugTiming?p.time:p.notime;H("layout",()=>{let $=H("  buildLayoutGraph",()=>k(R));H("  runLayout",()=>g($,H,G)),H("  updateInputGraph",()=>v(R,$))})}function g(R,G,H){G("    makeSpaceForEdgeLabels",()=>E(R)),G("    removeSelfEdges",()=>V(R)),G("    acyclic",()=>e.run(R)),G("    nestingGraph.run",()=>r.run(R)),G("    rank",()=>n(p.asNonCompoundGraph(R))),G("    injectEdgeLabelProxies",()=>j(R)),G("    removeEmptyRanks",()=>o(R)),G("    nestingGraph.cleanup",()=>r.cleanup(R)),G("    normalizeRanks",()=>s(R)),G("    assignRankMinMax",()=>P(R)),G("    removeEdgeLabelProxies",()=>D(R)),G("    normalize.run",()=>t.run(R)),G("    parentDummyChains",()=>i(R)),G("    addBorderSegments",()=>l(R)),G("    order",()=>d(R,H)),G("    insertSelfEdges",()=>K(R)),G("    adjustCoordinateSystem",()=>c.adjust(R)),G("    position",()=>u(R)),G("    positionSelfEdges",()=>U(R)),G("    removeBorderNodes",()=>L(R)),G("    normalize.undo",()=>t.undo(R)),G("    fixupEdgeLabelCoords",()=>F(R)),G("    undoCoordinateSystem",()=>c.undo(R)),G("    translateGraph",()=>O(R)),G("    assignNodeIntersects",()=>N(R)),G("    reversePoints",()=>X(R)),G("    acyclic.undo",()=>e.undo(R))}function v(R,G){R.nodes().forEach(H=>{let $=R.node(H),z=G.node(H);$&&($.x=z.x,$.y=z.y,$.rank=z.rank,G.children(H).length&&($.width=z.width,$.height=z.height))}),R.edges().forEach(H=>{let $=R.edge(H),z=G.edge(H);$.points=z.points,Object.hasOwn(z,"x")&&($.x=z.x,$.y=z.y)}),R.graph().width=G.graph().width,R.graph().height=G.graph().height}let b=["nodesep","edgesep","ranksep","marginx","marginy"],C={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},y=["acyclicer","ranker","rankdir","align"],x=["width","height","rank"],w={width:0,height:0},_=["minlen","weight","width","height","labeloffset"],S={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},I=["labelpos"];function k(R){let G=new m({multigraph:!0,compound:!0}),H=W(R.graph());return G.setGraph(Object.assign({},C,Z(H,b),p.pick(H,y))),R.nodes().forEach($=>{let z=W(R.node($));const B=Z(z,x);Object.keys(w).forEach(Y=>{B[Y]===void 0&&(B[Y]=w[Y])}),G.setNode($,B),G.setParent($,R.parent($))}),R.edges().forEach($=>{let z=W(R.edge($));G.setEdge($,Object.assign({},S,Z(z,_),p.pick(z,I)))}),G}function E(R){let G=R.graph();G.ranksep/=2,R.edges().forEach(H=>{let $=R.edge(H);$.minlen*=2,$.labelpos.toLowerCase()!=="c"&&(G.rankdir==="TB"||G.rankdir==="BT"?$.width+=$.labeloffset:$.height+=$.labeloffset)})}function j(R){R.edges().forEach(G=>{let H=R.edge(G);if(H.width&&H.height){let $=R.node(G.v),B={rank:(R.node(G.w).rank-$.rank)/2+$.rank,e:G};p.addDummyNode(R,"edge-proxy",B,"_ep")}})}function P(R){let G=0;R.nodes().forEach(H=>{let $=R.node(H);$.borderTop&&($.minRank=R.node($.borderTop).rank,$.maxRank=R.node($.borderBottom).rank,G=Math.max(G,$.maxRank))}),R.graph().maxRank=G}function D(R){R.nodes().forEach(G=>{let H=R.node(G);H.dummy==="edge-proxy"&&(R.edge(H.e).labelRank=H.rank,R.removeNode(G))})}function O(R){let G=Number.POSITIVE_INFINITY,H=0,$=Number.POSITIVE_INFINITY,z=0,B=R.graph(),Y=B.marginx||0,ie=B.marginy||0;function ge(xe){let we=xe.x,je=xe.y,Re=xe.width,Ct=xe.height;G=Math.min(G,we-Re/2),H=Math.max(H,we+Re/2),$=Math.min($,je-Ct/2),z=Math.max(z,je+Ct/2)}R.nodes().forEach(xe=>ge(R.node(xe))),R.edges().forEach(xe=>{let we=R.edge(xe);Object.hasOwn(we,"x")&&ge(we)}),G-=Y,$-=ie,R.nodes().forEach(xe=>{let we=R.node(xe);we.x-=G,we.y-=$}),R.edges().forEach(xe=>{let we=R.edge(xe);we.points.forEach(je=>{je.x-=G,je.y-=$}),Object.hasOwn(we,"x")&&(we.x-=G),Object.hasOwn(we,"y")&&(we.y-=$)}),B.width=H-G+Y,B.height=z-$+ie}function N(R){R.edges().forEach(G=>{let H=R.edge(G),$=R.node(G.v),z=R.node(G.w),B,Y;H.points?(B=H.points[0],Y=H.points[H.points.length-1]):(H.points=[],B=z,Y=$),H.points.unshift(p.intersectRect($,B)),H.points.push(p.intersectRect(z,Y))})}function F(R){R.edges().forEach(G=>{let H=R.edge(G);if(Object.hasOwn(H,"x"))switch((H.labelpos==="l"||H.labelpos==="r")&&(H.width-=H.labeloffset),H.labelpos){case"l":H.x-=H.width/2+H.labeloffset;break;case"r":H.x+=H.width/2+H.labeloffset;break}})}function X(R){R.edges().forEach(G=>{let H=R.edge(G);H.reversed&&H.points.reverse()})}function L(R){R.nodes().forEach(G=>{if(R.children(G).length){let H=R.node(G),$=R.node(H.borderTop),z=R.node(H.borderBottom),B=R.node(H.borderLeft[H.borderLeft.length-1]),Y=R.node(H.borderRight[H.borderRight.length-1]);H.width=Math.abs(Y.x-B.x),H.height=Math.abs(z.y-$.y),H.x=B.x+H.width/2,H.y=$.y+H.height/2}}),R.nodes().forEach(G=>{R.node(G).dummy==="border"&&R.removeNode(G)})}function V(R){R.edges().forEach(G=>{if(G.v===G.w){var H=R.node(G.v);H.selfEdges||(H.selfEdges=[]),H.selfEdges.push({e:G,label:R.edge(G)}),R.removeEdge(G)}})}function K(R){var G=p.buildLayerMatrix(R);G.forEach(H=>{var $=0;H.forEach((z,B)=>{var Y=R.node(z);Y.order=B+$,(Y.selfEdges||[]).forEach(ie=>{p.addDummyNode(R,"selfedge",{width:ie.label.width,height:ie.label.height,rank:Y.rank,order:B+ ++$,e:ie.e,label:ie.label},"_se")}),delete Y.selfEdges})})}function U(R){R.nodes().forEach(G=>{var H=R.node(G);if(H.dummy==="selfedge"){var $=R.node(H.e.v),z=$.x+$.width/2,B=$.y,Y=H.x-z,ie=$.height/2;R.setEdge(H.e,H.label),R.removeNode(G),H.label.points=[{x:z+2*Y/3,y:B-ie},{x:z+5*Y/6,y:B-ie},{x:z+Y,y:B},{x:z+5*Y/6,y:B+ie},{x:z+2*Y/3,y:B+ie}],H.label.x=H.x,H.label.y=H.y}})}function Z(R,G){return p.mapValues(p.pick(R,G),Number)}function W(R){var G={};return R&&Object.entries(R).forEach(([H,$])=>{typeof H=="string"&&(H=H.toLowerCase()),G[H]=$}),G}return Sj}var kj,jF;function fLe(){if(jF)return kj;jF=1;let e=$s(),t=cr().Graph;kj={debugOrdering:n};function n(s){let i=e.buildLayerMatrix(s),o=new t({compound:!0,multigraph:!0}).setGraph({});return s.nodes().forEach(r=>{o.setNode(r,{label:r}),o.setParent(r,"layer"+s.node(r).rank)}),s.edges().forEach(r=>o.setEdge(r.v,r.w,{},r.name)),i.forEach((r,l)=>{let c="layer"+l;o.setNode(c,{rank:"same"}),r.reduce((d,u)=>(o.setEdge(d,u,{style:"invis"}),u))}),o}return kj}var Ij,EF;function mLe(){return EF||(EF=1,Ij="1.1.5"),Ij}var jj,AF;function gLe(){return AF||(AF=1,jj={graphlib:cr(),layout:pLe(),debug:fLe(),util:{time:$s().time,notime:$s().notime},version:mLe()}),jj}var xC=gLe();const PF=Ft("workflows").child({filePath:"features/nodes/util/workflow/graphToWorkflow.ts"}),mY=(e,t=!0)=>{const n=ni.get(),s={name:"",author:"",contact:"",description:"",meta:{category:"user",version:"3.0.0"},notes:"",tags:"",version:"",exposedFields:[],edges:[],nodes:[],form:AH()};if(Ku(e.nodes,i=>{const o=n[i.type];if(!o){PF.warn(`Node type ${i.type} not found in templates`);return}const r={};Ku(i,(l,c)=>{if(c==="id"||c==="type"||c==="is_intermediate"||c==="use_cache")return;const d=o.inputs[c];if(!d){PF.warn(`Input ${c} not found in template for node type ${i.type}`);return}const u=KX(i.id,d);u.value=l,r[c]=u}),s.nodes.push({id:i.id,type:"invocation",position:{x:0,y:0},data:{id:i.id,type:i.type,version:o.version,label:"",notes:"",isOpen:!0,isIntermediate:i.is_intermediate??!1,useCache:i.use_cache??!0,nodePack:o.nodePack,inputs:r}})}),Ku(e.edges,i=>{s.edges.push({id:Kd(),type:"default",source:i.source.node_id,sourceHandle:i.source.field,target:i.destination.node_id,targetHandle:i.destination.field})}),t){const i=new xC.graphlib.Graph;i.setGraph({rankdir:"TB",align:"UL"}),i.setDefaultEdgeLabel(()=>({})),Ku(e.nodes,o=>{const r=Qd,l=Qd*1.5;i.setNode(o.id,{width:r,height:l})}),e.edges.forEach(o=>{i.setEdge(o.source.node_id,o.destination.node_id)}),xC.layout(i),s.nodes.forEach(o=>{const r=i.node(o.id);o.position={x:r.x-r.width/2,y:r.y-r.height/2}})}else{let i=0,o=0;s.nodes.forEach(r=>{r.position={x:i,y:o},i=i+50,o=o+50})}return s},vLe=()=>{const[e]=n1e(),t=dS();return h.useCallback(async(s,i={})=>{const{onSuccess:o,onError:r,onCompleted:l}=i;try{const{workflow:c,graph:d}=await e(s).unwrap(),u=c?JSON.parse(c):d?mY(JSON.parse(d),!0):null;ae(u!==null,"No workflow or graph provided");const p=await t(u,"image");if(!p){r?.();return}o?.(p)}catch{pe({id:"PROBLEM_RETRIEVING_WORKFLOW",title:ye("toast.problemRetrievingWorkflow"),status:"error"}),r?.()}finally{l?.()}},[e,t])},yLe=()=>{const e=tm(),{t}=T(),n=dS(),[s]=WZ(),[i]=HZ();return h.useCallback(async(r,l={})=>{const{onSuccess:c,onError:d,onCompleted:u}=l;try{const p=await s(r).unwrap(),m=await n(p.workflow,"library");if(!m){d?.();return}i({workflow_id:r}),c?.(m)}catch{e({id:`AUTH_ERROR_TOAST_${d1.endpoints.getWorkflow.name}`,title:t("toast.problemRetrievingWorkflow"),status:"error"}),d?.()}finally{u?.()}},[s,n,i,e,t])},bLe=()=>{const e=dS();return h.useCallback(async(n,s={})=>{const{onSuccess:i,onError:o,onCompleted:r}=s;try{const l=await e(n,"object");if(!l){o?.();return}i?.(l)}finally{r?.()}},[e])},Kv=De(null),gY=()=>Kv.set(null),vY=()=>{const e=Pm(),t=yLe(),n=M8e(),s=vLe(),i=bLe();return h.useCallback(async()=>{const r=Kv.get();if(!r)return;const{type:l,data:c,onSuccess:d,onError:u,onCompleted:p}=r,m={onSuccess:d,onError:u,onCompleted:p};l==="object"?await i(c,m):l==="file"?await n(c,m):l==="library"?await t(c,m):l==="image"&&await s(c,m),gY(),e.close()},[n,s,t,i,e])},ed=()=>{const e=_m(),t=vY();return h.useCallback(s=>{e?Kv.set({...s,isOpen:!0}):(Kv.set({...s,isOpen:!1}),t())},[e,t])},yY=h.memo(()=>{mn("LoadWorkflowConfirmationAlertDialog");const{t:e}=T(),t=le(Kv),n=vY();return a.jsx(Ko,{isOpen:!!t?.isOpen,onClose:gY,title:e("nodes.loadWorkflow"),acceptCallback:n,useInert:!1,acceptButtonText:e("common.load"),children:a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsx(q,{children:e("nodes.loadWorkflowDesc")}),a.jsx(q,{variant:"subtext",children:e("nodes.loadWorkflowDesc2")})]})})});yY.displayName="LoadWorkflowConfirmationAlertDialog";const bY=e=>{const t=le(Jw),n=ed(),s=h.useMemo(()=>!(!e.has_workflow||!t),[t,e]);return{load:h.useCallback(()=>{e&&s&&n({type:"image",data:e.image_name})},[e,s,n]),isEnabled:s}},In=({i18nKey:e})=>{const{t}=T();return a.jsxs(q,{as:"span",fontWeight:"semibold",whiteSpace:"pre-wrap",me:2,children:[t(e),":"]})},wn=({value:e})=>e==null?null:Tf(e)?a.jsx(q,{as:"span",children:e||"<empty string>"}):a.jsx(q,{as:"span",children:String(e)}),dn=(e,t)=>jf(e,t),xY=()=>({isParsed:!1,isSuccess:!1,isError:!1,value:null,error:null}),k5=e=>({isParsed:!0,isSuccess:!0,isError:!1,value:e,error:null}),I5=e=>({isParsed:!0,isSuccess:!1,isError:!0,value:null,error:e}),Fn=Symbol("SingleMetadataKey"),CC=Symbol("CollectionMetadataKey"),CY=Symbol("UnrecallableMetadataKey"),xLe=e=>Fn in e&&e[Fn]===!0,CLe=e=>CC in e&&e[CC]===!0,wLe={[CY]:!0,type:"CreatedBy",parse:(e,t)=>{const n=dn(e,"created_by"),s=$2.string().parse(n);return Promise.resolve(s)},i18nKey:"metadata.createdBy",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},_Le={[CY]:!0,type:"GenerationMode",parse:(e,t)=>{const n=dn(e,"generation_mode"),s=$2.string().parse(n);return Promise.resolve(s)},i18nKey:"metadata.generationMode",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},SLe={[Fn]:!0,type:"PositivePrompt",parse:(e,t)=>{const n=dn(e,"positive_prompt"),s=C1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(Nd(e))},i18nKey:"metadata.positivePrompt",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},kLe={[Fn]:!0,type:"NegativePrompt",parse:(e,t)=>{const n=dn(e,"negative_prompt"),s=x1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(Ef(e||null))},i18nKey:"metadata.negativePrompt",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},ILe={[Fn]:!0,type:"CFGScale",parse:(e,t)=>{const n=dn(e,"cfg_scale"),s=$H.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(JH(e))},i18nKey:"metadata.cfgScale",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},jLe={[Fn]:!0,type:"CFGRescaleMultiplier",parse:(e,t)=>{const n=dn(e,"cfg_rescale_multiplier"),s=b1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(QH(e))},i18nKey:"metadata.cfgRescaleMultiplier",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},ELe={[Fn]:!0,type:"CLIPSkip",parse:(e,t)=>{const n=dn(e,"clip_skip"),s=y1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(YH(e))},i18nKey:"metadata.clipSkip",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},ALe={[Fn]:!0,type:"Guidance",parse:(e,t)=>{const n=dn(e,"guidance"),s=v1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(XH(e))},i18nKey:"metadata.guidance",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},PLe={[Fn]:!0,type:"Scheduler",parse:(e,t)=>{const n=dn(e,"scheduler"),s=zH.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(ZH(e))},i18nKey:"metadata.scheduler",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},TLe={[Fn]:!0,type:"Width",parse:(e,t)=>{const n=dn(e,"width"),s=DH.parse(n);return Promise.resolve(s)},recall:(e,t)=>{const n=un(t.getState());n==="canvas"?t.dispatch(PH({width:e,updateAspectRatio:!0,clamp:!0})):n==="generate"&&t.dispatch(TH({width:e,updateAspectRatio:!0,clamp:!0}))},i18nKey:"metadata.width",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},DLe={[Fn]:!0,type:"Height",parse:(e,t)=>{const n=dn(e,"height"),s=DH.parse(n);return Promise.resolve(s)},recall:(e,t)=>{const n=un(t.getState());n==="canvas"?t.dispatch(MH({height:e,updateAspectRatio:!0,clamp:!0})):n==="generate"&&t.dispatch(LH({height:e,updateAspectRatio:!0,clamp:!0}))},i18nKey:"metadata.height",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},MLe={[Fn]:!0,type:"Seed",parse:(e,t)=>{const n=dn(e,"seed"),s=s1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(hM(e))},i18nKey:"metadata.seed",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},LLe={[Fn]:!0,type:"Steps",parse:(e,t)=>{const n=dn(e,"steps"),s=HH.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(KH(e))},i18nKey:"metadata.steps",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},RLe={[Fn]:!0,type:"DenoisingStrength",parse:(e,t)=>{const n=dn(e,"strength"),s=g1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(qH(e))},i18nKey:"metadata.strength",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},OLe={[Fn]:!0,type:"SeamlessX",parse:(e,t)=>{const n=dn(e,"seamless_x"),s=m1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(UH(e))},i18nKey:"metadata.seamlessXAxis",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},NLe={[Fn]:!0,type:"SeamlessY",parse:(e,t)=>{const n=dn(e,"seamless_y"),s=f1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(WH(e))},i18nKey:"metadata.seamlessYAxis",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},FLe={[Fn]:!0,type:"RefinerModel",parse:async(e,t)=>{const n=dn(e,"refiner_model"),s=await Kh(n,t,"main");return ae(s.type==="main"),ae(s.base==="sdxl-refiner"),ae(E5(s,t)),Promise.resolve(s)},recall:(e,t)=>{t.dispatch(qA(e))},i18nKey:"sdxl.refinermodel",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:`${e.name} (${e.base.toUpperCase()})`})},BLe={[Fn]:!0,type:"RefinerSteps",parse:(e,t)=>{const n=dn(e,"refiner_steps"),s=HH.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(GH(e))},i18nKey:"sdxl.refinerSteps",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},zLe={[Fn]:!0,type:"RefinerCFGScale",parse:(e,t)=>{const n=dn(e,"refiner_cfg_scale"),s=$H.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(VH(e))},i18nKey:"sdxl.cfgScale",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},VLe={[Fn]:!0,type:"RefinerScheduler",parse:(e,t)=>{const n=dn(e,"refiner_scheduler"),s=zH.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(BH(e))},i18nKey:"sdxl.scheduler",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},$Le={[Fn]:!0,type:"RefinerPositiveAestheticScore",parse:(e,t)=>{const n=dn(e,"refiner_positive_aesthetic_score"),s=p1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(FH(e))},i18nKey:"sdxl.posAestheticScore",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},GLe={[Fn]:!0,type:"RefinerNegativeAestheticScore",parse:(e,t)=>{const n=dn(e,"refiner_negative_aesthetic_score"),s=h1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(NH(e))},i18nKey:"sdxl.negAestheticScore",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},HLe={[Fn]:!0,type:"RefinerDenoisingStart",parse:(e,t)=>{const n=dn(e,"refiner_start"),s=u1e.parse(n);return Promise.resolve(s)},recall:(e,t)=>{t.dispatch(OH(e))},i18nKey:"sdxl.refinerStart",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:e})},WLe={[Fn]:!0,type:"MainModel",parse:async(e,t)=>{const n=dn(e,"model"),s=await Kh(n,t,"main");return ae(s.type==="main"),Promise.resolve(s)},recall:(e,t)=>{t.dispatch(pM(e))},i18nKey:"metadata.model",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:`${e.name} (${e.base.toUpperCase()})`})},ULe={[Fn]:!0,type:"VAEModel",parse:async(e,t)=>{const n=dn(e,"vae"),s=await Kh(n,t,"vae");return ae(s.type==="vae"),ae(E5(s,t)),Promise.resolve(s)},recall:(e,t)=>{t.dispatch(RH(e))},i18nKey:"metadata.vae",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:`${e.name} (${e.base.toUpperCase()})`})},qLe={[Fn]:!0,type:"Qwen3EncoderModel",parse:async(e,t)=>{const n=dn(e,"qwen3_encoder"),s=await Kh(n,t,"qwen3_encoder");return ae(s.type==="qwen3_encoder"),Promise.resolve(s)},recall:(e,t)=>{t.dispatch(UA(e))},i18nKey:"metadata.qwen3Encoder",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:`${e.name} (${e.base.toUpperCase()})`})},KLe={[Fn]:!0,type:"ZImageVAEModel",parse:async(e,t)=>{const n=dn(e,"vae"),s=await Kh(n,t,"vae");ae(s.type==="vae");const i=qc(t.getState());return ae(i==="z-image","ZImageVAEModel handler only works with Z-Image models"),Promise.resolve(s)},recall:(e,t)=>{t.dispatch(WA(e))},i18nKey:"metadata.vae",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:`${e.name} (${e.base.toUpperCase()})`})},ZLe={[Fn]:!0,type:"ZImageQwen3SourceModel",parse:async(e,t)=>{const n=dn(e,"qwen3_source"),s=await Kh(n,t,"main");ae(s.type==="main");const i=qc(t.getState());return ae(i==="z-image","ZImageQwen3SourceModel handler only works with Z-Image models"),Promise.resolve(s)},recall:(e,t)=>{t.dispatch(HA(e))},i18nKey:"metadata.qwen3Source",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:`${e.name} (${e.base.toUpperCase()})`})},XLe={[CC]:!0,type:"LoRAs",parse:async(e,t)=>{const n=dn(e,"loras");if(!n)return[];ae(c1e(n));const s=[];for(const i of n)try{let o=null;try{const l=dn(i,"model");o=await Kh(l,t,"lora")}catch{const l=dn(i,"lora.key");ae(Tf(l)),o=await lRe(l,t)}ae(o.type==="lora"),ae(E5(o,t));const r=dn(i,"weight");s.push({id:ee("lora"),model:o,weight:d1e.parse(r),isEnabled:!0})}catch{continue}if(s.length>0)return s;throw new Error("No valid LoRAs found in metadata")},recallOne:(e,t)=>{t.dispatch(NL({lora:e}))},recall:(e,t)=>{t.dispatch(l1e());for(const n of e)t.dispatch(NL({lora:n}))},i18nKey:"models.lora",LabelComponent:In,ValueComponent:({value:e})=>a.jsx(wn,{value:`${e.model.name} (${e.model.base.toUpperCase()}) - ${e.weight}`})},YLe={[Fn]:!0,type:"CanvasLayers",parse:async(e,t)=>{const n=dn(e,"canvas_v2_metadata"),s=await r1e.parseAsync(n);for(const i of s.controlLayers){i.controlAdapter.model&&await UP(i.controlAdapter.model.key,t);for(const o of i.objects)o.type==="image"&&"image_name"in o.image&&await Fp(o.image.image_name,t)}for(const i of s.inpaintMasks)for(const o of i.objects)o.type==="image"&&"image_name"in o.image&&await Fp(o.image.image_name,t);for(const i of s.rasterLayers)for(const o of i.objects)o.type==="image"&&"image_name"in o.image&&await Fp(o.image.image_name,t);for(const i of s.regionalGuidance){for(const o of i.objects)o.type==="image"&&"image_name"in o.image&&await Fp(o.image.image_name,t);for(const o of i.referenceImages)o.config.image&&await Fp(o.config.image.image_name,t),o.config.model&&await UP(o.config.model.key,t)}return Promise.resolve(s)},recall:(e,t)=>{e.controlLayers.length===0&&e.rasterLayers.length===0&&e.inpaintMasks.length===0&&e.regionalGuidance.length===0||t.dispatch(a1e(e))},i18nKey:"metadata.canvasV2Metadata",LabelComponent:In,ValueComponent:({value:e})=>{const{t}=T(),n=e.controlLayers.length+e.rasterLayers.length+e.inpaintMasks.length+e.regionalGuidance.length;return a.jsx(wn,{value:`${n} ${t("controlLayers.layer",{count:n})}`})}},QLe={[CC]:!0,type:"RefImages",parse:async(e,t)=>{let n=null;try{const s=dn(e,"ref_images");n=$2.array(i1e).parse(s)}catch{const s=dn(e,"canvas_v2_metadata.referenceImages.entities");n=(await $2.array(o1e).parseAsync(s)).map(({id:o,ipAdapter:r,isEnabled:l})=>({id:o,config:r,isEnabled:l}))}if(!n)throw new Error("No valid reference images found in metadata");for(const s of n)s.config.image&&await Fp(s.config.image.original.image.image_name,t),s.config.model&&await UP(s.config.model.key,t);return n},recall:(e,t)=>{const n=e.map(s=>({...s,id:ee("reference_image")}));t.dispatch(OL({entities:n,replace:!0}))},recallOne:(e,t)=>{const n=[{...e,id:ee("reference_image")}];t.dispatch(OL({entities:n,replace:!1}))},i18nKey:"controlLayers.referenceImage",LabelComponent:In,ValueComponent:({value:e})=>e.config.model?a.jsx(wn,{value:e.config.model.name}):a.jsx(wn,{value:"No model"})},kt={CreatedBy:wLe,GenerationMode:_Le,PositivePrompt:SLe,NegativePrompt:kLe,CFGScale:ILe,CFGRescaleMultiplier:jLe,CLIPSkip:ELe,Guidance:ALe,Scheduler:PLe,Width:TLe,Height:DLe,Seed:MLe,Steps:LLe,DenoisingStrength:RLe,SeamlessX:OLe,SeamlessY:NLe,RefinerModel:FLe,RefinerSteps:BLe,RefinerCFGScale:zLe,RefinerScheduler:VLe,RefinerPositiveAestheticScore:$Le,RefinerNegativeAestheticScore:GLe,RefinerDenoisingStart:HLe,MainModel:WLe,VAEModel:ULe,Qwen3EncoderModel:qLe,ZImageVAEModel:KLe,ZImageQwen3SourceModel:ZLe,LoRAs:XLe,CanvasLayers:YLe,RefImages:QLe},j5=e=>{pe({id:"PARAMETER_SET",title:ye("toast.parameterSet"),description:ye("toast.parameterSetDesc",{parameter:e}),status:"info"})},JLe=(e,t)=>{pe({id:"PARAMETER_NOT_SET",title:ye("toast.parameterNotSet"),description:ye("toast.parameterNotSetDesc",{parameter:e}),status:"warning"})},eRe=async e=>{const{metadata:t,handler:n,store:s,silent:i=!1}=e;let o=!1;try{const r=await n.parse(t,s);n.recall(r,s),o=!0}catch{}return i||(o?j5(ye(n.i18nKey)):JLe(ye(n.i18nKey))),o},uS=async e=>{const{metadata:t,handlers:n,store:s,silent:i=!1,skip:o=[]}=e,r=new Map,c=n.filter(d=>!o.some(u=>u.type===d.type)).sort((d,u)=>d===kt.MainModel?-1:u===kt.MainModel?1:0);for(const d of c)try{const u=await d.parse(t,s);d.recall(u,s),r.set(d,u)}catch{}return i||(r.size>0?pe({id:"PARAMETER_SET",title:ye("toast.parametersSet"),status:"info"}):pe({id:"PARAMETER_SET",title:ye("toast.parametersNotSet"),status:"warning"})),r},tRe=async(e,t)=>{(await uS({metadata:e,handlers:[kt.PositivePrompt,kt.NegativePrompt],store:t,silent:!0})).size>0&&j5(ye("metadata.allPrompts"))},nRe=async e=>{const{metadata:t,handlers:n,store:s,require:i}=e;for(const o of n)try{if(await o.parse(t,s),i==="some")return!0}catch{if(i==="all")return!1}return!0},sRe=async(e,t)=>{(await uS({metadata:e,handlers:[kt.Width,kt.Height],store:t,silent:!0})).size>0&&j5(ye("metadata.imageDimensions"))},iRe=async(e,t,n)=>{const s=Object.values(kt).filter(i=>xLe(i)||CLe(i));await uS({metadata:e,handlers:s,store:t,skip:n})},su={hasMetadataByHandlers:nRe,recallByHandler:eRe,recallByHandlers:uS,recallAllImageMetadata:iRe,recallImagePrompts:tRe,recallImageDimensions:sRe};function oRe(e,t){const n=Ze(),[s,i]=h.useState(()=>({isParsed:!1,isSuccess:!1,isError:!1,value:null,error:null})),o=h.useCallback(async l=>{try{const c=await t.parse(l,n);i(k5(c))}catch(c){i(I5(Ll.wrap(c)))}},[t,n]);h.useEffect(()=>{o(e)},[e,o]);const r=h.useCallback(l=>{t.recall(l,n)},[t,n]);return{data:s,recall:r}}function aRe(e,t){const n=Ze(),[s,i]=h.useState(xY),o=h.useCallback(async c=>{try{const d=await t.parse(c,n);i(k5(d))}catch(d){i(I5(Ll.wrap(d)))}},[t,n]);h.useEffect(()=>{o(e)},[e,o]);const r=h.useCallback(c=>{t.recall(c,n)},[t,n]),l=h.useCallback(c=>{t.recallOne(c,n)},[t,n]);return{data:s,recallAll:r,recallOne:l}}function rRe(e,t){const n=Ze(),[s,i]=h.useState(xY),o=h.useCallback(async r=>{try{const l=await t.parse(r,n);i(k5(l))}catch(l){i(I5(Ll.wrap(l)))}},[t,n]);return h.useEffect(()=>{o(e)},[e,o]),{data:s}}const WP={subscribe:!1},lRe=async(e,t)=>await t.dispatch(go.endpoints.getModelConfig.initiate(e,WP)).unwrap(),Kh=async(e,t,n)=>{try{const{key:c}=_s.parse(e),u=await t.dispatch(go.endpoints.getModelConfig.initiate(c,WP)).unwrap();return _s.parse(u)}catch{}const{model_name:s,base_model:i}=Dm.parse(e),o={name:s,base:i,type:n},l=await t.dispatch(go.endpoints.getModelConfigByAttrs.initiate(o,WP)).unwrap();return _s.parse(l)},E5=(e,t)=>{const n=qc(t.getState());return n?e.base===n:!0},Fp=async(e,t)=>{try{await t.dispatch($r.endpoints.getImageDTO.initiate(e,{subscribe:!1})).unwrap()}catch{throw new Error(`Image with name ${e} does not exist`)}},UP=async(e,t)=>{try{await t.dispatch(go.endpoints.getModelConfig.initiate(e,{subscribe:!1}))}catch{throw new Error(`Model with key ${e} does not exist`)}};function A5(e,t,n,s){var i=this,o=h.useRef(null),r=h.useRef(0),l=h.useRef(0),c=h.useRef(null),d=h.useRef([]),u=h.useRef(),p=h.useRef(),m=h.useRef(e),f=h.useRef(!0);m.current=e;var g=typeof window<"u",v=!t&&t!==0&&g;if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0;var b=!!(n=n||{}).leading,C=!("trailing"in n)||!!n.trailing,y="maxWait"in n,x="debounceOnServer"in n&&!!n.debounceOnServer,w=y?Math.max(+n.maxWait||0,t):null;h.useEffect(function(){return f.current=!0,function(){f.current=!1}},[]);var _=h.useMemo(function(){var S=function(O){var N=d.current,F=u.current;return d.current=u.current=null,r.current=O,l.current=l.current||O,p.current=m.current.apply(F,N)},I=function(O,N){v&&cancelAnimationFrame(c.current),c.current=v?requestAnimationFrame(O):setTimeout(O,N)},k=function(O){if(!f.current)return!1;var N=O-o.current;return!o.current||N>=t||N<0||y&&O-r.current>=w},E=function(O){return c.current=null,C&&d.current?S(O):(d.current=u.current=null,p.current)},j=function O(){var N=Date.now();if(b&&l.current===r.current&&P(),k(N))return E(N);if(f.current){var F=t-(N-o.current),X=y?Math.min(F,w-(N-r.current)):F;I(O,X)}},P=function(){s&&s({})},D=function(){if(g||x){var O=Date.now(),N=k(O);if(d.current=[].slice.call(arguments),u.current=i,o.current=O,N){if(!c.current&&f.current)return r.current=o.current,I(j,t),b?S(o.current):p.current;if(y)return I(j,t),S(o.current)}return c.current||I(j,t),p.current}};return D.cancel=function(){c.current&&(v?cancelAnimationFrame(c.current):clearTimeout(c.current)),r.current=0,d.current=o.current=u.current=c.current=null},D.isPending=function(){return!!c.current},D.flush=function(){return c.current?E(Date.now()):p.current},D},[b,y,t,w,C,v,g,x,s]);return _}function cRe(e,t){return e===t}function el(e,t,n){var s=cRe,i=h.useRef(e),o=h.useState({})[1],r=A5(h.useCallback(function(c){i.current=c,o({})},[o]),t,n,o),l=h.useRef(e);return s(l.current,e)||(r(e),l.current=e),[i.current,r]}function wY(e,t,n){var s={},i=s.leading,o=s.trailing;return A5(e,t,{maxWait:t,leading:i===void 0||i,trailing:o===void 0||o})}const Zh=e=>{const[t]=el(e,300),{currentData:n}=$r.endpoints.getImageMetadata.useQueryState(e??Ri),{currentData:s,isFetching:i}=w1e(t??Ri);return{metadata:n??s,isLoading:n?!1:i||e!==t}},P5=()=>{const e=Ze(),{t}=T(),n=M(Ry);return h.useCallback(()=>{n&&(e.dispatch(G2(null)),pe({status:"info",title:t("stylePresets.promptTemplateCleared")}))},[n,e,t])},T5=e=>{const t=Ze(),n=M(un),{metadata:s,isLoading:i}=Zh(e.image_name),o=Io(),r=P5(),l=h.useMemo(()=>!(i||n!=="canvas"&&n!=="generate"||!s),[i,s,n]),c=h.useMemo(()=>{if(n==="canvas"&&o)return[kt.Width,kt.Height]},[o,n]);return{recall:h.useCallback(()=>{s&&l&&(su.recallAllImageMetadata(s,t,c),r())},[s,l,t,c,r]),isEnabled:l}},D5=e=>{const t=Ze(),n=M(un),s=Io(),i=h.useMemo(()=>!(n!=="canvas"&&n!=="generate"||n==="canvas"&&s),[s,n]);return{recall:h.useCallback(()=>{i&&su.recallImageDimensions(e,t)},[i,e,t]),isEnabled:i}},dRe=["canvas","generate","upscaling"],hS=e=>{const t=Ze(),n=M(un),s=P5(),[i,o]=h.useState(!1),{metadata:r,isLoading:l}=Zh(e.image_name);h.useEffect(()=>{(async()=>{try{const p=await su.hasMetadataByHandlers({handlers:[kt.PositivePrompt,kt.NegativePrompt],metadata:r,store:t,require:"some"});o(p)}catch{o(!1)}})()},[r,t]);const c=h.useMemo(()=>!(l||!dRe.includes(n)||!i),[i,l,n]);return{recall:h.useCallback(()=>{r&&c&&(su.recallImagePrompts(r,t),s())},[r,c,t,s]),isEnabled:c}},M5=e=>{const t=Ze(),n=M(un),s=Io(),i=P5(),{metadata:o,isLoading:r}=Zh(e.image_name),l=h.useMemo(()=>!(r||n!=="canvas"&&n!=="generate"||!o),[r,o,n]),c=h.useMemo(()=>{const u=[kt.Seed];return n==="canvas"&&s&&u.push(kt.Width,kt.Height),u},[s,n]);return{recall:h.useCallback(()=>{o&&l&&(su.recallAllImageMetadata(o,t,c),i())},[o,l,t,c,i]),isEnabled:l}},uRe=["canvas","generate","upscaling"],pS=e=>{const t=Ze(),n=M(un),[s,i]=h.useState(!1),{metadata:o,isLoading:r}=Zh(e.image_name);h.useEffect(()=>{(async()=>{try{await kt.Seed.parse(o,t),i(!0)}catch{i(!1)}})()},[o,t]);const l=h.useMemo(()=>!(r||!uRe.includes(n)||!o||!s),[s,r,o,n]);return{recall:h.useCallback(()=>{o&&l&&su.recallByHandler({metadata:o,handler:kt.Seed,store:t})},[o,l,t]),isEnabled:l}},_Y=h.memo(()=>{mn("GlobalImageHotkeys");const e=M(or),t=Jd(e??null);return t?a.jsx(SY,{imageDTO:t}):null});_Y.displayName="GlobalImageHotkeys";const SY=h.memo(({imageDTO:e})=>{const t=So("gallery"),n=So("viewer"),s=t||n,i=T5(e),o=M5(e),r=hS(e),l=pS(e),c=D5(e),d=bY(e);return Be({id:"loadWorkflow",category:"viewer",callback:d.load,options:{enabled:d.isEnabled&&s},dependencies:[d,s]}),Be({id:"recallAll",category:"viewer",callback:i.recall,options:{enabled:i.isEnabled&&s},dependencies:[i,s]}),Be({id:"recallSeed",category:"viewer",callback:l.recall,options:{enabled:l.isEnabled&&s},dependencies:[l,s]}),Be({id:"recallPrompts",category:"viewer",callback:r.recall,options:{enabled:r.isEnabled&&s},dependencies:[r,s]}),Be({id:"remix",category:"viewer",callback:o.recall,options:{enabled:o.isEnabled&&s},dependencies:[o,s]}),Be({id:"useSize",category:"viewer",callback:c.recall,options:{enabled:c.isEnabled&&s},dependencies:[c,s]}),null});SY.displayName="GlobalImageHotkeysInternal";const hRe=ve(eW,e=>e.image_names),pRe=ve(eW,e=>e.isModalOpen),fRe=()=>{mn("ChangeBoardModal");const e=Q(),t=M(nm),[n,s]=h.useState(),{data:i,isFetching:o}=Oh({include_archived:!0}),r=M(pRe),l=M(hRe),[c]=_1e(),[d]=S1e(),{t:u}=T(),p=h.useMemo(()=>[{label:u("boards.uncategorized"),value:"none"}].concat((i??[]).map(b=>({label:b.board_name,value:b.board_id})).sort((b,C)=>b.label.localeCompare(C.label))).filter(b=>b.value!==t),[i,t,u]),m=h.useMemo(()=>p.find(b=>b.value===n),[p,n]),f=h.useCallback(()=>{e(FL()),e(fM(!1))},[e]),g=h.useCallback(()=>{!n||l.length===0||(l.length&&(n==="none"?d({image_names:l}):c({image_names:l,board_id:n})),e(FL()))},[c,e,l,d,n]),v=h.useCallback(b=>{b&&s(b.value)},[]);return a.jsx(Ko,{isOpen:r,onClose:f,title:u("boards.changeBoard"),acceptCallback:g,acceptButtonText:u("boards.move"),cancelButtonText:u("boards.cancel"),useInert:!1,children:a.jsxs(A,{flexDir:"column",gap:4,children:[a.jsx(q,{children:u("boards.movingImagesToBoard",{count:l.length})}),a.jsx(te,{isDisabled:o,children:a.jsx(pt,{placeholder:u(o?"boards.loading":"boards.selectBoard"),onChange:v,value:m,options:p})})]})})},mRe=h.memo(fRe),L5=De(null),gRe=e=>L5.set(e),Ej=()=>L5.set(null),kY=h.memo(()=>{mn("CanvasPasteModal");const{dispatch:e,getState:t}=Ze(),{t:n}=T(),s=le(L5),i=Tt(),o=M(ko),[r,{isLoading:l}]=e_({fixedCacheKey:"canvasPasteModal"}),c=h.useCallback(f=>{const{x:g,y:v}=i.stateApi.getBbox().rect;if(f==="bbox")return{x:g,y:v};const b=i.compositor.getVisibleAdaptersOfType("raster_layer");if(b.length===0)return{x:g,y:v};{const{x:C,y}=i.compositor.getRectOfAdapters(b);return{x:C,y}}},[i.compositor,i.stateApi]),d=h.useCallback(async(f,g)=>{try{const b=await r({file:f,is_intermediate:g!=="assets",image_category:"user",board_id:o==="none"?void 0:o}).unwrap();g!=="assets"&&Ar({type:"raster_layer",imageDTO:b,dispatch:e,getState:t,overrides:{position:c(g)}})}catch{pe({title:n("toast.pasteFailed"),status:"error"})}finally{Ej(),pe({title:n("toast.pasteSuccess",{destination:n(g==="assets"?"controlLayers.pasteToAssets":g==="bbox"?"controlLayers.pasteToBbox":"controlLayers.pasteToCanvas")}),status:"success"})}},[o,e,c,t,n,r]),u=h.useCallback(()=>{s&&d(s,"assets")},[d,s]),p=h.useCallback(()=>{s&&d(s,"canvas")},[d,s]),m=h.useCallback(()=>{s&&d(s,"bbox")},[d,s]);return a.jsxs(Zo,{isOpen:s!==null,onClose:Ej,useInert:!1,isCentered:!0,size:"2xl",children:[a.jsx(ro,{}),a.jsxs(Xo,{children:[a.jsx(lo,{children:n("controlLayers.pasteTo")}),a.jsx(Yr,{}),a.jsx(vi,{display:"flex",justifyContent:"center",children:a.jsxs(A,{flexDir:"column",gap:4,w:"min-content",children:[a.jsx(he,{size:"lg",onClick:p,isDisabled:l,leftIcon:a.jsx(xh,{}),children:n("controlLayers.pasteToCanvasDesc")}),a.jsx(he,{size:"lg",onClick:m,isDisabled:l,leftIcon:a.jsx(nc,{}),children:n("controlLayers.pasteToBboxDesc")}),a.jsx(he,{size:"lg",onClick:u,isDisabled:l,variant:"ghost",children:n("controlLayers.pasteToAssetsDesc")})]})}),a.jsx(Qr,{children:a.jsx(he,{onClick:Ej,variant:"ghost",isLoading:l,children:n("common.cancel")})})]})]})});kY.displayName="CanvasPasteModal";const wC=De(null),vRe=e=>{wC.set(e)},yRe=()=>{wC.get()?.editor.destroy(),wC.set(null)},Zv={$state:wC,open:vRe,close:yRe},bRe=e=>{if(!e)return"Free";const t=Gr(tW);for(const[n,s]of t)if(s.ratio===e)return n;return"Free"},IY=h.memo(({editor:e,onApplyCrop:t,onReady:n})=>{const s=h.useRef(null),[i,o]=h.useState(100),[r,l]=h.useState(null),[c,d]=h.useState("free"),u=M(ko),[p]=e_({fixedCacheKey:"editorContainer"}),m=h.useCallback(async S=>{e.init(S),e.onZoomChange(I=>{o(I)}),e.onCropBoxChange(I=>{l(I)}),e.onAspectRatioChange(I=>{d(bRe(I))}),await n(),e.fitToContainer()},[e,n]);h.useEffect(()=>{const S=s.current;if(!S)return;m(S);const I=()=>{e.resize(S.clientWidth,S.clientHeight)},k=new ResizeObserver(I);return k.observe(S),()=>{k.disconnect()}},[e,m]);const f=h.useCallback(S=>{const I=S.target.value;mM(I)&&(d(I),I==="Free"?e.setCropAspectRatio(null):e.setCropAspectRatio(tW[I]?.ratio??null))},[e]),g=h.useCallback(()=>{e.resetCrop()},[e]),v=h.useCallback(async()=>{await t(),Zv.close()},[t]),b=h.useCallback(()=>{Zv.close()},[]),C=h.useCallback(async()=>{try{const S=await e.exportImage("blob"),I=new File([S],"image.png",{type:"image/png"});await p({file:I,is_intermediate:!1,image_category:"user",board_id:u==="none"?void 0:u}).unwrap()}catch(S){S instanceof Error&&S.message.includes("tainted")?alert(`Cannot export image: The image is from a different domain (CORS issue). To fix this:

1. Load images from the same domain
2. Use images from CORS-enabled sources
3. Upload a local image file instead`):alert(`Export failed: ${S instanceof Error?S.message:String(S)}`)}},[u,e,p]),y=h.useCallback(()=>{e.zoomIn()},[e]),x=h.useCallback(()=>{e.zoomOut()},[e]),w=h.useCallback(()=>{e.fitToContainer()},[e]),_=h.useCallback(()=>{e.resetView()},[e]);return a.jsxs(A,{w:"full",h:"full",flexDir:"column",gap:4,children:[a.jsxs(A,{gap:2,alignItems:"center",children:[a.jsxs(te,{flex:1,children:[a.jsx(ne,{children:"Aspect Ratio:"}),a.jsxs(Mi,{size:"sm",value:c,onChange:f,w:32,children:[a.jsx("option",{value:"Free",children:"Free"}),a.jsx("option",{value:"16:9",children:"16:9"}),a.jsx("option",{value:"3:2",children:"3:2"}),a.jsx("option",{value:"4:3",children:"4:3"}),a.jsx("option",{value:"1:1",children:"1:1"}),a.jsx("option",{value:"3:4",children:"3:4"}),a.jsx("option",{value:"2:3",children:"2:3"}),a.jsx("option",{value:"9:16",children:"9:16"})]})]}),a.jsx(At,{}),a.jsxs(zn,{size:"sm",isAttached:!1,children:[a.jsx(he,{onClick:w,children:"Fit View"}),a.jsx(he,{onClick:_,children:"Reset View"}),a.jsx(he,{onClick:y,children:"Zoom In"}),a.jsx(he,{onClick:x,children:"Zoom Out"})]}),a.jsx(At,{}),a.jsxs(zn,{size:"sm",isAttached:!1,children:[a.jsx(he,{onClick:v,children:"Apply"}),a.jsx(he,{onClick:g,children:"Reset"}),a.jsx(he,{onClick:b,children:"Cancel"}),a.jsx(he,{onClick:C,children:"Save to Assets"})]})]}),a.jsx(A,{position:"relative",w:"full",h:"full",bg:"base.900",children:a.jsx(A,{position:"absolute",inset:0,ref:s})}),a.jsxs(A,{gap:2,color:"base.300",children:[a.jsx(q,{children:"Mouse wheel: Zoom"}),a.jsx(vt,{orientation:"vertical"}),a.jsx(q,{children:"Space + Drag: Pan"}),a.jsx(vt,{orientation:"vertical"}),a.jsx(q,{children:"Drag crop box or handles to adjust"}),r&&a.jsxs(a.Fragment,{children:[a.jsx(vt,{orientation:"vertical"}),a.jsxs(q,{children:["X: ",Math.round(r.x),", Y: ",Math.round(r.y),", Width: ",Math.round(r.width),", Height:"," ",Math.round(r.height)]})]}),a.jsx(At,{},"help-spacer"),a.jsxs(q,{children:["Zoom: ",Math.round(i*100),"%"]},"help-zoom")]})]})});IY.displayName="CropImageEditor";const jY=h.memo(()=>{const e=le(Zv.$state);return e?a.jsxs(Zo,{isOpen:!0,onClose:Zv.close,isCentered:!0,useInert:!1,size:"full",children:[a.jsx(ro,{}),a.jsxs(Xo,{minH:"unset",minW:"unset",maxH:"90vh",maxW:"90vw",w:"full",h:"full",borderRadius:"base",children:[a.jsx(lo,{children:"Crop Image"}),a.jsx(vi,{px:4,pb:4,pt:0,children:a.jsx(IY,{editor:e.editor,onApplyCrop:e.onApplyCrop,onReady:e.onReady})})]})]}):null});jY.displayName="CropImageModal";const xRe=e=>{const{t}=T(),{imageUsage:n,topMessage:s=t("gallery.currentlyInUse"),bottomMessage:i=t("gallery.featuresWillReset")}=e;return!n||!xc(n)?null:a.jsxs(a.Fragment,{children:[a.jsx(q,{children:s}),a.jsxs(Li,{paddingInlineStart:6,fontSize:"sm",children:[n.isControlLayerImage&&a.jsx(rn,{children:t("controlLayers.controlLayer")}),n.isReferenceImage&&a.jsx(rn,{children:t("controlLayers.referenceImage")}),n.isInpaintMaskImage&&a.jsx(rn,{children:t("controlLayers.inpaintMask")}),n.isRasterLayerImage&&a.jsx(rn,{children:t("controlLayers.rasterLayer")}),n.isRegionalGuidanceImage&&a.jsx(rn,{children:t("controlLayers.regionalGuidance")}),n.isUpscaleImage&&a.jsx(rn,{children:t("ui.tabs.upscalingTab")}),n.isNodesImage&&a.jsx(rn,{children:t("ui.tabs.workflowsTab")})]}),a.jsx(q,{children:i})]})},EY=h.memo(xRe),AY=h.memo(()=>{const e=k1e(),t=Jf(),{dispatch:n}=Ze(),{t:s}=T(),i=M(nW),o=h.useCallback(r=>n(sW(!r.target.checked)),[n]);return a.jsx(Ko,{title:`${s("gallery.deleteImage",{count:e.image_names.length})}`,isOpen:e.isOpen,onClose:t.close,cancelButtonText:s("common.cancel"),acceptButtonText:s("common.delete"),acceptCallback:t.confirm,cancelCallback:t.cancel,useInert:!1,children:a.jsxs(A,{direction:"column",gap:3,children:[a.jsx(EY,{imageUsage:e.usageSummary}),a.jsx(vt,{}),a.jsx(q,{children:s("gallery.deleteImagePermanent")}),a.jsx(q,{children:s("common.areYouSure")}),a.jsxs(te,{children:[a.jsx(ne,{children:s("common.dontAskMeAgain")}),a.jsx(mt,{isChecked:!i,onChange:o})]})]})})});AY.displayName="DeleteImageModal";function CRe(e){var t=e.dragEnter,n=t.type,s=t.relatedTarget;return n!=="dragenter"?!1:Cm()?wPe({dragEnter:t}):s==null?!0:wZ()?_Z(s):s instanceof HTMLIFrameElement}function R5(e){var t=e.type,n=e.value;return!(t===EZ||t===jP&&n===jZ)}function wRe(e){return Array.from(e.types).filter(function(t){return R5({type:t,value:e.getData(t)})})}function _Re(e){return Array.from(e.items).filter(function(t){return t.kind==="file"||R5({type:t.type,value:e.getData(t.type)})})}var qP=!1,O5=IZ({typeKey:"external",defaultDropEffect:"copy",mount:function(t){return ql.bind(window,{type:"dragenter",listener:function(s){if(!qP&&s.dataTransfer&&t.canStart(s)&&CRe({dragEnter:s})){var i=wRe(s.dataTransfer);if(i.length){var o={types:i,items:[],getStringData:function(){return null}};t.start({event:s,dragType:{type:"external",startedFrom:"external",payload:o,getDropPayload:function(l){if(!l.dataTransfer)return o;var c=_Re(l.dataTransfer),d=l.dataTransfer.getData.bind(l.dataTransfer);return{types:i,items:c,getStringData:function(p){if(!i.includes(p))return null;var m=d(p);return R5({type:p,value:m})?m:null}}}}})}}}})}});function PY(e){return O5.dropTarget(e)}function TY(e){return O5.monitor(e)}(function(){if(typeof window>"u")return;O5.registerUsage();var t={type:"idle"},n=t;function s(){n.type==="dragging"&&(qP=!1,n.cleanup(),n=t)}function i(){return ql.bindAll(window,[{type:"dragend",listener:s}].concat(G_(k4({onDragEnd:s}))),{capture:!0})}ql.bind(window,{type:"dragstart",listener:function(){n.type==="idle"&&(qP=!0,n={type:"dragging",cleanup:i()})},options:{capture:!0}})})();function TF(e){var t=e.source;return t.types.includes("Files")}function SRe(e){var t=e.source;return t.items.filter(function(n){return n.kind==="file"}).map(function(n){return n.getAsFile()}).filter(function(n){return n!=null})}function DF(e){e.defaultPrevented||(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.preventDefault())}var KP=null;function kRe(){B0(),KP=ql.bindAll(window,[{type:"dragover",listener:DF},{type:"dragenter",listener:DF},{type:"drop",listener:function(t){t.preventDefault(),B0()}},{type:"dragend",listener:B0}].concat(G_(k4({onDragEnd:B0}))),{capture:!1})}function B0(){var e;(e=KP)===null||e===void 0||e(),KP=null}function IRe(){var e;if(((e=window.event)===null||e===void 0?void 0:e.type)==="drop"){var t;(t=window.event)===null||t===void 0||t.preventDefault()}B0()}var MF={start:kRe,stop:IRe};const jRe={position:"absolute",top:0,right:0,bottom:0,left:0,color:"base.300",borderColor:"base.300",transitionProperty:"common",transitionDuration:"0.1s",".dnd-drop-overlay-backdrop":{position:"absolute",top:0,right:0,bottom:0,left:0,bg:"base.900",opacity:.7,borderRadius:"base",alignItems:"center",justifyContent:"center",transitionProperty:"inherit",transitionDuration:"inherit"},".dnd-drop-overlay-content":{position:"absolute",top:.5,right:.5,bottom:.5,left:.5,opacity:1,borderWidth:1.5,borderRadius:"base",borderStyle:"dashed",alignItems:"center",justifyContent:"center",borderColor:"inherit",transitionProperty:"inherit",transitionDuration:"inherit"},".dnd-drop-overlay-label":{fontSize:"lg",fontWeight:"semibold",textAlign:"center",color:"inherit",transitionProperty:"inherit",transitionDuration:"inherit"},'&[data-dnd-state="over"]':{color:"invokeYellow.300",borderColor:"invokeYellow.300"}},N5=h.memo(e=>{const{dndState:t,label:n,withBackdrop:s=!0}=e;return t==="idle"?null:a.jsxs(A,{className:"dnd-drop-overlay","data-dnd-state":t,sx:jRe,children:[s&&a.jsx(A,{className:"dnd-drop-overlay-backdrop"}),a.jsxs(A,{className:"dnd-drop-overlay-content",children:[Tf(n)&&a.jsx(q,{className:"dnd-drop-overlay-label",children:n}),!st(n)&&!Tf(n)&&n]})]})});N5.displayName="DndDropOverlay";const v1=e=>{const{boardName:t}=Oh({include_archived:!0},{selectFromResult:({data:n})=>({boardName:n?.find(o=>o.board_id===e)?.board_name||ye("boards.uncategorized")})});return t},ERe=["image/png","image/jpg","image/jpeg","image/webp"],ARe=[".png",".jpg",".jpeg",".webp"],PRe=I1e().refine(e=>ERe.includes(e.type.toLowerCase()),{message:"File type is not supported"}).refine(e=>ARe.some(t=>e.name.toLowerCase().endsWith(t)),{message:"File extension is not supported"}),TRe={position:"absolute",top:2,right:2,bottom:2,left:2,'&[data-dnd-state="idle"]':{pointerEvents:"none"}},DY=h.memo(()=>{const{t:e}=T(),t=h.useRef(null),[n,s]=h.useState("idle"),i=M(un),o=h.useCallback(l=>{const{getState:c}=uu();if(!Cn(PRe).safeParse(l).success){const g=e("toast.uploadFailedInvalidUploadDesc");pe({id:"UPLOAD_FAILED",title:e("toast.uploadFailed"),description:g,status:"error"});return}const u=Yy(),[p]=l;if(u==="canvas"&&i==="canvas"&&l.length===1&&p){gRe(p);return}const m=ko(c()),f=l.map((g,v)=>({file:g,image_category:"user",is_intermediate:!1,board_id:m==="none"?void 0:m,isFirstUploadOfBatch:v===0}));iW(f)},[i,e]),r=h.useCallback(l=>{if(!l.clipboardData?.files)return;const c=Array.from(l.clipboardData.files);o(c)},[o]);return h.useEffect(()=>{const l=t.current;if(l)return zi(PY({element:l,canDrop:TF,onDrop:({source:c})=>{const d=SRe({source:c});o(d)},onDragEnter:()=>{s("over")},onDragLeave:()=>{s("idle")}}),TY({canMonitor:TF,onDragStart:()=>{s("potential"),MF.start()},onDrop:()=>{s("idle"),MF.stop()}}))},[o]),h.useEffect(()=>(window.addEventListener("paste",r),()=>{window.removeEventListener("paste",r)}),[r]),a.jsx(ke,{ref:t,"data-dnd-state":n,sx:TRe,children:a.jsx(N5,{dndState:n,label:a.jsx(MY,{})})})});DY.displayName="FullscreenDropzone";const MY=h.memo(()=>{const{t:e}=T(),t=M(ko),n=v1(t);return a.jsxs(A,{flexDir:"column",gap:4,color:"base.100",alignItems:"center",children:[a.jsx(Pt,{size:"lg",children:e("gallery.dropToUpload")}),a.jsx(Pt,{size:"md",children:e("toast.imagesWillBeAddedTo",{boardName:n})})]})});MY.displayName="DropLabel";const Aj=De(!1),LY=()=>{const e=le(Aj),t=h.useCallback(()=>{Aj.set(!0)},[]),n=h.useCallback(()=>{Aj.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},DRe=""+new URL("denoising-strength-4mznP2tj.png",import.meta.url).href,MRe={paramNegativeConditioning:{placement:"right"},clipSkip:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},inpainting:{href:"https://support.invoke.ai/support/solutions/articles/151000096702-inpainting-outpainting-and-bounding-box"},rasterLayer:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-raster-layers-and-initial-images"},regionalGuidance:{href:"https://support.invoke.ai/support/solutions/articles/151000165024-regional-guidance-layers"},regionalGuidanceAndReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000165024-regional-guidance-layers"},globalReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000159340-global-and-regional-reference-images-ip-adapters-"},regionalReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000159340-global-and-regional-reference-images-ip-adapters-"},controlNet:{href:"https://support.invoke.ai/support/solutions/articles/151000105880"},controlNetBeginEnd:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},lora:{href:"https://support.invoke.ai/support/solutions/articles/151000159072"},loraWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000159072-concepts-low-rank-adaptations-loras-"},compositingMaskBlur:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingBlurMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingCoherenceMode:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},infillMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},scaleBeforeProcessing:{href:"https://support.invoke.ai/support/solutions/articles/151000179777-scale-before-processing"},paramCFGScale:{href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramCFGRescaleMultiplier:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramDenoisingStrength:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-image-to-image",image:DRe},paramHrf:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},paramIterations:{href:"https://support.invoke.ai/support/solutions/articles/151000159073"},paramPositiveConditioning:{href:"https://support.invoke.ai/support/solutions/articles/151000096606-tips-on-crafting-prompts",placement:"right"},paramScheduler:{placement:"right",href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramSeed:{href:"https://support.invoke.ai/support/solutions/articles/151000096684-what-is-a-seed-how-do-i-use-it-to-recreate-the-same-image-"},paramModel:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000096601-what-is-a-model-which-should-i-use-"},paramRatio:{gutter:16},controlNetControlMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetProcessor:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000105880-using-controlnet"},controlNetResizeMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},paramVAE:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramVAEPrecision:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramUpscaleMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},refinerModel:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerNegativeAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerPositiveAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerScheduler:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerStart:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerSteps:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerCfgScale:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},seamlessTilingXAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},seamlessTilingYAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"}},LRe=1e3,RRe=[{name:"preventOverflow",options:{padding:10}}],ORe=ve(sM,e=>e.shouldEnableInformationalPopovers),Ue=h.memo(({feature:e,children:t,inPortal:n=!0,hideDisable:s=!1,...i})=>{const o=M(ORe),r=h.useMemo(()=>MRe[e],[e]),l=h.useMemo(()=>oW(zc(r,["image","href","buttonLabel"]),i),[r,i]);return!s&&!o?t:a.jsxs(yi,{isLazy:!0,closeOnBlur:!1,trigger:"hover",variant:"informational",openDelay:LRe,modifiers:RRe,placement:"top",...l,children:[a.jsx(Ni,{children:t}),n?a.jsx(Ls,{children:a.jsx(LF,{data:r,feature:e,hideDisable:s})}):a.jsx(LF,{data:r,feature:e,hideDisable:s})]})});Ue.displayName="InformationalPopover";const LF=({data:e,feature:t,hideDisable:n})=>{const{t:s}=T(),i=Q(),o=h.useMemo(()=>s(`popovers.${t}.heading`),[t,s]),r=h.useMemo(()=>s(`popovers.${t}.paragraphs`,{returnObjects:!0})??[],[t,s]),l=h.useCallback(()=>{e?.href&&window.open(e.href)},[e?.href]),c=h.useCallback(()=>{i(aW(!1)),pe({title:s("settings.informationalPopoversDisabled"),description:s("settings.informationalPopoversDisabledDesc"),status:"info"})},[i,s]);return a.jsxs(bi,{maxW:300,children:[a.jsx(rW,{top:2}),a.jsx(Fi,{children:a.jsxs(A,{gap:2,flexDirection:"column",alignItems:"flex-start",children:[o&&a.jsxs(a.Fragment,{children:[a.jsx(Pt,{size:"sm",children:o}),a.jsx(vt,{})]}),e?.image&&a.jsxs(a.Fragment,{children:[a.jsx(Nn,{objectFit:"contain",backgroundColor:"white",src:e.image,alt:"Optional Image"}),a.jsx(vt,{})]}),r.map(d=>a.jsx(q,{children:d},d)),a.jsx(vt,{}),a.jsxs(A,{alignItems:"center",justifyContent:"space-between",w:"full",children:[!n&&a.jsx(he,{onClick:c,variant:"link",size:"sm",children:s("common.dontShowMeThese")}),a.jsx(At,{}),e?.href&&a.jsx(he,{onClick:l,leftIcon:a.jsx(Z_,{}),variant:"link",size:"sm",children:s("common.learnMore")??o})]})]})})]})},pp={initial:100,sliderMin:1,sliderMax:1e3,numberInputMin:1,numberInputMax:1e4},NRe=()=>{const e=M(yH),t=M(j1e),n=Q(),{t:s}=T(),i=h.useCallback(o=>{n(E1e(o))},[n]);return a.jsxs(te,{isDisabled:!t,children:[a.jsx(Ue,{feature:"dynamicPromptsMaxPrompts",inPortal:!1,children:a.jsx(ne,{children:s("dynamicPrompts.maxPrompts")})}),a.jsx(it,{min:pp.sliderMin,max:pp.sliderMax,value:e,defaultValue:pp.initial,onChange:i,marks:!0}),a.jsx(Pe,{min:pp.numberInputMin,max:pp.numberInputMax,value:e,defaultValue:pp.initial,onChange:i})]})},FRe=h.memo(NRe);var Xv=new Map,v2=new Set;function RY(e){BRe(e);var t=Xv.get(e);if(t)return t;var n={timeOfEngagementStart:Date.now()};return Xv.set(e,n),n}function BRe(e){v2.add(e)}function zRe(e){v2.clear(),e(),Xv.forEach(function(t,n){v2.has(n)||Xv.delete(n)}),v2.clear()}function VRe(){Xv.clear()}var RF=new Map;function $Re(e){var t=RF.get(e);if(t)return t;var n=GRe(e);return RF.set(e,n),n}function GRe(e){var t={type:"idle"},n=[];function s(c){if(t.type==="running"){var d=c-t.timeLastFrameFinished,u=t,p=u.latestArgs,m=S4({x:p.location.current.input.clientX,y:p.location.current.input.clientY});zRe(function(){n.forEach(function(f){return f({underUsersPointer:m,latestArgs:p,timeSinceLastFrame:d})})}),t.timeLastFrameFinished=c,t.frameId=requestAnimationFrame(s)}}function i(){t.type!=="idle"&&(cancelAnimationFrame(t.frameId),VRe(),t={type:"idle"})}function o(c){t.type==="idle"&&(t={type:"initializing",latestArgs:c,frameId:requestAnimationFrame(function(d){t.type==="initializing"&&(t={type:"running",timeLastFrameFinished:d,latestArgs:t.latestArgs,frameId:requestAnimationFrame(s)})})})}function r(c){if(t.type==="idle"){o(c);return}t.latestArgs=c}e({onDragStart:o,onDropTargetChange:r,onDrag:r,onDrop:i});var l={onFrame:function(d){n.push(d)}};return l}var ZP="data-auto-scrollable",HRe="[".concat(ZP,'="true"]');function WRe(e){return e.setAttribute(ZP,"true"),function(){return e.removeAttribute(ZP)}}function OF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function NF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?OF(Object(n),!0).forEach(function(s){Lr(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var URe={startHitboxAtPercentageRemainingOfElement:{top:.25,right:.25,bottom:.25,left:.25},maxScrollAtPercentageRemainingOfHitbox:{top:.5,right:.5,bottom:.5,left:.5},timeDampeningDurationMs:400,maxMainAxisHitboxSize:180},qRe={standard:15*60,fast:25*60};function OY(e){var t;return NF(NF({},URe),{},{maxPixelScrollPerSecond:qRe[(t=e?.maxScrollSpeed)!==null&&t!==void 0?t:"standard"]})}var KRe={top:function(t){return t.scrollTop>0},right:function(t){return Math.ceil(t.scrollLeft)+t.clientWidth<t.scrollWidth},bottom:function(t){return Math.ceil(t.scrollTop)+t.clientHeight<t.scrollHeight},left:function(t){return t.scrollLeft>0}},ZRe=["top","right","bottom","left"],XRe={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"},FF={start:"top",end:"bottom",point:"y",size:"height"},BF={start:"left",end:"right",point:"x",size:"width"},NY={vertical:{mainAxis:FF,crossAxis:BF},horizontal:{mainAxis:BF,crossAxis:FF}},F5={top:"start",right:"end",bottom:"end",left:"start"};function sx(e){var t=e.edge,n=e.axis;return function(i){var o=i.clientRect,r=i.config,l=NY[n],c=l.mainAxis,d=l.crossAxis,u=F5[t],p=Math.min(r.startHitboxAtPercentageRemainingOfElement[t]*o[c.size],r.maxMainAxisHitboxSize);return DOMRect.fromRect(Lr(Lr(Lr(Lr({},c.point,u==="start"?o[c.point]:o[c.point]+o[c.size]-p),d.point,o[d.point]),c.size,p),d.size,o[d.size]))}}var YRe={top:sx({axis:"vertical",edge:"top"}),right:sx({axis:"horizontal",edge:"right"}),bottom:sx({axis:"vertical",edge:"bottom"}),left:sx({axis:"horizontal",edge:"left"})};function XP(e){var t=e.startOfRange,n=e.endOfRange,s=e.value,i=t<n;if(!i||s<t)return 0;if(s>n)return 1;var o=n-t;return(s-t)/o}function QRe(e){var t=e.timeSinceLastFrame,n=e.config,s=n.maxPixelScrollPerSecond/1e3,i=Math.ceil(s*t),o=n.maxPixelScrollPerSecond/60;return Math.min(i,o)}function JRe(e){var t=e.client,n=e.axis,s=e.edge,i=e.hitbox,o=e.config,r=NY[n].mainAxis,l=F5[s],c=i[r.size]*o.maxScrollAtPercentageRemainingOfHitbox[s];if(l==="end")return XP({startOfRange:i[r.start],endOfRange:i[r.end]-c,value:t[r.point]});var d=XP({startOfRange:i[r.start]+c,endOfRange:i[r.end],value:t[r.point]});return 1-d}function ix(e){var t=e.client,n=e.timeSinceLastFrame,s=e.engagement,i=e.axis,o=e.hitbox,r=e.edge,l=e.isDistanceDampeningEnabled,c=e.config,d=QRe({timeSinceLastFrame:n,config:c}),u=l?JRe({client:t,edge:r,hitbox:o,axis:i,config:c}):1,p=XP({startOfRange:s.timeOfEngagementStart,endOfRange:s.timeOfEngagementStart+c.timeDampeningDurationMs,value:Date.now()}),m=u*p,f=Math.max(d*m,1),g=F5[r];return g==="end"?f:-1*f}function eOe(e,t){return t==="all"||e===t}function tOe(e){var t=e.client,n=e.clientRect;return t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height}function nOe(e){return e.getBoundingClientRect()}function FY(e){var t=e.element,n=e.input,s=e.timeSinceLastFrame,i=e.engagement,o=e.config,r=e.allowedAxis,l=e.getRect,c=l===void 0?nOe:l,d={x:n.clientX,y:n.clientY},u=c(t),p=ZRe.reduce(function(g,v){var b=YRe[v]({clientRect:u,config:o}),C=XRe[v];return!eOe(C,r)||!tOe({client:d,clientRect:b})||!KRe[v](t)||g.set(v,{edge:v,hitbox:b}),g},new Map),m=function(){var g="horizontal",v=p.get("left");if(v)return ix({client:d,edge:v.edge,hitbox:v.hitbox,axis:g,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o});var b=p.get("right");return b?ix({client:d,edge:b.edge,hitbox:b.hitbox,axis:g,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o}):0}(),f=function(){var g="vertical",v=p.get("bottom");if(v)return ix({client:d,edge:v.edge,hitbox:v.hitbox,axis:g,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o});var b=p.get("top");return b?ix({client:d,edge:b.edge,hitbox:b.hitbox,axis:g,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o}):0}();return{left:m,top:f}}function sOe(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=iOe(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,r=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return r=d.done,d},e:function(d){l=!0,o=d},f:function(){try{r||n.return==null||n.return()}finally{if(l)throw o}}}}function iOe(e,t){if(e){if(typeof e=="string")return zF(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zF(e,t):void 0}}function zF(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function BY(e){return!!(e.top||e.left)}function zY(e){var t,n,s,i=e.target,o=e.input,r=e.source,l=e.findEntry,c=e.timeSinceLastFrame,d=e.available,u=d===void 0?{top:!0,left:!0}:d;if(!BY(u)||!i)return u;var p=i.closest(HRe);if(!p)return u;var m=l(p);if(!m)return u;function f(){var w;return zY({target:(w=p?.parentElement)!==null&&w!==void 0?w:null,findEntry:l,source:r,timeSinceLastFrame:c,input:o,available:u})}var g={input:o,source:r,element:p};if(m.canScroll&&!m.canScroll(g))return f();var v=RY(p),b=OY((t=m.getConfiguration)===null||t===void 0?void 0:t.call(m,g)),C=(n=(s=m.getAllowedAxis)===null||s===void 0?void 0:s.call(m,g))!==null&&n!==void 0?n:"all",y=FY({element:p,engagement:v,input:o,timeSinceLastFrame:c,allowedAxis:C,config:b}),x={top:0,left:0};return u.top&&y.top!==0&&(x.top=y.top,u.top=!1),u.left&&y.left!==0&&(x.left=y.left,u.left=!1),(x.top!==0||x.left!==0)&&p.scrollBy(x),f()}function oOe(e){var t=e.input,n=e.timeSinceLastFrame,s=e.available,i=e.source,o=e.entries,r=document.documentElement,l={input:t,source:i,element:r},c=sOe(o),d;try{for(c.s();!(d=c.n()).done;){var u,p,m,f=d.value;if(!(f.canScroll&&!f.canScroll(l))){var g=RY(r),v=OY((u=f.getConfiguration)===null||u===void 0?void 0:u.call(f,l)),b=(p=(m=f.getAllowedAxis)===null||m===void 0?void 0:m.call(f,l))!==null&&p!==void 0?p:"all",C=FY({element:r,engagement:g,input:t,config:v,allowedAxis:b,getRect:function(w){return DOMRect.fromRect({y:0,x:0,width:w.clientWidth,height:w.clientHeight})},timeSinceLastFrame:n}),y={top:s.top?C.top:0,left:s.left?C.left:0};(y.top!==0||y.left!==0)&&r.scrollBy(y);break}}}catch(x){c.e(x)}finally{c.f()}}function aOe(e){var t=e.input,n=e.findEntry,s=e.timeSinceLastFrame,i=e.source,o=e.getWindowScrollEntries,r=e.underUsersPointer,l=zY({target:r,timeSinceLastFrame:s,input:t,source:i,findEntry:n});BY(l)&&oOe({input:t,source:i,entries:o(),timeSinceLastFrame:s,available:l})}function VF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function rOe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VF(Object(n),!0).forEach(function(s){Lr(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function VY(e){var t=e.monitor,n=new Map,s=new Set;function i(d){n.set(d.element,d);var u=zi(WRe(d.element),function(){return n.delete(d.element)});return nu(u)}function o(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=rOe({},d);s.add(u);function p(){s.delete(u)}return nu(p)}function r(d){var u;return(u=n.get(d))!==null&&u!==void 0?u:null}function l(){return Array.from(s)}function c(d){var u=d.latestArgs,p=d.underUsersPointer,m=d.timeSinceLastFrame;aOe({input:u.location.current.input,source:u.source,findEntry:r,underUsersPointer:p,timeSinceLastFrame:m,getWindowScrollEntries:l})}return $Re(t).onFrame(c),{autoScroll:i,autoScrollWindow:o}}var lOe=VY({monitor:Gh}),B5=lOe.autoScroll,cOe=VY({monitor:TY}),$Y=cOe.autoScroll;/*!
 * OverlayScrollbars
 * Version: 2.11.4
 *
 * Copyright (c) Rene Haas | KingSora.
 * https://github.com/KingSora
 *
 * Released under the MIT license.
 */const ra=(e,t)=>{const{o:n,i:s,u:i}=e;let o=n,r;const l=(u,p)=>{const m=o,f=u,g=p||(s?!s(m,f):m!==f);return(g||i)&&(o=f,r=m),[o,g,r]};return[t?u=>l(t(o,r),u):l,u=>[o,!!u,r]]},dOe=typeof window<"u"&&typeof HTMLElement<"u"&&!!window.document,Go=dOe?window:{},_C=Math.max,uOe=Math.min,YP=Math.round,SC=Math.abs,$F=Math.sign,z5=Go.cancelAnimationFrame,fS=Go.requestAnimationFrame,V5=Go.setTimeout,GY=Go.clearTimeout,mS=e=>typeof Go[e]<"u"?Go[e]:void 0,hOe=mS("MutationObserver"),GF=mS("IntersectionObserver"),Jp=mS("ResizeObserver"),z0=mS("ScrollTimeline"),$5=e=>e===void 0,gS=e=>e===null,Oc=e=>typeof e=="number",y1=e=>typeof e=="string",vS=e=>typeof e=="boolean",fr=e=>typeof e=="function",Ur=e=>Array.isArray(e),kC=e=>typeof e=="object"&&!Ur(e)&&!gS(e),G5=e=>{const t=!!e&&e.length,n=Oc(t)&&t>-1&&t%1==0;return Ur(e)||!fr(e)&&n?t>0&&kC(e)?t-1 in e:!0:!1},IC=e=>!!e&&e.constructor===Object,jC=e=>e instanceof HTMLElement,yS=e=>e instanceof Element,HF=()=>performance.now(),Pj=(e,t,n,s,i)=>{let o=0;const r=HF(),l=_C(0,n),c=d=>{const u=HF(),m=u-r>=l,f=d?1:1-(_C(0,r+l-u)/l||0),g=(t-e)*(fr(i)?i(f,f*l,0,1,l):f)+e,v=m||f===1;s&&s(g,f,v),o=v?0:fS(()=>c())};return c(),d=>{z5(o),d&&c(d)}};function Vn(e,t){if(G5(e))for(let n=0;n<e.length&&t(e[n],n,e)!==!1;n++);else e&&Vn(Object.keys(e),n=>t(e[n],n,e));return e}const HY=(e,t)=>e.indexOf(t)>=0,Yv=(e,t)=>e.concat(t),ms=(e,t,n)=>(!y1(t)&&G5(t)?Array.prototype.push.apply(e,t):e.push(t),e),xu=e=>Array.from(e||[]),H5=e=>Ur(e)?e:!y1(e)&&G5(e)?xu(e):[e],EC=e=>!!e&&!e.length,QP=e=>xu(new Set(e)),wa=(e,t,n)=>{Vn(e,i=>i?i.apply(void 0,t||[]):!0),n||(e.length=0)},WY="paddingTop",UY="paddingRight",qY="paddingLeft",KY="paddingBottom",ZY="marginLeft",XY="marginRight",YY="marginBottom",W5="overflowX",U5="overflowY",bS="width",xS="height",Ec="visible",Pr="hidden",Mf="scroll",pOe=e=>{const t=String(e||"");return t?t[0].toUpperCase()+t.slice(1):""},CS=(e,t,n,s)=>{if(e&&t){let i=!0;return Vn(n,o=>{const r=e[o],l=t[o];r!==l&&(i=!1)}),i}return!1},QY=(e,t)=>CS(e,t,["w","h"]),y2=(e,t)=>CS(e,t,["x","y"]),fOe=(e,t)=>CS(e,t,["t","r","b","l"]),Mt=(e,...t)=>e.bind(0,...t),Yu=e=>{let t;const n=e?V5:fS,s=e?GY:z5;return[i=>{s(t),t=n(()=>i(),fr(e)?e():e)},()=>s(t)]},WF=e=>{const t=fr(e)?e():e;if(Oc(t)){const n=t?V5:fS,s=t?GY:z5;return i=>{const o=n(()=>i(),t);return()=>{s(o)}}}return t&&t._},AC=(e,t)=>{const{p:n,v:s,S:i,m:o}=t||{};let r,l,c,d,u;const p=function(b){l&&l(),r&&r(),u=l=r=c=void 0,e.apply(this,b)},m=v=>o&&c?o(c,v):v,f=()=>{l&&p(m(d)||d)},g=function(){const b=xu(arguments),C=WF(n);if(C){const y=WF(s),w=m(b)||b,_=p.bind(0,w);l&&l(),i&&!u?(_(),u=!0,l=C(()=>u=void 0)):(l=C(_),y&&!r&&(r=y(f))),c=d=w}else p(b)};return g.O=f,g},JY=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),qr=e=>e?Object.keys(e):[],xn=(e,t,n,s,i,o,r)=>{const l=[t,n,s,i,o,r];return(typeof e!="object"||gS(e))&&!fr(e)&&(e={}),Vn(l,c=>{Vn(c,(d,u)=>{const p=c[u];if(e===p)return!0;const m=Ur(p);if(p&&IC(p)){const f=e[u];let g=f;m&&!Ur(f)?g=[]:!m&&!IC(f)&&(g={}),e[u]=xn(g,p)}else e[u]=m?p.slice():p})}),e},eQ=(e,t)=>Vn(xn({},e),(n,s,i)=>{n===void 0?delete i[s]:n&&IC(n)&&(i[s]=eQ(n))}),q5=e=>!qr(e).length,Lf=()=>{},tQ=(e,t,n)=>_C(e,uOe(t,n)),dh=e=>QP((Ur(e)?e:(e||"").split(" ")).filter(t=>t)),K5=(e,t)=>e&&e.getAttribute(t),UF=(e,t)=>e&&e.hasAttribute(t),Cc=(e,t,n)=>{Vn(dh(t),s=>{e&&e.setAttribute(s,String(n||""))})},ml=(e,t)=>{Vn(dh(t),n=>e&&e.removeAttribute(n))},wS=(e,t)=>{const n=dh(K5(e,t)),s=Mt(Cc,e,t),i=(o,r)=>{const l=new Set(n);return Vn(dh(o),c=>{l[r](c)}),xu(l).join(" ")};return{$:o=>s(i(o,"delete")),C:o=>s(i(o,"add")),H:o=>{const r=dh(o);return r.reduce((l,c)=>l&&n.includes(c),r.length>0)}}},nQ=(e,t,n)=>(wS(e,t).$(n),Mt(Z5,e,t,n)),Z5=(e,t,n)=>(wS(e,t).C(n),Mt(nQ,e,t,n)),PC=(e,t,n,s)=>(s?Z5:nQ)(e,t,n),X5=(e,t,n)=>wS(e,t).H(n),sQ=e=>wS(e,"class"),iQ=(e,t)=>{sQ(e).$(t)},Y5=(e,t)=>(sQ(e).C(t),Mt(iQ,e,t)),oQ=(e,t)=>{const n=t?yS(t)&&t:document;return n?xu(n.querySelectorAll(e)):[]},mOe=(e,t)=>{const n=t?yS(t)&&t:document;return n&&n.querySelector(e)},JP=(e,t)=>yS(e)&&e.matches(t),aQ=e=>JP(e,"body"),eT=e=>e?xu(e.childNodes):[],Qv=e=>e&&e.parentElement,ef=(e,t)=>yS(e)&&e.closest(t),tT=e=>document.activeElement,gOe=(e,t,n)=>{const s=ef(e,t),i=e&&mOe(n,s),o=ef(i,t)===s;return s&&i?s===e||i===e||o&&ef(ef(e,n),t)!==s:!1},Rf=e=>{Vn(H5(e),t=>{const n=Qv(t);t&&n&&n.removeChild(t)})},$o=(e,t)=>Mt(Rf,e&&t&&Vn(H5(t),n=>{n&&e.appendChild(n)}));let rQ;const vOe=()=>rQ,yOe=e=>{rQ=e},vf=e=>{const t=document.createElement("div");return Cc(t,"class",e),t},lQ=e=>{const t=vf(),n=vOe(),s=e.trim();return t.innerHTML=n?n.createHTML(s):s,Vn(eT(t),i=>Rf(i))},qF=(e,t)=>e.getPropertyValue(t)||e[t]||"",cQ=e=>{const t=e||0;return isFinite(t)?t:0},ox=e=>cQ(parseFloat(e||"")),nT=e=>Math.round(e*1e4)/1e4,dQ=e=>`${nT(cQ(e))}px`;function Jv(e,t){e&&t&&Vn(t,(n,s)=>{try{const i=e.style,o=gS(n)||vS(n)?"":Oc(n)?dQ(n):n;s.indexOf("--")===0?i.setProperty(s,o):i[s]=o}catch{}})}function Zl(e,t,n){const s=y1(t);let i=s?"":{};if(e){const o=Go.getComputedStyle(e,n)||e.style;i=s?qF(o,t):xu(t).reduce((r,l)=>(r[l]=qF(o,l),r),i)}return i}const KF=(e,t,n)=>{const s=t?`${t}-`:"",i=n?`-${n}`:"",o=`${s}top${i}`,r=`${s}right${i}`,l=`${s}bottom${i}`,c=`${s}left${i}`,d=Zl(e,[o,r,l,c]);return{t:ox(d[o]),r:ox(d[r]),b:ox(d[l]),l:ox(d[c])}},Tj=(e,t)=>`translate${kC(e)?`(${e.x},${e.y})`:`${t?"X":"Y"}(${e})`}`,bOe=e=>!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length),xOe={w:0,h:0},_S=(e,t)=>t?{w:t[`${e}Width`],h:t[`${e}Height`]}:xOe,COe=e=>_S("inner",e||Go),yf=Mt(_S,"offset"),uQ=Mt(_S,"client"),TC=Mt(_S,"scroll"),Q5=e=>{const t=parseFloat(Zl(e,bS))||0,n=parseFloat(Zl(e,xS))||0;return{w:t-YP(t),h:n-YP(n)}},Dj=e=>e.getBoundingClientRect(),wOe=e=>!!e&&bOe(e),sT=e=>!!(e&&(e[xS]||e[bS])),hQ=(e,t)=>{const n=sT(e);return!sT(t)&&n},ZF=(e,t,n,s)=>{Vn(dh(t),i=>{e&&e.removeEventListener(i,n,s)})},Jn=(e,t,n,s)=>{var i;const o=(i=s&&s.T)!=null?i:!0,r=s&&s.I||!1,l=s&&s.A||!1,c={passive:o,capture:r};return Mt(wa,dh(t).map(d=>{const u=l?p=>{ZF(e,d,u,r),n&&n(p)}:n;return e&&e.addEventListener(d,u,c),Mt(ZF,e,d,u,r)}))},pQ=e=>e.stopPropagation(),iT=e=>e.preventDefault(),fQ=e=>pQ(e)||iT(e),Al=(e,t)=>{const{x:n,y:s}=Oc(t)?{x:t,y:t}:t||{};Oc(n)&&(e.scrollLeft=n),Oc(s)&&(e.scrollTop=s)},va=e=>({x:e.scrollLeft,y:e.scrollTop}),mQ=()=>({D:{x:0,y:0},M:{x:0,y:0}}),_Oe=(e,t)=>{const{D:n,M:s}=e,{w:i,h:o}=t,r=(p,m,f)=>{let g=$F(p)*f,v=$F(m)*f;if(g===v){const b=SC(p),C=SC(m);v=b>C?0:v,g=b<C?0:g}return g=g===v?0:g,[g+0,v+0]},[l,c]=r(n.x,s.x,i),[d,u]=r(n.y,s.y,o);return{D:{x:l,y:d},M:{x:c,y:u}}},Mj=({D:e,M:t})=>{const n=(s,i)=>s===0&&s<=i;return{x:n(e.x,t.x),y:n(e.y,t.y)}},XF=({D:e,M:t},n)=>{const s=(i,o,r)=>tQ(0,1,(i-r)/(i-o)||0);return{x:s(e.x,t.x,n.x),y:s(e.y,t.y,n.y)}},oT=e=>{e&&e.focus&&e.focus({preventScroll:!0})},YF=(e,t)=>{Vn(H5(t),e)},aT=e=>{const t=new Map,n=(o,r)=>{if(o){const l=t.get(o);YF(c=>{l&&l[c?"delete":"clear"](c)},r)}else t.forEach(l=>{l.clear()}),t.clear()},s=(o,r)=>{if(y1(o)){const d=t.get(o)||new Set;return t.set(o,d),YF(u=>{fr(u)&&d.add(u)},r),Mt(n,o,r)}vS(r)&&r&&n();const l=qr(o),c=[];return Vn(l,d=>{const u=o[d];u&&ms(c,s(d,u))}),Mt(wa,c)},i=(o,r)=>{Vn(xu(t.get(o)),l=>{r&&!EC(r)?l.apply(0,r):l()})};return s(e||{}),[s,n,i]},gQ={},vQ={},SOe=e=>{Vn(e,t=>Vn(t,(n,s)=>{gQ[s]=t[s]}))},yQ=(e,t,n)=>qr(e).map(s=>{const{static:i,instance:o}=e[s],[r,l,c]=n||[],d=n?o:i;if(d){const u=n?d(r,l,t):d(t);return(c||vQ)[s]=u}}),b1=e=>vQ[e],kOe="__osOptionsValidationPlugin",Mm="data-overlayscrollbars",b2="os-environment",ax=`${b2}-scrollbar-hidden`,Lj=`${Mm}-initialize`,x2="noClipping",QF=`${Mm}-body`,zd=Mm,IOe="host",wc=`${Mm}-viewport`,jOe=W5,EOe=U5,AOe="arrange",bQ="measuring",POe="scrolling",xQ="scrollbarHidden",TOe="noContent",rT=`${Mm}-padding`,JF=`${Mm}-content`,J5="os-size-observer",DOe=`${J5}-appear`,MOe=`${J5}-listener`,LOe="os-trinsic-observer",ROe="os-theme-none",Pa="os-scrollbar",OOe=`${Pa}-rtl`,NOe=`${Pa}-horizontal`,FOe=`${Pa}-vertical`,CQ=`${Pa}-track`,e6=`${Pa}-handle`,BOe=`${Pa}-visible`,zOe=`${Pa}-cornerless`,e7=`${Pa}-interaction`,t7=`${Pa}-unusable`,lT=`${Pa}-auto-hide`,n7=`${lT}-hidden`,s7=`${Pa}-wheel`,VOe=`${CQ}-interactive`,$Oe=`${e6}-interactive`,GOe="__osSizeObserverPlugin",HOe=(e,t)=>{const{k:n}=t,[s,i]=e("showNativeOverlaidScrollbars");return[s&&n.x&&n.y,i]},tf=e=>e.indexOf(Ec)===0,WOe=e=>e.replace(`${Ec}-`,""),cT=(e,t)=>{if(e==="auto")return t?Mf:Pr;const n=e||Pr;return[Pr,Mf,Ec].includes(n)?n:Pr},UOe=(e,t)=>{const{overflowX:n,overflowY:s}=Zl(e,[W5,U5]);return{x:cT(n,t.x),y:cT(s,t.y)}},wQ="__osScrollbarsHidingPlugin",_Q="__osClickScrollPlugin",qOe={[_Q]:{static:()=>(e,t,n,s)=>{let i=!1,o=Lf;const r=133,l=222,[c,d]=Yu(r),u=Math.sign(t),p=n*u,m=p/2,f=C=>1-(1-C)*(1-C),g=(C,y)=>Pj(C,y,l,e,f),v=(C,y)=>Pj(C,t-p,r*y,(x,w,_)=>{e(x),_&&(o=g(x,t))}),b=Pj(0,p,l,(C,y,x)=>{if(e(C),x&&(s(i),!i)){const w=t-C;Math.sign(w-m)===u&&c(()=>{const S=w-p;o=Math.sign(S)===u?v(C,Math.abs(S)/n):g(C,t)})}},f);return C=>{i=!0,C&&b(),d(),o()}}}},i7=e=>JSON.stringify(e,(t,n)=>{if(fr(n))throw 0;return n}),o7=(e,t)=>e?`${t}`.split(".").reduce((n,s)=>n&&JY(n,s)?n[s]:void 0,e):void 0,KOe={paddingAbsolute:!1,showNativeOverlaidScrollbars:!1,update:{elementEvents:[["img","load"]],debounce:[0,33],attributes:null,ignoreMutation:null},overflow:{x:"scroll",y:"scroll"},scrollbars:{theme:"os-theme-dark",visibility:"auto",autoHide:"never",autoHideDelay:1300,autoHideSuspend:!1,dragScroll:!0,clickScroll:!1,pointers:["mouse","touch","pen"]}},SQ=(e,t)=>{const n={},s=Yv(qr(t),qr(e));return Vn(s,i=>{const o=e[i],r=t[i];if(kC(o)&&kC(r))xn(n[i]={},SQ(o,r)),q5(n[i])&&delete n[i];else if(JY(t,i)&&r!==o){let l=!0;if(Ur(o)||Ur(r))try{i7(o)===i7(r)&&(l=!1)}catch{}l&&(n[i]=r)}}),n},a7=(e,t,n)=>s=>[o7(e,s),n||o7(t,s)!==void 0];let kQ;const ZOe=()=>kQ,XOe=e=>{kQ=e};let Rj;const YOe=()=>{const e=(w,_,S)=>{$o(document.body,w),$o(document.body,w);const I=uQ(w),k=yf(w),E=Q5(_);return S&&Rf(w),{x:k.h-I.h+E.h,y:k.w-I.w+E.w}},t=w=>{let _=!1;const S=Y5(w,ax);try{_=Zl(w,"scrollbar-width")==="none"||Zl(w,"display","::-webkit-scrollbar")==="none"}catch{}return S(),_},n=`.${b2}{scroll-behavior:auto!important;position:fixed;opacity:0;visibility:hidden;overflow:scroll;height:200px;width:200px;z-index:-1}.${b2} div{width:200%;height:200%;margin:10px 0}.${ax}{scrollbar-width:none!important}.${ax}::-webkit-scrollbar,.${ax}::-webkit-scrollbar-corner{appearance:none!important;display:none!important;width:0!important;height:0!important}`,i=lQ(`<div class="${b2}"><div></div><style>${n}</style></div>`)[0],o=i.firstChild,r=i.lastChild,l=ZOe();l&&(r.nonce=l);const[c,,d]=aT(),[u,p]=ra({o:e(i,o),i:y2},Mt(e,i,o,!0)),[m]=p(),f=t(i),g={x:m.x===0,y:m.y===0},v={elements:{host:null,padding:!f,viewport:w=>f&&aQ(w)&&w,content:!1},scrollbars:{slot:!0},cancel:{nativeScrollbarsOverlaid:!1,body:null}},b=xn({},KOe),C=Mt(xn,{},b),y=Mt(xn,{},v),x={P:m,k:g,U:f,J:!!z0,G:Mt(c,"r"),K:y,Z:w=>xn(v,w)&&y(),tt:C,nt:w=>xn(b,w)&&C(),ot:xn({},v),st:xn({},b)};if(ml(i,"style"),Rf(i),Jn(Go,"resize",()=>{d("r",[])}),fr(Go.matchMedia)&&!f&&(!g.x||!g.y)){const w=_=>{const S=Go.matchMedia(`(resolution: ${Go.devicePixelRatio}dppx)`);Jn(S,"change",()=>{_(),w(_)},{A:!0})};w(()=>{const[_,S]=u();xn(x.P,_),d("r",[S])})}return x},sc=()=>(Rj||(Rj=YOe()),Rj),QOe=(e,t,n)=>{let s=!1;const i=n?new WeakMap:!1,o=()=>{s=!0},r=l=>{if(i&&n){const c=n.map(d=>{const[u,p]=d||[];return[p&&u?(l||oQ)(u,e):[],p]});Vn(c,d=>Vn(d[0],u=>{const p=d[1],m=i.get(u)||[];if(e.contains(u)&&p){const g=Jn(u,p,v=>{s?(g(),i.delete(u)):t(v)});i.set(u,ms(m,g))}else wa(m),i.delete(u)}))}};return r(),[o,r]},r7=(e,t,n,s)=>{let i=!1;const{et:o,ct:r,rt:l,it:c,lt:d,ut:u}=s||{},p=AC(()=>i&&n(!0),{p:33,v:99}),[m,f]=QOe(e,p,l),g=o||[],v=r||[],b=Yv(g,v),C=(x,w)=>{if(!EC(w)){const _=d||Lf,S=u||Lf,I=[],k=[];let E=!1,j=!1;if(Vn(w,P=>{const{attributeName:D,target:O,type:N,oldValue:F,addedNodes:X,removedNodes:L}=P,V=N==="attributes",K=N==="childList",U=e===O,Z=V&&D,W=Z&&K5(O,D||""),R=y1(W)?W:null,G=Z&&F!==R,H=HY(v,D)&&G;if(t&&(K||!U)){const $=V&&G,z=$&&c&&JP(O,c),Y=(z?!_(O,D,F,R):!V||$)&&!S(P,!!z,e,s);Vn(X,ie=>ms(I,ie)),Vn(L,ie=>ms(I,ie)),j=j||Y}!t&&U&&G&&!_(O,D,F,R)&&(ms(k,D),E=E||H)}),f(P=>QP(I).reduce((D,O)=>(ms(D,oQ(P,O)),JP(O,P)?ms(D,O):D),[])),t)return!x&&j&&n(!1),[!1];if(!EC(k)||E){const P=[QP(k),E];return x||n.apply(0,P),P}}},y=new hOe(Mt(C,!1));return[()=>(y.observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:b,subtree:t,childList:t,characterData:t}),i=!0,()=>{i&&(m(),y.disconnect(),i=!1)}),()=>{if(i)return p.O(),C(!0,y.takeRecords())}]};let Tu=null;const IQ=(e,t,n)=>{const{ft:s}=n||{},i=b1(GOe),[o]=ra({o:!1,u:!0});return()=>{const r=[],c=lQ(`<div class="${J5}"><div class="${MOe}"></div></div>`)[0],d=c.firstChild,u=p=>{const m=Ur(p)&&!EC(p);let f=!1,g=!1;if(m){const v=p[0],[b,,C]=o(v.contentRect),y=sT(b);g=hQ(b,C),f=!g&&!y}else g=p===!0;f||t({_t:!0,ft:g})};if(Jp){if(!vS(Tu)){const g=new Jp(Lf);g.observe(e,{get box(){Tu=!0}}),Tu=Tu||!1,g.disconnect()}const p=AC(u,{p:0,v:0}),m=g=>p(g),f=new Jp(m);if(f.observe(Tu?e:d),ms(r,[()=>{f.disconnect()},!Tu&&$o(e,c)]),Tu){const g=new Jp(m);g.observe(e,{box:"border-box"}),ms(r,()=>g.disconnect())}}else if(i){const[p,m]=i(d,u,s);ms(r,Yv([Y5(c,DOe),Jn(c,"animationstart",p),$o(e,c)],m))}else return Lf;return Mt(wa,r)}},JOe=(e,t)=>{let n;const s=c=>c.h===0||c.isIntersecting||c.intersectionRatio>0,i=vf(LOe),[o]=ra({o:!1}),r=(c,d)=>{if(c){const u=o(s(c)),[,p]=u;return p&&!d&&t(u)&&[u]}},l=(c,d)=>r(d.pop(),c);return[()=>{const c=[];if(GF)n=new GF(Mt(l,!1),{root:e}),n.observe(i),ms(c,()=>{n.disconnect()});else{const d=()=>{const u=yf(i);r(u)};ms(c,IQ(i,d)()),d()}return Mt(wa,ms(c,$o(e,i)))},()=>n&&l(!0,n.takeRecords())]},eNe=(e,t,n,s)=>{let i,o,r,l,c,d;const u=`[${zd}]`,p=`[${wc}]`,m=["id","class","style","open","wrap","cols","rows"],{dt:f,vt:g,L:v,gt:b,ht:C,V:y,bt:x,wt:w,yt:_,St:S}=e,I=H=>Zl(H,"direction")==="rtl",k={Ot:!1,B:I(f)},E=sc(),j=b1(wQ),[P]=ra({i:QY,o:{w:0,h:0}},()=>{const H=j&&j.R(e,t,k,E,n).Y,z=!(x&&y)&&X5(g,zd,x2),B=!y&&w(AOe),Y=B&&va(b),ie=Y&&S(),ge=_(bQ,z),xe=B&&H&&H(),we=TC(v),je=Q5(v);return xe&&xe(),Al(b,Y),ie&&ie(),z&&ge(),{w:we.w+je.w,h:we.h+je.h}}),D=AC(s,{p:()=>i,v:()=>o,m(H,$){const[z]=H,[B]=$;return[Yv(qr(z),qr(B)).reduce((Y,ie)=>(Y[ie]=z[ie]||B[ie],Y),{})]}}),O=H=>{const $=I(f);xn(H,{$t:d!==$}),xn(k,{B:$}),d=$},N=(H,$)=>{const[z,B]=H,Y={Ct:B};return xn(k,{Ot:z}),$||s(Y),Y},F=({_t:H,ft:$})=>{const B=!(H&&!$)&&E.U?D:s,Y={_t:H||$,ft:$};O(Y),B(Y)},X=(H,$)=>{const[,z]=P(),B={xt:z};return O(B),z&&!$&&(H?s:D)(B),B},L=(H,$,z)=>{const B={Ht:$};return O(B),$&&!z&&D(B),B},[V,K]=C?JOe(g,N):[],U=!y&&IQ(g,F,{ft:!0}),[Z,W]=r7(g,!1,L,{ct:m,et:m}),R=y&&Jp&&new Jp(H=>{const $=H[H.length-1].contentRect;F({_t:!0,ft:hQ($,c)}),c=$}),G=AC(()=>{const[,H]=P();s({xt:H})},{p:222,S:!0});return[()=>{R&&R.observe(g);const H=U&&U(),$=V&&V(),z=Z(),B=E.G(Y=>{Y?D({Et:Y}):G()});return()=>{R&&R.disconnect(),H&&H(),$&&$(),l&&l(),z(),B()}},({zt:H,Tt:$,It:z})=>{const B={},[Y]=H("update.ignoreMutation"),[ie,ge]=H("update.attributes"),[xe,we]=H("update.elementEvents"),[je,Re]=H("update.debounce"),Ct=we||ge,Xe=$||z,Qe=Dt=>fr(Y)&&Y(Dt);if(Ct){r&&r(),l&&l();const[Dt,se]=r7(C||v,!0,X,{et:Yv(m,ie||[]),rt:xe,it:u,ut:(re,ue)=>{const{target:Se,attributeName:de}=re;return(!ue&&de&&!y?gOe(Se,u,p):!1)||!!ef(Se,`.${Pa}`)||!!Qe(re)}});l=Dt(),r=se}if(Re)if(D.O(),Ur(je)){const Dt=je[0],se=je[1];i=Oc(Dt)&&Dt,o=Oc(se)&&se}else Oc(je)?(i=je,o=!1):(i=!1,o=!1);if(Xe){const Dt=W(),se=K&&K(),re=r&&r();Dt&&xn(B,L(Dt[0],Dt[1],Xe)),se&&xn(B,N(se[0],Xe)),re&&xn(B,X(re[0],Xe))}return O(B),B},k]},jQ=(e,t)=>fr(t)?t.apply(0,e):t,tNe=(e,t,n,s)=>{const i=$5(s)?n:s;return jQ(e,i)||t.apply(0,e)},EQ=(e,t,n,s)=>{const i=$5(s)?n:s,o=jQ(e,i);return!!o&&(jC(o)?o:t.apply(0,e))},nNe=(e,t)=>{const{nativeScrollbarsOverlaid:n,body:s}=t||{},{k:i,U:o,K:r}=sc(),{nativeScrollbarsOverlaid:l,body:c}=r().cancel,d=n??l,u=$5(s)?c:s,p=(i.x||i.y)&&d,m=e&&(gS(u)?!o:u);return!!p||!!m},sNe=(e,t,n,s)=>{const i="--os-viewport-percent",o="--os-scroll-percent",r="--os-scroll-direction",{K:l}=sc(),{scrollbars:c}=l(),{slot:d}=c,{dt:u,vt:p,L:m,At:f,gt:g,bt:v,V:b}=t,{scrollbars:C}=f?{}:e,{slot:y}=C||{},x=[],w=[],_=[],S=EQ([u,p,m],()=>b&&v?u:p,d,y),I=Z=>{if(z0){let W=null,R=[];const G=new z0({source:g,axis:Z}),H=()=>{W&&W.cancel(),W=null};return{kt:z=>{const{Dt:B}=n,Y=Mj(B)[Z],ie=Z==="x",ge=[Tj(0,ie),Tj(`calc(100cq${ie?"w":"h"} + -100%)`,ie)],xe=Y?ge:ge.reverse();return R[0]===xe[0]&&R[1]===xe[1]||(H(),R=xe,W=z.Mt.animate({clear:["left"],transform:xe},{timeline:G})),H}}}},k={x:I("x"),y:I("y")},E=()=>{const{Rt:Z,Vt:W}=n,R=(G,H)=>tQ(0,1,G/(G+H)||0);return{x:R(W.x,Z.x),y:R(W.y,Z.y)}},j=(Z,W,R)=>{const G=R?Y5:iQ;Vn(Z,H=>{G(H.Lt,W)})},P=(Z,W)=>{Vn(Z,R=>{const[G,H]=W(R);Jv(G,H)})},D=(Z,W,R)=>{const G=vS(R),H=G?R:!0,$=G?!R:!0;H&&j(w,Z,W),$&&j(_,Z,W)},O=()=>{const Z=E(),W=R=>G=>[G.Lt,{[i]:nT(R)+""}];P(w,W(Z.x)),P(_,W(Z.y))},N=()=>{if(!z0){const{Dt:Z}=n,W=XF(Z,va(g)),R=G=>H=>[H.Lt,{[o]:nT(G)+""}];P(w,R(W.x)),P(_,R(W.y))}},F=()=>{const{Dt:Z}=n,W=Mj(Z),R=G=>H=>[H.Lt,{[r]:G?"0":"1"}];P(w,R(W.x)),P(_,R(W.y)),z0&&(w.forEach(k.x.kt),_.forEach(k.y.kt))},X=()=>{if(b&&!v){const{Rt:Z,Dt:W}=n,R=Mj(W),G=XF(W,va(g)),H=$=>{const{Lt:z}=$,B=Qv(z)===m&&z,Y=(ie,ge,xe)=>{const we=ge*ie;return dQ(xe?we:-we)};return[B,B&&{transform:Tj({x:Y(G.x,Z.x,R.x),y:Y(G.y,Z.y,R.y)})}]};P(w,H),P(_,H)}},L=Z=>{const W=Z?"x":"y",G=vf(`${Pa} ${Z?NOe:FOe}`),H=vf(CQ),$=vf(e6),z={Lt:G,Ut:H,Mt:$},B=k[W];return ms(Z?w:_,z),ms(x,[$o(G,H),$o(H,$),Mt(Rf,G),B&&B.kt(z),s(z,D,Z)]),z},V=Mt(L,!0),K=Mt(L,!1),U=()=>($o(S,w[0].Lt),$o(S,_[0].Lt),Mt(wa,x));return V(),K(),[{Pt:O,Nt:N,qt:F,Bt:X,Ft:D,jt:{Xt:w,Yt:V,Wt:Mt(P,w)},Jt:{Xt:_,Yt:K,Wt:Mt(P,_)}},U]},iNe=(e,t,n,s)=>(i,o,r)=>{const{vt:l,L:c,V:d,gt:u,Gt:p,St:m}=t,{Lt:f,Ut:g,Mt:v}=i,[b,C]=Yu(333),[y,x]=Yu(444),w=I=>{fr(u.scrollBy)&&u.scrollBy({behavior:"smooth",left:I.x,top:I.y})},_=()=>{const I="pointerup pointercancel lostpointercapture",k=`client${r?"X":"Y"}`,E=r?bS:xS,j=r?"left":"top",P=r?"w":"h",D=r?"x":"y",O=(F,X)=>L=>{const{Rt:V}=n,K=yf(g)[P]-yf(v)[P],Z=X*L/K*V[D];Al(u,{[D]:F+Z})},N=[];return Jn(g,"pointerdown",F=>{const X=ef(F.target,`.${e6}`)===v,L=X?v:g,V=e.scrollbars,K=V[X?"dragScroll":"clickScroll"],{button:U,isPrimary:Z,pointerType:W}=F,{pointers:R}=V;if(U===0&&Z&&K&&(R||[]).includes(W)){wa(N),x();const H=!X&&(F.shiftKey||K==="instant"),$=Mt(Dj,v),z=Mt(Dj,g),B=(ue,Se)=>(ue||$())[j]-(Se||z())[j],Y=YP(Dj(u)[E])/yf(u)[P]||1,ie=O(va(u)[D],1/Y),ge=F[k],xe=$(),we=z(),je=xe[E],Re=B(xe,we)+je/2,Ct=ge-we[j],Xe=X?0:Ct-Re,Qe=ue=>{wa(re),L.releasePointerCapture(ue.pointerId)},Dt=X||H,se=m(),re=[Jn(p,I,Qe),Jn(p,"selectstart",ue=>iT(ue),{T:!1}),Jn(g,I,Qe),Dt&&Jn(g,"pointermove",ue=>ie(Xe+(ue[k]-ge))),Dt&&(()=>{const ue=va(u);se();const Se=va(u),de={x:Se.x-ue.x,y:Se.y-ue.y};(SC(de.x)>3||SC(de.y)>3)&&(m(),Al(u,ue),w(de),y(se))})];if(L.setPointerCapture(F.pointerId),H)ie(Xe);else if(!X){const ue=b1(_Q);if(ue){const Se=ue(ie,Xe,je,de=>{de?se():ms(re,se)});ms(re,Se),ms(N,Mt(Se,!0))}}}})};let S=!0;return Mt(wa,[Jn(v,"pointermove pointerleave",s),Jn(f,"pointerenter",()=>{o(e7,!0)}),Jn(f,"pointerleave pointercancel",()=>{o(e7,!1)}),!d&&Jn(f,"mousedown",()=>{const I=tT();(UF(I,wc)||UF(I,zd)||I===document.body)&&V5(Mt(oT,c),25)}),Jn(f,"wheel",I=>{const{deltaX:k,deltaY:E,deltaMode:j}=I;S&&j===0&&Qv(f)===l&&w({x:k,y:E}),S=!1,o(s7,!0),b(()=>{S=!0,o(s7)}),iT(I)},{T:!1,I:!0}),Jn(f,"pointerdown",()=>{const I=Jn(p,"click",E=>{k(),fQ(E)},{A:!0,I:!0,T:!1}),k=Jn(p,"pointerup pointercancel",()=>{k(),setTimeout(I,150)},{I:!0,T:!0})},{I:!0,T:!0}),_(),C,x])},oNe=(e,t,n,s,i,o)=>{let r,l,c,d,u,p=Lf,m=0;const f=["mouse","pen"],g=W=>f.includes(W.pointerType),[v,b]=Yu(),[C,y]=Yu(100),[x,w]=Yu(100),[_,S]=Yu(()=>m),[I,k]=sNe(e,i,s,iNe(t,i,s,W=>g(W)&&V())),{vt:E,Kt:j,bt:P}=i,{Ft:D,Pt:O,Nt:N,qt:F,Bt:X}=I,L=(W,R)=>{if(S(),W)D(n7);else{const G=Mt(D,n7,!0);m>0&&!R?_(G):G()}},V=()=>{(c?!r:!d)&&(L(!0),C(()=>{L(!1)}))},K=W=>{D(lT,W,!0),D(lT,W,!1)},U=W=>{g(W)&&(r=c,c&&L(!0))},Z=[S,y,w,b,()=>p(),Jn(E,"pointerover",U,{A:!0}),Jn(E,"pointerenter",U),Jn(E,"pointerleave",W=>{g(W)&&(r=!1,c&&L(!1))}),Jn(E,"pointermove",W=>{g(W)&&l&&V()}),Jn(j,"scroll",W=>{v(()=>{N(),V()}),o(W),X()})];return[()=>Mt(wa,ms(Z,k())),({zt:W,It:R,Qt:G,Zt:H})=>{const{tn:$,nn:z,sn:B,en:Y}=H||{},{$t:ie,ft:ge}=G||{},{B:xe}=n,{k:we}=sc(),{cn:je,j:Re}=s,[Ct,Xe]=W("showNativeOverlaidScrollbars"),[Qe,Dt]=W("scrollbars.theme"),[se,re]=W("scrollbars.visibility"),[ue,Se]=W("scrollbars.autoHide"),[de,me]=W("scrollbars.autoHideSuspend"),[Ee]=W("scrollbars.autoHideDelay"),[tt,ut]=W("scrollbars.dragScroll"),[Yt,gn]=W("scrollbars.clickScroll"),[$t,Ws]=W("overflow"),Lo=ge&&!R,ki=Re.x||Re.y,vr=$||z||Y||ie||R,Da=B||re||Ws,Ii=Ct&&we.x&&we.y,yr=(id,rg,wb)=>{const _b=id.includes(Mf)&&(se===Ec||se==="auto"&&rg===Mf);return D(BOe,_b,wb),_b};if(m=Ee,Lo&&(de&&ki?(K(!1),p(),x(()=>{p=Jn(j,"scroll",Mt(K,!0),{A:!0})})):K(!0)),Xe&&D(ROe,Ii),Dt&&(D(u),D(Qe,!0),u=Qe),me&&!de&&K(!0),Se&&(l=ue==="move",c=ue==="leave",d=ue==="never",L(d,!0)),ut&&D($Oe,tt),gn&&D(VOe,!!Yt),Da){const id=yr($t.x,je.x,!0),rg=yr($t.y,je.y,!1);D(zOe,!(id&&rg))}vr&&(N(),O(),X(),Y&&F(),D(t7,!Re.x,!0),D(t7,!Re.y,!1),D(OOe,xe&&!P))},{},I]},aNe=e=>{const t=sc(),{K:n,U:s}=t,{elements:i}=n(),{padding:o,viewport:r,content:l}=i,c=jC(e),d=c?{}:e,{elements:u}=d,{padding:p,viewport:m,content:f}=u||{},g=c?e:d.target,v=aQ(g),b=g.ownerDocument,C=b.documentElement,y=()=>b.defaultView||Go,x=Mt(tNe,[g]),w=Mt(EQ,[g]),_=Mt(vf,""),S=Mt(x,_,r),I=Mt(w,_,l),k=je=>{const Re=yf(je),Ct=TC(je),Xe=Zl(je,W5),Qe=Zl(je,U5);return Ct.w-Re.w>0&&!tf(Xe)||Ct.h-Re.h>0&&!tf(Qe)},E=S(m),j=E===g,P=j&&v,D=!j&&I(f),O=!j&&E===D,N=P?C:E,F=P?N:g,X=!j&&w(_,o,p),L=!O&&D,V=[L,N,X,F].map(je=>jC(je)&&!Qv(je)&&je),K=je=>je&&HY(V,je),U=!K(N)&&k(N)?N:g,Z=P?C:N,R={dt:g,vt:F,L:N,rn:X,ht:L,gt:Z,Kt:P?b:N,ln:v?C:U,Gt:b,bt:v,At:c,V:j,an:y,wt:je=>X5(N,wc,je),yt:(je,Re)=>PC(N,wc,je,Re),St:()=>PC(Z,wc,POe,!0)},{dt:G,vt:H,rn:$,L:z,ht:B}=R,Y=[()=>{ml(H,[zd,Lj]),ml(G,Lj),v&&ml(C,[Lj,zd])}];let ie=eT([B,z,$,H,G].find(je=>je&&!K(je)));const ge=P?G:B||z,xe=Mt(wa,Y);return[R,()=>{const je=y(),Re=tT(),Ct=re=>{$o(Qv(re),eT(re)),Rf(re)},Xe=re=>Jn(re,"focusin focusout focus blur",fQ,{I:!0,T:!1}),Qe="tabindex",Dt=K5(z,Qe),se=Xe(Re);return Cc(H,zd,j?"":IOe),Cc($,rT,""),Cc(z,wc,""),Cc(B,JF,""),j||(Cc(z,Qe,Dt||"-1"),v&&Cc(C,QF,"")),$o(ge,ie),$o(H,$),$o($||H,!j&&z),$o(z,B),ms(Y,[se,()=>{const re=tT(),ue=K(z),Se=ue&&re===z?G:re,de=Xe(Se);ml($,rT),ml(B,JF),ml(z,wc),v&&ml(C,QF),Dt?Cc(z,Qe,Dt):ml(z,Qe),K(B)&&Ct(B),ue&&Ct(z),K($)&&Ct($),oT(Se),de()}]),s&&!j&&(Z5(z,wc,xQ),ms(Y,Mt(ml,z,wc))),oT(!j&&v&&Re===G&&je.top===je?z:Re),se(),ie=0,xe},xe]},rNe=({ht:e})=>({Qt:t,un:n,It:s})=>{const{Ct:i}=t||{},{Ot:o}=n;e&&(i||s)&&Jv(e,{[xS]:o&&"100%"})},lNe=({vt:e,rn:t,L:n,V:s},i)=>{const[o,r]=ra({i:fOe,o:KF()},Mt(KF,e,"padding",""));return({zt:l,Qt:c,un:d,It:u})=>{let[p,m]=r(u);const{U:f}=sc(),{_t:g,xt:v,$t:b}=c||{},{B:C}=d,[y,x]=l("paddingAbsolute");(g||m||(u||v))&&([p,m]=o(u));const _=!s&&(x||b||m);if(_){const S=!y||!t&&!f,I=p.r+p.l,k=p.t+p.b,E={[XY]:S&&!C?-I:0,[YY]:S?-k:0,[ZY]:S&&C?-I:0,top:S?-p.t:0,right:S?C?-p.r:"auto":0,left:S?C?"auto":-p.l:0,[bS]:S&&`calc(100% + ${I}px)`},j={[WY]:S?p.t:0,[UY]:S?p.r:0,[KY]:S?p.b:0,[qY]:S?p.l:0};Jv(t||n,E),Jv(n,j),xn(i,{rn:p,fn:!S,F:t?j:xn({},E,j)})}return{_n:_}}},cNe=(e,t)=>{const n=sc(),{vt:s,rn:i,L:o,V:r,Kt:l,gt:c,bt:d,yt:u,an:p}=e,{U:m}=n,f=d&&r,g=Mt(_C,0),v={display:()=>!1,direction:R=>R!=="ltr",flexDirection:R=>R.endsWith("-reverse"),writingMode:R=>R!=="horizontal-tb"},b=qr(v),C={i:QY,o:{w:0,h:0}},y={i:y2,o:{}},x=R=>{u(bQ,!f&&R)},w=R=>{if(!b.some(xe=>{const we=R[xe];return we&&v[xe](we)}))return{D:{x:0,y:0},M:{x:1,y:1}};x(!0);const H=va(c),$=u(TOe,!0),z=Jn(l,Mf,xe=>{const we=va(c);xe.isTrusted&&we.x===H.x&&we.y===H.y&&pQ(xe)},{I:!0,A:!0});Al(c,{x:0,y:0}),$();const B=va(c),Y=TC(c);Al(c,{x:Y.w,y:Y.h});const ie=va(c);Al(c,{x:ie.x-B.x<1&&-Y.w,y:ie.y-B.y<1&&-Y.h});const ge=va(c);return Al(c,H),fS(()=>z()),{D:B,M:ge}},_=(R,G)=>{const H=Go.devicePixelRatio%1!==0?1:0,$={w:g(R.w-G.w),h:g(R.h-G.h)};return{w:$.w>H?$.w:0,h:$.h>H?$.h:0}},S=(R,G)=>{const H=($,z,B,Y)=>{const ie=$===Ec?Pr:WOe($),ge=tf($),xe=tf(B);return!z&&!Y?Pr:ge&&xe?Ec:ge?z&&Y?ie:z?Ec:Pr:z?ie:xe&&Y?Ec:Pr};return{x:H(G.x,R.x,G.y,R.y),y:H(G.y,R.y,G.x,R.x)}},I=R=>{const G=$=>[Ec,Pr,Mf].map(z=>W(cT(z),$)),H=G(!0).concat(G()).join(" ");u(H),u(qr(R).map($=>W(R[$],$==="x")).join(" "),!0)},[k,E]=ra(C,Mt(Q5,o)),[j,P]=ra(C,Mt(TC,o)),[D,O]=ra(C),[N]=ra(y),[F,X]=ra(C),[L]=ra(y),[V]=ra({i:(R,G)=>CS(R,G,b),o:{}},()=>wOe(o)?Zl(o,b):{}),[K,U]=ra({i:(R,G)=>y2(R.D,G.D)&&y2(R.M,G.M),o:mQ()}),Z=b1(wQ),W=(R,G)=>`${G?jOe:EOe}${pOe(R)}`;return({zt:R,Qt:G,un:H,It:$},{_n:z})=>{const{_t:B,Ht:Y,xt:ie,$t:ge,ft:xe,Et:we}=G||{},je=Z&&Z.R(e,t,H,n,R),{X:Re,Y:Ct,W:Xe}=je||{},[Qe,Dt]=HOe(R,n),[se,re]=R("overflow"),ue=tf(se.x),Se=tf(se.y),de=B||z||ie||ge||we||Dt;let me=E($),Ee=P($),tt=O($),ut=X($);if(Dt&&m&&u(xQ,!Qe),de){X5(s,zd,x2)&&x(!0);const jL=Ct&&Ct(),[Sb]=me=k($),[kb]=Ee=j($),Ib=uQ(o),jb=f&&COe(p()),Jve={w:g(kb.w+Sb.w),h:g(kb.h+Sb.h)},EL={w:g((jb?jb.w:Ib.w+g(Ib.w-kb.w))+Sb.w),h:g((jb?jb.h:Ib.h+g(Ib.h-kb.h))+Sb.h)};jL&&jL(),ut=F(EL),tt=D(_(Jve,EL),$)}const[Yt,gn]=ut,[$t,Ws]=tt,[Lo,ki]=Ee,[vr,Da]=me,[Ii,yr]=N({x:$t.w>0,y:$t.h>0}),id=ue&&Se&&(Ii.x||Ii.y)||ue&&Ii.x&&!Ii.y||Se&&Ii.y&&!Ii.x,rg=z||ge||we||Da||ki||gn||Ws||re||Dt||de||Y&&f,[wb,_b]=V($),IL=ge||xe||_b||yr||$,[Zve,Xve]=IL?K(w(wb),$):U();let lg=S(Ii,se);x(!1),rg&&(I(lg),lg=UOe(o,Ii),Xe&&Re&&(Re(lg,Lo,vr),Jv(o,Xe(lg))));const[Yve,Qve]=L(lg);return PC(s,zd,x2,id),PC(i,rT,x2,id),xn(t,{cn:Yve,Vt:{x:Yt.w,y:Yt.h},Rt:{x:$t.w,y:$t.h},j:Ii,Dt:_Oe(Zve,$t)}),{sn:Qve,tn:gn,nn:Ws,en:Xve||Ws,dn:IL}}},dNe=e=>{const[t,n,s]=aNe(e),i={rn:{t:0,r:0,b:0,l:0},fn:!1,F:{[XY]:0,[YY]:0,[ZY]:0,[WY]:0,[UY]:0,[KY]:0,[qY]:0},Vt:{x:0,y:0},Rt:{x:0,y:0},cn:{x:Pr,y:Pr},j:{x:!1,y:!1},Dt:mQ()},{dt:o,gt:r,V:l,St:c}=t,{U:d,k:u}=sc(),p=!d&&(u.x||u.y),m=[rNe(t),lNe(t,i),cNe(t,i)];return[n,f=>{const g={},b=p&&va(r),C=b&&c();return Vn(m,y=>{xn(g,y(f,g)||{})}),Al(r,b),C&&C(),l||Al(o,0),g},i,t,s]},uNe=(e,t,n,s,i)=>{let o=!1;const r=a7(t,{}),[l,c,d,u,p]=dNe(e),[m,f,g]=eNe(u,d,r,w=>{x({},w)}),[v,b,,C]=oNe(e,t,g,d,u,i),y=w=>qr(w).some(_=>!!w[_]),x=(w,_)=>{if(n())return!1;const{pn:S,It:I,Tt:k,vn:E}=w,j=S||{},P=!!I||!o,D={zt:a7(t,j,P),pn:j,It:P};if(E)return b(D),!1;const O=_||f(xn({},D,{Tt:k})),N=c(xn({},D,{un:g,Qt:O}));b(xn({},D,{Qt:O,Zt:N}));const F=y(O),X=y(N),L=F||X||!q5(j)||P;return o=!0,L&&s(w,{Qt:O,Zt:N}),L};return[()=>{const{ln:w,gt:_,St:S}=u,I=va(w),k=[m(),l(),v()],E=S();return Al(_,I),E(),Mt(wa,k)},x,()=>({gn:g,hn:d}),{bn:u,wn:C},p]},t6=new WeakMap,hNe=(e,t)=>{t6.set(e,t)},pNe=e=>{t6.delete(e)},AQ=e=>t6.get(e),qa=(e,t,n)=>{const{tt:s}=sc(),i=jC(e),o=i?e:e.target,r=AQ(o);if(t&&!r){let l=!1;const c=[],d={},u=j=>{const P=eQ(j),D=b1(kOe);return D?D(P,!0):P},p=xn({},s(),u(t)),[m,f,g]=aT(),[v,b,C]=aT(n),y=(j,P)=>{C(j,P),g(j,P)},[x,w,_,S,I]=uNe(e,p,()=>l,({pn:j,It:P},{Qt:D,Zt:O})=>{const{_t:N,$t:F,Ct:X,xt:L,Ht:V,ft:K}=D,{tn:U,nn:Z,sn:W,en:R}=O;y("updated",[E,{updateHints:{sizeChanged:!!N,directionChanged:!!F,heightIntrinsicChanged:!!X,overflowEdgeChanged:!!U,overflowAmountChanged:!!Z,overflowStyleChanged:!!W,scrollCoordinatesChanged:!!R,contentMutation:!!L,hostMutation:!!V,appear:!!K},changedOptions:j||{},force:!!P}])},j=>y("scroll",[E,j])),k=j=>{pNe(o),wa(c),l=!0,y("destroyed",[E,j]),f(),b()},E={options(j,P){if(j){const D=P?s():{},O=SQ(p,xn(D,u(j)));q5(O)||(xn(p,O),w({pn:O}))}return xn({},p)},on:v,off:(j,P)=>{j&&P&&b(j,P)},state(){const{gn:j,hn:P}=_(),{B:D}=j,{Vt:O,Rt:N,cn:F,j:X,rn:L,fn:V,Dt:K}=P;return xn({},{overflowEdge:O,overflowAmount:N,overflowStyle:F,hasOverflow:X,scrollCoordinates:{start:K.D,end:K.M},padding:L,paddingAbsolute:V,directionRTL:D,destroyed:l})},elements(){const{dt:j,vt:P,rn:D,L:O,ht:N,gt:F,Kt:X}=S.bn,{jt:L,Jt:V}=S.wn,K=Z=>{const{Mt:W,Ut:R,Lt:G}=Z;return{scrollbar:G,track:R,handle:W}},U=Z=>{const{Xt:W,Yt:R}=Z,G=K(W[0]);return xn({},G,{clone:()=>{const H=K(R());return w({vn:!0}),H}})};return xn({},{target:j,host:P,padding:D||O,viewport:O,content:N||O,scrollOffsetElement:F,scrollEventElement:X,scrollbarHorizontal:U(L),scrollbarVertical:U(V)})},update:j=>w({It:j,Tt:!0}),destroy:Mt(k,!1),plugin:j=>d[qr(j)[0]]};return ms(c,[I]),hNe(o,E),yQ(gQ,qa,[E,m,d]),nNe(S.bn.bt,!i&&e.cancel)?(k(!0),E):(ms(c,x()),y("initialized",[E]),E.update(),E)}return r};qa.plugin=e=>{const t=Ur(e),n=t?e:[e],s=n.map(i=>yQ(i,qa)[0]);return SOe(n),t?s:s[0]};qa.valid=e=>{const t=e&&e.elements,n=fr(t)&&t();return IC(n)&&!!AQ(n.target)};qa.env=()=>{const{P:e,k:t,U:n,J:s,ot:i,st:o,K:r,Z:l,tt:c,nt:d}=sc();return xn({},{scrollbarsSize:e,scrollbarsOverlaid:t,scrollbarsHiding:n,scrollTimeline:s,staticDefaultInitialization:i,staticDefaultOptions:o,getDefaultInitialization:r,setDefaultInitialization:l,getDefaultOptions:c,setDefaultOptions:d})};qa.nonce=XOe;qa.trustedTypePolicy=yOe;qa.plugin(qOe);const iu={defer:!0,options:{scrollbars:{visibility:"auto",autoHide:"scroll",autoHideDelay:1300,theme:"os-theme-dark",clickScroll:!0},overflow:{x:"hidden"}}},mr=({overflowX:e="hidden",overflowY:t="scroll",visibility:n="auto"})=>{const s=It(iu);return oW(s,{options:{overflow:{y:t,x:e},scrollbars:{visibility:n,autoHide:n==="visible"?"never":"scroll"}}}),s},ic={height:"100%",width:"100%"},fNe=()=>{if(typeof window>"u"){const d=()=>{};return[d,d]}let e,t;const n=window,s=typeof n.requestIdleCallback=="function",i=n.requestAnimationFrame,o=n.cancelAnimationFrame,r=s?n.requestIdleCallback:i,l=s?n.cancelIdleCallback:o,c=()=>{l(e),o(t)};return[(d,u)=>{c(),e=r(s?()=>{c(),t=i(d)}:d,typeof u=="object"?u:{timeout:2233})},c]},SS=e=>{const{options:t,events:n,defer:s}=e||{},[i,o]=h.useMemo(fNe,[]),r=h.useRef(null),l=h.useRef(s),c=h.useRef(t),d=h.useRef(n);return h.useEffect(()=>{l.current=s},[s]),h.useEffect(()=>{const{current:u}=r;c.current=t,qa.valid(u)&&u.options(t||{},!0)},[t]),h.useEffect(()=>{const{current:u}=r;d.current=n,qa.valid(u)&&u.on(n||{},!0)},[n]),h.useEffect(()=>()=>{var u;o(),(u=r.current)==null||u.destroy()},[]),h.useMemo(()=>[u=>{const p=r.current;if(qa.valid(p))return;const m=l.current,f=c.current||{},g=d.current||{},v=()=>r.current=qa(u,f,g);m?i(v,m):v()},()=>r.current],[])},mNe=(e,t)=>{const{element:n="div",options:s,events:i,defer:o,children:r,...l}=e,c=n,d=h.useRef(null),u=h.useRef(null),[p,m]=SS({options:s,events:i,defer:o});return h.useEffect(()=>{const{current:f}=d,{current:g}=u;if(!f)return;const v=f;return p(n==="body"?{target:v,cancel:{body:null}}:{target:v,elements:{viewport:g,content:g}}),()=>{var b;return(b=m())==null?void 0:b.destroy()}},[p,n]),h.useImperativeHandle(t,()=>({osInstance:m,getElement:()=>d.current}),[]),ce.createElement(c,{"data-overlayscrollbars-initialize":"",ref:d,...l},n==="body"?r:ce.createElement("div",{"data-overlayscrollbars-contents":"",ref:u},r))},ti=h.forwardRef(mNe),gNe={position:"absolute",top:0,left:0,right:0,bottom:0},vNe=({children:e,maxHeight:t,maxWidth:n,overflowX:s="hidden",overflowY:i="scroll"})=>{const o=h.useMemo(()=>mr({overflowX:s,overflowY:i}).options,[s,i]),[r,l]=h.useState(null);return h.useEffect(()=>{const c=r?.osInstance();if(!c)return;const d=c.elements().viewport,u=d.style.overflowY;d.style.setProperty("overflow-y","scroll","important");const p=zi(B5({element:d}),$Y({element:d}));return d.style.setProperty("overflow-y",u),p},[r]),a.jsx(A,{w:"full",h:"full",maxHeight:t,maxWidth:n,position:"relative",children:a.jsx(ke,{position:"absolute",top:0,left:0,right:0,bottom:0,children:a.jsx(ti,{ref:l,style:gNe,options:o,children:e})})})},Hs=h.memo(vNe),yNe={"&::marker":{color:"base.500"}},bNe=()=>{const{t:e}=T(),t=M(A1e),n=M(lW),s=M(t_),i=M(P1e),o=h.useMemo(()=>{let r=`${e("dynamicPrompts.promptsPreview")} (${i.length})`;return t&&(r+=` - ${t}`),r},[t,i.length,e]);return n?a.jsx(A,{w:"full",h:"full",layerStyle:"second",alignItems:"center",justifyContent:"center",p:8,children:a.jsx(On,{icon:jMe,label:"Problem generating prompts"})}):a.jsxs(te,{orientation:"vertical",w:"full",h:"full",isInvalid:!!(t||n),children:[a.jsx(Ue,{feature:"dynamicPrompts",inPortal:!1,children:a.jsx(ne,{children:o})}),a.jsxs(A,{w:"full",h:"full",pos:"relative",layerStyle:"first",p:4,borderRadius:"base",children:[a.jsx(Hs,{children:a.jsx(T1e,{stylePosition:"inside",ms:0,children:i.map((r,l)=>a.jsx(rn,{fontSize:"sm",sx:yNe,children:a.jsx(q,{as:"span",fontFamily:"mono",fontSize:"0.82rem",children:r})},`${r}.${l}`))})}),s&&a.jsx(A,{pos:"absolute",w:"full",h:"full",top:0,insetInlineStart:0,layerStyle:"second",opacity:.7,alignItems:"center",justifyContent:"center",children:a.jsx(ao,{})})]})]})},xNe=h.memo(bNe),CNe=()=>{const e=Q(),{t}=T(),n=M(D1e),s=h.useMemo(()=>[{value:"PER_ITERATION",label:t("dynamicPrompts.seedBehaviour.perIterationLabel"),description:t("dynamicPrompts.seedBehaviour.perIterationDesc")},{value:"PER_PROMPT",label:t("dynamicPrompts.seedBehaviour.perPromptLabel"),description:t("dynamicPrompts.seedBehaviour.perPromptDesc")}],[t]),i=h.useCallback(r=>{M1e(r?.value)&&e(L1e(r.value))},[e]),o=h.useMemo(()=>s.find(r=>r.value===n),[s,n]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"dynamicPromptsSeedBehaviour",inPortal:!1,children:a.jsx(ne,{children:t("dynamicPrompts.seedBehaviour.label")})}),a.jsx(pt,{value:o,options:s,onChange:i})]})},wNe=h.memo(CNe),PQ=h.memo(()=>{mn("DynamicPromptsModal");const{t:e}=T(),{isOpen:t,onClose:n}=LY();return a.jsxs(Zo,{isOpen:t,onClose:n,isCentered:!0,useInert:!1,children:[a.jsx(ro,{}),a.jsxs(Xo,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[a.jsx(lo,{children:e("dynamicPrompts.dynamicPrompts")}),a.jsx(Yr,{}),a.jsxs(vi,{as:A,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[a.jsxs(A,{gap:4,children:[a.jsx(wNe,{}),a.jsx(FRe,{})]}),a.jsx(xNe,{})]})]})]})});PQ.displayName="DynamicPromptsModal";const Gu=De(null),_Ne=()=>{mn("DeleteBoardModal");const e=le(Gu),{t}=T(),n=h.useMemo(()=>e==="none"?"none":e?.board_id,[e]),{currentData:s,isFetching:i}=R1e(n?{board_id:n,categories:void 0,is_intermediate:void 0}:Ri),o=h.useMemo(()=>Yn([Xn,rt,GD,Vc],(x,w,_,S)=>{const I=(s??[]).map(E=>O1e(x,w,_,S,E));return{isUpscaleImage:xc(I,E=>E.isUpscaleImage),isRasterLayerImage:xc(I,E=>E.isRasterLayerImage),isInpaintMaskImage:xc(I,E=>E.isInpaintMaskImage),isRegionalGuidanceImage:xc(I,E=>E.isRegionalGuidanceImage),isNodesImage:xc(I,E=>E.isNodesImage),isControlLayerImage:xc(I,E=>E.isControlLayerImage),isReferenceImage:xc(I,E=>E.isReferenceImage)}}),[s]),[r,{isLoading:l}]=N1e(),[c,{isLoading:d}]=F1e(),[u,{isLoading:p}]=B1e(),m=M(o),f=h.useCallback(()=>{!e||e==="none"||(r({board_id:e.board_id}),Gu.set(null))},[e,r]),g=h.useCallback(()=>{!e||e==="none"||(c({board_id:e.board_id}),Gu.set(null))},[e,c]),v=h.useCallback(()=>{!e||e!=="none"||(u(),Gu.set(null))},[e,u]),b=h.useCallback(()=>{Gu.set(null)},[]),C=h.useRef(null),y=h.useMemo(()=>d||l||i||p,[d,l,i,p]);return e?a.jsx(gM,{isOpen:!!e,onClose:b,leastDestructiveRef:C,isCentered:!0,children:a.jsx(ro,{children:a.jsxs(n_,{children:[a.jsxs(lo,{fontSize:"lg",fontWeight:"bold",children:[t("common.delete")," ",e==="none"?t("boards.uncategorizedImages"):e.board_name]}),a.jsx(vi,{children:a.jsxs(A,{direction:"column",gap:3,children:[i?a.jsx(iM,{children:a.jsx(A,{w:"full",h:32})}):a.jsx(EY,{imageUsage:m,topMessage:t("boards.topMessage"),bottomMessage:t("boards.bottomMessage")}),e!=="none"&&a.jsx(q,{children:t("boards.deletedBoardsCannotbeRestored")}),a.jsx(q,{children:t("gallery.deleteImagePermanent")})]})}),a.jsx(Qr,{children:a.jsxs(A,{w:"full",gap:2,justifyContent:"end",children:[a.jsx(he,{ref:C,onClick:b,children:t("boards.cancel")}),e!=="none"&&a.jsx(he,{colorScheme:"warning",isLoading:y,onClick:f,children:t("boards.deleteBoardOnly")}),e!=="none"&&a.jsx(he,{colorScheme:"error",isLoading:y,onClick:g,children:t("boards.deleteBoardAndImages")}),e==="none"&&a.jsx(he,{colorScheme:"error",isLoading:y,onClick:v,children:t("boards.deleteAllUncategorizedImages")})]})})]})})}):null},SNe=h.memo(_Ne),kNe=()=>{const{t:e}=T(),t=Q(),n=M(m=>m.gallery.selection),s=Jf(),[i]=s_(),[o]=i_(),[r]=vM(),l=h.useCallback(()=>{t(cW(n)),t(fM(!0))},[t,n]),c=h.useCallback(()=>{s.delete(n)},[s,n]),d=h.useCallback(()=>{i({image_names:n})},[i,n]),u=h.useCallback(()=>{o({image_names:n})},[o,n]),p=h.useCallback(()=>{r({image_names:n})},[n,r]);return a.jsxs(a.Fragment,{children:[a.jsx(be,{icon:a.jsx(eS,{}),onClickCapture:u,children:"Unstar All"}),a.jsx(be,{icon:a.jsx(sS,{}),onClickCapture:d,children:"Star All"}),a.jsx(be,{icon:a.jsx(Wh,{}),onClickCapture:p,children:e("gallery.downloadSelection")}),a.jsx(be,{icon:a.jsx(rX,{}),onClickCapture:l,children:e("boards.changeBoard")}),a.jsx(Yi,{}),a.jsx(be,{color:"error.300",icon:a.jsx(Ea,{}),onClickCapture:c,children:e("gallery.deleteSelection")})]})},INe=h.memo(kNe),Ka=({tooltip:e,icon:t,...n})=>a.jsx(He,{label:e,placement:"top",gutter:12,children:a.jsx(be,{display:"flex",alignItems:"center",justifyContent:"center",w:"min-content",aspectRatio:"1",borderRadius:"base",...n,children:t})}),Lm=({children:e})=>a.jsx(A,{gap:2,justifyContent:"space-between",children:e}),TQ=h.createContext(null),jNe=TQ.Provider,Si=()=>{const e=h.useContext(TQ);return ae(e!==null,"useItemDTOContext must be used within ItemDTOContextProvider"),e},DQ=h.memo(()=>{const{t:e}=T(),t=Q(),n=Si(),s=h.useCallback(()=>{t(cW([n.image_name])),t(fM(!0))},[t,n]);return a.jsx(be,{icon:a.jsx(rX,{}),onClickCapture:s,children:e("boards.changeBoard")})});DQ.displayName="ContextMenuItemChangeBoard";const ENe="https://invoke-ai.github.io/InvokeAI/faq/#unable-to-copy-on-firefox",Rm=()=>{const{t:e}=T(),t=h.useCallback(()=>{pe({id:"CLIPBOARD_UNAVAILABLE",title:e("toast.unableToCopy"),description:a.jsx(a.Fragment,{children:a.jsxs(q,{fontSize:"md",children:[e("toast.unableToCopyDesc"),a.jsx(to,{display:"inline",fontWeight:"semibold",href:ENe,label:e("toast.unableToCopyDesc_theseSteps")}),"."]})}),status:"error"})},[e]),n=h.useMemo(()=>!(!navigator.clipboard||!window.ClipboardItem),[]),s=h.useCallback((r,l)=>{if(!n){t();return}navigator.clipboard.writeText(r),l?.()},[t,n]),i=h.useCallback((r,l)=>{if(!n){t();return}navigator.clipboard.write(r),l?.()},[t,n]),o=h.useCallback((r,l)=>{if(!n){t();return}const c=[new ClipboardItem({"image/png":r})];navigator.clipboard.write(c),l?.()},[t,n]);return{isAvailable:n,writeText:s,write:i,writeImage:o}},kS=e=>new Promise((t,n)=>{const s=new Image;s.onload=()=>{if(s.width===0||s.height===0){n(new Error("Image has no dimensions. The URL may be invalid or the object may not exist."));return}const i=document.createElement("canvas");i.width=s.width,i.height=s.height;const o=i.getContext("2d");if(!o){n(new Error("Failed to get canvas context"));return}o.drawImage(s,0,0),i.toBlob(r=>{r?t(r):n(new Error("Failed to convert image to blob"))},"image/png")},s.onerror=()=>{n(new Error("Image failed to load. The URL may be invalid or the object may not exist."))},s.crossOrigin="anonymous",s.src=e}),ANe=()=>{const{t:e}=T(),t=Rm();return h.useCallback(async s=>{try{const i=await kS(s);if(!i)throw new Error("Unable to create Blob");t.writeImage(i,()=>{pe({id:"IMAGE_COPIED",title:e("toast.imageCopied"),status:"success"})})}catch(i){pe({id:"PROBLEM_COPYING_IMAGE",title:e("toast.problemCopyingImage"),description:String(i),status:"error"})}},[t,e])},MQ=h.memo(()=>{const{t:e}=T(),t=Si(),n=ANe(),s=h.useCallback(()=>{n(t.image_url)},[n,t]);return a.jsx(Ka,{icon:a.jsx(ws,{}),"aria-label":e("parameters.copyImage"),tooltip:e("parameters.copyImage"),onClickCapture:s})});MQ.displayName="ContextMenuItemCopy";const PNe=()=>{const{t:e}=T();return{downloadItem:h.useCallback(async(n,s)=>{try{const i=await fetch(n).then(l=>l.blob());if(!i)throw new Error("Unable to create Blob");const o=window.URL.createObjectURL(i),r=document.createElement("a");r.style.display="none",r.href=o,r.download=s,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(o)}catch(i){pe({id:"PROBLEM_DOWNLOADING_IMAGE",title:e("toast.problemDownloadingImage"),description:String(i),status:"error"})}},[e])}},LQ=h.memo(()=>{const{t:e}=T(),t=Si(),{downloadItem:n}=PNe(),s=h.useCallback(()=>{n(t.image_url,t.image_name)},[n,t]);return a.jsx(Ka,{icon:a.jsx(Wh,{}),"aria-label":e("gallery.download"),tooltip:e("gallery.download"),onClick:s})});LQ.displayName="ContextMenuItemDownload";const RQ=h.memo(()=>{const{t:e}=T(),t=Si(),n=ed(),s=le(Jw),i=h.useCallback(()=>{n({type:"image",data:t.image_name})},[n,t]),o=h.useMemo(()=>!t.has_workflow||!s,[t,s]);return a.jsx(be,{icon:a.jsx(h1,{}),onClickCapture:i,isDisabled:o,children:e("nodes.loadWorkflow")})});RQ.displayName="ContextMenuItemLoadWorkflow";const rx=(e,t,n)=>e.height<=n,OQ=(e,t,n,s,i,o)=>{const r=h.useState(()=>De(!1))[0],l=h.useRef(0),c=h.useCallback(()=>{const p=Ne.getPanel(e,t);!p||!(p instanceof Fo)||rx(p,n,i)||(l.current=p.height,p.api.setSize({height:i}))},[i,n,t,e]),d=h.useCallback(()=>{const p=Ne.getPanel(e,t);if(!p||!(p instanceof Fo)||!rx(p,n,i))return;let f=l.current||s;f<o&&(f=o),p.api.setSize({height:f})},[s,o,n,i,t,e]),u=h.useCallback(()=>{const p=Ne.getPanel(e,t);if(!p||!(p instanceof Fo))return;rx(p,n,i)?d():c()},[e,t,n,i,d,c]);return h.useEffect(()=>{const p=Ne.getPanel(e,t);if(!p||!(p instanceof Fo))return;const m=p.api.onDidDimensionsChange(()=>{const f=rx(p,n,i);r.set(f)});return()=>{m.dispose()}},[r,i,n,t,e]),h.useMemo(()=>({$isCollapsed:r,expand:d,collapse:c,toggle:u}),[r,c,d,u])},n6=e=>OQ(e,ja,"vertical",i1,s1,aAe),NQ=h.memo(()=>{const{t:e}=T(),t=Q(),n=Si(),s=M(un),i=n6(s),o=h.useMemo(()=>!n.is_intermediate,[n]),r=h.useCallback(()=>{Ne.expandRightPanel(),i.expand(),pu.flushSync(()=>{t(sm({boardId:n.board_id??"none",select:{selection:[n.image_name],galleryView:dW.includes(n.image_category)?"images":"assets"}}))})},[t,i,n]);return a.jsx(be,{icon:a.jsx(iX,{}),onClickCapture:r,isDisabled:!o,children:e("boards.locateInGalery")})});NQ.displayName="ContextMenuItemLocateInGalery";const TNe=[0,8],Qi=()=>{const e=cS(!1),t=h.useRef(null),n=A5(e.close,300),s=h.useCallback(()=>{n.cancel(),e.open()},[n,e]),i=h.useCallback(()=>{if(e.isOpen){e.close();return}else n.cancel(),e.toggle()},[n,e]),o=h.useCallback(l=>{if(l.currentTarget.contains(l.relatedTarget)){n.cancel();return}e.close()},[n,e]),r=h.useCallback(l=>{l.pointerType==="pen"||l.pointerType==="touch"||e.close()},[e]);return h.useEffect(()=>{if(!t.current)return;const c=new AbortController;return window.addEventListener("click",d=>{t.current?.contains(d.target)||e.close()},{signal:c.signal}),()=>{c.abort()}},[e]),{parentMenuItemProps:{onClick:i,onPointerEnter:s,onPointerLeave:r,closeOnSelect:!1},menuProps:{isOpen:e.isOpen,onClose:e.close,placement:"right",offset:TNe,closeOnBlur:!1},menuButtonProps:{as:ke,width:"full",height:"full"},menuListProps:{ref:t,onPointerEnter:s,onPointerLeave:n,onBlur:o}}},Ji=({label:e})=>a.jsxs(A,{w:"full",h:"full",flexDir:"row",justifyContent:"space-between",alignItems:"center",children:[a.jsx(q,{children:e}),a.jsx(Je,{as:Y_})]}),DNe=["canvas","generate","upscaling"],MNe=e=>{const t=Ze(),n=M(z1e),s=M(un),[i,o]=h.useState(!1),{metadata:r,isLoading:l}=Zh(e.image_name);h.useEffect(()=>{const u=async()=>{try{await kt.CLIPSkip.parse(r,t),o(!0)}catch{o(!1)}};if(!n){o(!1);return}u()},[r,t,n]);const c=h.useMemo(()=>!(l||!DNe.includes(s)||!r||!i),[i,l,r,s]);return{recall:h.useCallback(()=>{r&&c&&su.recallByHandler({metadata:r,handler:kt.CLIPSkip,store:t})},[r,c,t]),isEnabled:c}},FQ=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Si(),s=T5(n),i=M5(n),o=hS(n),r=pS(n),l=D5(n),c=MNe(n);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(K_,{}),children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("parameters.recallMetadata")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(be,{icon:a.jsx(aC,{}),onClick:i.recall,isDisabled:!i.isEnabled,children:e("parameters.remixImage")}),a.jsx(be,{icon:a.jsx(q4,{}),onClick:o.recall,isDisabled:!o.isEnabled,children:e("parameters.usePrompt")}),a.jsx(be,{icon:a.jsx(W4,{}),onClick:r.recall,isDisabled:!r.isEnabled,children:e("parameters.useSeed")}),a.jsx(be,{icon:a.jsx(eX,{}),onClick:s.recall,isDisabled:!s.isEnabled,children:e("parameters.useAll")}),a.jsx(be,{icon:a.jsx(qv,{}),onClick:l.recall,isDisabled:!l.isEnabled,children:e("parameters.useSize")}),a.jsx(be,{icon:a.jsx(qv,{}),onClick:c.recall,isDisabled:!c.isEnabled,children:e("parameters.useClipSkip")})]})]})})});FQ.displayName="ContextMenuItemMetadataRecallActionsCanvasGenerateTabs";const xt=()=>{const e=Tt();return le(e.$isBusy)},IS=()=>{const e=pm();return le(e?.$isBusy??Lp)},BQ=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Ze(),s=Si(),i=IS(),o=Io(),r=h.useCallback(async()=>{const{dispatch:u,getState:p}=n;await Ne.focusPanel("canvas",Zn),await Dd({imageDTO:s,withResize:!1,withInpaintMask:!0,type:"raster_layer",dispatch:u,getState:p}),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,n,e]),l=h.useCallback(async()=>{const{dispatch:u,getState:p}=n;await Ne.focusPanel("canvas",Zn),await Dd({imageDTO:s,withResize:!1,withInpaintMask:!0,type:"control_layer",dispatch:u,getState:p}),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,n,e]),c=h.useCallback(async()=>{const{dispatch:u,getState:p}=n;await Ne.focusPanel("canvas",Zn),await Dd({imageDTO:s,withResize:!0,withInpaintMask:!0,type:"raster_layer",dispatch:u,getState:p}),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,n,e]),d=h.useCallback(async()=>{const{dispatch:u,getState:p}=n;await Ne.focusPanel("canvas",Zn),await Dd({imageDTO:s,withResize:!0,withInpaintMask:!0,type:"control_layer",dispatch:u,getState:p}),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,n,e]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(Sn,{}),children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.newCanvasFromImage")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(be,{icon:a.jsx(ex,{}),onClickCapture:r,isDisabled:o||i,children:e("controlLayers.asRasterLayer")}),a.jsx(be,{icon:a.jsx(ex,{}),onClickCapture:c,isDisabled:o||i,children:e("controlLayers.asRasterLayerResize")}),a.jsx(be,{icon:a.jsx(ex,{}),onClickCapture:l,isDisabled:o||i,children:e("controlLayers.asControlLayer")}),a.jsx(be,{icon:a.jsx(ex,{}),onClickCapture:d,isDisabled:o||i,children:e("controlLayers.asControlLayerResize")})]})]})})});BQ.displayName="ContextMenuItemNewCanvasFromImageSubMenu";const LNe=ec(NMe),vo=()=>a.jsx(LNe,{transform:"rotate(90deg)"}),zQ=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Ze(),s=Si(),i=IS(),o=h.useCallback(async()=>{const{dispatch:u,getState:p}=n;await Ne.focusPanel("canvas",Zn),Ar({imageDTO:s,type:"raster_layer",dispatch:u,getState:p}),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,n,e]),r=h.useCallback(async()=>{const{dispatch:u,getState:p}=n;await Ne.focusPanel("canvas",Zn),Ar({imageDTO:s,type:"control_layer",dispatch:u,getState:p}),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,n,e]),l=h.useCallback(async()=>{const{dispatch:u,getState:p}=n;await Ne.focusPanel("canvas",Zn),Ar({imageDTO:s,type:"inpaint_mask",dispatch:u,getState:p}),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,n,e]),c=h.useCallback(async()=>{const{dispatch:u,getState:p}=n;await Ne.focusPanel("canvas",Zn),Ar({imageDTO:s,type:"regional_guidance",dispatch:u,getState:p}),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,n,e]),d=h.useCallback(async()=>{const{dispatch:u,getState:p}=n;await Ne.focusPanel("canvas",Zn),Ar({imageDTO:s,type:"regional_guidance_with_reference_image",dispatch:u,getState:p}),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,n,e]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(Sn,{}),children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.newLayerFromImage")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(be,{icon:a.jsx(vo,{}),onClickCapture:l,isDisabled:i,children:e("controlLayers.inpaintMask")}),a.jsx(be,{icon:a.jsx(vo,{}),onClickCapture:c,isDisabled:i,children:e("controlLayers.regionalGuidance")}),a.jsx(be,{icon:a.jsx(vo,{}),onClickCapture:r,isDisabled:i,children:e("controlLayers.controlLayer")}),a.jsx(be,{icon:a.jsx(vo,{}),onClickCapture:o,isDisabled:i,children:e("controlLayers.rasterLayer")}),a.jsx(be,{icon:a.jsx(vo,{}),onClickCapture:d,isDisabled:i,children:e("controlLayers.referenceImageRegional")})]})]})})});zQ.displayName="ContextMenuItemNewLayerFromImageSubMenu";const VQ=h.memo(()=>{const{t:e}=T(),t=Si(),n=h.useCallback(()=>{window.open(t.image_url,"_blank")},[t]);return a.jsx(Ka,{onClickCapture:n,"aria-label":e("common.openInNewTab"),tooltip:e("common.openInNewTab"),icon:a.jsx(Z_,{})})});VQ.displayName="ContextMenuItemOpenInNewTab";const $Q=h.memo(()=>{const e=Q(),{t}=T(),n=Si(),s=h.useCallback(()=>{e($c(null)),e(Lv(n.image_name)),Ne.focusPanelInActiveTab(cs)},[e,n]);return a.jsx(Ka,{icon:a.jsx(X_,{}),onClickCapture:s,"aria-label":t("common.openInViewer"),tooltip:t("common.openInViewer")})});$Q.displayName="ContextMenuItemOpenInViewer";const GQ=h.memo(()=>{const{t:e}=T(),t=Q(),n=Si(),s=h.useMemo(()=>ve(ir,r=>r.imageToCompare!==n.image_name),[n]),i=M(s),o=h.useCallback(()=>{t($c(n.image_name))},[t,n]);return a.jsx(Ka,{icon:a.jsx(QDe,{}),isDisabled:!i,onClick:o,"aria-label":e("gallery.selectForCompare"),tooltip:e("gallery.selectForCompare")})});GQ.displayName="ContextMenuItemSelectForCompare";const HQ=h.memo(()=>{const{t:e}=T(),t=Q(),n=Si(),s=h.useCallback(()=>{t(Mv(du(n))),Ne.switchToTab("upscaling"),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToUpscale"),status:"success"})},[t,n,e]);return a.jsx(be,{icon:a.jsx(bMe,{}),onClickCapture:s,id:"send-to-upscale",children:e("parameters.sendToUpscale")})});HQ.displayName="ContextMenuItemSendToUpscale";const WQ=h.memo(()=>{const{t:e}=T(),t=Si(),[n]=s_(),[s]=i_(),i=h.useCallback(()=>{n({image_names:[t.image_name]})},[n,t]),o=h.useCallback(()=>{s({image_names:[t.image_name]})},[s,t]);return t.starred?a.jsx(be,{icon:a.jsx(sS,{}),onClickCapture:o,children:e("gallery.unstarImage")}):a.jsx(be,{icon:a.jsx(eS,{}),onClickCapture:i,children:e("gallery.starImage")})});WQ.displayName="ContextMenuItemStarUnstar";const RNe={isModalOpen:!1,updatingStylePresetId:null,prefilledFormData:null},Ch=De(RNe),ONe=e=>{const t=Ze(),[n,s]=h.useState(!1),{metadata:i}=Zh(e?.image_name);h.useEffect(()=>{su.hasMetadataByHandlers({handlers:[kt.PositivePrompt,kt.NegativePrompt],metadata:i,store:t,require:"some"}).then(l=>{s(l)}).catch(()=>{s(!1)})},[i,t]);const o=h.useMemo(()=>!(!e||!n),[n,e]);return{create:h.useCallback(async()=>{if(!e||!i||!o)return;let l,c;try{l=await kt.PositivePrompt.parse(i,t)}catch{l=""}try{c=await kt.NegativePrompt.parse(i,t)??""}catch{c=""}Ch.set({prefilledFormData:{name:"",positivePrompt:l,negativePrompt:c,imageUrl:e.image_url,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[e,o,i,t]),isEnabled:o}},UQ=h.memo(()=>{const{t:e}=T(),t=Si(),n=ONe(t);return a.jsx(be,{icon:a.jsx(pX,{}),onClickCapture:n.create,isDisabled:!n.isEnabled,children:e("stylePresets.useForTemplate")})});UQ.displayName="ContextMenuItemUseAsPromptTemplate";const qQ=h.memo(()=>{const{t:e}=T(),t=Ze(),n=Si(),s=h.useCallback(()=>{const{dispatch:i,getState:o}=t,r=a1(o);r.image=Dl(n),i(Dy({overrides:{config:r}})),pe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[n,t,e]);return a.jsx(be,{icon:a.jsx(xh,{}),onClickCapture:s,children:e("controlLayers.useAsReferenceImage")})});qQ.displayName="ContextMenuItemUseAsRefImage";const KQ=h.memo(()=>{const{t:e}=T(),t=Jf(),n=Si(),s=h.useCallback(async()=>{try{await t.delete([n.image_name])}catch{}},[t,n]);return a.jsx(Ka,{icon:a.jsx(Ea,{}),onClickCapture:s,"aria-label":e("gallery.deleteImage",{count:1}),tooltip:e("gallery.deleteImage",{count:1}),isDestructive:!0})});KQ.displayName="ContextMenuItemDeleteImage";const ZQ=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Q(),s=Si(),i=IS(),o=Io(),r=h.useCallback(()=>{s&&n(V1e({imageDTO:s}))},[n,s]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(nS,{}),children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.filter.filters")})}),a.jsx(Zt,{...t.menuListProps,children:a.jsx(be,{icon:a.jsx(u1,{}),isDisabled:o||i,onClick:r,children:e("controlLayers.filter.pbr_maps.label")})})]})})});ZQ.displayName="ContextMenuItemFiltersSubMenu";const XQ=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Si(),s=hS(n),i=pS(n);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(K_,{}),children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("parameters.recallMetadata")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(be,{icon:a.jsx(q4,{}),onClick:s.recall,isDisabled:!s.isEnabled,children:e("parameters.usePrompt")}),a.jsx(be,{icon:a.jsx(W4,{}),onClick:i.recall,isDisabled:!i.isEnabled,children:e("parameters.useSeed")})]})]})})});XQ.displayName="ContextMenuItemMetadataRecallActionsUpscaleTab";const YQ=({imageDTO:e})=>{const t=M(un);return a.jsxs(jNe,{value:e,children:[a.jsxs(Lm,{children:[a.jsx(VQ,{}),a.jsx(MQ,{}),a.jsx(LQ,{}),a.jsx($Q,{}),a.jsx(GQ,{}),a.jsx(KQ,{})]}),a.jsx(Yi,{}),a.jsx(RQ,{}),(t==="canvas"||t==="generate")&&a.jsx(FQ,{}),t==="upscaling"&&a.jsx(XQ,{}),a.jsx(Yi,{}),a.jsx(HQ,{}),(t==="canvas"||t==="generate")&&a.jsx(qQ,{}),a.jsx(UQ,{}),a.jsx(BQ,{}),t==="canvas"&&a.jsx(zQ,{}),a.jsx(ZQ,{}),a.jsx(Yi,{}),a.jsx(DQ,{}),a.jsx(WQ,{}),(t==="canvas"||t==="generate"||t==="workflows"||t==="upscaling")&&!e.is_intermediate&&a.jsx(NQ,{})]})},NNe=500,FNe=10,bf=Gw({isOpen:!1,imageDTO:null,position:{x:-1,y:-1}}),iv=()=>{bf.setKey("isOpen",!1)},dT=new Map,BNe=e=>Array.from(dT.entries()).find(n=>n[0].contains(e))?.[1],QQ=(e,t)=>{h.useEffect(()=>{if(t===null)return;const n=t instanceof HTMLElement?t:t.current;if(n)return dT.set(n,e),()=>{dT.delete(n)}},[e,t])},JQ=h.memo(()=>{mn("ImageContextMenu");const e=le(bf);return im(iv),a.jsxs(Ls,{children:[a.jsxs(An,{isOpen:e.isOpen,gutter:0,placement:"auto-end",onClose:iv,children:[a.jsx(Pn,{"aria-hidden":!0,w:1,h:1,position:"absolute",left:e.position.x,top:e.position.y,cursor:"default",bg:"transparent",_hover:zNe,pointerEvents:"none"}),a.jsx(tJ,{})]}),a.jsx(eJ,{})]})});JQ.displayName="ImageContextMenu";const zNe={bg:"transparent"},eJ=h.memo(()=>{const e=h.useRef({x:-1,y:-1}),t=h.useRef(0),n=h.useRef(0),s=h.useCallback(c=>{if(c.shiftKey){iv();return}const d=BNe(c.target);if(!d){iv();return}window.clearTimeout(n.current),c.preventDefault(),e.current.x!==c.pageX||e.current.y!==c.pageY?(bf.get().isOpen&&iv(),n.current=window.setTimeout(()=>{bf.set({isOpen:!0,position:{x:c.pageX,y:c.pageY},imageDTO:d})},100)):bf.set({isOpen:!0,position:{x:c.pageX,y:c.pageY},imageDTO:d}),e.current={x:c.pageX,y:c.pageY}},[]),i=h.useCallback(c=>{c.pointerType!=="mouse"&&(t.current=window.setTimeout(()=>{s(c)},NNe),e.current={x:c.pageX,y:c.pageY})},[s]),o=h.useCallback(c=>{if(c.pointerType==="mouse"||t.current===null)return;const d=e.current;Math.hypot(c.pageX-d.x,c.pageY-d.y)>FNe&&clearTimeout(t.current)},[]),r=h.useCallback(c=>{c.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]),l=h.useCallback(c=>{c.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]);return h.useEffect(()=>{const c=new AbortController;return window.addEventListener("contextmenu",s,{signal:c.signal}),window.addEventListener("pointerdown",i,{signal:c.signal}),window.addEventListener("pointerup",r,{signal:c.signal}),window.addEventListener("pointercancel",l,{signal:c.signal}),window.addEventListener("pointermove",o,{signal:c.signal}),()=>{c.abort()}},[s,l,i,o,r]),h.useEffect(()=>()=>{window.clearTimeout(n.current),window.clearTimeout(t.current)},[]),null});eJ.displayName="ImageContextMenuEventLogical";const tJ=h.memo(()=>{const e=M(Oy),t=le(bf);return t.imageDTO?e>1?a.jsx(Zt,{visibility:"visible",children:a.jsx(INe,{})}):a.jsx(Zt,{visibility:"visible",children:a.jsx(YQ,{imageDTO:t.imageDTO})}):null});tJ.displayName="MenuContent";const[nJ]=lS(!1),jS=()=>{const{t:e}=T(),t=Q(),n=nJ(),s=_m(),i=Pm(),o=h.useCallback(()=>{t(uW()),t(Gl("edit")),i.close(),Ne.focusPanel("workflows",Zn),pe({id:"NEW_WORKFLOW_CREATED",title:e("workflows.newWorkflowCreated"),status:"success"}),n.close()},[n,t,e,i]),r=h.useCallback(()=>{if(!s){o();return}n.open()},[s,n,o]);return{createImmediate:o,createWithDialog:r}},sJ=h.memo(()=>{mn("NewWorkflowConfirmationAlertDialog");const{t:e}=T(),t=nJ(),n=jS();return a.jsx(Ko,{isOpen:t.isOpen,onClose:t.close,title:e("nodes.newWorkflow"),acceptCallback:n.createImmediate,useInert:!1,acceptButtonText:e("common.load"),children:a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsx(q,{children:e("nodes.newWorkflowDesc")}),a.jsx(q,{variant:"subtext",children:e("nodes.newWorkflowDesc2")})]})})});sJ.displayName="NewWorkflowConfirmationAlertDialog";const iJ=h.memo(()=>{const e=jS(),{t}=T(),n=h.useCallback(s=>{s.stopPropagation(),e.createWithDialog()},[e]);return a.jsx(he,{onClick:n,variant:"ghost",leftIcon:a.jsx(Q_,{}),justifyContent:"flex-start",children:t("nodes.newWorkflow")})});iJ.displayName="NewWorkflowButton";var Oj={exports:{}},Nj,l7;function VNe(){if(l7)return Nj;l7=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Nj=e,Nj}var Fj,c7;function $Ne(){if(c7)return Fj;c7=1;var e=VNe();function t(){}function n(){}return n.resetWarningCache=t,Fj=function(){function s(r,l,c,d,u,p){if(p!==e){var m=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw m.name="Invariant Violation",m}}s.isRequired=s;function i(){return s}var o={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:i,element:s,elementType:s,instanceOf:i,node:s,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:n,resetWarningCache:t};return o.PropTypes=o,o},Fj}var d7;function GNe(){return d7||(d7=1,Oj.exports=$Ne()()),Oj.exports}var HNe=GNe();const Gn=Xf(HNe);var Il=function(){return Il=Object.assign||function(t){for(var n,s=1,i=arguments.length;s<i;s++){n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},Il.apply(this,arguments)};function oJ(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]]);return n}function Xh(e,t,n,s){function i(o){return o instanceof n?o:new n(function(r){r(o)})}return new(n||(n=Promise))(function(o,r){function l(u){try{d(s.next(u))}catch(p){r(p)}}function c(u){try{d(s.throw(u))}catch(p){r(p)}}function d(u){u.done?o(u.value):i(u.value).then(l,c)}d((s=s.apply(e,t||[])).next())})}function WNe(e,t,n){if(n||arguments.length===2)for(var s=0,i=t.length,o;s<i;s++)(o||!(s in t))&&(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))}const UNe=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Of(e,t,n){const s=qNe(e),{webkitRelativePath:i}=e,o=typeof t=="string"?t:typeof i=="string"&&i.length>0?i:`./${e.name}`;return typeof s.path!="string"&&u7(s,"path",o),u7(s,"relativePath",o),s}function qNe(e){const{name:t}=e;if(t&&t.lastIndexOf(".")!==-1&&!e.type){const s=t.split(".").pop().toLowerCase(),i=UNe.get(s);i&&Object.defineProperty(e,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return e}function u7(e,t,n){Object.defineProperty(e,t,{value:n,writable:!1,configurable:!1,enumerable:!0})}const KNe=[".DS_Store","Thumbs.db"];function ZNe(e){return Xh(this,void 0,void 0,function*(){return DC(e)&&XNe(e.dataTransfer)?eFe(e.dataTransfer,e.type):YNe(e)?QNe(e):Array.isArray(e)&&e.every(t=>"getFile"in t&&typeof t.getFile=="function")?JNe(e):[]})}function XNe(e){return DC(e)}function YNe(e){return DC(e)&&DC(e.target)}function DC(e){return typeof e=="object"&&e!==null}function QNe(e){return uT(e.target.files).map(t=>Of(t))}function JNe(e){return Xh(this,void 0,void 0,function*(){return(yield Promise.all(e.map(n=>n.getFile()))).map(n=>Of(n))})}function eFe(e,t){return Xh(this,void 0,void 0,function*(){if(e.items){const n=uT(e.items).filter(i=>i.kind==="file");if(t!=="drop")return n;const s=yield Promise.all(n.map(tFe));return h7(aJ(s))}return h7(uT(e.files).map(n=>Of(n)))})}function h7(e){return e.filter(t=>KNe.indexOf(t.name)===-1)}function uT(e){if(e===null)return[];const t=[];for(let n=0;n<e.length;n++){const s=e[n];t.push(s)}return t}function tFe(e){if(typeof e.webkitGetAsEntry!="function")return p7(e);const t=e.webkitGetAsEntry();return t&&t.isDirectory?rJ(t):p7(e,t)}function aJ(e){return e.reduce((t,n)=>[...t,...Array.isArray(n)?aJ(n):[n]],[])}function p7(e,t){return Xh(this,void 0,void 0,function*(){var n;if(globalThis.isSecureContext&&typeof e.getAsFileSystemHandle=="function"){const o=yield e.getAsFileSystemHandle();if(o===null)throw new Error(`${e} is not a File`);if(o!==void 0){const r=yield o.getFile();return r.handle=o,Of(r)}}const s=e.getAsFile();if(!s)throw new Error(`${e} is not a File`);return Of(s,(n=t?.fullPath)!==null&&n!==void 0?n:void 0)})}function nFe(e){return Xh(this,void 0,void 0,function*(){return e.isDirectory?rJ(e):sFe(e)})}function rJ(e){const t=e.createReader();return new Promise((n,s)=>{const i=[];function o(){t.readEntries(r=>Xh(this,void 0,void 0,function*(){if(r.length){const l=Promise.all(r.map(nFe));i.push(l),o()}else try{const l=yield Promise.all(i);n(l)}catch(l){s(l)}}),r=>{s(r)})}o()})}function sFe(e){return Xh(this,void 0,void 0,function*(){return new Promise((t,n)=>{e.file(s=>{const i=Of(s,e.fullPath);t(i)},s=>{n(s)})})})}var lx={},f7;function iFe(){return f7||(f7=1,lx.__esModule=!0,lx.default=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(",");if(n.length===0)return!0;var s=e.name||"",i=(e.type||"").toLowerCase(),o=i.replace(/\/.*$/,"");return n.some(function(r){var l=r.trim().toLowerCase();return l.charAt(0)==="."?s.toLowerCase().endsWith(l):l.endsWith("/*")?o===l.replace(/\/.*$/,""):i===l})}return!0}),lx}var oFe=iFe();const Bj=Xf(oFe);function m7(e){return lFe(e)||rFe(e)||cJ(e)||aFe()}function aFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function lFe(e){if(Array.isArray(e))return hT(e)}function g7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function v7(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g7(Object(n),!0).forEach(function(s){lJ(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g7(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function lJ(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ey(e,t){return uFe(e)||dFe(e,t)||cJ(e,t)||cFe()}function cFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cJ(e,t){if(e){if(typeof e=="string")return hT(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hT(e,t)}}function hT(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function dFe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],i=!0,o=!1,r,l;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(s.push(r.value),!(t&&s.length===t));i=!0);}catch(c){o=!0,l=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(o)throw l}}return s}}function uFe(e){if(Array.isArray(e))return e}var hFe=typeof Bj=="function"?Bj:Bj.default,pFe="file-invalid-type",fFe="file-too-large",mFe="file-too-small",gFe="too-many-files",vFe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",n=t.split(","),s=n.length>1?"one of ".concat(n.join(", ")):n[0];return{code:pFe,message:"File type must be ".concat(s)}},y7=function(t){return{code:fFe,message:"File is larger than ".concat(t," ").concat(t===1?"byte":"bytes")}},b7=function(t){return{code:mFe,message:"File is smaller than ".concat(t," ").concat(t===1?"byte":"bytes")}},yFe={code:gFe,message:"Too many files"};function dJ(e,t){var n=e.type==="application/x-moz-file"||hFe(e,t);return[n,n?null:vFe(t)]}function uJ(e,t,n){if(Hu(e.size))if(Hu(t)&&Hu(n)){if(e.size>n)return[!1,y7(n)];if(e.size<t)return[!1,b7(t)]}else{if(Hu(t)&&e.size<t)return[!1,b7(t)];if(Hu(n)&&e.size>n)return[!1,y7(n)]}return[!0,null]}function Hu(e){return e!=null}function bFe(e){var t=e.files,n=e.accept,s=e.minSize,i=e.maxSize,o=e.multiple,r=e.maxFiles,l=e.validator;return!o&&t.length>1||o&&r>=1&&t.length>r?!1:t.every(function(c){var d=dJ(c,n),u=ey(d,1),p=u[0],m=uJ(c,s,i),f=ey(m,1),g=f[0],v=l?l(c):null;return p&&g&&!v})}function MC(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function cx(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(t){return t==="Files"||t==="application/x-moz-file"}):!!e.target&&!!e.target.files}function x7(e){e.preventDefault()}function xFe(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function CFe(e){return e.indexOf("Edge/")!==-1}function wFe(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return xFe(e)||CFe(e)}function ol(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){for(var i=arguments.length,o=new Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];return t.some(function(l){return!MC(s)&&l&&l.apply(void 0,[s].concat(o)),MC(s)})}}function _Fe(){return"showOpenFilePicker"in window}function SFe(e){if(Hu(e)){var t=Object.entries(e).filter(function(n){var s=ey(n,2),i=s[0],o=s[1],r=!0;return hJ(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),r=!1),(!Array.isArray(o)||!o.every(pJ))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),r=!1),r}).reduce(function(n,s){var i=ey(s,2),o=i[0],r=i[1];return v7(v7({},n),{},lJ({},o,r))},{});return[{description:"Files",accept:t}]}return e}function kFe(e){if(Hu(e))return Object.entries(e).reduce(function(t,n){var s=ey(n,2),i=s[0],o=s[1];return[].concat(m7(t),[i],m7(o))},[]).filter(function(t){return hJ(t)||pJ(t)}).join(",")}function IFe(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function jFe(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function hJ(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||e==="application/*"||/\w+\/[-+.\w]+/g.test(e)}function pJ(e){return/^.*\.[\w]+$/.test(e)}var EFe=["children"],AFe=["open"],PFe=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],TFe=["refKey","onChange","onClick"];function DFe(e){return RFe(e)||LFe(e)||fJ(e)||MFe()}function MFe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LFe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function RFe(e){if(Array.isArray(e))return pT(e)}function zj(e,t){return FFe(e)||NFe(e,t)||fJ(e,t)||OFe()}function OFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fJ(e,t){if(e){if(typeof e=="string")return pT(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pT(e,t)}}function pT(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function NFe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],i=!0,o=!1,r,l;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(s.push(r.value),!(t&&s.length===t));i=!0);}catch(c){o=!0,l=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(o)throw l}}return s}}function FFe(e){if(Array.isArray(e))return e}function C7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function hs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?C7(Object(n),!0).forEach(function(s){fT(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C7(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function fT(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function LC(e,t){if(e==null)return{};var n=BFe(e,t),s,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)s=o[i],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function BFe(e,t){if(e==null)return{};var n={},s=Object.keys(e),i,o;for(o=0;o<s.length;o++)i=s[o],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}var s6=h.forwardRef(function(e,t){var n=e.children,s=LC(e,EFe),i=oc(s),o=i.open,r=LC(i,AFe);return h.useImperativeHandle(t,function(){return{open:o}},[o]),ce.createElement(h.Fragment,null,n(hs(hs({},r),{},{open:o})))});s6.displayName="Dropzone";var mJ={disabled:!1,getFilesFromEvent:ZNe,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};s6.defaultProps=mJ;s6.propTypes={children:Gn.func,accept:Gn.objectOf(Gn.arrayOf(Gn.string)),multiple:Gn.bool,preventDropOnDocument:Gn.bool,noClick:Gn.bool,noKeyboard:Gn.bool,noDrag:Gn.bool,noDragEventsBubbling:Gn.bool,minSize:Gn.number,maxSize:Gn.number,maxFiles:Gn.number,disabled:Gn.bool,getFilesFromEvent:Gn.func,onFileDialogCancel:Gn.func,onFileDialogOpen:Gn.func,useFsAccessApi:Gn.bool,autoFocus:Gn.bool,onDragEnter:Gn.func,onDragLeave:Gn.func,onDragOver:Gn.func,onDrop:Gn.func,onDropAccepted:Gn.func,onDropRejected:Gn.func,onError:Gn.func,validator:Gn.func};var mT={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function oc(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=hs(hs({},mJ),e),n=t.accept,s=t.disabled,i=t.getFilesFromEvent,o=t.maxSize,r=t.minSize,l=t.multiple,c=t.maxFiles,d=t.onDragEnter,u=t.onDragLeave,p=t.onDragOver,m=t.onDrop,f=t.onDropAccepted,g=t.onDropRejected,v=t.onFileDialogCancel,b=t.onFileDialogOpen,C=t.useFsAccessApi,y=t.autoFocus,x=t.preventDropOnDocument,w=t.noClick,_=t.noKeyboard,S=t.noDrag,I=t.noDragEventsBubbling,k=t.onError,E=t.validator,j=h.useMemo(function(){return kFe(n)},[n]),P=h.useMemo(function(){return SFe(n)},[n]),D=h.useMemo(function(){return typeof b=="function"?b:w7},[b]),O=h.useMemo(function(){return typeof v=="function"?v:w7},[v]),N=h.useRef(null),F=h.useRef(null),X=h.useReducer(zFe,mT),L=zj(X,2),V=L[0],K=L[1],U=V.isFocused,Z=V.isFileDialogActive,W=h.useRef(typeof window<"u"&&window.isSecureContext&&C&&_Fe()),R=function(){!W.current&&Z&&setTimeout(function(){if(F.current){var me=F.current.files;me.length||(K({type:"closeDialog"}),O())}},300)};h.useEffect(function(){return window.addEventListener("focus",R,!1),function(){window.removeEventListener("focus",R,!1)}},[F,Z,O,W]);var G=h.useRef([]),H=function(me){N.current&&N.current.contains(me.target)||(me.preventDefault(),G.current=[])};h.useEffect(function(){return x&&(document.addEventListener("dragover",x7,!1),document.addEventListener("drop",H,!1)),function(){x&&(document.removeEventListener("dragover",x7),document.removeEventListener("drop",H))}},[N,x]),h.useEffect(function(){return!s&&y&&N.current&&N.current.focus(),function(){}},[N,y,s]);var $=h.useCallback(function(de){k?k(de):console.error(de)},[k]),z=h.useCallback(function(de){de.preventDefault(),de.persist(),se(de),G.current=[].concat(DFe(G.current),[de.target]),cx(de)&&Promise.resolve(i(de)).then(function(me){if(!(MC(de)&&!I)){var Ee=me.length,tt=Ee>0&&bFe({files:me,accept:j,minSize:r,maxSize:o,multiple:l,maxFiles:c,validator:E}),ut=Ee>0&&!tt;K({isDragAccept:tt,isDragReject:ut,isDragActive:!0,type:"setDraggedFiles"}),d&&d(de)}}).catch(function(me){return $(me)})},[i,d,$,I,j,r,o,l,c,E]),B=h.useCallback(function(de){de.preventDefault(),de.persist(),se(de);var me=cx(de);if(me&&de.dataTransfer)try{de.dataTransfer.dropEffect="copy"}catch{}return me&&p&&p(de),!1},[p,I]),Y=h.useCallback(function(de){de.preventDefault(),de.persist(),se(de);var me=G.current.filter(function(tt){return N.current&&N.current.contains(tt)}),Ee=me.indexOf(de.target);Ee!==-1&&me.splice(Ee,1),G.current=me,!(me.length>0)&&(K({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),cx(de)&&u&&u(de))},[N,u,I]),ie=h.useCallback(function(de,me){var Ee=[],tt=[];de.forEach(function(ut){var Yt=dJ(ut,j),gn=zj(Yt,2),$t=gn[0],Ws=gn[1],Lo=uJ(ut,r,o),ki=zj(Lo,2),vr=ki[0],Da=ki[1],Ii=E?E(ut):null;if($t&&vr&&!Ii)Ee.push(ut);else{var yr=[Ws,Da];Ii&&(yr=yr.concat(Ii)),tt.push({file:ut,errors:yr.filter(function(id){return id})})}}),(!l&&Ee.length>1||l&&c>=1&&Ee.length>c)&&(Ee.forEach(function(ut){tt.push({file:ut,errors:[yFe]})}),Ee.splice(0)),K({acceptedFiles:Ee,fileRejections:tt,isDragReject:tt.length>0,type:"setFiles"}),m&&m(Ee,tt,me),tt.length>0&&g&&g(tt,me),Ee.length>0&&f&&f(Ee,me)},[K,l,j,r,o,c,m,f,g,E]),ge=h.useCallback(function(de){de.preventDefault(),de.persist(),se(de),G.current=[],cx(de)&&Promise.resolve(i(de)).then(function(me){MC(de)&&!I||ie(me,de)}).catch(function(me){return $(me)}),K({type:"reset"})},[i,ie,$,I]),xe=h.useCallback(function(){if(W.current){K({type:"openDialog"}),D();var de={multiple:l,types:P};window.showOpenFilePicker(de).then(function(me){return i(me)}).then(function(me){ie(me,null),K({type:"closeDialog"})}).catch(function(me){IFe(me)?(O(me),K({type:"closeDialog"})):jFe(me)?(W.current=!1,F.current?(F.current.value=null,F.current.click()):$(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):$(me)});return}F.current&&(K({type:"openDialog"}),D(),F.current.value=null,F.current.click())},[K,D,O,C,ie,$,P,l]),we=h.useCallback(function(de){!N.current||!N.current.isEqualNode(de.target)||(de.key===" "||de.key==="Enter"||de.keyCode===32||de.keyCode===13)&&(de.preventDefault(),xe())},[N,xe]),je=h.useCallback(function(){K({type:"focus"})},[]),Re=h.useCallback(function(){K({type:"blur"})},[]),Ct=h.useCallback(function(){w||(wFe()?setTimeout(xe,0):xe())},[w,xe]),Xe=function(me){return s?null:me},Qe=function(me){return _?null:Xe(me)},Dt=function(me){return S?null:Xe(me)},se=function(me){I&&me.stopPropagation()},re=h.useMemo(function(){return function(){var de=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},me=de.refKey,Ee=me===void 0?"ref":me,tt=de.role,ut=de.onKeyDown,Yt=de.onFocus,gn=de.onBlur,$t=de.onClick,Ws=de.onDragEnter,Lo=de.onDragOver,ki=de.onDragLeave,vr=de.onDrop,Da=LC(de,PFe);return hs(hs(fT({onKeyDown:Qe(ol(ut,we)),onFocus:Qe(ol(Yt,je)),onBlur:Qe(ol(gn,Re)),onClick:Xe(ol($t,Ct)),onDragEnter:Dt(ol(Ws,z)),onDragOver:Dt(ol(Lo,B)),onDragLeave:Dt(ol(ki,Y)),onDrop:Dt(ol(vr,ge)),role:typeof tt=="string"&&tt!==""?tt:"presentation"},Ee,N),!s&&!_?{tabIndex:0}:{}),Da)}},[N,we,je,Re,Ct,z,B,Y,ge,_,S,s]),ue=h.useCallback(function(de){de.stopPropagation()},[]),Se=h.useMemo(function(){return function(){var de=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},me=de.refKey,Ee=me===void 0?"ref":me,tt=de.onChange,ut=de.onClick,Yt=LC(de,TFe),gn=fT({accept:j,multiple:l,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Xe(ol(tt,ge)),onClick:Xe(ol(ut,ue)),tabIndex:-1},Ee,F);return hs(hs({},gn),Yt)}},[F,n,l,ge,s]);return hs(hs({},V),{},{isFocused:U&&!s,getRootProps:re,getInputProps:Se,rootRef:N,inputRef:F,open:Xe(xe)})}function zFe(e,t){switch(t.type){case"focus":return hs(hs({},e),{},{isFocused:!0});case"blur":return hs(hs({},e),{},{isFocused:!1});case"openDialog":return hs(hs({},mT),{},{isFileDialogActive:!0});case"closeDialog":return hs(hs({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return hs(hs({},e),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return hs(hs({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections,isDragReject:t.isDragReject});case"reset":return hs({},mT);default:return e}}function w7(){}const gJ=h.memo(()=>{const{t:e}=T(),t=ed(),n=h.useCallback(([o])=>{o&&t({type:"file",data:o})},[t]),{getInputProps:s,getRootProps:i}=oc({accept:{"application/json":[".json"]},onDropAccepted:n,noDrag:!0,multiple:!1});return a.jsxs(a.Fragment,{children:[a.jsx(he,{leftIcon:a.jsx(p1,{}),...i(),pointerEvents:"auto",variant:"ghost",justifyContent:"flex-start",children:e("workflows.uploadWorkflow")}),a.jsx("input",{...s()})]})});gJ.displayName="UploadWorkflowButton";const VFe=()=>{const{t:e}=T();return a.jsxs(A,{h:"full",minH:0,overflow:"hidden",flexDir:"column",w:64,gap:0,children:[a.jsxs(A,{flexDir:"column",w:"full",pb:2,gap:2,children:[a.jsx(Nf,{view:"recent",children:e("workflows.recentlyOpened")}),a.jsx(vJ,{})]}),a.jsxs(A,{h:"full",minH:0,overflow:"hidden",flexDir:"column",children:[a.jsx(yJ,{}),a.jsx(bJ,{})]}),a.jsx(At,{}),a.jsx(iJ,{}),a.jsx(gJ,{})]})},vJ=h.memo(()=>{const{t:e}=T(),t=M(fu),n=Q(),s=M(Ny),i=h.useCallback(()=>{n(hW())},[n]);return t==="yours"&&s.length>0?a.jsxs(zn,{children:[a.jsx(Nf,{view:"yours",w:"auto",children:e("workflows.yourWorkflows")}),a.jsx(He,{label:e("workflows.deselectAll"),children:a.jsx(oe,{onClick:i,size:"md","aria-label":e("workflows.deselectAll"),icon:a.jsx(Gs,{size:12}),variant:"ghost",bg:"base.700",color:"base.50"})})]}):a.jsx(Nf,{view:"yours",children:e("workflows.yourWorkflows")})});vJ.displayName="YourWorkflowsButton";const yJ=h.memo(()=>{const{t:e}=T(),t=M(fu),n=Q(),s=M(Ny),i=h.useCallback(()=>{n(hW())},[n]);return t==="defaults"&&s.length>0?a.jsxs(zn,{children:[a.jsx(Nf,{view:"defaults",w:"auto",children:e("workflows.browseWorkflows")}),a.jsx(He,{label:e("workflows.deselectAll"),children:a.jsx(oe,{onClick:i,size:"md","aria-label":e("workflows.deselectAll"),icon:a.jsx(Gs,{size:12}),variant:"ghost",bg:"base.700",color:"base.50"})})]}):a.jsx(Nf,{view:"defaults",children:e("workflows.browseWorkflows")})});yJ.displayName="BrowseWorkflowsButton";const $Fe=mr({visibility:"visible"}).options,bJ=h.memo(()=>{const e=M(fu);return a.jsx(mu,{in:e==="defaults"||e==="yours",children:a.jsx(A,{flexDir:"column",gap:2,pl:4,py:2,overflow:"hidden",h:"100%",minH:0,children:a.jsx(ti,{style:ic,options:$Fe,children:a.jsx(A,{flexDir:"column",gap:2,overflow:"auto",children:e==="yours"?a.jsx(CJ,{}):a.jsx(xJ,{})})})})})});bJ.displayName="TagCheckboxesCollapsible";const xJ=h.memo(()=>a.jsx(a.Fragment,{children:$1e.map(e=>a.jsx(SJ,{tagCategory:e},e.categoryTKey))}));xJ.displayName="StaticTagCategories";const CJ=h.memo(()=>{const{t:e}=T(),{data:t,isLoading:n}=YTe({categories:["user"]});return n?a.jsx(q,{color:"base.400",children:e("common.loading")}):!t||t.length===0?null:a.jsx(A,{flexDir:"column",gap:2,children:t.map(s=>a.jsx(wJ,{tag:s},s))})});CJ.displayName="DynamicTagsList";const wJ=h.memo(({tag:e})=>{const t=Q(),s=M(Ny).includes(e),i=GFe(e),o=h.useCallback(()=>{t(pW(e))},[t,e]);return i===0?null:a.jsxs(A,{alignItems:"center",gap:2,children:[a.jsx(us,{isChecked:s,onChange:o,flexShrink:0}),a.jsx(q,{children:`${e} (${i})`})]})});wJ.displayName="DynamicTagCheckbox";const GFe=e=>{const t=h.useMemo(()=>({tags:[e],categories:["user"]}),[e]),n=h.useMemo(()=>({selectFromResult:({data:i})=>({count:i?.[e]??0})}),[e]),{count:s}=N4(t,n);return s},_J=()=>{const e=M(fu);return h.useMemo(()=>({tags:G1e.map(t=>t.label),categories:e==="yours"?["user"]:["default"]}),[e])},HFe=e=>{const t=_J(),n=h.useMemo(()=>({selectFromResult:({data:i})=>({count:i?.[e]??0})}),[e]),{count:s}=N4(t,n);return s},WFe=e=>{const t=_J(),n=h.useMemo(()=>({selectFromResult:({data:i})=>i?{count:e.tags.reduce((o,r)=>o+(i[r.label]??0),0)}:{count:0}}),[e]),{count:s}=N4(t,n);return s},Nf=h.memo(({view:e,...t})=>{const n=o_(),s=M(fu),i=h.useCallback(()=>{n(M0(e))},[n,e]);return a.jsx(he,{variant:"ghost",justifyContent:"flex-start",size:"md",flexShrink:0,w:"full",onClick:i,...t,bg:s===e?"base.700":void 0,color:s===e?"base.50":void 0})});Nf.displayName="NavButton";const SJ=h.memo(({tagCategory:e})=>{const{t}=T();return WFe(e)===0?null:a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsx(q,{fontWeight:"semibold",color:"base.300",flexShrink:0,children:t(e.categoryTKey)}),a.jsx(A,{flexDir:"column",gap:2,pl:4,children:e.tags.map(s=>a.jsx(kJ,{tag:s},s.label))})]})});SJ.displayName="TagCategory";const kJ=h.memo(({tag:e,...t})=>{const n=Q(),{t:s}=T(),o=M(Ny).includes(e.label),r=HFe(e.label),l=h.useCallback(()=>{n(pW(e.label))},[n,e]);return r===0?null:a.jsxs(A,{alignItems:"center",gap:2,children:[a.jsx(us,{isChecked:o,onChange:l,...t,flexShrink:0}),a.jsx(q,{children:`${e.label} (${r})`}),e.recommended&&a.jsx(He,{label:s("workflows.recommended"),children:a.jsx(ke,{as:"span",lineHeight:0,children:a.jsx(Je,{as:sS,boxSize:4,fill:"invokeYellow.500"})})})]})});kJ.displayName="TagCheckbox";const IJ=h.memo(({searchInputRef:e})=>{const t=Q(),n=M(fW),{t:s}=T(),i=h.useCallback(c=>{t(BL(c))},[t]),o=h.useCallback(()=>{t(BL(""))},[t]),r=h.useCallback(c=>{c.key==="Escape"&&o()},[o]),l=h.useCallback(c=>{i(c.target.value)},[i]);return h.useEffect(()=>{e.current&&e.current.focus()},[e]),a.jsx(A,{justifyContent:"flex-end",w:"300px",children:a.jsxs(tc,{children:[a.jsx(Nt,{ref:e,placeholder:s("workflows.searchPlaceholder"),value:n,onKeyDown:r,onChange:l}),n&&n.length&&a.jsx(Hr,{h:"full",pe:2,children:a.jsx(oe,{onClick:o,size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:a.jsx(fn,{})})})]})})});IJ.displayName="WorkflowSearch";const UFe=Ds(["opened_at","created_at","updated_at","name"]),qFe=e=>UFe.safeParse(e).success,KFe=Ds(["ASC","DESC"]),ZFe=e=>KFe.safeParse(e).success,XFe=()=>{const{t:e}=T(),t=M(mW),n=M(gW),s=h.useMemo(()=>({opened_at:e("workflows.opened"),created_at:e("workflows.created"),updated_at:e("workflows.updated"),name:e("workflows.name")}),[e]),i=h.useMemo(()=>({ASC:e("workflows.ascending"),DESC:e("workflows.descending")}),[e]),o=Q(),r=h.useCallback(c=>{qFe(c.target.value)&&o(H1e(c.target.value))},[o]),l=h.useCallback(c=>{ZFe(c.target.value)&&o(W1e(c.target.value))},[o]);return a.jsxs(A,{flexDir:"row",gap:6,children:[a.jsxs(te,{orientation:"horizontal",gap:0,w:"auto",children:[a.jsx(ne,{children:e("common.orderBy")}),a.jsx(Mi,{value:t,onChange:r,size:"sm",children:U1e.map(c=>a.jsx("option",{value:c,children:s[c]},c))})]}),a.jsxs(te,{orientation:"horizontal",gap:0,w:"auto",children:[a.jsx(ne,{children:e("common.direction")}),a.jsxs(Mi,{value:n,onChange:l,size:"sm",children:[a.jsx("option",{value:"ASC",children:i.ASC}),a.jsx("option",{value:"DESC",children:i.DESC})]})]})]})},YFe=()=>{const e=h.useRef(null),t=M(fu);return a.jsxs(A,{gap:8,justifyContent:"space-between",children:[a.jsx(IJ,{searchInputRef:e}),t!=="recent"&&a.jsx(XFe,{})]})},i6=De(null),QFe=()=>i6.set(null),JFe=()=>h.useCallback(t=>{i6.set(t)},[]),e7e=()=>{mn("DeleteWorkflowDialog");const{t:e}=T(),t=le(i6),[n]=JTe(),s=h.useCallback(async()=>{if(t)try{await n(t).unwrap(),pe({id:"WORKFLOW_DELETED",title:e("toast.workflowDeleted")})}catch{pe({id:`AUTH_ERROR_TOAST_${d1.endpoints.deleteWorkflow.name}`,title:e("toast.problemDeletingWorkflow"),status:"error"})}},[n,e,t]);return a.jsx(Ko,{isOpen:t!==null,onClose:QFe,title:e("workflows.deleteWorkflow"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:a.jsx(q,{children:e("workflows.deleteWorkflow2")})})},t7e=({workflowId:e})=>{const{t}=T(),n=JFe(),s=h.useCallback(i=>{i.stopPropagation(),n(e)},[n,e]);return a.jsx(He,{label:t("workflows.delete"),closeOnScroll:!0,children:a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":t("workflows.delete"),onClick:s,colorScheme:"error",icon:a.jsx(Qc,{})})})},n7e=()=>{const{t:e}=T(),t=Q(),[n,s]=WZ(),i=h.useCallback(()=>{pe({status:"error",description:e("nodes.downloadWorkflowError")})},[e]);return{downloadWorkflow:h.useCallback(async r=>{try{const{data:l}=await n(r);if(!l){i();return}const{workflow:c}=l,d=new Blob([JSON.stringify(c,null,2)]),u=document.createElement("a");u.href=URL.createObjectURL(d),u.download=`${c.name||"My Workflow"}.json`,document.body.appendChild(u),u.click(),u.remove(),t(lY())}catch{i()}},[t,i,n]),isLoading:s.isLoading}},s7e=({workflowId:e})=>{const t=n7e(),n=h.useCallback(i=>{i.stopPropagation(),t.downloadWorkflow(e)},[t,e]),{t:s}=T();return a.jsx(He,{label:s("workflows.download"),closeOnScroll:!0,children:a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":s("workflows.download"),onClick:n,icon:a.jsx(Wh,{}),isLoading:t.isLoading})})},i7e=({workflowId:e})=>{const t=Q(),n=ed(),{t:s}=T(),i=h.useCallback(o=>{o.stopPropagation(),n({type:"library",data:e,onSuccess:()=>{t(Gl("edit"))}})},[t,n,e]);return a.jsx(He,{label:s("workflows.edit"),closeOnScroll:!0,children:a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":s("workflows.edit"),onClick:i,icon:a.jsx(Im,{})})})},o7e=({workflowId:e})=>{const t=Q(),n=ed(),{t:s}=T(),i=h.useCallback(o=>{o.stopPropagation(),n({type:"library",data:e,onSuccess:()=>{t(Gl("view"))}})},[t,n,e]);return a.jsx(He,{label:s("workflows.view"),closeOnScroll:!0,children:a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":s("workflows.view"),onClick:i,icon:a.jsx(bu,{})})})},Md="108px",jJ="32px",EJ="workflow-action-buttons",a7e={_hover:{bg:"base.700",[`& .${EJ}`]:{display:"flex"}}},AJ=h.memo(({workflow:e})=>{const{t}=T(),n=Q(),s=M(nM),i=ed(),o=h.useMemo(()=>s===e.workflow_id,[s,e.workflow_id]),r=h.useMemo(()=>e.tags?e.tags.split(",").map(c=>c.trim()).filter(c=>c.length>0):[],[e.tags]),l=h.useCallback(()=>{i({type:"library",data:e.workflow_id,onSuccess:()=>{n(Gl("view"))}})},[n,i,e.workflow_id]);return a.jsxs(A,{position:"relative",role:"button",onClick:l,bg:"base.750",borderRadius:"base",w:"full",alignItems:"stretch",sx:a7e,gap:2,children:[a.jsx(A,{p:2,pr:0,children:a.jsx(Nn,{src:e.thumbnail_url??void 0,fallbackStrategy:"beforeLoadOrError",fallback:e.category==="default"?a.jsx(TJ,{}):a.jsx(PJ,{}),objectFit:"cover",objectPosition:"50% 50%",height:Md,width:Md,minHeight:Md,minWidth:Md,borderRadius:"base"})}),a.jsxs(A,{flexDir:"column",gap:1,justifyContent:"space-between",w:"full",children:[a.jsxs(A,{flexDir:"column",gap:1,alignItems:"flex-start",pt:2,pe:2,w:"full",children:[a.jsxs(A,{gap:2,alignItems:"flex-start",justifyContent:"space-between",w:"full",children:[a.jsx(q,{noOfLines:2,children:e.name}),a.jsxs(A,{gap:2,alignItems:"center",children:[o&&a.jsx(Bi,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,variant:"subtle",children:t("workflows.opened")}),e.category==="default"&&a.jsx(Nn,{src:vW,alt:"invoke-logo",w:"14px",h:"14px",minW:"14px",minH:"14px",userSelect:"none",opacity:.5})]})]}),a.jsx(q,{variant:"subtext",fontSize:"xs",noOfLines:3,children:e.description}),r.length>0&&a.jsxs(q,{fontSize:"xs",noOfLines:1,children:[a.jsxs(q,{as:"span",color:"base.400",children:[t("workflows.tags"),":"," "]}),a.jsx(q,{as:"span",color:"base.400",children:r.join(", ")})]})]}),a.jsxs(A,{className:EJ,alignItems:"center",display:"none",h:8,children:[e.opened_at&&a.jsxs(q,{variant:"subtext",fontSize:"xs",noOfLines:1,justifySelf:"flex-end",pb:.5,children:[t("workflows.opened")," ",new Date(e.opened_at).toLocaleString()]}),a.jsx(At,{}),e.category==="default"&&a.jsx(o7e,{workflowId:e.workflow_id}),e.category!=="default"&&a.jsxs(a.Fragment,{children:[a.jsx(i7e,{workflowId:e.workflow_id}),a.jsx(s7e,{workflowId:e.workflow_id}),a.jsx(t7e,{workflowId:e.workflow_id})]})]})]})]})});AJ.displayName="WorkflowListItem";const PJ=h.memo(()=>a.jsx(A,{height:Md,minWidth:Md,bg:"base.600",borderRadius:"base",alignItems:"center",justifyContent:"center",opacity:.3,children:a.jsx(Je,{as:rC,boxSize:jJ})}));PJ.displayName="UserThumbnailFallback";const TJ=h.memo(()=>a.jsx(A,{height:Md,minWidth:Md,bg:"base.600",borderRadius:"base",alignItems:"center",justifyContent:"center",opacity:.3,children:a.jsx(Nn,{src:vW,alt:"invoke-logo",userSelect:"none",boxSize:jJ,p:1})}));TJ.displayName="DefaultThumbnailFallback";const r7e=30,l7e=e=>{switch(e){case"defaults":return["default"];case"recent":return["user","default"];case"yours":return["user"];default:ae(!1)}},c7e=e=>{if(e==="recent")return!0},d7e=()=>{const e=M(mW),t=M(gW),n=M(fW),s=M(Ny),i=M(fu),[o]=el(n,500);return h.useMemo(()=>({page:0,per_page:r7e,order_by:e??"opened_at",direction:t,categories:l7e(i),query:o,tags:i==="defaults"||i==="yours"?s:[],has_been_opened:c7e(i)}),[e,t,i,o,s])},u7e={selectFromResult:({data:e,...t})=>({items:e?.pages.map(({items:n})=>n).flat()??os,...t})},DJ=h.memo(()=>{const e=d7e(),{items:t,isFetching:n,isLoading:s,fetchNextPage:i,hasNextPage:o}=tDe(e,u7e);return s?a.jsx(A,{alignItems:"center",justifyContent:"center",w:"full",h:"full",children:a.jsx(ao,{})}):t.length===0?a.jsx(MJ,{}):a.jsx(LJ,{items:t,hasNextPage:o,fetchNextPage:i,isFetching:n})});DJ.displayName="WorkflowList";const MJ=h.memo(()=>{const{t:e}=T(),t=M(q1e);return a.jsx(On,{fontSize:"sm",py:4,label:e(t?"nodes.noMatchingWorkflows":"nodes.noWorkflows"),icon:null})});MJ.displayName="NoItems";const LJ=h.memo(({items:e,hasNextPage:t,isFetching:n,fetchNextPage:s})=>{const{t:i}=T(),o=h.useRef(null),r=h.useCallback(()=>{if(!t||n)return;const c=o.current;if(!c)return;const{scrollTop:d,scrollHeight:u,clientHeight:p}=c;Math.abs(u-(d+p))<=1&&s()},[t,n,s]),l=h.useCallback(()=>{!t||n||!o.current||s()},[t,n,s]);return a.jsxs(A,{flexDir:"column",gap:4,flex:1,minH:0,children:[a.jsx(Ms,{ref:o,templateColumns:"repeat(auto-fill, minmax(360px, 1fr))",gridAutoFlow:"dense",gap:4,overflow:"scroll",onScroll:r,children:e.map(c=>a.jsx(_t,{id:`grid-${c.workflow_id}`,children:a.jsx(AJ,{workflow:c},c.workflow_id)},c.workflow_id))}),a.jsx(At,{}),t&&a.jsx(he,{onClick:l,isLoading:n,loadingText:i("common.loading"),variant:"ghost",w:"min-content",alignSelf:"center",children:i("workflows.loadMore")})]})});LJ.displayName="WorkflowListContent";const RJ=h.memo(()=>{const{t:e}=T(),t=Pm(),n=f7e();return a.jsxs(Zo,{isOpen:t.isOpen,onClose:t.close,isCentered:!0,children:[a.jsx(ro,{}),a.jsxs(Xo,{w:"calc(100% - var(--invoke-sizes-40))",maxW:"calc(100% - var(--invoke-sizes-40))",h:"calc(100% - var(--invoke-sizes-40))",maxH:"calc(100% - var(--invoke-sizes-40))",children:[a.jsx(lo,{children:e("workflows.workflowLibrary")}),a.jsx(Yr,{}),a.jsxs(vi,{pb:6,children:[n&&a.jsxs(A,{gap:4,h:"100%",children:[a.jsx(VFe,{}),a.jsx(vt,{orientation:"vertical"}),a.jsxs(A,{flexDir:"column",flex:1,gap:4,children:[a.jsx(YFe,{}),a.jsx(DJ,{})]})]}),!n&&a.jsx(On,{label:e("workflows.loading"),icon:null})]})]})]})});RJ.displayName="WorkflowLibraryModal";const h7e={categories:["user","default"],has_been_opened:!0},p7e={categories:["user"]},_7={selectFromResult:({data:e,isLoading:t})=>e?{count:Object.values(e).reduce((n,s)=>n+s,0),isLoading:t}:{count:0,isLoading:!0}},f7e=()=>{const e=Q(),t=M(fu),[n,s]=h.useState(!1),{count:i,isLoading:o}=bN(h7e,_7),{count:r,isLoading:l}=bN(p7e,_7);return h.useEffect(()=>{n||o||l||(i===0&&t==="recent"?r>0?e(M0("yours")):e(M0("defaults")):r===0&&t==="yours"&&(i>0?e(M0("recent")):e(M0("defaults"))),s(!0))},[n,e,o,l,i,t,r]),n},m7e=()=>{const{t:e}=T(),{data:t}=ur(),n=le(ks),[s,{isLoading:i}]=K1e({fixedCacheKey:"cancelAllExceptCurrent"});return{trigger:h.useCallback(async()=>{if(t?.queue.pending)try{await s().unwrap(),pe({id:"QUEUE_CANCEL_SUCCEEDED",title:e("queue.cancelSucceeded"),status:"success"})}catch{pe({id:"QUEUE_CANCEL_FAILED",title:e("queue.cancelFailed"),status:"error"})}},[t?.queue.pending,s,e]),isLoading:i,isDisabled:!n||!t?.queue.pending}},[g7e]=qh(!1),o6=()=>{const e=g7e(),t=m7e();return{trigger:t.trigger,isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,isLoading:t.isLoading,isDisabled:t.isDisabled}},OJ=h.memo(()=>{mn("CancelAllExceptCurrentQueueItemConfirmationAlertDialog");const{t:e}=T(),t=o6();return a.jsxs(Ko,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.cancelAllExceptCurrentTooltip"),acceptCallback:t.trigger,acceptButtonText:e("queue.confirm"),useInert:!1,children:[a.jsx(q,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog")}),a.jsx("br",{}),a.jsx(q,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog2")})]})});OJ.displayName="CancelAllExceptCurrentQueueItemConfirmationAlertDialog";const[v7e]=qh(!1),a6=()=>{const e=v7e(),t=xK();return{isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,trigger:t.trigger,isLoading:t.isLoading,isDisabled:t.isDisabled}},NJ=h.memo(()=>{mn("ClearQueueConfirmationsAlertDialog");const{t:e}=T(),t=a6();return a.jsxs(Ko,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.clearTooltip"),acceptCallback:t.trigger,acceptButtonText:e("queue.clear"),useInert:!1,children:[a.jsx(q,{children:e("queue.clearQueueAlertDialog")}),a.jsx("br",{}),a.jsx(q,{children:e("queue.clearQueueAlertDialog2")})]})});NJ.displayName="ClearQueueConfirmationsAlertDialog";const y7e=()=>{const{t:e}=T(),{data:t}=ur(),n=le(ks),[s,{isLoading:i}]=Z1e({fixedCacheKey:"deleteAllExceptCurrent"});return{trigger:h.useCallback(async()=>{if(t?.queue.pending)try{await s().unwrap(),pe({id:"QUEUE_CANCEL_SUCCEEDED",title:e("queue.cancelSucceeded"),status:"success"})}catch{pe({id:"QUEUE_CANCEL_FAILED",title:e("queue.cancelFailed"),status:"error"})}},[t?.queue.pending,s,e]),isLoading:i,isDisabled:!n||!t?.queue.pending}},[b7e]=qh(!1),r6=()=>{const e=b7e(),t=y7e();return{trigger:t.trigger,isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,isLoading:t.isLoading,isDisabled:t.isDisabled}},FJ=h.memo(()=>{mn("DeleteAllExceptCurrentQueueItemConfirmationAlertDialog");const{t:e}=T(),t=r6();return a.jsxs(Ko,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.cancelAllExceptCurrentTooltip"),acceptCallback:t.trigger,acceptButtonText:e("queue.confirm"),useInert:!1,children:[a.jsx(q,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog")}),a.jsx("br",{}),a.jsx(q,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog2")})]})});FJ.displayName="DeleteAllExceptCurrentQueueItemConfirmationAlertDialog";const l6=De(null),x7e=()=>l6.set(null),C7e=()=>h.useCallback(t=>{l6.set(t)},[]),BJ=h.memo(()=>{mn("DeleteStylePresetDialog");const{t:e}=T(),t=le(l6),[n]=X1e(),s=h.useCallback(async()=>{if(t)try{await n(t.id).unwrap(),pe({status:"success",title:e("stylePresets.templateDeleted")})}catch{pe({status:"error",title:e("stylePresets.unableToDeleteTemplate")})}},[t,n,e]);return a.jsx(Ko,{isOpen:t!==null,onClose:x7e,title:e("stylePresets.deleteTemplate"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:a.jsx(q,{children:e("stylePresets.deleteTemplate2")})})});BJ.displayName="DeleteStylePresetDialog";var x1=e=>e.type==="checkbox",Qu=e=>e instanceof Date,mo=e=>e==null;const zJ=e=>typeof e=="object";var Ts=e=>!mo(e)&&!Array.isArray(e)&&zJ(e)&&!Qu(e),VJ=e=>Ts(e)&&e.target?x1(e.target)?e.target.checked:e.target.value:e,w7e=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,$J=(e,t)=>e.has(w7e(t)),_7e=e=>{const t=e.constructor&&e.constructor.prototype;return Ts(t)&&t.hasOwnProperty("isPrototypeOf")},c6=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function qs(e){let t;const n=Array.isArray(e),s=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!(c6&&(e instanceof Blob||s))&&(n||Ts(e)))if(t=n?[]:{},!n&&!_7e(e))t=e;else for(const i in e)e.hasOwnProperty(i)&&(t[i]=qs(e[i]));else return e;return t}var ES=e=>/^\w*$/.test(e),Ps=e=>e===void 0,d6=e=>Array.isArray(e)?e.filter(Boolean):[],u6=e=>d6(e.replace(/["|']|\]/g,"").split(/\.|\[/)),qe=(e,t,n)=>{if(!t||!Ts(e))return n;const s=(ES(t)?[t]:u6(t)).reduce((i,o)=>mo(i)?i:i[o],e);return Ps(s)||s===e?Ps(e[t])?n:e[t]:s},ca=e=>typeof e=="boolean",qn=(e,t,n)=>{let s=-1;const i=ES(t)?[t]:u6(t),o=i.length,r=o-1;for(;++s<o;){const l=i[s];let c=n;if(s!==r){const d=e[l];c=Ts(d)||Array.isArray(d)?d:isNaN(+i[s+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;e[l]=c,e=e[l]}};const RC={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Tr={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},pc={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},GJ=ce.createContext(null);GJ.displayName="HookFormContext";const h6=()=>ce.useContext(GJ);var HJ=(e,t,n,s=!0)=>{const i={defaultValues:t._defaultValues};for(const o in e)Object.defineProperty(i,o,{get:()=>{const r=o;return t._proxyFormState[r]!==Tr.all&&(t._proxyFormState[r]=!s||Tr.all),n&&(n[r]=!0),e[r]}});return i};const p6=typeof window<"u"?h.useLayoutEffect:h.useEffect;function S7e(e){const t=h6(),{control:n=t.control,disabled:s,name:i,exact:o}=e||{},[r,l]=ce.useState(n._formState),c=ce.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return p6(()=>n._subscribe({name:i,formState:c.current,exact:o,callback:d=>{!s&&l({...n._formState,...d})}}),[i,s,o]),ce.useEffect(()=>{c.current.isValid&&n._setValid(!0)},[n]),ce.useMemo(()=>HJ(r,n,c.current,!1),[r,n])}var Pl=e=>typeof e=="string",WJ=(e,t,n,s,i)=>Pl(e)?(s&&t.watch.add(e),qe(n,e,i)):Array.isArray(e)?e.map(o=>(s&&t.watch.add(o),qe(n,o))):(s&&(t.watchAll=!0),n);function k7e(e){const t=h6(),{control:n=t.control,name:s,defaultValue:i,disabled:o,exact:r}=e||{},l=ce.useRef(i),[c,d]=ce.useState(n._getWatch(s,l.current));return p6(()=>n._subscribe({name:s,formState:{values:!0},exact:r,callback:u=>!o&&d(WJ(s,n._names,u.values||n._formValues,!1,l.current))}),[s,n,o,r]),ce.useEffect(()=>n._removeUnmounted()),c}function si(e){const t=h6(),{name:n,disabled:s,control:i=t.control,shouldUnregister:o}=e,r=$J(i._names.array,n),l=k7e({control:i,name:n,defaultValue:qe(i._formValues,n,qe(i._defaultValues,n,e.defaultValue)),exact:!0}),c=S7e({control:i,name:n,exact:!0}),d=ce.useRef(e),u=ce.useRef(i.register(n,{...e.rules,value:l,...ca(e.disabled)?{disabled:e.disabled}:{}})),p=ce.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!qe(c.errors,n)},isDirty:{enumerable:!0,get:()=>!!qe(c.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!qe(c.touchedFields,n)},isValidating:{enumerable:!0,get:()=>!!qe(c.validatingFields,n)},error:{enumerable:!0,get:()=>qe(c.errors,n)}}),[c,n]),m=ce.useCallback(b=>u.current.onChange({target:{value:VJ(b),name:n},type:RC.CHANGE}),[n]),f=ce.useCallback(()=>u.current.onBlur({target:{value:qe(i._formValues,n),name:n},type:RC.BLUR}),[n,i._formValues]),g=ce.useCallback(b=>{const C=qe(i._fields,n);C&&b&&(C._f.ref={focus:()=>b.focus&&b.focus(),select:()=>b.select&&b.select(),setCustomValidity:y=>b.setCustomValidity(y),reportValidity:()=>b.reportValidity()})},[i._fields,n]),v=ce.useMemo(()=>({name:n,value:l,...ca(s)||c.disabled?{disabled:c.disabled||s}:{},onChange:m,onBlur:f,ref:g}),[n,s,c.disabled,m,f,g,l]);return ce.useEffect(()=>{const b=i._options.shouldUnregister||o;i.register(n,{...d.current.rules,...ca(d.current.disabled)?{disabled:d.current.disabled}:{}});const C=(y,x)=>{const w=qe(i._fields,y);w&&w._f&&(w._f.mount=x)};if(C(n,!0),b){const y=qs(qe(i._options.defaultValues,n));qn(i._defaultValues,n,y),Ps(qe(i._formValues,n))&&qn(i._formValues,n,y)}return!r&&i.register(n),()=>{(r?b&&!i._state.action:b)?i.unregister(n):C(n,!1)}},[n,i,r,o]),ce.useEffect(()=>{i._setDisabledField({disabled:s,name:n})},[s,n,i]),ce.useMemo(()=>({field:v,formState:c,fieldState:p}),[v,c,p])}var I7e=(e,t,n,s,i)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[s]:i||!0}}:{},ov=e=>Array.isArray(e)?e:[e],S7=()=>{let e=[];return{get observers(){return e},next:i=>{for(const o of e)o.next&&o.next(i)},subscribe:i=>(e.push(i),{unsubscribe:()=>{e=e.filter(o=>o!==i)}}),unsubscribe:()=>{e=[]}}},gT=e=>mo(e)||!zJ(e);function wd(e,t,n=new WeakSet){if(gT(e)||gT(t))return e===t;if(Qu(e)&&Qu(t))return e.getTime()===t.getTime();const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;if(n.has(e)||n.has(t))return!0;n.add(e),n.add(t);for(const o of s){const r=e[o];if(!i.includes(o))return!1;if(o!=="ref"){const l=t[o];if(Qu(r)&&Qu(l)||Ts(r)&&Ts(l)||Array.isArray(r)&&Array.isArray(l)?!wd(r,l,n):r!==l)return!1}}return!0}var No=e=>Ts(e)&&!Object.keys(e).length,f6=e=>e.type==="file",Dr=e=>typeof e=="function",OC=e=>{if(!c6)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},UJ=e=>e.type==="select-multiple",m6=e=>e.type==="radio",j7e=e=>m6(e)||x1(e),Vj=e=>OC(e)&&e.isConnected;function E7e(e,t){const n=t.slice(0,-1).length;let s=0;for(;s<n;)e=Ps(e)?s++:e[t[s++]];return e}function A7e(e){for(const t in e)if(e.hasOwnProperty(t)&&!Ps(e[t]))return!1;return!0}function Os(e,t){const n=Array.isArray(t)?t:ES(t)?[t]:u6(t),s=n.length===1?e:E7e(e,n),i=n.length-1,o=n[i];return s&&delete s[o],i!==0&&(Ts(s)&&No(s)||Array.isArray(s)&&A7e(s))&&Os(e,n.slice(0,-1)),e}var qJ=e=>{for(const t in e)if(Dr(e[t]))return!0;return!1};function NC(e,t={}){const n=Array.isArray(e);if(Ts(e)||n)for(const s in e)Array.isArray(e[s])||Ts(e[s])&&!qJ(e[s])?(t[s]=Array.isArray(e[s])?[]:{},NC(e[s],t[s])):mo(e[s])||(t[s]=!0);return t}function KJ(e,t,n){const s=Array.isArray(e);if(Ts(e)||s)for(const i in e)Array.isArray(e[i])||Ts(e[i])&&!qJ(e[i])?Ps(t)||gT(n[i])?n[i]=Array.isArray(e[i])?NC(e[i],[]):{...NC(e[i])}:KJ(e[i],mo(t)?{}:t[i],n[i]):n[i]=!wd(e[i],t[i]);return n}var n0=(e,t)=>KJ(e,t,NC(t));const k7={value:!1,isValid:!1},I7={value:!0,isValid:!0};var ZJ=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Ps(e[0].attributes.value)?Ps(e[0].value)||e[0].value===""?I7:{value:e[0].value,isValid:!0}:I7:k7}return k7},XJ=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:s})=>Ps(e)?e:t?e===""?NaN:e&&+e:n&&Pl(e)?new Date(e):s?s(e):e;const j7={isValid:!1,value:null};var YJ=e=>Array.isArray(e)?e.reduce((t,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:t,j7):j7;function E7(e){const t=e.ref;return f6(t)?t.files:m6(t)?YJ(e.refs).value:UJ(t)?[...t.selectedOptions].map(({value:n})=>n):x1(t)?ZJ(e.refs).value:XJ(Ps(t.value)?e.ref.value:t.value,e)}var P7e=(e,t,n,s)=>{const i={};for(const o of e){const r=qe(t,o);r&&qn(i,o,r._f)}return{criteriaMode:n,names:[...e],fields:i,shouldUseNativeValidation:s}},FC=e=>e instanceof RegExp,s0=e=>Ps(e)?e:FC(e)?e.source:Ts(e)?FC(e.value)?e.value.source:e.value:e,A7=e=>({isOnSubmit:!e||e===Tr.onSubmit,isOnBlur:e===Tr.onBlur,isOnChange:e===Tr.onChange,isOnAll:e===Tr.all,isOnTouch:e===Tr.onTouched});const P7="AsyncFunction";var T7e=e=>!!e&&!!e.validate&&!!(Dr(e.validate)&&e.validate.constructor.name===P7||Ts(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===P7)),D7e=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),T7=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some(s=>e.startsWith(s)&&/^\.\w+/.test(e.slice(s.length))));const av=(e,t,n,s)=>{for(const i of n||Object.keys(e)){const o=qe(e,i);if(o){const{_f:r,...l}=o;if(r){if(r.refs&&r.refs[0]&&t(r.refs[0],i)&&!s)return!0;if(r.ref&&t(r.ref,r.name)&&!s)return!0;if(av(l,t))break}else if(Ts(l)&&av(l,t))break}}};function D7(e,t,n){const s=qe(e,n);if(s||ES(n))return{error:s,name:n};const i=n.split(".");for(;i.length;){const o=i.join("."),r=qe(t,o),l=qe(e,o);if(r&&!Array.isArray(r)&&n!==o)return{name:n};if(l&&l.type)return{name:o,error:l};if(l&&l.root&&l.root.type)return{name:`${o}.root`,error:l.root};i.pop()}return{name:n}}var M7e=(e,t,n,s)=>{n(e);const{name:i,...o}=e;return No(o)||Object.keys(o).length>=Object.keys(t).length||Object.keys(o).find(r=>t[r]===(!s||Tr.all))},L7e=(e,t,n)=>!e||!t||e===t||ov(e).some(s=>s&&(n?s===t:s.startsWith(t)||t.startsWith(s))),R7e=(e,t,n,s,i)=>i.isOnAll?!1:!n&&i.isOnTouch?!(t||e):(n?s.isOnBlur:i.isOnBlur)?!e:(n?s.isOnChange:i.isOnChange)?e:!0,O7e=(e,t)=>!d6(qe(e,t)).length&&Os(e,t),N7e=(e,t,n)=>{const s=ov(qe(e,n));return qn(s,"root",t[n]),qn(e,n,s),e},C2=e=>Pl(e);function M7(e,t,n="validate"){if(C2(e)||Array.isArray(e)&&e.every(C2)||ca(e)&&!e)return{type:n,message:C2(e)?e:"",ref:t}}var fp=e=>Ts(e)&&!FC(e)?e:{value:e,message:""},L7=async(e,t,n,s,i,o)=>{const{ref:r,refs:l,required:c,maxLength:d,minLength:u,min:p,max:m,pattern:f,validate:g,name:v,valueAsNumber:b,mount:C}=e._f,y=qe(n,v);if(!C||t.has(v))return{};const x=l?l[0]:r,w=D=>{i&&x.reportValidity&&(x.setCustomValidity(ca(D)?"":D||""),x.reportValidity())},_={},S=m6(r),I=x1(r),k=S||I,E=(b||f6(r))&&Ps(r.value)&&Ps(y)||OC(r)&&r.value===""||y===""||Array.isArray(y)&&!y.length,j=I7e.bind(null,v,s,_),P=(D,O,N,F=pc.maxLength,X=pc.minLength)=>{const L=D?O:N;_[v]={type:D?F:X,message:L,ref:r,...j(D?F:X,L)}};if(o?!Array.isArray(y)||!y.length:c&&(!k&&(E||mo(y))||ca(y)&&!y||I&&!ZJ(l).isValid||S&&!YJ(l).isValid)){const{value:D,message:O}=C2(c)?{value:!!c,message:c}:fp(c);if(D&&(_[v]={type:pc.required,message:O,ref:x,...j(pc.required,O)},!s))return w(O),_}if(!E&&(!mo(p)||!mo(m))){let D,O;const N=fp(m),F=fp(p);if(!mo(y)&&!isNaN(y)){const X=r.valueAsNumber||y&&+y;mo(N.value)||(D=X>N.value),mo(F.value)||(O=X<F.value)}else{const X=r.valueAsDate||new Date(y),L=U=>new Date(new Date().toDateString()+" "+U),V=r.type=="time",K=r.type=="week";Pl(N.value)&&y&&(D=V?L(y)>L(N.value):K?y>N.value:X>new Date(N.value)),Pl(F.value)&&y&&(O=V?L(y)<L(F.value):K?y<F.value:X<new Date(F.value))}if((D||O)&&(P(!!D,N.message,F.message,pc.max,pc.min),!s))return w(_[v].message),_}if((d||u)&&!E&&(Pl(y)||o&&Array.isArray(y))){const D=fp(d),O=fp(u),N=!mo(D.value)&&y.length>+D.value,F=!mo(O.value)&&y.length<+O.value;if((N||F)&&(P(N,D.message,O.message),!s))return w(_[v].message),_}if(f&&!E&&Pl(y)){const{value:D,message:O}=fp(f);if(FC(D)&&!y.match(D)&&(_[v]={type:pc.pattern,message:O,ref:r,...j(pc.pattern,O)},!s))return w(O),_}if(g){if(Dr(g)){const D=await g(y,n),O=M7(D,x);if(O&&(_[v]={...O,...j(pc.validate,O.message)},!s))return w(O.message),_}else if(Ts(g)){let D={};for(const O in g){if(!No(D)&&!s)break;const N=M7(await g[O](y,n),x,O);N&&(D={...N,...j(O,N.message)},w(N.message),s&&(_[v]=D))}if(!No(D)&&(_[v]={ref:x,...D},!s))return _}}return w(!0),_};const F7e={mode:Tr.onSubmit,reValidateMode:Tr.onChange,shouldFocusError:!0};function B7e(e={}){let t={...F7e,...e},n={submitCount:0,isDirty:!1,isReady:!1,isLoading:Dr(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},s={},i=Ts(t.defaultValues)||Ts(t.values)?qs(t.defaultValues||t.values)||{}:{},o=t.shouldUnregister?{}:qs(i),r={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},c,d=0;const u={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let p={...u};const m={array:S7(),state:S7()},f=t.criteriaMode===Tr.all,g=se=>re=>{clearTimeout(d),d=setTimeout(se,re)},v=async se=>{if(!t.disabled&&(u.isValid||p.isValid||se)){const re=t.resolver?No((await I()).errors):await E(s,!0);re!==n.isValid&&m.state.next({isValid:re})}},b=(se,re)=>{!t.disabled&&(u.isValidating||u.validatingFields||p.isValidating||p.validatingFields)&&((se||Array.from(l.mount)).forEach(ue=>{ue&&(re?qn(n.validatingFields,ue,re):Os(n.validatingFields,ue))}),m.state.next({validatingFields:n.validatingFields,isValidating:!No(n.validatingFields)}))},C=(se,re=[],ue,Se,de=!0,me=!0)=>{if(Se&&ue&&!t.disabled){if(r.action=!0,me&&Array.isArray(qe(s,se))){const Ee=ue(qe(s,se),Se.argA,Se.argB);de&&qn(s,se,Ee)}if(me&&Array.isArray(qe(n.errors,se))){const Ee=ue(qe(n.errors,se),Se.argA,Se.argB);de&&qn(n.errors,se,Ee),O7e(n.errors,se)}if((u.touchedFields||p.touchedFields)&&me&&Array.isArray(qe(n.touchedFields,se))){const Ee=ue(qe(n.touchedFields,se),Se.argA,Se.argB);de&&qn(n.touchedFields,se,Ee)}(u.dirtyFields||p.dirtyFields)&&(n.dirtyFields=n0(i,o)),m.state.next({name:se,isDirty:P(se,re),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else qn(o,se,re)},y=(se,re)=>{qn(n.errors,se,re),m.state.next({errors:n.errors})},x=se=>{n.errors=se,m.state.next({errors:n.errors,isValid:!1})},w=(se,re,ue,Se)=>{const de=qe(s,se);if(de){const me=qe(o,se,Ps(ue)?qe(i,se):ue);Ps(me)||Se&&Se.defaultChecked||re?qn(o,se,re?me:E7(de._f)):N(se,me),r.mount&&v()}},_=(se,re,ue,Se,de)=>{let me=!1,Ee=!1;const tt={name:se};if(!t.disabled){if(!ue||Se){(u.isDirty||p.isDirty)&&(Ee=n.isDirty,n.isDirty=tt.isDirty=P(),me=Ee!==tt.isDirty);const ut=wd(qe(i,se),re);Ee=!!qe(n.dirtyFields,se),ut?Os(n.dirtyFields,se):qn(n.dirtyFields,se,!0),tt.dirtyFields=n.dirtyFields,me=me||(u.dirtyFields||p.dirtyFields)&&Ee!==!ut}if(ue){const ut=qe(n.touchedFields,se);ut||(qn(n.touchedFields,se,ue),tt.touchedFields=n.touchedFields,me=me||(u.touchedFields||p.touchedFields)&&ut!==ue)}me&&de&&m.state.next(tt)}return me?tt:{}},S=(se,re,ue,Se)=>{const de=qe(n.errors,se),me=(u.isValid||p.isValid)&&ca(re)&&n.isValid!==re;if(t.delayError&&ue?(c=g(()=>y(se,ue)),c(t.delayError)):(clearTimeout(d),c=null,ue?qn(n.errors,se,ue):Os(n.errors,se)),(ue?!wd(de,ue):de)||!No(Se)||me){const Ee={...Se,...me&&ca(re)?{isValid:re}:{},errors:n.errors,name:se};n={...n,...Ee},m.state.next(Ee)}},I=async se=>{b(se,!0);const re=await t.resolver(o,t.context,P7e(se||l.mount,s,t.criteriaMode,t.shouldUseNativeValidation));return b(se),re},k=async se=>{const{errors:re}=await I(se);if(se)for(const ue of se){const Se=qe(re,ue);Se?qn(n.errors,ue,Se):Os(n.errors,ue)}else n.errors=re;return re},E=async(se,re,ue={valid:!0})=>{for(const Se in se){const de=se[Se];if(de){const{_f:me,...Ee}=de;if(me){const tt=l.array.has(me.name),ut=de._f&&T7e(de._f);ut&&u.validatingFields&&b([Se],!0);const Yt=await L7(de,l.disabled,o,f,t.shouldUseNativeValidation&&!re,tt);if(ut&&u.validatingFields&&b([Se]),Yt[me.name]&&(ue.valid=!1,re))break;!re&&(qe(Yt,me.name)?tt?N7e(n.errors,Yt,me.name):qn(n.errors,me.name,Yt[me.name]):Os(n.errors,me.name))}!No(Ee)&&await E(Ee,re,ue)}}return ue.valid},j=()=>{for(const se of l.unMount){const re=qe(s,se);re&&(re._f.refs?re._f.refs.every(ue=>!Vj(ue)):!Vj(re._f.ref))&&z(se)}l.unMount=new Set},P=(se,re)=>!t.disabled&&(se&&re&&qn(o,se,re),!wd(U(),i)),D=(se,re,ue)=>WJ(se,l,{...r.mount?o:Ps(re)?i:Pl(se)?{[se]:re}:re},ue,re),O=se=>d6(qe(r.mount?o:i,se,t.shouldUnregister?qe(i,se,[]):[])),N=(se,re,ue={})=>{const Se=qe(s,se);let de=re;if(Se){const me=Se._f;me&&(!me.disabled&&qn(o,se,XJ(re,me)),de=OC(me.ref)&&mo(re)?"":re,UJ(me.ref)?[...me.ref.options].forEach(Ee=>Ee.selected=de.includes(Ee.value)):me.refs?x1(me.ref)?me.refs.forEach(Ee=>{(!Ee.defaultChecked||!Ee.disabled)&&(Array.isArray(de)?Ee.checked=!!de.find(tt=>tt===Ee.value):Ee.checked=de===Ee.value||!!de)}):me.refs.forEach(Ee=>Ee.checked=Ee.value===de):f6(me.ref)?me.ref.value="":(me.ref.value=de,me.ref.type||m.state.next({name:se,values:qs(o)})))}(ue.shouldDirty||ue.shouldTouch)&&_(se,de,ue.shouldTouch,ue.shouldDirty,!0),ue.shouldValidate&&K(se)},F=(se,re,ue)=>{for(const Se in re){if(!re.hasOwnProperty(Se))return;const de=re[Se],me=se+"."+Se,Ee=qe(s,me);(l.array.has(se)||Ts(de)||Ee&&!Ee._f)&&!Qu(de)?F(me,de,ue):N(me,de,ue)}},X=(se,re,ue={})=>{const Se=qe(s,se),de=l.array.has(se),me=qs(re);qn(o,se,me),de?(m.array.next({name:se,values:qs(o)}),(u.isDirty||u.dirtyFields||p.isDirty||p.dirtyFields)&&ue.shouldDirty&&m.state.next({name:se,dirtyFields:n0(i,o),isDirty:P(se,me)})):Se&&!Se._f&&!mo(me)?F(se,me,ue):N(se,me,ue),T7(se,l)&&m.state.next({...n}),m.state.next({name:r.mount?se:void 0,values:qs(o)})},L=async se=>{r.mount=!0;const re=se.target;let ue=re.name,Se=!0;const de=qe(s,ue),me=ut=>{Se=Number.isNaN(ut)||Qu(ut)&&isNaN(ut.getTime())||wd(ut,qe(o,ue,ut))},Ee=A7(t.mode),tt=A7(t.reValidateMode);if(de){let ut,Yt;const gn=re.type?E7(de._f):VJ(se),$t=se.type===RC.BLUR||se.type===RC.FOCUS_OUT,Ws=!D7e(de._f)&&!t.resolver&&!qe(n.errors,ue)&&!de._f.deps||R7e($t,qe(n.touchedFields,ue),n.isSubmitted,tt,Ee),Lo=T7(ue,l,$t);qn(o,ue,gn),$t?(de._f.onBlur&&de._f.onBlur(se),c&&c(0)):de._f.onChange&&de._f.onChange(se);const ki=_(ue,gn,$t),vr=!No(ki)||Lo;if(!$t&&m.state.next({name:ue,type:se.type,values:qs(o)}),Ws)return(u.isValid||p.isValid)&&(t.mode==="onBlur"?$t&&v():$t||v()),vr&&m.state.next({name:ue,...Lo?{}:ki});if(!$t&&Lo&&m.state.next({...n}),t.resolver){const{errors:Da}=await I([ue]);if(me(gn),Se){const Ii=D7(n.errors,s,ue),yr=D7(Da,s,Ii.name||ue);ut=yr.error,ue=yr.name,Yt=No(Da)}}else b([ue],!0),ut=(await L7(de,l.disabled,o,f,t.shouldUseNativeValidation))[ue],b([ue]),me(gn),Se&&(ut?Yt=!1:(u.isValid||p.isValid)&&(Yt=await E(s,!0)));Se&&(de._f.deps&&K(de._f.deps),S(ue,Yt,ut,ki))}},V=(se,re)=>{if(qe(n.errors,re)&&se.focus)return se.focus(),1},K=async(se,re={})=>{let ue,Se;const de=ov(se);if(t.resolver){const me=await k(Ps(se)?se:de);ue=No(me),Se=se?!de.some(Ee=>qe(me,Ee)):ue}else se?(Se=(await Promise.all(de.map(async me=>{const Ee=qe(s,me);return await E(Ee&&Ee._f?{[me]:Ee}:Ee)}))).every(Boolean),!(!Se&&!n.isValid)&&v()):Se=ue=await E(s);return m.state.next({...!Pl(se)||(u.isValid||p.isValid)&&ue!==n.isValid?{}:{name:se},...t.resolver||!se?{isValid:ue}:{},errors:n.errors}),re.shouldFocus&&!Se&&av(s,V,se?de:l.mount),Se},U=se=>{const re={...r.mount?o:i};return Ps(se)?re:Pl(se)?qe(re,se):se.map(ue=>qe(re,ue))},Z=(se,re)=>({invalid:!!qe((re||n).errors,se),isDirty:!!qe((re||n).dirtyFields,se),error:qe((re||n).errors,se),isValidating:!!qe(n.validatingFields,se),isTouched:!!qe((re||n).touchedFields,se)}),W=se=>{se&&ov(se).forEach(re=>Os(n.errors,re)),m.state.next({errors:se?n.errors:{}})},R=(se,re,ue)=>{const Se=(qe(s,se,{_f:{}})._f||{}).ref,de=qe(n.errors,se)||{},{ref:me,message:Ee,type:tt,...ut}=de;qn(n.errors,se,{...ut,...re,ref:Se}),m.state.next({name:se,errors:n.errors,isValid:!1}),ue&&ue.shouldFocus&&Se&&Se.focus&&Se.focus()},G=(se,re)=>Dr(se)?m.state.subscribe({next:ue=>se(D(void 0,re),ue)}):D(se,re,!0),H=se=>m.state.subscribe({next:re=>{L7e(se.name,re.name,se.exact)&&M7e(re,se.formState||u,Xe,se.reRenderRoot)&&se.callback({values:{...o},...n,...re})}}).unsubscribe,$=se=>(r.mount=!0,p={...p,...se.formState},H({...se,formState:p})),z=(se,re={})=>{for(const ue of se?ov(se):l.mount)l.mount.delete(ue),l.array.delete(ue),re.keepValue||(Os(s,ue),Os(o,ue)),!re.keepError&&Os(n.errors,ue),!re.keepDirty&&Os(n.dirtyFields,ue),!re.keepTouched&&Os(n.touchedFields,ue),!re.keepIsValidating&&Os(n.validatingFields,ue),!t.shouldUnregister&&!re.keepDefaultValue&&Os(i,ue);m.state.next({values:qs(o)}),m.state.next({...n,...re.keepDirty?{isDirty:P()}:{}}),!re.keepIsValid&&v()},B=({disabled:se,name:re})=>{(ca(se)&&r.mount||se||l.disabled.has(re))&&(se?l.disabled.add(re):l.disabled.delete(re))},Y=(se,re={})=>{let ue=qe(s,se);const Se=ca(re.disabled)||ca(t.disabled);return qn(s,se,{...ue||{},_f:{...ue&&ue._f?ue._f:{ref:{name:se}},name:se,mount:!0,...re}}),l.mount.add(se),ue?B({disabled:ca(re.disabled)?re.disabled:t.disabled,name:se}):w(se,!0,re.value),{...Se?{disabled:re.disabled||t.disabled}:{},...t.progressive?{required:!!re.required,min:s0(re.min),max:s0(re.max),minLength:s0(re.minLength),maxLength:s0(re.maxLength),pattern:s0(re.pattern)}:{},name:se,onChange:L,onBlur:L,ref:de=>{if(de){Y(se,re),ue=qe(s,se);const me=Ps(de.value)&&de.querySelectorAll&&de.querySelectorAll("input,select,textarea")[0]||de,Ee=j7e(me),tt=ue._f.refs||[];if(Ee?tt.find(ut=>ut===me):me===ue._f.ref)return;qn(s,se,{_f:{...ue._f,...Ee?{refs:[...tt.filter(Vj),me,...Array.isArray(qe(i,se))?[{}]:[]],ref:{type:me.type,name:se}}:{ref:me}}}),w(se,!1,void 0,me)}else ue=qe(s,se,{}),ue._f&&(ue._f.mount=!1),(t.shouldUnregister||re.shouldUnregister)&&!($J(l.array,se)&&r.action)&&l.unMount.add(se)}}},ie=()=>t.shouldFocusError&&av(s,V,l.mount),ge=se=>{ca(se)&&(m.state.next({disabled:se}),av(s,(re,ue)=>{const Se=qe(s,ue);Se&&(re.disabled=Se._f.disabled||se,Array.isArray(Se._f.refs)&&Se._f.refs.forEach(de=>{de.disabled=Se._f.disabled||se}))},0,!1))},xe=(se,re)=>async ue=>{let Se;ue&&(ue.preventDefault&&ue.preventDefault(),ue.persist&&ue.persist());let de=qs(o);if(m.state.next({isSubmitting:!0}),t.resolver){const{errors:me,values:Ee}=await I();n.errors=me,de=qs(Ee)}else await E(s);if(l.disabled.size)for(const me of l.disabled)Os(de,me);if(Os(n.errors,"root"),No(n.errors)){m.state.next({errors:{}});try{await se(de,ue)}catch(me){Se=me}}else re&&await re({...n.errors},ue),ie(),setTimeout(ie);if(m.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:No(n.errors)&&!Se,submitCount:n.submitCount+1,errors:n.errors}),Se)throw Se},we=(se,re={})=>{qe(s,se)&&(Ps(re.defaultValue)?X(se,qs(qe(i,se))):(X(se,re.defaultValue),qn(i,se,qs(re.defaultValue))),re.keepTouched||Os(n.touchedFields,se),re.keepDirty||(Os(n.dirtyFields,se),n.isDirty=re.defaultValue?P(se,qs(qe(i,se))):P()),re.keepError||(Os(n.errors,se),u.isValid&&v()),m.state.next({...n}))},je=(se,re={})=>{const ue=se?qs(se):i,Se=qs(ue),de=No(se),me=de?i:Se;if(re.keepDefaultValues||(i=ue),!re.keepValues){if(re.keepDirtyValues){const Ee=new Set([...l.mount,...Object.keys(n0(i,o))]);for(const tt of Array.from(Ee))qe(n.dirtyFields,tt)?qn(me,tt,qe(o,tt)):X(tt,qe(me,tt))}else{if(c6&&Ps(se))for(const Ee of l.mount){const tt=qe(s,Ee);if(tt&&tt._f){const ut=Array.isArray(tt._f.refs)?tt._f.refs[0]:tt._f.ref;if(OC(ut)){const Yt=ut.closest("form");if(Yt){Yt.reset();break}}}}if(re.keepFieldsRef)for(const Ee of l.mount)X(Ee,qe(me,Ee));else s={}}o=t.shouldUnregister?re.keepDefaultValues?qs(i):{}:qs(me),m.array.next({values:{...me}}),m.state.next({values:{...me}})}l={mount:re.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},r.mount=!u.isValid||!!re.keepIsValid||!!re.keepDirtyValues,r.watch=!!t.shouldUnregister,m.state.next({submitCount:re.keepSubmitCount?n.submitCount:0,isDirty:de?!1:re.keepDirty?n.isDirty:!!(re.keepDefaultValues&&!wd(se,i)),isSubmitted:re.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:de?{}:re.keepDirtyValues?re.keepDefaultValues&&o?n0(i,o):n.dirtyFields:re.keepDefaultValues&&se?n0(i,se):re.keepDirty?n.dirtyFields:{},touchedFields:re.keepTouched?n.touchedFields:{},errors:re.keepErrors?n.errors:{},isSubmitSuccessful:re.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1})},Re=(se,re)=>je(Dr(se)?se(o):se,re),Ct=(se,re={})=>{const ue=qe(s,se),Se=ue&&ue._f;if(Se){const de=Se.refs?Se.refs[0]:Se.ref;de.focus&&(de.focus(),re.shouldSelect&&Dr(de.select)&&de.select())}},Xe=se=>{n={...n,...se}},Dt={control:{register:Y,unregister:z,getFieldState:Z,handleSubmit:xe,setError:R,_subscribe:H,_runSchema:I,_focusError:ie,_getWatch:D,_getDirty:P,_setValid:v,_setFieldArray:C,_setDisabledField:B,_setErrors:x,_getFieldArray:O,_reset:je,_resetDefaultValues:()=>Dr(t.defaultValues)&&t.defaultValues().then(se=>{Re(se,t.resetOptions),m.state.next({isLoading:!1})}),_removeUnmounted:j,_disableForm:ge,_subjects:m,_proxyFormState:u,get _fields(){return s},get _formValues(){return o},get _state(){return r},set _state(se){r=se},get _defaultValues(){return i},get _names(){return l},set _names(se){l=se},get _formState(){return n},get _options(){return t},set _options(se){t={...t,...se}}},subscribe:$,trigger:K,register:Y,handleSubmit:xe,watch:G,setValue:X,getValues:U,reset:Re,resetField:we,clearErrors:W,unregister:z,setError:R,setFocus:Ct,getFieldState:Z};return{...Dt,formControl:Dt}}function Om(e={}){const t=ce.useRef(void 0),n=ce.useRef(void 0),[s,i]=ce.useState({isDirty:!1,isValidating:!1,isLoading:Dr(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:Dr(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:s},e.defaultValues&&!Dr(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:r,...l}=B7e(e);t.current={...l,formState:s}}const o=t.current.control;return o._options=e,p6(()=>{const r=o._subscribe({formState:o._proxyFormState,callback:()=>i({...o._formState}),reRenderRoot:!0});return i(l=>({...l,isReady:!0})),o._formState.isReady=!0,r},[o]),ce.useEffect(()=>o._disableForm(e.disabled),[o,e.disabled]),ce.useEffect(()=>{e.mode&&(o._options.mode=e.mode),e.reValidateMode&&(o._options.reValidateMode=e.reValidateMode)},[o,e.mode,e.reValidateMode]),ce.useEffect(()=>{e.errors&&(o._setErrors(e.errors),o._focusError())},[o,e.errors]),ce.useEffect(()=>{e.shouldUnregister&&o._subjects.state.next({values:o._getWatch()})},[o,e.shouldUnregister]),ce.useEffect(()=>{if(o._proxyFormState.isDirty){const r=o._getDirty();r!==s.isDirty&&o._subjects.state.next({isDirty:r})}},[o,s.isDirty]),ce.useEffect(()=>{e.values&&!wd(e.values,n.current)?(o._reset(e.values,{keepFieldsRef:!0,...o._options.resetOptions}),n.current=e.values,i(r=>({...r}))):o._resetDefaultValues()},[o,e.values]),ce.useEffect(()=>{o._state.mount||(o._setValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()}),t.current.formState=HJ(s,o),t.current}const $j=(e,t)=>(e.push(t),e.push(t.toUpperCase()),e),AS={"image/png":[".png"].reduce($j,[]),"image/jpeg":[".jpg",".jpeg",".png"].reduce($j,[]),"image/webp":[".webp"].reduce($j,[])},Gj=Ft("gallery").child({filePath:"common/hooks/useImageUploadButton.tsx"}),Yo=({onUpload:e,isDisabled:t,allowMultiple:n,onUploadStarted:s,onError:i})=>{const o=M(ko),[r,l]=e_(),{t:c}=T(),d=h.useCallback(async g=>{try{if(n){s?.(g);let v=[];v=await iW(g.map((b,C)=>({file:b,image_category:"user",is_intermediate:!1,board_id:o==="none"?void 0:o,silent:!1,isFirstUploadOfBatch:C===0}))),e&&e(v)}else{if(g.length>1){Gj.warn("Multiple files dropped but only one allowed");return}if(g.length===0){Gj.warn("No files dropped");return}const v=g[0];ae(v!==void 0),s?.(v);const b=await r({file:v,image_category:"user",is_intermediate:!1,board_id:o==="none"?void 0:o,silent:!0}).unwrap();e&&e(b)}}catch(v){i?.(v),pe({id:"UPLOAD_FAILED",title:c("toast.imageUploadFailed"),status:"error"})}},[n,s,r,o,e,i,c]),u=h.useCallback(g=>{if(g.length>0){const v=g.map(C=>({errors:C.errors.map(({message:y})=>y),file:C.file.path}));Gj.error({errors:v},"Invalid upload");const b=c("toast.uploadFailedInvalidUploadDesc");pe({id:"UPLOAD_FAILED",title:c("toast.uploadFailed"),description:b,status:"error"});return}},[c]),{getRootProps:p,getInputProps:m,open:f}=oc({accept:AS,onDropAccepted:d,onDropRejected:u,disabled:t,noDrag:!0,multiple:n});return{getUploadButtonProps:p,getUploadInputProps:m,openUploader:f,request:l}},g6={"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid",borderWidth:1}},C1=h.memo(({isDisabled:e=!1,onUpload:t,isError:n=!1,...s})=>{const i=Yo({isDisabled:e,allowMultiple:!1,onUpload:t});return a.jsxs(a.Fragment,{children:[a.jsx(oe,{"aria-label":"Upload image",variant:"outline",sx:g6,"data-error":n,icon:a.jsx(qo,{}),isLoading:i.request.isLoading,...s,...i.getUploadButtonProps()}),a.jsx("input",{...i.getUploadInputProps()})]})});C1.displayName="UploadImageIconButton";const z7e=h.memo(e=>{const{children:t,isDisabled:n=!1,onUpload:s,isError:i=!1,...o}=e,r=Yo({isDisabled:n,allowMultiple:!1,onUpload:s});return a.jsxs(a.Fragment,{children:[a.jsx(he,{"aria-label":"Upload image",variant:"outline",sx:g6,"data-error":i,rightIcon:a.jsx(qo,{}),isLoading:r.request.isLoading,...o,...r.getUploadButtonProps(),children:t??"Upload"}),a.jsx("input",{...r.getUploadInputProps()})]})});z7e.displayName="UploadImageButton";const V7e=({isDisabled:e=!1,onUpload:t,isError:n=!1,...s})=>{const i=Yo({isDisabled:e,allowMultiple:!0,onUpload:t});return a.jsxs(a.Fragment,{children:[a.jsx(oe,{"aria-label":"Upload image",variant:"outline",sx:g6,"data-error":n,icon:a.jsx(qo,{}),isLoading:i.request.isLoading,...s,...i.getUploadButtonProps()}),a.jsx("input",{...i.getUploadInputProps()})]})},$7e=e=>{const{field:t}=si(e),{t:n}=T(),s=h.useCallback(l=>{const c=l[0];c&&t.onChange(c)},[t]),i=h.useCallback(()=>{t.onChange(null)},[t]),{getInputProps:o,getRootProps:r}=oc({accept:AS,onDropAccepted:s,noDrag:!0,multiple:!1});return t.value?a.jsxs(ke,{position:"relative",flexShrink:0,children:[a.jsx(Nn,{src:URL.createObjectURL(t.value),objectFit:"cover",objectPosition:"50% 50%",w:65,h:65,minWidth:65,borderRadius:"base"}),a.jsx(oe,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:i,"aria-label":n("stylePresets.deleteImage"),tooltip:n("stylePresets.deleteImage"),icon:a.jsx(Gs,{}),size:"md",variant:"ghost"})]}):a.jsxs(a.Fragment,{children:[a.jsx(He,{label:n("stylePresets.uploadImage"),children:a.jsx(A,{as:he,w:65,h:65,opacity:.3,borderRadius:"base",alignItems:"center",justifyContent:"center",flexShrink:0,...r(),children:a.jsx(Je,{as:p1,w:8,h:8})})}),a.jsx("input",{...o()})]})},R7=e=>{const{field:t}=si(e),n=h.useRef(null),{t:s}=T(),i=h.useCallback(c=>{t.onChange(c.target.value)},[t]),o=h.useMemo(()=>t.value,[t.value]),r=h.useCallback(()=>{if(n.current){const c=n.current.selectionStart,d=o.slice(0,c),u=o.slice(c),p=d+lh+u;t.onChange(p)}else t.onChange(o+lh);n.current?.focus()},[o,t,n]),l=h.useMemo(()=>o?.includes(lh),[o]);return a.jsxs(te,{orientation:"vertical",gap:3,children:[a.jsxs(A,{alignItems:"center",gap:2,children:[a.jsx(ne,{children:e.label}),a.jsx(he,{onClick:r,size:"xs","aria-label":s("stylePresets.insertPlaceholder"),isDisabled:l,children:s("stylePresets.insertPlaceholder")})]}),a.jsx(no,{size:"sm",ref:n,value:o,onChange:i})]})},G7e=({updatingStylePresetId:e,formData:t})=>{const[n,{isLoading:s}]=Y1e(),[i,{isLoading:o}]=Q1e(),{t:r}=T(),{handleSubmit:l,control:c,register:d,formState:u}=Om({defaultValues:t||{name:"",positivePrompt:"",negativePrompt:"",image:null,type:"user"},mode:"onChange"}),p=h.useCallback(async m=>{const f={data:{name:m.name,positive_prompt:m.positivePrompt,negative_prompt:m.negativePrompt,type:m.type},image:m.image};try{e?await i({id:e,...f}).unwrap():await n(f).unwrap()}catch{pe({status:"error",title:"Failed to save style preset"})}Ch.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[e,i,n]);return a.jsxs(A,{flexDir:"column",gap:4,children:[a.jsxs(A,{alignItems:"center",gap:4,children:[a.jsx($7e,{control:c,name:"image"}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:r("stylePresets.name")}),a.jsx(Nt,{size:"md",...d("name",{required:!0,minLength:1})})]})]}),a.jsx(R7,{label:r("stylePresets.positivePrompt"),control:c,name:"positivePrompt"}),a.jsx(R7,{label:r("stylePresets.negativePrompt"),control:c,name:"negativePrompt"}),a.jsxs(ke,{children:[a.jsx(q,{variant:"subtext",children:r("stylePresets.promptTemplatesDesc1")}),a.jsx(q,{variant:"subtext",children:a.jsx(Bn,{i18nKey:"stylePresets.promptTemplatesDesc2",components:{Pre:a.jsx(H7e,{})},values:{placeholder:lh}})}),a.jsx(q,{variant:"subtext",children:r("stylePresets.promptTemplatesDesc3")})]}),a.jsxs(A,{justifyContent:"space-between",alignItems:"flex-end",gap:10,children:[a.jsx(At,{}),a.jsx(he,{onClick:l(p),isDisabled:!u.isValid,isLoading:s||o,children:r("common.save")})]})]})},H7e=e=>a.jsx(q,{as:"span",fontFamily:"monospace",fontWeight:"semibold",children:e.children}),W7e=()=>{mn("StylePresetModal");const[e,t]=h.useState(null),{t:n}=T(),s=le(Ch),i=h.useMemo(()=>s.updatingStylePresetId?n("stylePresets.updatePromptTemplate"):n("stylePresets.createPromptTemplate"),[s.updatingStylePresetId,n]),o=h.useCallback(()=>{Ch.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[]);return h.useEffect(()=>{t(null)},[]),h.useEffect(()=>{(async l=>{if(!l)t(null);else{let c=null;if(l.imageUrl)try{const d=await kS(l.imageUrl);d&&(c=new File([d],"style_preset.png",{type:"image/png"}))}catch{}t({...l,image:c})}})(s.prefilledFormData)},[s.prefilledFormData]),a.jsxs(Zo,{isOpen:s.isModalOpen,onClose:o,isCentered:!0,size:"2xl",useInert:!1,children:[a.jsx(ro,{}),a.jsxs(Xo,{children:[a.jsx(lo,{children:i}),a.jsx(Yr,{}),a.jsx(vi,{display:"flex",flexDir:"column",gap:4,children:!s.prefilledFormData||e?a.jsx(G7e,{updatingStylePresetId:s.updatingStylePresetId,formData:e}):a.jsx(ao,{})}),a.jsx(Qr,{p:2})]})]})},[QJ]=qh(!1),U7e=()=>{mn("RefreshAfterResetModal");const{t:e}=T(),[t,n]=h.useState(3),s=QJ();return h.useEffect(()=>{if(!s.isTrue)return;const i=window.setInterval(()=>n(o=>o-1),1e3);return()=>{window.clearInterval(i)}},[s.isTrue]),h.useEffect(()=>{t<=0&&window.location.reload()},[t]),a.jsx(a.Fragment,{children:a.jsxs(Zo,{closeOnOverlayClick:!1,isOpen:s.isTrue,onClose:s.setFalse,isCentered:!0,closeOnEsc:!1,useInert:!1,children:[a.jsx(ro,{backdropFilter:"blur(40px)"}),a.jsxs(Xo,{children:[a.jsx(lo,{}),a.jsx(vi,{children:a.jsx(A,{justifyContent:"center",children:a.jsx(q,{fontSize:"lg",children:a.jsxs(q,{children:[e("settings.resetComplete")," ",e("settings.reloadingIn")," ",t,"..."]})})})}),a.jsx(Qr,{})]})]})})},q7e=h.memo(U7e),K7e=[{tKey:"gettingStarted",link:"https://www.youtube.com/playlist?list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO"},{tKey:"studioSessions",link:"https://www.youtube.com/playlist?list=PLvWK1Kc8iXGq_8tWZqnwDVaf9uhlDC09U"}],Z7e="https://www.youtube.com/playlist?list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO",X7e="https://www.youtube.com/playlist?list=PLvWK1Kc8iXGq_8tWZqnwDVaf9uhlDC09U",JJ=h.memo(e=>a.jsx(A,{ps:2,pb:4,position:"sticky",zIndex:1,top:0,bg:"base.800",sx:e.sx,children:a.jsx(Pt,{size:"sm",children:e.title})}));JJ.displayName="StickyScrollableHeading";const eee=h.memo(e=>a.jsx(A,{p:4,borderRadius:"base",bg:"base.750",flexDir:"column",gap:4,sx:e.sx,children:e.children}));eee.displayName="StickyScrollableContent";const xl=h.memo(e=>a.jsxs(A,{flexDir:"column",children:[a.jsx(JJ,{title:e.title,sx:e.headingSx}),a.jsx(eee,{sx:e.contentSx,children:e.children})]},e.title));xl.displayName="StickyScrollable";const tee=h.memo(({video:e})=>{const{t}=T(),{tKey:n,link:s}=e;return a.jsxs(A,{flexDir:"column",gap:1,children:[a.jsxs(A,{alignItems:"center",gap:2,children:[a.jsx(q,{fontSize:"md",fontWeight:"semibold",children:t(`supportVideos.videos.${n}.title`)}),a.jsx(At,{}),a.jsx(to,{fontSize:"sm",href:s,label:t("supportVideos.watch")})]}),a.jsx(q,{fontSize:"md",variant:"subtext",children:t(`supportVideos.videos.${n}.description`)})]})});tee.displayName="VideoCard";const nee=h.memo(({category:e,videos:t})=>a.jsx(xl,{title:e,children:t.map((n,s)=>a.jsxs(h.Fragment,{children:[a.jsx(tee,{video:n}),s<t.length-1&&a.jsx(vt,{})]},`${n.tKey}-${s}`))}));nee.displayName="VideoCardList";const[see]=lS(!1),Y7e=()=>a.jsx(to,{fontWeight:"semibold",href:Z7e,display:"inline-flex",label:"Getting Started playlist"}),Q7e=()=>a.jsx(to,{fontWeight:"semibold",href:X7e,display:"inline-flex",label:"Studio Sessions playlist"}),J7e=()=>a.jsx(to,{fontWeight:"semibold",href:oS,display:"inline-flex",label:"Discord"}),e9e={GettingStartedPlaylistLink:a.jsx(Y7e,{}),StudioSessionsPlaylistLink:a.jsx(Q7e,{}),DiscordLink:a.jsx(J7e,{})},iee=h.memo(()=>{const{t:e}=T(),t=see();return a.jsxs(Zo,{isOpen:t.isOpen,onClose:t.close,size:"2xl",isCentered:!0,useInert:!1,children:[a.jsx(ro,{}),a.jsxs(Xo,{maxH:"60vh",h:"60vh",children:[a.jsx(lo,{bg:"none",children:e("supportVideos.supportVideos")}),a.jsx(Yr,{}),a.jsx(vi,{children:a.jsx(Hs,{children:a.jsxs(A,{flexDir:"column",gap:4,children:[a.jsx(A,{flexDir:"column",gap:2,pb:2,children:a.jsx(q,{fontSize:"md",children:a.jsx(Bn,{i18nKey:"supportVideos.studioSessionsDesc",components:e9e})})}),a.jsx(nee,{category:e("supportVideos.supportVideos"),videos:K7e})]})})}),a.jsx(Qr,{})]})]})});iee.displayName="VideosModal";const Hj=De(!1),oee=()=>{const e=le(Hj),t=h.useCallback(()=>{Hj.set(!0)},[]),n=h.useCallback(()=>{Hj.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},t9e=()=>{const{t:e}=T(),{isOpen:t,onClose:n}=oee(),s=ed(),[i,o]=h.useState(""),[r,l]=h.useState(),[c,d]=h.useState(""),[u,p]=h.useState(!0),m=h.useCallback(C=>{o(C.target.value)},[]),f=h.useCallback(C=>{l(C.target.value)},[]),g=h.useCallback(C=>{p(C.target.checked)},[]),v=h.useCallback(()=>{const C=JSON.parse(i),y=mY(C,u);l(y),d(JSON.stringify(y,null,2))},[i,u]),b=h.useCallback(async()=>{await s({type:"object",data:r}),n()},[s,r,n]);return a.jsxs(Zo,{isOpen:t,onClose:n,isCentered:!0,useInert:!1,children:[a.jsx(ro,{}),a.jsxs(Xo,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[a.jsx(lo,{children:e("workflows.loadFromGraph")}),a.jsx(Yr,{}),a.jsxs(vi,{as:A,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[a.jsxs(A,{gap:4,children:[a.jsx(he,{onClick:v,size:"sm",flexShrink:0,children:e("workflows.convertGraph")}),a.jsxs(te,{children:[a.jsx(ne,{children:e("workflows.autoLayout")}),a.jsx(us,{isChecked:u,onChange:g})]}),a.jsx(At,{}),a.jsx(he,{onClick:b,size:"sm",flexShrink:0,children:e("workflows.loadWorkflow")})]}),a.jsxs(te,{orientation:"vertical",h:"50%",children:[a.jsx(ne,{children:e("nodes.graph")}),a.jsx(no,{h:"full",value:i,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:m})]}),a.jsxs(te,{orientation:"vertical",h:"50%",children:[a.jsx(ne,{children:e("nodes.workflow")}),a.jsx(no,{h:"full",value:c,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:f})]})]})]})]})},aee=()=>{const e=Ze();return h.useCallback(()=>{const{nodes:n,form:s}=Xn(e.getState());return J1e(s,n)},[e])},n9e=e=>!e.id&&e.meta.category!=="default",s9e=()=>{const{t:e}=T(),t=Q(),[n,{isLoading:s,isError:i}]=QTe(),[o]=HZ(),r=aee(),l=tm(),c=h.useRef();return{createNewWorkflow:h.useCallback(async({workflow:u,onSuccess:p,onError:m})=>{c.current=l({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{const f=await n(u).unwrap(),{id:g,name:v,meta:{category:b}}=f.workflow;t(ebe(g)),t(yW(v)),t(tbe(b)),t(T8e({category:b})),t(bW({formFieldInitialValues:r()})),o({workflow_id:g}),p?.(),l.update(c.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{m?.(),l.isActive(`auth-error-toast-${d1.endpoints.createWorkflow.name}`)?l.close(c.current):l.update(c.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0})}},[l,e,n,t,r,o]),isLoading:s,isError:i}},ty=De(null),i9e=Ut(ty,e=>e!==null),o9e=e=>e.id?e.name.length?`${e.name.trim()} (copy)`:"":e.name,ree=e=>{ty.set(It(e))},a9e=()=>{const e=le(i9e),t=le(ty),n=h.useRef(null),s=h.useCallback(()=>{ty.set(null)},[]);return a.jsxs(gM,{isOpen:e,onClose:s,leastDestructiveRef:n,isCentered:!0,children:[!t&&a.jsx(cee,{}),t&&a.jsx(lee,{workflow:t,cancelRef:n})]})},lee=h.memo(({workflow:e,cancelRef:t})=>{const[n,s]=h.useState(()=>e?o9e(e):""),{createNewWorkflow:i}=s9e(),o=h.useRef(null),r=h.useCallback(d=>{s(d.target.value)},[]),l=h.useCallback(()=>{ty.set(null)},[]),c=h.useCallback(async()=>{e.id=void 0,e.name=n,e.meta.category="user",ae(n9e(e)),await i({workflow:e,onSuccess:l,onError:l})},[e,n,i,l]);return a.jsxs(n_,{children:[a.jsx(lo,{fontSize:"lg",fontWeight:"bold",children:ye("workflows.saveWorkflowAs")}),a.jsx(vi,{children:a.jsxs(te,{alignItems:"flex-start",children:[a.jsx(ne,{mt:"2",children:ye("workflows.workflowName")}),a.jsx(A,{flexDir:"column",width:"full",gap:"2",children:a.jsx(Nt,{ref:o,value:n,onChange:r,placeholder:ye("workflows.workflowName")})})]})}),a.jsxs(Qr,{children:[a.jsx(he,{ref:t,onClick:l,children:ye("common.cancel")}),a.jsx(he,{colorScheme:"invokeBlue",onClick:c,ml:3,isDisabled:!n||!n.length,children:ye("common.saveAs")})]})]})});lee.displayName="Content";const cee=h.memo(()=>a.jsx(n_,{children:a.jsx(On,{icon:null,label:"No workflow to save"})}));cee.displayName="NoWorkflowToSaveContent";const dee=h.memo(()=>a.jsxs(a.Fragment,{children:[a.jsx(AY,{}),a.jsx(mRe,{}),a.jsx(PQ,{}),a.jsx(W7e,{}),a.jsx(RJ,{}),a.jsx(OJ,{}),a.jsx(FJ,{}),a.jsx(NJ,{}),a.jsx(sJ,{}),a.jsx(yY,{}),a.jsx(BJ,{}),a.jsx(e7e,{}),a.jsx(q7e,{}),a.jsx(SNe,{}),a.jsx(_Y,{}),a.jsx(JQ,{}),a.jsx(DY,{}),a.jsx(iee,{}),a.jsx(a9e,{}),a.jsx(fa,{children:a.jsx(kY,{})}),a.jsx(t9e,{}),a.jsx(jY,{})]}));dee.displayName="GlobalModalIsolator";const uee="data:image/svg+xml,%3csvg%20width='44'%20height='44'%20viewBox='0%200%2044%2044'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M29.1951%2010.6667H42V2H2V10.6667H14.8049L29.1951%2033.3333H42V42H2V33.3333H14.8049'%20stroke='%23E6FD13'%20stroke-width='2.8'/%3e%3c/svg%3e",r9e=()=>{const{data:e}=a_(),t=h.useRef(null),n=h.useMemo(()=>e?a.jsxs(q,{fontWeight:"semibold",children:["v",e.version]}):null,[e]);return a.jsx(He,{placement:"right",label:n,p:1,px:2,gutter:16,children:a.jsx(Nn,{ref:t,src:uee,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"})})},l9e=h.memo(r9e);var Wj={},i0={},Uj={},O7;function v6(){return O7||(O7=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EolStyle=void 0,function(t){t[t.Crlf=0]="Crlf",t[t.Lf=1]="Lf"}(e.EolStyle||(e.EolStyle={}))}(Uj)),Uj}var qj={},N7;function y6(){return N7||(N7=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CommentPolicy=void 0,function(t){t[t.TreatAsError=0]="TreatAsError",t[t.Remove=1]="Remove",t[t.Preserve=2]="Preserve"}(e.CommentPolicy||(e.CommentPolicy={}))}(qj)),qj}var Kj={},F7;function b6(){return F7||(F7=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NumberListAlignment=void 0,function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Decimal=2]="Decimal",t[t.Normalize=3]="Normalize"}(e.NumberListAlignment||(e.NumberListAlignment={}))}(Kj)),Kj}var Zj={},B7;function x6(){return B7||(B7=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TableCommaPlacement=void 0,function(t){t[t.BeforePadding=0]="BeforePadding",t[t.AfterPadding=1]="AfterPadding",t[t.BeforePaddingExceptNumbers=2]="BeforePaddingExceptNumbers"}(e.TableCommaPlacement||(e.TableCommaPlacement={}))}(Zj)),Zj}var z7;function C6(){if(z7)return i0;z7=1,Object.defineProperty(i0,"__esModule",{value:!0}),i0.FracturedJsonOptions=void 0;const e=v6(),t=y6(),n=b6(),s=x6();let i=class hee{constructor(){this.JsonEolStyle=e.EolStyle.Lf,this.MaxInlineLength=2e9,this.MaxTotalLineLength=120,this.MaxInlineComplexity=2,this.MaxCompactArrayComplexity=1,this.MaxTableRowComplexity=2,this.TableCommaPlacement=s.TableCommaPlacement.AfterPadding,this.MinCompactArrayRowItems=3,this.AlwaysExpandDepth=-1,this.NestedBracketPadding=!0,this.SimpleBracketPadding=!1,this.ColonPadding=!0,this.CommaPadding=!0,this.CommentPadding=!0,this.OmitTrailingWhitespace=!1,this.NumberListAlignment=n.NumberListAlignment.Normalize,this.IndentSpaces=4,this.UseTabToIndent=!1,this.PrefixString="",this.CommentPolicy=t.CommentPolicy.TreatAsError,this.PreserveBlankLines=!1,this.AllowTrailingCommas=!1}static Recommended(){const r=new hee;return r.TableCommaPlacement=s.TableCommaPlacement.BeforePadding,r.OmitTrailingWhitespace=!0,r}};return i0.FracturedJsonOptions=i,i0}var o0={},V7;function Nm(){if(V7)return o0;V7=1,Object.defineProperty(o0,"__esModule",{value:!0}),o0.FracturedJsonError=void 0;let e=class extends Error{constructor(n,s){const i=s?`${n} at idx=${s.Index}, row=${s.Row}, col=${s.Column}`:n;super(i),this.InputPosition=s}};return o0.FracturedJsonError=e,o0}var a0={},r0={},$7;function c9e(){if($7)return r0;$7=1,Object.defineProperty(r0,"__esModule",{value:!0}),r0.StringJoinBuffer=void 0;let e=class{constructor(n){this._lineBuff=[],this._docBuff=[],this._trimTrailingWhitespace=n}Add(...n){return this._lineBuff.push(...n),this}EndLine(n){return this.AddLineToWriter(n),this}Flush(){return this.AddLineToWriter(""),this}AsString(){return this._docBuff.join("")}AddLineToWriter(n){if(this._lineBuff.length===0&&n.length===0)return;let s=this._lineBuff.join("");this._trimTrailingWhitespace&&(s=s.trimEnd()),this._docBuff.push(s+n),this._lineBuff=[]}};return r0.StringJoinBuffer=e,r0}var l0={},Xj={},G7;function w6(){return G7||(G7=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.BracketPaddingType=void 0,function(t){t[t.Empty=0]="Empty",t[t.Simple=1]="Simple",t[t.Complex=2]="Complex"}(e.BracketPaddingType||(e.BracketPaddingType={}))}(Xj)),Xj}var Yj={},H7;function Fm(){return H7||(H7=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonItemType=void 0,function(t){t[t.Null=0]="Null",t[t.False=1]="False",t[t.True=2]="True",t[t.String=3]="String",t[t.Number=4]="Number",t[t.Object=5]="Object",t[t.Array=6]="Array",t[t.BlankLine=7]="BlankLine",t[t.LineComment=8]="LineComment",t[t.BlockComment=9]="BlockComment"}(e.JsonItemType||(e.JsonItemType={}))}(Yj)),Yj}var W7;function d9e(){if(W7)return l0;W7=1,Object.defineProperty(l0,"__esModule",{value:!0}),l0.PaddedFormattingTokens=void 0;const e=w6(),t=v6(),n=Fm();let s=class{constructor(o,r){this._arrStart=[],this._arrStart[e.BracketPaddingType.Empty]="[",this._arrStart[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?"[ ":"[",this._arrStart[e.BracketPaddingType.Complex]=o.NestedBracketPadding?"[ ":"[",this._arrEnd=[],this._arrEnd[e.BracketPaddingType.Empty]="]",this._arrEnd[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?" ]":"]",this._arrEnd[e.BracketPaddingType.Complex]=o.NestedBracketPadding?" ]":"]",this._objStart=[],this._objStart[e.BracketPaddingType.Empty]="{",this._objStart[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?"{ ":"{",this._objStart[e.BracketPaddingType.Complex]=o.NestedBracketPadding?"{ ":"{",this._objEnd=[],this._objEnd[e.BracketPaddingType.Empty]="}",this._objEnd[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?" }":"}",this._objEnd[e.BracketPaddingType.Complex]=o.NestedBracketPadding?" }":"}",this._comma=o.CommaPadding?", ":",",this._colon=o.ColonPadding?": ":":",this._comment=o.CommentPadding?" ":"",this._eol=o.JsonEolStyle===t.EolStyle.Crlf?`\r
`:`
`,this._arrStartLen=this._arrStart.map(r),this._arrEndLen=this._arrEnd.map(r),this._objStartLen=this._objStart.map(r),this._objEndLen=this._objEnd.map(r),this._indentStrings=["",o.UseTabToIndent?"	":" ".repeat(o.IndentSpaces)],this._spaceStrings=[""," "],this._commaLen=r(this._comma),this._colonLen=r(this._colon),this._commentLen=r(this._comment),this._literalNullLen=r("null"),this._literalTrueLen=r("true"),this._literalFalseLen=r("false"),this._prefixStringLen=r(o.PrefixString),this._dummyComma=" ".repeat(this._commaLen)}get Comma(){return this._comma}get Colon(){return this._colon}get Comment(){return this._comment}get EOL(){return this._eol}get CommaLen(){return this._commaLen}get ColonLen(){return this._colonLen}get CommentLen(){return this._commentLen}get LiteralNullLen(){return this._literalNullLen}get LiteralTrueLen(){return this._literalTrueLen}get LiteralFalseLen(){return this._literalFalseLen}get PrefixStringLen(){return this._prefixStringLen}get DummyComma(){return this._dummyComma}ArrStart(o){return this._arrStart[o]}ArrEnd(o){return this._arrEnd[o]}ObjStart(o){return this._objStart[o]}ObjEnd(o){return this._objEnd[o]}Start(o,r){return o===n.JsonItemType.Array?this.ArrStart(r):this.ObjStart(r)}End(o,r){return o===n.JsonItemType.Array?this.ArrEnd(r):this.ObjEnd(r)}ArrStartLen(o){return this._arrStartLen[o]}ArrEndLen(o){return this._arrEndLen[o]}ObjStartLen(o){return this._objStartLen[o]}ObjEndLen(o){return this._objEndLen[o]}StartLen(o,r){return o===n.JsonItemType.Array?this.ArrStartLen(r):this.ObjStartLen(r)}EndLen(o,r){return o===n.JsonItemType.Array?this.ArrEndLen(r):this.ObjEndLen(r)}Indent(o){if(o>=this._indentStrings.length)for(let r=this._indentStrings.length;r<=o;++r)this._indentStrings.push(this._indentStrings[r-1]+this._indentStrings[1]);return this._indentStrings[o]}Spaces(o){if(o>=this._spaceStrings.length)for(let r=this._spaceStrings.length;r<=o;++r)this._spaceStrings.push(" ".repeat(r));return this._spaceStrings[o]}};return l0.PaddedFormattingTokens=s,l0}var c0={},U7;function u9e(){if(U7)return c0;U7=1,Object.defineProperty(c0,"__esModule",{value:!0}),c0.TableTemplate=void 0;const e=Fm(),t=w6(),n=b6();let s=class Bp{constructor(o,r){this.LocationInParent=void 0,this.Type=e.JsonItemType.Null,this.IsRowDataCompatible=!0,this.RowCount=0,this.NameLength=0,this.SimpleValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.IsAnyPostCommentLineStyle=!1,this.PadType=t.BracketPaddingType.Simple,this.AllowNumberNormalization=!1,this.IsNumberList=!1,this.CompositeValueLength=0,this.TotalLength=0,this.Children=[],this._maxDigBeforeDecRaw=0,this._maxDigAfterDecRaw=0,this._maxDigBeforeDecNorm=0,this._maxDigAfterDecNorm=0,this._pads=o,this._numberListAlignment=r,this.AllowNumberNormalization=r===n.NumberListAlignment.Normalize,this.IsNumberList=!0}MeasureTableRoot(o){for(const r of o.Children)this.MeasureRowSegment(r);this.PruneAndRecompute(Number.MAX_VALUE),this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.RowCount>=2)}TryToFit(o){for(let r=this.GetTemplateComplexity();r>=0;--r){if(this.TotalLength<=o)return!0;this.PruneAndRecompute(r-1)}return!1}FormatNumber(o,r,l){const c=this._numberListAlignment===n.NumberListAlignment.Normalize&&!this.AllowNumberNormalization?n.NumberListAlignment.Left:this._numberListAlignment;switch(c){case n.NumberListAlignment.Left:o.Add(r.Value,l,this._pads.Spaces(this.SimpleValueLength-r.ValueLength));return;case n.NumberListAlignment.Right:o.Add(this._pads.Spaces(this.SimpleValueLength-r.ValueLength),r.Value,l);return}let d,u,p;if(c===n.NumberListAlignment.Normalize){if(r.Type===e.JsonItemType.Null){o.Add(this._pads.Spaces(this._maxDigBeforeDecNorm-r.ValueLength),r.Value,l,this._pads.Spaces(this.CompositeValueLength-this._maxDigBeforeDecNorm));return}d=this._maxDigBeforeDecNorm,u=Number(r.Value).toFixed(this._maxDigAfterDecNorm),p=u.length}else d=this._maxDigBeforeDecRaw,u=r.Value,p=r.ValueLength;let m,f;const g=u.search(Bp._dotOrE);g>0?(m=d-g,f=this.CompositeValueLength-m-p):(m=d-p,f=this.CompositeValueLength-d),o.Add(this._pads.Spaces(m),u,l,this._pads.Spaces(f))}MeasureRowSegment(o){if(!(o.Type===e.JsonItemType.BlankLine||o.Type===e.JsonItemType.BlockComment||o.Type===e.JsonItemType.LineComment)&&(o.Type===e.JsonItemType.False||o.Type===e.JsonItemType.True?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===e.JsonItemType.True||this.Type===e.JsonItemType.Null),this.Type=e.JsonItemType.True,this.IsNumberList=!1):o.Type===e.JsonItemType.Number?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===e.JsonItemType.Number||this.Type===e.JsonItemType.Null),this.Type=e.JsonItemType.Number):o.Type===e.JsonItemType.Null?(this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,this._pads.LiteralNullLen),this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,this._pads.LiteralNullLen)):(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===o.Type||this.Type===e.JsonItemType.Null),this.Type===e.JsonItemType.Null&&(this.Type=o.Type),this.IsNumberList=!1),this.IsRowDataCompatible&&(this.IsRowDataCompatible=!o.RequiresMultipleLines),this.RowCount+=1,this.NameLength=Math.max(this.NameLength,o.NameLength),this.SimpleValueLength=Math.max(this.SimpleValueLength,o.ValueLength),this.MiddleCommentLength=Math.max(this.MiddleCommentLength,o.MiddleCommentLength),this.PrefixCommentLength=Math.max(this.PrefixCommentLength,o.PrefixCommentLength),this.PostfixCommentLength=Math.max(this.PostfixCommentLength,o.PostfixCommentLength),this.IsAnyPostCommentLineStyle||(this.IsAnyPostCommentLineStyle=o.IsPostCommentLineStyle),o.Complexity>=2&&(this.PadType=t.BracketPaddingType.Complex),!!this.IsRowDataCompatible)){if(o.Type===e.JsonItemType.Array)for(let r=0;r<o.Children.length;++r)this.Children.length<=r&&this.Children.push(new Bp(this._pads,this._numberListAlignment)),this.Children[r].MeasureRowSegment(o.Children[r]);else if(o.Type===e.JsonItemType.Object){if(this.ContainsDuplicateKeys(o.Children)){this.IsRowDataCompatible=!1;return}for(const r of o.Children){let l=this.Children.find(c=>c.LocationInParent===r.Name);l||(l=new Bp(this._pads,this._numberListAlignment),l.LocationInParent=r.Name,this.Children.push(l)),l.MeasureRowSegment(r)}}else if(o.Type===e.JsonItemType.Number&&this.IsNumberList){const l=Number(o.Value),c=l.toString();this.AllowNumberNormalization&&(this.AllowNumberNormalization=!isNaN(l)&&l!==1/0&&l!==-1/0&&c.length<=15&&c.indexOf("e")<0&&(l!==0||Bp._trulyZeroValString.test(o.Value)));const d=c.indexOf(".");this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,d>=0?d:c.length),this._maxDigAfterDecNorm=Math.max(this._maxDigAfterDecNorm,d>=0?c.length-d-1:0);const u=o.Value.search(Bp._dotOrE);this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,u>=0?u:o.ValueLength),this._maxDigAfterDecRaw=Math.max(this._maxDigAfterDecRaw,u>=0?o.ValueLength-u-1:0)}this.AllowNumberNormalization&&(this.AllowNumberNormalization=this.IsNumberList)}}PruneAndRecompute(o){(o<=0||!this.IsRowDataCompatible)&&(this.Children=[]);for(const r of this.Children)r.PruneAndRecompute(o-1);if(this.IsNumberList)this.CompositeValueLength=this.GetNumberFieldWidth();else if(this.Children.length>0){const r=this.Children.map(l=>l.TotalLength).reduce((l,c)=>l+c);this.CompositeValueLength=r+Math.max(0,this._pads.CommaLen*(this.Children.length-1))+this._pads.ArrStartLen(this.PadType)+this._pads.ArrEndLen(this.PadType)}else this.CompositeValueLength=this.SimpleValueLength;this.TotalLength=(this.PrefixCommentLength>0?this.PrefixCommentLength+this._pads.CommentLen:0)+(this.NameLength>0?this.NameLength+this._pads.ColonLen:0)+(this.MiddleCommentLength>0?this.MiddleCommentLength+this._pads.CommentLen:0)+this.CompositeValueLength+(this.PostfixCommentLength>0?this.PostfixCommentLength+this._pads.CommentLen:0)}GetTemplateComplexity(){if(this.Children.length===0)return 0;const o=this.Children.map(r=>r.GetTemplateComplexity());return 1+Math.max(...o)}ContainsDuplicateKeys(o){const r=o.map(l=>l.Name);return r.some((l,c)=>r.indexOf(l)!==c)}GetNumberFieldWidth(){if(this._numberListAlignment===n.NumberListAlignment.Normalize&&this.AllowNumberNormalization){const o=this._maxDigAfterDecNorm>0?1:0;return this._maxDigBeforeDecNorm+o+this._maxDigAfterDecNorm}else if(this._numberListAlignment===n.NumberListAlignment.Decimal){const o=this._maxDigAfterDecRaw>0?1:0;return this._maxDigBeforeDecRaw+o+this._maxDigAfterDecRaw}return this.SimpleValueLength}};return c0.TableTemplate=s,s._trulyZeroValString=new RegExp("^-?[0.]+([eE].*)?$"),s._dotOrE=new RegExp("[.eE]"),c0}var d0={},u0={},q7;function h9e(){if(q7)return u0;q7=1,Object.defineProperty(u0,"__esModule",{value:!0}),u0.TokenEnumerator=void 0;const e=Nm();let t=class{constructor(s){this._generator=s}get Current(){if(!this._current)throw new e.FracturedJsonError("Illegal enumerator usage");return this._current}MoveNext(){const s=this._generator.next();return this._current=s.value,!s.done}};return u0.TokenEnumerator=t,u0}var h0={},K7;function pee(){if(K7)return h0;K7=1,Object.defineProperty(h0,"__esModule",{value:!0}),h0.JsonItem=void 0;const e=Fm();let t=class{constructor(){this.Type=e.JsonItemType.Null,this.InputPosition={Index:0,Row:0,Column:0},this.Complexity=0,this.Name="",this.Value="",this.PrefixComment="",this.MiddleComment="",this.PostfixComment="",this.IsPostCommentLineStyle=!1,this.NameLength=0,this.ValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.MinimumTotalLength=0,this.RequiresMultipleLines=!1,this.Children=[]}};return h0.JsonItem=t,h0}var Qj={},Z7;function fee(){return Z7||(Z7=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TokenType=void 0,function(t){t[t.Invalid=0]="Invalid",t[t.BeginArray=1]="BeginArray",t[t.EndArray=2]="EndArray",t[t.BeginObject=3]="BeginObject",t[t.EndObject=4]="EndObject",t[t.String=5]="String",t[t.Number=6]="Number",t[t.Null=7]="Null",t[t.True=8]="True",t[t.False=9]="False",t[t.BlockComment=10]="BlockComment",t[t.LineComment=11]="LineComment",t[t.BlankLine=12]="BlankLine",t[t.Comma=13]="Comma",t[t.Colon=14]="Colon"}(e.TokenType||(e.TokenType={}))}(Qj)),Qj}var p0={},f0={},X7;function p9e(){if(X7)return f0;X7=1,Object.defineProperty(f0,"__esModule",{value:!0}),f0.ScannerState=void 0;const e=Nm();let t=class{constructor(i){this.CurrentPosition={Index:0,Row:0,Column:0},this.TokenPosition={Index:0,Row:0,Column:0},this.NonWhitespaceSinceLastNewline=!1,this._originalText=i}Advance(i){if(this.CurrentPosition.Index>=n)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Column+=1,this.NonWhitespaceSinceLastNewline||(this.NonWhitespaceSinceLastNewline=!i)}NewLine(){if(this.CurrentPosition.Index>=n)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Row+=1,this.CurrentPosition.Column=0,this.NonWhitespaceSinceLastNewline=!1}SetTokenStart(){this.TokenPosition=Object.assign({},this.CurrentPosition)}MakeTokenFromBuffer(i,o=!1){const r=this._originalText.substring(this.TokenPosition.Index,this.CurrentPosition.Index);return{Type:i,Text:o?r.trimEnd():r,InputPosition:Object.assign({},this.TokenPosition)}}MakeToken(i,o){return{Type:i,Text:o,InputPosition:Object.assign({},this.TokenPosition)}}Current(){return this.AtEnd()?NaN:this._originalText.charCodeAt(this.CurrentPosition.Index)}AtEnd(){return this.CurrentPosition.Index>=this._originalText.length}Throw(i){throw new e.FracturedJsonError(i,this.CurrentPosition)}};f0.ScannerState=t;const n=2e9;return f0}var Y7;function f9e(){if(Y7)return p0;Y7=1,Object.defineProperty(p0,"__esModule",{value:!0}),p0.TokenGenerator=void 0;const e=p9e(),t=fee();function*n(B){const Y=new e.ScannerState(B);for(;;){if(Y.AtEnd())return;const ie=Y.Current();switch(ie){case c:case p:case u:Y.Advance(!0);break;case d:Y.NonWhitespaceSinceLastNewline||(yield Y.MakeToken(t.TokenType.BlankLine,`
`)),Y.NewLine(),Y.SetTokenStart();break;case b:yield s(Y,"{",t.TokenType.BeginObject);break;case C:yield s(Y,"}",t.TokenType.EndObject);break;case y:yield s(Y,"[",t.TokenType.BeginArray);break;case x:yield s(Y,"]",t.TokenType.EndArray);break;case w:yield s(Y,":",t.TokenType.Colon);break;case _:yield s(Y,",",t.TokenType.Comma);break;case U:yield i(Y,"true",t.TokenType.True);break;case X:yield i(Y,"false",t.TokenType.False);break;case V:yield i(Y,"null",t.TokenType.Null);break;case m:yield o(Y);break;case v:yield r(Y);break;case I:yield l(Y);break;default:W(ie)||Y.Throw("Unexpected character"),yield l(Y);break}}}p0.TokenGenerator=n;function s(B,Y,ie){B.SetTokenStart();const ge=B.MakeToken(ie,Y);return B.Advance(!1),ge}function i(B,Y,ie){B.SetTokenStart();for(let xe=1;xe<Y.length;++xe)B.AtEnd()&&B.Throw("Unexpected end of input while processing keyword"),B.Advance(!1),B.Current()!==Y.charCodeAt(xe)&&B.Throw("Unexpected keyword");const ge=B.MakeToken(ie,Y);return B.Advance(!1),ge}function o(B){B.SetTokenStart(),B.AtEnd()&&B.Throw("Unexpected end of input while processing comment"),B.Advance(!1);let Y=!1;B.Current()===f?Y=!0:B.Current()!==m&&B.Throw("Bad character for start of comment"),B.Advance(!1);let ie=!1;for(;;){if(B.AtEnd())if(Y)B.Throw("Unexpected end of input while processing comment");else return B.MakeTokenFromBuffer(t.TokenType.LineComment,!0);const ge=B.Current();if(ge===d){if(B.NewLine(),!Y)return B.MakeTokenFromBuffer(t.TokenType.LineComment,!0);continue}if(B.Advance(!1),ge===m&&ie)return B.MakeTokenFromBuffer(t.TokenType.BlockComment);ie=ge===f}}function r(B){B.SetTokenStart(),B.Advance(!1);let Y=!1,ie=0;for(;;){B.AtEnd()&&B.Throw("Unexpected end of input while processing string");const ge=B.Current();if(ie>0){R(ge)||B.Throw("Bad unicode escape in string"),ie-=1,B.Advance(!1);continue}if(Y){G(ge)||B.Throw("Bad escaped character in string"),ge===Z&&(ie=4),Y=!1,B.Advance(!1);continue}if(H(ge)&&B.Throw("Control characters are not allowed in strings"),B.Advance(!1),ge===v)return B.MakeTokenFromBuffer(t.TokenType.String);ge===g&&(Y=!0)}}function l(B){B.SetTokenStart();let Y=$.Beginning;for(;;){const ie=B.Current();let ge=z.ValidAndConsumed;switch(Y){case $.Beginning:ie===I?Y=$.PastLeadingSign:ie===E?Y=$.PastWhole:W(ie)?Y=$.PastFirstDigitOfWhole:ge=z.InvalidatesToken;break;case $.PastLeadingSign:W(ie)?ie===E?Y=$.PastWhole:Y=$.PastFirstDigitOfWhole:ge=z.InvalidatesToken;break;case $.PastFirstDigitOfWhole:ie===k?Y=$.PastDecimalPoint:ie===N||ie===F?Y=$.PastE:W(ie)||(ge=z.StartOfNewToken);break;case $.PastWhole:ie===k?Y=$.PastDecimalPoint:ie===N||ie===F?Y=$.PastE:ge=z.StartOfNewToken;break;case $.PastDecimalPoint:W(ie)?Y=$.PastFirstDigitOfFractional:ge=z.InvalidatesToken;break;case $.PastFirstDigitOfFractional:ie===N||ie===F?Y=$.PastE:W(ie)||(ge=z.StartOfNewToken);break;case $.PastE:ie===S||ie===I?Y=$.PastExpSign:W(ie)?Y=$.PastFirstDigitOfExponent:ge=z.InvalidatesToken;break;case $.PastExpSign:W(ie)?Y=$.PastFirstDigitOfExponent:ge=z.InvalidatesToken;break;case $.PastFirstDigitOfExponent:W(ie)||(ge=z.StartOfNewToken);break}if(ge===z.InvalidatesToken&&B.Throw("Bad character while processing number"),ge===z.StartOfNewToken)return B.MakeTokenFromBuffer(t.TokenType.Number);if(!B.AtEnd()){B.Advance(!1);continue}switch(Y){case $.PastFirstDigitOfWhole:case $.PastWhole:case $.PastFirstDigitOfFractional:case $.PastFirstDigitOfExponent:return B.MakeTokenFromBuffer(t.TokenType.Number);default:B.Throw("Unexpected end of input while processing number");break}}}const c=32,d=10,u=13,p=9,m=47,f=42,g=92,v=34,b=123,C=125,y=91,x=93,w=58,_=44,S=43,I=45,k=46,E=48,j=57,P=97,D=65,O=98,N=101,F=69,X=102,L=70,V=110,K=114,U=116,Z=117;function W(B){return B>=E&&B<=j}function R(B){return B>=E&&B<=j||B>=P&&B<=X||B>=D&&B<=L}function G(B){switch(B){case v:case g:case m:case O:case X:case V:case K:case U:case Z:return!0;default:return!1}}function H(B){return B>=0&&B<=31||B===127||B>=128&&B<=159}var $;(function(B){B[B.Beginning=0]="Beginning",B[B.PastLeadingSign=1]="PastLeadingSign",B[B.PastFirstDigitOfWhole=2]="PastFirstDigitOfWhole",B[B.PastWhole=3]="PastWhole",B[B.PastDecimalPoint=4]="PastDecimalPoint",B[B.PastFirstDigitOfFractional=5]="PastFirstDigitOfFractional",B[B.PastE=6]="PastE",B[B.PastExpSign=7]="PastExpSign",B[B.PastFirstDigitOfExponent=8]="PastFirstDigitOfExponent"})($||($={}));var z;return function(B){B[B.InvalidatesToken=0]="InvalidatesToken",B[B.ValidAndConsumed=1]="ValidAndConsumed",B[B.StartOfNewToken=2]="StartOfNewToken"}(z||(z={})),p0}var Q7;function m9e(){if(Q7)return d0;Q7=1,Object.defineProperty(d0,"__esModule",{value:!0}),d0.Parser=void 0;const e=C6(),t=h9e(),n=pee(),s=Fm(),i=fee(),o=Nm(),r=y6(),l=f9e();let c=class zp{constructor(){this.Options=new e.FracturedJsonOptions}ParseTopLevel(m,f){const g=new t.TokenEnumerator((0,l.TokenGenerator)(m));return this.ParseTopLevelFromEnum(g,f)}ParseTopLevelFromEnum(m,f){const g=[];let v=!1;for(;;){if(!m.MoveNext())return g;const b=this.ParseItem(m),C=b.Type===s.JsonItemType.BlockComment||b.Type===s.JsonItemType.LineComment;if(b.Type===s.JsonItemType.BlankLine)this.Options.PreserveBlankLines&&g.push(b);else if(C){if(this.Options.CommentPolicy===r.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",b.InputPosition);this.Options.CommentPolicy===r.CommentPolicy.Preserve&&g.push(b)}else{if(f&&v)throw new o.FracturedJsonError("Unexpected start of second top level element",b.InputPosition);g.push(b),v=!0}}}ParseItem(m){switch(m.Current.Type){case i.TokenType.BeginArray:return this.ParseArray(m);case i.TokenType.BeginObject:return this.ParseObject(m);default:return this.ParseSimple(m.Current)}}ParseSimple(m){const f=new n.JsonItem;return f.Type=zp.ItemTypeFromTokenType(m),f.Value=m.Text,f.InputPosition=m.InputPosition,f.Complexity=0,f}ParseArray(m){if(m.Current.Type!==i.TokenType.BeginArray)throw new o.FracturedJsonError("Parser logic error",m.Current.InputPosition);const f=m.Current.InputPosition;let g,v=-1,b;const C=[];let y=d.EmptyCollection,x=!1,w=0;for(;!x;){const S=zp.GetNextTokenOrThrow(m,f);switch(b&&(b?.InputPosition.Row!==S.InputPosition.Row||S.Type===i.TokenType.EndArray)&&(g?(g.PostfixComment=b.Value,g.IsPostCommentLineStyle=b.Type===s.JsonItemType.LineComment):C.push(b),b=void 0),g&&v!==S.InputPosition.Row&&(g=void 0),S.Type){case i.TokenType.EndArray:if(y===d.CommaSeen&&!this.Options.AllowTrailingCommas)throw new o.FracturedJsonError("Array may not end with a comma with current options",S.InputPosition);x=!0;break;case i.TokenType.Comma:if(y!==d.ElementSeen)throw new o.FracturedJsonError("Unexpected comma in array",S.InputPosition);y=d.CommaSeen;break;case i.TokenType.BlankLine:if(!this.Options.PreserveBlankLines)break;C.push(this.ParseSimple(S));break;case i.TokenType.BlockComment:if(this.Options.CommentPolicy===r.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===r.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",S.InputPosition);b&&(C.push(b),b=void 0);const k=this.ParseSimple(S);if(zp.IsMultilineComment(k)){C.push(k);break}if(g&&y===d.ElementSeen){g.PostfixComment=k.Value,g.IsPostCommentLineStyle=!1,g=void 0;break}b=k;break;case i.TokenType.LineComment:if(this.Options.CommentPolicy===r.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===r.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",S.InputPosition);if(b){C.push(b),C.push(this.ParseSimple(S)),b=void 0;break}if(g){g.PostfixComment=S.Text,g.IsPostCommentLineStyle=!0,g=void 0;break}C.push(this.ParseSimple(S));break;case i.TokenType.False:case i.TokenType.True:case i.TokenType.Null:case i.TokenType.String:case i.TokenType.Number:case i.TokenType.BeginArray:case i.TokenType.BeginObject:if(y===d.ElementSeen)throw new o.FracturedJsonError("Comma missing while processing array",S.InputPosition);const E=this.ParseItem(m);y=d.ElementSeen,w=Math.max(w,E.Complexity+1),b&&(E.PrefixComment=b.Value,b=void 0),C.push(E),g=E,v=m.Current.InputPosition.Row;break;default:throw new o.FracturedJsonError("Unexpected token in array",S.InputPosition)}}const _=new n.JsonItem;return _.Type=s.JsonItemType.Array,_.InputPosition=f,_.Complexity=w,_.Children=C,_}ParseObject(m){if(m.Current.Type!==i.TokenType.BeginObject)throw new o.FracturedJsonError("Parser logic error",m.Current.InputPosition);const f=m.Current.InputPosition,g=[];let v,b,C=-1,y=[],x=[],w,_=!1,S=u.BeforePropName,I=0,k=!1;for(;!k;){const j=zp.GetNextTokenOrThrow(m,f),P=C!==j.InputPosition.Row,D=j.Type===i.TokenType.EndObject,O=j.Type===i.TokenType.String&&S===u.AfterComma,N=w&&(j.Type===i.TokenType.BlockComment||j.Type===i.TokenType.LineComment);if(v&&b&&(P||D||O||N)){let X;O&&_&&!P&&(X=w,w=void 0),zp.AttachObjectValuePieces(g,v,b,C,y,x,w),I=Math.max(I,b.Complexity+1),v=void 0,b=void 0,y=[],x=[],w=void 0,X&&y.push(X)}switch(j.Type){case i.TokenType.BlankLine:if(!this.Options.PreserveBlankLines||S===u.AfterPropName||S===u.AfterColon)break;g.push(...y),y=[],g.push(this.ParseSimple(j));break;case i.TokenType.BlockComment:case i.TokenType.LineComment:if(this.Options.CommentPolicy===r.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===r.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",j.InputPosition);S===u.BeforePropName||!v?y.push(this.ParseSimple(j)):S===u.AfterPropName||S===u.AfterColon?x.push(j):(w=this.ParseSimple(j),_=S===u.AfterComma);break;case i.TokenType.EndObject:if(S===u.AfterPropName||S===u.AfterColon)throw new o.FracturedJsonError("Unexpected end of object",j.InputPosition);k=!0;break;case i.TokenType.String:if(S===u.BeforePropName||S===u.AfterComma)v=j,S=u.AfterPropName;else if(S===u.AfterColon)b=this.ParseItem(m),C=m.Current.InputPosition.Row,S=u.AfterPropValue;else throw new o.FracturedJsonError("Unexpected string found while processing object",j.InputPosition);break;case i.TokenType.False:case i.TokenType.True:case i.TokenType.Null:case i.TokenType.Number:case i.TokenType.BeginArray:case i.TokenType.BeginObject:if(S!==u.AfterColon)throw new o.FracturedJsonError("Unexpected element while processing object",j.InputPosition);b=this.ParseItem(m),C=m.Current.InputPosition.Row,S=u.AfterPropValue;break;case i.TokenType.Colon:if(S!==u.AfterPropName)throw new o.FracturedJsonError("Unexpected colon while processing object",j.InputPosition);S=u.AfterColon;break;case i.TokenType.Comma:if(S!==u.AfterPropValue)throw new o.FracturedJsonError("Unexpected comma while processing object",j.InputPosition);S=u.AfterComma;break;default:throw new o.FracturedJsonError("Unexpected token while processing object",j.InputPosition)}}if(!this.Options.AllowTrailingCommas&&S===u.AfterComma)throw new o.FracturedJsonError("Object may not end with comma with current options",m.Current.InputPosition);const E=new n.JsonItem;return E.Type=s.JsonItemType.Object,E.InputPosition=f,E.Complexity=I,E.Children=g,E}static ItemTypeFromTokenType(m){switch(m.Type){case i.TokenType.False:return s.JsonItemType.False;case i.TokenType.True:return s.JsonItemType.True;case i.TokenType.Null:return s.JsonItemType.Null;case i.TokenType.Number:return s.JsonItemType.Number;case i.TokenType.String:return s.JsonItemType.String;case i.TokenType.BlankLine:return s.JsonItemType.BlankLine;case i.TokenType.BlockComment:return s.JsonItemType.BlockComment;case i.TokenType.LineComment:return s.JsonItemType.LineComment;default:throw new o.FracturedJsonError("Unexpected Token",m.InputPosition)}}static GetNextTokenOrThrow(m,f){if(!m.MoveNext())throw new o.FracturedJsonError("Unexpected end of input while processing array or object starting",f);return m.Current}static IsMultilineComment(m){return m.Type===s.JsonItemType.BlockComment&&m.Value.includes(`
`)}static AttachObjectValuePieces(m,f,g,v,b,C,y){if(g.Name=f.Text,C.length>0){let x="";for(let w=0;w<C.length;++w)x+=C[w].Text,(w<C.length-1||C[w].Type===i.TokenType.LineComment)&&(x+=`
`);g.MiddleComment=x}if(b.length>0){const x=b.pop();x.Type===s.JsonItemType.BlockComment&&x.InputPosition.Row===g.InputPosition.Row?(g.PrefixComment=x.Value,m.push(...b)):(m.push(...b),m.push(x))}m.push(g),y&&(!this.IsMultilineComment(y)&&y.InputPosition.Row===v?(g.PostfixComment=y.Value,g.IsPostCommentLineStyle=y.Type===s.JsonItemType.LineComment):m.push(y))}};d0.Parser=c;var d;(function(p){p[p.EmptyCollection=0]="EmptyCollection",p[p.ElementSeen=1]="ElementSeen",p[p.CommaSeen=2]="CommaSeen"})(d||(d={}));var u;return function(p){p[p.BeforePropName=0]="BeforePropName",p[p.AfterPropName=1]="AfterPropName",p[p.AfterColon=2]="AfterColon",p[p.AfterPropValue=3]="AfterPropValue",p[p.AfterComma=4]="AfterComma"}(u||(u={})),d0}var m0={},J7;function g9e(){if(J7)return m0;J7=1,Object.defineProperty(m0,"__esModule",{value:!0}),m0.ConvertDataToDom=void 0;const e=pee(),t=Fm(),n=Nm();function s(i,o,r=100){var l;if(r<=0)throw new n.FracturedJsonError("Depth limit exceeded - possible circular reference");const c=typeof i;switch(c){case"function":case"symbol":case"undefined":return}if(i&&i.toJSON){const u=JSON.parse(JSON.stringify(i));return s(u,o,r-1)}const d=new e.JsonItem;if(d.Name=o?JSON.stringify(o):"",i===null)d.Type=t.JsonItemType.Null,d.Value="null";else if(Array.isArray(i)){d.Type=t.JsonItemType.Array,d.Children=i.map(u=>{var p;return(p=s(u,void 0,r-1))!==null&&p!==void 0?p:s(null,void 0,r-1)}),d.Children=[];for(let u=0;u<i.length;++u)d.Children[u]=(l=s(i[u],void 0,r-1))!==null&&l!==void 0?l:s(null,void 0,r-1)}else if(c==="object"){d.Type=t.JsonItemType.Object;for(const u of Object.entries(i)){const p=s(u[1],u[0],r-1);p&&d.Children.push(p)}}else{switch(c){case"string":d.Type=t.JsonItemType.String;break;case"number":case"bigint":d.Type=t.JsonItemType.Number;break;case"boolean":d.Type=i?t.JsonItemType.True:t.JsonItemType.False;break}d.Value=JSON.stringify(i)}if(d.Children.length>0){const u=d.Children.map(p=>p.Complexity).reduce((p,m)=>Math.max(p,m));d.Complexity=u+1}return d}return m0.ConvertDataToDom=s,m0}var e9;function v9e(){if(e9)return a0;e9=1,Object.defineProperty(a0,"__esModule",{value:!0}),a0.Formatter=void 0;const e=C6(),t=c9e(),n=d9e(),s=Fm(),i=w6(),o=u9e(),r=Nm(),l=m9e(),c=g9e(),d=x6();let u=class po{constructor(){this.Options=new e.FracturedJsonOptions,this.StringLengthFunc=po.StringLengthByCharCount,this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),this._pads=new n.PaddedFormattingTokens(new e.FracturedJsonOptions,po.StringLengthByCharCount)}static StringLengthByCharCount(f){return f.length}Reformat(f,g=0){const v=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),b=new l.Parser;b.Options=this.Options;const C=b.ParseTopLevel(f,!0);return this.FormatTopLevel(C,g,v),v.Flush(),v.AsString()}Serialize(f,g=0,v=100){const b=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),C=(0,c.ConvertDataToDom)(f,void 0,v);if(C)return this.FormatTopLevel([C],g,b),b.Flush(),b.AsString()}Minify(f){const g=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),v=new l.Parser;v.Options=this.Options;const b=v.ParseTopLevel(f,!0);return this.MinifyTopLevel(b,g),g.Flush(),g.AsString()}FormatTopLevel(f,g,v){this._buffer=v,this._pads=new n.PaddedFormattingTokens(this.Options,this.StringLengthFunc);for(const b of f)this.ComputeItemLengths(b),this.FormatItem(b,g,!1);this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}MinifyTopLevel(f,g){this._buffer=g,this._pads=new n.PaddedFormattingTokens(this.Options,this.StringLengthFunc);let v=!0;for(const b of f)v=this.MinifyItem(b,v);this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}ComputeItemLengths(f){const g=`
`;for(const v of f.Children)this.ComputeItemLengths(v);switch(f.Type){case s.JsonItemType.Null:f.ValueLength=this._pads.LiteralNullLen;break;case s.JsonItemType.True:f.ValueLength=this._pads.LiteralTrueLen;break;case s.JsonItemType.False:f.ValueLength=this._pads.LiteralFalseLen;break;default:f.ValueLength=this.StringLengthFunc(f.Value);break}if(f.NameLength=this.StringLengthFunc(f.Name),f.PrefixCommentLength=this.StringLengthFunc(f.PrefixComment),f.MiddleCommentLength=this.StringLengthFunc(f.MiddleComment),f.PostfixCommentLength=this.StringLengthFunc(f.PostfixComment),f.RequiresMultipleLines=po.IsCommentOrBlankLine(f.Type)||f.Children.some(v=>v.RequiresMultipleLines||v.IsPostCommentLineStyle)||f.PrefixComment.indexOf(g)>=0||f.MiddleComment.indexOf(g)>=0||f.PostfixComment.indexOf(g)>=0||f.Value.indexOf(g)>=0,f.Type===s.JsonItemType.Array||f.Type===s.JsonItemType.Object){const v=po.GetPaddingType(f);f.ValueLength=this._pads.StartLen(f.Type,v)+this._pads.EndLen(f.Type,v)+f.Children.map(b=>b.MinimumTotalLength).reduce((b,C)=>b+C,0)+Math.max(0,this._pads.CommaLen*(f.Children.length-1))}f.MinimumTotalLength=(f.PrefixCommentLength>0?f.PrefixCommentLength+this._pads.CommentLen:0)+(f.NameLength>0?f.NameLength+this._pads.ColonLen:0)+(f.MiddleCommentLength>0?f.MiddleCommentLength+this._pads.CommentLen:0)+f.ValueLength+(f.PostfixCommentLength>0?f.PostfixCommentLength+this._pads.CommentLen:0)}FormatItem(f,g,v){switch(f.Type){case s.JsonItemType.Array:case s.JsonItemType.Object:this.FormatContainer(f,g,v);break;case s.JsonItemType.BlankLine:this.FormatBlankLine();break;case s.JsonItemType.BlockComment:case s.JsonItemType.LineComment:this.FormatStandaloneComment(f,g);break;default:f.RequiresMultipleLines?this.FormatSplitKeyValue(f,g,v):this.FormatInlineElement(f,g,v);break}}FormatContainer(f,g,v){g>this.Options.AlwaysExpandDepth&&(this.FormatContainerInline(f,g,v)||this.FormatContainerCompactMultiline(f,g,v))||g>=this.Options.AlwaysExpandDepth&&this.FormatContainerTable(f,g,v)||this.FormatContainerExpanded(f,g,v)}FormatContainerInline(f,g,v){if(f.RequiresMultipleLines)return!1;const b=f.MinimumTotalLength+(v?this._pads.CommaLen:0);return f.Complexity>this.Options.MaxInlineComplexity||b>this.AvailableLineSpace(g)?!1:(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(g)),this.InlineElement(f,v),this._buffer.EndLine(this._pads.EOL),!0)}FormatContainerCompactMultiline(f,g,v){if(f.Type!==s.JsonItemType.Array||f.Complexity>this.Options.MaxCompactArrayComplexity||f.RequiresMultipleLines)return!1;const b=new o.TableTemplate(this._pads,this.Options.NumberListAlignment);b.MeasureTableRoot(f);const C=this.AvailableLineSpace(g+1);let y=this._pads.CommaLen;if(b.IsRowDataCompatible?y+=b.TotalLength:y+=f.Children.map(S=>S.MinimumTotalLength).reduce((S,I)=>S+I,0)/f.Children.length,y*this.Options.MinCompactArrayRowItems>C)return!1;const x=this.StandardFormatStart(f,g);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty));const w=this.AvailableLineSpace(x+1);let _=-1;for(let S=0;S<f.Children.length;++S){const I=f.Children[S],k=S<f.Children.length-1,E=(k?this._pads.CommaLen:0)+(b.IsRowDataCompatible?b.TotalLength:I.MinimumTotalLength);_<E&&(this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(x+1)),_=w),b.IsRowDataCompatible?this.InlineTableRowSegment(b,I,k,!1):this.InlineElement(I,k),_-=E}return this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(x),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,v),!0}FormatContainerTable(f,g,v){if(f.Complexity>this.Options.MaxTableRowComplexity+1)return!1;const b=this.AvailableLineSpace(g+1)-this._pads.CommaLen;if(f.Children.filter(_=>!po.IsCommentOrBlankLine(_.Type)).some(_=>_.MinimumTotalLength>b))return!1;const y=new o.TableTemplate(this._pads,this.Options.NumberListAlignment);if(y.MeasureTableRoot(f),!y.IsRowDataCompatible||!y.TryToFit(b))return!1;const x=this.StandardFormatStart(f,g);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const w=po.IndexOfLastElement(f.Children);for(let _=0;_<f.Children.length;++_){const S=f.Children[_];if(S.Type===s.JsonItemType.BlankLine){this.FormatBlankLine();continue}if(S.Type===s.JsonItemType.LineComment||S.Type===s.JsonItemType.BlockComment){this.FormatStandaloneComment(S,x+1);continue}this._buffer.Add(this.Options.PrefixString,this._pads.Indent(x+1)),this.InlineTableRowSegment(y,S,_<w,!0),this._buffer.EndLine(this._pads.EOL)}return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(x),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,v),!0}FormatContainerExpanded(f,g,v){const b=this.StandardFormatStart(f,g);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const C=po.IndexOfLastElement(f.Children);for(let y=0;y<f.Children.length;++y)this.FormatItem(f.Children[y],b+1,y<C);this._buffer.Add(this.Options.PrefixString,this._pads.Indent(b),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,v)}FormatStandaloneComment(f,g){const v=po.NormalizeMultilineComment(f.Value,f.InputPosition.Column);for(const b of v)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(g),b).EndLine(this._pads.EOL)}FormatBlankLine(){this._buffer.Add(this.Options.PrefixString).EndLine(this._pads.EOL)}FormatInlineElement(f,g,v){this._buffer.Add(this.Options.PrefixString,this._pads.Indent(g)),this.InlineElement(f,v),this._buffer.EndLine(this._pads.EOL)}FormatSplitKeyValue(f,g,v){this.StandardFormatStart(f,g),this._buffer.Add(f.Value),this.StandardFormatEnd(f,v)}StandardFormatStart(f,g){if(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(g)),f.PrefixCommentLength>0&&this._buffer.Add(f.PrefixComment,this._pads.Comment),f.NameLength>0&&this._buffer.Add(f.Name,this._pads.Colon),f.MiddleCommentLength===0)return g;if(f.MiddleComment.indexOf(`
`)<0)return this._buffer.Add(f.MiddleComment,this._pads.Comment),g;const v=po.NormalizeMultilineComment(f.MiddleComment,Number.MAX_VALUE);this._buffer.EndLine(this._pads.EOL);for(const b of v)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(g+1),b).EndLine(this._pads.EOL);return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(g+1)),g+1}StandardFormatEnd(f,g){g&&f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,f.PostfixComment),g&&!f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),this._buffer.EndLine(this._pads.EOL)}InlineElement(f,g){if(f.RequiresMultipleLines)throw new r.FracturedJsonError("Logic error - trying to inline invalid element");f.PrefixCommentLength>0&&this._buffer.Add(f.PrefixComment,this._pads.Comment),f.NameLength>0&&this._buffer.Add(f.Name,this._pads.Colon),f.MiddleCommentLength>0&&this._buffer.Add(f.MiddleComment,this._pads.Comment),this.InlineElementRaw(f),g&&f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,f.PostfixComment),g&&!f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma)}InlineElementRaw(f){if(f.Type===s.JsonItemType.Array){const g=po.GetPaddingType(f);this._buffer.Add(this._pads.ArrStart(g));for(let v=0;v<f.Children.length;++v)this.InlineElement(f.Children[v],v<f.Children.length-1);this._buffer.Add(this._pads.ArrEnd(g))}else if(f.Type===s.JsonItemType.Object){const g=po.GetPaddingType(f);this._buffer.Add(this._pads.ObjStart(g));for(let v=0;v<f.Children.length;++v)this.InlineElement(f.Children[v],v<f.Children.length-1);this._buffer.Add(this._pads.ObjEnd(g))}else this._buffer.Add(f.Value)}InlineTableRowSegment(f,g,v,b){f.PrefixCommentLength>0&&this._buffer.Add(g.PrefixComment,this._pads.Spaces(f.PrefixCommentLength-g.PrefixCommentLength),this._pads.Comment),f.NameLength>0&&this._buffer.Add(g.Name,this._pads.Spaces(f.NameLength-g.NameLength),this._pads.Colon),f.MiddleCommentLength>0&&this._buffer.Add(g.MiddleComment,this._pads.Spaces(f.MiddleCommentLength-g.MiddleCommentLength),this._pads.Comment);const C=this.Options.TableCommaPlacement==d.TableCommaPlacement.BeforePadding||this.Options.TableCommaPlacement==d.TableCommaPlacement.BeforePaddingExceptNumbers&&!f.IsNumberList;let y;f.PostfixCommentLength>0&&!f.IsAnyPostCommentLineStyle?g.PostfixCommentLength>0?y=C?p.BeforeCommentPadding:p.AfterCommentPadding:y=C?p.BeforeValuePadding:p.AfterCommentPadding:y=C?p.BeforeValuePadding:p.AfterValuePadding;const x=v?this._pads.Comma:b?this._pads.DummyComma:"";if(f.Children.length>0&&g.Type!==s.JsonItemType.Null)f.Type===s.JsonItemType.Array?this.InlineTableRawArray(f,g):this.InlineTableRawObject(f,g),y==p.BeforeValuePadding&&this._buffer.Add(x);else if(f.IsNumberList){const w=y==p.BeforeValuePadding?x:"";f.FormatNumber(this._buffer,g,w)}else this.InlineElementRaw(g),y==p.BeforeValuePadding&&this._buffer.Add(x),this._buffer.Add(this._pads.Spaces(f.CompositeValueLength-g.ValueLength));y==p.AfterValuePadding&&this._buffer.Add(x),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,g.PostfixComment),y==p.BeforeCommentPadding&&this._buffer.Add(x),this._buffer.Add(this._pads.Spaces(f.PostfixCommentLength-g.PostfixCommentLength)),y==p.AfterCommentPadding&&this._buffer.Add(x)}InlineTableRawArray(f,g){this._buffer.Add(this._pads.ArrStart(f.PadType));for(let v=0;v<f.Children.length;++v){const b=v===f.Children.length-1,C=v===g.Children.length-1,y=v>=g.Children.length,x=f.Children[v];y?(this._buffer.Add(this._pads.Spaces(x.TotalLength)),b||this._buffer.Add(this._pads.DummyComma)):(this.InlineTableRowSegment(x,g.Children[v],!C,!1),C&&!b&&this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ArrEnd(f.PadType))}InlineTableRawObject(f,g){function v(y){return g.Children.find(x=>x.Name===y.LocationInParent)}const b=f.Children.map(y=>({tt:y,ji:v(y)}));let C=b.length-1;for(;C>=0&&!b[C].ji;)C-=1;this._buffer.Add(this._pads.ObjStart(f.PadType));for(let y=0;y<b.length;++y){const x=b[y].tt,w=b[y].ji,_=y===C,S=y===b.length-1;w?(this.InlineTableRowSegment(x,w,!_,!1),_&&!S&&this._buffer.Add(this._pads.DummyComma)):(this._buffer.Add(this._pads.Spaces(x.TotalLength)),S||this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ObjEnd(f.PadType))}AvailableLineSpace(f){return Math.min(this.Options.MaxInlineLength,this.Options.MaxTotalLineLength-this._pads.PrefixStringLen-this.Options.IndentSpaces*f)}MinifyItem(f,g){const v=`
`;if(this._buffer.Add(f.PrefixComment),f.Name.length>0&&this._buffer.Add(f.Name,":"),f.MiddleComment.indexOf(v)>=0){const b=po.NormalizeMultilineComment(f.MiddleComment,Number.MAX_VALUE);for(const C of b)this._buffer.Add(C,v)}else this._buffer.Add(f.MiddleComment);if(f.Type===s.JsonItemType.Array||f.Type===s.JsonItemType.Object){let b;f.Type===s.JsonItemType.Array?(this._buffer.Add("["),b="]"):(this._buffer.Add("{"),b="}");let C=!1,y=!1;for(const x of f.Children)po.IsCommentOrBlankLine(x.Type)||(C&&this._buffer.Add(","),C=!0),y=this.MinifyItem(x,y);this._buffer.Add(b)}else{if(f.Type===s.JsonItemType.BlankLine)return g||this._buffer.Add(v),this._buffer.Add(v),!0;if(f.Type===s.JsonItemType.LineComment)return g||this._buffer.Add(v),this._buffer.Add(f.Value,v),!0;if(f.Type===s.JsonItemType.BlockComment){if(g||this._buffer.Add(v),f.Value.indexOf(v)>=0){const b=po.NormalizeMultilineComment(f.Value,f.InputPosition.Column);for(const C of b)this._buffer.Add(C,v);return!0}return this._buffer.Add(f.Value,v),!0}else this._buffer.Add(f.Value)}return this._buffer.Add(f.PostfixComment),f.PostfixComment.length>0&&f.IsPostCommentLineStyle?(this._buffer.Add(v),!0):!1}static GetPaddingType(f){return f.Children.length===0?i.BracketPaddingType.Empty:f.Complexity>=2?i.BracketPaddingType.Complex:i.BracketPaddingType.Simple}static NormalizeMultilineComment(f,g){const b=f.replace(/\r/g,"").split(`
`).filter(C=>C.length>0);for(let C=1;C<b.length;++C){const y=b[C];let x=0;for(;x<y.length&&x<g&&/\s/.test(y[x]);)x+=1;b[C]=y.substring(x)}return b}static IndexOfLastElement(f){for(let g=f.length-1;g>=0;--g)if(!this.IsCommentOrBlankLine(f[g].Type))return g;return-1}static IsCommentOrBlankLine(f){return f===s.JsonItemType.BlankLine||f===s.JsonItemType.BlockComment||f===s.JsonItemType.LineComment}};a0.Formatter=u;var p;return function(m){m[m.BeforeValuePadding=0]="BeforeValuePadding",m[m.AfterValuePadding=1]="AfterValuePadding",m[m.BeforeCommentPadding=2]="BeforeCommentPadding",m[m.AfterCommentPadding=3]="AfterCommentPadding"}(p||(p={})),a0}var t9;function y9e(){return t9||(t9=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Formatter=e.FracturedJsonError=e.TableCommaPlacement=e.NumberListAlignment=e.EolStyle=e.CommentPolicy=e.FracturedJsonOptions=void 0;var t=C6();Object.defineProperty(e,"FracturedJsonOptions",{enumerable:!0,get:function(){return t.FracturedJsonOptions}});var n=y6();Object.defineProperty(e,"CommentPolicy",{enumerable:!0,get:function(){return n.CommentPolicy}});var s=v6();Object.defineProperty(e,"EolStyle",{enumerable:!0,get:function(){return s.EolStyle}});var i=b6();Object.defineProperty(e,"NumberListAlignment",{enumerable:!0,get:function(){return i.NumberListAlignment}});var o=x6();Object.defineProperty(e,"TableCommaPlacement",{enumerable:!0,get:function(){return o.TableCommaPlacement}});var r=Nm();Object.defineProperty(e,"FracturedJsonError",{enumerable:!0,get:function(){return r.FracturedJsonError}});var l=v9e();Object.defineProperty(e,"Formatter",{enumerable:!0,get:function(){return l.Formatter}})}(Wj)),Wj}var mee=y9e();const _6=new mee.Formatter;_6.Options.TableCommaPlacement=mee.TableCommaPlacement.BeforePadding;_6.Options.OmitTrailingWhitespace=!0;const b9e=mr({overflowX:"scroll",overflowY:"scroll"}).options,x9e=ec("pre"),C9e=e=>{const{label:t,data:n,fileName:s,withDownload:i=!0,withCopy:o=!0,extraCopyActions:r,wrapData:l=!0,...c}=e,d=h.useMemo(()=>(Tf(n)?n:_6.Serialize(n))??"",[n]),u=Jr(),p=Rm(),m=h.useCallback(()=>{p.writeText(d)},[p,d]),f=h.useCallback(()=>{const v=new Blob([d]),b=document.createElement("a");b.href=URL.createObjectURL(v),b.download=`${s||t}.json`,document.body.appendChild(b),b.click(),b.remove()},[d,t,s]),{t:g}=T();return a.jsxs(A,{bg:"base.800",borderRadius:"base",flexGrow:1,w:"full",h:"full",position:"relative",...c,children:[a.jsx(ke,{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"auto",p:2,fontSize:"sm",children:a.jsx(ti,{defer:!0,style:w9e,options:b9e,children:a.jsx(x9e,{whiteSpace:l?"pre-wrap":void 0,children:d})})}),a.jsxs(A,{position:"absolute",top:0,insetInlineEnd:0,p:2,children:[i&&a.jsx(He,{label:`${g("gallery.download")} ${t} JSON`,children:a.jsx(oe,{"aria-label":`${g("gallery.download")} ${t} JSON`,icon:a.jsx(Wh,{size:16}),variant:"ghost",opacity:.7,onClick:f})}),o&&a.jsx(He,{label:`${g("gallery.copy")} ${t} JSON`,children:a.jsx(oe,{"aria-label":`${g("gallery.copy")} ${t} JSON`,icon:a.jsx(ws,{size:16}),variant:"ghost",opacity:.7,onClick:m})}),u&&r?.map(({label:v,getData:b})=>a.jsx(_9e,{label:v,getData:b,data:n},v))]})]})},Xl=h.memo(C9e),w9e={height:"100%",width:"100%"},_9e=({label:e,data:t,getData:n})=>{const{t:s}=T(),i=Rm(),o=h.useCallback(()=>{i.writeText(JSON.stringify(n(t),null,2))},[i,t,n]);return a.jsx(He,{label:`${s("gallery.copy")} ${e} JSON`,children:a.jsx(oe,{"aria-label":`${s("gallery.copy")} ${e} JSON`,icon:a.jsx(ws,{size:16}),variant:"ghost",opacity:.7,onClick:o})})},S9e="data:image/svg+xml,%3csvg%20width='231'%20height='100'%20viewBox='0%200%20231%20100'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_659_3578)'%3e%3crect%20width='100'%20height='100'%20fill='%23E6FD13'/%3e%3cpath%20d='M57.1951%2038.6667H70V30H30V38.6667H42.8049L57.1951%2061.3333H70V70H30V61.3333H42.8049'%20stroke='%23181818'%20stroke-width='2.8'/%3e%3crect%20width='131'%20height='100'%20transform='translate(100)'%20fill='%23E6FD13'/%3e%3cpath%20d='M111.37%2043.34H107.89V39.65H111.37V43.34ZM116.38%2060.5H102.76V58.16H108.22V47.84H103.36V45.5H111.07V58.16H116.38V60.5ZM120.538%2060.5V45.5H123.388V47.6C124.288%2046.25%20125.788%2045.2%20128.188%2045.2C131.638%2045.2%20133.588%2047.3%20133.588%2050.45V60.5H130.738V51.05C130.738%2048.95%20129.838%2047.6%20127.708%2047.6H127.468C125.338%2047.6%20123.388%2049.25%20123.388%2052.1V60.5H120.538ZM141.786%2060.5L136.236%2045.5H139.176L143.526%2057.71L147.876%2045.5H150.786L145.236%2060.5H141.786ZM159.723%2060.8C155.673%2060.8%20152.523%2057.65%20152.523%2053C152.523%2048.35%20155.673%2045.2%20159.723%2045.2C163.773%2045.2%20166.923%2048.35%20166.923%2053C166.923%2057.65%20163.773%2060.8%20159.723%2060.8ZM155.373%2053C155.373%2056.45%20157.173%2058.4%20159.603%2058.4H159.843C162.273%2058.4%20164.073%2056.45%20164.073%2053C164.073%2049.55%20162.273%2047.6%20159.843%2047.6H159.603C157.173%2047.6%20155.373%2049.55%20155.373%2053ZM170.804%2060.5V39.5H173.654V51.98L180.254%2045.5H184.004L177.764%2051.47L184.304%2060.5H180.794L175.724%2053.42L173.654%2055.43V60.5H170.804ZM192.459%2060.8C188.739%2060.8%20185.379%2058.22%20185.379%2052.97C185.379%2047.78%20188.829%2045.2%20192.369%2045.2C196.269%2045.2%20198.729%2047.9%20198.729%2051.8V53.45H188.229C188.409%2056.87%20190.599%2058.4%20192.429%2058.4H192.669C194.139%2058.4%20195.549%2057.65%20195.849%2056.06H198.699C198.159%2059.09%20195.549%2060.8%20192.459%2060.8ZM188.409%2051.2H195.879C195.759%2048.59%20194.199%2047.6%20192.489%2047.6H192.249C190.689%2047.6%20188.949%2048.53%20188.409%2051.2Z'%20fill='%23181818'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_659_3578'%3e%3crect%20width='231'%20height='100'%20rx='5'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",k9e=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=jo(),{t:i}=T(),{data:o}=nbe(),{data:r}=sbe(),{data:l}=a_(),c=h.useMemo(()=>{const d=It(o);return d&&d.config.remote_api_tokens&&d.config.remote_api_tokens.forEach(u=>{u.token="REDACTED"}),{version:l?.version,dependencies:r,config:d?.config,set_config_fields:d?.set_fields}},[l,r,o]);return a.jsxs(a.Fragment,{children:[h.cloneElement(e,{onClick:n}),a.jsxs(Zo,{isOpen:t,onClose:s,isCentered:!0,size:"5xl",useInert:!1,children:[a.jsx(ro,{}),a.jsxs(Xo,{maxH:"80vh",h:"34rem",children:[a.jsx(lo,{children:i("accessibility.about")}),a.jsx(Yr,{}),a.jsx(vi,{display:"flex",flexDir:"column",gap:4,children:a.jsxs(Ms,{templateColumns:"repeat(2, 1fr)",h:"full",children:[a.jsx(_t,{backgroundColor:"base.750",borderRadius:"base",p:"4",h:"full",children:a.jsx(Xl,{label:i("common.systemInformation"),data:c,wrapData:!1})}),a.jsx(_t,{children:a.jsxs(A,{flexDir:"column",gap:3,justifyContent:"center",alignItems:"center",h:"full",children:[a.jsx(Nn,{src:S9e,alt:"invoke-logo",w:"120px"}),l&&a.jsx(q,{children:`v${l?.version}`}),a.jsxs(Ms,{templateColumns:"repeat(2, 1fr)",gap:"3",children:[a.jsx(_t,{children:a.jsx(to,{href:RP,label:i("common.githubLabel")})}),a.jsx(_t,{children:a.jsx(to,{href:oS,label:i("common.discordLabel")})})]}),a.jsx(Pt,{fontSize:"large",children:i("common.aboutHeading")}),a.jsx(q,{fontSize:"sm",children:i("common.aboutDesc")})]})})]})}),a.jsx(Qr,{})]})]})]})},I9e=h.memo(k9e),j9e=e=>(C4?{Meta:"mod",Command:"mod",Control:"ctrl",Alt:"alt",Shift:"shift"," ":"space"}:{Control:"mod",Meta:"meta",Alt:"alt",Shift:"shift"," ":"space"})[e]||e.toLowerCase(),dx=["mod","ctrl","meta","shift","alt"],E9e=e=>["mod","ctrl","meta","shift","alt","control","command"].includes(e.toLowerCase()),A9e=e=>{const t=Array.from(e).map(j9e),n=t.filter(o=>dx.includes(o)),s=t.filter(o=>!dx.includes(o));return s.length===0?null:[...n.sort((o,r)=>dx.indexOf(o)-dx.indexOf(r)),s[0]].join("+")},n9=e=>C4?e.replaceAll("mod","cmd").replaceAll("alt","option"):e.replaceAll("mod","ctrl"),gee={px:2,py:1,bg:"base.700",borderRadius:"base",borderWidth:1,borderColor:"invokeBlue.400",minW:"100px",justifyContent:"center",alignItems:"center",cursor:"pointer"},P9e={...gee,borderColor:"error.400",bg:"error.900"},vT=h.memo(({hotkeyIndex:e,keyString:t,sx:n,isEditing:s,onEditCancel:i,onEditSave:o,onEditStart:r,onEditDelete:l,currentHotkeyId:c,isNewHotkey:d,conflictMap:u,t:p})=>{const[m,f]=h.useState(null),[g,v]=h.useState(!1),b=h.useMemo(()=>t.split("+"),[t]),C=h.useMemo(()=>b.map(n9),[b]),y=h.useMemo(()=>{if(!m)return null;const j=u.get(m);return!j||j.fullId===c?null:j},[m,u,c]);h.useEffect(()=>{s?(f(null),v(!0)):(v(!1),f(null))},[s]),h.useEffect(()=>{if(!g)return;const j=D=>{if(D.preventDefault(),D.stopPropagation(),D.key==="Escape"){i();return}if(E9e(D.key))return;const O=new Set;D.ctrlKey&&O.add("Control"),D.shiftKey&&O.add("Shift"),D.altKey&&O.add("Alt"),D.metaKey&&O.add("Meta"),O.add(D.key);const N=A9e(O);N&&(f(N),v(!1))},P=D=>{D.preventDefault(),D.stopPropagation()};return window.addEventListener("keydown",j,!0),window.addEventListener("keyup",P,!0),()=>{window.removeEventListener("keydown",j,!0),window.removeEventListener("keyup",P,!0)}},[g,i]);const x=h.useCallback(()=>{f(null),i()},[i]),w=h.useCallback(()=>{r?.(e)},[r,e]),_=h.useCallback(()=>{o(m??t,e)},[o,m,t,e]),S=h.useCallback(()=>{l?.(e)},[l,e]),I=h.useCallback(()=>{v(!0),f(null)},[]),k=h.useMemo(()=>!(!m||y),[m,y]),E=()=>{if(s){const j=m??t,P=j.split("+").map(n9),D=y!==null;return a.jsx(He,{isOpen:D,label:D?p("hotkeys.conflictWarning",{hotkeyTitle:y?.title}):void 0,bg:"error.900",color:"error.100",children:a.jsx(A,{sx:D?P9e:gee,onClick:I,children:g?a.jsx(q,{fontSize:"xs",color:"invokeBlue.300",fontStyle:"italic",children:p("hotkeys.pressKeys")}):j?P.map((O,N)=>a.jsxs(h.Fragment,{children:[a.jsx(Zu,{fontSize:"xs",textTransform:"lowercase",children:O}),N!==P.length-1&&a.jsx(q,{as:"span",fontSize:"xs",fontWeight:"semibold",mx:.5,children:"+"})]},N)):a.jsx(q,{fontSize:"xs",color:"invokeBlue.300",fontStyle:"italic",children:p("hotkeys.pressKeys")})})})}return a.jsx(He,{label:p("hotkeys.editHotkey"),children:a.jsx(he,{variant:"ghost",size:"sm",onClick:w,rightIcon:a.jsx(dMe,{}),gap:.5,alignItems:"center",px:2,children:C.map((j,P)=>a.jsxs(h.Fragment,{children:[a.jsx(Zu,{fontSize:"xs",textTransform:"lowercase",children:j}),P!==C.length-1&&a.jsx(q,{as:"span",fontSize:"xs",fontWeight:"semibold",mx:.5,mt:-.5,children:"+"})]},P))})})};return a.jsxs(A,{sx:n,children:[E(),a.jsx(A,{gap:1,children:s&&a.jsxs(a.Fragment,{children:[!d&&a.jsx(He,{label:p("common.delete"),children:a.jsx(oe,{"aria-label":p("common.delete"),icon:a.jsx(Qc,{}),size:"sm",variant:"ghost",colorScheme:"error",onClick:S})}),a.jsx(He,{label:p("hotkeys.cancel"),children:a.jsx(oe,{"aria-label":p("hotkeys.cancel"),icon:a.jsx(fn,{}),size:"sm",variant:"ghost",onClick:x})}),a.jsx(He,{label:p("hotkeys.save"),children:a.jsx(oe,{"aria-label":p("hotkeys.save"),icon:a.jsx(Yc,{}),size:"sm",variant:"ghost",onClick:_,disabled:!k})})]})})]})});vT.displayName="HotkeyItem";const T9e={display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},vee=h.memo(({hotkeys:e,sx:t,editingIndex:n,onEditStart:s,onEditCancel:i,onEditSave:o,onEditDelete:r,onAddHotkey:l,currentHotkeyId:c,conflictMap:d,isCustomized:u,onReset:p,t:m})=>{const f=n===e.length;return a.jsxs(A,{sx:{...T9e,...t},children:[e.length>0?e.map((g,v)=>a.jsx(vT,{hotkeyIndex:v,keyString:g,isEditing:n===v,onEditStart:s,onEditCancel:i,onEditSave:o,onEditDelete:r,currentHotkeyId:c,conflictMap:d,t:m},v)):!f&&a.jsx(q,{fontSize:"sm",color:"base.400",children:m("hotkeys.noHotkeysRecorded")}),f&&a.jsx(vT,{hotkeyIndex:e.length,keyString:"",isEditing:!0,onEditStart:s,onEditCancel:i,onEditSave:o,onEditDelete:r,currentHotkeyId:c,isNewHotkey:!0,conflictMap:d,t:m}),a.jsxs(A,{children:[u&&a.jsx(He,{label:m("hotkeys.resetToDefault"),children:a.jsx(oe,{"aria-label":m("hotkeys.resetToDefault"),icon:a.jsx(Gs,{}),size:"sm",variant:"ghost",colorScheme:"warning",onClick:p})}),!f&&a.jsx(He,{label:m("hotkeys.addHotkey"),children:a.jsx(oe,{"aria-label":m("hotkeys.addHotkey"),icon:a.jsx(Sn,{}),variant:"ghost",size:"sm",onClick:l})})]})]})});vee.displayName="HotkeyItemsDisplay";const D9e={alignItems:"start",justifyContent:"space-between",width:"100%",py:3,gap:2},yee=h.memo(({lastItem:e,hotkey:t,sx:n,conflictMap:s,t:i,dispatch:o})=>{const{title:r,desc:l,hotkeys:c,defaultHotkeys:d}=t,[u,p]=h.useState(null),m=h.useMemo(()=>c.length!==d.length?!0:c.some((w,_)=>w!==d[_]),[c,d]),f=`${t.category}.${t.id}`,g=h.useCallback(w=>{p(w)},[]),v=h.useCallback(()=>{p(null)},[]),b=h.useCallback((w,_)=>{if(!w){p(null);return}if(c.includes(w)){p(null);return}const S=[...c];_>=S.length?S.push(w):S[_]=w,o(zL({id:f,hotkeys:S})),p(null)},[o,f,c]),C=h.useCallback(()=>{p(c.length)},[c.length]),y=h.useCallback(w=>{const _=c.filter((S,I)=>I!==w);o(zL({id:f,hotkeys:_})),p(null)},[o,f,c]),x=h.useCallback(()=>{o(ibe(f))},[o,f]);return a.jsxs(A,{sx:{...D9e,borderBottomWidth:e?0:1,...n},children:[a.jsxs(A,{lineHeight:1,gap:2,w:"100%",flexDir:"column",children:[a.jsx(q,{fontWeight:"semibold",children:r}),a.jsx(q,{variant:"subtext",children:l})]}),a.jsx(A,{gap:2,w:"100%",justifyContent:"flex-end",children:a.jsx(vee,{hotkeys:c,editingIndex:u,onEditStart:g,onEditCancel:v,onEditSave:b,onEditDelete:y,onAddHotkey:C,currentHotkeyId:f,conflictMap:s,isCustomized:m,onReset:x,t:i})})]})});yee.displayName="HotkeyListItem";const M9e={gap:0,py:0},L9e={py:3},bee=h.memo(e=>{const{title:t,hotkeysList:n,conflictMap:s,t:i,dispatch:o}=e;return n.length===0?null:a.jsx(xl,{title:t,headingSx:L9e,contentSx:M9e,children:n.map((r,l)=>a.jsx(yee,{lastItem:l===n.length-1,hotkey:r,conflictMap:s,t:i,dispatch:o},r.id))})});bee.displayName="HotkeysListWrapper";const R9e=(e,t)=>[e.title,e.desc,e.category,...e.platformKeys.flat()].some(n=>n.toLowerCase().includes(t)),xee=h.memo(()=>{const{t:e}=T(),t=Q(),{isOpen:n,onOpen:s,onClose:i}=jo(),[o,r]=h.useState(""),l=h.useCallback(()=>r(""),[]),c=h.useCallback(g=>r(g.target.value),[]),d=h.useCallback(()=>{t(obe()),i()},[t,i]),u=w4(),p=nPe(),m=h.useMemo(()=>{const g=o.trim().toLowerCase(),v=[];for(const b of Object.values(u)){const C={title:b.title,hotkeys:[]};for(const y of Object.values(b.hotkeys))y.isEnabled&&(!g.length||R9e(y,g))&&C.hotkeys.push(y);C.hotkeys.length&&v.push(C)}return v},[u,o]),f=h.useMemo(()=>sPe(u),[u]);return a.jsxs(a.Fragment,{children:[a.jsxs(vi,{display:"flex",flexDir:"column",gap:4,children:[a.jsxs(tc,{children:[a.jsx(Nt,{autoFocus:!0,placeholder:e("hotkeys.searchHotkeys"),value:o,onChange:c,tabIndex:1}),o.length>0?a.jsx(Hr,{h:"full",pe:2,children:a.jsx(oe,{onClick:l,size:"sm",variant:"ghost","aria-label":e("hotkeys.clearSearch"),boxSize:4,icon:a.jsx(fn,{})})}):null]}),a.jsx(Hs,{children:a.jsxs(A,{flexDir:"column",children:[m.map(g=>a.jsx(bee,{title:g.title,hotkeysList:g.hotkeys,conflictMap:p,t:e,dispatch:t},g.title)),!m.length&&a.jsx(On,{label:e("hotkeys.noHotkeysFound"),icon:null})]})})]}),a.jsx(Qr,{children:a.jsx(A,{gap:2,w:"full",justifyContent:"space-between",children:a.jsx(he,{onClick:s,size:"sm",colorScheme:"error",disabled:!f,children:e("hotkeys.resetAll")})})}),a.jsx(Ko,{isOpen:n,onClose:i,title:e("hotkeys.resetAll"),acceptCallback:d,acceptButtonText:e("common.reset"),useInert:!1,children:a.jsx(A,{flexDirection:"column",gap:2,children:a.jsx(q,{children:e("hotkeys.resetAllConfirmation")})})})]})});xee.displayName="HotkeysModalInner";const Cee=h.memo(()=>{const{t:e}=T(),[t,n]=h.useState(!1);return h.useEffect(()=>{const s=setTimeout(()=>n(!0),0);return()=>clearTimeout(s)},[]),a.jsxs(a.Fragment,{children:[a.jsx(lo,{children:e("hotkeys.hotkeys")}),a.jsx(Yr,{}),t?a.jsx(xee,{}):a.jsx(vi,{display:"flex",flexDir:"column",gap:4,children:a.jsx(A,{flex:"1",alignItems:"center",justifyContent:"center",children:a.jsx(ao,{})})})]})});Cee.displayName="HotkeysModalContent";const O9e=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=jo();return a.jsxs(a.Fragment,{children:[h.cloneElement(e,{onClick:n}),a.jsxs(Zo,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,children:[a.jsx(ro,{}),a.jsx(Xo,{h:"80vh",children:t&&a.jsx(Cee,{})})]})]})},N9e=h.memo(O9e);function F9e(e){return fe({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M19.3034 5.33716C17.9344 4.71103 16.4805 4.2547 14.9629 4C14.7719 4.32899 14.5596 4.77471 14.411 5.12492C12.7969 4.89144 11.1944 4.89144 9.60255 5.12492C9.45397 4.77471 9.2311 4.32899 9.05068 4C7.52251 4.2547 6.06861 4.71103 4.70915 5.33716C1.96053 9.39111 1.21766 13.3495 1.5891 17.2549C3.41443 18.5815 5.17612 19.388 6.90701 19.9187C7.33151 19.3456 7.71356 18.73 8.04255 18.0827C7.41641 17.8492 6.82211 17.5627 6.24904 17.2231C6.39762 17.117 6.5462 17.0003 6.68416 16.8835C10.1438 18.4648 13.8911 18.4648 17.3082 16.8835C17.4568 17.0003 17.5948 17.117 17.7434 17.2231C17.1703 17.5627 16.576 17.8492 15.9499 18.0827C16.2789 18.73 16.6609 19.3456 17.0854 19.9187C18.8152 19.388 20.5875 18.5815 22.4033 17.2549C22.8596 12.7341 21.6806 8.80747 19.3034 5.33716ZM8.5201 14.8459C7.48007 14.8459 6.63107 13.9014 6.63107 12.7447C6.63107 11.5879 7.45884 10.6434 8.5201 10.6434C9.57071 10.6434 10.4303 11.5879 10.4091 12.7447C10.4091 13.9014 9.57071 14.8459 8.5201 14.8459ZM15.4936 14.8459C14.4535 14.8459 13.6034 13.9014 13.6034 12.7447C13.6034 11.5879 14.4323 10.6434 15.4936 10.6434C16.5442 10.6434 17.4038 11.5879 17.3825 12.7447C17.3825 13.9014 16.5548 14.8459 15.4936 14.8459Z"},child:[]}]})(e)}function B9e(e){return fe({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12.001 2C6.47598 2 2.00098 6.475 2.00098 12C2.00098 16.425 4.86348 20.1625 8.83848 21.4875C9.33848 21.575 9.52598 21.275 9.52598 21.0125C9.52598 20.775 9.51348 19.9875 9.51348 19.15C7.00098 19.6125 6.35098 18.5375 6.15098 17.975C6.03848 17.6875 5.55098 16.8 5.12598 16.5625C4.77598 16.375 4.27598 15.9125 5.11348 15.9C5.90098 15.8875 6.46348 16.625 6.65098 16.925C7.55098 18.4375 8.98848 18.0125 9.56348 17.75C9.65098 17.1 9.91348 16.6625 10.201 16.4125C7.97598 16.1625 5.65098 15.3 5.65098 11.475C5.65098 10.3875 6.03848 9.4875 6.67598 8.7875C6.57598 8.5375 6.22598 7.5125 6.77598 6.1375C6.77598 6.1375 7.61348 5.875 9.52598 7.1625C10.326 6.9375 11.176 6.825 12.026 6.825C12.876 6.825 13.726 6.9375 14.526 7.1625C16.4385 5.8625 17.276 6.1375 17.276 6.1375C17.826 7.5125 17.476 8.5375 17.376 8.7875C18.0135 9.4875 18.401 10.375 18.401 11.475C18.401 15.3125 16.0635 16.1625 13.8385 16.4125C14.201 16.725 14.5135 17.325 14.5135 18.2625C14.5135 19.6 14.501 20.675 14.501 21.0125C14.501 21.275 14.6885 21.5875 15.1885 21.4875C19.259 20.1133 21.9999 16.2963 22.001 12C22.001 6.475 17.526 2 12.001 2Z"},child:[]}]})(e)}const wee=h.memo(()=>{const{t:e}=T(),t=o_(),n=M(VG),s=h.useCallback(i=>{t(abe(i.target.checked))},[t]);return a.jsxs(te,{children:[a.jsx(ne,{children:e("system.enableLogging")}),a.jsx(mt,{isChecked:n,onChange:s})]})});wee.displayName="SettingsDeveloperLogIsEnabled";const _ee=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(BG),s=h.useMemo(()=>rbe.options.map(r=>({label:e(`system.logLevel.${r}`),value:r})),[e]),i=h.useMemo(()=>s.find(r=>r.value===n),[n,s]),o=h.useCallback(r=>{lbe(r?.value)&&t(cbe(r.value))},[t]);return a.jsxs(te,{children:[a.jsx(ne,{children:e("system.logLevel.logLevel")}),a.jsx(pt,{value:i,options:s,onChange:o,isSearchable:!1})]})});_ee.displayName="SettingsDeveloperLogLevel";const See=h.memo(()=>{const{t:e}=T(),t=M(zG),n=h.useMemo(()=>dIe(dbe.options,t),[t]);return a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:e("system.logNamespaces.logNamespaces")}),a.jsx(A,{w:"full",gap:2,flexWrap:"wrap",minH:"32px",borderRadius:"base",borderWidth:1,p:2,alignItems:"center",children:t.map(s=>a.jsx(s9,{namespace:s,isEnabled:!0},`enabled-${s}`))}),a.jsx(A,{gap:2,flexWrap:"wrap",children:n.map(s=>a.jsx(s9,{namespace:s,isEnabled:!1},`disabled-${s}`))})]})});See.displayName="SettingsDeveloperLogNamespaces";const s9=({namespace:e,isEnabled:t})=>{const{t:n}=T(),s=o_(),i=h.useCallback(()=>{s(ube(e))},[s,e]);return a.jsxs(r_,{h:"min-content",borderRadius:"base",onClick:i,colorScheme:t?"invokeBlue":"base",userSelect:"none",role:"button",size:"md",color:"base.900",bg:t?"invokeBlue.300":"base.300",children:[a.jsx(q,{fontSize:"sm",fontWeight:"semibold",children:n(`system.logNamespaces.${e}`)}),t&&a.jsx(l_,{})]})},z9e=()=>{const{t:e}=T(),{data:t,refetch:n}=hbe(void 0,{refetchOnMountOrArgChange:!0}),[s,{isLoading:i}]=pbe(),{data:o}=ur(),r=h.useMemo(()=>!!(o&&(o.queue.in_progress>0||o.queue.pending>0)),[o]),l=h.useCallback(()=>{r||s().unwrap().then(c=>{pe({id:"INTERMEDIATES_CLEARED",title:e("settings.intermediatesCleared",{count:c}),status:"info"})}).catch(()=>{pe({id:"INTERMEDIATES_CLEAR_FAILED",title:e("settings.intermediatesClearedFailed"),status:"error"})})},[e,s,r]);return{intermediatesCount:t,clearIntermediates:l,isLoading:i,hasPendingItems:r,refetchIntermediatesCount:n}},V9e={ar:"",az:"Azrbaycan dili",de:"Deutsch",en:"English",es:"Espaol",fi:"Suomi",fr:"Franais",he:"",hu:"Magyar Nyelv",it:"Italiano",ja:"",ko:"",nl:"Nederlands",pl:"Polski",pt:"Portugus","pt-BR":"Portugus do Brasil",ru:"",sv:"Svenska",tr:"Trke",ua:"",vi:"Ting Vit","zh-CN":"","zh-Hant":""},i9=Wr(V9e,(e,t)=>({label:e,value:t})),kee=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(KZ),s=h.useMemo(()=>i9.find(o=>o.value===n),[n]),i=h.useCallback(o=>{fbe(o?.value)&&t(mbe(o.value))},[t]);return a.jsxs(te,{children:[a.jsx(ne,{children:e("common.languagePickerLabel")}),a.jsx(pt,{value:s,options:i9,onChange:i})]})});kee.displayName="SettingsLanguageSelect";const[$9e]=qh(!1),G9e=e=>{const t=Q(),{t:n}=T(),{clearIntermediates:s,hasPendingItems:i,intermediatesCount:o,isLoading:r,refetchIntermediatesCount:l}=z9e(),c=$9e(),d=QJ(),u=M(gbe),p=M(nW),m=M(c_),f=M(vbe),g=M(ybe),v=M(bbe),b=M(xbe),C=M(d_),y=M(xW),x=M(Cbe),w=M(CW),_=h.useCallback(()=>{t(wbe())},[t]);h.useEffect(()=>{c.isTrue&&l()},[l,c.isTrue]);const S=h.useCallback(()=>{wW(),c.setFalse(),d.setTrue()},[c,d]),I=h.useCallback(L=>{t(sW(L.target.checked))},[t]),k=h.useCallback(L=>{t(_be(L.target.checked))},[t]),E=h.useCallback(L=>{t(Sbe(L.target.checked))},[t]),j=h.useCallback(L=>{t(_W(L.target.checked))},[t]),P=h.useCallback(L=>{t(kbe(L.target.checked))},[t]),D=h.useCallback(L=>{t(aW(L.target.checked))},[t]),O=h.useCallback(L=>{t(Ibe(L.target.checked))},[t]),N=h.useCallback(L=>{t(jbe(L.target.checked))},[t]),F=h.useCallback(L=>{t(Ebe(L.target.checked))},[t]),X=h.useCallback(L=>{t(Abe(L.target.checked))},[t]);return a.jsxs(a.Fragment,{children:[h.cloneElement(e.children,{onClick:c.setTrue}),a.jsxs(Zo,{isOpen:c.isTrue,onClose:c.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[a.jsx(ro,{}),a.jsxs(Xo,{maxH:"80vh",h:"68rem",children:[a.jsx(lo,{bg:"none",children:n("common.settingsLabel")}),a.jsx(Yr,{tabIndex:1}),a.jsx(vi,{display:"flex",flexDir:"column",gap:4,children:a.jsx(Hs,{children:a.jsx(A,{flexDir:"column",gap:4,children:a.jsxs(Ys,{formLabelProps:{flexGrow:1},children:[a.jsxs(xl,{title:n("settings.general"),children:[a.jsxs(te,{children:[a.jsx(ne,{children:n("settings.confirmOnDelete")}),a.jsx(mt,{isChecked:p,onChange:I})]}),a.jsxs(te,{children:[a.jsx(ne,{children:n("settings.confirmOnNewSession")}),a.jsx(mt,{isChecked:x,onChange:_})]})]}),a.jsxs(xl,{title:n("settings.generation"),children:[a.jsxs(te,{children:[a.jsx(ne,{children:n("settings.enableNSFWChecker")}),a.jsx(mt,{isChecked:g,onChange:k})]}),a.jsxs(te,{children:[a.jsx(ne,{children:n("settings.enableInvisibleWatermark")}),a.jsx(mt,{isChecked:v,onChange:E})]})]}),a.jsxs(xl,{title:n("settings.ui"),children:[a.jsxs(te,{children:[a.jsx(ne,{children:n("settings.showProgressInViewer")}),a.jsx(mt,{isChecked:m,onChange:j})]}),a.jsxs(te,{children:[a.jsx(ne,{children:n("settings.antialiasProgressImages")}),a.jsx(mt,{isChecked:f,onChange:P})]}),a.jsxs(te,{children:[a.jsx(ne,{children:n("settings.showDetailedInvocationProgress")}),a.jsx(mt,{isChecked:w,onChange:F})]}),a.jsxs(te,{children:[a.jsx(Ue,{feature:"noiseUseCPU",inPortal:!1,children:a.jsx(ne,{children:n("parameters.useCpuNoise")})}),a.jsx(mt,{isChecked:u,onChange:N})]}),a.jsx(kee,{}),a.jsxs(te,{children:[a.jsx(ne,{children:n("settings.enableInformationalPopovers")}),a.jsx(mt,{isChecked:b,onChange:D})]}),a.jsxs(te,{children:[a.jsx(ne,{children:n("settings.enableModelDescriptions")}),a.jsx(mt,{isChecked:C,onChange:O})]}),a.jsxs(te,{children:[a.jsx(ne,{children:n("settings.enableHighlightFocusedRegions")}),a.jsx(mt,{isChecked:y,onChange:X})]})]}),a.jsxs(xl,{title:n("settings.developer"),children:[a.jsx(wee,{}),a.jsx(_ee,{}),a.jsx(See,{})]}),a.jsxs(xl,{title:n("settings.clearIntermediates"),children:[a.jsx(he,{tooltip:i?n("settings.clearIntermediatesDisabled"):void 0,colorScheme:"warning",onClick:s,isLoading:r,isDisabled:!o||i,children:n("settings.clearIntermediatesWithCount",{count:o??0})}),a.jsx(q,{fontWeight:"bold",children:n("settings.clearIntermediatesDesc1")}),a.jsx(q,{variant:"subtext",children:n("settings.clearIntermediatesDesc2")}),a.jsx(q,{variant:"subtext",children:n("settings.clearIntermediatesDesc3")})]}),a.jsxs(xl,{title:n("settings.resetWebUI"),children:[a.jsx(he,{colorScheme:"error",onClick:S,children:n("settings.resetWebUI")}),a.jsx(q,{variant:"subtext",children:n("settings.resetWebUIDesc1")}),a.jsx(q,{variant:"subtext",children:n("settings.resetWebUIDesc2")})]})]})})})}),a.jsx(Qr,{})]})]})]})},H9e=h.memo(G9e),W9e=()=>{const{t:e}=T(),{isOpen:t,onOpen:n,onClose:s}=jo();return im(s),a.jsxs(An,{isOpen:t,onOpen:n,onClose:s,autoSelect:!1,children:[a.jsx(Pn,{as:oe,variant:"link","aria-label":e("accessibility.menu"),icon:a.jsx(f1,{fontSize:20}),boxSize:8}),a.jsx(Ls,{children:a.jsxs(Zt,{children:[a.jsxs(Ya,{title:e("common.communityLabel"),children:[a.jsx(be,{as:"a",href:RP,target:"_blank",icon:a.jsx(B9e,{}),children:e("common.githubLabel")}),a.jsx(be,{as:"a",href:`${RP}/issues`,target:"_blank",icon:a.jsx(ODe,{}),children:e("common.reportBugLabel")}),a.jsx(be,{as:"a",href:oS,target:"_blank",icon:a.jsx(F9e,{}),children:e("common.discordLabel")})]}),a.jsxs(Ya,{title:e("common.settingsLabel"),children:[a.jsx(N9e,{children:a.jsx(be,{as:"button",icon:a.jsx(eMe,{}),children:e("common.hotkeysLabel")})}),a.jsx(H9e,{children:a.jsx(be,{as:"button",icon:a.jsx(BMe,{}),children:e("common.settingsLabel")})})]}),a.jsx(Ya,{title:e("accessibility.about"),children:a.jsx(I9e,{children:a.jsx(be,{as:"button",icon:a.jsx(km,{}),children:e("accessibility.about")})})})]})})]})},U9e=h.memo(W9e),q9e=()=>{const e=le(ks),{t}=T();return e?null:a.jsx(He,{label:t("common.statusDisconnected"),placement:"end",shouldWrapChildren:!0,gutter:10,children:a.jsx(Je,{as:jm,color:"error.300"})})},K9e=h.memo(q9e),Iee=h.memo(()=>{const{t:e}=T(),t=see(),n=h.useCallback(()=>{t.open()},[t]);return a.jsx(oe,{"aria-label":e("supportVideos.supportVideos"),variant:"link",icon:a.jsx(VMe,{fontSize:20}),boxSize:8,onClick:n})});Iee.displayName="VideosModalButton";const Z9e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANISURBVHgB7ZvBSxRRHMe/763rmolu1CEjcaWjB4WgyEuuEHRTQroGgtcyvLdud1O7Ch46RoHegqDyIhQE+w+EE0J2KBhNMl13Xu83pc6sovMcZ97gmw8s7Lx97PL77e/7e7/3ezMMdayKS/3CwSAghuRlAWcAwVgFQlQ4z5bb2XfL+xnbfbMsCvkc1ktw2BjOMpxNb6Gl3MUsmy5dB5DxjWLjPROiFwZAEbHNWorkBE4D9M+bYjxBtuawUXLfr4rLBeFUl2EgzGFFDqdagqHUuBjiAsyY0K9H6n+QfatdFDAYDsNJHQDDMd4BDVDkSuYnkoxM6krzUwnAcNIcgJCoau60CZuTUgnAcEJLYGlxJ9C8tjaG7t4MgrJiOVj56iBqQjtgeGAt0LzWPMPbz3l0FIIF3csXW5gs/0bUxCaBdVvg8cgGkkasOWBpsYo3C9tIEsoS6OvPKs13tWzV9q7HZBR8+nLBlcRRXO3kyr91EiJviJAD7lxfkxLYT2ijD5tQnjqPJBC5BCjpjT7K+cZmn/8JvHpETWwtsZvXbJ8UyDG0KhwnhaiJLQlOzflDnqRBkaCb2BzQdzsrpdDkG6N1nhyhk1iXwfEnzTL0/dWg7togVgeQ3svPmn1jVBvMzuiTgpZzgeGBddfwXVTL5NNEy25waq5FGr3/0zrLZC0OoH96vHTON6arTNZ6NFYvBR21gdaGCEnBCy2JcWyBvWh1wGFSiLtM1n46TAmQNkv1ZfJHuWOMA+09QdL7YWXy5NNNxEEimqKHlcmzM5uxlMnKEqDMrcr9Bzn3dRQkhRtyx+jtG5AUOjqDN1KJV+9aleYrd4S8y1ZQbgXo7JAUpqUURu792hv7102KNgoSdS5wd7DRlUOcJO5gpL5MjprQ5wJBNKeiY9L9a/mda3aw0D9JTvIS2gFRhGx3DzlMLfmdlPRwFIYTWgJJv2foOFIJwHDSHABFdN8TdNqkEoDhpA6A4ZADLJgKYxUu91wLMBRBT5NmHDYPQ+G8Vubt2R8fHAczMAyyuZ3ZlpsEqw21CTBRgSHQo7Ouzfi/CnQx295iTtGESCAbt9lOkWym6wOnkKsiXxC1zAQ468HZeZ7YkoYvZMDmSfLeD/4CAK41g1vx5woAAAAASUVORK5CYII=",X9e={StrongComponent:a.jsx(q,{as:"span",color:"white",fontSize:"sm",fontWeight:"semibold"})},Y9e=()=>{const{t:e}=T(),{data:t}=a_(),n=h.useMemo(()=>e("whatsNew.items",{returnObjects:!0}).map((i,o)=>a.jsx(rn,{children:a.jsx(Bn,{i18nKey:i,components:X9e})},`${i}-${o}`)),[e]);return a.jsxs(A,{gap:4,flexDir:"column",children:[a.jsx(Li,{fontSize:"sm",children:n}),a.jsxs(A,{flexDir:"column",gap:1,children:[a.jsx(to,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.readReleaseNotes"),href:`https://github.com/invoke-ai/InvokeAI/releases/tag/v${t?.version}`}),a.jsx(to,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.watchRecentReleaseVideos"),href:"https://www.youtube.com/@invokeai/videos"})]})]})},Q9e=()=>{const{t:e}=T(),t=Q(),n=M(o=>o.ui.shouldShowNotificationV2),s=h.useCallback(()=>{t(Pbe(!1))},[t]),{data:i}=a_();return i?a.jsxs(yi,{onClose:s,placement:"top-start",autoFocus:!1,defaultIsOpen:n,children:[a.jsx(Ni,{children:a.jsx(A,{pos:"relative",children:a.jsx(oe,{"aria-label":"Notifications",variant:"link",icon:a.jsx(tMe,{fontSize:20}),boxSize:8})})}),a.jsx(Ls,{children:a.jsxs(bi,{p:2,children:[a.jsx(hr,{}),a.jsx(rW,{}),a.jsx(Tbe,{fontSize:"md",fontWeight:"semibold",pt:5,children:a.jsxs(A,{alignItems:"center",gap:3,children:[a.jsx(Nn,{src:Z9e,boxSize:6}),e("whatsNew.whatsNewInInvoke"),a.jsx(q,{variant:"subtext",children:`v${i.version}`})]})}),a.jsx(Fi,{p:2,maxW:300,children:a.jsx(Y9e,{})})]})})]}):null},J9e=(e,t,n)=>{const s=h.useRef(null),i=h.useCallback(()=>{s.current!==null&&(window.clearTimeout(s.current),s.current=null)},[n]),o=h.useCallback(()=>{i(),s.current=window.setTimeout(()=>{e(),s.current=null},t)},[e,i,t]);return h.useMemo(()=>[o,i],[o,i])},Bm=(e,t,n=300)=>{const[s,i]=J9e(e,n);h.useEffect(()=>{const o=t.current;if(o)return zi(o1({element:o,onDragEnter:s,onDragLeave:i}),PY({element:o,onDragEnter:s,onDragLeave:i}))},[i,t,s])},eBe={"&[data-selected=true]":{svg:{fill:"invokeYellow.300"}}},Bu=h.memo(({tab:e,icon:t,label:n})=>{const s=h.useRef(null),i=M(un),o=h.useCallback(()=>{Ne.switchToTab(e)},[e]);return Bm(o,s,300),a.jsx(He,{label:n,placement:"end",children:a.jsx(oe,{p:0,ref:s,onClick:o,icon:t,size:"md",fontSize:"24px",variant:"link","data-selected":i===e,"aria-label":n,"data-testid":n,sx:eBe})})});Bu.displayName="TabButton";const jee=h.memo(()=>{const{t:e}=T();return a.jsxs(A,{flexDir:"column",alignItems:"center",py:6,ps:4,pe:2,gap:4,minW:0,flexShrink:0,children:[a.jsx(l9e,{}),a.jsxs(A,{gap:6,pt:6,h:"full",flexDir:"column",children:[a.jsx(Bu,{tab:"generate",icon:a.jsx(K4,{}),label:e("ui.tabs.generate")}),a.jsx(Bu,{tab:"canvas",icon:a.jsx(nc,{}),label:e("ui.tabs.canvas")}),a.jsx(Bu,{tab:"upscaling",icon:a.jsx(Sm,{}),label:e("ui.tabs.upscaling")}),a.jsx(Bu,{tab:"workflows",icon:a.jsx(h1,{}),label:e("ui.tabs.workflows")})]}),a.jsx(At,{}),a.jsx(K9e,{}),a.jsx(Bu,{tab:"models",icon:a.jsx(u1,{}),label:e("ui.tabs.models")}),a.jsx(Bu,{tab:"queue",icon:a.jsx(U4,{}),label:e("ui.tabs.queue")}),a.jsx(vt,{}),a.jsx(Q9e,{}),a.jsx(Iee,{}),a.jsx(U9e,{})]})});jee.displayName="VerticalNavBar";const xf=e=>{const t=M(u_),n=M(h_),s=M(Dbe);return h.useMemo(()=>{switch(e){case"regional_guidance":return!t&&!n&&!s;case"control_layer":return!t&&!n&&!s;case"inpaint_mask":return!s;case"raster_layer":return!s;default:ae(!1)}},[e,t,n,s])},Eee=h.memo(()=>{const{t:e}=T(),t=A4(),n=P4(),s=E4(),i=j4(),o=AZ(),r=xf("regional_guidance"),l=xf("control_layer"),c=xf("inpaint_mask");return a.jsx(A,{w:"full",h:"full",justifyContent:"center",gap:4,children:a.jsxs(A,{position:"relative",flexDir:"column",gap:4,top:"20%",children:[a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsx(Pt,{size:"xs",children:e("controlLayers.regional")}),a.jsx(Ue,{feature:"inpainting",children:a.jsx(he,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:a.jsx(Sn,{}),onClick:t,isDisabled:!c,children:e("controlLayers.inpaintMask")})}),a.jsx(Ue,{feature:"regionalGuidance",children:a.jsx(he,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:a.jsx(Sn,{}),onClick:n,isDisabled:!r,children:e("controlLayers.regionalGuidance")})}),a.jsx(Ue,{feature:"regionalReferenceImage",children:a.jsx(he,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:a.jsx(Sn,{}),onClick:o,isDisabled:!r,children:e("controlLayers.regionalReferenceImage")})})]}),a.jsxs(A,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[a.jsx(Pt,{size:"xs",children:e("controlLayers.layer_other")}),a.jsx(Ue,{feature:"controlNet",children:a.jsx(he,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:a.jsx(Sn,{}),onClick:i,isDisabled:!l,children:e("controlLayers.controlLayer")})}),a.jsx(Ue,{feature:"rasterLayer",children:a.jsx(he,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:a.jsx(Sn,{}),onClick:s,children:e("controlLayers.rasterLayer")})})]})]})})});Eee.displayName="CanvasAddEntityButtons";function o9(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function a9(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?o9(Object(n),!0).forEach(function(s){Lr(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o9(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var tBe={top:function(t,n){return Math.abs(n.y-t.top)},right:function(t,n){return Math.abs(t.right-n.x)},bottom:function(t,n){return Math.abs(t.bottom-n.y)},left:function(t,n){return Math.abs(n.x-t.left)}},Aee=Symbol("closestEdge");function nBe(e,t){var n,s,i=t.element,o=t.input,r=t.allowedEdges,l={x:o.clientX,y:o.clientY},c=i.getBoundingClientRect(),d=r.map(function(p){return{edge:p,value:tBe[p](c,l)}}),u=(n=(s=d.sort(function(p,m){return p.value-m.value})[0])===null||s===void 0?void 0:s.edge)!==null&&n!==void 0?n:null;return a9(a9({},e),{},Lr({},Aee,u))}function yT(e){var t;return(t=e[Aee])!==null&&t!==void 0?t:null}function sBe(e){var t=e.list,n=e.startIndex,s=e.finishIndex;if(n===-1||s===-1)return Array.from(t);var i=Array.from(t),o=i.splice(n,1),r=_4(o,1),l=r[0];return i.splice(s,0,l),i}function bT(e){var t=e.startIndex,n=e.closestEdgeOfTarget,s=e.indexOfTarget,i=e.axis;if(t===-1||s===-1||t===s)return t;if(n==null)return s;var o=i==="vertical"&&n==="bottom"||i==="horizontal"&&n==="right",r=t<s;return r?o?s:s-1:o?s+1:s}function Pee(e){var t=e.list,n=e.startIndex,s=e.closestEdgeOfTarget,i=e.indexOfTarget,o=e.axis;return sBe({list:t,startIndex:n,finishIndex:bT({closestEdgeOfTarget:s,startIndex:n,indexOfTarget:i,axis:o})})}const Nr=e=>`var(--invoke-colors-${e.split(".").join("-")})`,S6={overflow:"visible"},Tee=h.memo(({type:e})=>{const{t}=T(),n=xt(),s=A4(),i=P4(),o=E4(),r=j4(),l=h.useCallback(()=>{switch(e){case"inpaint_mask":s();break;case"regional_guidance":i();break;case"raster_layer":o();break;case"control_layer":r();break}},[r,s,o,i,e]),c=h.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.addInpaintMask");case"regional_guidance":return t("controlLayers.addRegionalGuidance");case"raster_layer":return t("controlLayers.addRasterLayer");case"control_layer":return t("controlLayers.addControlLayer")}},[e,t]);return a.jsx(oe,{size:"sm","aria-label":c,tooltip:c,variant:"link",icon:a.jsx(vo,{}),onClick:l,alignSelf:"stretch",isDisabled:n})});Tee.displayName="CanvasEntityAddOfTypeButton";const Dee=e=>{const t=h.useMemo(()=>{switch(e){case"control_layer":return ve(IW,s=>s.length);case"raster_layer":return ve(yM,s=>s.length);case"inpaint_mask":return ve(kW,s=>s.length);case"regional_guidance":return ve(SW,s=>s.length);default:ae(!1,"Invalid entity type")}},[e]);return M(t)},Mee=h.memo(({type:e})=>{const{t}=T(),n=Tt(),s=xt(),i=Dee(e),o=h.useCallback(()=>{n.compositor.mergeVisibleOfType(e)},[n.compositor,e]);return a.jsx(oe,{size:"sm","aria-label":t("controlLayers.mergeVisible"),tooltip:t("controlLayers.mergeVisible"),variant:"link",icon:a.jsx(kMe,{}),onClick:o,alignSelf:"stretch",isDisabled:i<=1||s})});Mee.displayName="CanvasEntityMergeVisibleButton";const k6=e=>{const t=h.useMemo(()=>ve(rt,s=>{switch(e){case"control_layer":return s.controlLayers.isHidden;case"raster_layer":return s.rasterLayers.isHidden;case"inpaint_mask":return s.inpaintMasks.isHidden;case"regional_guidance":return s.regionalGuidance.isHidden;default:return!1}}),[e]);return M(t)},Lee=(e,t=!1)=>{const{t:n}=T();return h.useMemo(()=>{switch(e){case"control_layer":return n(t?"controlLayers.controlLayer_withCount_other":"controlLayers.controlLayer");case"raster_layer":return n(t?"controlLayers.rasterLayer_withCount_other":"controlLayers.rasterLayer");case"inpaint_mask":return n(t?"controlLayers.inpaintMask_withCount_other":"controlLayers.inpaintMask");case"regional_guidance":return n(t?"controlLayers.regionalGuidance_withCount_other":"controlLayers.regionalGuidance");default:return""}},[e,t,n])},Ree=h.memo(({type:e})=>{const{t}=T(),n=Q(),s=k6(e),i=Lee(e,!0),o=h.useCallback(r=>{r.stopPropagation(),n(Mbe({type:e}))},[n,e]);return a.jsx(oe,{size:"sm","aria-label":t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:i}),tooltip:t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:i}),variant:"link",icon:s?a.jsx(aX,{}):a.jsx(bu,{}),onClick:o,alignSelf:"stretch"})});Ree.displayName="CanvasEntityTypeIsHiddenToggle";var g0={},r9;function iBe(){if(r9)return g0;r9=1,g0.byteLength=l,g0.toByteArray=d,g0.fromByteArray=m;for(var e=[],t=[],n=typeof Uint8Array<"u"?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=s.length;i<o;++i)e[i]=s[i],t[s.charCodeAt(i)]=i;t[45]=62,t[95]=63;function r(f){var g=f.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var v=f.indexOf("=");v===-1&&(v=g);var b=v===g?0:4-v%4;return[v,b]}function l(f){var g=r(f),v=g[0],b=g[1];return(v+b)*3/4-b}function c(f,g,v){return(g+v)*3/4-v}function d(f){var g,v=r(f),b=v[0],C=v[1],y=new n(c(f,b,C)),x=0,w=C>0?b-4:b,_;for(_=0;_<w;_+=4)g=t[f.charCodeAt(_)]<<18|t[f.charCodeAt(_+1)]<<12|t[f.charCodeAt(_+2)]<<6|t[f.charCodeAt(_+3)],y[x++]=g>>16&255,y[x++]=g>>8&255,y[x++]=g&255;return C===2&&(g=t[f.charCodeAt(_)]<<2|t[f.charCodeAt(_+1)]>>4,y[x++]=g&255),C===1&&(g=t[f.charCodeAt(_)]<<10|t[f.charCodeAt(_+1)]<<4|t[f.charCodeAt(_+2)]>>2,y[x++]=g>>8&255,y[x++]=g&255),y}function u(f){return e[f>>18&63]+e[f>>12&63]+e[f>>6&63]+e[f&63]}function p(f,g,v){for(var b,C=[],y=g;y<v;y+=3)b=(f[y]<<16&16711680)+(f[y+1]<<8&65280)+(f[y+2]&255),C.push(u(b));return C.join("")}function m(f){for(var g,v=f.length,b=v%3,C=[],y=16383,x=0,w=v-b;x<w;x+=y)C.push(p(f,x,x+y>w?w:x+y));return b===1?(g=f[v-1],C.push(e[g>>2]+e[g<<4&63]+"==")):b===2&&(g=(f[v-2]<<8)+f[v-1],C.push(e[g>>10]+e[g>>4&63]+e[g<<2&63]+"=")),C.join("")}return g0}var BC=iBe();/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const oBe=4,l9=0,c9=1,aBe=2;function zm(e){let t=e.length;for(;--t>=0;)e[t]=0}const rBe=0,Oee=1,lBe=2,cBe=3,dBe=258,I6=29,w1=256,ny=w1+1+I6,Cf=30,j6=19,Nee=2*ny+1,Ju=15,Jj=16,uBe=7,E6=256,Fee=16,Bee=17,zee=18,xT=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),w2=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),hBe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Vee=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pBe=512,_c=new Array((ny+2)*2);zm(_c);const rv=new Array(Cf*2);zm(rv);const sy=new Array(pBe);zm(sy);const iy=new Array(dBe-cBe+1);zm(iy);const A6=new Array(I6);zm(A6);const zC=new Array(Cf);zm(zC);function eE(e,t,n,s,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=s,this.max_length=i,this.has_stree=e&&e.length}let $ee,Gee,Hee;function tE(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const Wee=e=>e<256?sy[e]:sy[256+(e>>>7)],oy=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},Ho=(e,t,n)=>{e.bi_valid>Jj-n?(e.bi_buf|=t<<e.bi_valid&65535,oy(e,e.bi_buf),e.bi_buf=t>>Jj-e.bi_valid,e.bi_valid+=n-Jj):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},jl=(e,t,n)=>{Ho(e,n[t*2],n[t*2+1])},Uee=(e,t)=>{let n=0;do n|=e&1,e>>>=1,n<<=1;while(--t>0);return n>>>1},fBe=e=>{e.bi_valid===16?(oy(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},mBe=(e,t)=>{const n=t.dyn_tree,s=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,r=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length;let d,u,p,m,f,g,v=0;for(m=0;m<=Ju;m++)e.bl_count[m]=0;for(n[e.heap[e.heap_max]*2+1]=0,d=e.heap_max+1;d<Nee;d++)u=e.heap[d],m=n[n[u*2+1]*2+1]+1,m>c&&(m=c,v++),n[u*2+1]=m,!(u>s)&&(e.bl_count[m]++,f=0,u>=l&&(f=r[u-l]),g=n[u*2],e.opt_len+=g*(m+f),o&&(e.static_len+=g*(i[u*2+1]+f)));if(v!==0){do{for(m=c-1;e.bl_count[m]===0;)m--;e.bl_count[m]--,e.bl_count[m+1]+=2,e.bl_count[c]--,v-=2}while(v>0);for(m=c;m!==0;m--)for(u=e.bl_count[m];u!==0;)p=e.heap[--d],!(p>s)&&(n[p*2+1]!==m&&(e.opt_len+=(m-n[p*2+1])*n[p*2],n[p*2+1]=m),u--)}},qee=(e,t,n)=>{const s=new Array(Ju+1);let i=0,o,r;for(o=1;o<=Ju;o++)i=i+n[o-1]<<1,s[o]=i;for(r=0;r<=t;r++){let l=e[r*2+1];l!==0&&(e[r*2]=Uee(s[l]++,l))}},gBe=()=>{let e,t,n,s,i;const o=new Array(Ju+1);for(n=0,s=0;s<I6-1;s++)for(A6[s]=n,e=0;e<1<<xT[s];e++)iy[n++]=s;for(iy[n-1]=s,i=0,s=0;s<16;s++)for(zC[s]=i,e=0;e<1<<w2[s];e++)sy[i++]=s;for(i>>=7;s<Cf;s++)for(zC[s]=i<<7,e=0;e<1<<w2[s]-7;e++)sy[256+i++]=s;for(t=0;t<=Ju;t++)o[t]=0;for(e=0;e<=143;)_c[e*2+1]=8,e++,o[8]++;for(;e<=255;)_c[e*2+1]=9,e++,o[9]++;for(;e<=279;)_c[e*2+1]=7,e++,o[7]++;for(;e<=287;)_c[e*2+1]=8,e++,o[8]++;for(qee(_c,ny+1,o),e=0;e<Cf;e++)rv[e*2+1]=5,rv[e*2]=Uee(e,5);$ee=new eE(_c,xT,w1+1,ny,Ju),Gee=new eE(rv,w2,0,Cf,Ju),Hee=new eE(new Array(0),hBe,0,j6,uBe)},Kee=e=>{let t;for(t=0;t<ny;t++)e.dyn_ltree[t*2]=0;for(t=0;t<Cf;t++)e.dyn_dtree[t*2]=0;for(t=0;t<j6;t++)e.bl_tree[t*2]=0;e.dyn_ltree[E6*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Zee=e=>{e.bi_valid>8?oy(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},d9=(e,t,n,s)=>{const i=t*2,o=n*2;return e[i]<e[o]||e[i]===e[o]&&s[t]<=s[n]},nE=(e,t,n)=>{const s=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&d9(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!d9(t,s,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=s},u9=(e,t,n)=>{let s,i,o=0,r,l;if(e.sym_next!==0)do s=e.pending_buf[e.sym_buf+o++]&255,s+=(e.pending_buf[e.sym_buf+o++]&255)<<8,i=e.pending_buf[e.sym_buf+o++],s===0?jl(e,i,t):(r=iy[i],jl(e,r+w1+1,t),l=xT[r],l!==0&&(i-=A6[r],Ho(e,i,l)),s--,r=Wee(s),jl(e,r,n),l=w2[r],l!==0&&(s-=zC[r],Ho(e,s,l)));while(o<e.sym_next);jl(e,E6,t)},CT=(e,t)=>{const n=t.dyn_tree,s=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let r,l,c=-1,d;for(e.heap_len=0,e.heap_max=Nee,r=0;r<o;r++)n[r*2]!==0?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):n[r*2+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=c<2?++c:0,n[d*2]=1,e.depth[d]=0,e.opt_len--,i&&(e.static_len-=s[d*2+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)nE(e,n,r);d=o;do r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],nE(e,n,1),l=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=l,n[d*2]=n[r*2]+n[l*2],e.depth[d]=(e.depth[r]>=e.depth[l]?e.depth[r]:e.depth[l])+1,n[r*2+1]=n[l*2+1]=d,e.heap[1]=d++,nE(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],mBe(e,t),qee(n,c,e.bl_count)},h9=(e,t,n)=>{let s,i=-1,o,r=t[0*2+1],l=0,c=7,d=4;for(r===0&&(c=138,d=3),t[(n+1)*2+1]=65535,s=0;s<=n;s++)o=r,r=t[(s+1)*2+1],!(++l<c&&o===r)&&(l<d?e.bl_tree[o*2]+=l:o!==0?(o!==i&&e.bl_tree[o*2]++,e.bl_tree[Fee*2]++):l<=10?e.bl_tree[Bee*2]++:e.bl_tree[zee*2]++,l=0,i=o,r===0?(c=138,d=3):o===r?(c=6,d=3):(c=7,d=4))},p9=(e,t,n)=>{let s,i=-1,o,r=t[0*2+1],l=0,c=7,d=4;for(r===0&&(c=138,d=3),s=0;s<=n;s++)if(o=r,r=t[(s+1)*2+1],!(++l<c&&o===r)){if(l<d)do jl(e,o,e.bl_tree);while(--l!==0);else o!==0?(o!==i&&(jl(e,o,e.bl_tree),l--),jl(e,Fee,e.bl_tree),Ho(e,l-3,2)):l<=10?(jl(e,Bee,e.bl_tree),Ho(e,l-3,3)):(jl(e,zee,e.bl_tree),Ho(e,l-11,7));l=0,i=o,r===0?(c=138,d=3):o===r?(c=6,d=3):(c=7,d=4)}},vBe=e=>{let t;for(h9(e,e.dyn_ltree,e.l_desc.max_code),h9(e,e.dyn_dtree,e.d_desc.max_code),CT(e,e.bl_desc),t=j6-1;t>=3&&e.bl_tree[Vee[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},yBe=(e,t,n,s)=>{let i;for(Ho(e,t-257,5),Ho(e,n-1,5),Ho(e,s-4,4),i=0;i<s;i++)Ho(e,e.bl_tree[Vee[i]*2+1],3);p9(e,e.dyn_ltree,t-1),p9(e,e.dyn_dtree,n-1)},bBe=e=>{let t=4093624447,n;for(n=0;n<=31;n++,t>>>=1)if(t&1&&e.dyn_ltree[n*2]!==0)return l9;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return c9;for(n=32;n<w1;n++)if(e.dyn_ltree[n*2]!==0)return c9;return l9};let f9=!1;const xBe=e=>{f9||(gBe(),f9=!0),e.l_desc=new tE(e.dyn_ltree,$ee),e.d_desc=new tE(e.dyn_dtree,Gee),e.bl_desc=new tE(e.bl_tree,Hee),e.bi_buf=0,e.bi_valid=0,Kee(e)},Xee=(e,t,n,s)=>{Ho(e,(rBe<<1)+(s?1:0),3),Zee(e),oy(e,n),oy(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},CBe=e=>{Ho(e,Oee<<1,3),jl(e,E6,_c),fBe(e)},wBe=(e,t,n,s)=>{let i,o,r=0;e.level>0?(e.strm.data_type===aBe&&(e.strm.data_type=bBe(e)),CT(e,e.l_desc),CT(e,e.d_desc),r=vBe(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=n+5,n+4<=i&&t!==-1?Xee(e,t,n,s):e.strategy===oBe||o===i?(Ho(e,(Oee<<1)+(s?1:0),3),u9(e,_c,rv)):(Ho(e,(lBe<<1)+(s?1:0),3),yBe(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),u9(e,e.dyn_ltree,e.dyn_dtree)),Kee(e),s&&Zee(e)},_Be=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[n*2]++:(e.matches++,t--,e.dyn_ltree[(iy[n]+w1+1)*2]++,e.dyn_dtree[Wee(t)*2]++),e.sym_next===e.sym_end);var SBe=xBe,kBe=Xee,IBe=wBe,jBe=_Be,EBe=CBe,ABe={_tr_init:SBe,_tr_stored_block:kBe,_tr_flush_block:IBe,_tr_tally:jBe,_tr_align:EBe};const PBe=(e,t,n,s)=>{let i=e&65535|0,o=e>>>16&65535|0,r=0;for(;n!==0;){r=n>2e3?2e3:n,n-=r;do i=i+t[s++]|0,o=o+i|0;while(--r);i%=65521,o%=65521}return i|o<<16|0};var ay=PBe;const TBe=()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var s=0;s<8;s++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t},DBe=new Uint32Array(TBe()),MBe=(e,t,n,s)=>{const i=DBe,o=s+n;e^=-1;for(let r=s;r<o;r++)e=e>>>8^i[(e^t[r])&255];return e^-1};var ai=MBe,wh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},PS={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:LBe,_tr_stored_block:wT,_tr_flush_block:RBe,_tr_tally:Vd,_tr_align:OBe}=ABe,{Z_NO_FLUSH:$d,Z_PARTIAL_FLUSH:NBe,Z_FULL_FLUSH:FBe,Z_FINISH:Ha,Z_BLOCK:m9,Z_OK:ji,Z_STREAM_END:g9,Z_STREAM_ERROR:Fl,Z_DATA_ERROR:BBe,Z_BUF_ERROR:sE,Z_DEFAULT_COMPRESSION:zBe,Z_FILTERED:VBe,Z_HUFFMAN_ONLY:ux,Z_RLE:$Be,Z_FIXED:GBe,Z_DEFAULT_STRATEGY:HBe,Z_UNKNOWN:WBe,Z_DEFLATED:TS}=PS,UBe=9,qBe=15,KBe=8,ZBe=29,XBe=256,_T=XBe+1+ZBe,YBe=30,QBe=19,JBe=2*_T+1,eze=15,an=3,Ld=258,Bl=Ld+an+1,tze=32,Ff=42,P6=57,ST=69,kT=73,IT=91,jT=103,eh=113,V0=666,xo=1,Vm=2,_h=3,$m=4,nze=3,th=(e,t)=>(e.msg=wh[t],t),v9=e=>e*2-(e>4?9:0),_d=e=>{let t=e.length;for(;--t>=0;)e[t]=0},sze=e=>{let t,n,s,i=e.w_size;t=e.hash_size,s=t;do n=e.head[--s],e.head[s]=n>=i?n-i:0;while(--t);t=i,s=t;do n=e.prev[--s],e.prev[s]=n>=i?n-i:0;while(--t)};let ize=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,Gd=ize;const na=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Ca=(e,t)=>{RBe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,na(e.strm)},_n=(e,t)=>{e.pending_buf[e.pending++]=t},v0=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},ET=(e,t,n,s)=>{let i=e.avail_in;return i>s&&(i=s),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=ay(e.adler,t,i,n):e.state.wrap===2&&(e.adler=ai(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},Yee=(e,t)=>{let n=e.max_chain_length,s=e.strstart,i,o,r=e.prev_length,l=e.nice_match;const c=e.strstart>e.w_size-Bl?e.strstart-(e.w_size-Bl):0,d=e.window,u=e.w_mask,p=e.prev,m=e.strstart+Ld;let f=d[s+r-1],g=d[s+r];e.prev_length>=e.good_match&&(n>>=2),l>e.lookahead&&(l=e.lookahead);do if(i=t,!(d[i+r]!==g||d[i+r-1]!==f||d[i]!==d[s]||d[++i]!==d[s+1])){s+=2,i++;do;while(d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&s<m);if(o=Ld-(m-s),s=m-Ld,o>r){if(e.match_start=t,r=o,o>=l)break;f=d[s+r-1],g=d[s+r]}}while((t=p[t&u])>c&&--n!==0);return r<=e.lookahead?r:e.lookahead},Bf=e=>{const t=e.w_size;let n,s,i;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Bl)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),sze(e),s+=t),e.strm.avail_in===0)break;if(n=ET(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=an)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Gd(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Gd(e,e.ins_h,e.window[i+an-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<an)););}while(e.lookahead<Bl&&e.strm.avail_in!==0)},Qee=(e,t)=>{let n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s,i,o,r=0,l=e.strm.avail_in;do{if(s=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,i=e.strstart-e.block_start,s>i+e.strm.avail_in&&(s=i+e.strm.avail_in),s>o&&(s=o),s<n&&(s===0&&t!==Ha||t===$d||s!==i+e.strm.avail_in)))break;r=t===Ha&&s===i+e.strm.avail_in?1:0,wT(e,0,0,r),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,na(e.strm),i&&(i>s&&(i=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,s-=i),s&&(ET(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(r===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),r?$m:t!==$d&&t!==Ha&&e.strm.avail_in===0&&e.strstart===e.block_start?Vm:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(ET(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,n=o>e.w_size?e.w_size:o,i=e.strstart-e.block_start,(i>=n||(i||t===Ha)&&t!==$d&&e.strm.avail_in===0&&i<=o)&&(s=i>o?o:i,r=t===Ha&&e.strm.avail_in===0&&s===i?1:0,wT(e,e.block_start,s,r),e.block_start+=s,na(e.strm)),r?_h:xo)},iE=(e,t)=>{let n,s;for(;;){if(e.lookahead<Bl){if(Bf(e),e.lookahead<Bl&&t===$d)return xo;if(e.lookahead===0)break}if(n=0,e.lookahead>=an&&(e.ins_h=Gd(e,e.ins_h,e.window[e.strstart+an-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Bl&&(e.match_length=Yee(e,n)),e.match_length>=an)if(s=Vd(e,e.strstart-e.match_start,e.match_length-an),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=an){e.match_length--;do e.strstart++,e.ins_h=Gd(e,e.ins_h,e.window[e.strstart+an-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Gd(e,e.ins_h,e.window[e.strstart+1]);else s=Vd(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(Ca(e,!1),e.strm.avail_out===0))return xo}return e.insert=e.strstart<an-1?e.strstart:an-1,t===Ha?(Ca(e,!0),e.strm.avail_out===0?_h:$m):e.sym_next&&(Ca(e,!1),e.strm.avail_out===0)?xo:Vm},mp=(e,t)=>{let n,s,i;for(;;){if(e.lookahead<Bl){if(Bf(e),e.lookahead<Bl&&t===$d)return xo;if(e.lookahead===0)break}if(n=0,e.lookahead>=an&&(e.ins_h=Gd(e,e.ins_h,e.window[e.strstart+an-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=an-1,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Bl&&(e.match_length=Yee(e,n),e.match_length<=5&&(e.strategy===VBe||e.match_length===an&&e.strstart-e.match_start>4096)&&(e.match_length=an-1)),e.prev_length>=an&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-an,s=Vd(e,e.strstart-1-e.prev_match,e.prev_length-an),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Gd(e,e.ins_h,e.window[e.strstart+an-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=an-1,e.strstart++,s&&(Ca(e,!1),e.strm.avail_out===0))return xo}else if(e.match_available){if(s=Vd(e,0,e.window[e.strstart-1]),s&&Ca(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return xo}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Vd(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<an-1?e.strstart:an-1,t===Ha?(Ca(e,!0),e.strm.avail_out===0?_h:$m):e.sym_next&&(Ca(e,!1),e.strm.avail_out===0)?xo:Vm},oze=(e,t)=>{let n,s,i,o;const r=e.window;for(;;){if(e.lookahead<=Ld){if(Bf(e),e.lookahead<=Ld&&t===$d)return xo;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=an&&e.strstart>0&&(i=e.strstart-1,s=r[i],s===r[++i]&&s===r[++i]&&s===r[++i])){o=e.strstart+Ld;do;while(s===r[++i]&&s===r[++i]&&s===r[++i]&&s===r[++i]&&s===r[++i]&&s===r[++i]&&s===r[++i]&&s===r[++i]&&i<o);e.match_length=Ld-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=an?(n=Vd(e,1,e.match_length-an),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Vd(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Ca(e,!1),e.strm.avail_out===0))return xo}return e.insert=0,t===Ha?(Ca(e,!0),e.strm.avail_out===0?_h:$m):e.sym_next&&(Ca(e,!1),e.strm.avail_out===0)?xo:Vm},aze=(e,t)=>{let n;for(;;){if(e.lookahead===0&&(Bf(e),e.lookahead===0)){if(t===$d)return xo;break}if(e.match_length=0,n=Vd(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Ca(e,!1),e.strm.avail_out===0))return xo}return e.insert=0,t===Ha?(Ca(e,!0),e.strm.avail_out===0?_h:$m):e.sym_next&&(Ca(e,!1),e.strm.avail_out===0)?xo:Vm};function al(e,t,n,s,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=s,this.func=i}const $0=[new al(0,0,0,0,Qee),new al(4,4,8,4,iE),new al(4,5,16,8,iE),new al(4,6,32,32,iE),new al(4,4,16,16,mp),new al(8,16,32,32,mp),new al(8,16,128,128,mp),new al(8,32,128,256,mp),new al(32,128,258,1024,mp),new al(32,258,258,4096,mp)],rze=e=>{e.window_size=2*e.w_size,_d(e.head),e.max_lazy_match=$0[e.level].max_lazy,e.good_match=$0[e.level].good_length,e.nice_match=$0[e.level].nice_length,e.max_chain_length=$0[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=an-1,e.match_available=0,e.ins_h=0};function lze(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=TS,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(JBe*2),this.dyn_dtree=new Uint16Array((2*YBe+1)*2),this.bl_tree=new Uint16Array((2*QBe+1)*2),_d(this.dyn_ltree),_d(this.dyn_dtree),_d(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(eze+1),this.heap=new Uint16Array(2*_T+1),_d(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*_T+1),_d(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const _1=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Ff&&t.status!==P6&&t.status!==ST&&t.status!==kT&&t.status!==IT&&t.status!==jT&&t.status!==eh&&t.status!==V0?1:0},Jee=e=>{if(_1(e))return th(e,Fl);e.total_in=e.total_out=0,e.data_type=WBe;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?P6:t.wrap?Ff:eh,e.adler=t.wrap===2?0:1,t.last_flush=-2,LBe(t),ji},ete=e=>{const t=Jee(e);return t===ji&&rze(e.state),t},cze=(e,t)=>_1(e)||e.state.wrap!==2?Fl:(e.state.gzhead=t,ji),tte=(e,t,n,s,i,o)=>{if(!e)return Fl;let r=1;if(t===zBe&&(t=6),s<0?(r=0,s=-s):s>15&&(r=2,s-=16),i<1||i>UBe||n!==TS||s<8||s>15||t<0||t>9||o<0||o>GBe||s===8&&r!==1)return th(e,Fl);s===8&&(s=9);const l=new lze;return e.state=l,l.strm=e,l.status=Ff,l.wrap=r,l.gzhead=null,l.w_bits=s,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=i+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+an-1)/an),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<i+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=t,l.strategy=o,l.method=n,ete(e)},dze=(e,t)=>tte(e,t,TS,qBe,KBe,HBe),uze=(e,t)=>{if(_1(e)||t>m9||t<0)return e?th(e,Fl):Fl;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===V0&&t!==Ha)return th(e,e.avail_out===0?sE:Fl);const s=n.last_flush;if(n.last_flush=t,n.pending!==0){if(na(e),e.avail_out===0)return n.last_flush=-1,ji}else if(e.avail_in===0&&v9(t)<=v9(s)&&t!==Ha)return th(e,sE);if(n.status===V0&&e.avail_in!==0)return th(e,sE);if(n.status===Ff&&n.wrap===0&&(n.status=eh),n.status===Ff){let i=TS+(n.w_bits-8<<4)<<8,o=-1;if(n.strategy>=ux||n.level<2?o=0:n.level<6?o=1:n.level===6?o=2:o=3,i|=o<<6,n.strstart!==0&&(i|=tze),i+=31-i%31,v0(n,i),n.strstart!==0&&(v0(n,e.adler>>>16),v0(n,e.adler&65535)),e.adler=1,n.status=eh,na(e),n.pending!==0)return n.last_flush=-1,ji}if(n.status===P6){if(e.adler=0,_n(n,31),_n(n,139),_n(n,8),n.gzhead)_n(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),_n(n,n.gzhead.time&255),_n(n,n.gzhead.time>>8&255),_n(n,n.gzhead.time>>16&255),_n(n,n.gzhead.time>>24&255),_n(n,n.level===9?2:n.strategy>=ux||n.level<2?4:0),_n(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(_n(n,n.gzhead.extra.length&255),_n(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=ai(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=ST;else if(_n(n,0),_n(n,0),_n(n,0),_n(n,0),_n(n,0),_n(n,n.level===9?2:n.strategy>=ux||n.level<2?4:0),_n(n,nze),n.status=eh,na(e),n.pending!==0)return n.last_flush=-1,ji}if(n.status===ST){if(n.gzhead.extra){let i=n.pending,o=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+o>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(e.adler=ai(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=l,na(e),n.pending!==0)return n.last_flush=-1,ji;i=0,o-=l}let r=new Uint8Array(n.gzhead.extra);n.pending_buf.set(r.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending+=o,n.gzhead.hcrc&&n.pending>i&&(e.adler=ai(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=kT}if(n.status===kT){if(n.gzhead.name){let i=n.pending,o;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(e.adler=ai(e.adler,n.pending_buf,n.pending-i,i)),na(e),n.pending!==0)return n.last_flush=-1,ji;i=0}n.gzindex<n.gzhead.name.length?o=n.gzhead.name.charCodeAt(n.gzindex++)&255:o=0,_n(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>i&&(e.adler=ai(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=IT}if(n.status===IT){if(n.gzhead.comment){let i=n.pending,o;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(e.adler=ai(e.adler,n.pending_buf,n.pending-i,i)),na(e),n.pending!==0)return n.last_flush=-1,ji;i=0}n.gzindex<n.gzhead.comment.length?o=n.gzhead.comment.charCodeAt(n.gzindex++)&255:o=0,_n(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>i&&(e.adler=ai(e.adler,n.pending_buf,n.pending-i,i))}n.status=jT}if(n.status===jT){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(na(e),n.pending!==0))return n.last_flush=-1,ji;_n(n,e.adler&255),_n(n,e.adler>>8&255),e.adler=0}if(n.status=eh,na(e),n.pending!==0)return n.last_flush=-1,ji}if(e.avail_in!==0||n.lookahead!==0||t!==$d&&n.status!==V0){let i=n.level===0?Qee(n,t):n.strategy===ux?aze(n,t):n.strategy===$Be?oze(n,t):$0[n.level].func(n,t);if((i===_h||i===$m)&&(n.status=V0),i===xo||i===_h)return e.avail_out===0&&(n.last_flush=-1),ji;if(i===Vm&&(t===NBe?OBe(n):t!==m9&&(wT(n,0,0,!1),t===FBe&&(_d(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),na(e),e.avail_out===0))return n.last_flush=-1,ji}return t!==Ha?ji:n.wrap<=0?g9:(n.wrap===2?(_n(n,e.adler&255),_n(n,e.adler>>8&255),_n(n,e.adler>>16&255),_n(n,e.adler>>24&255),_n(n,e.total_in&255),_n(n,e.total_in>>8&255),_n(n,e.total_in>>16&255),_n(n,e.total_in>>24&255)):(v0(n,e.adler>>>16),v0(n,e.adler&65535)),na(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?ji:g9)},hze=e=>{if(_1(e))return Fl;const t=e.state.status;return e.state=null,t===eh?th(e,BBe):ji},pze=(e,t)=>{let n=t.length;if(_1(e))return Fl;const s=e.state,i=s.wrap;if(i===2||i===1&&s.status!==Ff||s.lookahead)return Fl;if(i===1&&(e.adler=ay(e.adler,t,n,0)),s.wrap=0,n>=s.w_size){i===0&&(_d(s.head),s.strstart=0,s.block_start=0,s.insert=0);let c=new Uint8Array(s.w_size);c.set(t.subarray(n-s.w_size,n),0),t=c,n=s.w_size}const o=e.avail_in,r=e.next_in,l=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Bf(s);s.lookahead>=an;){let c=s.strstart,d=s.lookahead-(an-1);do s.ins_h=Gd(s,s.ins_h,s.window[c+an-1]),s.prev[c&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=c,c++;while(--d);s.strstart=c,s.lookahead=an-1,Bf(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=an-1,s.match_available=0,e.next_in=r,e.input=l,e.avail_in=o,s.wrap=i,ji};var fze=dze,mze=tte,gze=ete,vze=Jee,yze=cze,bze=uze,xze=hze,Cze=pze,wze="pako deflate (from Nodeca project)",lv={deflateInit:fze,deflateInit2:mze,deflateReset:gze,deflateResetKeep:vze,deflateSetHeader:yze,deflate:bze,deflateEnd:xze,deflateSetDictionary:Cze,deflateInfo:wze};const _ze=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Sze=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const s in n)_ze(n,s)&&(e[s]=n[s])}}return e},kze=e=>{let t=0;for(let s=0,i=e.length;s<i;s++)t+=e[s].length;const n=new Uint8Array(t);for(let s=0,i=0,o=e.length;s<o;s++){let r=e[s];n.set(r,i),i+=r.length}return n},DS={assign:Sze,flattenChunks:kze};let nte=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{nte=!1}const ry=new Uint8Array(256);for(let e=0;e<256;e++)ry[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;ry[254]=ry[254]=1;var Ize=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,s,i,o,r=e.length,l=0;for(i=0;i<r;i++)n=e.charCodeAt(i),(n&64512)===55296&&i+1<r&&(s=e.charCodeAt(i+1),(s&64512)===56320&&(n=65536+(n-55296<<10)+(s-56320),i++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(l),o=0,i=0;o<l;i++)n=e.charCodeAt(i),(n&64512)===55296&&i+1<r&&(s=e.charCodeAt(i+1),(s&64512)===56320&&(n=65536+(n-55296<<10)+(s-56320),i++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|n&63):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|n&63):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|n&63);return t};const jze=(e,t)=>{if(t<65534&&e.subarray&&nte)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let s=0;s<t;s++)n+=String.fromCharCode(e[s]);return n};var Eze=(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let s,i;const o=new Array(n*2);for(i=0,s=0;s<n;){let r=e[s++];if(r<128){o[i++]=r;continue}let l=ry[r];if(l>4){o[i++]=65533,s+=l-1;continue}for(r&=l===2?31:l===3?15:7;l>1&&s<n;)r=r<<6|e[s++]&63,l--;if(l>1){o[i++]=65533;continue}r<65536?o[i++]=r:(r-=65536,o[i++]=55296|r>>10&1023,o[i++]=56320|r&1023)}return jze(o,i)},Aze=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(e[n]&192)===128;)n--;return n<0||n===0?t:n+ry[e[n]]>t?n:t},ly={string2buf:Ize,buf2string:Eze,utf8border:Aze};function Pze(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var ste=Pze;const ite=Object.prototype.toString,{Z_NO_FLUSH:Tze,Z_SYNC_FLUSH:Dze,Z_FULL_FLUSH:Mze,Z_FINISH:Lze,Z_OK:VC,Z_STREAM_END:Rze,Z_DEFAULT_COMPRESSION:Oze,Z_DEFAULT_STRATEGY:Nze,Z_DEFLATED:Fze}=PS;function MS(e){this.options=DS.assign({level:Oze,method:Fze,chunkSize:16384,windowBits:15,memLevel:8,strategy:Nze},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ste,this.strm.avail_out=0;let n=lv.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==VC)throw new Error(wh[n]);if(t.header&&lv.deflateSetHeader(this.strm,t.header),t.dictionary){let s;if(typeof t.dictionary=="string"?s=ly.string2buf(t.dictionary):ite.call(t.dictionary)==="[object ArrayBuffer]"?s=new Uint8Array(t.dictionary):s=t.dictionary,n=lv.deflateSetDictionary(this.strm,s),n!==VC)throw new Error(wh[n]);this._dict_set=!0}}MS.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize;let i,o;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?Lze:Tze,typeof e=="string"?n.input=ly.string2buf(e):ite.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),(o===Dze||o===Mze)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=lv.deflate(n,o),i===Rze)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=lv.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===VC;if(n.avail_out===0){this.onData(n.output);continue}if(o>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0};MS.prototype.onData=function(e){this.chunks.push(e)};MS.prototype.onEnd=function(e){e===VC&&(this.result=DS.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Bze(e,t){const n=new MS(t);if(n.push(e,!0),n.err)throw n.msg||wh[n.err];return n.result}var zze=Bze,Vze={deflate:zze};const hx=16209,$ze=16191;var Gze=function(t,n){let s,i,o,r,l,c,d,u,p,m,f,g,v,b,C,y,x,w,_,S,I,k,E,j;const P=t.state;s=t.next_in,E=t.input,i=s+(t.avail_in-5),o=t.next_out,j=t.output,r=o-(n-t.avail_out),l=o+(t.avail_out-257),c=P.dmax,d=P.wsize,u=P.whave,p=P.wnext,m=P.window,f=P.hold,g=P.bits,v=P.lencode,b=P.distcode,C=(1<<P.lenbits)-1,y=(1<<P.distbits)-1;e:do{g<15&&(f+=E[s++]<<g,g+=8,f+=E[s++]<<g,g+=8),x=v[f&C];t:for(;;){if(w=x>>>24,f>>>=w,g-=w,w=x>>>16&255,w===0)j[o++]=x&65535;else if(w&16){_=x&65535,w&=15,w&&(g<w&&(f+=E[s++]<<g,g+=8),_+=f&(1<<w)-1,f>>>=w,g-=w),g<15&&(f+=E[s++]<<g,g+=8,f+=E[s++]<<g,g+=8),x=b[f&y];n:for(;;){if(w=x>>>24,f>>>=w,g-=w,w=x>>>16&255,w&16){if(S=x&65535,w&=15,g<w&&(f+=E[s++]<<g,g+=8,g<w&&(f+=E[s++]<<g,g+=8)),S+=f&(1<<w)-1,S>c){t.msg="invalid distance too far back",P.mode=hx;break e}if(f>>>=w,g-=w,w=o-r,S>w){if(w=S-w,w>u&&P.sane){t.msg="invalid distance too far back",P.mode=hx;break e}if(I=0,k=m,p===0){if(I+=d-w,w<_){_-=w;do j[o++]=m[I++];while(--w);I=o-S,k=j}}else if(p<w){if(I+=d+p-w,w-=p,w<_){_-=w;do j[o++]=m[I++];while(--w);if(I=0,p<_){w=p,_-=w;do j[o++]=m[I++];while(--w);I=o-S,k=j}}}else if(I+=p-w,w<_){_-=w;do j[o++]=m[I++];while(--w);I=o-S,k=j}for(;_>2;)j[o++]=k[I++],j[o++]=k[I++],j[o++]=k[I++],_-=3;_&&(j[o++]=k[I++],_>1&&(j[o++]=k[I++]))}else{I=o-S;do j[o++]=j[I++],j[o++]=j[I++],j[o++]=j[I++],_-=3;while(_>2);_&&(j[o++]=j[I++],_>1&&(j[o++]=j[I++]))}}else if((w&64)===0){x=b[(x&65535)+(f&(1<<w)-1)];continue n}else{t.msg="invalid distance code",P.mode=hx;break e}break}}else if((w&64)===0){x=v[(x&65535)+(f&(1<<w)-1)];continue t}else if(w&32){P.mode=$ze;break e}else{t.msg="invalid literal/length code",P.mode=hx;break e}break}}while(s<i&&o<l);_=g>>3,s-=_,g-=_<<3,f&=(1<<g)-1,t.next_in=s,t.next_out=o,t.avail_in=s<i?5+(i-s):5-(s-i),t.avail_out=o<l?257+(l-o):257-(o-l),P.hold=f,P.bits=g};const gp=15,y9=852,b9=592,x9=0,oE=1,C9=2,Hze=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Wze=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Uze=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),qze=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Kze=(e,t,n,s,i,o,r,l)=>{const c=l.bits;let d=0,u=0,p=0,m=0,f=0,g=0,v=0,b=0,C=0,y=0,x,w,_,S,I,k=null,E;const j=new Uint16Array(gp+1),P=new Uint16Array(gp+1);let D=null,O,N,F;for(d=0;d<=gp;d++)j[d]=0;for(u=0;u<s;u++)j[t[n+u]]++;for(f=c,m=gp;m>=1&&j[m]===0;m--);if(f>m&&(f=m),m===0)return i[o++]=1<<24|64<<16|0,i[o++]=1<<24|64<<16|0,l.bits=1,0;for(p=1;p<m&&j[p]===0;p++);for(f<p&&(f=p),b=1,d=1;d<=gp;d++)if(b<<=1,b-=j[d],b<0)return-1;if(b>0&&(e===x9||m!==1))return-1;for(P[1]=0,d=1;d<gp;d++)P[d+1]=P[d]+j[d];for(u=0;u<s;u++)t[n+u]!==0&&(r[P[t[n+u]]++]=u);if(e===x9?(k=D=r,E=20):e===oE?(k=Hze,D=Wze,E=257):(k=Uze,D=qze,E=0),y=0,u=0,d=p,I=o,g=f,v=0,_=-1,C=1<<f,S=C-1,e===oE&&C>y9||e===C9&&C>b9)return 1;for(;;){O=d-v,r[u]+1<E?(N=0,F=r[u]):r[u]>=E?(N=D[r[u]-E],F=k[r[u]-E]):(N=96,F=0),x=1<<d-v,w=1<<g,p=w;do w-=x,i[I+(y>>v)+w]=O<<24|N<<16|F|0;while(w!==0);for(x=1<<d-1;y&x;)x>>=1;if(x!==0?(y&=x-1,y+=x):y=0,u++,--j[d]===0){if(d===m)break;d=t[n+r[u]]}if(d>f&&(y&S)!==_){for(v===0&&(v=f),I+=p,g=d-v,b=1<<g;g+v<m&&(b-=j[g+v],!(b<=0));)g++,b<<=1;if(C+=1<<g,e===oE&&C>y9||e===C9&&C>b9)return 1;_=y&S,i[_]=f<<24|g<<16|I-o|0}}return y!==0&&(i[I+y]=d-v<<24|64<<16|0),l.bits=f,0};var cv=Kze;const Zze=0,ote=1,ate=2,{Z_FINISH:w9,Z_BLOCK:Xze,Z_TREES:px,Z_OK:Sh,Z_STREAM_END:Yze,Z_NEED_DICT:Qze,Z_STREAM_ERROR:dr,Z_DATA_ERROR:rte,Z_MEM_ERROR:lte,Z_BUF_ERROR:Jze,Z_DEFLATED:_9}=PS,LS=16180,S9=16181,k9=16182,I9=16183,j9=16184,E9=16185,A9=16186,P9=16187,T9=16188,D9=16189,$C=16190,fc=16191,aE=16192,M9=16193,rE=16194,L9=16195,R9=16196,O9=16197,N9=16198,fx=16199,mx=16200,F9=16201,B9=16202,z9=16203,V9=16204,$9=16205,lE=16206,G9=16207,H9=16208,rs=16209,cte=16210,dte=16211,eVe=852,tVe=592,nVe=15,sVe=nVe,W9=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function iVe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Yh=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<LS||t.mode>dte?1:0},ute=e=>{if(Yh(e))return dr;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=LS,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(eVe),t.distcode=t.distdyn=new Int32Array(tVe),t.sane=1,t.back=-1,Sh},hte=e=>{if(Yh(e))return dr;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,ute(e)},pte=(e,t)=>{let n;if(Yh(e))return dr;const s=e.state;return t<0?(n=0,t=-t):(n=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?dr:(s.window!==null&&s.wbits!==t&&(s.window=null),s.wrap=n,s.wbits=t,hte(e))},fte=(e,t)=>{if(!e)return dr;const n=new iVe;e.state=n,n.strm=e,n.window=null,n.mode=LS;const s=pte(e,t);return s!==Sh&&(e.state=null),s},oVe=e=>fte(e,sVe);let U9=!0,cE,dE;const aVe=e=>{if(U9){cE=new Int32Array(512),dE=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(cv(ote,e.lens,0,288,cE,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;cv(ate,e.lens,0,32,dE,0,e.work,{bits:5}),U9=!1}e.lencode=cE,e.lenbits=9,e.distcode=dE,e.distbits=5},mte=(e,t,n,s)=>{let i;const o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),s>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>s&&(i=s),o.window.set(t.subarray(n-s,n-s+i),o.wnext),s-=i,s?(o.window.set(t.subarray(n-s,n),0),o.wnext=s,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0},rVe=(e,t)=>{let n,s,i,o,r,l,c,d,u,p,m,f,g,v,b=0,C,y,x,w,_,S,I,k;const E=new Uint8Array(4);let j,P;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Yh(e)||!e.output||!e.input&&e.avail_in!==0)return dr;n=e.state,n.mode===fc&&(n.mode=aE),r=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,s=e.input,l=e.avail_in,d=n.hold,u=n.bits,p=l,m=c,k=Sh;e:for(;;)switch(n.mode){case LS:if(n.wrap===0){n.mode=aE;break}for(;u<16;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}if(n.wrap&2&&d===35615){n.wbits===0&&(n.wbits=15),n.check=0,E[0]=d&255,E[1]=d>>>8&255,n.check=ai(n.check,E,2,0),d=0,u=0,n.mode=S9;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((d&255)<<8)+(d>>8))%31){e.msg="incorrect header check",n.mode=rs;break}if((d&15)!==_9){e.msg="unknown compression method",n.mode=rs;break}if(d>>>=4,u-=4,I=(d&15)+8,n.wbits===0&&(n.wbits=I),I>15||I>n.wbits){e.msg="invalid window size",n.mode=rs;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=d&512?D9:fc,d=0,u=0;break;case S9:for(;u<16;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}if(n.flags=d,(n.flags&255)!==_9){e.msg="unknown compression method",n.mode=rs;break}if(n.flags&57344){e.msg="unknown header flags set",n.mode=rs;break}n.head&&(n.head.text=d>>8&1),n.flags&512&&n.wrap&4&&(E[0]=d&255,E[1]=d>>>8&255,n.check=ai(n.check,E,2,0)),d=0,u=0,n.mode=k9;case k9:for(;u<32;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}n.head&&(n.head.time=d),n.flags&512&&n.wrap&4&&(E[0]=d&255,E[1]=d>>>8&255,E[2]=d>>>16&255,E[3]=d>>>24&255,n.check=ai(n.check,E,4,0)),d=0,u=0,n.mode=I9;case I9:for(;u<16;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}n.head&&(n.head.xflags=d&255,n.head.os=d>>8),n.flags&512&&n.wrap&4&&(E[0]=d&255,E[1]=d>>>8&255,n.check=ai(n.check,E,2,0)),d=0,u=0,n.mode=j9;case j9:if(n.flags&1024){for(;u<16;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}n.length=d,n.head&&(n.head.extra_len=d),n.flags&512&&n.wrap&4&&(E[0]=d&255,E[1]=d>>>8&255,n.check=ai(n.check,E,2,0)),d=0,u=0}else n.head&&(n.head.extra=null);n.mode=E9;case E9:if(n.flags&1024&&(f=n.length,f>l&&(f=l),f&&(n.head&&(I=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(s.subarray(o,o+f),I)),n.flags&512&&n.wrap&4&&(n.check=ai(n.check,s,f,o)),l-=f,o+=f,n.length-=f),n.length))break e;n.length=0,n.mode=A9;case A9:if(n.flags&2048){if(l===0)break e;f=0;do I=s[o+f++],n.head&&I&&n.length<65536&&(n.head.name+=String.fromCharCode(I));while(I&&f<l);if(n.flags&512&&n.wrap&4&&(n.check=ai(n.check,s,f,o)),l-=f,o+=f,I)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=P9;case P9:if(n.flags&4096){if(l===0)break e;f=0;do I=s[o+f++],n.head&&I&&n.length<65536&&(n.head.comment+=String.fromCharCode(I));while(I&&f<l);if(n.flags&512&&n.wrap&4&&(n.check=ai(n.check,s,f,o)),l-=f,o+=f,I)break e}else n.head&&(n.head.comment=null);n.mode=T9;case T9:if(n.flags&512){for(;u<16;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}if(n.wrap&4&&d!==(n.check&65535)){e.msg="header crc mismatch",n.mode=rs;break}d=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=fc;break;case D9:for(;u<32;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}e.adler=n.check=W9(d),d=0,u=0,n.mode=$C;case $C:if(n.havedict===0)return e.next_out=r,e.avail_out=c,e.next_in=o,e.avail_in=l,n.hold=d,n.bits=u,Qze;e.adler=n.check=1,n.mode=fc;case fc:if(t===Xze||t===px)break e;case aE:if(n.last){d>>>=u&7,u-=u&7,n.mode=lE;break}for(;u<3;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}switch(n.last=d&1,d>>>=1,u-=1,d&3){case 0:n.mode=M9;break;case 1:if(aVe(n),n.mode=fx,t===px){d>>>=2,u-=2;break e}break;case 2:n.mode=R9;break;case 3:e.msg="invalid block type",n.mode=rs}d>>>=2,u-=2;break;case M9:for(d>>>=u&7,u-=u&7;u<32;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}if((d&65535)!==(d>>>16^65535)){e.msg="invalid stored block lengths",n.mode=rs;break}if(n.length=d&65535,d=0,u=0,n.mode=rE,t===px)break e;case rE:n.mode=L9;case L9:if(f=n.length,f){if(f>l&&(f=l),f>c&&(f=c),f===0)break e;i.set(s.subarray(o,o+f),r),l-=f,o+=f,c-=f,r+=f,n.length-=f;break}n.mode=fc;break;case R9:for(;u<14;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}if(n.nlen=(d&31)+257,d>>>=5,u-=5,n.ndist=(d&31)+1,d>>>=5,u-=5,n.ncode=(d&15)+4,d>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=rs;break}n.have=0,n.mode=O9;case O9:for(;n.have<n.ncode;){for(;u<3;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}n.lens[D[n.have++]]=d&7,d>>>=3,u-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,j={bits:n.lenbits},k=cv(Zze,n.lens,0,19,n.lencode,0,n.work,j),n.lenbits=j.bits,k){e.msg="invalid code lengths set",n.mode=rs;break}n.have=0,n.mode=N9;case N9:for(;n.have<n.nlen+n.ndist;){for(;b=n.lencode[d&(1<<n.lenbits)-1],C=b>>>24,y=b>>>16&255,x=b&65535,!(C<=u);){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}if(x<16)d>>>=C,u-=C,n.lens[n.have++]=x;else{if(x===16){for(P=C+2;u<P;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}if(d>>>=C,u-=C,n.have===0){e.msg="invalid bit length repeat",n.mode=rs;break}I=n.lens[n.have-1],f=3+(d&3),d>>>=2,u-=2}else if(x===17){for(P=C+3;u<P;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}d>>>=C,u-=C,I=0,f=3+(d&7),d>>>=3,u-=3}else{for(P=C+7;u<P;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}d>>>=C,u-=C,I=0,f=11+(d&127),d>>>=7,u-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=rs;break}for(;f--;)n.lens[n.have++]=I}}if(n.mode===rs)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=rs;break}if(n.lenbits=9,j={bits:n.lenbits},k=cv(ote,n.lens,0,n.nlen,n.lencode,0,n.work,j),n.lenbits=j.bits,k){e.msg="invalid literal/lengths set",n.mode=rs;break}if(n.distbits=6,n.distcode=n.distdyn,j={bits:n.distbits},k=cv(ate,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,j),n.distbits=j.bits,k){e.msg="invalid distances set",n.mode=rs;break}if(n.mode=fx,t===px)break e;case fx:n.mode=mx;case mx:if(l>=6&&c>=258){e.next_out=r,e.avail_out=c,e.next_in=o,e.avail_in=l,n.hold=d,n.bits=u,Gze(e,m),r=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,s=e.input,l=e.avail_in,d=n.hold,u=n.bits,n.mode===fc&&(n.back=-1);break}for(n.back=0;b=n.lencode[d&(1<<n.lenbits)-1],C=b>>>24,y=b>>>16&255,x=b&65535,!(C<=u);){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}if(y&&(y&240)===0){for(w=C,_=y,S=x;b=n.lencode[S+((d&(1<<w+_)-1)>>w)],C=b>>>24,y=b>>>16&255,x=b&65535,!(w+C<=u);){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}d>>>=w,u-=w,n.back+=w}if(d>>>=C,u-=C,n.back+=C,n.length=x,y===0){n.mode=$9;break}if(y&32){n.back=-1,n.mode=fc;break}if(y&64){e.msg="invalid literal/length code",n.mode=rs;break}n.extra=y&15,n.mode=F9;case F9:if(n.extra){for(P=n.extra;u<P;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=B9;case B9:for(;b=n.distcode[d&(1<<n.distbits)-1],C=b>>>24,y=b>>>16&255,x=b&65535,!(C<=u);){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}if((y&240)===0){for(w=C,_=y,S=x;b=n.distcode[S+((d&(1<<w+_)-1)>>w)],C=b>>>24,y=b>>>16&255,x=b&65535,!(w+C<=u);){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}d>>>=w,u-=w,n.back+=w}if(d>>>=C,u-=C,n.back+=C,y&64){e.msg="invalid distance code",n.mode=rs;break}n.offset=x,n.extra=y&15,n.mode=z9;case z9:if(n.extra){for(P=n.extra;u<P;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=rs;break}n.mode=V9;case V9:if(c===0)break e;if(f=m-c,n.offset>f){if(f=n.offset-f,f>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=rs;break}f>n.wnext?(f-=n.wnext,g=n.wsize-f):g=n.wnext-f,f>n.length&&(f=n.length),v=n.window}else v=i,g=r-n.offset,f=n.length;f>c&&(f=c),c-=f,n.length-=f;do i[r++]=v[g++];while(--f);n.length===0&&(n.mode=mx);break;case $9:if(c===0)break e;i[r++]=n.length,c--,n.mode=mx;break;case lE:if(n.wrap){for(;u<32;){if(l===0)break e;l--,d|=s[o++]<<u,u+=8}if(m-=c,e.total_out+=m,n.total+=m,n.wrap&4&&m&&(e.adler=n.check=n.flags?ai(n.check,i,m,r-m):ay(n.check,i,m,r-m)),m=c,n.wrap&4&&(n.flags?d:W9(d))!==n.check){e.msg="incorrect data check",n.mode=rs;break}d=0,u=0}n.mode=G9;case G9:if(n.wrap&&n.flags){for(;u<32;){if(l===0)break e;l--,d+=s[o++]<<u,u+=8}if(n.wrap&4&&d!==(n.total&4294967295)){e.msg="incorrect length check",n.mode=rs;break}d=0,u=0}n.mode=H9;case H9:k=Yze;break e;case rs:k=rte;break e;case cte:return lte;case dte:default:return dr}return e.next_out=r,e.avail_out=c,e.next_in=o,e.avail_in=l,n.hold=d,n.bits=u,(n.wsize||m!==e.avail_out&&n.mode<rs&&(n.mode<lE||t!==w9))&&mte(e,e.output,e.next_out,m-e.avail_out),p-=e.avail_in,m-=e.avail_out,e.total_in+=p,e.total_out+=m,n.total+=m,n.wrap&4&&m&&(e.adler=n.check=n.flags?ai(n.check,i,m,e.next_out-m):ay(n.check,i,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===fc?128:0)+(n.mode===fx||n.mode===rE?256:0),(p===0&&m===0||t===w9)&&k===Sh&&(k=Jze),k},lVe=e=>{if(Yh(e))return dr;let t=e.state;return t.window&&(t.window=null),e.state=null,Sh},cVe=(e,t)=>{if(Yh(e))return dr;const n=e.state;return(n.wrap&2)===0?dr:(n.head=t,t.done=!1,Sh)},dVe=(e,t)=>{const n=t.length;let s,i,o;return Yh(e)||(s=e.state,s.wrap!==0&&s.mode!==$C)?dr:s.mode===$C&&(i=1,i=ay(i,t,n,0),i!==s.check)?rte:(o=mte(e,t,n,n),o?(s.mode=cte,lte):(s.havedict=1,Sh))};var uVe=hte,hVe=pte,pVe=ute,fVe=oVe,mVe=fte,gVe=rVe,vVe=lVe,yVe=cVe,bVe=dVe,xVe="pako inflate (from Nodeca project)",Sc={inflateReset:uVe,inflateReset2:hVe,inflateResetKeep:pVe,inflateInit:fVe,inflateInit2:mVe,inflate:gVe,inflateEnd:vVe,inflateGetHeader:yVe,inflateSetDictionary:bVe,inflateInfo:xVe};function CVe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var wVe=CVe;const gte=Object.prototype.toString,{Z_NO_FLUSH:_Ve,Z_FINISH:SVe,Z_OK:cy,Z_STREAM_END:uE,Z_NEED_DICT:hE,Z_STREAM_ERROR:kVe,Z_DATA_ERROR:q9,Z_MEM_ERROR:IVe}=PS;function RS(e){this.options=DS.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ste,this.strm.avail_out=0;let n=Sc.inflateInit2(this.strm,t.windowBits);if(n!==cy)throw new Error(wh[n]);if(this.header=new wVe,Sc.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=ly.string2buf(t.dictionary):gte.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Sc.inflateSetDictionary(this.strm,t.dictionary),n!==cy)))throw new Error(wh[n])}RS.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize,i=this.options.dictionary;let o,r,l;if(this.ended)return!1;for(t===~~t?r=t:r=t===!0?SVe:_Ve,gte.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),o=Sc.inflate(n,r),o===hE&&i&&(o=Sc.inflateSetDictionary(n,i),o===cy?o=Sc.inflate(n,r):o===q9&&(o=hE));n.avail_in>0&&o===uE&&n.state.wrap>0&&e[n.next_in]!==0;)Sc.inflateReset(n),o=Sc.inflate(n,r);switch(o){case kVe:case q9:case hE:case IVe:return this.onEnd(o),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||o===uE))if(this.options.to==="string"){let c=ly.utf8border(n.output,n.next_out),d=n.next_out-c,u=ly.buf2string(n.output,c);n.next_out=d,n.avail_out=s-d,d&&n.output.set(n.output.subarray(c,c+d),0),this.onData(u)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(o===cy&&l===0)){if(o===uE)return o=Sc.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(n.avail_in===0)break}}return!0};RS.prototype.onData=function(e){this.chunks.push(e)};RS.prototype.onEnd=function(e){e===cy&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=DS.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function jVe(e,t){const n=new RS(t);if(n.push(e),n.err)throw n.msg||wh[n.err];return n.result}var EVe=jVe,AVe={inflate:EVe};const{deflate:PVe}=Vze,{inflate:TVe}=AVe;var DVe=PVe,MVe=TVe,LVe=!1,OS={},zf={pass:"pass through",norm:"normal",diss:"dissolve",dark:"darken","mul ":"multiply",idiv:"color burn",lbrn:"linear burn",dkCl:"darker color",lite:"lighten",scrn:"screen","div ":"color dodge",lddg:"linear dodge",lgCl:"lighter color",over:"overlay",sLit:"soft light",hLit:"hard light",vLit:"vivid light",lLit:"linear light",pLit:"pin light",hMix:"hard mix",diff:"difference",smud:"exclusion",fsub:"subtract",fdiv:"divide","hue ":"hue","sat ":"saturation",colr:"color","lum ":"luminosity"};Object.keys(zf).forEach(function(e){return OS[zf[e]]=e});var K9=["none","red","orange","yellow","green","blue","violet","gray"],vte=["LMsk","Lr16","Lr32","Layr","Mt16","Mt32","Mtrn","Alph","FMsk","lnk2","FEid","FXid","PxSD","cinf"];function RVe(e){var t={};return Object.keys(e).forEach(function(n){return t[e[n]]=n}),t}function ft(e,t,n){var s=RVe(n),i=function(r){var l=r.split(".")[1];if(l&&!s[l])throw new Error("Unrecognized value for enum: '".concat(r,"'"));return s[l]||t},o=function(r){if(r&&!n[r])throw new Error("Invalid value for enum: '".concat(r,"'"));return"".concat(e,".").concat(n[r]||n[t])};return{decode:i,encode:o}}var Z9;(function(e){e[e.RGB=0]="RGB",e[e.HSB=1]="HSB",e[e.CMYK=2]="CMYK",e[e.Lab=7]="Lab",e[e.Grayscale=8]="Grayscale"})(Z9||(Z9={}));var X9;(function(e){e[e.PositionRelativeToLayer=1]="PositionRelativeToLayer",e[e.LayerMaskDisabled=2]="LayerMaskDisabled",e[e.InvertLayerMaskWhenBlending=4]="InvertLayerMaskWhenBlending",e[e.LayerMaskFromRenderingOtherData=8]="LayerMaskFromRenderingOtherData",e[e.MaskHasParametersAppliedToIt=16]="MaskHasParametersAppliedToIt"})(X9||(X9={}));var Y9;(function(e){e[e.UserMaskDensity=1]="UserMaskDensity",e[e.UserMaskFeather=2]="UserMaskFeather",e[e.VectorMaskDensity=4]="VectorMaskDensity",e[e.VectorMaskFeather=8]="VectorMaskFeather"})(Y9||(Y9={}));var Q9;(function(e){e[e.Color0=0]="Color0",e[e.Color1=1]="Color1",e[e.Color2=2]="Color2",e[e.Color3=3]="Color3",e[e.Transparency=-1]="Transparency",e[e.UserMask=-2]="UserMask",e[e.RealUserMask=-3]="RealUserMask"})(Q9||(Q9={}));var J9;(function(e){e[e.RawData=0]="RawData",e[e.RleCompressed=1]="RleCompressed",e[e.ZipWithoutPrediction=2]="ZipWithoutPrediction",e[e.ZipWithPrediction=3]="ZipWithPrediction"})(J9||(J9={}));function yte(e,t){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return t?3:e+1;case-1:return t?4:3;default:return e+1}}function T6(e,t,n){return e<t?t:e>n?n:e}function bte(e){for(var t=e.width*e.height*4,n=3;n<t;n+=4)if(e.data[n]!==255)return!0;return!1}function eB(e){for(var t=e.data,n=t instanceof Float32Array?1:t instanceof Uint16Array?65535:255,s=0,i=t.length|0;s<i;s=s+4|0)t[s+0]=0,t[s+1]=0,t[s+2]=0,t[s+3]=n}function AT(e){var t=NS(e.width,e.height),n;if(e.data instanceof Uint8ClampedArray)n=e;else{n=FS(e.width,e.height);var s=e.data,i=n.data;if(s instanceof Float32Array)for(var o=0,r=s.length;o<r;o+=4)i[o+0]=Math.round(Math.pow(s[o+0],1/2.2)*255),i[o+1]=Math.round(Math.pow(s[o+1],1/2.2)*255),i[o+2]=Math.round(Math.pow(s[o+2],1/2.2)*255),i[o+3]=Math.round(s[o+3]*255);else for(var l=s instanceof Uint16Array?8:0,o=0,r=s.length;o<r;o++)i[o]=s[o]>>>l}return t.getContext("2d").putImageData(n,0,0),t}function D6(e,t,n,s){var i=t.data,o=t.width,r=t.height;if(!(!o||!r)){for(var l=4*o|0,c=0,d=n.length*(s?4:2)*r|0,u=0,p=n;u<p.length;u++)for(var m=p[u],f=0,g=m|0;f<r;f++){var v=f*l|0,b=v+l|0,C=b+m-4|0,y=C-4|0,x=d;for(g=v+m|0;g<b;g=g+4|0)if(g<y){var w=i[g];g=g+4|0;var _=i[g];g=g+4|0;var S=i[g];if(w===_&&w===S){for(var I=3;I<128&&g<C&&i[g+4|0]===w;)I=I+1|0,g=g+4|0;e[d++]=1-I,e[d++]=w}else{var k=d,E=!0,I=1;for(e[d++]=0,e[d++]=w;g<C&&I<128;)if(g=g+4|0,w=_,_=S,S=i[g],w===_&&w===S){g=g-12|0,E=!1;break}else I++,e[d++]=w;E&&(I<127?(e[d++]=_,e[d++]=S,I+=2):I<128?(e[d++]=_,I++,g=g-4|0):g=g-8|0),e[k]=I-1}}else g===C?(e[d++]=0,e[d++]=i[g]):(e[d++]=1,e[d++]=i[g],g=g+4|0,e[d++]=i[g]);var j=d-x;s&&(e[c++]=j>>24&255,e[c++]=j>>16&255),e[c++]=j>>8&255,e[c++]=j&255}return e.slice(0,d)}}function xte(e,t){for(var n=e.data,s=e.width,i=e.height,o=s*i,r=new Uint8Array(o),l=[],c=0,d=0,u=t;d<u.length;d++){for(var p=u[d],m=0,f=p;m<o;m++,f+=4)r[m]=n[f];var g=DVe(r);l.push(g),c+=g.byteLength}if(l.length>0){for(var g=new Uint8Array(c),p=0,v=0,b=l;v<b.length;v++){var C=b[v];g.set(C,p),p+=C.byteLength}return g}else return l[0]}var NS=function(){throw new Error("Canvas not initialized, use initializeCanvas method to set up createCanvas method")},Cte=function(){throw new Error("Canvas not initialized, use initializeCanvas method to set up createCanvasFromData method")},pE=void 0,FS=function(e,t){return pE||(pE=NS(1,1)),pE.getContext("2d").createImageData(e,t)};typeof document<"u"&&(NS=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},Cte=function(e){var t=new Image;t.src="data:image/jpeg;base64,"+BC.fromByteArray(e);var n=document.createElement("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0),n});function PT(e){return(e&4294967168)===0?1:(e&4294965248)===0?2:(e&4294901760)===0?3:4}function OVe(e){for(var t=0,n=0;n<e.length;n++){var s=e.charCodeAt(n);if(s>=55296&&s<=56319){if(n+1<e.length){var i=e.charCodeAt(n+1);(i&64512)===56320&&(n++,t+=PT(((s&1023)<<10)+(i&1023)+65536))}}else t+=PT(s)}return t}function tB(e,t,n){var s=PT(n);switch(s){case 1:e[t]=n;break;case 2:e[t]=n>>6&31|192,e[t+1]=n&63|128;break;case 3:e[t]=n>>12&15|224,e[t+1]=n>>6&63|128,e[t+2]=n&63|128;break;default:e[t]=n>>18&7|240,e[t+1]=n>>12&63|128,e[t+2]=n>>6&63|128,e[t+3]=n&63|128;break}return s}function NVe(e,t,n){for(var s=0;s<n.length;s++){var i=n.charCodeAt(s);if(i>=55296&&i<=56319){if(s+1<n.length){var o=n.charCodeAt(s+1);if((o&64512)===56320){s++;var r=((i&1023)<<10)+(o&1023)+65536;t+=tB(e,t,r)}}}else t+=tB(e,t,i)}return t}function wte(e){if(e.length>1e3&&typeof TextEncoder<"u")return new TextEncoder().encode(e);var t=new Uint8Array(OVe(e));return NVe(t,0,e),t}function vp(e,t){if(t>=e.length)throw Error("Invalid byte index");var n=e[t];if((n&192)===128)return n&63;throw Error("Invalid continuation byte")}function _te(e){if(e.byteLength>1e3&&typeof TextDecoder<"u")return new TextDecoder().decode(e);for(var t=[],n=0;n<e.length;){var s=e[n++],i=void 0;if((s&128)===0)i=s;else if((s&224)===192){var o=vp(e,n++);if(i=(s&31)<<6|o,i<128)throw Error("Invalid continuation byte")}else if((s&240)===224){var o=vp(e,n++),r=vp(e,n++);if(i=(s&15)<<12|o<<6|r,i<2048)throw Error("Invalid continuation byte");if(i>=55296&&i<=57343)throw Error("Lone surrogate U+".concat(i.toString(16).toUpperCase()," is not a scalar value"))}else if((s&248)===240){var o=vp(e,n++),r=vp(e,n++),l=vp(e,n++);if(i=(s&15)<<18|o<<12|r<<6|l,i<65536||i>1114111)throw Error("Invalid continuation byte")}else throw Error("Invalid UTF-8 detected");i>65535&&(i-=65536,t.push(String.fromCharCode(i>>>10&1023|55296)),i=56320|i&1023),t.push(String.fromCharCode(i))}return t.join("")}var Mc=function(){return Mc=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Mc.apply(this,arguments)},FVe=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]]);return n};function BVe(e){var t={};return Object.keys(e).forEach(function(n){return t[e[n]]=n}),t}var G0={"#Ang":"Angle","#Rsl":"Density","#Rlt":"Distance","#Nne":"None","#Prc":"Percent","#Pxl":"Pixels","#Mlm":"Millimeters","#Pnt":"Points",RrPi:"Picas",RrIn:"Inches",RrCm:"Centimeters"},gx=BVe(G0);function Ve(e,t){return{name:e,classID:t}}var Jt=Ve("","null"),Ste={strokeStyleContent:Ve("","solidColorLayer"),printProofSetup:Ve("Proof Setup","proofSetup"),Grad:Ve("Gradient","Grdn"),Trnf:Ve("Transform","Trnf"),patternFill:Ve("","patternFill"),ebbl:Ve("","ebbl"),SoFi:Ve("","SoFi"),GrFl:Ve("","GrFl"),sdwC:Ve("","RGBC"),hglC:Ve("","RGBC"),"Clr ":Ve("","RGBC"),tintColor:Ve("","RGBC"),Ofst:Ve("","Pnt "),ChFX:Ve("","ChFX"),MpgS:Ve("","ShpC"),DrSh:Ve("","DrSh"),IrSh:Ve("","IrSh"),OrGl:Ve("","OrGl"),IrGl:Ve("","IrGl"),TrnS:Ve("","ShpC"),Ptrn:Ve("","Ptrn"),FrFX:Ve("","FrFX"),phase:Ve("","Pnt "),frameStep:Jt,duration:Jt,workInTime:Jt,workOutTime:Jt,audioClipGroupList:Jt,bounds:Ve("","Rctn"),customEnvelopeWarp:Ve("","customEnvelopeWarp"),warp:Ve("","warp"),"Sz  ":Ve("","Pnt "),origin:Ve("","Pnt "),autoExpandOffset:Ve("","Pnt "),keyOriginShapeBBox:Ve("","unitRect"),Vrsn:Jt,psVersion:Jt,docDefaultNewArtboardBackgroundColor:Ve("","RGBC"),artboardRect:Ve("","classFloatRect"),keyOriginRRectRadii:Ve("","radii"),keyOriginBoxCorners:Jt,rectangleCornerA:Ve("","Pnt "),rectangleCornerB:Ve("","Pnt "),rectangleCornerC:Ve("","Pnt "),rectangleCornerD:Ve("","Pnt "),compInfo:Jt,quiltWarp:Ve("","quiltWarp"),generatorSettings:Jt,crema:Jt,FrIn:Jt,blendOptions:Jt,FXRf:Jt,Lefx:Jt,time:Jt,animKey:Jt,timeScope:Jt,inTime:Jt,outTime:Jt,sheetStyle:Jt,translation:Jt,Skew:Jt,boundingBox:Ve("","boundingBox"),"Lnk ":Ve("","ExternalFileLink"),frameReader:Ve("","FrameReader"),effectParams:Ve("","motionTrackEffectParams"),Impr:Ve("None","none"),Anch:Ve("","Pnt "),"Fwd ":Ve("","Pnt "),"Bwd ":Ve("","Pnt "),FlrC:Ve("","Pnt "),meshBoundaryPath:Ve("","pathClass"),filterFX:Ve("","filterFXStyle"),Fltr:Ve("","rigidTransform"),FrgC:Ve("","RGBC"),BckC:Ve("","RGBC"),sdwM:Ve("Parameters","adaptCorrectTones"),hglM:Ve("Parameters","adaptCorrectTones"),customShape:Ve("","customShape"),origFXRefPoint:Jt,FXRefPoint:Jt,ClMg:Ve("","ClMg")},kte={"Crv ":Ve("","CrPt"),Clrs:Ve("","Clrt"),Trns:Ve("","TrnS"),keyDescriptorList:Jt,solidFillMulti:Ve("","SoFi"),gradientFillMulti:Ve("","GrFl"),dropShadowMulti:Ve("","DrSh"),innerShadowMulti:Ve("","IrSh"),frameFXMulti:Ve("","FrFX"),FrIn:Jt,FSts:Jt,LaSt:Jt,sheetTimelineOptions:Jt,trackList:Ve("","animationTrack"),globalTrackList:Ve("","animationTrack"),keyList:Jt,audioClipGroupList:Jt,audioClipList:Jt,countObjectList:Ve("","countObject"),countGroupList:Ve("","countGroup"),slices:Ve("","slice"),"Pts ":Ve("","Pthp"),SbpL:Ve("","SbpL"),pathComponents:Ve("","PaCm"),filterFXList:Ve("","filterFX"),puppetShapeList:Ve("","puppetShape"),channelDenoise:Ve("","channelDenoiseParams"),ShrP:Ve("","Pnt "),layerSettings:Jt,list:Jt,Adjs:Ve("","CrvA")},nB={TEXT:["Txt ","printerName","Nm  ","Idnt","blackAndWhitePresetFileName","LUT3DFileName","presetFileName","curvesPresetFileName","mixerPresetFileName","placed","description","reason","artboardPresetName","json","clipID","relPath","fullPath","mediaDescriptor","Msge","altTag","url","cellText","preset","KnNm","FPth","comment","originalPath"],tdta:["EngineData","LUT3DFileData","indexArray","originalVertexArray","deformedVertexArray","LqMe"],long:["TextIndex","RndS","Mdpn","Smth","Lctn","strokeStyleVersion","LaID","Vrsn","Cnt ","Brgh","Cntr","means","vibrance","Strt","bwPresetKind","comp","compID","originalCompID","curvesPresetKind","mixerPresetKind","uOrder","vOrder","PgNm","totalPages","Crop","numerator","denominator","frameCount","Annt","keyOriginType","unitValueQuadVersion","keyOriginIndex","major","minor","fix","docDefaultNewArtboardBackgroundType","artboardBackgroundType","numModifyingFX","deformNumRows","deformNumCols","FrID","FrDl","FsID","LCnt","AFrm","AFSt","numBefore","numAfter","Spcn","minOpacity","maxOpacity","BlnM","sheetID","gblA","globalAltitude","descVersion","frameReaderType","LyrI","zoomOrigin","fontSize","Rds ","sliceID","topOutset","leftOutset","bottomOutset","rightOutset","filterID","meshQuality","meshExpansion","meshRigidity","VrsM","VrsN","NmbG","WLMn","WLMx","AmMn","AmMx","SclH","SclV","Lvl ","TlNm","TlOf","FlRs","Thsh","ShrS","ShrE","FlRs","Vrnc","Strg","ExtS","ExtD","HrzS","VrtS","NmbR","EdgF","Ang1","Ang2","Ang3","Ang4","lastAppliedComp","capturedInfo"],enum:["textGridding","Ornt","warpStyle","warpRotate","Inte","Bltn","ClrS","BlrQ","bvlT","bvlS","bvlD","Md  ","glwS","GrdF","GlwT","RplS","BlrM","SmBM","strokeStyleLineCapType","strokeStyleLineJoinType","strokeStyleLineAlignment","strokeStyleBlendMode","PntT","Styl","lookupType","LUTFormat","dataOrder","tableOrder","enableCompCore","enableCompCoreGPU","compCoreSupport","compCoreGPUSupport","Engn","enableCompCoreThreads","gs99","FrDs","trackID","animInterpStyle","horzAlign","vertAlign","bgColorType","shapeOperation","UndA","Wvtp","Drct","WndM","Edg ","FlCl","IntE","IntC","Cnvr","Fl  ","Dstr","MztT","Lns ","ExtT","DspM","ExtR","ZZTy","SphM","SmBQ","placedLayerOCIOConversion","gradientsInterpolationMethod"],bool:["PstS","printSixteenBit","masterFXSwitch","enab","uglg","antialiasGloss","useShape","useTexture","uglg","antialiasGloss","useShape","Vsbl","useTexture","Algn","Rvrs","Dthr","Invr","VctC","ShTr","layerConceals","strokeEnabled","fillEnabled","strokeStyleScaleLock","strokeStyleStrokeAdjust","hardProof","MpBl","paperWhite","useLegacy","Auto","Lab ","useTint","keyShapeInvalidated","autoExpandEnabled","autoNestEnabled","autoPositionEnabled","shrinkwrapOnSaveEnabled","present","showInDialog","overprint","sheetDisclosed","lightsDisclosed","meshesDisclosed","materialsDisclosed","hasMotion","muted","Effc","selected","autoScope","fillCanvas","cellTextIsHTML","Smoo","Clsp","validAtPosition","rigidType","hasoptions","filterMaskEnable","filterMaskLinked","filterMaskExtendWithWhite","removeJPEGArtifact","Mnch","ExtF","ExtM","moreAccurate","GpuY","LIWy","Cnty"],doub:["warpValue","warpPerspective","warpPerspectiveOther","Intr","Wdth","Hght","strokeStyleMiterLimit","strokeStyleResolution","layerTime","keyOriginResolution","xx","xy","yx","yy","tx","ty","FrGA","frameRate","audioLevel","rotation","X   ","Y   ","redFloat","greenFloat","blueFloat","imageResolution","PuX0","PuX1","PuX2","PuX3","PuY0","PuY1","PuY2","PuY3"],UntF:["sdwO","hglO","lagl","Lald","srgR","blur","Sftn","Opct","Dstn","Angl","Ckmt","Nose","Inpr","ShdN","strokeStyleLineWidth","strokeStyleLineDashOffset","strokeStyleOpacity","H   ","Top ","Left","Btom","Rght","Rslt","topRight","topLeft","bottomLeft","bottomRight","ClNs","Shrp"],VlLs:["Crv ","Clrs","Mnm ","Mxm ","Trns","pathList","strokeStyleLineDashSet","FrLs","slices","LaSt","Trnf","nonAffineTransform","keyDescriptorList","guideIndeces","gradientFillMulti","solidFillMulti","frameFXMulti","innerShadowMulti","dropShadowMulti","FrIn","FSts","FsFr","sheetTimelineOptions","audioClipList","trackList","globalTrackList","keyList","audioClipList","warpValues","selectedPin","Pts ","SbpL","pathComponents","pinOffsets","posFinalPins","pinVertexIndices","PinP","PnRt","PnOv","PnDp","filterFXList","puppetShapeList","ShrP","channelDenoise","Mtrx","layerSettings","list","compList","Adjs"],ObAr:["meshPoints","quiltSliceX","quiltSliceY"],"obj ":["null","Chnl"],"Pth ":["DspF"]},zVe=["Rd  ","Grn ","Bl  ","Yllw","Ylw ","Cyn ","Mgnt","Blck","Gry ","Lmnc","A   ","B   "],Ite={"Mnm ":"long","Mxm ":"long",FrLs:"long",strokeStyleLineDashSet:"UntF",Trnf:"doub",nonAffineTransform:"doub",keyDescriptorList:"Objc",gradientFillMulti:"Objc",solidFillMulti:"Objc",frameFXMulti:"Objc",innerShadowMulti:"Objc",dropShadowMulti:"Objc",LaSt:"Objc",FrIn:"Objc",FSts:"Objc",FsFr:"long",blendOptions:"Objc",sheetTimelineOptions:"Objc",keyList:"Objc",warpValues:"doub",selectedPin:"long","Pts ":"Objc",SbpL:"Objc",pathComponents:"Objc",pinOffsets:"doub",posFinalPins:"doub",pinVertexIndices:"long",PinP:"doub",PnRt:"long",PnOv:"bool",PnDp:"doub",filterFXList:"Objc",puppetShapeList:"Objc",ShrP:"Objc",channelDenoise:"Objc",Mtrx:"long",compList:"long",Chnl:"enum"},GC={};for(var fE=0,sB=Object.keys(nB);fE<sB.length;fE++)for(var iB=sB[fE],mE=0,oB=nB[iB];mE<oB.length;mE++){var Vf=oB[mE];GC[Vf]=iB}for(var gE=0,aB=Object.keys(Ste);gE<aB.length;gE++){var Vf=aB[gE];GC[Vf]||(GC[Vf]="Objc")}for(var vE=0,rB=Object.keys(kte);vE<rB.length;vE++){var Vf=rB[vE];Ite[Vf]="Objc"}function VVe(e,t,n,s){return e==="presetKind"?typeof t=="string"?"enum":"long":e==="null"&&n==="slices"?"TEXT":e==="groupID"?n==="slices"?"long":"TEXT":e==="Sz  "?"Wdth"in t?"Objc":"units"in t?"UntF":"doub":e==="Type"?typeof t=="string"?"enum":"long":e==="AntA"?typeof t=="string"?"enum":"bool":(e==="Hrzn"||e==="Vrtc")&&(s.Type==="keyType.Pstn"||s._classID==="Ofst")?"long":e==="Hrzn"||e==="Vrtc"||e==="Top "||e==="Left"||e==="Btom"||e==="Rght"?n==="slices"?"long":typeof t=="number"?"doub":"UntF":e==="Vrsn"?typeof t=="number"?"long":"Objc":e==="Rd  "||e==="Grn "||e==="Bl  "?n==="artd"?"long":"doub":e==="Trnf"?Array.isArray(t)?"VlLs":"Objc":GC[e]}function Lc(e){var t=et(e);return N6(e,t||4)}function Rc(e,t){if(t.length===4&&t!=="warp"&&t!=="time"&&t!=="hold"&&t!=="list")lt(e,0),ht(e,t);else{lt(e,t.length);for(var n=0;n<t.length;n++)Le(e,t.charCodeAt(n))}}function jte(e,t){for(var n=Wu(e),s=t?{_name:n.name,_classID:n.classID}:{},i=Oe(e),o=0;o<i;o++){var r=Lc(e),l=Ln(e),c=Ate(e,l,t);s[r]=c}return s}function Ete(e,t,n,s,i){jh(e,t),Rc(e,n);var o=Object.keys(s),r=o.length;"_name"in s&&r--,"_classID"in s&&r--,ze(e,r);for(var l=0,c=o;l<c.length;l++){var d=c[l];if(!(d==="_name"||d==="_classID")){var u=VVe(d,s[d],i,s),p=Ste[d];d==="bounds"&&i==="text"?p=Ve("","bounds"):d==="origin"?u=i==="slices"?"enum":"Objc":(d==="Cyn "||d==="Mgnt"||d==="Ylw "||d==="Blck")&&s._classID==="CMYC"?u="doub":/^PN[a-z][a-z]$/.test(d)?u="TEXT":/^PT[a-z][a-z]$/.test(d)?u="long":/^PF[a-z][a-z]$/.test(d)||(d==="Rds "||d==="Thsh")&&typeof s[d]=="number"&&s._classID==="SmrB"?u="doub":d==="ClSz"||d==="Rds "||d==="Amnt"?u=typeof s[d]=="number"?"long":"UntF":(d==="sdwM"||d==="hglM")&&typeof s[d]=="string"||d==="blur"&&typeof s[d]=="string"?u="enum":d==="Hght"&&typeof s[d]=="number"&&s._classID==="Embs"||d==="Angl"&&typeof s[d]=="number"&&(s._classID==="Embs"||s._classID==="smartSharpen"||s._classID==="Twrl"||s._classID==="MtnB")?u="long":d==="Angl"&&typeof s[d]=="number"?u="doub":d==="bounds"&&i==="slices"?(u="Objc",p=Ve("","Rct1")):d==="Scl "?typeof s[d]=="object"&&"Hrzn"in s[d]?(u="Objc",p=Jt):typeof s[d]=="number"?u="long":u="UntF":d==="audioClipGroupList"&&o.length===1?u="VlLs":(d==="Strt"||d==="Brgh")&&"H   "in s?u="doub":d==="Wdth"&&typeof s[d]=="object"?u="UntF":d==="Ofst"&&typeof s[d]=="number"?u="long":d==="Strt"&&typeof s[d]=="object"?(u="Objc",p=Jt):zVe.indexOf(d)!==-1?u=n==="RGBC"&&i!=="artd"?"doub":"long":d==="profile"?u=n==="printOutput"?"TEXT":"tdta":d==="strokeStyleContent"?s[d]["Clr "]?p=Ve("","solidColorLayer"):s[d].Grad?p=Ve("","gradientLayer"):s[d].Ptrn&&(p=Ve("","patternLayer")):d==="bounds"&&i==="quiltWarp"&&(p=Ve("","classFloatRect")),p&&p.classID==="RGBC"&&"H   "in s[d]&&(p={classID:"HSBC",name:""}),Rc(e,d),ht(e,u||"long"),Pte(e,u||"long",s[d],d,p,i)}}}function Ate(e,t,n){switch(t){case"obj ":return GVe(e);case"Objc":case"GlbO":return jte(e,n);case"VlLs":{for(var s=et(e),i=[],o=0;o<s;o++){var r=Ln(e);i.push(Ate(e,r,n))}return i}case"doub":return er(e);case"UntF":{var l=Ln(e),c=er(e);if(!G0[l])throw new Error("Invalid units: ".concat(l));return{units:G0[l],value:c}}case"UnFl":{var l=Ln(e),c=Rr(e);if(!G0[l])throw new Error("Invalid units: ".concat(l));return{units:G0[l],value:c}}case"TEXT":return hi(e);case"enum":{var d=Lc(e),c=Lc(e);return"".concat(d,".").concat(c)}case"long":return et(e);case"comp":{var u=Oe(e),p=Oe(e);return{low:u,high:p}}case"bool":return!!We(e);case"type":case"GlbC":return Wu(e);case"alis":{var m=et(e);return N6(e,m)}case"tdta":{var f=et(e);return io(e,f)}case"ObAr":{et(e),hi(e),Lc(e);for(var g=et(e),i=[],o=0;o<g;o++){var v=Lc(e);Ln(e),Ln(e);for(var b=et(e),C=[],y=0;y<b;y++)C.push(er(e));i.push({type:v,values:C})}return i}case"Pth ":{et(e);var x=Ln(e);RB(e);var w=RB(e),_=QVe(e,w);return{sig:x,path:_}}default:throw new Error("Invalid TySh descriptor OSType: ".concat(t," at ").concat(e.offset.toString(16)))}}var $Ve={meshPoints:"rationalPoint",quiltSliceX:"UntF",quiltSliceY:"UntF"};function Pte(e,t,n,s,i,o){switch(t){case"obj ":HVe(e,s,n);break;case"Objc":case"GlbO":{if(typeof n!="object")throw new Error("Invalid struct value: ".concat(JSON.stringify(n),", key: ").concat(s));if(!i)throw new Error("Missing ext type for: '".concat(s,"' (").concat(JSON.stringify(n),")"));var r=n._name||i.name,l=n._classID||i.classID;Ete(e,r,l,n,o);break}case"VlLs":if(!Array.isArray(n))throw new Error("Invalid list value: ".concat(JSON.stringify(n),", key: ").concat(s));lt(e,n.length);for(var c=0;c<n.length;c++){var d=Ite[s];ht(e,d||"long"),Pte(e,d||"long",n[c],"".concat(s,"[]"),kte[s],o)}break;case"doub":if(typeof n!="number")throw new Error("Invalid number value: ".concat(JSON.stringify(n),", key: ").concat(s));tr(e,n);break;case"UntF":if(!gx[n.units])throw new Error("Invalid units: ".concat(n.units," in ").concat(s));ht(e,gx[n.units]),tr(e,n.value);break;case"UnFl":if(!gx[n.units])throw new Error("Invalid units: ".concat(n.units," in ").concat(s));ht(e,gx[n.units]),Or(e,n.value);break;case"TEXT":jh(e,n);break;case"enum":{if(typeof n!="string")throw new Error("Invalid enum value: ".concat(JSON.stringify(n),", key: ").concat(s));var u=n.split("."),p=u[0],m=u[1];Rc(e,p),Rc(e,m);break}case"long":if(typeof n!="number")throw new Error("Invalid integer value: ".concat(JSON.stringify(n),", key: ").concat(s));lt(e,n);break;case"bool":if(typeof n!="boolean")throw new Error("Invalid boolean value: ".concat(JSON.stringify(n),", key: ").concat(s));Le(e,n?1:0);break;case"tdta":lt(e,n.byteLength),Kr(e,n);break;case"ObAr":{lt(e,16),jh(e,"");var f=$Ve[s];if(!f)throw new Error("Not implemented ObArType for: ".concat(s));Rc(e,f),lt(e,n.length);for(var c=0;c<n.length;c++){Rc(e,n[c].type),ht(e,"UnFl"),ht(e,"#Pxl"),lt(e,n[c].values.length);for(var g=0;g<n[c].values.length;g++)tr(e,n[c].values[g])}break}case"Pth ":{var v=12+n.path.length*2;lt(e,v),ht(e,n.sig),QB(e,v),QB(e,n.path.length),O$e(e,n.path);break}default:throw new Error("Not implemented descriptor OSType: ".concat(t))}}function GVe(e){for(var t=et(e),n=[],s=0;s<t;s++){var i=Ln(e);switch(i){case"prop":{Wu(e);var o=Lc(e);n.push(o);break}case"Clss":n.push(Wu(e));break;case"Enmr":{Wu(e);var r=Lc(e),l=Lc(e);n.push("".concat(r,".").concat(l));break}case"rele":{Wu(e),n.push(Oe(e));break}case"Idnt":n.push(et(e));break;case"indx":n.push(et(e));break;case"name":{Wu(e),n.push(hi(e));break}default:throw new Error("Invalid descriptor reference type: ".concat(i))}}return n}function HVe(e,t,n){lt(e,n.length);for(var s=0;s<n.length;s++){var i=n[s],o="unknown";switch(typeof i=="string"&&(/^[a-z ]+\.[a-z ]+$/i.test(i)?o="Enmr":o="name"),ht(e,o),o){case"Enmr":{var r=i.split("."),l=r[0],c=r[1];lB(e,"\0",l),Rc(e,l),Rc(e,c);break}case"name":{lB(e,"\0","Lyr "),ua(e,i+"\0");break}default:throw new Error("Invalid descriptor reference type: ".concat(o))}}return n}function Wu(e){var t=hi(e),n=Lc(e);return{name:t,classID:n}}function lB(e,t,n){ua(e,t),Rc(e,n)}function Ht(e,t){t===void 0&&(t=!1);var n=Oe(e);if(n!==16)throw new Error("Invalid descriptor version: ".concat(n));var s=jte(e,t);return s}function Wt(e,t,n,s,i){i===void 0&&(i=""),ze(e,16),Ete(e,t,n,s,i)}function dv(e){return{x:e.Hrzn,y:e.Vrtc}}function uv(e){return{Hrzn:e.x,Vrtc:e.y}}function cB(e){return{top:bn(e["Top "]),left:bn(e.Left),right:bn(e.Rght),bottom:bn(e.Btom)}}function dB(e){var t;return t={Left:Wn(e.left,"bounds.left")},t["Top "]=Wn(e.top,"bounds.top"),t.Rght=Wn(e.right,"bounds.right"),t.Btom=Wn(e.bottom,"bounds.bottom"),t}function uB(e){var t={enabled:!!e.enab,position:zS.decode(e.Styl),fillType:Ute.decode(e.PntT),blendMode:Ja.decode(e["Md  "]),opacity:Mn(e.Opct),size:bn(e["Sz  "])};return e.present!==void 0&&(t.present=e.present),e.showInDialog!==void 0&&(t.showInDialog=e.showInDialog),e.overprint!==void 0&&(t.overprint=e.overprint),e["Clr "]&&(t.color=Fr(e["Clr "])),e.Grad&&(t.gradient=Rte(e)),e.Ptrn&&(t.pattern=Ote(e)),t}function hB(e){var t={};return t.enab=!!e.enabled,e.present!==void 0&&(t.present=!!e.present),e.showInDialog!==void 0&&(t.showInDialog=!!e.showInDialog),t.Styl=zS.encode(e.position),t.PntT=Ute.encode(e.fillType),t["Md  "]=Ja.encode(e.blendMode),t.Opct=ri(e.opacity),t["Sz  "]=Wn(e.size,"size"),e.color&&(t["Clr "]=Br(e.color)),e.gradient&&(t=Mc(Mc({},t),Nte(e.gradient))),e.pattern&&(t=Mc(Mc({},t),Fte(e.pattern))),e.overprint!==void 0&&(t.overprint=!!e.overprint),t}function S1(e,t,n){for(var s,i,o,r=n?{"Scl ":Oa((s=e.scale)!==null&&s!==void 0?s:1),masterFXSwitch:!e.disabled}:{masterFXSwitch:!e.disabled,"Scl ":Oa((i=e.scale)!==null&&i!==void 0?i:1)},l=["dropShadow","innerShadow","solidFill","gradientOverlay","stroke"],c=0,d=l;c<d.length;c++){var u=d[c];if(e[u]&&!Array.isArray(e[u]))throw new Error("".concat(u," should be an array"))}var p=function(x){return!!x&&x.length>1&&n},m=function(x){return!!x&&x.length>=1&&(!n||x.length===1)};if(m(e.dropShadow)&&(r.DrSh=ea(e.dropShadow[0],"dropShadow",t)),p(e.dropShadow)&&(r.dropShadowMulti=e.dropShadow.map(function(x){return ea(x,"dropShadow",t)})),m(e.innerShadow)&&(r.IrSh=ea(e.innerShadow[0],"innerShadow",t)),p(e.innerShadow)&&(r.innerShadowMulti=e.innerShadow.map(function(x){return ea(x,"innerShadow",t)})),e.outerGlow&&(r.OrGl=ea(e.outerGlow,"outerGlow",t)),p(e.solidFill)&&(r.solidFillMulti=e.solidFill.map(function(x){return ea(x,"solidFill",t)})),p(e.gradientOverlay)&&(r.gradientFillMulti=e.gradientOverlay.map(function(x){return ea(x,"gradientOverlay",t)})),p(e.stroke)&&(r.frameFXMulti=e.stroke.map(function(x){return hB(x)})),e.innerGlow&&(r.IrGl=ea(e.innerGlow,"innerGlow",t)),e.bevel&&(r.ebbl=ea(e.bevel,"bevel",t)),m(e.solidFill)&&(r.SoFi=ea(e.solidFill[0],"solidFill",t)),e.patternOverlay&&(r.patternFill=ea(e.patternOverlay,"patternOverlay",t)),m(e.gradientOverlay)&&(r.GrFl=ea(e.gradientOverlay[0],"gradientOverlay",t)),e.satin&&(r.ChFX=ea(e.satin,"satin",t)),m(e.stroke)&&(r.FrFX=hB((o=e.stroke)===null||o===void 0?void 0:o[0])),n){r.numModifyingFX=0;for(var f=0,g=Object.keys(e);f<g.length;f++){var u=g[f],v=e[u];if(Array.isArray(v))for(var b=0,C=v;b<C.length;b++){var y=C[b];y.enabled&&r.numModifyingFX++}else v.enabled&&r.numModifyingFX++}}return r}function k1(e,t){var n={},s=e.masterFXSwitch,i=e.DrSh,o=e.dropShadowMulti,r=e.IrSh,l=e.innerShadowMulti,c=e.OrGl,d=e.IrGl,u=e.ebbl,p=e.SoFi,m=e.solidFillMulti,f=e.patternFill,g=e.GrFl,v=e.gradientFillMulti,b=e.ChFX,C=e.FrFX,y=e.frameFXMulti;e.numModifyingFX;var x=FVe(e,["masterFXSwitch","DrSh","dropShadowMulti","IrSh","innerShadowMulti","OrGl","IrGl","ebbl","SoFi","solidFillMulti","patternFill","GrFl","gradientFillMulti","ChFX","FrFX","frameFXMulti","numModifyingFX"]);return s||(n.disabled=!0),e["Scl "]&&(n.scale=Mn(e["Scl "])),i&&(n.dropShadow=[Jo(i,t)]),o&&(n.dropShadow=o.map(function(w){return Jo(w,t)})),r&&(n.innerShadow=[Jo(r,t)]),l&&(n.innerShadow=l.map(function(w){return Jo(w,t)})),c&&(n.outerGlow=Jo(c,t)),d&&(n.innerGlow=Jo(d,t)),u&&(n.bevel=Jo(u,t)),p&&(n.solidFill=[Jo(p,t)]),m&&(n.solidFill=m.map(function(w){return Jo(w,t)})),f&&(n.patternOverlay=Jo(f,t)),g&&(n.gradientOverlay=[Jo(g,t)]),v&&(n.gradientOverlay=v.map(function(w){return Jo(w,t)})),b&&(n.satin=Jo(b,t)),C&&(n.stroke=[uB(C)]),y&&(n.stroke=y.map(function(w){return uB(w)})),t&&Object.keys(x).length>1&&console.log("Unhandled effect keys:",x),n}function pB(e,t){for(var n=[],s=0;s<e.length;s++){var i=e[s],o=i.time,r=o.denominator,l=o.numerator,c=i.selected,d=i.animKey,u={numerator:l,denominator:r},p=Hte.decode(i.animInterpStyle);switch(d.Type){case"keyType.Opct":n.push({interpolation:p,time:u,selected:c,type:"opacity",value:Mn(d.Opct)});break;case"keyType.Pstn":n.push({interpolation:p,time:u,selected:c,type:"position",x:d.Hrzn,y:d.Vrtc});break;case"keyType.Trnf":n.push({interpolation:p,time:u,selected:c,type:"transform",scale:dv(d["Scl "]),skew:dv(d.Skew),rotation:d.rotation,translation:dv(d.translation)});break;case"keyType.sheetStyle":{var m={interpolation:p,time:u,selected:c,type:"style"};d.sheetStyle.Lefx&&(m.style=k1(d.sheetStyle.Lefx,t)),n.push(m);break}case"keyType.globalLighting":{n.push({interpolation:p,time:u,selected:c,type:"globalLighting",globalAngle:d.gblA,globalAltitude:d.globalAltitude});break}default:throw new Error("Unsupported keyType value")}}return n}function fB(e){for(var t=[],n=0;n<e.length;n++){var s=e[n],i=s.time,o=s.selected,r=o===void 0?!1:o,l=s.interpolation,c=Hte.encode(l),d=void 0;switch(s.type){case"opacity":d={Type:"keyType.Opct",Opct:ri(s.value)};break;case"position":d={Type:"keyType.Pstn",Hrzn:s.x,Vrtc:s.y};break;case"transform":d={Type:"keyType.Trnf","Scl ":uv(s.scale),Skew:uv(s.skew),rotation:s.rotation,translation:uv(s.translation)};break;case"style":d={Type:"keyType.sheetStyle",sheetStyle:{Vrsn:1,blendOptions:{}}},s.style&&(d.sheetStyle={Vrsn:1,Lefx:S1(s.style,!1,!1),blendOptions:{}});break;case"globalLighting":{d={Type:"keyType.globalLighting",gblA:s.globalAngle,globalAltitude:s.globalAltitude};break}default:throw new Error("Unsupported keyType value")}t.push({Vrsn:1,animInterpStyle:c,time:i,animKey:d,selected:r})}return t}function Tte(e,t){for(var n=[],s=0;s<e.length;s++){var i=e[s],o={type:Wte.decode(i.trackID),enabled:i.enab,keys:pB(i.keyList,t)};i.effectParams&&(o.effectParams={fillCanvas:i.effectParams.fillCanvas,zoomOrigin:i.effectParams.zoomOrigin,keys:pB(i.effectParams.keyList,t)}),n.push(o)}return n}function Dte(e){for(var t=[],n=0;n<e.length;n++){var s=e[n];t.push(Mc(Mc({trackID:Wte.encode(s.type),Vrsn:1,enab:!!s.enabled,Effc:!!s.effectParams},s.effectParams?{effectParams:{keyList:fB(s.keys),fillCanvas:s.effectParams.fillCanvas,zoomOrigin:s.effectParams.zoomOrigin}}:{}),{keyList:fB(s.keys)}))}return t}function Jo(e,t){for(var n={},s=0,i=Object.keys(e);s<i.length;s++){var o=i[s],r=e[o];switch(o){case"enab":n.enabled=!!r;break;case"uglg":n.useGlobalLight=!!r;break;case"AntA":n.antialiased=!!r;break;case"Algn":n.align=!!r;break;case"Dthr":n.dither=!!r;break;case"Invr":n.invert=!!r;break;case"Rvrs":n.reverse=!!r;break;case"Clr ":n.color=Fr(r);break;case"hglC":n.highlightColor=Fr(r);break;case"sdwC":n.shadowColor=Fr(r);break;case"Styl":n.position=zS.decode(r);break;case"Md  ":n.blendMode=Ja.decode(r);break;case"hglM":n.highlightBlendMode=Ja.decode(r);break;case"sdwM":n.shadowBlendMode=Ja.decode(r);break;case"bvlS":n.style=Bte.decode(r);break;case"bvlD":n.direction=Vte.decode(r);break;case"bvlT":n.technique=zte.decode(r);break;case"GlwT":n.technique=$te.decode(r);break;case"glwS":n.source=Gte.decode(r);break;case"Type":n.type=BS.decode(r);break;case"gs99":n.interpolationMethod=$f.decode(r);break;case"Opct":n.opacity=Mn(r);break;case"hglO":n.highlightOpacity=Mn(r);break;case"sdwO":n.shadowOpacity=Mn(r);break;case"lagl":n.angle=_2(r);break;case"Angl":n.angle=_2(r);break;case"Lald":n.altitude=_2(r);break;case"Sftn":n.soften=bn(r);break;case"srgR":n.strength=Mn(r);break;case"blur":n.size=bn(r);break;case"Nose":n.noise=Mn(r);break;case"Inpr":n.range=Mn(r);break;case"Ckmt":n.choke=bn(r);break;case"ShdN":n.jitter=Mn(r);break;case"Dstn":n.distance=bn(r);break;case"Scl ":n.scale=Mn(r);break;case"Ptrn":n.pattern={name:r["Nm  "],id:r.Idnt};break;case"phase":n.phase={x:r.Hrzn,y:r.Vrtc};break;case"Ofst":n.offset={x:Mn(r.Hrzn),y:Mn(r.Vrtc)};break;case"MpgS":case"TrnS":n.contour={name:r["Nm  "],curve:r["Crv "].map(function(l){return{x:l.Hrzn,y:l.Vrtc}})};break;case"Grad":n.gradient=Mte(r);break;case"useTexture":case"useShape":case"layerConceals":case"present":case"showInDialog":case"antialiasGloss":n[o]=r;break;case"_name":case"_classID":break;default:t&&console.log("Invalid effect key: '".concat(o,"', value:"),r)}}return n}function ea(e,t,n){for(var s={},i=0,o=Object.keys(e);i<o.length;i++){var r=o[i],l=r,c=e[l];switch(l){case"enabled":s.enab=!!c;break;case"useGlobalLight":s.uglg=!!c;break;case"antialiased":s.AntA=!!c;break;case"align":s.Algn=!!c;break;case"dither":s.Dthr=!!c;break;case"invert":s.Invr=!!c;break;case"reverse":s.Rvrs=!!c;break;case"color":s["Clr "]=Br(c);break;case"highlightColor":s.hglC=Br(c);break;case"shadowColor":s.sdwC=Br(c);break;case"position":s.Styl=zS.encode(c);break;case"blendMode":s["Md  "]=Ja.encode(c);break;case"highlightBlendMode":s.hglM=Ja.encode(c);break;case"shadowBlendMode":s.sdwM=Ja.encode(c);break;case"style":s.bvlS=Bte.encode(c);break;case"direction":s.bvlD=Vte.encode(c);break;case"technique":t==="bevel"?s.bvlT=zte.encode(c):s.GlwT=$te.encode(c);break;case"source":s.glwS=Gte.encode(c);break;case"type":s.Type=BS.encode(c);break;case"interpolationMethod":s.gs99=$f.encode(c);break;case"opacity":s.Opct=ri(c);break;case"highlightOpacity":s.hglO=ri(c);break;case"shadowOpacity":s.sdwO=ri(c);break;case"angle":t==="gradientOverlay"||t==="patternFill"?s.Angl=hv(c):s.lagl=hv(c);break;case"altitude":s.Lald=hv(c);break;case"soften":s.Sftn=Wn(c,l);break;case"strength":s.srgR=ri(c);break;case"size":s.blur=Wn(c,l);break;case"noise":s.Nose=ri(c);break;case"range":s.Inpr=ri(c);break;case"choke":s.Ckmt=Wn(c,l);break;case"jitter":s.ShdN=ri(c);break;case"distance":s.Dstn=Wn(c,l);break;case"scale":s["Scl "]=ri(c);break;case"pattern":s.Ptrn={"Nm  ":c.name,Idnt:c.id};break;case"phase":s.phase={Hrzn:c.x,Vrtc:c.y};break;case"offset":s.Ofst={Hrzn:ri(c.x),Vrtc:ri(c.y)};break;case"contour":{s[t==="satin"?"MpgS":"TrnS"]={"Nm  ":c.name,"Crv ":c.curve.map(function(d){return{Hrzn:d.x,Vrtc:d.y}})};break}case"gradient":s.Grad=Lte(c);break;case"useTexture":case"useShape":case"layerConceals":case"present":case"showInDialog":case"antialiasGloss":s[l]=c;break;default:n&&console.log("Invalid effect key: '".concat(l,"', value:"),c)}}return s}function Mte(e){if(e.GrdF==="GrdF.CstS"){var t=e.Intr||4096;return{type:"solid",name:e["Nm  "],smoothness:e.Intr/4096,colorStops:e.Clrs.map(function(n){return{color:Fr(n["Clr "]),location:n.Lctn/t,midpoint:n.Mdpn/100}}),opacityStops:e.Trns.map(function(n){return{opacity:Mn(n.Opct),location:n.Lctn/t,midpoint:n.Mdpn/100}})}}else return{type:"noise",name:e["Nm  "],roughness:e.Smth/4096,colorModel:HC.decode(e.ClrS),randomSeed:e.RndS,restrictColors:!!e.VctC,addTransparency:!!e.ShTr,min:e["Mnm "].map(function(n){return n/100}),max:e["Mxm "].map(function(n){return n/100})}}function Lte(e){var t,n;if(e.type==="solid"){var s=Math.round(((t=e.smoothness)!==null&&t!==void 0?t:1)*4096);return{"Nm  ":e.name||"",GrdF:"GrdF.CstS",Intr:s,Clrs:e.colorStops.map(function(i){var o;return{"Clr ":Br(i.color),Type:"Clry.UsrS",Lctn:Math.round(i.location*s),Mdpn:Math.round(((o=i.midpoint)!==null&&o!==void 0?o:.5)*100)}}),Trns:e.opacityStops.map(function(i){var o;return{Opct:ri(i.opacity),Lctn:Math.round(i.location*s),Mdpn:Math.round(((o=i.midpoint)!==null&&o!==void 0?o:.5)*100)}})}}else return{GrdF:"GrdF.ClNs","Nm  ":e.name||"",ShTr:!!e.addTransparency,VctC:!!e.restrictColors,ClrS:HC.encode(e.colorModel),RndS:e.randomSeed||0,Smth:Math.round(((n=e.roughness)!==null&&n!==void 0?n:1)*4096),"Mnm ":(e.min||[0,0,0,0]).map(function(i){return i*100}),"Mxm ":(e.max||[1,1,1,1]).map(function(i){return i*100})}}function Rte(e){var t=Mte(e.Grad);return t.style=BS.decode(e.Type),e.Dthr!==void 0&&(t.dither=e.Dthr),e.gradientsInterpolationMethod!==void 0&&(t.interpolationMethod=$f.decode(e.gradientsInterpolationMethod)),e.Rvrs!==void 0&&(t.reverse=e.Rvrs),e.Angl!==void 0&&(t.angle=_2(e.Angl)),e["Scl "]!==void 0&&(t.scale=Mn(e["Scl "])),e.Algn!==void 0&&(t.align=e.Algn),e.Ofst!==void 0&&(t.offset={x:Mn(e.Ofst.Hrzn),y:Mn(e.Ofst.Vrtc)}),t}function Ote(e){var t={name:e.Ptrn["Nm  "],id:e.Ptrn.Idnt};return e.Lnkd!==void 0&&(t.linked=e.Lnkd),e.phase!==void 0&&(t.phase={x:e.phase.Hrzn,y:e.phase.Vrtc}),t}function I1(e){if("Grad"in e)return Rte(e);if("Ptrn"in e)return Mc({type:"pattern"},Ote(e));if("Clr "in e)return{type:"color",color:Fr(e["Clr "])};throw new Error("Invalid vector content")}function Nte(e){var t={};return e.dither!==void 0&&(t.Dthr=e.dither),e.interpolationMethod!==void 0&&(t.gradientsInterpolationMethod=$f.encode(e.interpolationMethod)),e.reverse!==void 0&&(t.Rvrs=e.reverse),e.angle!==void 0&&(t.Angl=hv(e.angle)),t.Type=BS.encode(e.style),e.align!==void 0&&(t.Algn=e.align),e.scale!==void 0&&(t["Scl "]=ri(e.scale)),e.offset&&(t.Ofst={Hrzn:ri(e.offset.x),Vrtc:ri(e.offset.y)}),t.Grad=Lte(e),t}function Fte(e){var t={Ptrn:{"Nm  ":e.name||"",Idnt:e.id||""}};return e.linked!==void 0&&(t.Lnkd=!!e.linked),e.phase!==void 0&&(t.phase={Hrzn:e.phase.x,Vrtc:e.phase.y}),t}function j1(e){return e.type==="color"?{key:"SoCo",descriptor:{"Clr ":Br(e.color)}}:e.type==="pattern"?{key:"PtFl",descriptor:Fte(e)}:{key:"GdFl",descriptor:Nte(e)}}function Fr(e){if("H   "in e)return{h:WVe(e["H   "]),s:e.Strt,b:e.Brgh};if("Rd  "in e)return{r:e["Rd  "],g:e["Grn "],b:e["Bl  "]};if("Cyn "in e)return{c:e["Cyn "],m:e.Mgnt,y:e["Ylw "],k:e.Blck};if("Gry "in e)return{k:e["Gry "]};if("Lmnc"in e)return{l:e.Lmnc,a:e["A   "],b:e["B   "]};if("redFloat"in e)return{fr:e.redFloat,fg:e.greenFloat,fb:e.blueFloat};throw new Error("Unsupported color descriptor")}function Br(e){if(e){if("r"in e)return{_name:"",_classID:"RGBC","Rd  ":e.r||0,"Grn ":e.g||0,"Bl  ":e.b||0};if("fr"in e)return{_name:"",_classID:"RGBC",redFloat:e.fr,greenFloat:e.fg,blueFloat:e.fb};if("h"in e)return{_name:"",_classID:"HSBC","H   ":hv(e.h*360),Strt:e.s||0,Brgh:e.b||0};if("c"in e)return{_name:"",_classID:"CMYC","Cyn ":e.c||0,Mgnt:e.m||0,"Ylw ":e.y||0,Blck:e.k||0};if("l"in e)return{_name:"",_classID:"LABC",Lmnc:e.l||0,"A   ":e.a||0,"B   ":e.b||0};if("k"in e)return{_name:"",_classID:"GRYC","Gry ":e.k};throw new Error("Invalid color value")}else return{_name:"",_classID:"RGBC","Rd  ":0,"Grn ":0,"Bl  ":0}}function _2(e){if(e===void 0)return 0;if(e.units!=="Angle")throw new Error("Invalid units: ".concat(e.units));return e.value}function Mn(e){if(e===void 0)return 1;if(e.units!=="Percent")throw new Error("Invalid units: ".concat(e.units));return e.value/100}function WVe(e){if(e===void 0)return 1;if(e.units==="Percent")return e.value/100;if(e.units==="Angle")return e.value/360;throw new Error("Invalid units: ".concat(e.units))}function bn(e){var t=e.units,n=e.value;if(t!=="Pixels"&&t!=="Millimeters"&&t!=="Points"&&t!=="None"&&t!=="Picas"&&t!=="Inches"&&t!=="Centimeters"&&t!=="Density")throw new Error("Invalid units: ".concat(JSON.stringify({units:t,value:n})));return{value:n,units:t}}function Rd(e,t){return t===void 0&&(t="Pixels"),typeof e=="number"?{value:e,units:t}:bn(e)}function hv(e){return{units:"Angle",value:e||0}}function ri(e){return{units:"Percent",value:Math.round((e||0)*100)}}function Oa(e){return{units:"Percent",value:(e||0)*100}}function Wn(e,t){if(e==null)return{units:"Pixels",value:0};if(typeof e!="object")throw new Error("Invalid value: ".concat(JSON.stringify(e)," (key: ").concat(t,") (should have value and units)"));var n=e.units,s=e.value;if(typeof s!="number")throw new Error("Invalid value in ".concat(JSON.stringify(e)," (key: ").concat(t,")"));if(n!=="Pixels"&&n!=="Millimeters"&&n!=="Points"&&n!=="None"&&n!=="Picas"&&n!=="Inches"&&n!=="Centimeters"&&n!=="Density")throw new Error("Invalid units in ".concat(JSON.stringify(e)," (key: ").concat(t,")"));return{units:n,value:s}}function fo(e){var t=e.numerator,n=e.denominator;return{numerator:t,denominator:n}}var mB=ft("textGridding","none",{none:"None",round:"Rnd "}),pv=ft("Ornt","horizontal",{horizontal:"Hrzn",vertical:"Vrtc"}),gB=ft("Annt","sharp",{none:"Anno",sharp:"antiAliasSharp",crisp:"AnCr",strong:"AnSt",smooth:"AnSm",platform:"antiAliasPlatformGray",platformLCD:"antiAliasPlatformLCD"}),M6=ft("warpStyle","none",{none:"warpNone",arc:"warpArc",arcLower:"warpArcLower",arcUpper:"warpArcUpper",arch:"warpArch",bulge:"warpBulge",shellLower:"warpShellLower",shellUpper:"warpShellUpper",flag:"warpFlag",wave:"warpWave",fish:"warpFish",rise:"warpRise",fisheye:"warpFisheye",inflate:"warpInflate",squeeze:"warpSqueeze",twist:"warpTwist",cylinder:"warpCylinder",custom:"warpCustom"}),Ja=ft("BlnM","normal",{normal:"Nrml",dissolve:"Dslv",darken:"Drkn",multiply:"Mltp","color burn":"CBrn","linear burn":"linearBurn","darker color":"darkerColor",lighten:"Lghn",screen:"Scrn","color dodge":"CDdg","linear dodge":"linearDodge","lighter color":"lighterColor",overlay:"Ovrl","soft light":"SftL","hard light":"HrdL","vivid light":"vividLight","linear light":"linearLight","pin light":"pinLight","hard mix":"hardMix",difference:"Dfrn",exclusion:"Xclu",subtract:"blendSubtraction",divide:"blendDivide",hue:"H   ",saturation:"Strt",color:"Clr ",luminosity:"Lmns","linear height":"linearHeight",height:"Hght",subtraction:"Sbtr"}),Bte=ft("BESl","inner bevel",{"inner bevel":"InrB","outer bevel":"OtrB",emboss:"Embs","pillow emboss":"PlEb","stroke emboss":"strokeEmboss"}),zte=ft("bvlT","smooth",{smooth:"SfBL","chisel hard":"PrBL","chisel soft":"Slmt"}),Vte=ft("BESs","up",{up:"In  ",down:"Out "}),$te=ft("BETE","softer",{softer:"SfBL",precise:"PrBL"}),Gte=ft("IGSr","edge",{edge:"SrcE",center:"SrcC"}),BS=ft("GrdT","linear",{linear:"Lnr ",radial:"Rdl ",angle:"Angl",reflected:"Rflc",diamond:"Dmnd"}),Hte=ft("animInterpStyle","linear",{linear:"Lnr ",hold:"hold"}),Wte=ft("stdTrackID","opacity",{opacity:"opacityTrack",style:"styleTrack",sheetTransform:"sheetTransformTrack",sheetPosition:"sheetPositionTrack",globalLighting:"globalLightingTrack"}),$f=ft("gradientInterpolationMethodType","perceptual",{perceptual:"Perc",linear:"Lnr ",classic:"Gcls",smooth:"Smoo"}),HC=ft("ClrS","rgb",{rgb:"RGBC",hsb:"HSBl",lab:"LbCl",hsl:"HSLC"}),zS=ft("FStl","outside",{outside:"OutF",center:"CtrF",inside:"InsF"}),Ute=ft("FrFl","color",{color:"SClr",gradient:"GrFl",pattern:"Ptrn"}),vB=ft("ESliceType","image",{image:"Img ",noImage:"noImage"}),yB=ft("ESliceHorzAlign","default",{default:"default"}),bB=ft("ESliceVertAlign","default",{default:"default"}),xB=ft("ESliceOrigin","userGenerated",{userGenerated:"userGenerated",autoGenerated:"autoGenerated",layer:"layer"}),CB=ft("ESliceBGColorType","none",{none:"None",matte:"matte",color:"Clr "}),wB=ft("strokeStyleLineCapType","butt",{butt:"strokeStyleButtCap",round:"strokeStyleRoundCap",square:"strokeStyleSquareCap"}),_B=ft("strokeStyleLineJoinType","miter",{miter:"strokeStyleMiterJoin",round:"strokeStyleRoundJoin",bevel:"strokeStyleBevelJoin"}),SB=ft("strokeStyleLineAlignment","inside",{inside:"strokeStyleAlignInside",center:"strokeStyleAlignCenter",outside:"strokeStyleAlignOutside"}),qte=ft("BlrM","ispinmage",{spin:"Spn ",zoom:"Zm  "}),Kte=ft("BlrQ","good",{draft:"Drft",good:"Gd  ",best:"Bst "}),Zte=ft("SmBM","normal",{normal:"SBMN","edge only":"SBME","overlay edge":"SBMO"}),Xte=ft("SmBQ","medium",{low:"SBQL",medium:"SBQM",high:"SBQH"}),Yte=ft("DspM","stretch to fit",{"stretch to fit":"StrF",tile:"Tile"}),wf=ft("UndA","repeat edge pixels",{"wrap around":"WrpA","repeat edge pixels":"RptE"}),Qte=ft("Cnvr","rectangular to polar",{"rectangular to polar":"RctP","polar to rectangular":"PlrR"}),Jte=ft("RplS","medium",{small:"Sml ",medium:"Mdm ",large:"Lrg "}),ene=ft("SphM","normal",{normal:"Nrml","horizontal only":"HrzO","vertical only":"VrtO"}),tne=ft("Wvtp","sine",{sine:"WvSn",triangle:"WvTr",square:"WvSq"}),nne=ft("ZZTy","pond ripples",{"around center":"ArnC","out from center":"OtFr","pond ripples":"PndR"}),sne=ft("Dstr","uniform",{uniform:"Unfr",gaussian:"Gsn "}),fv=ft("Chnl","composite",{red:"Rd  ",green:"Grn ",blue:"Bl  ",composite:"Cmps"}),ine=ft("MztT","fine dots",{"fine dots":"FnDt","medium dots":"MdmD","grainy dots":"GrnD","coarse dots":"CrsD","short lines":"ShrL","medium lines":"MdmL","long lines":"LngL","short strokes":"ShSt","medium strokes":"MdmS","long strokes":"LngS"}),one=ft("Lns ","50-300mm zoom",{"50-300mm zoom":"Zm  ","32mm prime":"Nkn ","105mm prime":"Nkn1","movie prime":"PnVs"}),ane=ft("blurType","gaussian blur",{"gaussian blur":"GsnB","lens blur":"lensBlur","motion blur":"MtnB"}),rne=ft("DfsM","normal",{normal:"Nrml","darken only":"DrkO","lighten only":"LghO",anisotropic:"anisotropic"}),lne=ft("ExtT","blocks",{blocks:"Blks",pyramids:"Pyrm"}),cne=ft("ExtR","random",{random:"Rndm","level-based":"LvlB"}),dne=ft("FlCl","background color",{"background color":"FlBc","foreground color":"FlFr","inverse image":"FlIn","unaltered image":"FlSm"}),une=ft("CntE","upper",{lower:"Lwr ",upper:"Upr "}),hne=ft("WndM","wind",{wind:"Wnd ",blast:"Blst",stagger:"Stgr"}),pne=ft("Drct","from the right",{left:"Left",right:"Rght"}),fne=ft("IntE","odd lines",{"odd lines":"ElmO","even lines":"ElmE"}),mne=ft("IntC","interpolation",{duplication:"CrtD",interpolation:"CrtI"}),gne=ft("FlMd","wrap around",{"set to transparent":"Bckg","repeat edge pixels":"Rpt ","wrap around":"Wrp "});ft("prjM","fisheye",{fisheye:"fisP",perspective:"perP",auto:"auto","full spherical":"fusP"});var vne=ft("presetKindType","presetKindCustom",{custom:"presetKindCustom",default:"presetKindDefault"}),nf=function(){return nf=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},nf.apply(this,arguments)},yne=[],UVe={};function vn(e,t,n,s){var i={key:e,has:t,read:n,write:s};yne.push(i),UVe[i.key]=i}var vx=[void 0,"PPI","PPCM"],yx=[void 0,"Inches","Centimeters","Points","Picas","Columns"],kB="0123456789abcdef";function IB(e){return e<=57?e-48:e-87}function qVe(e,t){return IB(e.charCodeAt(t))<<4|IB(e.charCodeAt(t+1))}function L6(e,t){var n=io(e,t);return _te(n)}function R6(e,t){var n=wte(t);Kr(e,n)}function KVe(e){for(var t=We(e),n=io(e,t),s=!1,i=0;i<n.byteLength;i++)if(n[i]&128){s=!0;break}if(s){var o=new TextDecoder("gbk");return o.decode(n)}else return _te(n)}function ZVe(e,t){for(var n="",s=0,i=t.codePointAt(s++);i!==void 0;i=t.codePointAt(s++))n+=i>127?"?":String.fromCodePoint(i);var o=wte(n);Le(e,o.byteLength),Kr(e,o)}vn(1061,function(e){return e.captionDigest!==void 0},function(e,t){for(var n="",s=0;s<16;s++){var i=We(e);n+=kB[i>>4],n+=kB[i&15]}t.captionDigest=n},function(e,t){for(var n=0;n<16;n++)Le(e,qVe(t.captionDigest,n*2))});vn(1060,function(e){return e.xmpMetadata!==void 0},function(e,t,n){t.xmpMetadata=L6(e,n())},function(e,t){R6(e,t.xmpMetadata)});var bx=ft("Inte","perceptual",{perceptual:"Img ",saturation:"Grp ","relative colorimetric":"Clrm","absolute colorimetric":"AClr"});vn(1082,function(e){return e.printInformation!==void 0},function(e,t){var n,s,i=Ht(e);t.printInformation={printerName:i.printerName||"",renderingIntent:bx.decode((n=i.Inte)!==null&&n!==void 0?n:"Inte.Img ")};var o=t.printInformation;i.PstS!==void 0&&(o.printerManagesColors=i.PstS),i["Nm  "]!==void 0&&(o.printerProfile=i["Nm  "]),i.MpBl!==void 0&&(o.blackPointCompensation=i.MpBl),i.printSixteenBit!==void 0&&(o.printSixteenBit=i.printSixteenBit),i.hardProof!==void 0&&(o.hardProof=i.hardProof),i.printProofSetup&&("Bltn"in i.printProofSetup?o.proofSetup={builtin:i.printProofSetup.Bltn.split(".")[1]}:o.proofSetup={profile:i.printProofSetup.profile,renderingIntent:bx.decode((s=i.printProofSetup.Inte)!==null&&s!==void 0?s:"Inte.Img "),blackPointCompensation:!!i.printProofSetup.MpBl,paperWhite:!!i.printProofSetup.paperWhite})},function(e,t){var n,s,i=t.printInformation,o={};i.printerManagesColors?o.PstS=!0:(i.hardProof!==void 0&&(o.hardProof=!!i.hardProof),o.ClrS="ClrS.RGBC",o["Nm  "]=(n=i.printerProfile)!==null&&n!==void 0?n:"CIE RGB"),o.Inte=bx.encode(i.renderingIntent),i.printerManagesColors||(o.MpBl=!!i.blackPointCompensation),o.printSixteenBit=!!i.printSixteenBit,o.printerName=i.printerName||"",i.proofSetup&&"profile"in i.proofSetup?o.printProofSetup={profile:i.proofSetup.profile||"",Inte:bx.encode(i.proofSetup.renderingIntent),MpBl:!!i.proofSetup.blackPointCompensation,paperWhite:!!i.proofSetup.paperWhite}:o.printProofSetup={Bltn:!((s=i.proofSetup)===null||s===void 0)&&s.builtin?"builtinProof.".concat(i.proofSetup.builtin):"builtinProof.proofCMYK"},Wt(e,"","printOutput",o)});vn(1005,function(e){return e.resolutionInfo!==void 0},function(e,t){var n=ta(e),s=Ge(e),i=Ge(e),o=ta(e),r=Ge(e),l=Ge(e);t.resolutionInfo={horizontalResolution:n,horizontalResolutionUnit:vx[s]||"PPI",widthUnit:yx[i]||"Inches",verticalResolution:o,verticalResolutionUnit:vx[r]||"PPI",heightUnit:yx[l]||"Inches"}},function(e,t){var n=t.resolutionInfo;da(e,n.horizontalResolution||0),_e(e,Math.max(1,vx.indexOf(n.horizontalResolutionUnit))),_e(e,Math.max(1,yx.indexOf(n.widthUnit))),da(e,n.verticalResolution||0),_e(e,Math.max(1,vx.indexOf(n.verticalResolutionUnit))),_e(e,Math.max(1,yx.indexOf(n.heightUnit)))});var jB=["centered","size to fit","user defined"];vn(1062,function(e){return e.printScale!==void 0},function(e,t){t.printScale={style:jB[Kt(e)],x:Rr(e),y:Rr(e),scale:Rr(e)}},function(e,t){var n=t.printScale,s=n.style,i=n.x,o=n.y,r=n.scale;ln(e,Math.max(0,jB.indexOf(s))),Or(e,i||0),Or(e,o||0),Or(e,r||0)});vn(1006,function(e){return e.alphaChannelNames!==void 0},function(e,t,n){if(t.alphaChannelNames)Ye(e,n());else for(t.alphaChannelNames=[];n()>0;){var s=KVe(e);t.alphaChannelNames.push(s)}},function(e,t){for(var n=0,s=t.alphaChannelNames;n<s.length;n++){var i=s[n];ZVe(e,i)}});vn(1045,function(e){return e.alphaChannelNames!==void 0},function(e,t,n){for(t.alphaChannelNames=[];n()>0;)t.alphaChannelNames.push(hi(e))},function(e,t){for(var n=0,s=t.alphaChannelNames;n<s.length;n++){var i=s[n];jh(e,i)}});vn(1053,function(e){return e.alphaIdentifiers!==void 0},function(e,t,n){for(t.alphaIdentifiers=[];n()>=4;)t.alphaIdentifiers.push(Oe(e))},function(e,t){for(var n=0,s=t.alphaIdentifiers;n<s.length;n++){var i=s[n];ze(e,i)}});vn(1010,function(e){return e.backgroundColor!==void 0},function(e,t){return t.backgroundColor=oi(e)},function(e,t){return li(e,t.backgroundColor)});vn(1037,function(e){return e.globalAngle!==void 0},function(e,t){return t.globalAngle=et(e)},function(e,t){return lt(e,t.globalAngle)});vn(1049,function(e){return e.globalAltitude!==void 0},function(e,t){return t.globalAltitude=Oe(e)},function(e,t){return ze(e,t.globalAltitude)});vn(1011,function(e){return e.printFlags!==void 0},function(e,t){t.printFlags={labels:!!We(e),cropMarks:!!We(e),colorBars:!!We(e),registrationMarks:!!We(e),negative:!!We(e),flip:!!We(e),interpolate:!!We(e),caption:!!We(e),printFlags:!!We(e)}},function(e,t){var n=t.printFlags;Le(e,n.labels?1:0),Le(e,n.cropMarks?1:0),Le(e,n.colorBars?1:0),Le(e,n.registrationMarks?1:0),Le(e,n.negative?1:0),Le(e,n.flip?1:0),Le(e,n.interpolate?1:0),Le(e,n.caption?1:0),Le(e,n.printFlags?1:0)});vn(1080,function(e){return e.countInformation!==void 0},function(e,t){var n=Ht(e);t.countInformation=n.countGroupList.map(function(s){return{color:{r:s["Rd  "],g:s["Grn "],b:s["Bl  "]},name:s["Nm  "],size:s["Rds "],fontSize:s.fontSize,visible:s.Vsbl,points:s.countObjectList.map(function(i){return{x:i["X   "],y:i["Y   "]}})}})},function(e,t){var n={Vrsn:1,countGroupList:t.countInformation.map(function(s){return{"Rd  ":s.color.r,"Grn ":s.color.g,"Bl  ":s.color.b,"Nm  ":s.name,"Rds ":s.size,fontSize:s.fontSize,Vsbl:s.visible,countObjectList:s.points.map(function(i){return{"X   ":i.x,"Y   ":i.y}})}})};Wt(e,"","Cnt ",n)});vn(1024,function(e){return e.layerState!==void 0},function(e,t){return t.layerState=Ge(e)},function(e,t){return _e(e,t.layerState)});vn(1026,function(e){return e.layersGroup!==void 0},function(e,t,n){for(t.layersGroup=[];n()>0;)t.layersGroup.push(Ge(e))},function(e,t){for(var n=0,s=t.layersGroup;n<s.length;n++){var i=s[n];_e(e,i)}});vn(1072,function(e){return e.layerGroupsEnabledId!==void 0},function(e,t,n){for(t.layerGroupsEnabledId=[];n()>0;)t.layerGroupsEnabledId.push(We(e))},function(e,t){for(var n=0,s=t.layerGroupsEnabledId;n<s.length;n++){var i=s[n];Le(e,i)}});vn(1069,function(e){return e.layerSelectionIds!==void 0},function(e,t){var n=Ge(e);for(t.layerSelectionIds=[];n--;)t.layerSelectionIds.push(Oe(e))},function(e,t){_e(e,t.layerSelectionIds.length);for(var n=0,s=t.layerSelectionIds;n<s.length;n++){var i=s[n];ze(e,i)}});vn(1032,function(e){return e.gridAndGuidesInformation!==void 0},function(e,t){var n=Oe(e),s=Oe(e),i=Oe(e),o=Oe(e);if(n!==1)throw new Error("Invalid 1032 resource version: ".concat(n));t.gridAndGuidesInformation={grid:{horizontal:s,vertical:i},guides:[]};for(var r=0;r<o;r++)t.gridAndGuidesInformation.guides.push({location:Oe(e)/32,direction:We(e)?"horizontal":"vertical"})},function(e,t){var n=t.gridAndGuidesInformation,s=n.grid||{horizontal:18*32,vertical:18*32},i=n.guides||[];ze(e,1),ze(e,s.horizontal),ze(e,s.vertical),ze(e,i.length);for(var o=0,r=i;o<r.length;o++){var l=r[o];ze(e,l.location*32),Le(e,l.direction==="horizontal"?1:0)}});vn(1065,function(e){return e.layerComps!==void 0},function(e,t){var n=Ht(e,!0);t.layerComps={list:[]};for(var s=0,i=n.list;s<i.length;s++){var o=i[s];t.layerComps.list.push({id:o.compID,name:o["Nm  "],capturedInfo:o.capturedInfo}),"comment"in o&&(t.layerComps.list[t.layerComps.list.length-1].comment=o.comment)}"lastAppliedComp"in n&&(t.layerComps.lastApplied=n.lastAppliedComp)},function(e,t){for(var n=t.layerComps,s={list:[]},i=0,o=n.list;i<o.length;i++){var r=o[i],l={};l._classID="Comp",l["Nm  "]=r.name,"comment"in r&&(l.comment=r.comment),l.compID=r.id,l.capturedInfo=r.capturedInfo,s.list.push(l)}"lastApplied"in n&&(s.lastAppliedComp=n.lastApplied),Wt(e,"","CompList",s)});var EB=["normal",void 0,void 0,void 0,void 0,void 0,void 0,"multiply","screen",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,"difference"];vn(1078,function(e){return e.onionSkins!==void 0},function(e,t){var n=Ht(e);t.onionSkins={enabled:n.enab,framesBefore:n.numBefore,framesAfter:n.numAfter,frameSpacing:n.Spcn,minOpacity:n.minOpacity/100,maxOpacity:n.maxOpacity/100,blendMode:EB[n.BlnM]||"normal"}},function(e,t){var n=t.onionSkins,s={Vrsn:1,enab:n.enabled,numBefore:n.framesBefore,numAfter:n.framesAfter,Spcn:n.frameSpacing,minOpacity:n.minOpacity*100|0,maxOpacity:n.maxOpacity*100|0,BlnM:Math.max(0,EB.indexOf(n.blendMode))};Wt(e,"","null",s)});vn(1075,function(e){return e.timelineInformation!==void 0},function(e,t){var n,s,i=Ht(e);t.timelineInformation={enabled:i.enab,frameStep:fo(i.frameStep),frameRate:i.frameRate,time:fo(i.time),duration:fo(i.duration),workInTime:fo(i.workInTime),workOutTime:fo(i.workOutTime),repeats:i.LCnt,hasMotion:i.hasMotion,globalTracks:Tte(i.globalTrackList,!!e.logMissingFeatures)},!((s=(n=i.audioClipGroupList)===null||n===void 0?void 0:n.audioClipGroupList)===null||s===void 0)&&s.length&&(t.timelineInformation.audioClipGroups=i.audioClipGroupList.audioClipGroupList.map(function(o){return{id:o.groupID,muted:o.muted,audioClips:o.audioClipList.map(function(r){var l=r.clipID,c=r.timeScope,d=r.muted,u=r.audioLevel,p=r.frameReader;return{id:l,start:fo(c.Strt),duration:fo(c.duration),inTime:fo(c.inTime),outTime:fo(c.outTime),muted:d,audioLevel:u,frameReader:{type:p.frameReaderType,mediaDescriptor:p.mediaDescriptor,link:{name:p["Lnk "]["Nm  "],fullPath:p["Lnk "].fullPath,relativePath:p["Lnk "].relPath}}}})}}))},function(e,t){var n,s=t.timelineInformation,i={Vrsn:1,enab:s.enabled,frameStep:s.frameStep,frameRate:s.frameRate,time:s.time,duration:s.duration,workInTime:s.workInTime,workOutTime:s.workOutTime,LCnt:s.repeats,globalTrackList:Dte(s.globalTracks),audioClipGroupList:{audioClipGroupList:(n=s.audioClipGroups)===null||n===void 0?void 0:n.map(function(o){return{groupID:o.id,muted:o.muted,audioClipList:o.audioClips.map(function(r){return{clipID:r.id,timeScope:{Vrsn:1,Strt:r.start,duration:r.duration,inTime:r.inTime,outTime:r.outTime},frameReader:{frameReaderType:r.frameReader.type,descVersion:1,"Lnk ":{descVersion:1,"Nm  ":r.frameReader.link.name,fullPath:r.frameReader.link.fullPath,relPath:r.frameReader.link.relativePath},mediaDescriptor:r.frameReader.mediaDescriptor},muted:r.muted,audioLevel:r.audioLevel}})}})},hasMotion:s.hasMotion};Wt(e,"","null",i,"anim")});vn(1076,function(e){return e.sheetDisclosure!==void 0},function(e,t){var n=Ht(e);t.sheetDisclosure={},n.sheetTimelineOptions&&(t.sheetDisclosure.sheetTimelineOptions=n.sheetTimelineOptions.map(function(s){return{sheetID:s.sheetID,sheetDisclosed:s.sheetDisclosed,lightsDisclosed:s.lightsDisclosed,meshesDisclosed:s.meshesDisclosed,materialsDisclosed:s.materialsDisclosed}}))},function(e,t){var n=t.sheetDisclosure,s={Vrsn:1};n.sheetTimelineOptions&&(s.sheetTimelineOptions=n.sheetTimelineOptions.map(function(i){return{Vrsn:2,sheetID:i.sheetID,sheetDisclosed:i.sheetDisclosed,lightsDisclosed:i.lightsDisclosed,meshesDisclosed:i.meshesDisclosed,materialsDisclosed:i.materialsDisclosed}})),Wt(e,"","null",s)});vn(1054,function(e){return e.urlsList!==void 0},function(e,t){var n=Oe(e);t.urlsList=[];for(var s=0;s<n;s++){var i=Ln(e);if(i!=="slic"&&e.throwForMissingFeatures)throw new Error("Unknown long");var o=Oe(e),r=hi(e);t.urlsList.push({id:o,url:r,ref:"slice"})}},function(e,t){var n=t.urlsList;ze(e,n.length);for(var s=0;s<n.length;s++)ht(e,"slic"),ze(e,n[s].id),ua(e,n[s].url)});function AB(e){return{"Top ":e.top,Left:e.left,Btom:e.bottom,Rght:e.right}}function PB(e){return{top:e["Top "],left:e.Left,bottom:e.Btom,right:e.Rght}}function xx(e,t){return e[Math.max(0,Math.min(e.length-1,t))]}var TB=["autoGenerated","layer","userGenerated"],DB=["noImage","image"],Cx=["default"];vn(1050,function(e){return e.slices?e.slices.length:0},function(e,t){var n=Oe(e);if(n===6){t.slices||(t.slices=[]);var s=et(e),i=et(e),o=et(e),r=et(e),l=hi(e),c=Oe(e);t.slices.push({bounds:{top:s,left:i,bottom:o,right:r},groupName:l,slices:[]});for(var d=t.slices[t.slices.length-1].slices,u=0;u<c;u++){var p=Oe(e),m=Oe(e),f=xx(TB,Oe(e)),g=f=="layer"?Oe(e):0,v=hi(e),b=xx(DB,Oe(e)),C=et(e),y=et(e),x=et(e),w=et(e),_=hi(e),S=hi(e),I=hi(e),k=hi(e),E=!!We(e),j=hi(e),P=xx(Cx,Oe(e)),D=xx(Cx,Oe(e)),O=We(e),N=We(e),F=We(e),X=We(e),L=O+N+F+X===0?"none":O===0?"matte":"color";d.push({id:p,groupId:m,origin:f,associatedLayerId:g,name:v,target:S,message:I,altTag:k,cellTextIsHTML:E,cellText:j,horizontalAlignment:P,verticalAlignment:D,type:b,url:_,bounds:{top:y,left:C,bottom:w,right:x},backgroundColorType:L,backgroundColor:{r:N,g:F,b:X,a:O}})}var V=Ht(e);V.slices.forEach(function(K){var U=d.find(function(Z){return K.sliceID==Z.id});U&&(U.topOutset=K.topOutset,U.leftOutset=K.leftOutset,U.bottomOutset=K.bottomOutset,U.rightOutset=K.rightOutset)})}else if(n===7||n===8){var V=Ht(e);t.slices||(t.slices=[]),t.slices.push({groupName:V.baseName,bounds:PB(V.bounds),slices:V.slices.map(function(U){return nf(nf({},U["Nm  "]?{name:U["Nm  "]}:{}),{id:U.sliceID,groupId:U.groupID,associatedLayerId:0,origin:xB.decode(U.origin),type:vB.decode(U.Type),bounds:PB(U.bounds),url:U.url,target:U.null,message:U.Msge,altTag:U.altTag,cellTextIsHTML:U.cellTextIsHTML,cellText:U.cellText,horizontalAlignment:yB.decode(U.horzAlign),verticalAlignment:bB.decode(U.vertAlign),backgroundColorType:CB.decode(U.bgColorType),backgroundColor:U.bgColor?{r:U.bgColor["Rd  "],g:U.bgColor["Grn "],b:U.bgColor["Bl  "],a:U.bgColor.alpha}:{r:0,g:0,b:0,a:0},topOutset:U.topOutset||0,leftOutset:U.leftOutset||0,bottomOutset:U.bottomOutset||0,rightOutset:U.rightOutset||0})})})}else throw new Error("Invalid slices version (".concat(n,")"))},function(e,t,n){var s=t.slices[n],i=s.bounds,o=s.groupName,r=s.slices;ze(e,6),lt(e,i.top),lt(e,i.left),lt(e,i.bottom),lt(e,i.right),ua(e,o),ze(e,r.length);for(var l=0;l<r.length;l++){var c=r[l],d=c.backgroundColor,u=d.a,p=d.r,m=d.g,f=d.b;c.backgroundColorType==="none"?u=p=m=f=0:c.backgroundColorType==="matte"&&(u=0,p=m=f=255),ze(e,c.id),ze(e,c.groupId),ze(e,TB.indexOf(c.origin)),c.origin==="layer"&&ze(e,c.associatedLayerId),ua(e,c.name||""),ze(e,DB.indexOf(c.type)),lt(e,c.bounds.left),lt(e,c.bounds.top),lt(e,c.bounds.right),lt(e,c.bounds.bottom),ua(e,c.url),ua(e,c.target),ua(e,c.message),ua(e,c.altTag),Le(e,c.cellTextIsHTML?1:0),ua(e,c.cellText),ze(e,Cx.indexOf(c.horizontalAlignment)),ze(e,Cx.indexOf(c.verticalAlignment)),Le(e,u),Le(e,p),Le(e,m),Le(e,f)}var g={bounds:AB(i),slices:[]};r.forEach(function(v){var b=nf(nf({sliceID:v.id,groupID:v.groupId,origin:xB.encode(v.origin),Type:vB.encode(v.type),bounds:AB(v.bounds)},v.name?{"Nm  ":v.name}:{}),{url:v.url,null:v.target,Msge:v.message,altTag:v.altTag,cellTextIsHTML:v.cellTextIsHTML,cellText:v.cellText,horzAlign:yB.encode(v.horizontalAlignment),vertAlign:bB.encode(v.verticalAlignment),bgColorType:CB.encode(v.backgroundColorType)});if(v.backgroundColorType==="color"){var C=v.backgroundColor,y=C.r,x=C.g,w=C.b,_=C.a;b.bgColor={"Rd  ":y,"Grn ":x,"Bl  ":w,alpha:_}}b.topOutset=v.topOutset||0,b.leftOutset=v.leftOutset||0,b.bottomOutset=v.bottomOutset||0,b.rightOutset=v.rightOutset||0,g.slices.push(b)}),Wt(e,"","null",g,"slices")});vn(1064,function(e){return e.pixelAspectRatio!==void 0},function(e,t){if(Oe(e)>2)throw new Error("Invalid pixelAspectRatio version");t.pixelAspectRatio={aspect:er(e)}},function(e,t){ze(e,2),tr(e,t.pixelAspectRatio.aspect)});vn(1041,function(e){return e.iccUntaggedProfile!==void 0},function(e,t){t.iccUntaggedProfile=!!We(e)},function(e,t){Le(e,t.iccUntaggedProfile?1:0)});vn(1044,function(e){return e.idsSeedNumber!==void 0},function(e,t){return t.idsSeedNumber=Oe(e)},function(e,t){return ze(e,t.idsSeedNumber)});vn(1036,function(e){return e.thumbnail!==void 0||e.thumbnailRaw!==void 0},function(e,t,n){var s=Oe(e),i=Oe(e),o=Oe(e);Oe(e),Oe(e),Oe(e);var r=Ge(e),l=Ge(e);if(s!==1||r!==24||l!==1){e.logMissingFeatures&&e.log("Invalid thumbnail data (format: ".concat(s,", bitsPerPixel: ").concat(r,", planes: ").concat(l,")")),Ye(e,n());return}var c=n(),d=io(e,c);e.useRawThumbnail?t.thumbnailRaw={width:i,height:o,data:d}:d.byteLength&&(t.thumbnail=Cte(d))},function(e,t){var n,s=0,i=0,o=new Uint8Array(0);if(t.thumbnailRaw)s=t.thumbnailRaw.width,i=t.thumbnailRaw.height,o=t.thumbnailRaw.data;else try{var r=(n=t.thumbnail.toDataURL("image/jpeg",1))===null||n===void 0?void 0:n.substring(23);r&&(o=BC.toByteArray(r),s=t.thumbnail.width,i=t.thumbnail.height)}catch{}var l=24,c=Math.floor((s*l+31)/32)*4,d=1,u=c*i*d,p=o.length;ze(e,1),ze(e,s),ze(e,i),ze(e,c),ze(e,u),ze(e,p),_e(e,l),_e(e,d),Kr(e,o)});vn(1057,function(e){return e.versionInfo!==void 0},function(e,t,n){var s=Oe(e);if(s!==1)throw new Error("Invalid versionInfo version");t.versionInfo={hasRealMergedData:!!We(e),writerName:hi(e),readerName:hi(e),fileVersion:Oe(e)},Ye(e,n())},function(e,t){var n=t.versionInfo;ze(e,1),Le(e,n.hasRealMergedData?1:0),ua(e,n.writerName),ua(e,n.readerName),ze(e,n.fileVersion)});vn(7e3,function(e){return e.imageReadyVariables!==void 0},function(e,t,n){t.imageReadyVariables=L6(e,n())},function(e,t){R6(e,t.imageReadyVariables)});vn(7001,function(e){return e.imageReadyDataSets!==void 0},function(e,t,n){t.imageReadyDataSets=L6(e,n())},function(e,t){R6(e,t.imageReadyDataSets)});vn(1088,function(e){return e.pathSelectionState!==void 0},function(e,t,n){var s=Ht(e);t.pathSelectionState=s.null},function(e,t){var n={null:t.pathSelectionState};Wt(e,"","null",n)});var MB=ft("FrmD","",{auto:"Auto",none:"None",dispose:"Disp"});vn(4e3,function(e){return e.animations!==void 0},function(e,t,n){var s=Ln(e);if(s==="mani")kh(e,"IRFR"),Ih(e,1,function(o){for(var r=function(){kh(e,"8BIM");var l=Ln(e);Ih(e,1,function(c){if(l==="AnDs"){var d=Ht(e);t.animations={frames:d.FrIn.map(function(p){return{id:p.FrID,delay:(p.FrDl||0)/100,dispose:p.FrDs?MB.decode(p.FrDs):"auto"}}),animations:d.FSts.map(function(p){return{id:p.FsID,frames:p.FsFr,repeats:p.LCnt,activeFrame:p.AFrm||0}})}}else if(l==="Roll"){var u=io(e,c());e.logDevFeatures&&e.log("#4000 Roll",u)}else e.logMissingFeatures&&e.log("Unhandled subsection in #4000",l)})};o()>0;)r()});else if(s==="mopt"){var i=io(e,n());e.logDevFeatures&&e.log("#4000 mopt",i)}else e.logMissingFeatures&&e.log("Unhandled key in #4000:",s)},function(e,t){t.animations&&(ht(e,"mani"),ht(e,"IRFR"),Ti(e,1,function(){ht(e,"8BIM"),ht(e,"AnDs"),Ti(e,1,function(){for(var n={FrIn:[],FSts:[]},s=0;s<t.animations.frames.length;s++){var i=t.animations.frames[s],o={FrID:i.id};i.delay&&(o.FrDl=i.delay*100|0),o.FrDs=MB.encode(i.dispose),n.FrIn.push(o)}for(var s=0;s<t.animations.animations.length;s++){var r=t.animations.animations[s],l={FsID:r.id,AFrm:r.activeFrame|0,FsFr:r.frames,LCnt:r.repeats|0};n.FSts.push(l)}Wt(e,"","null",n)})}))});function LB(e){for(var t=e.width*e.height*4,n=0;n<t;n+=4)e.data[n+1]=e.data[n],e.data[n+2]=e.data[n]}function TT(e,t){if(e.strict)throw new Error(t);e.debug&&e.log(t)}function We(e){return e.offset+=1,e.view.getUint8(e.offset-1)}function Kt(e){return e.offset+=2,e.view.getInt16(e.offset-2,!1)}function Ge(e){return e.offset+=2,e.view.getUint16(e.offset-2,!1)}function XVe(e){return e.offset+=2,e.view.getUint16(e.offset-2,!0)}function et(e){return e.offset+=4,e.view.getInt32(e.offset-4,!1)}function RB(e){return e.offset+=4,e.view.getInt32(e.offset-4,!0)}function Oe(e){return e.offset+=4,e.view.getUint32(e.offset-4,!1)}function Rr(e){return e.offset+=4,e.view.getFloat32(e.offset-4,!1)}function er(e){return e.offset+=8,e.view.getFloat64(e.offset-8,!1)}function ta(e){return et(e)/65536}function jr(e){return et(e)/(1<<24)}function io(e,t){var n=e.view.byteOffset+e.offset;if(e.offset+=t,n+t>e.view.buffer.byteLength){if(TT(e,"Reading bytes exceeding buffer length"),t>100*1024*1024)throw new Error("Reading past end of file");var s=new Uint8Array(t),i=Math.min(t,e.view.byteLength-n);return i>0&&s.set(new Uint8Array(e.view.buffer,n,i)),s}else return new Uint8Array(e.view.buffer,n,t)}function Ln(e){return bne(e,4)}function YVe(e,t){var n=String.fromCharCode(e.view.getUint8(t))+String.fromCharCode(e.view.getUint8(t+1))+String.fromCharCode(e.view.getUint8(t+2))+String.fromCharCode(e.view.getUint8(t+3));return n=="8BIM"||n=="8B64"}function uh(e,t){for(var n=We(e),s=n?bne(e,n):"";++n%t;)e.offset++;return s}function hi(e){var t=Oe(e);return O6(e,t)}function O6(e,t){for(var n="";t--;){var s=Ge(e);(s||t>0)&&(n+=String.fromCharCode(s))}return n}function QVe(e,t){for(var n="";t--;){var s=XVe(e);(s||t>0)&&(n+=String.fromCharCode(s))}return n}function N6(e,t){for(var n="";t--;)n+=String.fromCharCode(We(e));return n}function Ye(e,t){e.offset+=t}function kh(e,t,n){var s=e.offset,i=Ln(e);if(i!==t&&i!==n)throw new Error("Invalid signature: '".concat(i,"' at 0x").concat(s.toString(16)))}function bne(e,t){for(var n=io(e,t),s="",i=0;i<n.length;i++)s+=String.fromCharCode(n[i]);return s}function xne(e,t,n){var s,i,o=n.layersGroup,r=o===void 0?[]:o,l=n.layerGroupsEnabledId,c=l===void 0?[]:l,d=Kt(e);d<0&&(e.globalAlpha=!0,d=-d);for(var u=[],p=[],m=0;m<d;m++){var f=JVe(e,t,n),g=f.layer,v=f.channels;r[m]!==void 0&&(g.linkGroup=r[m]),c[m]!==void 0&&(g.linkGroupEnabled=!!c[m]),u.push(g),p.push(v)}if(!e.skipLayerImageData)for(var m=0;m<d;m++)n$e(e,t,u[m],p[m]);t.children||(t.children=[]);for(var b=[t],m=u.length-1;m>=0;m--){var C=u[m],y=C.sectionDivider?C.sectionDivider.type:0;y===1||y===2?(C.opened=y===1,C.children=[],!((s=C.sectionDivider)===null||s===void 0)&&s.key&&(C.blendMode=(i=zf[C.sectionDivider.key])!==null&&i!==void 0?i:C.blendMode),b[b.length-1].children.unshift(C),b.push(C)):y===3?b.pop():b[b.length-1].children.unshift(C)}}function JVe(e,t,n){var s={};s.top=et(e),s.left=et(e),s.bottom=et(e),s.right=et(e);for(var i=Ge(e),o=[],r=0;r<i;r++){var l=Kt(e),c=Oe(e);if(e.large){if(c!==0)throw new Error("Sizes larger than 4GB are not supported");c=Oe(e)}o.push({id:l,length:c})}kh(e,"8BIM");var d=Ln(e);if(!zf[d])throw new Error("Invalid blend mode: '".concat(d,"'"));s.blendMode=zf[d],s.opacity=We(e)/255,s.clipping=We(e)===1;var u=We(e);return s.transparencyProtected=(u&1)!==0,s.hidden=(u&2)!==0,u&32&&(s.effectsOpen=!0),Ye(e,1),Ih(e,1,function(p){e$e(e,s);var m=t$e(e);for(m&&(s.blendingRanges=m),s.name=uh(e,1);p()>4&&!YVe(e,e.offset);)e.offset++;for(;p()>=12;)s$e(e,s,t,n);Ye(e,p())}),{layer:s,channels:o}}function e$e(e,t){return Ih(e,1,function(n){if(n()){var s={};t.mask=s,s.top=et(e),s.left=et(e),s.bottom=et(e),s.right=et(e),s.defaultColor=We(e);var i=We(e);if(s.positionRelativeToLayer=(i&1)!==0,s.disabled=(i&2)!==0,s.fromVectorData=(i&8)!==0,n()>=18){var o={};t.realMask=o;var r=We(e);o.positionRelativeToLayer=(r&1)!==0,o.disabled=(r&2)!==0,o.fromVectorData=(r&8)!==0,o.defaultColor=We(e),o.top=et(e),o.left=et(e),o.bottom=et(e),o.right=et(e)}if(i&16){var l=We(e);l&1&&(s.userMaskDensity=We(e)/255),l&2&&(s.userMaskFeather=er(e)),l&4&&(s.vectorMaskDensity=We(e)/255),l&8&&(s.vectorMaskFeather=er(e))}Ye(e,n())}})}function wx(e){return[We(e),We(e),We(e),We(e)]}function t$e(e){return Ih(e,1,function(t){for(var n=wx(e),s=wx(e),i=[];t()>0;){var o=wx(e),r=wx(e);i.push({sourceRange:o,destRange:r})}return{compositeGrayBlendSource:n,compositeGraphBlendDestinationRange:s,ranges:i}})}function n$e(e,t,n,s){var i,o,r,l,c=(n.right||0)-(n.left||0),d=(n.bottom||0)-(n.top||0),u=t.colorMode===4,p;if(c&&d)if(u){if(t.bitsPerChannel!==8)throw new Error("bitsPerChannel Not supproted");p={width:c,height:d,data:new Uint8ClampedArray(c*d*5)};for(var m=4;m<p.data.byteLength;m+=5)p.data[m]=255}else p=NB(c,d,(i=t.bitsPerChannel)!==null&&i!==void 0?i:8),eB(p);for(var f=0,g=s;f<g.length;f++){var v=g[f];if(v.length!==0){if(v.length<2)throw new Error("Invalid channel length");var b=e.offset,C=Ge(e);if(C>3&&(e.offset-=1,C=Ge(e)),C>3&&(e.offset-=3,C=Ge(e)),C>3)throw new Error("Invalid compression: ".concat(C));if(v.id===-2||v.id===-3){var y=v.id===-2?n.mask:n.realMask;if(!y)throw new Error("Missing layer ".concat(v.id===-2?"mask":"real mask"," data"));var x=(y.right||0)-(y.left||0),w=(y.bottom||0)-(y.top||0);if(x<0||w<0||x>3e4||w>3e4)throw new Error("Invalid mask size");if(x&&w){var _=NB(x,w,(o=t.bitsPerChannel)!==null&&o!==void 0?o:8);eB(_),e.offset,OB(e,v.length,_,C,x,w,(r=t.bitsPerChannel)!==null&&r!==void 0?r:8,0,e.large,4),LB(_),e.useImageData?y.imageData=_:y.canvas=AT(_)}}else{var S=yte(v.id,u),I=p;if(S<0&&(I=void 0,e.throwForMissingFeatures))throw new Error("Channel not supported: ".concat(v.id));OB(e,v.length,I,C,c,d,(l=t.bitsPerChannel)!==null&&l!==void 0?l:8,S,e.large,u?5:4),e.offset=b+v.length,I&&t.colorMode===1&&LB(I)}}}if(p){if(u){var k=p;p=FS(k.width,k.height),i$e(k,p)}e.useImageData?n.imageData=p:n.canvas=AT(p)}}function OB(e,t,n,s,i,o,r,l,c,d){if(s===0)a$e(e,n,i,o,r,d,l);else if(s===1)r$e(e,n,i,o,r,d,[l],c);else if(s===2)FB(e,t,n,i,o,r,d,l,!1);else if(s===3)FB(e,t,n,i,o,r,d,l,!0);else throw new Error("Invalid Compression type: ".concat(s))}function s$e(e,t,n,s){var i=Ln(e);if(i!=="8BIM"&&i!=="8B64")throw new Error("Invalid signature: '".concat(i,"' at 0x").concat((e.offset-4).toString(16)));var o=Ln(e),r=i==="8B64"||e.large&&vte.indexOf(o)!==-1;Ih(e,2,function(l){var c=WC[o];if(c)try{c.read(e,t,l,n,s)}catch(d){if(e.throwForMissingFeatures)throw d}else e.logMissingFeatures&&e.log("Unhandled additional info: ".concat(o)),Ye(e,l());l()&&(e.logMissingFeatures&&e.log("Unread ".concat(l()," bytes left for additional info: ").concat(o)),Ye(e,l()))},!1,r)}function NB(e,t,n,s){if(s===void 0&&(s=4),n===1||n===8)return s===4?FS(e,t):{width:e,height:t,data:new Uint8ClampedArray(e*t*s)};if(n===16)return{width:e,height:t,data:new Uint16Array(e*t*s)};if(n===32)return{width:e,height:t,data:new Float32Array(e*t*s)};throw new Error("Invalid bitDepth (".concat(n,")"))}function i$e(e,t,n){for(var s=t.width*t.height*4,i=e.data,o=t.data,r=0,l=0;l<s;r+=5,l+=4){var c=i[r],d=i[r+1],u=i[r+2],p=i[r+3];o[l]=(c*p|0)/255|0,o[l+1]=(d*p|0)/255|0,o[l+2]=(u*p|0)/255|0,o[l+3]=i[r+4]}}function o$e(e,t){if(e.byteLength/e.length!==t.byteLength/t.length)throw new Error("Invalid array types")}function Cne(e,t){if(t===8)return e;if(t===16)if(e.byteOffset%2){var n=new Uint16Array(e.byteLength/2);return new Uint8Array(n.buffer,n.byteOffset,n.byteLength).set(e),n}else return new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2);else if(t===32)if(e.byteOffset%4){var n=new Float32Array(e.byteLength/4);return new Uint8Array(n.buffer,n.byteOffset,n.byteLength).set(e),n}else return new Float32Array(e.buffer,e.byteOffset,e.byteLength/4);else throw new Error("Invalid bitDepth (".concat(t,")"))}function DT(e,t,n,s){o$e(e.data,t);for(var i=e.width*e.height,o=e.data,r=0,l=n|0;r<i;r++,l=l+s|0)o[l]=t[r]}function a$e(e,t,n,s,i,o,r){var l=io(e,n*s*Math.floor(i/8));if(i==32)for(var c=0;c<l.byteLength;c+=4){var d=l[c+0],u=l[c+1],p=l[c+2],m=l[c+3];l[c+0]=m,l[c+1]=p,l[c+2]=u,l[c+3]=d}var f=Cne(l,i);t&&r<o&&DT(t,f,r,o)}function yE(e,t,n,s){for(var i=0;i<n;i++)for(var o=i*t,r=1,l=o+1;r<t;r++,l++)e[l]=(e[l-1]+e[l])%s}function FB(e,t,n,s,i,o,r,l,c){var d=io(e,t),u=MVe(d);if(n&&l<r){var p=Cne(u,o);if(o===8)c&&yE(u,s,i,256),DT(n,u,l,r);else if(o===16)c&&yE(p,s,i,65536),DT(n,p,l,r);else if(o===32){c&&yE(u,s*4,i,256);for(var m=l,f=new Uint32Array(n.data.buffer,n.data.byteOffset,n.data.length),g=0;g<i;g++)for(var v=s*4*g,b=0;b<s;b++,v++,m+=r){var C=v+s,y=C+s,x=y+s;f[m]=(u[v]<<24|u[C]<<16|u[y]<<8|u[x])>>>0}}else throw new Error("Invalid bitDepth")}}function r$e(e,t,n,s,i,o,r,l){var c=t&&t.data,d;if(l){d=new Uint32Array(r.length*s);for(var u=0,p=0;u<r.length;u++)for(var m=0;m<s;m++,p++)d[p]=Oe(e)}else{d=new Uint16Array(r.length*s);for(var u=0,p=0;u<r.length;u++)for(var m=0;m<s;m++,p++)d[p]=Ge(e)}if(i!==1&&i!==8)throw new Error("Invalid bit depth (".concat(i,")"));for(var f=o-1|0,g=0,p=0;g<r.length;g++){var v=r[g]|0,b=g>f||v>f;if(!c||b)for(var m=0;m<s;m++,p++)Ye(e,d[p]);else for(var m=0,C=v|0;m<s;m++,p++)for(var y=d[p],x=io(e,y),w=0,_=0;w<y;w++){var S=x[w];if(S>128){var I=x[++w];S=256-S|0;for(var k=0;k<=S&&_<n;k=k+1|0,_=_+1|0)c[C]=I,C=C+o|0}else if(S<128)for(var k=0;k<=S&&_<n;k=k+1|0,_=_+1|0)c[C]=x[++w],C=C+o|0}}}function Ih(e,t,n,s,i){s===void 0&&(s=!0),i===void 0&&(i=!1);var o=Oe(e);if(i){if(o!==0)throw new Error("Sizes larger than 4GB are not supported");o=Oe(e)}if(!(o<=0&&s)){var r=e.offset+o;if(r>e.view.byteLength)throw new Error("Section exceeds file size");var l=n(function(){return r-e.offset});for(e.offset!==r&&(e.offset>r?TT(e,"Exceeded section limits"):TT(e,"Unread section data"));r%t;)r++;return e.offset=r,l}}function oi(e){var t=Ge(e);switch(t){case 0:{var n=Ge(e)/257,s=Ge(e)/257,i=Ge(e)/257;return Ye(e,2),{r:n,g:s,b:i}}case 1:{var o=Ge(e)/65535,r=Ge(e)/65535,i=Ge(e)/65535;return Ye(e,2),{h:o,s:r,b:i}}case 2:{var l=Ge(e)/257,c=Ge(e)/257,d=Ge(e)/257,u=Ge(e)/257;return{c:l,m:c,y:d,k:u}}case 7:{var p=Kt(e)/1e4,m=Kt(e),f=Kt(e),g=m<0?m/12800:m/12700,i=f<0?f/12800:f/12700;return Ye(e,2),{l:p,a:g,b:i}}case 8:{var u=Ge(e)*255/1e4;return Ye(e,6),{k:u}}default:throw new Error("Invalid color space")}}var wne=[void 0,"outer bevel","inner bevel","emboss","pillow emboss","stroke emboss"];function yp(e){return kh(e,"8BIM"),zf[Ln(e)]||"normal"}function Vp(e,t){ht(e,"8BIM"),ht(e,OS[t]||"norm")}function bp(e){return We(e)/255}function $p(e,t){Le(e,Math.round(t*255)|0)}function l$e(e){var t=Ge(e);if(t!==0)throw new Error("Invalid effects layer version: ".concat(t));for(var n=Ge(e),s={},i=0;i<n;i++){kh(e,"8BIM");var o=Ln(e);switch(o){case"cmnS":{var r=Oe(e),l=Oe(e),c=!!We(e);if(Ye(e,2),r!==7||l!==0||!c)throw new Error("Invalid effects common state");break}case"dsdw":case"isdw":{var d=Oe(e),u=Oe(e);if(d!==41&&d!==51)throw new Error("Invalid shadow size: ".concat(d));if(u!==0&&u!==2)throw new Error("Invalid shadow version: ".concat(u));var r=ta(e);ta(e);var p=ta(e),m=ta(e),f=oi(e),g=yp(e),v=!!We(e),b=!!We(e),C=bp(e);d>=51&&oi(e);var y={size:{units:"Pixels",value:r},distance:{units:"Pixels",value:m},angle:p,color:f,blendMode:g,enabled:v,useGlobalLight:b,opacity:C};o==="dsdw"?s.dropShadow=[y]:s.innerShadow=[y];break}case"oglw":{var d=Oe(e),x=Oe(e);if(d!==32&&d!==42)throw new Error("Invalid outer glow size: ".concat(d));if(x!==0&&x!==2)throw new Error("Invalid outer glow version: ".concat(x));var r=ta(e);ta(e);var f=oi(e),g=yp(e),v=!!We(e),C=bp(e);d>=42&&oi(e),s.outerGlow={size:{units:"Pixels",value:r},color:f,blendMode:g,enabled:v,opacity:C};break}case"iglw":{var d=Oe(e),w=Oe(e);if(d!==32&&d!==43)throw new Error("Invalid inner glow size: ".concat(d));if(w!==0&&w!==2)throw new Error("Invalid inner glow version: ".concat(w));var r=ta(e);ta(e);var f=oi(e),g=yp(e),v=!!We(e),C=bp(e);d>=43&&(We(e),oi(e)),s.innerGlow={size:{units:"Pixels",value:r},color:f,blendMode:g,enabled:v,opacity:C};break}case"bevl":{var d=Oe(e),_=Oe(e);if(d!==58&&d!==78)throw new Error("Invalid bevel size: ".concat(d));if(_!==0&&_!==2)throw new Error("Invalid bevel version: ".concat(_));var p=ta(e),S=ta(e),r=ta(e),I=yp(e),k=yp(e),E=oi(e),j=oi(e),P=wne[We(e)]||"inner bevel",D=bp(e),O=bp(e),v=!!We(e),b=!!We(e),N=We(e)?"down":"up";d>=78&&(oi(e),oi(e)),s.bevel={size:{units:"Pixels",value:r},angle:p,strength:S,highlightBlendMode:I,shadowBlendMode:k,highlightColor:E,shadowColor:j,style:P,highlightOpacity:D,shadowOpacity:O,enabled:v,useGlobalLight:b,direction:N};break}case"sofi":{var r=Oe(e),F=Oe(e);if(r!==34)throw new Error("Invalid effects solid fill info size: ".concat(r));if(F!==2)throw new Error("Invalid effects solid fill info version: ".concat(F));var g=yp(e),f=oi(e),C=bp(e),v=!!We(e);oi(e),s.solidFill=[{blendMode:g,color:f,opacity:C,enabled:v}];break}default:throw new Error("Invalid effect type: '".concat(o,"'"))}}return s}function BB(e,t){var n;ze(e,51),ze(e,2),da(e,t.size&&t.size.value||0),da(e,0),da(e,t.angle||0),da(e,t.distance&&t.distance.value||0),li(e,t.color),Vp(e,t.blendMode),Le(e,t.enabled?1:0),Le(e,t.useGlobalLight?1:0),$p(e,(n=t.opacity)!==null&&n!==void 0?n:1),li(e,t.color)}function c$e(e,t){var n,s,i,o,r,l,c=(n=t.dropShadow)===null||n===void 0?void 0:n[0],d=(s=t.innerShadow)===null||s===void 0?void 0:s[0],u=t.outerGlow,p=t.innerGlow,m=t.bevel,f=(i=t.solidFill)===null||i===void 0?void 0:i[0],g=1;if(c&&g++,d&&g++,u&&g++,p&&g++,m&&g++,f&&g++,_e(e,0),_e(e,g),ht(e,"8BIM"),ht(e,"cmnS"),ze(e,7),ze(e,0),Le(e,1),tn(e,2),c&&(ht(e,"8BIM"),ht(e,"dsdw"),BB(e,c)),d&&(ht(e,"8BIM"),ht(e,"isdw"),BB(e,d)),u&&(ht(e,"8BIM"),ht(e,"oglw"),ze(e,42),ze(e,2),da(e,((o=u.size)===null||o===void 0?void 0:o.value)||0),da(e,0),li(e,u.color),Vp(e,u.blendMode),Le(e,u.enabled?1:0),$p(e,u.opacity||0),li(e,u.color)),p&&(ht(e,"8BIM"),ht(e,"iglw"),ze(e,43),ze(e,2),da(e,((r=p.size)===null||r===void 0?void 0:r.value)||0),da(e,0),li(e,p.color),Vp(e,p.blendMode),Le(e,p.enabled?1:0),$p(e,p.opacity||0),Le(e,0),li(e,p.color)),m){ht(e,"8BIM"),ht(e,"bevl"),ze(e,78),ze(e,2),da(e,m.angle||0),da(e,m.strength||0),da(e,((l=m.size)===null||l===void 0?void 0:l.value)||0),Vp(e,m.highlightBlendMode),Vp(e,m.shadowBlendMode),li(e,m.highlightColor),li(e,m.shadowColor);var v=wne.indexOf(m.style);Le(e,v<=0?1:v),$p(e,m.highlightOpacity||0),$p(e,m.shadowOpacity||0),Le(e,m.enabled?1:0),Le(e,m.useGlobalLight?1:0),Le(e,m.direction==="down"?1:0),li(e,m.highlightColor),li(e,m.shadowColor)}f&&(ht(e,"8BIM"),ht(e,"sofi"),ze(e,34),ze(e,2),Vp(e,f.blendMode),li(e,f.color),$p(e,f.opacity||0),Le(e,f.enabled?1:0),li(e,f.color))}function zB(e){return e===32||e===10||e===13||e===9}function VB(e){return e>=48&&e<=57||e===46||e===45}function _ne(e){var t=0;function n(){for(;t<e.length&&zB(e[t]);)t++}function s(){var y=e[t];return t++,y===92&&(y=e[t],t++),y}function i(){var y="";if(e[t]===41)return t++,y;if(e[t]!==254||e[t+1]!==255)throw new Error("Invalid utf-16 BOM");for(t+=2;t<e.length&&e[t]!==41;){var x=s(),w=s(),_=x<<8|w;y+=String.fromCharCode(_)}return t++,y}var o=null,r=[];function l(y){r.length?(c(y),r.push(y)):(r.push(y),o=y)}function c(y){if(!r.length)throw new Error("Invalid data");var x=r[r.length-1];if(typeof x=="string")r[r.length-2][x]=y,u();else if(Array.isArray(x))x.push(y);else throw new Error("Invalid data")}function d(y){r.length||l({});var x=r[r.length-1];if(x&&typeof x=="string")c(y==="nil"?null:"/".concat(y));else if(x&&typeof x=="object")r.push(y);else throw new Error("Invalid data")}function u(){if(!r.length)throw new Error("Invalid data");r.pop()}n();for(var p=e.length;p>0&&e[p-1]===0;)p--;for(;t<p;){var m=t,f=e[m];if(f===60&&e[m+1]===60)t+=2,l({});else if(f===62&&e[m+1]===62)t+=2,u();else if(f===47){t+=1;for(var g=t;t<e.length&&!zB(e[t]);)t++;for(var v="",b=g;b<t;b++)v+=String.fromCharCode(e[b]);d(v)}else if(f===40)t+=1,c(i());else if(f===91)t+=1,l([]);else if(f===93)t+=1,u();else if(f===110&&e[m+1]===117&&e[m+2]===108&&e[m+3]===108)t+=4,c(null);else if(f===116&&e[m+1]===114&&e[m+2]===117&&e[m+3]===101)t+=4,c(!0);else if(f===102&&e[m+1]===97&&e[m+2]===108&&e[m+3]===115&&e[m+4]===101)t+=5,c(!1);else if(VB(f)){for(var C="";t<e.length&&VB(e[t]);)C+=String.fromCharCode(e[t]),t++;c(parseFloat(C))}else t+=1,console.log("Invalid token '".concat(String.fromCharCode(f),"' (").concat(f,") at ").concat(t));n()}return o}var d$e=["Axis","XY","Zone","WordSpacing","FirstLineIndent","GlyphSpacing","StartIndent","EndIndent","SpaceBefore","SpaceAfter","LetterSpacing","Values","GridSize","GridLeading","PointBase","BoxBounds","TransformPoint0","TransformPoint1","TransformPoint2","FontSize","Leading","HorizontalScale","VerticalScale","BaselineShift","Tsume","OutlineWidth","AutoLeading"],u$e=["RunLengthArray"];function h$e(e,t){t===void 0&&(t=!1);var n=new Uint8Array(1024),s=0,i=0;function o(y){if(s>=n.length){var x=new Uint8Array(n.length*2);x.set(n),n=x}n[s]=y,s++}function r(y){for(var x=0;x<y.length;x++)o(y.charCodeAt(x))}function l(){if(t)r(" ");else for(var y=0;y<i;y++)r("	")}function c(y,x){l(),r("/".concat(y)),g(x,y,!0),t||r(`
`)}function d(y){return y.toString()}function u(y){return y.toFixed(5).replace(/(\d)0+$/g,"$1").replace(/^0+\.([1-9])/g,".$1").replace(/^-0+\.0(\d)/g,"-.0$1")}function p(y,x){var w=x&&d$e.indexOf(x)!==-1||(y|0)!==y;return w?u(y):d(y)}function m(y){var x=Object.keys(y);return x.indexOf("98")!==-1&&x.unshift.apply(x,x.splice(x.indexOf("99"),1)),x.indexOf("99")!==-1&&x.unshift.apply(x,x.splice(x.indexOf("99"),1)),x}function f(y){(y===40||y===41||y===92)&&o(92),o(y)}function g(y,x,w){w===void 0&&(w=!1);function _(){w?r(" "):l()}if(y===null)_(),r(t?"/nil":"null");else if(typeof y=="number")_(),r(p(y,x));else if(typeof y=="boolean")_(),r(y?"true":"false");else if(typeof y=="string")if(_(),(x==="99"||x==="98")&&y.charAt(0)==="/")r(y);else{r("("),o(254),o(255);for(var S=0;S<y.length;S++){var I=y.charCodeAt(S);f(I>>8&255),f(I&255)}r(")")}else if(Array.isArray(y))if(_(),y.every(function(L){return typeof L=="number"})){r("[");for(var k=u$e.indexOf(x)!==-1,E=0,j=y;E<j.length;E++){var P=j[E];r(" "),r(k?p(P):u(P))}r(" ]")}else{r("["),t||r(`
`);for(var D=0,O=y;D<O.length;D++){var P=O[D];g(P,x),t||r(`
`)}l(),r("]")}else if(typeof y=="object"){w&&!t&&r(`
`),l(),r("<<"),t||r(`
`),i++;for(var N=0,F=m(y);N<F.length;N++){var X=F[N];c(X,y[X])}i--,l(),r(">>")}}if(t){if(typeof e=="object")for(var v=0,b=m(e);v<b.length;v++){var C=b[v];c(C,e[C])}}else r(`

`),g(e);return n.slice(0,s)}var Ns=function(){return Ns=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ns.apply(this,arguments)},Sne={name:"MyriadPro-Regular",script:0,type:0,synthetic:0},_x={justification:"left",firstLineIndent:0,startIndent:0,endIndent:0,spaceBefore:0,spaceAfter:0,autoHyphenate:!0,hyphenatedWordSize:6,preHyphen:2,postHyphen:2,consecutiveHyphens:8,zone:36,wordSpacing:[.8,1,1.33],letterSpacing:[0,0,0],glyphSpacing:[1,1,1],autoLeading:1.2,leadingType:0,hanging:!1,burasagari:!1,kinsokuOrder:0,everyLineComposer:!1},p$e={font:Sne,fontSize:12,fauxBold:!1,fauxItalic:!1,autoLeading:!0,leading:0,horizontalScale:1,verticalScale:1,tracking:0,autoKerning:!0,kerning:0,baselineShift:0,fontCaps:0,fontBaseline:0,underline:!1,strikethrough:!1,ligatures:!0,dLigatures:!1,baselineDirection:2,tsume:0,styleRunAlignment:2,language:0,noBreak:!1,fillColor:{r:0,g:0,b:0},strokeColor:{r:0,g:0,b:0},fillFlag:!0,strokeFlag:!1,fillFirst:!0,yUnderline:1,outlineWidth:1,characterDirection:0,hindiNumbers:!1,kashida:1,diacriticPos:2},f$e={isOn:!1,show:!1,size:18,leading:22,color:{r:0,g:0,b:255},leadingFillColor:{r:0,g:0,b:255},alignLineHeightToGridFlags:!1},F6=["justification","firstLineIndent","startIndent","endIndent","spaceBefore","spaceAfter","autoHyphenate","hyphenatedWordSize","preHyphen","postHyphen","consecutiveHyphens","zone","wordSpacing","letterSpacing","glyphSpacing","autoLeading","leadingType","hanging","burasagari","kinsokuOrder","everyLineComposer"],B6=["font","fontSize","fauxBold","fauxItalic","autoLeading","leading","horizontalScale","verticalScale","tracking","autoKerning","kerning","baselineShift","fontCaps","fontBaseline","underline","strikethrough","ligatures","dLigatures","baselineDirection","tsume","styleRunAlignment","language","noBreak","fillColor","strokeColor","fillFlag","strokeFlag","fillFirst","yUnderline","outlineWidth","characterDirection","hindiNumbers","kashida","diacriticPos"],kne=["none","crisp","strong","smooth","sharp"],Ine=["left","right","center","justify-left","justify-right","justify-center","justify-all"];function jne(e){return e.substring(0,1).toUpperCase()+e.substring(1)}function m$e(e){var t=e.Values;switch(e.Type){case 0:return{k:t[1]*255};case 1:return t[0]===1?{r:t[1]*255,g:t[2]*255,b:t[3]*255}:{r:t[1]*255,g:t[2]*255,b:t[3]*255,a:t[0]*255};case 2:return{c:t[1]*255,m:t[2]*255,y:t[3]*255,k:t[4]*255};default:throw new Error("Unknown color type in text layer")}}function MT(e){if(e){if("r"in e)return{Type:1,Values:["a"in e?e.a/255:1,e.r/255,e.g/255,e.b/255]};if("c"in e)return{Type:2,Values:[1,e.c/255,e.m/255,e.y/255,e.k/255]};if("k"in e)return{Type:0,Values:[1,e.k/255]};throw new Error("Invalid color type in text layer")}else return{Type:1,Values:[0,0,0,0]}}function $B(e,t){if(!e||!t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function GB(e,t){if(!e||!t)return!1;for(var n=0,s=Object.keys(e);n<s.length;n++){var i=s[n];if(e[i]!==t[i])return!1}for(var o=0,r=Object.keys(t);o<r.length;o++){var i=r[o];if(e[i]!==t[i])return!1}return!0}function g$e(e,t){for(var n=0;n<e.length;n++)if(e[n].name===t.name)return n;return e.push(t),e.length-1}function Ene(e,t,n){for(var s={},i=0,o=t;i<o.length;i++){var r=o[i],l=jne(r);e[l]!==void 0&&(r==="justification"?s[r]=Ine[e[l]]:r==="font"?s[r]=n[e[l]]:r==="fillColor"||r==="strokeColor"?s[r]=m$e(e[l]):s[r]=e[l])}return s}function Ane(e,t,n){for(var s,i={},o=0,r=t;o<r.length;o++){var l=r[o],c=jne(l);e[l]!==void 0&&(l==="justification"?i[c]=Ine.indexOf((s=e[l])!==null&&s!==void 0?s:"left"):l==="font"?i[c]=g$e(n,e[l]):l==="fillColor"||l==="strokeColor"?i[c]=MT(e[l]):i[c]=e[l])}return i}function v$e(e,t){return Ene(e,F6,t)}function y$e(e,t){return Ene(e,B6,t)}function Sx(e,t){return Ane(e,F6,t)}function bE(e,t){return Ane(e,B6,t)}function HB(e,t,n){if(t.length){for(var s=function(l){var c=t[0].style[l];if(c!==void 0){var d=!1;Array.isArray(c)?d=t.every(function(v){return $B(v.style[l],c)}):typeof c=="object"?d=t.every(function(v){return GB(v.style[l],c)}):d=t.every(function(v){return v.style[l]===c}),d&&(e[l]=c)}var u=e[l];if(u!==void 0)for(var p=0,m=t;p<m.length;p++){var f=m[p],g=!1;Array.isArray(c)?g=$B(f.style[l],c):typeof c=="object"?g=GB(f.style[l],c):g=f.style[l]===c,g&&delete f.style[l]}},i=0,o=n;i<o.length;i++){var r=o[i];s(r)}t.every(function(l){return Object.keys(l.style).length===0})&&(t.length=0)}}function b$e(e){for(var t,n,s,i,o,r,l=e.EngineDict,c=e.ResourceDict,d=c.FontSet.map(function(S){return{name:S.Name,script:S.Script,type:S.FontType,synthetic:S.Synthetic}}),u=l.Editor.Text.replace(/\r/g,`
`),p=0;/\n$/.test(u);)u=u.substring(0,u.length-1),p++;var m={text:u,antiAlias:(t=kne[l.AntiAlias])!==null&&t!==void 0?t:"smooth",useFractionalGlyphWidths:!!l.UseFractionalGlyphWidths,superscriptSize:c.SuperscriptSize,superscriptPosition:c.SuperscriptPosition,subscriptSize:c.SubscriptSize,subscriptPosition:c.SubscriptPosition,smallCapSize:c.SmallCapSize},f=(r=(o=(i=(s=(n=l.Rendered)===null||n===void 0?void 0:n.Shapes)===null||s===void 0?void 0:s.Children)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.Cookie)===null||r===void 0?void 0:r.Photoshop;f&&(m.shapeType=f.ShapeType===1?"box":"point",f.PointBase&&(m.pointBase=f.PointBase),f.BoxBounds&&(m.boxBounds=f.BoxBounds));var g=l.ParagraphRun;m.paragraphStyle={},m.paragraphStyleRuns=[];for(var v=0;v<g.RunArray.length;v++){var b=g.RunArray[v],C=g.RunLengthArray[v],y=v$e(b.ParagraphSheet.Properties,d);m.paragraphStyleRuns.push({length:C,style:y})}for(var x=p;m.paragraphStyleRuns.length&&x>0;x--)--m.paragraphStyleRuns[m.paragraphStyleRuns.length-1].length===0&&m.paragraphStyleRuns.pop();HB(m.paragraphStyle,m.paragraphStyleRuns,F6),m.paragraphStyleRuns.length||delete m.paragraphStyleRuns;var w=l.StyleRun;m.style={},m.styleRuns=[];for(var v=0;v<w.RunArray.length;v++){var _=w.RunLengthArray[v],y=y$e(w.RunArray[v].StyleSheet.StyleSheetData,d);y.font||(y.font=d[0]),m.styleRuns.push({length:_,style:y})}for(var x=p;m.styleRuns.length&&x>0;x--)--m.styleRuns[m.styleRuns.length-1].length===0&&m.styleRuns.pop();return HB(m.style,m.styleRuns,B6),m.styleRuns.length||delete m.styleRuns,m}function x$e(e){var t,n,s,i,o,r,l,c,d,u,p,m,f="".concat((e.text||"").replace(/\r?\n/g,"\r"),"\r"),g=[{name:"AdobeInvisFont",script:0,type:0,synthetic:0}],v=((t=e.style)===null||t===void 0?void 0:t.font)||((s=(n=e.styleRuns)===null||n===void 0?void 0:n.find(function(H){return H.style.font}))===null||s===void 0?void 0:s.style.font)||Sne,b=[],C=[],y=e.paragraphStyleRuns;if(y&&y.length){for(var x=f.length,w=0,_=y;w<_.length;w++){var S=_[w],I=Math.min(S.length,x);x-=I,I&&(x===1&&S===y[y.length-1]&&(I++,x--),C.push(I),b.push({ParagraphSheet:{DefaultStyleSheet:0,Properties:Sx(Ns(Ns(Ns({},_x),e.paragraphStyle),S.style),g)},Adjustments:{Axis:[1,0,1],XY:[0,0]}}))}x&&(C.push(x),b.push({ParagraphSheet:{DefaultStyleSheet:0,Properties:Sx(Ns(Ns({},_x),e.paragraphStyle),g)},Adjustments:{Axis:[1,0,1],XY:[0,0]}}))}else for(var k=0,E=0;k<f.length;k++)f.charCodeAt(k)===13&&(C.push(k-E+1),b.push({ParagraphSheet:{DefaultStyleSheet:0,Properties:Sx(Ns(Ns({},_x),e.paragraphStyle),g)},Adjustments:{Axis:[1,0,1],XY:[0,0]}}),E=k+1);for(var j=bE(Ns(Ns({},p$e),{font:v}),g),P=e.styleRuns||[{length:f.length,style:e.style||{}}],D=[],O=[],N=f.length,F=0,X=P;F<X.length;F++){var L=X[F],I=Math.min(L.length,N);N-=I,I&&(N===1&&L===P[P.length-1]&&(I++,N--),O.push(I),D.push({StyleSheet:{StyleSheetData:bE(Ns(Ns({kerning:0,autoKerning:!0,fillColor:{r:0,g:0,b:0}},e.style),L.style),g)}}))}N&&P.length&&(O.push(N),D.push({StyleSheet:{StyleSheetData:bE(Ns({kerning:0,autoKerning:!0,fillColor:{r:0,g:0,b:0}},e.style),g)}}));var V=Ns(Ns({},f$e),e.gridInfo),K=e.orientation==="vertical"?2:0,U=e.orientation==="vertical"?1:0,Z=e.shapeType==="box"?1:0,W={ShapeType:Z};Z===0?W.PointBase=e.pointBase||[0,0]:W.BoxBounds=e.boxBounds||[0,0,0,0],W.Base={ShapeType:Z,TransformPoint0:[1,0],TransformPoint1:[0,1],TransformPoint2:[0,0]};var R={KinsokuSet:[{Name:"PhotoshopKinsokuHard",NoStart:"?!)]},.:;",NoEnd:"([{",Keep:"",Hanging:".,"},{Name:"PhotoshopKinsokuSoft",NoStart:"",NoEnd:"",Keep:"",Hanging:".,"}],MojiKumiSet:[{InternalName:"Photoshop6MojiKumiSet1"},{InternalName:"Photoshop6MojiKumiSet2"},{InternalName:"Photoshop6MojiKumiSet3"},{InternalName:"Photoshop6MojiKumiSet4"}],TheNormalStyleSheet:0,TheNormalParagraphSheet:0,ParagraphSheetSet:[{Name:"Normal RGB",DefaultStyleSheet:0,Properties:Sx(Ns(Ns({},_x),e.paragraphStyle),g)}],StyleSheetSet:[{Name:"Normal RGB",StyleSheetData:j}],FontSet:g.map(function(H){return{Name:H.name,Script:H.script||0,FontType:H.type||0,Synthetic:H.synthetic||0}}),SuperscriptSize:(i=e.superscriptSize)!==null&&i!==void 0?i:.583,SuperscriptPosition:(o=e.superscriptPosition)!==null&&o!==void 0?o:.333,SubscriptSize:(r=e.subscriptSize)!==null&&r!==void 0?r:.583,SubscriptPosition:(l=e.subscriptPosition)!==null&&l!==void 0?l:.333,SmallCapSize:(c=e.smallCapSize)!==null&&c!==void 0?c:.7},G={EngineDict:{Editor:{Text:f},ParagraphRun:{DefaultRunData:{ParagraphSheet:{DefaultStyleSheet:0,Properties:{}},Adjustments:{Axis:[1,0,1],XY:[0,0]}},RunArray:b,RunLengthArray:C,IsJoinable:1},StyleRun:{DefaultRunData:{StyleSheet:{StyleSheetData:{}}},RunArray:D,RunLengthArray:O,IsJoinable:2},GridInfo:{GridIsOn:!!V.isOn,ShowGrid:!!V.show,GridSize:(d=V.size)!==null&&d!==void 0?d:18,GridLeading:(u=V.leading)!==null&&u!==void 0?u:22,GridColor:MT(V.color),GridLeadingFillColor:MT(V.color),AlignLineHeightToGridFlags:!!V.alignLineHeightToGridFlags},AntiAlias:kne.indexOf((p=e.antiAlias)!==null&&p!==void 0?p:"sharp"),UseFractionalGlyphWidths:(m=e.useFractionalGlyphWidths)!==null&&m!==void 0?m:!0,Rendered:{Version:1,Shapes:{WritingDirection:K,Children:[{ShapeType:Z,Procession:U,Lines:{WritingDirection:K,Children:[]},Cookie:{Photoshop:W}}]}}},ResourceDict:Ns({},R),DocumentResources:Ns({},R)};return G}var xE={0:{uproot:!0,children:{0:{name:"Type"},1:{name:"Values"}}}},z6={0:{name:"Font"},1:{name:"FontSize"},2:{name:"FauxBold"},3:{name:"FauxItalic"},4:{name:"AutoLeading"},5:{name:"Leading"},6:{name:"HorizontalScale"},7:{name:"VerticalScale"},8:{name:"Tracking"},9:{name:"BaselineShift"},11:{name:"Kerning?"},12:{name:"FontCaps"},13:{name:"FontBaseline"},15:{name:"Strikethrough?"},16:{name:"Underline?"},18:{name:"Ligatures"},19:{name:"DLigatures"},23:{name:"Fractions"},24:{name:"Ordinals"},28:{name:"StylisticAlternates"},30:{name:"OldStyle?"},35:{name:"BaselineDirection"},38:{name:"Language"},52:{name:"NoBreak"},53:{name:"FillColor",children:xE},54:{name:"StrokeColor",children:xE},55:{children:{99:{uproot:!0}}},79:{children:xE}},CE={0:{name:"Justification"},1:{name:"FirstLineIndent"},2:{name:"StartIndent"},3:{name:"EndIndent"},4:{name:"SpaceBefore"},5:{name:"SpaceAfter"},7:{name:"AutoLeading"},9:{name:"AutoHyphenate"},10:{name:"HyphenatedWordSize"},11:{name:"PreHyphen"},12:{name:"PostHyphen"},13:{name:"ConsecutiveHyphens?"},14:{name:"Zone"},15:{name:"HypenateCapitalizedWords"},17:{name:"WordSpacing"},18:{name:"LetterSpacing"},19:{name:"GlyphSpacing"},32:{name:"StyleSheet",children:z6}},WB={name:"StyleSheetData",children:z6},C$e={0:{name:"ResourceDict",children:{1:{name:"FontSet",children:{0:{uproot:!0,children:{0:{uproot:!0,children:{0:{uproot:!0,children:{0:{name:"Name"},2:{name:"FontType"}}}}}}}}},2:{name:"2",children:{}},3:{name:"MojiKumiSet",children:{0:{uproot:!0,children:{0:{uproot:!0,children:{0:{name:"InternalName"}}}}}}},4:{name:"KinsokuSet",children:{0:{uproot:!0,children:{0:{uproot:!0,children:{0:{name:"Name"},5:{uproot:!0,children:{0:{name:"NoStart"},1:{name:"NoEnd"},2:{name:"Keep"},3:{name:"Hanging"},4:{name:"Name"}}}}}}}}},5:{name:"StyleSheetSet",children:{0:{uproot:!0,children:{0:{uproot:!0,children:{0:{name:"Name"},6:WB}}}}}},6:{name:"ParagraphSheetSet",children:{0:{uproot:!0,children:{0:{uproot:!0,children:{0:{name:"Name"},5:{name:"Properties",children:CE},6:{name:"DefaultStyleSheet"}}}}}}},8:{name:"TextFrameSet",children:{0:{uproot:!0,children:{0:{name:"path",children:{0:{name:"name"},1:{name:"bezierCurve",children:{0:{name:"controlPoints"}}},2:{name:"data",children:{0:{name:"type"},1:{name:"orientation"},2:{name:"frameMatrix"},4:{name:"4"},6:{name:"textRange"},7:{name:"rowGutter"},8:{name:"columnGutter"},9:{name:"9"},10:{name:"baselineAlignment",children:{0:{name:"flag"},1:{name:"min"}}},11:{name:"pathData",children:{1:{name:"1"},0:{name:"reversed"},2:{name:"2"},3:{name:"3"},4:{name:"spacing"},5:{name:"5"},6:{name:"6"},7:{name:"7"},18:{name:"18"}}},12:{name:"12"},13:{name:"13"}}},3:{name:"3"},97:{name:"uuid"}}}}}}},9:{name:"Predefined",children:{0:{children:{0:{uproot:!0}}},1:{children:{0:{uproot:!0}}}}}}},1:{name:"EngineDict",children:{0:{name:"0",children:{3:{name:"SuperscriptSize"},4:{name:"SuperscriptPosition"},5:{name:"SubscriptSize"},6:{name:"SubscriptPosition"},7:{name:"SmallCapSize"},8:{name:"UseFractionalGlyphWidths"},15:{children:{0:{uproot:!0}}}}},1:{name:"Editors?",children:{0:{name:"Editor",children:{0:{name:"Text"},5:{name:"ParagraphRun",children:{0:{name:"RunArray",children:{0:{name:"ParagraphSheet",children:{0:{uproot:!0,children:{0:{name:"0"},5:{name:"5",children:CE},6:{name:"6"}}}}},1:{name:"RunLength"}}}}},6:{name:"StyleRun",children:{0:{name:"RunArray",children:{0:{name:"StyleSheet",children:{0:{uproot:!0,children:{6:WB}}}},1:{name:"RunLength"}}}}}}},1:{name:"FontVectorData ???"}}},2:{name:"StyleSheet",children:z6},3:{name:"ParagraphSheet",children:CE}}}};function H0(e,t){var n,s;if(e===null)return e;if(Array.isArray(e))return e.map(function(c){return H0(c,t)});if(typeof e!="object")return e;for(var i={},o=0,r=Object.keys(e);o<r.length;o++){var l=r[o];if(t[l])if(t[l].uproot){l!=="99"&&(i=H0(e[l],(n=t[l].children)!==null&&n!==void 0?n:{})),e[99]&&(i._type=e[99]);break}else i[t[l].name||l]=H0(e[l],(s=t[l].children)!==null&&s!==void 0?s:{});else l==="99"?i._type=e[l]:i[l]=H0(e[l],{})}return i}function w$e(e){return H0(e,C$e)}var J=function(){return J=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},J.apply(this,arguments)},aa="abcdefghijklmnopqrstuvwxyz",Pne=[],WC={};function ot(e,t,n,s){var i={key:e,has:t,read:n,write:s};Pne.push(i),WC[i.key]=i}function Gm(e,t){WC[e]=WC[t]}function jn(e){return function(t){return t[e]!==void 0}}function wE(e){if(Oe(e))throw new Error("Resource size above 4 GB limit at ".concat(e.offset.toString(16)));return Oe(e)}function _E(e,t){ze(e,0),ze(e,t)}ot("TySh",jn("text"),function(e,t,n){if(Kt(e)!==1)throw new Error("Invalid TySh version");for(var s=[],i=0;i<6;i++)s.push(er(e));if(Kt(e)!==50)throw new Error("Invalid TySh text version");var o=Ht(e);if(Kt(e)!==1)throw new Error("Invalid TySh warp version");var r=Ht(e);if(t.text={transform:s,left:Rr(e),top:Rr(e),right:Rr(e),bottom:Rr(e),text:o["Txt "].replace(/\r/g,`
`),index:o.TextIndex||0,gridding:mB.decode(o.textGridding),antiAlias:gB.decode(o.AntA),orientation:pv.decode(o.Ornt),warp:{style:M6.decode(r.warpStyle),value:r.warpValue||0,perspective:r.warpPerspective||0,perspectiveOther:r.warpPerspectiveOther||0,rotate:pv.decode(r.warpRotate)}},o.bounds&&(t.text.bounds=cB(o.bounds)),o.boundingBox&&(t.text.boundingBox=cB(o.boundingBox)),o.EngineData){var l=_ne(o.EngineData),c=b$e(l);t.text=J(J({},t.text),c)}Ye(e,n())},function(e,t){var n=t.text,s=n.warp||{},i=n.transform||[1,0,0,1,0,0],o=J(J(J({"Txt ":(n.text||"").replace(/\r?\n/g,"\r"),textGridding:mB.encode(n.gridding),Ornt:pv.encode(n.orientation),AntA:gB.encode(n.antiAlias)},n.bounds?{bounds:dB(n.bounds)}:{}),n.boundingBox?{boundingBox:dB(n.boundingBox)}:{}),{TextIndex:n.index||0,EngineData:h$e(x$e(n))});ln(e,1);for(var r=0;r<6;r++)tr(e,i[r]);ln(e,50),Wt(e,"","TxLr",o,"text"),ln(e,1),Wt(e,"","warp",UC(s)),Or(e,n.left),Or(e,n.top),Or(e,n.right),Or(e,n.bottom)});ot("SoCo",function(e){return e.vectorFill!==void 0&&e.vectorStroke===void 0&&e.vectorFill.type==="color"},function(e,t){var n=Ht(e);t.vectorFill=I1(n)},function(e,t){var n=j1(t.vectorFill).descriptor;Wt(e,"","null",n)});ot("GdFl",function(e){return e.vectorFill!==void 0&&e.vectorStroke===void 0&&(e.vectorFill.type==="solid"||e.vectorFill.type==="noise")},function(e,t,n){var s=Ht(e);t.vectorFill=I1(s),Ye(e,n())},function(e,t){var n=j1(t.vectorFill).descriptor;Wt(e,"","null",n)});ot("PtFl",function(e){return e.vectorFill!==void 0&&e.vectorStroke===void 0&&e.vectorFill.type==="pattern"},function(e,t){var n=Ht(e);t.vectorFill=I1(n)},function(e,t){var n=j1(t.vectorFill).descriptor;Wt(e,"","null",n)});ot("vscg",function(e){return e.vectorFill!==void 0&&e.vectorStroke!==void 0},function(e,t,n){Ln(e);var s=Ht(e);t.vectorFill=I1(s),Ye(e,n())},function(e,t){var n=j1(t.vectorFill),s=n.descriptor,i=n.key;ht(e,i),Wt(e,"","null",s)});function _$e(e,t,n){var s=jr(e)*n,i=jr(e)*t,o=jr(e)*n,r=jr(e)*t,l=jr(e)*n,c=jr(e)*t;return[i,s,r,o,c,l]}function S$e(e,t,n,s){Er(e,t[1]/s),Er(e,t[0]/n),Er(e,t[3]/s),Er(e,t[2]/n),Er(e,t[5]/s),Er(e,t[4]/n)}var Tne=["exclude","combine","subtract","intersect"];function k$e(e,t,n,s,i){for(var o=e.offset+i,r=t.paths,l=void 0;o-e.offset>=26;){var c=Ge(e);switch(c){case 0:case 3:{Ge(e);var d=Kt(e),u=Ge(e);Ye(e,18),l={open:c===3,knots:[],fillRule:u===2?"non-zero":"even-odd"},d!==-1&&(l.operation=Tne[d]),r.push(l);break}case 1:case 2:case 4:case 5:l.knots.push({linked:c===1||c===4,points:_$e(e,n,s)});break;case 6:Ye(e,24);break;case 7:{var p=jr(e),m=jr(e),f=jr(e),g=jr(e),v=jr(e);Ye(e,4),t.clipboard={top:p,left:m,bottom:f,right:g,resolution:v};break}case 8:t.fillStartsWithAllPixels=!!Ge(e),Ye(e,22);break;default:throw new Error("Invalid vmsk section")}}return r}ot("vmsk",jn("vectorMask"),function(e,t,n,s){var i=s.width,o=s.height;if(Oe(e)!==3)throw new Error("Invalid vmsk version");t.vectorMask={paths:[]};var r=t.vectorMask,l=Oe(e);r.invert=(l&1)!==0,r.notLink=(l&2)!==0,r.disable=(l&4)!==0,k$e(e,r,i,o,n()),Ye(e,n())},function(e,t,n){var s=n.width,i=n.height,o=t.vectorMask,r=(o.invert?1:0)|(o.notLink?2:0)|(o.disable?4:0);ze(e,3),ze(e,r),_e(e,6),tn(e,24);var l=o.clipboard;l&&(_e(e,7),Er(e,l.top),Er(e,l.left),Er(e,l.bottom),Er(e,l.right),Er(e,l.resolution),tn(e,4)),o.fillStartsWithAllPixels!==void 0&&(_e(e,8),_e(e,o.fillStartsWithAllPixels?1:0),tn(e,22));for(var c=0,d=o.paths;c<d.length;c++){var u=d[c];_e(e,u.open?3:0),_e(e,u.knots.length),_e(e,u.operation?Tne.indexOf(u.operation):-1),_e(e,u.fillRule==="non-zero"?2:1),tn(e,18);for(var p=u.open?4:1,m=u.open?5:2,f=0,g=u.knots;f<g.length;f++){var v=g[f],b=v.linked,C=v.points;_e(e,b?p:m),S$e(e,C,s,i)}}});Gm("vsms","vmsk");ot("vowv",jn("vowv"),function(e,t){t.vowv=Oe(e)},function(e,t){ze(e,t.vowv)});ot("vogk",jn("vectorOrigination"),function(e,t,n){if(et(e)!==1)throw new Error("Invalid vogk version");var s=Ht(e);t.vectorOrigination={keyDescriptorList:[]};for(var i=0,o=s.keyDescriptorList;i<o.length;i++){var r=o[i],l={};r.keyShapeInvalidated!=null&&(l.keyShapeInvalidated=r.keyShapeInvalidated),r.keyOriginType!=null&&(l.keyOriginType=r.keyOriginType),r.keyOriginResolution!=null&&(l.keyOriginResolution=r.keyOriginResolution),r.keyOriginShapeBBox&&(l.keyOriginShapeBoundingBox={top:Rd(r.keyOriginShapeBBox["Top "]),left:Rd(r.keyOriginShapeBBox.Left),bottom:Rd(r.keyOriginShapeBBox.Btom),right:Rd(r.keyOriginShapeBBox.Rght)});var c=r.keyOriginRRectRadii;c&&(l.keyOriginRRectRadii={topRight:bn(c.topRight),topLeft:bn(c.topLeft),bottomLeft:bn(c.bottomLeft),bottomRight:bn(c.bottomRight)});var d=r.keyOriginBoxCorners;d&&(l.keyOriginBoxCorners=[{x:d.rectangleCornerA.Hrzn,y:d.rectangleCornerA.Vrtc},{x:d.rectangleCornerB.Hrzn,y:d.rectangleCornerB.Vrtc},{x:d.rectangleCornerC.Hrzn,y:d.rectangleCornerC.Vrtc},{x:d.rectangleCornerD.Hrzn,y:d.rectangleCornerD.Vrtc}]);var u=r.Trnf;u&&(l.transform=[u.xx,u.xy,u.xy,u.yy,u.tx,u.ty]),t.vectorOrigination.keyDescriptorList.push(l)}Ye(e,n())},function(e,t){for(var n=t.vectorOrigination,s={keyDescriptorList:[]},i=0;i<n.keyDescriptorList.length;i++){var o=n.keyDescriptorList[i];s.keyDescriptorList.push({});var r=s.keyDescriptorList[s.keyDescriptorList.length-1];o.keyOriginType!=null&&(r.keyOriginType=o.keyOriginType),o.keyOriginResolution!=null&&(r.keyOriginResolution=o.keyOriginResolution);var l=o.keyOriginRRectRadii;l&&(r.keyOriginRRectRadii={unitValueQuadVersion:1,topRight:Wn(l.topRight,"topRight"),topLeft:Wn(l.topLeft,"topLeft"),bottomLeft:Wn(l.bottomLeft,"bottomLeft"),bottomRight:Wn(l.bottomRight,"bottomRight")});var c=o.keyOriginShapeBoundingBox;c&&(r.keyOriginShapeBBox={unitValueQuadVersion:1,"Top ":Wn(c.top,"top"),Left:Wn(c.left,"left"),Btom:Wn(c.bottom,"bottom"),Rght:Wn(c.right,"right")});var d=o.keyOriginBoxCorners;d&&d.length===4&&(r.keyOriginBoxCorners={rectangleCornerA:{Hrzn:d[0].x,Vrtc:d[0].y},rectangleCornerB:{Hrzn:d[1].x,Vrtc:d[1].y},rectangleCornerC:{Hrzn:d[2].x,Vrtc:d[2].y},rectangleCornerD:{Hrzn:d[3].x,Vrtc:d[3].y}});var u=o.transform;u&&u.length===6&&(r.Trnf={xx:u[0],xy:u[1],yx:u[2],yy:u[3],tx:u[4],ty:u[5]}),o.keyShapeInvalidated!=null&&(r.keyShapeInvalidated=o.keyShapeInvalidated),r.keyOriginIndex=i}lt(e,1),Wt(e,"","null",s)});ot("lmfx",function(e){return e.effects!==void 0&&Rne(e.effects)},function(e,t,n){var s=Oe(e);if(s!==0)throw new Error("Invalid lmfx version");var i=Ht(e);t.effects=k1(i,!!e.logMissingFeatures),Ye(e,n())},function(e,t,n,s){var i=S1(t.effects,!!s.logMissingFeatures,!0);ze(e,0),Wt(e,"","null",i)});ot("lrFX",jn("effects"),function(e,t,n){t.effects||(t.effects=l$e(e)),Ye(e,n())},function(e,t){c$e(e,t.effects)});ot("luni",jn("name"),function(e,t,n){if(n()>4){var s=Oe(e);n()>=s*2?t.name=O6(e,s):e.logDevFeatures&&e.log("name in luni section is too long")}else e.logDevFeatures&&e.log("empty luni section");Ye(e,n())},function(e,t){ua(e,t.name)});ot("lnsr",jn("nameSource"),function(e,t){return t.nameSource=Ln(e)},function(e,t){return ht(e,t.nameSource)});ot("lyid",jn("id"),function(e,t){t.id=Oe(e)},function(e,t,n,s){for(var i=t.id;s.layerIds.has(i);)i+=100;ze(e,i),s.layerIds.add(i),s.layerToId.set(t,i)});ot("lsct",jn("sectionDivider"),function(e,t,n){t.sectionDivider={type:Oe(e)},n()&&(kh(e,"8BIM"),t.sectionDivider.key=Ln(e)),n()&&(t.sectionDivider.subType=Oe(e))},function(e,t){ze(e,t.sectionDivider.type),t.sectionDivider.key&&(ht(e,"8BIM"),ht(e,t.sectionDivider.key),t.sectionDivider.subType!==void 0&&ze(e,t.sectionDivider.subType))});Gm("lsdk","lsct");ot("clbl",jn("blendClippendElements"),function(e,t){t.blendClippendElements=!!We(e),Ye(e,3)},function(e,t){Le(e,t.blendClippendElements?1:0),tn(e,3)});ot("infx",jn("blendInteriorElements"),function(e,t){t.blendInteriorElements=!!We(e),Ye(e,3)},function(e,t){Le(e,t.blendInteriorElements?1:0),tn(e,3)});ot("knko",jn("knockout"),function(e,t){t.knockout=!!We(e),Ye(e,3)},function(e,t){Le(e,t.knockout?1:0),tn(e,3)});ot("lmgm",jn("layerMaskAsGlobalMask"),function(e,t){t.layerMaskAsGlobalMask=!!We(e),Ye(e,3)},function(e,t){Le(e,t.layerMaskAsGlobalMask?1:0),tn(e,3)});ot("lspf",jn("protected"),function(e,t){var n=Oe(e);t.protected={transparency:(n&1)!==0,composite:(n&2)!==0,position:(n&4)!==0},n&8&&(t.protected.artboards=!0)},function(e,t){var n=(t.protected.transparency?1:0)|(t.protected.composite?2:0)|(t.protected.position?4:0)|(t.protected.artboards?8:0);ze(e,n)});ot("lclr",jn("layerColor"),function(e,t){var n=Ge(e);Ye(e,6),t.layerColor=K9[n]},function(e,t){var n=K9.indexOf(t.layerColor);_e(e,n===-1?0:n),tn(e,6)});ot("shmd",function(e){return e.timestamp!==void 0||e.animationFrames!==void 0||e.animationFrameFlags!==void 0||e.timeline!==void 0||e.comps!==void 0},function(e,t,n){for(var s=Oe(e),i=function(r){kh(e,"8BIM");var l=Ln(e);We(e),Ye(e,3),Ih(e,1,function(c){if(l==="cust"){var d=Ht(e);d.layerTime!==void 0&&(t.timestamp=d.layerTime)}else if(l==="mlst"){var d=Ht(e);t.animationFrames=[];for(var u=0;u<d.LaSt.length;u++){var p=d.LaSt[u],m={frames:p.FrLs};p.enab!==void 0&&(m.enable=p.enab),p.Ofst&&(m.offset=dv(p.Ofst)),p.FXRf&&(m.referencePoint=dv(p.FXRf)),p.Lefx&&(m.effects=k1(p.Lefx,!!e.logMissingFeatures)),p.blendOptions&&p.blendOptions.Opct&&(m.opacity=Mn(p.blendOptions.Opct)),t.animationFrames.push(m)}}else if(l==="mdyn"){Ge(e);var f=We(e),g=We(e);t.animationFrameFlags={propagateFrameOne:!f,unifyLayerPosition:(g&1)!==0,unifyLayerStyle:(g&2)!==0,unifyLayerVisibility:(g&4)!==0}}else if(l==="tmln"){var d=Ht(e),v=d.timeScope,b={start:fo(v.Strt),duration:fo(v.duration),inTime:fo(v.inTime),outTime:fo(v.outTime),autoScope:d.autoScope,audioLevel:d.audioLevel};d.trackList&&(b.tracks=Tte(d.trackList,!!e.logMissingFeatures)),t.timeline=b}else if(l==="cmls"){var d=Ht(e);t.comps={settings:[]},d.origFXRefPoint&&(t.comps.originalEffectsReferencePoint={x:d.origFXRefPoint.Hrzn,y:d.origFXRefPoint.Vrtc});for(var C=0,y=d.layerSettings;C<y.length;C++){var x=y[C];t.comps.settings.push({compList:x.compList});var w=t.comps.settings[t.comps.settings.length-1];"enab"in x&&(w.enabled=x.enab),x.Ofst&&(w.offset={x:x.Ofst.Hrzn,y:x.Ofst.Vrtc}),x.FXRefPoint&&(w.effectsReferencePoint={x:x.FXRefPoint.Hrzn,y:x.FXRefPoint.Vrtc})}}else if(l==="extn"){var d=Ht(e);e.logMissingFeatures&&e.log('Unhandled "shmd" section key',l)}else e.logMissingFeatures&&e.log('Unhandled "shmd" section key',l);Ye(e,c())})},o=0;o<s;o++)i();Ye(e,n())},function(e,t,n,s){var i=t.animationFrames,o=t.animationFrameFlags,r=t.timestamp,l=t.timeline,c=t.comps,d=0;i&&d++,o&&d++,l&&d++,r!==void 0&&d++,c&&d++,ze(e,d),i&&(ht(e,"8BIM"),ht(e,"mlst"),Le(e,0),tn(e,3),Ti(e,2,function(){for(var u,p={LaID:(u=t.id)!==null&&u!==void 0?u:0,LaSt:[]},m=0;m<i.length;m++){var f=i[m],g={};f.enable!==void 0&&(g.enab=f.enable),g.FrLs=f.frames,f.offset&&(g.Ofst=uv(f.offset)),f.referencePoint&&(g.FXRf=uv(f.referencePoint)),f.effects&&(g.Lefx=S1(f.effects,!1,!1)),f.opacity!==void 0&&(g.blendOptions={Opct:ri(f.opacity)}),p.LaSt.push(g)}Wt(e,"","null",p)},!0)),o&&(ht(e,"8BIM"),ht(e,"mdyn"),Le(e,0),tn(e,3),Ti(e,2,function(){_e(e,0),Le(e,o.propagateFrameOne?0:15),Le(e,(o.unifyLayerPosition?1:0)|(o.unifyLayerStyle?2:0)|(o.unifyLayerVisibility?4:0))})),l&&(ht(e,"8BIM"),ht(e,"tmln"),Le(e,0),tn(e,3),Ti(e,2,function(){var u={Vrsn:1,timeScope:{Vrsn:1,Strt:l.start,duration:l.duration,inTime:l.inTime,outTime:l.outTime},autoScope:l.autoScope,audioLevel:l.audioLevel};l.tracks&&(u.trackList=Dte(l.tracks));var p=s.layerToId.get(t)||t.id;if(!p)throw new Error("You need to provide layer.id value whan writing document with animations");u.LyrI=p,Wt(e,"","null",u,"anim")},!0)),r!==void 0&&(ht(e,"8BIM"),ht(e,"cust"),Le(e,0),tn(e,3),Ti(e,2,function(){var u={layerTime:r};Wt(e,"","metadata",u)},!0)),c&&(ht(e,"8BIM"),ht(e,"cmls"),Le(e,0),tn(e,3),Ti(e,2,function(){var u=s.layerToId.get(t)||t.id;if(!u)throw new Error("You need to provide layer.id value whan writing document with layer comps");var p={};c.originalEffectsReferencePoint&&(p.origFXRefPoint={Hrzn:c.originalEffectsReferencePoint.x,Vrtc:c.originalEffectsReferencePoint.y}),p.LyrI=u,p.layerSettings=[];for(var m=0,f=c.settings;m<f.length;m++){var g=f[m],v={};g.enabled!==void 0&&(v.enab=g.enabled),g.offset&&(v.Ofst={Hrzn:g.offset.x,Vrtc:g.offset.y}),g.effectsReferencePoint&&(v.FXRefPoint={Hrzn:g.effectsReferencePoint.x,Vrtc:g.effectsReferencePoint.y}),v.compList=g.compList,p.layerSettings.push(v)}Wt(e,"","null",p)},!0))});ot("vstk",jn("vectorStroke"),function(e,t,n){var s=Ht(e);t.vectorStroke={strokeEnabled:s.strokeEnabled,fillEnabled:s.fillEnabled,lineWidth:bn(s.strokeStyleLineWidth),lineDashOffset:bn(s.strokeStyleLineDashOffset),miterLimit:s.strokeStyleMiterLimit,lineCapType:wB.decode(s.strokeStyleLineCapType),lineJoinType:_B.decode(s.strokeStyleLineJoinType),lineAlignment:SB.decode(s.strokeStyleLineAlignment),scaleLock:s.strokeStyleScaleLock,strokeAdjust:s.strokeStyleStrokeAdjust,lineDashSet:s.strokeStyleLineDashSet.map(bn),blendMode:Ja.decode(s.strokeStyleBlendMode),opacity:Mn(s.strokeStyleOpacity),content:I1(s.strokeStyleContent),resolution:s.strokeStyleResolution},Ye(e,n())},function(e,t){var n,s,i,o=t.vectorStroke,r={strokeStyleVersion:2,strokeEnabled:!!o.strokeEnabled,fillEnabled:!!o.fillEnabled,strokeStyleLineWidth:o.lineWidth||{value:3,units:"Points"},strokeStyleLineDashOffset:o.lineDashOffset||{value:0,units:"Points"},strokeStyleMiterLimit:(n=o.miterLimit)!==null&&n!==void 0?n:100,strokeStyleLineCapType:wB.encode(o.lineCapType),strokeStyleLineJoinType:_B.encode(o.lineJoinType),strokeStyleLineAlignment:SB.encode(o.lineAlignment),strokeStyleScaleLock:!!o.scaleLock,strokeStyleStrokeAdjust:!!o.strokeAdjust,strokeStyleLineDashSet:o.lineDashSet||[],strokeStyleBlendMode:Ja.encode(o.blendMode),strokeStyleOpacity:ri((s=o.opacity)!==null&&s!==void 0?s:1),strokeStyleContent:j1(o.content||{type:"color",color:{r:0,g:0,b:0}}).descriptor,strokeStyleResolution:(i=o.resolution)!==null&&i!==void 0?i:72};Wt(e,"","strokeStyle",r)});ot("artb",jn("artboard"),function(e,t,n){var s=Ht(e),i=s.artboardRect;t.artboard={rect:{top:i["Top "],left:i.Left,bottom:i.Btom,right:i.Rght},guideIndices:s.guideIndeces,presetName:s.artboardPresetName,color:Fr(s["Clr "]),backgroundType:s.artboardBackgroundType},Ye(e,n())},function(e,t){var n,s=t.artboard,i=s.rect,o={artboardRect:{"Top ":i.top,Left:i.left,Btom:i.bottom,Rght:i.right},guideIndeces:s.guideIndices||[],artboardPresetName:s.presetName||"","Clr ":Br(s.color),artboardBackgroundType:(n=s.backgroundType)!==null&&n!==void 0?n:1};Wt(e,"","artboard",o)});ot("sn2P",jn("usingAlignedRendering"),function(e,t){return t.usingAlignedRendering=!!Oe(e)},function(e,t){return ze(e,t.usingAlignedRendering?1:0)});var sf=["unknown","vector","raster","image stack"];function Dne(e){var t,n,s,i,o,r,l=J(J({style:M6.decode(e.warpStyle)},e.warpValues?{values:e.warpValues}:{value:e.warpValue||0}),{perspective:e.warpPerspective||0,perspectiveOther:e.warpPerspectiveOther||0,rotate:pv.decode(e.warpRotate),bounds:e.bounds&&{top:Rd(e.bounds["Top "]),left:Rd(e.bounds.Left),bottom:Rd(e.bounds.Btom),right:Rd(e.bounds.Rght)},uOrder:e.uOrder,vOrder:e.vOrder});(e.deformNumRows!=null||e.deformNumCols!=null)&&(l.deformNumRows=e.deformNumRows,l.deformNumCols=e.deformNumCols);var c=e.customEnvelopeWarp;if(c){l.customEnvelopeWarp={meshPoints:[]};for(var d=((t=c.meshPoints.find(function(m){return m.type==="Hrzn"}))===null||t===void 0?void 0:t.values)||[],u=((n=c.meshPoints.find(function(m){return m.type==="Vrtc"}))===null||n===void 0?void 0:n.values)||[],p=0;p<d.length;p++)l.customEnvelopeWarp.meshPoints.push({x:d[p],y:u[p]});(c.quiltSliceX||c.quiltSliceY)&&(l.customEnvelopeWarp.quiltSliceX=((i=(s=c.quiltSliceX)===null||s===void 0?void 0:s[0])===null||i===void 0?void 0:i.values)||[],l.customEnvelopeWarp.quiltSliceY=((r=(o=c.quiltSliceY)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.values)||[])}return l}function V6(e){var t,n;return e.deformNumCols!=null||e.deformNumRows!=null||((t=e.customEnvelopeWarp)===null||t===void 0?void 0:t.quiltSliceX)||((n=e.customEnvelopeWarp)===null||n===void 0?void 0:n.quiltSliceY)}function UC(e){var t=e.bounds,n=J(J({warpStyle:M6.encode(e.style)},e.values?{warpValues:e.values}:{warpValue:e.value||0}),{warpPerspective:e.perspective||0,warpPerspectiveOther:e.perspectiveOther||0,warpRotate:pv.encode(e.rotate),bounds:{"Top ":Wn(t&&t.top||{units:"Pixels",value:0},"bounds.top"),Left:Wn(t&&t.left||{units:"Pixels",value:0},"bounds.left"),Btom:Wn(t&&t.bottom||{units:"Pixels",value:0},"bounds.bottom"),Rght:Wn(t&&t.right||{units:"Pixels",value:0},"bounds.right")},uOrder:e.uOrder||0,vOrder:e.vOrder||0}),s=V6(e);if(s){var i=n;i.deformNumRows=e.deformNumRows||0,i.deformNumCols=e.deformNumCols||0}var o=e.customEnvelopeWarp;if(o){var r=o.meshPoints||[];if(s){var i=n;i.customEnvelopeWarp={_name:"",_classID:"customEnvelopeWarp",quiltSliceX:[{type:"quiltSliceX",values:o.quiltSliceX||[]}],quiltSliceY:[{type:"quiltSliceY",values:o.quiltSliceY||[]}],meshPoints:[{type:"Hrzn",values:r.map(function(c){return c.x})},{type:"Vrtc",values:r.map(function(c){return c.y})}]}}else n.customEnvelopeWarp={_name:"",_classID:"customEnvelopeWarp",meshPoints:[{type:"Hrzn",values:r.map(function(l){return l.x})},{type:"Vrtc",values:r.map(function(l){return l.y})}]}}return n}ot("PlLd",jn("placedLayer"),function(e,t,n){if(Ln(e)!=="plcL")throw new Error("Invalid PlLd signature");if(et(e)!==3)throw new Error("Invalid PlLd version");var s=uh(e,1),i=et(e),o=et(e);et(e);var r=et(e);if(!sf[r])throw new Error("Invalid PlLd type");for(var l=[],c=0;c<8;c++)l.push(er(e));var d=et(e);if(d!==0)throw new Error("Invalid Warp version ".concat(d));var u=Ht(e);t.placedLayer=t.placedLayer||{id:s,type:sf[r],pageNumber:i,totalPages:o,transform:l,warp:Dne(u)},Ye(e,n())},function(e,t){var n=t.placedLayer;if(ht(e,"plcL"),lt(e,3),!n.id||typeof n.id!="string"||!/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/.test(n.id))throw new Error("Placed layer ID must be in a GUID format (example: 20953ddb-9391-11ec-b4f1-c15674f50bc4)");if(Wd(e,n.id,1),lt(e,1),lt(e,1),lt(e,16),sf.indexOf(n.type)===-1)throw new Error("Invalid placedLayer type");lt(e,sf.indexOf(n.type));for(var s=0;s<8;s++)tr(e,n.transform[s]);lt(e,0);var i=Mne(n),o=V6(i),r=o?"quiltWarp":"warp";Wt(e,"",r,UC(i),r)});function I$e(e){return new Float32Array(e.buffer.slice(e.byteOffset),0,e.byteLength/4)}function j$e(e){return new Uint32Array(e.buffer.slice(e.byteOffset),0,e.byteLength/4)}function SE(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function S2(e){for(var t=[],n=0;n<e.length;n+=2)t.push({x:e[n],y:e[n+1]});return t}function y0(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].x,e[n].y);return t}function UB(e){return S2(I$e(e))}function b0(e){return{x:bn(e.Hrzn),y:bn(e.Vrtc)}}function x0(e){return{_name:"",_classID:"Pnt ",Hrzn:Wn(e.x,"x"),Vrtc:Wn(e.y,"y")}}function E$e(e,t){var n={name:e["Nm  "],opacity:Mn(e.blendOptions.Opct),blendMode:Ja.decode(e.blendOptions["Md  "]),enabled:e.enab,hasOptions:e.hasoptions,foregroundColor:Fr(e.FrgC),backgroundColor:Fr(e.BckC)};if("Fltr"in e)switch(e.Fltr._classID){case"boxblur":return J(J({},n),{type:"box blur",filter:{radius:bn(e.Fltr["Rds "])}});case"GsnB":return J(J({},n),{type:"gaussian blur",filter:{radius:bn(e.Fltr["Rds "])}});case"MtnB":return J(J({},n),{type:"motion blur",filter:{angle:e.Fltr.Angl,distance:bn(e.Fltr.Dstn)}});case"RdlB":return J(J({},n),{type:"radial blur",filter:{amount:e.Fltr.Amnt,method:qte.decode(e.Fltr.BlrM),quality:Kte.decode(e.Fltr.BlrQ)}});case"shapeBlur":return J(J({},n),{type:"shape blur",filter:{radius:bn(e.Fltr["Rds "]),customShape:{name:e.Fltr.customShape["Nm  "],id:e.Fltr.customShape.Idnt}}});case"SmrB":return J(J({},n),{type:"smart blur",filter:{radius:e.Fltr["Rds "],threshold:e.Fltr.Thsh,quality:Xte.decode(e.Fltr.SmBQ),mode:Zte.decode(e.Fltr.SmBM)}});case"surfaceBlur":return J(J({},n),{type:"surface blur",filter:{radius:bn(e.Fltr["Rds "]),threshold:e.Fltr.Thsh}});case"Dspl":return J(J({},n),{type:"displace",filter:{horizontalScale:e.Fltr.HrzS,verticalScale:e.Fltr.VrtS,displacementMap:Yte.decode(e.Fltr.DspM),undefinedAreas:wf.decode(e.Fltr.UndA),displacementFile:{signature:e.Fltr.DspF.sig,path:e.Fltr.DspF.path}}});case"Pnch":return J(J({},n),{type:"pinch",filter:{amount:e.Fltr.Amnt}});case"Plr ":return J(J({},n),{type:"polar coordinates",filter:{conversion:Qte.decode(e.Fltr.Cnvr)}});case"Rple":return J(J({},n),{type:"ripple",filter:{amount:e.Fltr.Amnt,size:Jte.decode(e.Fltr.RplS)}});case"Shr ":return J(J({},n),{type:"shear",filter:{shearPoints:e.Fltr.ShrP.map(function(l){return{x:l.Hrzn,y:l.Vrtc}}),shearStart:e.Fltr.ShrS,shearEnd:e.Fltr.ShrE,undefinedAreas:wf.decode(e.Fltr.UndA)}});case"Sphr":return J(J({},n),{type:"spherize",filter:{amount:e.Fltr.Amnt,mode:ene.decode(e.Fltr.SphM)}});case"Twrl":return J(J({},n),{type:"twirl",filter:{angle:e.Fltr.Angl}});case"Wave":return J(J({},n),{type:"wave",filter:{numberOfGenerators:e.Fltr.NmbG,type:tne.decode(e.Fltr.Wvtp),wavelength:{min:e.Fltr.WLMn,max:e.Fltr.WLMx},amplitude:{min:e.Fltr.AmMn,max:e.Fltr.AmMx},scale:{x:e.Fltr.SclH,y:e.Fltr.SclV},randomSeed:e.Fltr.RndS,undefinedAreas:wf.decode(e.Fltr.UndA)}});case"ZgZg":return J(J({},n),{type:"zigzag",filter:{amount:e.Fltr.Amnt,ridges:e.Fltr.NmbR,style:nne.decode(e.Fltr.ZZTy)}});case"AdNs":return J(J({},n),{type:"add noise",filter:{amount:Mn(e.Fltr.Nose),distribution:sne.decode(e.Fltr.Dstr),monochromatic:e.Fltr.Mnch,randomSeed:e.Fltr.FlRs}});case"DstS":return J(J({},n),{type:"dust and scratches",filter:{radius:e.Fltr["Rds "],threshold:e.Fltr.Thsh}});case"Mdn ":return J(J({},n),{type:"median",filter:{radius:bn(e.Fltr["Rds "])}});case"denoise":return J(J({},n),{type:"reduce noise",filter:{preset:e.Fltr.preset,removeJpegArtifact:e.Fltr.removeJPEGArtifact,reduceColorNoise:Mn(e.Fltr.ClNs),sharpenDetails:Mn(e.Fltr.Shrp),channelDenoise:e.Fltr.channelDenoise.map(function(l){return J({channels:l.Chnl.map(fv.decode),amount:l.Amnt},l.EdgF?{preserveDetails:l.EdgF}:{})})}});case"ClrH":return J(J({},n),{type:"color halftone",filter:{radius:e.Fltr["Rds "],angle1:e.Fltr.Ang1,angle2:e.Fltr.Ang2,angle3:e.Fltr.Ang3,angle4:e.Fltr.Ang4}});case"Crst":return J(J({},n),{type:"crystallize",filter:{cellSize:e.Fltr.ClSz,randomSeed:e.Fltr.FlRs}});case"Mztn":return J(J({},n),{type:"mezzotint",filter:{type:ine.decode(e.Fltr.MztT),randomSeed:e.Fltr.FlRs}});case"Msc ":return J(J({},n),{type:"mosaic",filter:{cellSize:bn(e.Fltr.ClSz)}});case"Pntl":return J(J({},n),{type:"pointillize",filter:{cellSize:e.Fltr.ClSz,randomSeed:e.Fltr.FlRs}});case"Clds":return J(J({},n),{type:"clouds",filter:{randomSeed:e.Fltr.FlRs}});case"DfrC":return J(J({},n),{type:"difference clouds",filter:{randomSeed:e.Fltr.FlRs}});case"Fbrs":return J(J({},n),{type:"fibers",filter:{variance:e.Fltr.Vrnc,strength:e.Fltr.Strg,randomSeed:e.Fltr.RndS}});case"LnsF":return J(J({},n),{type:"lens flare",filter:{brightness:e.Fltr.Brgh,position:{x:e.Fltr.FlrC.Hrzn,y:e.Fltr.FlrC.Vrtc},lensType:one.decode(e.Fltr["Lns "])}});case"smartSharpen":return J(J({},n),{type:"smart sharpen",filter:{amount:Mn(e.Fltr.Amnt),radius:bn(e.Fltr["Rds "]),threshold:e.Fltr.Thsh,angle:e.Fltr.Angl,moreAccurate:e.Fltr.moreAccurate,blur:ane.decode(e.Fltr.blur),preset:e.Fltr.preset,shadow:{fadeAmount:Mn(e.Fltr.sdwM.Amnt),tonalWidth:Mn(e.Fltr.sdwM.Wdth),radius:e.Fltr.sdwM["Rds "]},highlight:{fadeAmount:Mn(e.Fltr.hglM.Amnt),tonalWidth:Mn(e.Fltr.hglM.Wdth),radius:e.Fltr.hglM["Rds "]}}});case"UnsM":return J(J({},n),{type:"unsharp mask",filter:{amount:Mn(e.Fltr.Amnt),radius:bn(e.Fltr["Rds "]),threshold:e.Fltr.Thsh}});case"Dfs ":return J(J({},n),{type:"diffuse",filter:{mode:rne.decode(e.Fltr["Md  "]),randomSeed:e.Fltr.FlRs}});case"Embs":return J(J({},n),{type:"emboss",filter:{angle:e.Fltr.Angl,height:e.Fltr.Hght,amount:e.Fltr.Amnt}});case"Extr":return J(J({},n),{type:"extrude",filter:{type:lne.decode(e.Fltr.ExtT),size:e.Fltr.ExtS,depth:e.Fltr.ExtD,depthMode:cne.decode(e.Fltr.ExtR),randomSeed:e.Fltr.FlRs,solidFrontFaces:e.Fltr.ExtF,maskIncompleteBlocks:e.Fltr.ExtM}});case"Tls ":return J(J({},n),{type:"tiles",filter:{numberOfTiles:e.Fltr.TlNm,maximumOffset:e.Fltr.TlOf,fillEmptyAreaWith:dne.decode(e.Fltr.FlCl),randomSeed:e.Fltr.FlRs}});case"TrcC":return J(J({},n),{type:"trace contour",filter:{level:e.Fltr["Lvl "],edge:une.decode(e.Fltr["Edg "])}});case"Wnd ":return J(J({},n),{type:"wind",filter:{method:hne.decode(e.Fltr.WndM),direction:pne.decode(e.Fltr.Drct)}});case"Dntr":return J(J({},n),{type:"de-interlace",filter:{eliminate:fne.decode(e.Fltr.IntE),newFieldsBy:mne.decode(e.Fltr.IntC)}});case"Cstm":return J(J({},n),{type:"custom",filter:{scale:e.Fltr["Scl "],offset:e.Fltr.Ofst,matrix:e.Fltr.Mtrx}});case"HghP":return J(J({},n),{type:"high pass",filter:{radius:bn(e.Fltr["Rds "])}});case"Mxm ":return J(J({},n),{type:"maximum",filter:{radius:bn(e.Fltr["Rds "])}});case"Mnm ":return J(J({},n),{type:"minimum",filter:{radius:bn(e.Fltr["Rds "])}});case"Ofst":return J(J({},n),{type:"offset",filter:{horizontal:e.Fltr.Hrzn,vertical:e.Fltr.Vrtc,undefinedAreas:gne.decode(e.Fltr["Fl  "])}});case"rigidTransform":return J(J({},n),{type:"puppet",filter:{rigidType:e.Fltr.rigidType,bounds:[{x:e.Fltr.PuX0,y:e.Fltr.PuY0},{x:e.Fltr.PuX1,y:e.Fltr.PuY1},{x:e.Fltr.PuX2,y:e.Fltr.PuY2},{x:e.Fltr.PuX3,y:e.Fltr.PuY3}],puppetShapeList:e.Fltr.puppetShapeList.map(function(l){return{rigidType:l.rigidType,originalVertexArray:UB(l.originalVertexArray),deformedVertexArray:UB(l.deformedVertexArray),indexArray:Array.from(j$e(l.indexArray)),pinOffsets:S2(l.pinOffsets),posFinalPins:S2(l.posFinalPins),pinVertexIndices:l.pinVertexIndices,selectedPin:l.selectedPin,pinPosition:S2(l.PinP),pinRotation:l.PnRt,pinOverlay:l.PnOv,pinDepth:l.PnDp,meshQuality:l.meshQuality,meshExpansion:l.meshExpansion,meshRigidity:l.meshRigidity,imageResolution:l.imageResolution,meshBoundaryPath:{pathComponents:l.meshBoundaryPath.pathComponents.map(function(c){return{shapeOperation:c.shapeOperation.split(".")[1],paths:c.SbpL.map(function(d){return{closed:d.Clsp,points:d["Pts "].map(function(u){return{anchor:b0(u.Anch),forward:b0(u["Fwd "]),backward:b0(u["Bwd "]),smooth:u.Smoo}})}})}})}}})}});case"PbPl":{for(var s=[],i=e.Fltr,o=0;o<aa.length&&i["PN".concat(aa[o],"a")];o++)for(var r=0;r<aa.length&&i["PN".concat(aa[o]).concat(aa[r])];r++)s.push({name:i["PN".concat(aa[o]).concat(aa[r])],value:i["PF".concat(aa[o]).concat(aa[r])]});return J(J({},n),{type:"oil paint plugin",filter:{name:e.Fltr.KnNm,gpu:e.Fltr.GpuY,lighting:e.Fltr.LIWy,parameters:s}})}case"HsbP":return J(J({},n),{type:"hsb/hsl",filter:{inputMode:HC.decode(e.Fltr.Inpt),rowOrder:HC.decode(e.Fltr.Otpt)}});case"oilPaint":return J(J({},n),{type:"oil paint",filter:{lightingOn:e.Fltr.lightingOn,stylization:e.Fltr.stylization,cleanliness:e.Fltr.cleanliness,brushScale:e.Fltr.brushScale,microBrush:e.Fltr.microBrush,lightDirection:e.Fltr.LghD,specularity:e.Fltr.specularity}});case"LqFy":return J(J({},n),{type:"liquify",filter:{liquifyMesh:e.Fltr.LqMe}});case"perspectiveWarpTransform":return J(J({},n),{type:"perspective warp",filter:{vertices:e.Fltr.vertices.map(b0),warpedVertices:e.Fltr.warpedVertices.map(b0),quads:e.Fltr.quads.map(function(l){return l.indices})}});case"Crvs":return J(J({},n),{type:"curves",filter:J({presetKind:vne.decode(e.Fltr.presetKind)},e.Fltr.Adjs?{adjustments:e.Fltr.Adjs.map(function(l){var c=l.Chnl.map(fv.decode);if(l["Crv "])return{channels:c,curve:l["Crv "].map(function(d){var u={x:d.Hrzn,y:d.Vrtc};return d.Cnty&&(u.curved=!0),u})};if(l.Mpng)return{channels:c,values:l.Mpng};throw new Error("Unknown curve adjustment")})}:{})});case"BrgC":return J(J({},n),{type:"brightness/contrast",filter:{brightness:e.Fltr.Brgh,contrast:e.Fltr.Cntr,useLegacy:!!e.Fltr.useLegacy}});default:if(t.throwForMissingFeatures)throw new Error("Unknown filter classId: ".concat(e.Fltr._classID));return}else switch(e.filterID){case 1098281575:return J(J({},n),{type:"average"});case 1114403360:return J(J({},n),{type:"blur"});case 1114403405:return J(J({},n),{type:"blur more"});case 1148416099:return J(J({},n),{type:"despeckle"});case 1180922912:return J(J({},n),{type:"facet"});case 1181902701:return J(J({},n),{type:"fragment"});case 1399353968:return J(J({},n),{type:"sharpen"});case 1399353925:return J(J({},n),{type:"sharpen edges"});case 1399353933:return J(J({},n),{type:"sharpen more"});case 1181639749:return J(J({},n),{type:"find edges"});case 1399616122:return J(J({},n),{type:"solarize"});case 1314149187:return J(J({},n),{type:"ntsc colors"});case 1231976050:return J(J({},n),{type:"invert"});default:if(t.throwForMissingFeatures)throw new Error("Unknown filterID: ".concat(e.filterID))}}function A$e(e,t){return{enabled:e.enab,validAtPosition:e.validAtPosition,maskEnabled:e.filterMaskEnable,maskLinked:e.filterMaskLinked,maskExtendWithWhite:e.filterMaskExtendWithWhite,list:e.filterFXList.map(function(n){return E$e(n,t)}).filter(function(n){return!!n})}}function rl(e){return Wn(e.radius,"radius")}function P$e(e){var t={_name:"",_classID:"filterFX","Nm  ":e.name,blendOptions:{_name:"",_classID:"blendOptions",Opct:Oa(e.opacity),"Md  ":Ja.encode(e.blendMode)},enab:e.enabled,hasoptions:e.hasOptions,FrgC:Br(e.foregroundColor),BckC:Br(e.backgroundColor)};switch(e.type){case"average":return J(J({},t),{filterID:1098281575});case"blur":return J(J({},t),{filterID:1114403360});case"blur more":return J(J({},t),{filterID:1114403405});case"box blur":return J(J({},t),{Fltr:{_name:"Box Blur",_classID:"boxblur","Rds ":rl(e.filter)},filterID:697});case"gaussian blur":return J(J({},t),{Fltr:{_name:"Gaussian Blur",_classID:"GsnB","Rds ":rl(e.filter)},filterID:1198747202});case"motion blur":return J(J({},t),{Fltr:{_name:"Motion Blur",_classID:"MtnB",Angl:e.filter.angle,Dstn:Wn(e.filter.distance,"distance")},filterID:1299476034});case"radial blur":return J(J({},t),{Fltr:{_name:"Radial Blur",_classID:"RdlB",Amnt:e.filter.amount,BlrM:qte.encode(e.filter.method),BlrQ:Kte.encode(e.filter.quality)},filterID:1382313026});case"shape blur":return J(J({},t),{Fltr:{_name:"Shape Blur",_classID:"shapeBlur","Rds ":rl(e.filter),customShape:{_name:"",_classID:"customShape","Nm  ":e.filter.customShape.name,Idnt:e.filter.customShape.id}},filterID:702});case"smart blur":return J(J({},t),{Fltr:{_name:"Smart Blur",_classID:"SmrB","Rds ":e.filter.radius,Thsh:e.filter.threshold,SmBQ:Xte.encode(e.filter.quality),SmBM:Zte.encode(e.filter.mode)},filterID:1399681602});case"surface blur":return J(J({},t),{Fltr:{_name:"Surface Blur",_classID:"surfaceBlur","Rds ":rl(e.filter),Thsh:e.filter.threshold},filterID:701});case"displace":return J(J({},t),{Fltr:{_name:"Displace",_classID:"Dspl",HrzS:e.filter.horizontalScale,VrtS:e.filter.verticalScale,DspM:Yte.encode(e.filter.displacementMap),UndA:wf.encode(e.filter.undefinedAreas),DspF:{sig:e.filter.displacementFile.signature,path:e.filter.displacementFile.path}},filterID:1148416108});case"pinch":return J(J({},t),{Fltr:{_name:"Pinch",_classID:"Pnch",Amnt:e.filter.amount},filterID:1349411688});case"polar coordinates":return J(J({},t),{Fltr:{_name:"Polar Coordinates",_classID:"Plr ",Cnvr:Qte.encode(e.filter.conversion)},filterID:1349284384});case"ripple":return J(J({},t),{Fltr:{_name:"Ripple",_classID:"Rple",Amnt:e.filter.amount,RplS:Jte.encode(e.filter.size)},filterID:1383099493});case"shear":return J(J({},t),{Fltr:{_name:"Shear",_classID:"Shr ",ShrP:e.filter.shearPoints.map(function(c){return{_name:"",_classID:"Pnt ",Hrzn:c.x,Vrtc:c.y}}),UndA:wf.encode(e.filter.undefinedAreas),ShrS:e.filter.shearStart,ShrE:e.filter.shearEnd},filterID:1399353888});case"spherize":return J(J({},t),{Fltr:{_name:"Spherize",_classID:"Sphr",Amnt:e.filter.amount,SphM:ene.encode(e.filter.mode)},filterID:1399875698});case"twirl":return J(J({},t),{Fltr:{_name:"Twirl",_classID:"Twrl",Angl:e.filter.angle},filterID:1417114220});case"wave":return J(J({},t),{Fltr:{_name:"Wave",_classID:"Wave",Wvtp:tne.encode(e.filter.type),NmbG:e.filter.numberOfGenerators,WLMn:e.filter.wavelength.min,WLMx:e.filter.wavelength.max,AmMn:e.filter.amplitude.min,AmMx:e.filter.amplitude.max,SclH:e.filter.scale.x,SclV:e.filter.scale.y,UndA:wf.encode(e.filter.undefinedAreas),RndS:e.filter.randomSeed},filterID:1466005093});case"zigzag":return J(J({},t),{Fltr:{_name:"ZigZag",_classID:"ZgZg",Amnt:e.filter.amount,NmbR:e.filter.ridges,ZZTy:nne.encode(e.filter.style)},filterID:1516722791});case"add noise":return J(J({},t),{Fltr:{_name:"Add Noise",_classID:"AdNs",Dstr:sne.encode(e.filter.distribution),Nose:Oa(e.filter.amount),Mnch:e.filter.monochromatic,FlRs:e.filter.randomSeed},filterID:1097092723});case"despeckle":return J(J({},t),{filterID:1148416099});case"dust and scratches":return J(J({},t),{Fltr:{_name:"Dust & Scratches",_classID:"DstS","Rds ":e.filter.radius,Thsh:e.filter.threshold},filterID:1148417107});case"median":return J(J({},t),{Fltr:{_name:"Median",_classID:"Mdn ","Rds ":rl(e.filter)},filterID:1298427424});case"reduce noise":return J(J({},t),{Fltr:{_name:"Reduce Noise",_classID:"denoise",ClNs:Oa(e.filter.reduceColorNoise),Shrp:Oa(e.filter.sharpenDetails),removeJPEGArtifact:e.filter.removeJpegArtifact,channelDenoise:e.filter.channelDenoise.map(function(c){return J({_name:"",_classID:"channelDenoiseParams",Chnl:c.channels.map(function(d){return fv.encode(d)}),Amnt:c.amount},c.preserveDetails?{EdgF:c.preserveDetails}:{})}),preset:e.filter.preset},filterID:633});case"color halftone":return J(J({},t),{Fltr:{_name:"Color Halftone",_classID:"ClrH","Rds ":e.filter.radius,Ang1:e.filter.angle1,Ang2:e.filter.angle2,Ang3:e.filter.angle3,Ang4:e.filter.angle4},filterID:1131180616});case"crystallize":return J(J({},t),{Fltr:{_name:"Crystallize",_classID:"Crst",ClSz:e.filter.cellSize,FlRs:e.filter.randomSeed},filterID:1131574132});case"facet":return J(J({},t),{filterID:1180922912});case"fragment":return J(J({},t),{filterID:1181902701});case"mezzotint":return J(J({},t),{Fltr:{_name:"Mezzotint",_classID:"Mztn",MztT:ine.encode(e.filter.type),FlRs:e.filter.randomSeed},filterID:1299870830});case"mosaic":return J(J({},t),{Fltr:{_name:"Mosaic",_classID:"Msc ",ClSz:Wn(e.filter.cellSize,"cellSize")},filterID:1299407648});case"pointillize":return J(J({},t),{Fltr:{_name:"Pointillize",_classID:"Pntl",ClSz:e.filter.cellSize,FlRs:e.filter.randomSeed},filterID:1349416044});case"clouds":return J(J({},t),{Fltr:{_name:"Clouds",_classID:"Clds",FlRs:e.filter.randomSeed},filterID:1131177075});case"difference clouds":return J(J({},t),{Fltr:{_name:"Difference Clouds",_classID:"DfrC",FlRs:e.filter.randomSeed},filterID:1147564611});case"fibers":return J(J({},t),{Fltr:{_name:"Fibers",_classID:"Fbrs",Vrnc:e.filter.variance,Strg:e.filter.strength,RndS:e.filter.randomSeed},filterID:1180856947});case"lens flare":return J(J({},t),{Fltr:{_name:"Lens Flare",_classID:"LnsF",Brgh:e.filter.brightness,FlrC:{_name:"",_classID:"Pnt ",Hrzn:e.filter.position.x,Vrtc:e.filter.position.y},"Lns ":one.encode(e.filter.lensType)},filterID:1282306886});case"sharpen":return J(J({},t),{filterID:1399353968});case"sharpen edges":return J(J({},t),{filterID:1399353925});case"sharpen more":return J(J({},t),{filterID:1399353933});case"smart sharpen":return J(J({},t),{Fltr:{_name:"Smart Sharpen",_classID:"smartSharpen",Amnt:Oa(e.filter.amount),"Rds ":rl(e.filter),Thsh:e.filter.threshold,Angl:e.filter.angle,moreAccurate:e.filter.moreAccurate,blur:ane.encode(e.filter.blur),preset:e.filter.preset,sdwM:{_name:"Parameters",_classID:"adaptCorrectTones",Amnt:Oa(e.filter.shadow.fadeAmount),Wdth:Oa(e.filter.shadow.tonalWidth),"Rds ":e.filter.shadow.radius},hglM:{_name:"Parameters",_classID:"adaptCorrectTones",Amnt:Oa(e.filter.highlight.fadeAmount),Wdth:Oa(e.filter.highlight.tonalWidth),"Rds ":e.filter.highlight.radius}},filterID:698});case"unsharp mask":return J(J({},t),{Fltr:{_name:"Unsharp Mask",_classID:"UnsM",Amnt:Oa(e.filter.amount),"Rds ":rl(e.filter),Thsh:e.filter.threshold},filterID:1433301837});case"diffuse":return J(J({},t),{Fltr:{_name:"Diffuse",_classID:"Dfs ","Md  ":rne.encode(e.filter.mode),FlRs:e.filter.randomSeed},filterID:1147564832});case"emboss":return J(J({},t),{Fltr:{_name:"Emboss",_classID:"Embs",Angl:e.filter.angle,Hght:e.filter.height,Amnt:e.filter.amount},filterID:1164796531});case"extrude":return J(J({},t),{Fltr:{_name:"Extrude",_classID:"Extr",ExtS:e.filter.size,ExtD:e.filter.depth,ExtF:e.filter.solidFrontFaces,ExtM:e.filter.maskIncompleteBlocks,ExtT:lne.encode(e.filter.type),ExtR:cne.encode(e.filter.depthMode),FlRs:e.filter.randomSeed},filterID:1165522034});case"find edges":return J(J({},t),{filterID:1181639749});case"solarize":return J(J({},t),{filterID:1399616122});case"tiles":return J(J({},t),{Fltr:{_name:"Tiles",_classID:"Tls ",TlNm:e.filter.numberOfTiles,TlOf:e.filter.maximumOffset,FlCl:dne.encode(e.filter.fillEmptyAreaWith),FlRs:e.filter.randomSeed},filterID:1416393504});case"trace contour":return J(J({},t),{Fltr:{_name:"Trace Contour",_classID:"TrcC","Lvl ":e.filter.level,"Edg ":une.encode(e.filter.edge)},filterID:1416782659});case"wind":return J(J({},t),{Fltr:{_name:"Wind",_classID:"Wnd ",WndM:hne.encode(e.filter.method),Drct:pne.encode(e.filter.direction)},filterID:1466852384});case"de-interlace":return J(J({},t),{Fltr:{_name:"De-Interlace",_classID:"Dntr",IntE:fne.encode(e.filter.eliminate),IntC:mne.encode(e.filter.newFieldsBy)},filterID:1148089458});case"ntsc colors":return J(J({},t),{filterID:1314149187});case"invert":return J(J({},t),{filterID:1231976050});case"custom":return J(J({},t),{Fltr:{_name:"Custom",_classID:"Cstm","Scl ":e.filter.scale,Ofst:e.filter.offset,Mtrx:e.filter.matrix},filterID:1131639917});case"high pass":return J(J({},t),{Fltr:{_name:"High Pass",_classID:"HghP","Rds ":rl(e.filter)},filterID:1214736464});case"maximum":return J(J({},t),{Fltr:{_name:"Maximum",_classID:"Mxm ","Rds ":rl(e.filter)},filterID:1299737888});case"minimum":return J(J({},t),{Fltr:{_name:"Minimum",_classID:"Mnm ","Rds ":rl(e.filter)},filterID:1299082528});case"offset":return J(J({},t),{Fltr:{_name:"Offset",_classID:"Ofst",Hrzn:e.filter.horizontal,Vrtc:e.filter.vertical,"Fl  ":gne.encode(e.filter.undefinedAreas)},filterID:1332114292});case"puppet":return J(J({},t),{Fltr:{_name:"Rigid Transform",_classID:"rigidTransform",null:["Ordn.Trgt"],rigidType:e.filter.rigidType,puppetShapeList:e.filter.puppetShapeList.map(function(c){return{_name:"",_classID:"puppetShape",rigidType:c.rigidType,VrsM:1,VrsN:0,originalVertexArray:SE(new Float32Array(y0(c.originalVertexArray))),deformedVertexArray:SE(new Float32Array(y0(c.deformedVertexArray))),indexArray:SE(new Uint32Array(c.indexArray)),pinOffsets:y0(c.pinOffsets),posFinalPins:y0(c.posFinalPins),pinVertexIndices:c.pinVertexIndices,PinP:y0(c.pinPosition),PnRt:c.pinRotation,PnOv:c.pinOverlay,PnDp:c.pinDepth,meshQuality:c.meshQuality,meshExpansion:c.meshExpansion,meshRigidity:c.meshRigidity,imageResolution:c.imageResolution,meshBoundaryPath:{_name:"",_classID:"pathClass",pathComponents:c.meshBoundaryPath.pathComponents.map(function(d){return{_name:"",_classID:"PaCm",shapeOperation:"shapeOperation.".concat(d.shapeOperation),SbpL:d.paths.map(function(u){return{_name:"",_classID:"Sbpl",Clsp:u.closed,"Pts ":u.points.map(function(p){return{_name:"",_classID:"Pthp",Anch:x0(p.anchor),"Fwd ":x0(p.forward),"Bwd ":x0(p.backward),Smoo:p.smooth}})}})}})},selectedPin:c.selectedPin}}),PuX0:e.filter.bounds[0].x,PuX1:e.filter.bounds[1].x,PuX2:e.filter.bounds[2].x,PuX3:e.filter.bounds[3].x,PuY0:e.filter.bounds[0].y,PuY1:e.filter.bounds[1].y,PuY2:e.filter.bounds[2].y,PuY3:e.filter.bounds[3].y},filterID:991});case"oil paint plugin":{for(var n={},s=0;s<e.filter.parameters.length;s++){var i=e.filter.parameters[s],o=i.name,r=i.value,l="".concat(aa[Math.floor(s/aa.length)]).concat(aa[s%aa.length]);n["PN".concat(l)]=o,n["PT".concat(l)]=0,n["PF".concat(l)]=r}return J(J({},t),{Fltr:J({_name:"Oil Paint Plugin",_classID:"PbPl",KnNm:e.filter.name,GpuY:e.filter.gpu,LIWy:e.filter.lighting,FPth:"1"},n),filterID:1348620396})}case"oil paint":return J(J({},t),{Fltr:{_name:"Oil Paint",_classID:"oilPaint",lightingOn:e.filter.lightingOn,stylization:e.filter.stylization,cleanliness:e.filter.cleanliness,brushScale:e.filter.brushScale,microBrush:e.filter.microBrush,LghD:e.filter.lightDirection,specularity:e.filter.specularity},filterID:1122});case"liquify":return J(J({},t),{Fltr:{_name:"Liquify",_classID:"LqFy",LqMe:e.filter.liquifyMesh},filterID:1282492025});case"perspective warp":return J(J({},t),{Fltr:{_name:"Perspective Warp",_classID:"perspectiveWarpTransform",vertices:e.filter.vertices.map(x0),warpedVertices:e.filter.warpedVertices.map(x0),quads:e.filter.quads.map(function(c){return{indices:c}})},filterID:442});case"curves":return J(J({},t),{Fltr:J({_name:"Curves",_classID:"Crvs",presetKind:vne.encode(e.filter.presetKind)},e.filter.adjustments?{Adjs:e.filter.adjustments.map(function(c){return"curve"in c?{_name:"",_classID:"CrvA",Chnl:c.channels.map(fv.encode),"Crv ":c.curve.map(function(d){return J({_name:"",_classID:"Pnt ",Hrzn:d.x,Vrtc:d.y},d.curved?{Cnty:!0}:{})})}:{_name:"",_classID:"CrvA",Chnl:c.channels.map(fv.encode),Mpng:c.values}})}:{}),filterID:1131574899});case"brightness/contrast":return J(J({},t),{Fltr:{_name:"Brightness/Contrast",_classID:"BrgC",Brgh:e.filter.brightness,Cntr:e.filter.contrast,useLegacy:!!e.filter.useLegacy},filterID:1114793795});default:throw new Error("Unknow filter type: ".concat(e.type))}}function Mne(e){if(e.warp)return e.warp;if(!e.width||!e.height)throw new Error("You must provide width and height of the linked image in placedLayer");var t=e.width,n=e.height,s=0,i=t/3,o=t*2/3,r=t,l=0,c=n/3,d=n*2/3,u=n;return{style:"custom",value:0,perspective:0,perspectiveOther:0,rotate:"horizontal",bounds:{top:{value:0,units:"Pixels"},left:{value:0,units:"Pixels"},bottom:{value:n,units:"Pixels"},right:{value:t,units:"Pixels"}},uOrder:4,vOrder:4,customEnvelopeWarp:{meshPoints:[{x:s,y:l},{x:i,y:l},{x:o,y:l},{x:r,y:l},{x:s,y:c},{x:i,y:c},{x:o,y:c},{x:r,y:c},{x:s,y:d},{x:i,y:d},{x:o,y:d},{x:r,y:d},{x:s,y:u},{x:i,y:u},{x:o,y:u},{x:r,y:u}]}}}ot("SoLd",jn("placedLayer"),function(e,t,n){if(Ln(e)!=="soLD")throw new Error("Invalid SoLd type");var s=et(e);if(s!==4&&s!==5)throw new Error("Invalid SoLd version");var i=Ht(e,!0);t.placedLayer={id:i.Idnt,placed:i.placed,type:sf[i.Type],pageNumber:i.PgNm,totalPages:i.totalPages,frameStep:fo(i.frameStep),duration:fo(i.duration),frameCount:i.frameCount,transform:i.Trnf,width:i["Sz  "].Wdth,height:i["Sz  "].Hght,resolution:bn(i.Rslt),warp:Dne(i.quiltWarp||i.warp)},i.nonAffineTransform&&i.nonAffineTransform.some(function(o,r){return o!==i.Trnf[r]})&&(t.placedLayer.nonAffineTransform=i.nonAffineTransform),i.Crop&&(t.placedLayer.crop=i.Crop),i.comp&&(t.placedLayer.comp=i.comp),i.compInfo&&(t.placedLayer.compInfo={compID:i.compInfo.compID,originalCompID:i.compInfo.originalCompID}),i.filterFX&&(t.placedLayer.filter=A$e(i.filterFX,e)),Ye(e,n())},function(e,t){var n,s;ht(e,"soLD"),lt(e,4);var i=t.placedLayer;if(!i.id||typeof i.id!="string"||!/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/.test(i.id))throw new Error("Placed layer ID must be in a GUID format (example: 20953ddb-9391-11ec-b4f1-c15674f50bc4)");var o=J(J({Idnt:i.id,placed:(n=i.placed)!==null&&n!==void 0?n:i.id,PgNm:i.pageNumber||1,totalPages:i.totalPages||1},i.crop?{Crop:i.crop}:{}),{frameStep:i.frameStep||{numerator:0,denominator:600},duration:i.duration||{numerator:0,denominator:600},frameCount:i.frameCount||0,Annt:16,Type:sf.indexOf(i.type),Trnf:i.transform,nonAffineTransform:(s=i.nonAffineTransform)!==null&&s!==void 0?s:i.transform,warp:UC(Mne(i)),"Sz  ":{_name:"",_classID:"Pnt ",Wdth:i.width||0,Hght:i.height||0},Rslt:i.resolution?Wn(i.resolution,"resolution"):{units:"Density",value:72}});if(i.filter&&(o.filterFX={_name:"",_classID:"filterFXStyle",enab:i.filter.enabled,validAtPosition:i.filter.validAtPosition,filterMaskEnable:i.filter.maskEnabled,filterMaskLinked:i.filter.maskLinked,filterMaskExtendWithWhite:i.filter.maskExtendWithWhite,filterFXList:i.filter.list.map(function(l){return P$e(l)})}),i.warp&&V6(i.warp)){var r=UC(i.warp);o.quiltWarp=r,o.warp={warpStyle:"warpStyle.warpNone",warpValue:r.warpValue,warpPerspective:r.warpPerspective,warpPerspectiveOther:r.warpPerspectiveOther,warpRotate:r.warpRotate,bounds:r.bounds,uOrder:r.uOrder,vOrder:r.vOrder}}else delete o.quiltWarp;i.comp&&(o.comp=i.comp),i.compInfo&&(o.compInfo=i.compInfo),Wt(e,"","null",o,o.quiltWarp?"quiltWarp":"warp")});Gm("SoLE","SoLd");ot("fxrp",jn("referencePoint"),function(e,t){t.referencePoint={x:er(e),y:er(e)}},function(e,t){tr(e,t.referencePoint.x),tr(e,t.referencePoint.y)});ot("Lr16",function(){return!1},function(e,t,n,s,i){xne(e,s,i)},function(e,t){});ot("Lr32",function(){return!1},function(e,t,n,s,i){xne(e,s,i)},function(e,t){});ot("LMsk",jn("userMask"),function(e,t){t.userMask={colorSpace:oi(e),opacity:Ge(e)/255};var n=We(e);if(n!==128)throw new Error("Invalid flag value");Ye(e,1)},function(e,t){var n=t.userMask;li(e,n.colorSpace),_e(e,T6(n.opacity,0,1)*255),Le(e,128),tn(e,1)});ot("Patt",function(e){return!e},function(e,t,n){n()&&Ye(e,n())},function(e,t){});function qB(e){var t=et(e),n=et(e),s=et(e),i=et(e);return{top:t,left:n,bottom:s,right:i}}function KB(e,t){lt(e,t.top),lt(e,t.left),lt(e,t.bottom),lt(e,t.right)}ot("Anno",function(e){return e.annotations!==void 0},function(e,t,n){var s=Ge(e),i=Ge(e);if(s!==2||i!==1)throw new Error("Invalid Anno version");for(var o=Oe(e),r=[],l=0;l<o;l++){Oe(e);var c=Ln(e),d=!!We(e);We(e),Ge(e);var u=qB(e),p=qB(e),m=oi(e),f=uh(e,2),g=uh(e,2),v=uh(e,2);Oe(e),Ln(e);var b=Oe(e),C=void 0;if(c==="txtA")b>=2&&Ge(e)===65279?C=O6(e,(b-2)/2):(e.offset-=2,C=N6(e,b)),C=C.replace(/\r/g,`
`);else if(c==="sndA")C=io(e,b);else throw new Error("Unknown annotation type");r.push({type:c==="txtA"?"text":"sound",open:d,iconLocation:u,popupLocation:p,color:m,author:f,name:g,date:v,data:C})}t.annotations=r,Ye(e,n())},function(e,t){var n=t.annotations;_e(e,2),_e(e,1),ze(e,n.length);for(var s=0,i=n;s<i.length;s++){var o=i[s],r=o.type==="sound";if(r&&!(o.data instanceof Uint8Array))throw new Error("Sound annotation data should be Uint8Array");if(!r&&typeof o.data!="string")throw new Error("Text annotation data should be string");var l=e.offset;ze(e,0),ht(e,r?"sndA":"txtA"),Le(e,o.open?1:0),Le(e,28),_e(e,1),KB(e,o.iconLocation),KB(e,o.popupLocation),li(e,o.color),Wd(e,o.author||"",2),Wd(e,o.name||"",2),Wd(e,o.date||"",2);var c=e.offset;ze(e,0),ht(e,r?"sndM":"txtC"),ze(e,0);var d=e.offset;if(r)Kr(e,o.data);else{_e(e,65279);for(var u=o.data.replace(/\n/g,"\r"),p=0;p<u.length;p++)_e(e,u.charCodeAt(p))}e.view.setUint32(l,e.offset-l,!1),e.view.setUint32(c,e.offset-c,!1),e.view.setUint32(d-4,e.offset-d,!1)}});function Lne(e){ot(e,function(t){var n=t;return!(!n.linkedFiles||!n.linkedFiles.length||e==="lnkE"&&!n.linkedFiles.some(function(s){return s.linkedFile}))},function(t,n,s,i){var o=n;for(o.linkedFiles=o.linkedFiles||[];s()>8;){var r=wE(t),l=t.offset,c=Ln(t),d=et(t),u=uh(t,1),p=hi(t),m=Ln(t).trim(),f=Ln(t).trim(),g=wE(t),v=We(t),b=v?Ht(t):void 0,C=c==="liFE"?Ht(t):void 0,y={id:u,name:p};if(m&&(y.type=m),f&&(y.creator=f),b&&(y.descriptor={compInfo:{compID:b.compInfo.compID,originalCompID:b.compInfo.originalCompID}}),c==="liFE"&&d>3){var x=et(t),w=We(t),_=We(t),S=We(t),I=We(t),k=er(t),E=Math.floor(k),j=(k-E)*1e3;y.time=new Date(Date.UTC(x,w,_,S,I,E,j)).toISOString()}var P=c==="liFE"?wE(t):0;for(c==="liFA"&&Ye(t,8),c==="liFD"&&(y.data=io(t,g)),d>=5&&(y.childDocumentID=hi(t)),d>=6&&(y.assetModTime=er(t)),d>=7&&(y.assetLockedState=We(t)),c==="liFE"&&d===2&&(y.data=io(t,P)),t.skipLinkedFilesData&&(y.data=void 0),e==="lnkE"&&(y.linkedFile={fileSize:P,name:C?.["Nm  "]||"",fullPath:C?.fullPath||"",originalPath:C?.originalPath||"",relativePath:C?.relPath||""}),o.linkedFiles.push(y);r%4;)r++;t.offset=l+r}Ye(t,s())},function(t,n){for(var s,i,o,r,l,c,d,u,p,m=n,f=0,g=m.linkedFiles;f<g.length;f++){var v=g[f];if(e==="lnkE"==!!v.linkedFile){var b=2;v.assetLockedState!=null?b=7:v.assetModTime!=null?b=6:v.childDocumentID!=null?b=5:e=="lnkE"&&(b=3),_E(t,0);var C=t.offset;if(ht(t,e==="lnkE"?"liFE":v.data?"liFD":"liFA"),lt(t,b),!v.id||typeof v.id!="string"||!/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/.test(v.id))throw new Error("Linked file ID must be in a GUID format (example: 20953ddb-9391-11ec-b4f1-c15674f50bc4)");if(Wd(t,v.id,1),jh(t,v.name||""),ht(t,v.type?"".concat(v.type,"    ").substring(0,4):"    "),ht(t,v.creator?"".concat(v.creator,"    ").substring(0,4):"\0\0\0\0"),_E(t,v.data?v.data.byteLength:0),v.descriptor&&v.descriptor.compInfo){var y={compInfo:{compID:v.descriptor.compInfo.compID,originalCompID:v.descriptor.compInfo.originalCompID}};Le(t,1),Wt(t,"","null",y)}else Le(t,0);if(e==="lnkE"){var y={descVersion:2,"Nm  ":(i=(s=v.linkedFile)===null||s===void 0?void 0:s.name)!==null&&i!==void 0?i:"",fullPath:(r=(o=v.linkedFile)===null||o===void 0?void 0:o.fullPath)!==null&&r!==void 0?r:"",originalPath:(c=(l=v.linkedFile)===null||l===void 0?void 0:l.originalPath)!==null&&c!==void 0?c:"",relPath:(u=(d=v.linkedFile)===null||d===void 0?void 0:d.relativePath)!==null&&u!==void 0?u:""};Wt(t,"","ExternalFileLink",y);var x=v.time?new Date(v.time):new Date;lt(t,x.getUTCFullYear()),Le(t,x.getUTCMonth()),Le(t,x.getUTCDate()),Le(t,x.getUTCHours()),Le(t,x.getUTCMinutes()),tr(t,x.getUTCSeconds()+x.getUTCMilliseconds()/1e3)}v.data?Kr(t,v.data):_E(t,((p=v.linkedFile)===null||p===void 0?void 0:p.fileSize)||0),b>=5&&jh(t,v.childDocumentID||""),b>=6&&tr(t,v.assetModTime||0),b>=7&&Le(t,v.assetLockedState||0);var w=t.offset-C;for(t.view.setUint32(C-4,w,!1);w%4;)w++,Le(t,0)}}})}Lne("lnk2");Lne("lnkE");Gm("lnkD","lnk2");Gm("lnk3","lnk2");ot("pths",jn("pathList"),function(e,t){Ht(e,!0),t.pathList=[]},function(e,t){var n={pathList:[]};Wt(e,"","pathsDataClass",n)});ot("lyvr",jn("version"),function(e,t){return t.version=Oe(e)},function(e,t){return ze(e,t.version)});ot("lfxs",function(){return!1},function(e,t,n){var s=Oe(e);if(s!==0)throw new Error("Invalid lfxs version");var i=Ht(e);t.effects=k1(i,!!e.logMissingFeatures),Ye(e,n())},function(e,t,n,s){var i=S1(t.effects,!!s.logMissingFeatures,!0);ze(e,0),Wt(e,"","null",i)});function uo(e){return function(t){return!!t.adjustment&&t.adjustment.type===e}}ot("brit",uo("brightness/contrast"),function(e,t,n){t.adjustment||(t.adjustment={type:"brightness/contrast",brightness:Kt(e),contrast:Kt(e),meanValue:Kt(e),labColorOnly:!!We(e),useLegacy:!0}),Ye(e,n())},function(e,t){var n,s=t.adjustment;ln(e,s.brightness||0),ln(e,s.contrast||0),ln(e,(n=s.meanValue)!==null&&n!==void 0?n:127),Le(e,s.labColorOnly?1:0),tn(e,1)});function kx(e){var t=Kt(e),n=Kt(e),s=Kt(e),i=Kt(e),o=Kt(e)/100;return{shadowInput:t,highlightInput:n,shadowOutput:s,highlightOutput:i,midtoneInput:o}}function C0(e,t){ln(e,t.shadowInput),ln(e,t.highlightInput),ln(e,t.shadowOutput),ln(e,t.highlightOutput),ln(e,Math.round(t.midtoneInput*100))}ot("levl",uo("levels"),function(e,t,n){if(Ge(e)!==2)throw new Error("Invalid levl version");t.adjustment=J(J({},t.adjustment),{type:"levels",rgb:kx(e),red:kx(e),green:kx(e),blue:kx(e)}),Ye(e,n())},function(e,t){var n=t.adjustment,s={shadowInput:0,highlightInput:255,shadowOutput:0,highlightOutput:255,midtoneInput:1};_e(e,2),C0(e,n.rgb||s),C0(e,n.red||s),C0(e,n.blue||s),C0(e,n.green||s);for(var i=0;i<59;i++)C0(e,s)});function Ix(e){for(var t=Ge(e),n=[],s=0;s<t;s++){var i=Kt(e),o=Kt(e);n.push({input:o,output:i})}return n}function cd(e,t){_e(e,t.length);for(var n=0,s=t;n<s.length;n++){var i=s[n];_e(e,i.output),_e(e,i.input)}}ot("curv",uo("curves"),function(e,t,n){if(We(e),Ge(e)!==1)throw new Error("Invalid curv version");Ge(e);var s=Ge(e),i={type:"curves"};s&1&&(i.rgb=Ix(e)),s&2&&(i.red=Ix(e)),s&4&&(i.green=Ix(e)),s&8&&(i.blue=Ix(e)),t.adjustment=J(J({},t.adjustment),i),Ye(e,n())},function(e,t){var n=t.adjustment,s=n.rgb,i=n.red,o=n.green,r=n.blue,l=0,c=0;s&&s.length&&(l|=1,c++),i&&i.length&&(l|=2,c++),o&&o.length&&(l|=4,c++),r&&r.length&&(l|=8,c++),Le(e,0),_e(e,1),_e(e,0),_e(e,l),s&&s.length&&cd(e,s),i&&i.length&&cd(e,i),o&&o.length&&cd(e,o),r&&r.length&&cd(e,r),ht(e,"Crv "),_e(e,4),_e(e,0),_e(e,c),s&&s.length&&(_e(e,0),cd(e,s)),i&&i.length&&(_e(e,1),cd(e,i)),o&&o.length&&(_e(e,2),cd(e,o)),r&&r.length&&(_e(e,3),cd(e,r)),tn(e,2)});ot("expA",uo("exposure"),function(e,t,n){if(Ge(e)!==1)throw new Error("Invalid expA version");t.adjustment=J(J({},t.adjustment),{type:"exposure",exposure:Rr(e),offset:Rr(e),gamma:Rr(e)}),Ye(e,n())},function(e,t){var n=t.adjustment;_e(e,1),Or(e,n.exposure),Or(e,n.offset),Or(e,n.gamma),tn(e,2)});ot("vibA",uo("vibrance"),function(e,t,n){var s=Ht(e);t.adjustment={type:"vibrance"},s.vibrance!==void 0&&(t.adjustment.vibrance=s.vibrance),s.Strt!==void 0&&(t.adjustment.saturation=s.Strt),Ye(e,n())},function(e,t){var n=t.adjustment,s={};n.vibrance!==void 0&&(s.vibrance=n.vibrance),n.saturation!==void 0&&(s.Strt=n.saturation),Wt(e,"","null",s)});function Du(e){return{a:Kt(e),b:Kt(e),c:Kt(e),d:Kt(e),hue:Kt(e),saturation:Kt(e),lightness:Kt(e)}}function Mu(e,t){var n=t||{};ln(e,n.a||0),ln(e,n.b||0),ln(e,n.c||0),ln(e,n.d||0),ln(e,n.hue||0),ln(e,n.saturation||0),ln(e,n.lightness||0)}ot("hue2",uo("hue/saturation"),function(e,t,n){if(Ge(e)!==2)throw new Error("Invalid hue2 version");t.adjustment=J(J({},t.adjustment),{type:"hue/saturation",master:Du(e),reds:Du(e),yellows:Du(e),greens:Du(e),cyans:Du(e),blues:Du(e),magentas:Du(e)}),Ye(e,n())},function(e,t){var n=t.adjustment;_e(e,2),Mu(e,n.master),Mu(e,n.reds),Mu(e,n.yellows),Mu(e,n.greens),Mu(e,n.cyans),Mu(e,n.blues),Mu(e,n.magentas)});function kE(e){return{cyanRed:Kt(e),magentaGreen:Kt(e),yellowBlue:Kt(e)}}function IE(e,t){ln(e,t.cyanRed||0),ln(e,t.magentaGreen||0),ln(e,t.yellowBlue||0)}ot("blnc",uo("color balance"),function(e,t,n){t.adjustment={type:"color balance",shadows:kE(e),midtones:kE(e),highlights:kE(e),preserveLuminosity:!!We(e)},Ye(e,n())},function(e,t){var n=t.adjustment;IE(e,n.shadows||{}),IE(e,n.midtones||{}),IE(e,n.highlights||{}),Le(e,n.preserveLuminosity?1:0),tn(e,1)});ot("blwh",uo("black & white"),function(e,t,n){var s=Ht(e);t.adjustment={type:"black & white",reds:s["Rd  "],yellows:s.Yllw,greens:s["Grn "],cyans:s["Cyn "],blues:s["Bl  "],magentas:s.Mgnt,useTint:!!s.useTint,presetKind:s.bwPresetKind,presetFileName:s.blackAndWhitePresetFileName},s.tintColor!==void 0&&(t.adjustment.tintColor=Fr(s.tintColor)),Ye(e,n())},function(e,t){var n=t.adjustment,s={"Rd  ":n.reds||0,Yllw:n.yellows||0,"Grn ":n.greens||0,"Cyn ":n.cyans||0,"Bl  ":n.blues||0,Mgnt:n.magentas||0,useTint:!!n.useTint,tintColor:Br(n.tintColor),bwPresetKind:n.presetKind||0,blackAndWhitePresetFileName:n.presetFileName||""};Wt(e,"","null",s)});ot("phfl",uo("photo filter"),function(e,t,n){var s=Ge(e);if(s!==2&&s!==3)throw new Error("Invalid phfl version");var i;s===2?i=oi(e):i={l:et(e)/100,a:et(e)/100,b:et(e)/100},t.adjustment={type:"photo filter",color:i,density:Oe(e)/100,preserveLuminosity:!!We(e)},Ye(e,n())},function(e,t){var n=t.adjustment;_e(e,2),li(e,n.color||{l:0,a:0,b:0}),ze(e,(n.density||0)*100),Le(e,n.preserveLuminosity?1:0),tn(e,3)});function jx(e){var t=Kt(e),n=Kt(e),s=Kt(e);Ye(e,2);var i=Kt(e);return{red:t,green:n,blue:s,constant:i}}function w0(e,t){var n=t||{};ln(e,n.red),ln(e,n.green),ln(e,n.blue),tn(e,2),ln(e,n.constant)}ot("mixr",uo("channel mixer"),function(e,t,n){if(Ge(e)!==1)throw new Error("Invalid mixr version");var s=t.adjustment=J(J({},t.adjustment),{type:"channel mixer",monochrome:!!Ge(e)});s.monochrome||(s.red=jx(e),s.green=jx(e),s.blue=jx(e)),s.gray=jx(e),Ye(e,n())},function(e,t){var n=t.adjustment;_e(e,1),_e(e,n.monochrome?1:0),n.monochrome?(w0(e,n.gray),tn(e,3*5*2)):(w0(e,n.red),w0(e,n.green),w0(e,n.blue),w0(e,n.gray))});var ZB=ft("colorLookupType","3DLUT",{"3dlut":"3DLUT",abstractProfile:"abstractProfile",deviceLinkProfile:"deviceLinkProfile"}),XB=ft("LUTFormatType","look",{look:"LUTFormatLOOK",cube:"LUTFormatCUBE","3dl":"LUTFormat3DL"}),Ex=ft("colorLookupOrder","rgb",{rgb:"rgbOrder",bgr:"bgrOrder"});ot("clrL",uo("color lookup"),function(e,t,n){if(Ge(e)!==1)throw new Error("Invalid clrL version");var s=Ht(e);t.adjustment={type:"color lookup"};var i=t.adjustment;s.lookupType!==void 0&&(i.lookupType=ZB.decode(s.lookupType)),s["Nm  "]!==void 0&&(i.name=s["Nm  "]),s.Dthr!==void 0&&(i.dither=s.Dthr),s.profile!==void 0&&(i.profile=s.profile),s.LUTFormat!==void 0&&(i.lutFormat=XB.decode(s.LUTFormat)),s.dataOrder!==void 0&&(i.dataOrder=Ex.decode(s.dataOrder)),s.tableOrder!==void 0&&(i.tableOrder=Ex.decode(s.tableOrder)),s.LUT3DFileData!==void 0&&(i.lut3DFileData=s.LUT3DFileData),s.LUT3DFileName!==void 0&&(i.lut3DFileName=s.LUT3DFileName),Ye(e,n())},function(e,t){var n=t.adjustment,s={};n.lookupType!==void 0&&(s.lookupType=ZB.encode(n.lookupType)),n.name!==void 0&&(s["Nm  "]=n.name),n.dither!==void 0&&(s.Dthr=n.dither),n.profile!==void 0&&(s.profile=n.profile),n.lutFormat!==void 0&&(s.LUTFormat=XB.encode(n.lutFormat)),n.dataOrder!==void 0&&(s.dataOrder=Ex.encode(n.dataOrder)),n.tableOrder!==void 0&&(s.tableOrder=Ex.encode(n.tableOrder)),n.lut3DFileData!==void 0&&(s.LUT3DFileData=n.lut3DFileData),n.lut3DFileName!==void 0&&(s.LUT3DFileName=n.lut3DFileName),_e(e,1),Wt(e,"","null",s)});ot("nvrt",uo("invert"),function(e,t,n){t.adjustment={type:"invert"},Ye(e,n())},function(){});ot("post",uo("posterize"),function(e,t,n){t.adjustment={type:"posterize",levels:Ge(e)},Ye(e,n())},function(e,t){var n,s=t.adjustment;_e(e,(n=s.levels)!==null&&n!==void 0?n:4),tn(e,2)});ot("thrs",uo("threshold"),function(e,t,n){t.adjustment={type:"threshold",level:Ge(e)},Ye(e,n())},function(e,t){var n,s=t.adjustment;_e(e,(n=s.level)!==null&&n!==void 0?n:128),tn(e,2)});var YB=["","","","rgb","hsb","","lab"];ot("grdm",uo("gradient map"),function(e,t,n){var s=Ge(e);if(s!==1&&s!==3)throw new Error("Invalid grdm version");var i={type:"gradient map",gradientType:"solid"};i.reverse=!!We(e),i.dither=!!We(e);var o=!!We(e);if(e.offset--,o){var r=Ln(e);i.method=$f.decode(r)}i.name=hi(e),i.colorStops=[],i.opacityStops=[];for(var l=Ge(e),c=0;c<l;c++)i.colorStops.push({location:Oe(e),midpoint:Oe(e)/100,color:oi(e)}),Ye(e,2);for(var d=Ge(e),c=0;c<d;c++)i.opacityStops.push({location:Oe(e),midpoint:Oe(e)/100,opacity:Ge(e)/255});var u=Ge(e);if(u!==2)throw new Error("Invalid grdm expansion count");var p=Ge(e);i.smoothness=p/4096;var m=Ge(e);if(m!==32)throw new Error("Invalid grdm length");i.gradientType=Ge(e)?"noise":"solid",i.randomSeed=Oe(e),i.addTransparency=!!Ge(e),i.restrictColors=!!Ge(e),i.roughness=Oe(e)/4096,i.colorModel=YB[Ge(e)]||"rgb",i.min=[Ge(e)/32768,Ge(e)/32768,Ge(e)/32768,Ge(e)/32768],i.max=[Ge(e)/32768,Ge(e)/32768,Ge(e)/32768,Ge(e)/32768],Ye(e,n());for(var f=0,g=i.colorStops;f<g.length;f++){var v=g[f];v.location/=p}for(var b=0,C=i.opacityStops;b<C.length;b++){var v=C[b];v.location/=p}t.adjustment=i},function(e,t){var n,s,i,o=t.adjustment;_e(e,o.method!==void 0?3:1),Le(e,o.reverse?1:0),Le(e,o.dither?1:0),o.method!==void 0&&ht(e,$f.encode(o.method)),jh(e,o.name||""),_e(e,o.colorStops&&o.colorStops.length||0);for(var r=Math.round(((n=o.smoothness)!==null&&n!==void 0?n:1)*4096),l=0,c=o.colorStops||[];l<c.length;l++){var d=c[l];ze(e,Math.round(d.location*r)),ze(e,Math.round(d.midpoint*100)),li(e,d.color),tn(e,2)}_e(e,o.opacityStops&&o.opacityStops.length||0);for(var u=0,p=o.opacityStops||[];u<p.length;u++){var d=p[u];ze(e,Math.round(d.location*r)),ze(e,Math.round(d.midpoint*100)),_e(e,Math.round(d.opacity*255))}_e(e,2),_e(e,r),_e(e,32),_e(e,o.gradientType==="noise"?1:0),ze(e,o.randomSeed||0),_e(e,o.addTransparency?1:0),_e(e,o.restrictColors?1:0),ze(e,Math.round(((s=o.roughness)!==null&&s!==void 0?s:1)*4096));var m=YB.indexOf((i=o.colorModel)!==null&&i!==void 0?i:"rgb");_e(e,m===-1?3:m);for(var f=0;f<4;f++)_e(e,Math.round((o.min&&o.min[f]||0)*32768));for(var f=0;f<4;f++)_e(e,Math.round((o.max&&o.max[f]||0)*32768));tn(e,4)});function mc(e){return{c:Kt(e),m:Kt(e),y:Kt(e),k:Kt(e)}}function gc(e,t){var n=t||{};ln(e,n.c),ln(e,n.m),ln(e,n.y),ln(e,n.k)}ot("selc",uo("selective color"),function(e,t){if(Ge(e)!==1)throw new Error("Invalid selc version");var n=Ge(e)?"absolute":"relative";Ye(e,8),t.adjustment={type:"selective color",mode:n,reds:mc(e),yellows:mc(e),greens:mc(e),cyans:mc(e),blues:mc(e),magentas:mc(e),whites:mc(e),neutrals:mc(e),blacks:mc(e)}},function(e,t){var n=t.adjustment;_e(e,1),_e(e,n.mode==="absolute"?1:0),tn(e,8),gc(e,n.reds),gc(e,n.yellows),gc(e,n.greens),gc(e,n.cyans),gc(e,n.blues),gc(e,n.magentas),gc(e,n.whites),gc(e,n.neutrals),gc(e,n.blacks)});ot("CgEd",function(e){var t=e.adjustment;return t?t.type==="brightness/contrast"&&!t.useLegacy||(t.type==="levels"||t.type==="curves"||t.type==="exposure"||t.type==="channel mixer"||t.type==="hue/saturation")&&t.presetFileName!==void 0:!1},function(e,t,n){var s=Ht(e);if(s.Vrsn!==1)throw new Error("Invalid CgEd version");"presetFileName"in s?t.adjustment=J(J({},t.adjustment),{presetKind:s.presetKind,presetFileName:s.presetFileName}):"curvesPresetFileName"in s?t.adjustment=J(J({},t.adjustment),{presetKind:s.curvesPresetKind,presetFileName:s.curvesPresetFileName}):"mixerPresetFileName"in s?t.adjustment=J(J({},t.adjustment),{presetKind:s.mixerPresetKind,presetFileName:s.mixerPresetFileName}):t.adjustment={type:"brightness/contrast",brightness:s.Brgh,contrast:s.Cntr,meanValue:s.means,useLegacy:!!s.useLegacy,labColorOnly:!!s["Lab "],auto:!!s.Auto},Ye(e,n())},function(e,t){var n,s,i,o,r=t.adjustment;if(r.type==="levels"||r.type==="exposure"||r.type==="hue/saturation"){var l={Vrsn:1,presetKind:(n=r.presetKind)!==null&&n!==void 0?n:1,presetFileName:r.presetFileName||""};Wt(e,"","null",l)}else if(r.type==="curves"){var l={Vrsn:1,curvesPresetKind:(s=r.presetKind)!==null&&s!==void 0?s:1,curvesPresetFileName:r.presetFileName||""};Wt(e,"","null",l)}else if(r.type==="channel mixer"){var l={Vrsn:1,mixerPresetKind:(i=r.presetKind)!==null&&i!==void 0?i:1,mixerPresetFileName:r.presetFileName||""};Wt(e,"","null",l)}else if(r.type==="brightness/contrast"){var l={Vrsn:1,Brgh:r.brightness||0,Cntr:r.contrast||0,means:(o=r.meanValue)!==null&&o!==void 0?o:127,"Lab ":!!r.labColorOnly,useLegacy:!!r.useLegacy,Auto:!!r.auto};Wt(e,"","null",l)}else throw new Error("Unhandled CgEd case")});function T$e(e){var t=[];function n(s){var i;if(s.children)for(var o=0,r=s.children;o<r.length;o++){var l=r[o];((i=l.text)===null||i===void 0?void 0:i.index)!==void 0&&(t[l.text.index]=l),n(l)}}return n(e),t}ot("Txt2",jn("engineData"),function(e,t,n,s){var i=io(e,n());t.engineData=BC.fromByteArray(i);var o=T$e(s),r=_ne(i),l=w$e(r),c=l.ResourceDict.TextFrameSet;if(c)for(var d=0;d<c.length;d++){var u=o[d];c[d].path&&u?.text&&(u.text.textPath=c[d].path)}},function(e,t){var n=BC.toByteArray(t.engineData);Kr(e,n)});ot("FEid",jn("filterEffectsMasks"),function(e,t,n){var s=et(e);if(s<1||s>3)throw new Error("Invalid filterEffects version ".concat(s));for(t.filterEffectsMasks=[];n()>8;){if(Oe(e))throw new Error("filterEffects: 64 bit length is not supported");var i=Oe(e),o=e.offset+i,r=uh(e,1),l=et(e);if(l!==1)throw new Error("Invalid filterEffect version ".concat(l));if(Oe(e))throw new Error("filterEffect: 64 bit length is not supported");Oe(e);for(var c=et(e),d=et(e),u=et(e),p=et(e),m=et(e),f=et(e),g=[],v=0;v<f+2;v++){var b=et(e);if(b){if(Oe(e))throw new Error("filterEffect: 64 bit length is not supported");var C=Oe(e);if(!C)throw new Error("filterEffect: Empty channel");var y=Ge(e),x=io(e,C-2);g.push({compressionMode:y,data:x})}else g.push(void 0)}if(t.filterEffectsMasks.push({id:r,top:c,left:d,bottom:u,right:p,depth:m,channels:g}),e.offset<o&&We(e)){var w=et(e),_=et(e),S=et(e),I=et(e);if(Oe(e))throw new Error("filterEffect: 64 bit length is not supported");var k=Oe(e),y=Ge(e),x=io(e,k-2);t.filterEffectsMasks[t.filterEffectsMasks.length-1].extra={top:w,left:_,bottom:S,right:I,compressionMode:y,data:x}}e.offset=o;for(var E=i;E%4;)e.offset++,E++}},function(e,t){var n;lt(e,3);for(var s=0,i=t.filterEffectsMasks;s<i.length;s++){var o=i[s];ze(e,0),ze(e,0);var r=e.offset;Wd(e,o.id,1),lt(e,1),ze(e,0),ze(e,0);var l=e.offset;lt(e,o.top),lt(e,o.left),lt(e,o.bottom),lt(e,o.right),lt(e,o.depth);var c=Math.max(0,o.channels.length-2);lt(e,c);for(var d=0;d<c+2;d++){var u=o.channels[d];lt(e,u?1:0),u&&(ze(e,0),ze(e,u.data.length+2),_e(e,u.compressionMode),Kr(e,u.data))}e.view.setUint32(l-4,e.offset-l,!1);var p=(n=t.filterEffectsMasks[t.filterEffectsMasks.length-1])===null||n===void 0?void 0:n.extra;p&&(Le(e,1),lt(e,p.top),lt(e,p.left),lt(e,p.bottom),lt(e,p.right),ze(e,0),ze(e,p.data.byteLength+2),_e(e,p.compressionMode),Kr(e,p.data));var m=e.offset-r;for(e.view.setUint32(r-4,m,!1);m%4;)tn(e,1),m++}});Gm("FXid","FEid");ot("FMsk",jn("filterMask"),function(e,t){t.filterMask={colorSpace:oi(e),opacity:Ge(e)/255}},function(e,t){var n;li(e,t.filterMask.colorSpace),_e(e,T6((n=t.filterMask.opacity)!==null&&n!==void 0?n:1,0,1)*255)});ot("artd",function(e){return e.artboards!==void 0},function(e,t,n){var s=Ht(e);t.artboards={count:s["Cnt "],autoExpandOffset:{horizontal:s.autoExpandOffset.Hrzn,vertical:s.autoExpandOffset.Vrtc},origin:{horizontal:s.origin.Hrzn,vertical:s.origin.Vrtc},autoExpandEnabled:s.autoExpandEnabled,autoNestEnabled:s.autoNestEnabled,autoPositionEnabled:s.autoPositionEnabled,shrinkwrapOnSaveEnabled:!!s.shrinkwrapOnSaveEnabled,docDefaultNewArtboardBackgroundColor:Fr(s.docDefaultNewArtboardBackgroundColor),docDefaultNewArtboardBackgroundType:s.docDefaultNewArtboardBackgroundType},Ye(e,n())},function(e,t){var n,s,i,o,r,l=t.artboards,c={"Cnt ":l.count,autoExpandOffset:l.autoExpandOffset?{Hrzn:l.autoExpandOffset.horizontal,Vrtc:l.autoExpandOffset.vertical}:{Hrzn:0,Vrtc:0},origin:l.origin?{Hrzn:l.origin.horizontal,Vrtc:l.origin.vertical}:{Hrzn:0,Vrtc:0},autoExpandEnabled:(n=l.autoExpandEnabled)!==null&&n!==void 0?n:!0,autoNestEnabled:(s=l.autoNestEnabled)!==null&&s!==void 0?s:!0,autoPositionEnabled:(i=l.autoPositionEnabled)!==null&&i!==void 0?i:!0,shrinkwrapOnSaveEnabled:(o=l.shrinkwrapOnSaveEnabled)!==null&&o!==void 0?o:!0,docDefaultNewArtboardBackgroundColor:Br(l.docDefaultNewArtboardBackgroundColor),docDefaultNewArtboardBackgroundType:(r=l.docDefaultNewArtboardBackgroundType)!==null&&r!==void 0?r:1};Wt(e,"","null",c,"artd")});function Rne(e){return Object.keys(e).map(function(t){return e[t]}).some(function(t){return Array.isArray(t)&&t.length>1})}ot("lfx2",function(e){return e.effects!==void 0&&!Rne(e.effects)},function(e,t,n){var s=Oe(e);if(s!==0)throw new Error("Invalid lfx2 version");var i=Ht(e);t.effects=k1(i,!!e.logMissingFeatures),Ye(e,n())},function(e,t,n,s){var i=S1(t.effects,!!s.logMissingFeatures,!0);ze(e,0),Wt(e,"","null",i)});ot("cinf",jn("compositorUsed"),function(e,t,n){var s=Ht(e);function i(o){return o.split(".")[1]}t.compositorUsed={description:s.description,reason:s.reason,engine:i(s.Engn)},s.Vrsn&&(t.compositorUsed.version=s.Vrsn),s.psVersion&&(t.compositorUsed.photoshopVersion=s.psVersion),s.enableCompCore&&(t.compositorUsed.enableCompCore=i(s.enableCompCore)),s.enableCompCoreGPU&&(t.compositorUsed.enableCompCoreGPU=i(s.enableCompCoreGPU)),s.enableCompCoreThreads&&(t.compositorUsed.enableCompCoreThreads=i(s.enableCompCoreThreads)),s.compCoreSupport&&(t.compositorUsed.compCoreSupport=i(s.compCoreSupport)),s.compCoreGPUSupport&&(t.compositorUsed.compCoreGPUSupport=i(s.compCoreGPUSupport)),Ye(e,n())},function(e,t){var n=t.compositorUsed,s={Vrsn:n.version||{major:1,minor:0,fix:0}};n.photoshopVersion&&(s.psVersion=n.photoshopVersion),s.description=n.description,s.reason=n.reason,s.Engn="Engn.".concat(n.engine),n.enableCompCore&&(s.enableCompCore="enable.".concat(n.enableCompCore)),n.enableCompCoreGPU&&(s.enableCompCoreGPU="enable.".concat(n.enableCompCoreGPU)),n.enableCompCoreThreads&&(s.enableCompCoreThreads="enable.".concat(n.enableCompCoreThreads)),n.compCoreSupport&&(s.compCoreSupport="reason.".concat(n.compCoreSupport)),n.compCoreGPUSupport&&(s.compCoreGPUSupport="reason.".concat(n.compCoreGPUSupport)),Wt(e,"","null",s)});ot("extn",function(e){return e._extn!==void 0},function(e,t){Ht(e)},function(e,t){});ot("iOpa",jn("fillOpacity"),function(e,t){t.fillOpacity=We(e)/255,Ye(e,3)},function(e,t){Le(e,t.fillOpacity*255),tn(e,3)});ot("brst",jn("channelBlendingRestrictions"),function(e,t,n){for(t.channelBlendingRestrictions=[];n()>4;)t.channelBlendingRestrictions.push(et(e))},function(e,t){for(var n=0,s=t.channelBlendingRestrictions;n<s.length;n++){var i=s[n];lt(e,i)}});ot("tsly",jn("transparencyShapesLayer"),function(e,t){t.transparencyShapesLayer=!!We(e),Ye(e,3)},function(e,t){Le(e,t.transparencyShapesLayer?1:0),tn(e,3)});var Hd=function(){return Hd=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Hd.apply(this,arguments)};function D$e(e){e===void 0&&(e=4096);var t=new ArrayBuffer(e),n=new DataView(t),s=0;return{buffer:t,view:n,offset:s,tempBuffer:void 0}}function M$e(e){return e.buffer.slice(0,e.offset)}function Le(e,t){var n=td(e,1);e.view.setUint8(n,t)}function ln(e,t){var n=td(e,2);e.view.setInt16(n,t,!1)}function _e(e,t){var n=td(e,2);e.view.setUint16(n,t,!1)}function L$e(e,t){var n=td(e,2);e.view.setUint16(n,t,!0)}function lt(e,t){var n=td(e,4);e.view.setInt32(n,t,!1)}function QB(e,t){var n=td(e,4);e.view.setInt32(n,t,!0)}function ze(e,t){var n=td(e,4);e.view.setUint32(n,t,!1)}function Or(e,t){var n=td(e,4);e.view.setFloat32(n,t,!1)}function tr(e,t){var n=td(e,8);e.view.setFloat64(n,t,!1)}function da(e,t){lt(e,t*65536)}function Er(e,t){lt(e,t*(1<<24))}function Kr(e,t){if(t){zne(e,e.offset+t.length);var n=new Uint8Array(e.buffer);n.set(t,e.offset),e.offset+=t.length}}function tn(e,t){for(var n=0;n<t;n++)Le(e,0)}function ht(e,t){if(t.length!==4)throw new Error("Invalid signature: '".concat(t,"'"));for(var n=0;n<4;n++)Le(e,t.charCodeAt(n))}function Wd(e,t,n){var s=t.length;if(s>255)throw new Error("String too long");Le(e,s);for(var i=0;i<s;i++){var o=t.charCodeAt(i);Le(e,o<128?o:63)}for(;++s%n;)Le(e,0)}function R$e(e,t){for(var n=0;n<t.length;n++)_e(e,t.charCodeAt(n))}function O$e(e,t){for(var n=0;n<t.length;n++)L$e(e,t.charCodeAt(n))}function ua(e,t){ze(e,t.length),R$e(e,t)}function jh(e,t){ze(e,t.length+1);for(var n=0;n<t.length;n++)_e(e,t.charCodeAt(n));_e(e,0)}function One(e){e===void 0&&(e=[]);for(var t=0,n=0,s=e;n<s.length;n++){var i=s[n];if(i.canvas||i.imageData){var o=$6(i),r=o.width,l=o.height;t=Math.max(t,2*l+2*r*l)}i.children&&(t=Math.max(t,One(i.children)))}return t}function Ti(e,t,n,s,i){s===void 0&&(s=!1),i===void 0&&(i=!1),i&&ze(e,0);var o=e.offset;ze(e,0),n();for(var r=e.offset-o-4,l=r;l%t!==0;)Le(e,0),l++;s&&(r=l),e.view.setUint32(o,r,!1)}function Nne(e){var t;(t=e.children)===null||t===void 0||t.forEach(Nne);var n=e.imageData;if(n&&(n.data instanceof Uint32Array||n.data instanceof Uint16Array))throw new Error("imageData has incorrect bitDepth");if("mask"in e&&e.mask){var s=e.mask.imageData;if(s&&(s.data instanceof Uint32Array||s.data instanceof Uint16Array))throw new Error("mask imageData has incorrect bitDepth")}}function N$e(e,t,n){var s;if(n===void 0&&(n={}),!(+t.width>0&&+t.height>0))throw new Error("Invalid document size");if((t.width>3e4||t.height>3e4)&&!n.psb)throw new Error("Document size is too large (max is 30000x30000, use PSB format instead)");var i=(s=t.bitsPerChannel)!==null&&s!==void 0?s:8;if(i!==8)throw new Error("bitsPerChannel other than 8 are not supported for writing");Nne(t);var o=Hd({},t.imageResources),r=Hd(Hd({},n),{layerIds:new Set,layerToId:new Map});r.generateThumbnail&&(o.thumbnail=G$e(t));var l=t.imageData;if(!l&&t.canvas&&(l=t.canvas.getContext("2d").getImageData(0,0,t.canvas.width,t.canvas.height)),l&&(t.width!==l.width||t.height!==l.height))throw new Error("Document canvas must have the same size as document");var c=!!l&&bte(l),d=Math.max(One(t.children),4*2*t.width*t.height+2*t.height);e.tempBuffer=new Uint8Array(d),ht(e,"8BPS"),_e(e,n.psb?2:1),tn(e,6),_e(e,c?4:3),ze(e,t.height),ze(e,t.width),_e(e,i),_e(e,3),Ti(e,1,function(){var _,S,I;if(t.palette){for(var k=0;k<256;k++)Le(e,((_=t.palette[k])===null||_===void 0?void 0:_.r)||0);for(var k=0;k<256;k++)Le(e,((S=t.palette[k])===null||S===void 0?void 0:S.g)||0);for(var k=0;k<256;k++)Le(e,((I=t.palette[k])===null||I===void 0?void 0:I.b)||0)}});var u=[];Bne(u,t.children),u.length||u.push({}),o.layersGroup=u.map(function(_){return _.linkGroup||0}),o.layerGroupsEnabledId=u.map(function(_){return _.linkGroupEnabled==!1?0:1}),Ti(e,1,function(){for(var _=function(E){for(var j=E.has(o),P=j===!1?0:j===!0?1:j,D=function(N){ht(e,"8BIM"),_e(e,E.key),Wd(e,"",2),Ti(e,2,function(){return E.write(e,o,N)})},O=0;O<P;O++)D(O)},S=0,I=yne;S<I.length;S++){var k=I[S];_(k)}}),Ti(e,2,function(){F$e(e,u,t,c,r),V$e(e,t.globalLayerMaskInfo),Fne(e,t,t,r)},void 0,!!r.psb);var p=c?[0,1,2,3]:[0,1,2],m=l?l.width:t.width,f=l?l.height:t.height,g={data:new Uint8Array(m*f*4),width:m,height:f};_e(e,1);{if(l&&g.data.set(new Uint8Array(l.data.buffer,l.data.byteOffset,l.data.byteLength)),c)for(var v=g.width*g.height*4,b=g.data,C=0;C<v;C+=4){var y=b[C+3];if(y!=0&&y!=255){var x=y/255,w=255*(1-x);b[C+0]=b[C+0]*x+w,b[C+1]=b[C+1]*x+w,b[C+2]=b[C+2]*x+w}}Kr(e,D6(e.tempBuffer,g,p,!!n.psb))}}function F$e(e,t,n,s,i){Ti(e,4,function(){var o;ln(e,s?-t.length:t.length);for(var r=t.map(function(b,C){return H$e(e.tempBuffer,b,C===0,i)}),l=function(b){var C=b.layer,y=b.top,x=b.left,w=b.bottom,_=b.right,S=b.channels;lt(e,y),lt(e,x),lt(e,w),lt(e,_),_e(e,S.length);for(var I=0,k=S;I<k.length;I++){var E=k[I];ln(e,E.channelId),i.psb&&ze(e,0),ze(e,E.length)}ht(e,"8BIM"),ht(e,OS[C.blendMode]||"norm"),Le(e,Math.round(T6((o=C.opacity)!==null&&o!==void 0?o:1,0,1)*255)),Le(e,C.clipping?1:0);var j=8;C.transparencyProtected&&(j|=1),C.hidden&&(j|=2),(C.vectorMask||C.sectionDivider&&C.sectionDivider.type!==0||C.adjustment)&&(j|=16),C.effectsOpen&&(j|=32),Le(e,j),Le(e,0),Ti(e,1,function(){B$e(e,C,b),z$e(e,C),Wd(e,(C.name||"").substring(0,255),4),Fne(e,C,n,i)})},c=0,d=r;c<d.length;c++){var u=d[c];l(u)}for(var p=0,m=r;p<m.length;p++)for(var u=m[p],f=0,g=u.channels;f<g.length;f++){var v=g[f];_e(e,v.compression),v.buffer&&Kr(e,v.buffer)}},!0,i.psb)}function B$e(e,t,n){var s=t.mask,i=t.realMask;Ti(e,1,function(){if(!(!s&&!i)){var o=0,r=0,l=0;s&&(s.userMaskDensity!==void 0&&(o|=1),s.userMaskFeather!==void 0&&(o|=2),s.vectorMaskDensity!==void 0&&(o|=4),s.vectorMaskFeather!==void 0&&(o|=8),s.disabled&&(r|=2),s.positionRelativeToLayer&&(r|=1),s.fromVectorData&&(r|=8),o&&(r|=16));var c=n.mask||{};if(lt(e,c.top||0),lt(e,c.left||0),lt(e,c.bottom||0),lt(e,c.right||0),Le(e,s&&s.defaultColor||0),Le(e,r),i){i.disabled&&(l|=2),i.positionRelativeToLayer&&(l|=1),i.fromVectorData&&(l|=8);var d=n.realMask||{};Le(e,l),Le(e,i.defaultColor||0),lt(e,d.top||0),lt(e,d.left||0),lt(e,d.bottom||0),lt(e,d.right||0)}o&&s&&(Le(e,o),s.userMaskDensity!==void 0&&Le(e,Math.round(s.userMaskDensity*255)),s.userMaskFeather!==void 0&&tr(e,s.userMaskFeather),s.vectorMaskDensity!==void 0&&Le(e,Math.round(s.vectorMaskDensity*255)),s.vectorMaskFeather!==void 0&&tr(e,s.vectorMaskFeather)),tn(e,2)}})}function Ax(e,t){Le(e,t[0]),Le(e,t[1]),Le(e,t[2]),Le(e,t[3])}function z$e(e,t){Ti(e,1,function(){var n=t.blendingRanges;if(n){Ax(e,n.compositeGrayBlendSource),Ax(e,n.compositeGraphBlendDestinationRange);for(var s=0,i=n.ranges;s<i.length;s++){var o=i[s];Ax(e,o.sourceRange),Ax(e,o.destRange)}}})}function V$e(e,t){Ti(e,1,function(){t&&(_e(e,t.overlayColorSpace),_e(e,t.colorSpace1),_e(e,t.colorSpace2),_e(e,t.colorSpace3),_e(e,t.colorSpace4),_e(e,t.opacity*255),Le(e,t.kind),tn(e,3))})}function Fne(e,t,n,s){for(var i=function(c){var d=c.key;if(d==="Txt2"&&s.invalidateTextLayers)return"continue";if(d==="vmsk"&&s.psb&&(d="vsms"),c.has(t)){var u=s.psb&&vte.indexOf(d)!==-1,p=d!=="Txt2"&&d!=="cinf"&&d!=="extn"&&d!=="CAI "&&d!=="OCIO",m=d==="Txt2"||d==="luni"||d==="vmsk"||d==="artb"||d==="artd"||d==="vogk"||d==="SoLd"||d==="lnk2"||d==="vscg"||d==="vsms"||d==="GdFl"||d==="lmfx"||d==="lrFX"||d==="cinf"||d==="PlLd"||d==="Anno"||d==="CAI "||d==="OCIO"||d==="GenI"||d==="FEid";ht(e,u?"8B64":"8BIM"),ht(e,d),Ti(e,m?4:2,function(){c.write(e,t,n,s)},p,u)}},o=0,r=Pne;o<r.length;o++){var l=r[o];i(l)}}function Bne(e,t){if(t)for(var n=0,s=t;n<s.length;n++){var i=s[n];if(i.children&&i.canvas)throw new Error("Invalid layer, cannot have both 'canvas' and 'children' properties");if(i.children&&i.imageData)throw new Error("Invalid layer, cannot have both 'imageData' and 'children' properties");i.children?(e.push({name:"</Layer group>",sectionDivider:{type:3}}),Bne(e,i.children),e.push(Hd(Hd({},i),{blendMode:i.blendMode==="pass through"?"normal":i.blendMode,sectionDivider:{type:i.opened===!1?2:1,key:OS[i.blendMode]||"pass",subType:0}}))):e.push(Hd({},i))}}function $$e(e,t){var n=e.buffer.byteLength;do n*=2;while(t>n);var s=new ArrayBuffer(n),i=new Uint8Array(s),o=new Uint8Array(e.buffer);i.set(o),e.buffer=s,e.view=new DataView(e.buffer)}function zne(e,t){t>e.buffer.byteLength&&$$e(e,t)}function td(e,t){var n=e.offset;return zne(e,e.offset+=t),n}function G$e(e){var t=NS(10,10),n=1;e.width>e.height?(t.width=160,t.height=Math.floor(e.height*(t.width/e.width)),n=t.width/e.width):(t.height=160,t.width=Math.floor(e.width*(t.height/e.height)),n=t.height/e.height);var s=t.getContext("2d");return s.scale(n,n),e.imageData?s.drawImage(AT(e.imageData),0,0):e.canvas&&s.drawImage(e.canvas,0,0),t}function JB(e,t,n,s,i,o){var r=s.top|0,l=s.left|0,c=s.right|0,d=s.bottom|0,u=$6(s),p=u.width,m=u.height,f=s.imageData;if(!f&&s.canvas&&p&&m&&(f=s.canvas.getContext("2d").getImageData(0,0,p,m)),p&&m&&f){if(c=l+p,d=r+m,f.width!==p||f.height!==m)throw new Error("Invalid imageData dimentions");var g=void 0,v=void 0;i.compress?(g=xte(f,[0]),v=2):(g=D6(e,f,[0],!!i.psb),v=1),t.channels.push({channelId:o?-3:-2,compression:v,buffer:g,length:2+g.length})}t[o?"realMask":"mask"]={top:r,left:l,right:c,bottom:d}}function H$e(e,t,n,s){var i=U$e(e,t,n,s);return t.mask&&JB(e,i,t,t.mask,s,!1),t.realMask&&JB(e,i,t,t.realMask,s,!0),i}function $6(e){var t=e.canvas,n=e.imageData;return n||t||{width:0,height:0}}function W$e(e,t,n,s,i){if(e.data instanceof Uint32Array||e.data instanceof Uint16Array)throw new Error("imageData has incorrect bit depth");for(var o=FS(s,i),r=e.data,l=o.data,c=0;c<i;c++)for(var d=0;d<s;d++){var u=(d+t+(c+n)*e.width)*4,p=(d+c*s)*4;l[p]=r[u],l[p+1]=r[u+1],l[p+2]=r[u+2],l[p+3]=r[u+3]}return o}function U$e(e,t,n,s){var i=t.top|0,o=t.left|0,r=t.right|0,l=t.bottom|0,c=[{channelId:-1,compression:0,buffer:void 0,length:2},{channelId:0,compression:0,buffer:void 0,length:2},{channelId:1,compression:0,buffer:void 0,length:2},{channelId:2,compression:0,buffer:void 0,length:2}],d=$6(t),u=d.width,p=d.height;if(!(t.canvas||t.imageData)||!u||!p)return r=o,l=i,{layer:t,top:i,left:o,right:r,bottom:l,channels:c};r=o+u,l=i+p;var m=t.imageData||t.canvas.getContext("2d").getImageData(0,0,u,p);if(s.trimImageData){var f=q$e(m);if(f.left!==0||f.top!==0||f.right!==m.width||f.bottom!==m.height){if(o+=f.left,i+=f.top,r-=m.width-f.right,l-=m.height-f.bottom,u=r-o,p=l-i,!u||!p)return{layer:t,top:i,left:o,right:r,bottom:l,channels:c};m=W$e(m,f.left,f.top,u,p)}}var g=[0,1,2];return(!n||s.noBackground||t.mask||bte(m)||LVe)&&g.unshift(-1),c=g.map(function(v){var b=yte(v,!1),C,y;return s.compress?(C=xte(m,[b]),y=2):(C=D6(e,m,[b],!!s.psb),y=1),{channelId:v,compression:y,buffer:C,length:2+C.length}}),{layer:t,top:i,left:o,right:r,bottom:l,channels:c}}function ez(e,t,n,s){for(var i=e.data,o=e.width,r=(t*o+n)*4+3|0,l=r+(s-n)*4|0,c=r;c<l;c=c+4|0)if(i[c]!==0)return!1;return!0}function tz(e,t,n,s){for(var i=e.data,o=e.width,r=o*4|0,l=n*r+t*4+3|0,c=n,d=l;c<s;c++,d=d+r|0)if(i[d]!==0)return!1;return!0}function q$e(e){for(var t=0,n=0,s=e.width,i=e.height;t<i&&ez(e,t,n,s);)t++;for(;i>t&&ez(e,i-1,n,s);)i--;for(;n<s&&tz(e,n,t,i);)n++;for(;s>n&&tz(e,s-1,t,i);)s--;return{top:t,left:n,right:s,bottom:i}}function li(e,t){t?"r"in t?(_e(e,0),_e(e,Math.round(t.r*257)),_e(e,Math.round(t.g*257)),_e(e,Math.round(t.b*257)),_e(e,0)):"fr"in t?(_e(e,0),_e(e,Math.round(t.fr*255*257)),_e(e,Math.round(t.fg*255*257)),_e(e,Math.round(t.fb*255*257)),_e(e,0)):"l"in t?(_e(e,7),ln(e,Math.round(t.l*1e4)),ln(e,Math.round(t.a<0?t.a*12800:t.a*12700)),ln(e,Math.round(t.b<0?t.b*12800:t.b*12700)),_e(e,0)):"h"in t?(_e(e,1),_e(e,Math.round(t.h*65535)),_e(e,Math.round(t.s*65535)),_e(e,Math.round(t.b*65535)),_e(e,0)):"c"in t?(_e(e,2),_e(e,Math.round(t.c*257)),_e(e,Math.round(t.m*257)),_e(e,Math.round(t.y*257)),_e(e,Math.round(t.k*257))):(_e(e,8),_e(e,Math.round(t.k*1e4/255)),tn(e,6)):(_e(e,0),tn(e,8))}var nz;(function(e){e[e.Bitmap=0]="Bitmap",e[e.Grayscale=1]="Grayscale",e[e.Indexed=2]="Indexed",e[e.RGB=3]="RGB",e[e.CMYK=4]="CMYK",e[e.Multichannel=7]="Multichannel",e[e.Duotone=8]="Duotone",e[e.Lab=9]="Lab"})(nz||(nz={}));var sz;(function(e){e[e.Other=0]="Other",e[e.OpenFolder=1]="OpenFolder",e[e.ClosedFolder=2]="ClosedFolder",e[e.BoundingSectionDivider=3]="BoundingSectionDivider"})(sz||(sz={}));var iz;(function(e){e[e.None=0]="None",e[e.Visibility=1]="Visibility",e[e.Position=2]="Position",e[e.Appearance=4]="Appearance"})(iz||(iz={}));function K$e(e,t){var n=D$e();return N$e(n,e,t),M$e(n)}const xp=Ft("canvas").child({filePath:"features/controlLayers/hooks/useExportCanvasToPSD.ts"}),oz=8192,Z$e=oz*oz,X$e=()=>{const{t:e}=T(),t=pm();return{exportCanvasToPSD:h.useCallback(async()=>{try{if(!t){pe({id:"CANVAS_MANAGER_NOT_AVAILABLE",title:e("toast.canvasManagerNotAvailable"),status:"error"});return}const s=t.compositor.getVisibleAdaptersOfType("raster_layer");if(s.length===0){pe({id:"NO_VISIBLE_RASTER_LAYERS",title:e("toast.noVisibleRasterLayers"),description:e("toast.noVisibleRasterLayersDesc"),status:"warning"});return}xp.debug(`Exporting ${s.length} visible raster layers to PSD`);const i=t.compositor.getRectOfAdapters(s);if(i.width<=0||i.height<=0){pe({id:"INVALID_CANVAS_DIMENSIONS",title:e("toast.invalidCanvasDimensions"),status:"error"});return}if(i.width*i.height>Z$e){pe({id:"CANVAS_TOO_LARGE",title:e("toast.canvasTooLarge"),description:e("toast.canvasTooLargeDesc"),status:"error"});return}xp.debug(`PSD canvas dimensions: ${i.width}x${i.height}`);const r=await Promise.all(s.map((p,m)=>{const f=p.state,g=p.state.position,v=p.transformer.$pixelRect.get(),b={x:g.x+v.x,y:g.y+v.y,width:v.width,height:v.height},C=p.getCanvas(b),y={name:f.name||`Layer ${m+1}`,left:Math.floor(b.x-i.x),top:Math.floor(b.y-i.y),right:Math.floor(b.x-i.x+C.width),bottom:Math.floor(b.y-i.y+C.height),opacity:Math.floor(f.opacity*255),hidden:!1,blendMode:"normal",canvas:C};return xp.debug(`Layer "${y.name}": ${y.left},${y.top} to ${y.right},${y.bottom}`),y})),l={width:i.width,height:i.height,channels:3,bitsPerChannel:8,colorMode:3,children:r};xp.debug({layerCount:l.children?.length??0,canvasDimensions:{width:l.width,height:l.height},layers:l.children?.map(p=>({name:p.name,bounds:{left:p.left,top:p.top,right:p.right,bottom:p.bottom}}))??[]},"Creating PSD with layers");const c=K$e(l),d=new Blob([c],{type:"application/octet-stream"}),u=`canvas-layers-${new Date().toISOString().slice(0,10)}.psd`;Lbe(d,u),pe({id:"PSD_EXPORT_SUCCESS",title:e("toast.psdExportSuccess"),description:e("toast.psdExportSuccessDesc",{count:l.children?.length??0}),status:"success"}),xp.debug("Successfully exported canvas to PSD")}catch(s){xp.error({error:ts(s)},"Problem exporting canvas to PSD"),pe({id:"PROBLEM_EXPORTING_PSD",title:e("toast.problemExportingPSD"),description:String(s),status:"error"})}},[t,e])}},Vne=h.memo(()=>{const{t:e}=T(),t=xt(),{exportCanvasToPSD:n}=X$e(),s=h.useCallback(()=>{n()},[n]);return a.jsx(oe,{onClick:s,isDisabled:t,size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.exportCanvasToPSD"),tooltip:e("controlLayers.exportCanvasToPSD"),icon:a.jsx(qDe,{})})});Vne.displayName="RasterLayerExportPSDButton";const Y$e=e=>h.useMemo(()=>{switch(e){case"control_layer":return"controlNet";case"inpaint_mask":return"inpainting";case"raster_layer":return"rasterLayer";case"regional_guidance":return"regionalGuidanceAndReferenceImage";default:return}},[e]),Q$e=e=>{const t=h.useMemo(()=>ve(rt,s=>{switch(e){case"control_layer":return s.controlLayers.entities.length;case"raster_layer":return s.rasterLayers.entities.length;case"inpaint_mask":return s.inpaintMasks.entities.length;case"regional_guidance":return s.regionalGuidance.entities.length;default:return 0}}),[e]);return M(t)},J$e=e=>{const{t}=T(),n=k6(e),s=Q$e(e);return h.useMemo(()=>{const o=n?"hidden":"visible";switch(e){case"control_layer":return t("controlLayers.controlLayers_withCount",{count:s,context:o});case"raster_layer":return t("controlLayers.rasterLayers_withCount",{count:s,context:o});case"inpaint_mask":return t("controlLayers.inpaintMasks_withCount",{count:s,context:o});case"regional_guidance":return t("controlLayers.regionalGuidance_withCount",{count:s,context:o});default:return""}},[e,t,s,n])},qC=32;function $ne({element:e,input:t}){return({container:n})=>{const s=e.getBoundingClientRect(),i=n.getBoundingClientRect();let o=t.clientX-s.x,r=t.clientY-s.y;return(r>i.height||o>i.width)&&(o=i.width/2,r=i.height/2),{x:o,y:r}}}function Gne(e,t){e.animate([{backgroundColor:t},{}],{duration:700,easing:"cubic-bezier(0.25, 0.1, 0.25, 1.0)",iterations:1})}const Hm=e=>{if(!navigator.userAgent.includes("Firefox"))return mK;const t=new AbortController;return e.addEventListener("mouseover",n=>{(n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLInputElement)&&e.setAttribute("draggable","false")},{signal:t.signal}),e.addEventListener("mouseout",n=>{(n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLInputElement)&&e.setAttribute("draggable","true")},{signal:t.signal}),()=>{e.setAttribute("draggable","true"),t.abort()}},E1=h.memo(({isSelected:e,type:t,children:n,entityIdentifiers:s})=>{const i=J$e(t),o=Y$e(t),r=s5(!0),l=Q();return h.useEffect(()=>Gh({canMonitor({source:c}){return!(!gf.typeGuard(c.data)||c.data.payload.entityIdentifier.type!==t)},onDrop({location:c,source:d}){const u=c.current.dropTargets[0];if(!u)return;const p=d.data,m=u.data;if(!gf.typeGuard(p)||!gf.typeGuard(m))return;const f=s.findIndex(y=>y.id===p.payload.entityIdentifier.id),g=s.findIndex(y=>y.id===m.payload.entityIdentifier.id);if(g<0||f<0||f===g)return;const v=yT(m);let b=0;if(v==="bottom"?b=1:v==="top"&&(b=-1),f===g+b)return;pu.flushSync(()=>{l(Rbe({type:t,entityIdentifiers:Pee({list:s,startIndex:f,indexOfTarget:g,closestEdgeOfTarget:v,axis:"vertical"})}))});const C=document.querySelector(`[data-entity-id="${p.payload.entityIdentifier.id}"]`);C instanceof HTMLElement&&Gne(C,Nr("base.700"))}}),[l,s,t]),a.jsxs(A,{flexDir:"column",w:"full",children:[a.jsxs(A,{w:"full",ps:2,children:[a.jsxs(A,{flexGrow:1,as:he,onClick:r.toggle,justifyContent:"space-between",alignItems:"center",gap:3,variant:"unstyled",p:0,h:8,children:[a.jsx(Je,{boxSize:4,as:Do,transform:r.isTrue?void 0:"rotate(-90deg)",fill:e?"base.200":"base.500",transitionProperty:"common",transitionDuration:"fast"}),o?a.jsx(Ue,{feature:o,children:a.jsx(q,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:i})}):a.jsx(q,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:i}),a.jsx(At,{})]}),t==="raster_layer"&&a.jsx(Vne,{}),a.jsx(Mee,{type:t}),a.jsx(Ree,{type:t}),a.jsx(Tee,{type:t})]}),a.jsx(mu,{in:r.isTrue,style:S6,children:a.jsx(A,{flexDir:"column",gap:2,pt:2,children:n})})]})});E1.displayName="CanvasEntityGroupList";const Px={type:"idle"},eGe=(e,t)=>{const[n,s]=h.useState(Px),[i,o]=h.useState(!1);return h.useEffect(()=>{const r=e.current;if(r)return zi(Hm(r),wm({element:r,getInitialData(){return gf.getData({entityIdentifier:t})},onDragStart(){s({type:"is-dragging"}),o(!0)},onDrop(){s(Px),o(!1)}}),o1({element:r,canDrop({source:l}){return!(!gf.typeGuard(l.data)||l.data.payload.entityIdentifier.type!==t.type)},getData({input:l}){const c=gf.getData({entityIdentifier:t});return nBe(c,{element:r,input:l,allowedEdges:["top","bottom"]})},getIsSticky(){return!0},onDragEnter({self:l}){const c=yT(l.data);s({type:"is-dragging-over",closestEdge:c})},onDrag({self:l}){const c=yT(l.data);s(d=>d.type==="is-dragging-over"&&d.closestEdge===c?d:{type:"is-dragging-over",closestEdge:c})},onDragLeave(){s(Px)},onDrop(){s(Px)}}))},[t,e]),[n,i]},Wm=h.createContext(null),dt=e=>{const t=h.useContext(Wm);return ae(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),e&&ae(t.type===e,"useEntityIdentifier must be used with the correct type"),t},Hne=e=>{const t=h.useMemo(()=>ve($n,s=>s?.id===e.id),[e.id]);return M(t)},KC={thickness:2,backgroundColor:"base.500"},tGe={display:"block",position:"absolute",zIndex:1,borderRadius:"full",pointerEvents:"none",background:KC.backgroundColor},nGe={horizontal:{height:`${KC.thickness}px`,left:2,right:2},vertical:{width:`${KC.thickness}px`,top:2,bottom:2}},sGe={top:"horizontal",bottom:"horizontal",left:"vertical",right:"vertical"},iGe={top:{top:"var(--local-line-offset)"},right:{right:"var(--local-line-offset)"},bottom:{bottom:"var(--local-line-offset)"},left:{left:"var(--local-line-offset)"}};function oGe({edge:e,gap:t="0px"}){const n=`calc(-0.5 * (${t} + ${KC.thickness}px))`,s=sGe[e];return a.jsx(ke,{sx:{...tGe,...nGe[s],...iGe[e],"--local-line-offset":n}})}const aGe=({dndState:e,gap:t})=>e.type!=="is-dragging-over"||!e.closestEdge?null:a.jsx(oGe,{edge:e.closestEdge,gap:t||"var(--invoke-space-2)"}),rGe={position:"relative",flexDir:"column",w:"full",bg:"base.850",borderRadius:"base","&[data-selected=true]":{bg:"base.800"},"&[data-is-dragging=true]":{opacity:.3},transitionProperty:"common"},A1=h.memo(e=>{const t=Q(),n=dt(),s=Hne(n),i=h.useCallback(()=>{s||t(pf({entityIdentifier:n}))},[t,n,s]),o=h.useRef(null),[r,l]=eGe(o,n);return a.jsxs(ke,{position:"relative",children:[a.jsx(A,{"data-entity-id":n.id,"data-selected":s,"data-is-dragging":l,ref:o,onClick:i,sx:rGe,children:e.children}),a.jsx(aGe,{dndState:r})]})});A1.displayName="CanvasEntityContainer";const lGe=(e,{id:t,type:n})=>n==="raster_layer"?{index:e.rasterLayers.entities.findIndex(s=>s.id===t),count:e.rasterLayers.entities.length}:n==="control_layer"?{index:e.controlLayers.entities.findIndex(s=>s.id===t),count:e.controlLayers.entities.length}:n==="regional_guidance"?{index:e.regionalGuidance.entities.findIndex(s=>s.id===t),count:e.regionalGuidance.entities.length}:n==="inpaint_mask"?{index:e.inpaintMasks.entities.findIndex(s=>s.id===t),count:e.inpaintMasks.entities.length}:{index:-1,count:0},Um=h.memo(()=>{const{t:e}=T(),t=Q(),n=dt(),s=xt(),i=h.useMemo(()=>Yn(rt,u=>{const{index:p,count:m}=lGe(u,n);return{canMoveForwardOne:p<m-1,canMoveBackwardOne:p>0,canMoveToFront:p<m-1,canMoveToBack:p>0}}),[n]),o=M(i),r=h.useCallback(()=>{t(Obe({entityIdentifier:n}))},[t,n]),l=h.useCallback(()=>{t(Nbe({entityIdentifier:n}))},[t,n]),c=h.useCallback(()=>{t(Fbe({entityIdentifier:n}))},[t,n]),d=h.useCallback(()=>{t(Bbe({entityIdentifier:n}))},[t,n]);return a.jsxs(a.Fragment,{children:[a.jsx(Ka,{"aria-label":e("controlLayers.moveToFront"),tooltip:e("controlLayers.moveToFront"),onClick:l,isDisabled:!o.canMoveToFront||s,icon:a.jsx(jDe,{})}),a.jsx(Ka,{"aria-label":e("controlLayers.moveForward"),tooltip:e("controlLayers.moveForward"),onClick:r,isDisabled:!o.canMoveForwardOne||s,icon:a.jsx(ADe,{})}),a.jsx(Ka,{"aria-label":e("controlLayers.moveBackward"),tooltip:e("controlLayers.moveBackward"),onClick:c,isDisabled:!o.canMoveBackwardOne||s,icon:a.jsx(SDe,{})}),a.jsx(Ka,{"aria-label":e("controlLayers.moveToBack"),tooltip:e("controlLayers.moveToBack"),onClick:d,isDisabled:!o.canMoveToBack||s,icon:a.jsx(IDe,{})})]})});Um.displayName="CanvasEntityMenuItemsArrange";const P1=h.createContext(null),Wne=h.memo(({children:e})=>{const t=Tt(),n=dt(),s=h.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),i=h.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?a.jsx(P1.Provider,{value:i,children:e}):null});Wne.displayName="RasterLayerAdapterGate";const Une=h.memo(({children:e})=>{const t=Tt(),n=dt(),s=h.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),i=h.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?a.jsx(P1.Provider,{value:i,children:e}):null});Une.displayName="ControlLayerAdapterGate";const qne=h.memo(({children:e})=>{const t=Tt(),n=dt(),s=h.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot),i=h.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?a.jsx(P1.Provider,{value:i,children:e}):null});qne.displayName="InpaintMaskAdapterGate";const Kne=h.memo(({children:e})=>{const t=Tt(),n=dt(),s=h.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),i=h.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?a.jsx(P1.Provider,{value:i,children:e}):null}),Zne=e=>{const t=h.useContext(P1);return ae(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),e&&ae(t.entityIdentifier.type===e,"useEntityIdentifier must be used with the correct type"),t};Kne.displayName="RegionalGuidanceAdapterGate";const ac=e=>{const t=Tt(),n=h.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),s=h.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),i=h.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),o=h.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot);return h.useMemo(()=>e?e.type==="raster_layer"?s.get(e.id)??null:e.type==="control_layer"?i.get(e.id)??null:e.type==="inpaint_mask"?o.get(e.id)??null:e.type==="regional_guidance"?n.get(e.id)??null:null:null,[i,e,o,s,n])},cGe=e=>{const t=ac(e);return ae(t,"useEntityAdapter must be used within a EntityAdapterContext"),t},dGe=()=>{const e=Tt(),t=h.useSyncExternalStore(e.adapters.regionMasks.subscribe,e.adapters.regionMasks.getSnapshot),n=h.useSyncExternalStore(e.adapters.rasterLayers.subscribe,e.adapters.rasterLayers.getSnapshot),s=h.useSyncExternalStore(e.adapters.controlLayers.subscribe,e.adapters.controlLayers.getSnapshot),i=h.useSyncExternalStore(e.adapters.inpaintMasks.subscribe,e.adapters.inpaintMasks.getSnapshot);return h.useMemo(()=>[...Array.from(n.values()),...Array.from(s.values()),...Array.from(i.values()),...Array.from(t.values())],[s,i,n,t])},tl=e=>{const t=h.useMemo(()=>ve(rt,s=>{if(!e)return!1;const i=bo(s,e);return i?i.isLocked:!1}),[e]);return M(t)},T1=h.memo(()=>{const{t:e}=T(),t=dt(),n=ac(t),s=xt(),i=tl(t),o=h.useCallback(()=>{n&&n.cropToBbox()},[n]);return a.jsx(be,{onClick:o,icon:a.jsx(z4,{}),isDisabled:s||i,children:e("controlLayers.cropLayerToBbox")})});T1.displayName="CanvasEntityMenuItemsCropToBbox";const qm=h.memo(({asIcon:e=!1})=>{const{t}=T(),n=Q(),s=dt(),i=xt(),o=h.useCallback(()=>{n(bM({entityIdentifier:s}))},[n,s]);return e?a.jsx(Ka,{"aria-label":t("common.delete"),tooltip:t("common.delete"),onClick:o,icon:a.jsx(Ea,{}),isDestructive:!0,isDisabled:i}):a.jsx(be,{onClick:o,icon:a.jsx(Ea,{}),isDestructive:!0,isDisabled:i,children:t("common.delete")})});qm.displayName="CanvasEntityMenuItemsDelete";const Km=h.memo(()=>{const{t:e}=T(),t=Q(),n=dt(),s=xt(),i=h.useCallback(()=>{t(jW({entityIdentifier:n}))},[t,n]);return a.jsx(Ka,{"aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),onClick:i,icon:a.jsx(yX,{}),isDisabled:s})});Km.displayName="CanvasEntityMenuItemsDuplicate";const D1=e=>{const t=h.useMemo(()=>e?zbe(e):()=>!1,[e]);return!M(t)},VS=e=>{const t=Tt(),n=ac(e),s=xt(),i=tl(e),o=D1(e),r=h.useMemo(()=>!!(!e||!KA(e)||!n||s||i||o),[e,n,s,i,o]),l=h.useCallback(()=>{if(r||!e||!KA(e))return;const c=t.getAdapter(e);c&&c.filterer.start()},[r,e,t]);return{isDisabled:r,start:l}},G6=h.memo(()=>{const{t:e}=T(),t=dt(),n=VS(t);return a.jsx(be,{onClick:n.start,icon:a.jsx(nS,{}),isDisabled:n.isDisabled,children:e("controlLayers.filter.filter")})});G6.displayName="CanvasEntityMenuItemsFilter";const uGe=e=>{const t=h.useMemo(()=>Yn(rt,s=>{const i=Vbe(s,e);return i?xa(i):null}),[e]);return M(t)},M1=h.memo(()=>{const{t:e}=T(),t=Tt(),n=xt(),s=dt(),i=uGe(s),o=h.useCallback(()=>{i!==null&&t.compositor.mergeByEntityIdentifiers([i,s],!0)},[t.compositor,s,i]);return a.jsx(be,{onClick:o,icon:a.jsx(gX,{}),isDisabled:n||i===null,children:e("controlLayers.mergeDown")})});M1.displayName="CanvasEntityMenuItemsMergeDown";const hGe=Ft("canvas").child({filePath:"features/controlLayers/hooks/useSaveLayerToAssets.ts"}),Xne=()=>{const{t:e}=T(),t=M(ko);return h.useCallback(async s=>{if(s)try{const i=s.getCanvas(),o=await mh(i),r=new File([o],`layer-${s.id}.png`,{type:"image/png"});Yd({file:r,image_category:"user",is_intermediate:!1,board_id:t==="none"?void 0:t})}catch(i){hGe.error({error:cn(i)},"Problem copying layer to clipboard"),pe({status:"error",title:e("toast.problemSavingLayer")})}},[t,e])},L1=h.memo(()=>{const{t:e}=T(),t=dt(),n=ac(t),s=xt(),i=Xne(),o=h.useCallback(()=>{i(n)},[i,n]);return a.jsx(be,{onClick:o,icon:a.jsx(Ol,{}),isDisabled:s,children:e("controlLayers.saveLayerToAssets")})});L1.displayName="CanvasEntityMenuItemsSave";const Yne=e=>{const t=Tt(),n=ac(e),s=xt(),i=tl(e),o=D1(e),r=h.useMemo(()=>!!(!e||!ZA(e)||!n||s||i||o),[e,n,s,i,o]),l=h.useCallback(()=>{if(r||!e||!ZA(e))return;const c=t.getAdapter(e);c&&c.segmentAnything.start()},[r,e,t]);return{isDisabled:r,start:l}},H6=h.memo(()=>{const{t:e}=T(),t=dt(),n=Yne(t);return a.jsx(be,{onClick:n.start,icon:a.jsx(wX,{}),isDisabled:n.isDisabled,children:e("controlLayers.selectObject.selectObject")})});H6.displayName="CanvasEntityMenuItemsSelectObject";const W6=e=>{const t=Tt(),n=ac(e),s=xt(),i=tl(e),o=D1(e),r=h.useMemo(()=>!!(!e||!s2(e)||!n||s||i||o),[e,n,s,i,o]),l=h.useCallback(async()=>{if(r||!e||!s2(e))return;const d=t.getAdapter(e);d&&await d.transformer.startTransform()},[r,e,t]),c=h.useCallback(async()=>{if(r||!e||!s2(e))return;const d=t.getAdapter(e);d&&(await d.transformer.startTransform({silent:!0}),d.transformer.fitToBboxContain(),await d.transformer.applyTransform())},[t,e,r]);return{isDisabled:r,start:l,fitToBbox:c}},R1=h.memo(()=>{const{t:e}=T(),t=dt(),n=W6(t);return a.jsxs(a.Fragment,{children:[a.jsx(be,{onClick:n.start,icon:a.jsx(Sm,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.transform")}),a.jsx(be,{onClick:n.fitToBbox,icon:a.jsx(nc,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.fitToBbox")})]})});R1.displayName="CanvasEntityMenuItemsTransform";const Qne=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Q(),s=dt("control_layer"),i=xt(),o=tl(s),r=h.useCallback(()=>{n(EW({entityIdentifier:s,replace:!0}))},[n,s]),l=h.useCallback(()=>{n(AW({entityIdentifier:s,replace:!0}))},[n,s]),c=h.useCallback(()=>{n(PW({entityIdentifier:s,replace:!0}))},[n,s]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(Ua,{}),isDisabled:o||i,children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.convertControlLayerTo")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(be,{onClick:r,icon:a.jsx(Ua,{}),isDisabled:o||i,children:e("controlLayers.inpaintMask")}),a.jsx(be,{onClick:l,icon:a.jsx(Ua,{}),isDisabled:o||i,children:e("controlLayers.regionalGuidance")}),a.jsx(be,{onClick:c,icon:a.jsx(Ua,{}),isDisabled:o||i,children:e("controlLayers.rasterLayer")})]})]})})});Qne.displayName="ControlLayerMenuItemsConvertToSubMenu";const ZC=Ft("canvas").child({filePath:"features/controlLayers/hooks/copyHooks.ts"}),pGe=()=>{const{t:e}=T(),t=Rm();return h.useCallback(async s=>{if(s)try{const i=s.getCanvas(),o=await mh(i);t.writeImage(o,()=>{ZC.trace("Layer copied to clipboard"),pe({status:"info",title:e("toast.layerCopiedToClipboard")})})}catch(i){ZC.error({error:cn(i)},"Problem copying layer to clipboard"),pe({status:"error",title:e("toast.problemCopyingLayer")})}},[t,e])},az=e=>{const{t}=T(),n=Rm(),s=Tt();return h.useCallback(async()=>{const o=e==="bbox"?s.stateApi.getBbox().rect:s.compositor.getVisibleRectOfType("raster_layer");if(o.width===0||o.height===0){pe({title:t("controlLayers.copyRegionError",{region:i2(e)}),description:t("controlLayers.regionIsEmpty"),status:"warning"});return}try{const r=s.compositor.getVisibleAdaptersOfType("raster_layer"),l=s.compositor.getCompositeCanvas(r,o),c=await mh(l);n.writeImage(c,()=>{ZC.trace("Region copied to clipboard"),pe({title:t("controlLayers.regionCopiedToClipboard",{region:i2(e)})})})}catch(r){ZC.error({error:cn(r)},"Failed to save canvas to gallery"),pe({title:t("controlLayers.copyRegionError",{region:i2(e)}),status:"error"})}},[s.compositor,s.stateApi,n,e,t])},O1=h.memo(()=>{const{t:e}=T(),t=dt(),n=ac(t),s=xt(),i=D1(t),o=pGe(),r=h.useCallback(()=>{o(n)},[o,n]);return a.jsx(be,{onClick:r,icon:a.jsx(ws,{}),isDisabled:s||i,children:e("common.clipboard")})});O1.displayName="CanvasEntityMenuItemsCopyToClipboard";const Jne=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Q(),s=dt("control_layer"),i=xt(),o=h.useCallback(()=>{n(EW({entityIdentifier:s}))},[n,s]),r=h.useCallback(()=>{n(AW({entityIdentifier:s}))},[n,s]),l=h.useCallback(()=>{n(PW({entityIdentifier:s}))},[n,s]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(ws,{}),isDisabled:i,children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.copyControlLayerTo")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(O1,{}),a.jsx(be,{onClick:o,icon:a.jsx(ws,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")}),a.jsx(be,{onClick:r,icon:a.jsx(ws,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")}),a.jsx(be,{onClick:l,icon:a.jsx(ws,{}),isDisabled:i,children:e("controlLayers.newRasterLayer")})]})]})})});Jne.displayName="ControlLayerMenuItemsCopyToSubMenu";const fGe=e=>ve(rt,t=>co(t,e,"ControlLayerMenuItemsTransparencyEffect").withTransparencyEffect),ese=h.memo(()=>{const{t:e}=T(),t=Q(),n=dt("control_layer"),s=tl(n),i=h.useMemo(()=>fGe(n),[n]),o=M(i),r=h.useCallback(()=>{t($be({entityIdentifier:n}))},[t,n]);return a.jsx(be,{onClick:r,icon:a.jsx(HDe,{}),isDisabled:s,children:e(o?"controlLayers.disableTransparencyEffect":"controlLayers.enableTransparencyEffect")})});ese.displayName="ControlLayerMenuItemsTransparencyEffect";const U6=h.memo(()=>a.jsxs(a.Fragment,{children:[a.jsxs(Lm,{children:[a.jsx(Um,{}),a.jsx(Km,{}),a.jsx(qm,{asIcon:!0})]}),a.jsx(Yi,{}),a.jsx(R1,{}),a.jsx(G6,{}),a.jsx(H6,{}),a.jsx(ese,{}),a.jsx(Yi,{}),a.jsx(M1,{}),a.jsx(Jne,{}),a.jsx(Qne,{}),a.jsx(T1,{}),a.jsx(L1,{})]}));U6.displayName="ControlLayerMenuItems";const tse=h.memo(()=>{const e=dt("inpaint_mask"),{t}=T(),n=xt(),s=GPe(e),i=HPe(e);return a.jsxs(a.Fragment,{children:[a.jsx(be,{onClick:s,isDisabled:n,children:t("controlLayers.addImageNoise")}),a.jsx(be,{onClick:i,isDisabled:n,children:t("controlLayers.addDenoiseLimit")})]})});tse.displayName="InpaintMaskMenuItemsAddNoise";const nse=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Q(),s=dt("inpaint_mask"),i=xt(),o=tl(s),r=h.useCallback(()=>{n(TW({entityIdentifier:s,replace:!0}))},[n,s]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(Ua,{}),isDisabled:i||o,children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.convertInpaintMaskTo")})}),a.jsx(Zt,{...t.menuListProps,children:a.jsx(be,{onClick:r,icon:a.jsx(Ua,{}),isDisabled:i||o,children:e("controlLayers.regionalGuidance")})})]})})});nse.displayName="InpaintMaskMenuItemsConvertToSubMenu";const sse=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Q(),s=dt("inpaint_mask"),i=xt(),o=h.useCallback(()=>{n(TW({entityIdentifier:s}))},[n,s]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(ws,{}),isDisabled:i,children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.copyInpaintMaskTo")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(O1,{}),a.jsx(be,{onClick:o,icon:a.jsx(ws,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")})]})]})})});sse.displayName="InpaintMaskMenuItemsCopyToSubMenu";const jE=Ft("canvas").child({filePath:"features/controlLayers/components/InpaintMask/InpaintMaskMenuItemsExtractMaskedArea.tsx"}),ise=h.memo(()=>{const e=Tt(),t=dt("inpaint_mask"),n=xt(),{t:s}=T(),i=h.useCallback(()=>{(async()=>{const o=e.getAdapter(t);if(!o){jE.error({entityIdentifier:t},"Inpaint mask adapter not found when extracting masked area"),pe({status:"error",title:"Unable to extract masked area."});return}try{const r=o.transformer.$pixelRect.get(),l=o.state.position,c={x:Math.floor(l.x+r.x),y:Math.floor(l.y+r.y),width:Math.floor(r.width),height:Math.floor(r.height)};if(c.width<=0||c.height<=0){pe({status:"warning",title:"Canvas is empty."});return}const d=e.compositor.getVisibleAdaptersOfType("raster_layer");let u;if(d.length===0)u=new ImageData(c.width,c.height);else{const I=e.compositor.getCompositeCanvas(d,c);u=Dv(I)}const p=o.getCanvas(c),m=Dv(p);if(m.width!==u.width||m.height!==u.height){jE.error({maskDimensions:{width:m.width,height:m.height},compositeDimensions:{width:u.width,height:u.height}},"Mask and composite dimensions did not match when extracting masked area"),pe({status:"error",title:"Unable to extract masked area."});return}const f=u.data,g=m.data;if(!f||!g){pe({status:"error",title:"Cannot extract: image or mask data is missing."});return}const v=new Uint8ClampedArray(f.length);for(let I=0;I<f.length;I+=4){const k=(g[I+3]??0)/255||0;v[I]=f[I]??0,v[I+1]=f[I+1]??0,v[I+2]=f[I+2]??0,v[I+3]=Math.round((f[I+3]??0)*k)}const b=new ImageData(v,c.width,c.height),C=document.createElement("canvas");C.width=c.width,C.height=c.height;const y=C.getContext("2d");if(!y)throw new Error("Failed to create canvas context for masked extraction");y.putImageData(b,0,0);const x=await mh(C),w=await Yd({file:new File([x],"inpaint-extract.png",{type:"image/png"}),image_category:"general",is_intermediate:!0,silent:!0}),_=_o(w),S=e.stateApi.getRasterLayersState().entities.at(-1)?.id;e.stateApi.addRasterLayer({overrides:{objects:[_],position:{x:c.x,y:c.y}},isSelected:!0,addAfter:S})}catch(r){jE.error({error:cn(r)},"Failed to extract masked area to raster layer"),pe({status:"error",title:"Unable to extract masked area."})}})()},[e,t]);return a.jsx(be,{onClick:i,icon:a.jsx(yMe,{}),isDisabled:n,children:s("controlLayers.extractRegion")})});ise.displayName="InpaintMaskMenuItemsExtractMaskedArea";const q6=h.memo(()=>a.jsxs(a.Fragment,{children:[a.jsxs(Lm,{children:[a.jsx(Um,{}),a.jsx(Km,{}),a.jsx(qm,{asIcon:!0})]}),a.jsx(Yi,{}),a.jsx(tse,{}),a.jsx(Yi,{}),a.jsx(R1,{}),a.jsx(ise,{}),a.jsx(Yi,{}),a.jsx(M1,{}),a.jsx(sse,{}),a.jsx(nse,{}),a.jsx(T1,{}),a.jsx(L1,{})]}));q6.displayName="InpaintMaskMenuItems";const ose=h.memo(()=>{const e=Q(),t=dt(),{t:n}=T(),i=!!M(r=>r.canvas.present.rasterLayers.entities.find(l=>l.id===t.id))?.adjustments,o=h.useCallback(()=>{e(i?DW({entityIdentifier:t}):MW({entityIdentifier:t,adjustments:Gbe("simple")}))},[e,t,i]);return a.jsx(be,{onClick:o,icon:a.jsx(mX,{}),children:n(i?"controlLayers.removeAdjustments":"controlLayers.addAdjustments")})});ose.displayName="RasterLayerMenuItemsAdjustments";const ase=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Q(),s=dt("raster_layer"),i=xt(),o=tl(s),r=h.useCallback(()=>{n(LW({entityIdentifier:s,replace:!0}))},[n,s]),l=h.useCallback(()=>{n(RW({entityIdentifier:s,replace:!0}))},[n,s]),c=h.useCallback(()=>{n(OW({entityIdentifier:s,replace:!0,overrides:{controlAdapter:It(Rh)}}))},[n,s]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(Ua,{}),isDisabled:i||o,children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.convertRasterLayerTo")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(be,{onClick:r,icon:a.jsx(Ua,{}),isDisabled:i||o,children:e("controlLayers.inpaintMask")}),a.jsx(be,{onClick:l,icon:a.jsx(Ua,{}),isDisabled:i||o,children:e("controlLayers.regionalGuidance")}),a.jsx(be,{onClick:c,icon:a.jsx(Ua,{}),isDisabled:i||o,children:e("controlLayers.controlLayer")})]})]})})});ase.displayName="RasterLayerMenuItemsConvertToSubMenu";const rse=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Q(),s=dt("raster_layer"),i=xt(),o=h.useCallback(()=>{n(LW({entityIdentifier:s}))},[n,s]),r=h.useCallback(()=>{n(RW({entityIdentifier:s}))},[n,s]),l=h.useCallback(()=>{n(OW({entityIdentifier:s,overrides:{controlAdapter:It(Rh)}}))},[n,s]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(ws,{}),isDisabled:i,children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.copyRasterLayerTo")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(O1,{}),a.jsx(be,{onClick:o,icon:a.jsx(ws,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")}),a.jsx(be,{onClick:r,icon:a.jsx(ws,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")}),a.jsx(be,{onClick:l,icon:a.jsx(ws,{}),isDisabled:i,children:e("controlLayers.newControlLayer")})]})]})})});rse.displayName="RasterLayerMenuItemsCopyToSubMenu";const K6=h.memo(()=>a.jsxs(a.Fragment,{children:[a.jsxs(Lm,{children:[a.jsx(Um,{}),a.jsx(Km,{}),a.jsx(qm,{asIcon:!0})]}),a.jsx(R1,{}),a.jsx(G6,{}),a.jsx(H6,{}),a.jsx(ose,{}),a.jsx(Yi,{}),a.jsx(M1,{}),a.jsx(rse,{}),a.jsx(ase,{}),a.jsx(T1,{}),a.jsx(L1,{})]}));K6.displayName="RasterLayerMenuItems";const LT=h.createContext(null),Cu=()=>{const e=h.useContext(LT);return ae(e,"useRefImageIdContext must be used within a RefImageIdContext.Provider"),e},mGe=Ft("canvas").child({filePath:"features/controlLayers/hooks/saveCanvasHooks.ts"}),nd=({region:e,saveToGallery:t,toastOk:n,toastError:s,onSave:i,withMetadata:o})=>{const{t:r}=T(),l=Ze(),c=Tt();return h.useCallback(async()=>{const u=e==="bbox"?c.stateApi.getBbox().rect:c.compositor.getVisibleRectOfType("raster_layer");if(u.width===0||u.height===0){pe({title:s,description:r("controlLayers.regionIsEmpty"),status:"warning"});return}let p;const m=l.getState();if(o){p=Lh(m),p.positive_prompt=Qf(m),p.negative_prompt=Hbe(m),p.seed=NW(m);const v=wo(m);v&&(p.model=hn.getModelMetadataField(v))}let f;t&&(f=ko(m));const g=await Kn(()=>{const v=c.compositor.getVisibleAdaptersOfType("raster_layer");return c.compositor.getCompositeImageDTO(v,u,{is_intermediate:!t,metadata:p,board_id:f,silent:!0},void 0,!0)});g.isOk()?(i&&i(g.value,u),pe({title:n})):(mGe.error({error:cn(g.error)},"Failed to save canvas to gallery"),pe({title:s,status:"error"}))},[c.compositor,c.stateApi,i,e,t,l,r,s,n,o])},lse=()=>{const{t:e}=T(),t=h.useMemo(()=>({region:"canvas",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return nd(t)},cse=()=>{const{t:e}=T(),t=h.useMemo(()=>({region:"bbox",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return nd(t)},gGe=()=>{const{t:e}=T(),{dispatch:t,getState:n}=Ze(),s=h.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:r=>{const c={referenceImages:[{id:ee("regional_guidance_reference_image"),config:{...r1(n),image:du(r)}}]};t(Xd({overrides:c,isSelected:!0}))},toastOk:e("controlLayers.newRegionalReferenceImageOk"),toastError:e("controlLayers.newRegionalReferenceImageError")}),[t,n,e]);return nd(s)},dse=()=>{const{t:e}=T(),{dispatch:t,getState:n}=Ze(),s=h.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:r=>{const l={config:{...a1(n),image:Dl(r)}};t(Dy({overrides:l}))},toastOk:e("controlLayers.newGlobalReferenceImageOk"),toastError:e("controlLayers.newGlobalReferenceImageError")}),[t,n,e]);return nd(s)},vGe=()=>{const{t:e}=T(),t=Q(),n=h.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(o,r)=>{const l={objects:[_o(o)],position:{x:r.x,y:r.y}};t(em({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newRasterLayerOk"),toastError:e("controlLayers.newRasterLayerError")}),[t,e]);return nd(n)},yGe=()=>{const{t:e}=T(),t=Q(),n=h.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(o,r)=>{const l={objects:[_o(o)],controlAdapter:It(Rh),position:{x:r.x,y:r.y}};t(Ty({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newControlLayerOk"),toastError:e("controlLayers.newControlLayerError")}),[t,e]);return nd(n)},use=e=>{const{t}=T(),n=Q(),s=h.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(r,l)=>{n(Zw({entityIdentifier:e,position:{x:l.x,y:l.y},imageObject:_o(r),replaceObjects:!0}))},toastOk:t("controlLayers.pullBboxIntoLayerOk"),toastError:t("controlLayers.pullBboxIntoLayerError")}),[n,e,t]);return nd(s)},Z6=e=>{const{t}=T(),n=Q(),s=h.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(r,l)=>{n(JD({id:e,croppableImage:Dl(r)}))},toastOk:t("controlLayers.pullBboxIntoReferenceImageOk"),toastError:t("controlLayers.pullBboxIntoReferenceImageError")}),[n,e,t]);return nd(s)},hse=(e,t)=>{const{t:n}=T(),s=Q(),i=h.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(l,c)=>{s(eM({entityIdentifier:e,referenceImageId:t,imageDTO:l}))},toastOk:n("controlLayers.pullBboxIntoReferenceImageOk"),toastError:n("controlLayers.pullBboxIntoReferenceImageError")}),[s,e,t,n]);return nd(i)},pse=h.memo(()=>{const{t:e}=T(),t=Cu(),n=Z6(t),s=xt();return a.jsx(be,{onClick:n,icon:a.jsx(nc,{}),isDisabled:s,children:e("controlLayers.pullBboxIntoReferenceImage")})});pse.displayName="IPAdapterMenuItemPullBbox";const X6=h.memo(()=>a.jsxs(a.Fragment,{children:[a.jsxs(Lm,{children:[a.jsx(Um,{}),a.jsx(Km,{}),a.jsx(qm,{asIcon:!0})]}),a.jsx(Yi,{}),a.jsx(pse,{})]}));X6.displayName="IPAdapterMenuItems";const fse=h.memo(()=>{const e=dt("regional_guidance"),{t}=T(),n=xt(),s=PZ(e),i=TZ(e),o=DZ(e),r=h.useMemo(()=>MZ(e),[e]),l=M(r);return a.jsxs(a.Fragment,{children:[a.jsx(be,{onClick:i,isDisabled:!l.canAddPositivePrompt||n,children:t("controlLayers.addPositivePrompt")}),a.jsx(be,{onClick:o,isDisabled:!l.canAddNegativePrompt||n,children:t("controlLayers.addNegativePrompt")}),a.jsx(be,{onClick:s,isDisabled:n,children:t("controlLayers.addReferenceImage")})]})});fse.displayName="RegionalGuidanceMenuItemsExtra";const mse=h.memo(()=>{const e=dt("regional_guidance"),{t}=T(),n=Q(),s=h.useMemo(()=>ve(rt,r=>co(r,e,"RegionalGuidanceMenuItemsAutoNegative").autoNegative),[e]),i=M(s),o=h.useCallback(()=>{n(Wbe({entityIdentifier:e}))},[n,e]);return a.jsx(be,{icon:a.jsx(fX,{}),onClick:o,children:t(i?"controlLayers.disableAutoNegative":"controlLayers.enableAutoNegative")})});mse.displayName="RegionalGuidanceMenuItemsAutoNegative";const gse=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Q(),s=dt("regional_guidance"),i=xt(),o=tl(s),r=h.useCallback(()=>{n(FW({entityIdentifier:s,replace:!0}))},[n,s]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(Ua,{}),isDisabled:o||i,children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.convertRegionalGuidanceTo")})}),a.jsx(Zt,{...t.menuListProps,children:a.jsx(be,{onClick:r,icon:a.jsx(Ua,{}),isDisabled:o||i,children:e("controlLayers.inpaintMask")})})]})})});gse.displayName="RegionalGuidanceMenuItemsConvertToSubMenu";const vse=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Q(),s=dt("regional_guidance"),i=xt(),o=h.useCallback(()=>{n(FW({entityIdentifier:s}))},[n,s]);return a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(ws,{}),isDisabled:i,children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.copyRegionalGuidanceTo")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(O1,{}),a.jsx(be,{onClick:o,icon:a.jsx(ws,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")})]})]})})});vse.displayName="RegionalGuidanceMenuItemsCopyToSubMenu";const Y6=h.memo(()=>a.jsxs(a.Fragment,{children:[a.jsxs(Lm,{children:[a.jsx(Um,{}),a.jsx(Km,{}),a.jsx(qm,{asIcon:!0})]}),a.jsx(Yi,{}),a.jsx(fse,{}),a.jsx(Yi,{}),a.jsx(R1,{}),a.jsx(mse,{}),a.jsx(Yi,{}),a.jsx(M1,{}),a.jsx(vse,{}),a.jsx(gse,{}),a.jsx(T1,{}),a.jsx(L1,{})]}));Y6.displayName="RegionalGuidanceMenuItems";const N1=h.memo(({children:e,...t})=>{const n=dt(),s=h.useCallback(()=>{if(n.type==="regional_guidance")return a.jsx(Zt,{children:a.jsx(Y6,{})});if(n.type==="inpaint_mask")return a.jsx(Zt,{children:a.jsx(q6,{})});if(n.type==="raster_layer")return a.jsx(Zt,{children:a.jsx(K6,{})});if(n.type==="control_layer")return a.jsx(Zt,{children:a.jsx(U6,{})});if(n.type==="reference_image")return a.jsx(Zt,{children:a.jsx(X6,{})});ae(!1,"Unhandled entity type")},[n]);return a.jsx(p_,{renderMenu:s,children:i=>a.jsx(A,{ref:i,gap:2,alignItems:"center",p:2,...t,children:e})})});N1.displayName="CanvasEntityHeader";const yse=h.memo(()=>{const{t:e}=T(),t=dt(),n=Q(),s=xt(),i=h.useCallback(()=>{n(bM({entityIdentifier:t}))},[n,t]);return a.jsx(oe,{size:"sm","aria-label":e("common.delete"),tooltip:e("common.delete"),variant:"link",alignSelf:"stretch",icon:a.jsx(Y4,{}),onClick:i,colorScheme:"error",isDisabled:s})});yse.displayName="CanvasEntityDeleteButton";const bse=e=>{const t=h.useMemo(()=>ve(rt,s=>{const i=bo(s,e);return i?i.isEnabled:!1}),[e]);return M(t)},xse=h.memo(()=>{const{t:e}=T(),t=dt(),n=bse(t),s=xt(),i=Q(),o=h.useCallback(()=>{i(Ube({entityIdentifier:t}))},[i,t]);return a.jsx(oe,{size:"sm","aria-label":e(n?"common.enabled":"common.disabled"),tooltip:e(n?"common.enabled":"common.disabled"),variant:"link",alignSelf:"stretch",icon:n?a.jsx(vX,{}):a.jsx(nX,{}),onClick:o,isDisabled:s})});xse.displayName="CanvasEntityEnabledToggle";const bGe=(e,t)=>ve(rt,wo,(n,s)=>{const i=co(n,e,"CanvasEntityHeaderWarnings");let o=[];const r=i.type;return r==="control_layer"?o=e1(i,s):r==="regional_guidance"?o=r4(i,s):r==="inpaint_mask"?o=AK():r==="raster_layer"?o=EK():r==="reference_image"?o=vu(i,s):ae(!1,"Unexpected entity type"),o.length===0?os:o.map(l=>t(l)).map(Cd)}),Cse=h.memo(()=>{const e=dt(),{t}=T(),n=bse(e),s=h.useMemo(()=>bGe(e,t),[e,t]),i=M(s);return i.length===0?null:a.jsx(oe,{as:"span",size:"sm",variant:"link",alignSelf:"stretch","aria-label":"warnings",tooltip:a.jsx(wse,{warnings:i}),icon:a.jsx(jm,{}),colorScheme:"warning",isDisabled:!n})});Cse.displayName="CanvasEntityHeaderWarnings";const wse=h.memo(e=>{const{t}=T();return a.jsxs(A,{flexDir:"column",children:[a.jsxs(q,{children:[t("controlLayers.warnings.problemsFound"),":"]}),a.jsx(Li,{children:e.warnings.map((n,s)=>a.jsx(rn,{children:n},s))})]})});wse.displayName="TooltipContent";const xGe=e=>{const t=h.useMemo(()=>ve(rt,s=>s.bookmarkedEntityIdentifier?.id===e.id),[e]);return M(t)},_se=h.memo(()=>{const{t:e}=T(),t=dt(),n=xGe(t),s=Q(),i=h.useCallback(()=>{s(n?VL({entityIdentifier:null}):VL({entityIdentifier:t}))},[s,t,n]);return a.jsx(oe,{size:"sm","aria-label":e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),tooltip:e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),variant:"link",alignSelf:"stretch",icon:n?a.jsx(PMe,{}):a.jsx(MDe,{}),onClick:i})});_se.displayName="CanvasEntityIsBookmarkedForQuickSwitchToggle";const Sse=h.memo(()=>{const{t:e}=T(),t=dt(),n=tl(t),s=xt(),i=Q(),o=h.useCallback(()=>{i(qbe({entityIdentifier:t}))},[i,t]);return a.jsx(oe,{size:"sm","aria-label":e(n?"controlLayers.locked":"controlLayers.unlocked"),tooltip:e(n?"controlLayers.locked":"controlLayers.unlocked"),variant:"link",alignSelf:"stretch",icon:n?a.jsx(X4,{}):a.jsx(H4,{}),onClick:o,isDisabled:s})});Sse.displayName="CanvasEntityIsLockedToggle";const F1=h.memo(()=>a.jsxs(A,{alignSelf:"stretch",children:[a.jsx(Cse,{}),a.jsx(_se,{}),a.jsx(Sse,{}),a.jsx(xse,{}),a.jsx(yse,{})]}));F1.displayName="CanvasEntityHeaderCommonActions";function k2(e,t=!1){const n=(16777216+(e.r<<16)+(e.g<<8)+e.b).toString(16).slice(1),s=Math.round(e.a*255).toString(16).padStart(2,"0");return t?`#${n}${s}`:`#${n}`}function kse(e,t){e=e.replace(/^#/,"");const n=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16);return{r:n,g:s,b:i,a:t}}const Bo=e=>{const{r:t,g:n,b:s,a:i}=e;return`rgba(${t}, ${n}, ${s}, ${i})`},Eh=e=>{const{r:t,g:n,b:s}=e;return`rgba(${t}, ${n}, ${s})`},Qh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAFwWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjQtMDktMTNUMjA6NTM6MTMrMTAwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyNC0wOS0xM1QyMDo1MzoxMysxMDAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0iR2VuZXJpYyBSR0IgUHJvZmlsZSIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjIwIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjAiCiAgIGV4aWY6Q29sb3JTcGFjZT0iNjU1MzUiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI5Ni8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI5Ni8xIj4KICAgPGRjOnRpdGxlPgogICAgPHJkZjpBbHQ+CiAgICAgPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij50cmFuc3BhcmVudF9iZ19kYXJrPC9yZGY6bGk+CiAgICA8L3JkZjpBbHQ+CiAgIDwvZGM6dGl0bGU+CiAgIDx4bXBNTTpIaXN0b3J5PgogICAgPHJkZjpTZXE+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InByb2R1Y2VkIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZmZpbml0eSBQaG90byAyIDIuNS41IgogICAgICBzdEV2dDp3aGVuPSIyMDI0LTA5LTEzVDIxOjE4OjQwKzEwOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5YzHPhAAAETGlDQ1BHZW5lcmljIFJHQiBQcm9maWxlAABIic1VXWgcVRQ+m7m7CSSOUmNTU0kHtTaENExSqRtqo/uXZNu4WTbZtA0Fncze3Zlm9seZ2dSWYiEI/rwYFXxVq4IPBZ8K8T8FMSJKCyVKMIiCYOsfhUpfNKznzp3dnaRZ9dE73JnvnvPdc+8958y5AC3PGWreapIA8gXbTI2EpaPHpqXmVWiCu6EVOqFVUa1SKJkcA2xKqWTALe3m1+Bj3yt7ma1b9f/YWjPUUgF8Ldj7MpaaB2gKAvhfUEumDdD8KXKCJ+0Sw38hbjdxgwAtdzCc4/h+hmc4DjqcyVQEMduzqGpKBvFxxL0zHnnOg/kenNY+QgvU1FWJ+SJpFrO6Qat7bYcRoFDAboIOKkiQQkkYv0mUFCGLUgMo/O/aMsz/1Jd9vufo8J1HfB754u37fWysWjTDxku7+Vg+ew7gCYB3BM5bevjsFJO3uJPzRrnqr13Y26zZicP47cYYPpNRogxjTHznVSU24eLLc/pUwsV/lOxwCvEDGOsd5dl0CHEP4qGsOZzmdpo0rTxaxQuntckjiLchXpwtHmZztyP+ojCTGHftfK9aEYw/3AsgBDQaZ3HtQtxtFlPjfF1hOEOjMcS9iE/odnyS2xdeteYmYlU7p7VIgq8lfHxCOZRE3In4MjVGUq79n0t20l2XtBWMxBi3Qwao5ZzXkdva5Chfl0zbmJB8Lnk6qw/HXf7rmjmacvHnJcP5x3Bv5LpZTqU5338PLaRdm/4hxYyNuDgDUz4Fc60IM/hWMSvXPflY8uRjPWcpjqqcvRs4SUfPcd1Kzpl51c32SNfbUEapBr+iVPPwIjgqoyzXwA7fwTXXTpF0EJnsw36AjJGDJEgGQSKPkEfJEImidJAcqM31/ldsP9dqdp7EFanDm0LeRdTboOD7B2QUwdraFwud5W4unzcf19VLL15fPvPhjjp3hSwev9K2fGbDf27BbAOvjf+b7/0/+q/6V/C96l+rM/zf+tfwWd10uo1er9aYEOoMR5bHrjsay7Of5IYo1nGxocVitrDQyXXMA/TZxM0EzPfW+fI38m/yivyG/Jb8i/CKcEH4SHhPeF/4EiRhSbgofCJ8JrwrfOCJUePcqcXcOUf1FEyzlUcxP8WwuFO8T4yKu8Td4ljdntgh9ouj4h7U7KxFx7ue9+w6HHPqMPfW1mtxnifOvtswznqDfyiNLB1OOkzLybMCnNrEcWeSLtJP4puyOshyvWb7P90igVggGgiBFOgJDAb6A4cYrjIDe1A3iG+sWjZ9ymaFOFIsnTL1nGZLA7L8kBTCq5pK8YLa1ysphiE5KksyqUXNOZrpA3bP8xJ+I+Xc377tl+oy+zGAg7+zuleXTZcBzuP93vFgXdaNtfGu1/Am2a+WzTn3TvD5vgKwsvsG+KgtjPXqu0rlBtat5pcB1l+qVP48V6msv4n21/B2Mf4GjzuDirebG+gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAsSURBVDiNYxSTkGXADdg5OPDIMuGRIwhGNY8MzSz409DPHz9oZfOo5pGhGQABmwOMaHIlKQAAAABJRU5ErkJggg==",Ise=ec.canvas,CGe=36,rz=`${CGe}px`,B1=h.memo(()=>{const e=dt(),t=cGe(e),n=h.useMemo(()=>ve(rt,d=>{const u=bo(d,e);return u&&(u.type==="inpaint_mask"||u.type==="regional_guidance")?Eh(u.fill.color):null}),[e]),s=BW(n),i=h.useRef(null),o=le(t.transformer.$pixelRect),r=le(t.transformer.$nodeRect),l=le(t.$canvasCache),c=h.useMemo(()=>pr(()=>{if(!i.current)return;const d=i.current.getContext("2d");if(!d)return;const u=t.transformer.$pixelRect.get(),p=t.transformer.$nodeRect.get(),m=t.$canvasCache.get();if(!m||m.width===0||m.height===0||u.width===0||u.height===0){d.clearRect(0,0,i.current.width,i.current.height);return}d.clearRect(0,0,i.current.width,i.current.height),i.current.width=u.width,i.current.height=u.height;const f=u.x-p.x,g=u.y-p.y,v=u.width,b=u.height,C=0,y=0,x=u.width,w=u.height;d.drawImage(m,f,g,v,b,C,y,x,w),s&&(d.fillStyle=s,d.globalCompositeOperation="source-in",d.fillRect(0,0,u.width,u.height))},300),[t.$canvasCache,t.transformer.$nodeRect,t.transformer.$pixelRect,s]);return h.useEffect(c,[c,l,r,o]),a.jsx(He,{label:a.jsx(wGe,{canvasRef:i}),p:2,closeOnScroll:!0,children:a.jsxs(A,{position:"relative",alignItems:"center",justifyContent:"center",w:rz,h:rz,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[a.jsx(ke,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:Qh,bgSize:"5px"}),a.jsx(Ise,{position:"relative",ref:i,objectFit:"contain",maxW:"full",maxH:"full"})]})})});B1.displayName="CanvasEntityPreviewImage";const wGe=({canvasRef:e})=>{const t=h.useRef(null);return h.useEffect(()=>{if(!t.current||!e.current)return;const n=t.current.getContext("2d");if(n){if(e.current.width===0||e.current.height===0){n.clearRect(0,0,t.current.width,t.current.height);return}t.current.width=e.current.width,t.current.height=e.current.height,n.clearRect(0,0,t.current.width,t.current.height),n.drawImage(e.current,0,0)}},[e]),a.jsxs(A,{position:"relative",alignItems:"center",justifyContent:"center",w:150,h:150,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[a.jsx(ke,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:Qh,bgSize:"8px"}),a.jsx(Ise,{position:"relative",ref:t,objectFit:"contain",maxW:"full",maxH:"full"})]})},$S=h.memo(({children:e})=>a.jsx(A,{flexDir:"column",gap:2,px:2,pb:2,children:e}));$S.displayName="CanvasEntitySettingsWrapper";const rc=({value:e,defaultValue:t,onChange:n,onStartEditing:s,inputRef:i})=>{const[o,r]=h.useState(!1),[l,c]=h.useState(e),d=h.useCallback(()=>{const g=l.trim()||t;c(g),g!==e&&n(g),r(!1),i?.current?.setSelectionRange(0,0)},[l,t,e,i,n]),u=h.useCallback(f=>{c(f.target.value)},[]),p=h.useCallback(f=>{f.key==="Enter"&&!f.shiftKey?d():f.key==="Escape"&&(c(e),n(e),r(!1))},[n,d,e]),m=h.useCallback(()=>{r(!0),s?.()},[s]);return h.useEffect(()=>{c(e)},[e]),h.useEffect(()=>{o&&(i?.current?.focus(),i?.current?.select())},[i,o]),{isEditing:o,startEditing:m,value:l,inputProps:{value:l,onChange:u,onKeyDown:p,onBlur:d}}},_Ge=e=>ve(rt,t=>{const n=bo(t,e);return n?n.name:null}),jse=e=>{const t=h.useMemo(()=>_Ge(e),[e]);return M(t)},Ese=e=>{const{t}=T();return h.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.inpaintMask");case"control_layer":return t("controlLayers.controlLayer");case"raster_layer":return t("controlLayers.rasterLayer");case"regional_guidance":return t("controlLayers.regionalGuidance");default:ae(!1,"Unexpected entity type")}},[e,t])},Ase=e=>{const t=jse(e),n=Ese(e.type);return h.useMemo(()=>t||n,[t,n])},Pse=h.memo(e=>{const t=dt(),n=Hne(t),s=Ase(t);return a.jsx(q,{size:"sm",fontWeight:"semibold",userSelect:"none",color:n?"base.100":"base.300",...e,children:s})});Pse.displayName="CanvasEntityTitle";const z1=h.memo(()=>{const e=Q(),t=dt(),n=h.useRef(null),s=jse(t),i=Ese(t.type),o=h.useCallback(l=>{e(Kbe({entityIdentifier:t,name:l}))},[e,t]),r=rc({value:s||i,defaultValue:i,onChange:o,inputRef:n});return r.isEditing?a.jsx(Nt,{ref:n,...r.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}}):a.jsx(Pse,{cursor:"text",onDoubleClick:r.startEditing})});z1.displayName="CanvasEntityTitleEdit";const wu=h.memo(e=>{const t=h.useMemo(()=>Zbe(e.entityIdentifier),[e.entityIdentifier]);return M(t)?e.children:null});wu.displayName="CanvasEntityStateGate";const SGe=e=>ve(rt,t=>co(t,e,"ControlLayerBadgesContent").withTransparencyEffect),Tse=h.memo(()=>{const e=dt("control_layer"),{t}=T(),n=h.useMemo(()=>SGe(e),[e]);return M(n)?a.jsx(Bi,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.transparency")}):null});Tse.displayName="ControlLayerBadgesContent";const Dse=h.memo(()=>{const e=dt("control_layer");return a.jsx(wu,{entityIdentifier:e,children:a.jsx(Tse,{})})});Dse.displayName="ControlLayerBadges";const kGe=e=>`${Math.round(e*100)}%`,IGe=["Begin Step %","End Step %"],GS=h.memo(({beginEndStepPct:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(()=>{t([0,1])},[t]);return a.jsxs(te,{orientation:"horizontal",pe:2,children:[a.jsx(Ue,{feature:"controlNetBeginEnd",children:a.jsx(ne,{m:0,children:n("controlLayers.beginEndStepPercentShort")})}),a.jsx(Xbe,{"aria-label":IGe,value:e,onChange:t,onReset:s,min:0,max:1,step:.05,fineStep:.01,minStepsBetweenThumbs:1,formatValue:kGe,marks:!0,withThumbTooltip:!0})]})});GS.displayName="BeginEndStepPct";const ll={initial:1,sliderMin:0,sliderMax:2,numberInputMin:-1,numberInputMax:2,fineStep:.01,coarseStep:.05},jGe=e=>e.toFixed(2),EGe=[0,1,2],HS=h.memo(({weight:e,onChange:t})=>{const{t:n}=T();return a.jsxs(te,{orientation:"horizontal",children:[a.jsx(Ue,{feature:"controlNetWeight",children:a.jsx(ne,{m:0,children:n("controlLayers.weight")})}),a.jsx(it,{value:e,onChange:t,defaultValue:ll.initial,min:ll.sliderMin,max:ll.sliderMax,step:ll.coarseStep,fineStep:ll.fineStep,marks:EGe,formatValue:jGe}),a.jsx(Pe,{value:e,onChange:t,min:ll.numberInputMin,max:ll.numberInputMax,step:ll.coarseStep,fineStep:ll.fineStep,maxW:20,defaultValue:ll.initial})]})});HS.displayName="Weight";const Mse=h.memo(({controlMode:e,onChange:t})=>{const{t:n}=T(),s=h.useMemo(()=>[{label:n("controlLayers.controlMode.balanced"),value:"balanced"},{label:n("controlLayers.controlMode.prompt"),value:"more_prompt"},{label:n("controlLayers.controlMode.control"),value:"more_control"},{label:n("controlLayers.controlMode.megaControl"),value:"unbalanced"}],[n]),i=h.useCallback(r=>{ae(Ybe(r?.value)),t(r.value)},[t]),o=h.useMemo(()=>s.filter(r=>r.value===e)[0],[s,e]);return e?a.jsxs(te,{children:[a.jsx(Ue,{feature:"controlNetControlMode",children:a.jsx(ne,{m:0,children:n("controlLayers.controlMode.controlMode")})}),a.jsx(pt,{value:o,options:s,onChange:i,isClearable:!1,isSearchable:!1})]}):null});Mse.displayName="ControlLayerControlAdapterControlMode";const AGe=e=>e.base.toUpperCase(),PGe=e=>`${e.base.toUpperCase()} / ${e.type.replaceAll("_"," ").toUpperCase()}`,TGe=ve(oo,e=>e.model?.base??"sdxl"),Jh=e=>{const{t}=T(),n=M(TGe),s=M(d_),{modelConfigs:i,selectedModel:o,getIsDisabled:r,onChange:l,isLoading:c,groupByType:d=!1}=e,u=h.useMemo(()=>{if(!i)return[];const v=$D(i,d?PGe:AGe),b=OD(v,(C,y,x)=>(C.push({label:x,options:y.map(w=>({label:w.name,value:w.key,description:s&&w.description||void 0,isDisabled:r?r(w):!1}))}),C),[]);return b.sort(C=>C.label?.split("/")[0]?.toLowerCase().includes(n)?-1:1),b},[i,d,r,n,s]),p=h.useMemo(()=>u.flatMap(v=>v.options).find(v=>o?v.value===o.key:!1)??null,[u,o]),m=h.useCallback(v=>{if(!v){l(null);return}const b=i.find(C=>C.key===v.value);if(!b){l(null);return}l(b)},[i,l]),f=h.useMemo(()=>c?t("common.loading"):u.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[c,u,t]),g=h.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:u,value:p,onChange:m,placeholder:f,noOptionsMessage:g}},Lse=h.memo(({modelKey:e,onChange:t})=>{const{t:n}=T(),s=M(qc),[i,{isLoading:o}]=Qbe(),r=h.useMemo(()=>i.find(f=>f.key===e),[i,e]),l=h.useCallback(f=>{f&&t(f)},[t]),c=h.useCallback(f=>{const g=s===f.base;return!!!s||!g},[s]),{options:d,value:u,onChange:p,noOptionsMessage:m}=Jh({modelConfigs:i,onChange:l,selectedModel:r,getIsDisabled:c,isLoading:o,groupByType:!0});return a.jsx(He,{label:r?.description,children:a.jsx(te,{isInvalid:!u||s!==r?.base,w:"full",children:a.jsx(pt,{options:d,placeholder:n("common.placeholderSelectAModel"),value:u,onChange:p,noOptionsMessage:m})})})});Lse.displayName="ControlLayerControlAdapterModel";const Rse=Ds(["Red (RGBA)","Green (RGBA)","Blue (RGBA)","Alpha (RGBA)","Cyan (CMYK)","Magenta (CMYK)","Yellow (CMYK)","Black (CMYK)","Hue (HSV)","Saturation (HSV)","Value (HSV)","Luminosity (LAB)","A (LAB)","B (LAB)","Y (YCbCr)","Cb (YCbCr)","Cr (YCbCr)"]),DGe=e=>Rse.safeParse(e).success,MGe=ct({type:Ie("adjust_image"),channel:Rse,value:Et(),scale_values:ss().optional()}),LGe=ct({type:Ie("canny_edge_detection"),low_threshold:Et().int().gte(0).lte(255),high_threshold:Et().int().gte(0).lte(255)}),RGe=ct({type:Ie("color_map"),tile_size:Et().int().gte(1)}),OGe=ct({type:Ie("content_shuffle"),scale_factor:Et().int().gte(1)}),Ose=Ds(["large","base","small","small_v2"]),NGe=e=>Ose.safeParse(e).success,FGe=ct({type:Ie("depth_anything_depth_estimation"),model_size:Ose}),BGe=ct({type:Ie("hed_edge_detection"),scribble:ss()}),zGe=ct({type:Ie("lineart_anime_edge_detection")}),VGe=ct({type:Ie("lineart_edge_detection"),coarse:ss()}),$Ge=ct({type:Ie("mediapipe_face_detection"),max_faces:Et().int().gte(1),min_confidence:Et().gte(0).lte(1)}),GGe=ct({type:Ie("mlsd_detection"),score_threshold:Et().gte(0),distance_threshold:Et().gte(0)}),HGe=ct({type:Ie("normal_map")}),WGe=ct({type:Ie("pidi_edge_detection"),quantize_edges:ss(),scribble:ss()}),UGe=ct({type:Ie("dw_openpose_detection"),draw_body:ss(),draw_face:ss(),draw_hands:ss()}),qGe=ct({type:Ie("spandrel_filter"),model:_s.nullable(),autoScale:ss(),scale:Et().gte(1).lte(16)}),Nse=Ds(["gaussian","box"]),KGe=e=>Nse.safeParse(e).success,ZGe=ct({type:Ie("img_blur"),blur_type:Nse,radius:Et().gte(0)}),Fse=Ds(["gaussian","salt_and_pepper"]),XGe=e=>Fse.safeParse(e).success,YGe=ct({type:Ie("img_noise"),noise_type:Fse,amount:Et().gte(0).lte(1),noise_color:ss(),size:Et().int().gte(1)});cM("type",[MGe,LGe,RGe,OGe,FGe,BGe,zGe,VGe,$Ge,GGe,HGe,WGe,UGe,qGe,ZGe,YGe]);const QGe=Ds(["adjust_image","canny_edge_detection","color_map","content_shuffle","depth_anything_depth_estimation","hed_edge_detection","lineart_anime_edge_detection","lineart_edge_detection","mediapipe_face_detection","mlsd_detection","normal_map","pidi_edge_detection","dw_openpose_detection","spandrel_filter","img_blur","img_noise"]),Bse=e=>QGe.safeParse(e).success,Vs={adjust_image:{type:"adjust_image",buildDefaults:()=>({type:"adjust_image",channel:"Luminosity (LAB)",value:1,scale_values:!1}),buildGraph:({image_name:e},{channel:t,value:n,scale_values:s})=>{const i=new hn(ee("adjust_image_filter"));let o;return s?o=i.addNode({id:ee("img_channel_multiply"),type:"img_channel_multiply",image:{image_name:e},channel:t,scale:n,invert_channel:!1}):(n=Math.min(n,2),o=i.addNode({id:ee("img_channel_offset"),type:"img_channel_offset",image:{image_name:e},channel:t,offset:Math.round(255*(n-1))})),{graph:i,outputNodeId:o.id}}},canny_edge_detection:{type:"canny_edge_detection",buildDefaults:()=>({type:"canny_edge_detection",low_threshold:100,high_threshold:200}),buildGraph:({image_name:e},{low_threshold:t,high_threshold:n})=>{const s=new hn(ee("canny_edge_detection_filter")),i=s.addNode({id:ee("canny_edge_detection"),type:"canny_edge_detection",image:{image_name:e},low_threshold:t,high_threshold:n});return{graph:s,outputNodeId:i.id}}},color_map:{type:"color_map",buildDefaults:()=>({type:"color_map",tile_size:64}),buildGraph:({image_name:e},{tile_size:t})=>{const n=new hn(ee("color_map_filter")),s=n.addNode({id:ee("color_map"),type:"color_map",image:{image_name:e},tile_size:t});return{graph:n,outputNodeId:s.id}}},content_shuffle:{type:"content_shuffle",buildDefaults:()=>({type:"content_shuffle",scale_factor:256}),buildGraph:({image_name:e},{scale_factor:t})=>{const n=new hn(ee("content_shuffle_filter")),s=n.addNode({id:ee("content_shuffle"),type:"content_shuffle",image:{image_name:e},scale_factor:t});return{graph:n,outputNodeId:s.id}}},depth_anything_depth_estimation:{type:"depth_anything_depth_estimation",buildDefaults:()=>({type:"depth_anything_depth_estimation",model_size:"small_v2"}),buildGraph:({image_name:e},{model_size:t})=>{const n=new hn(ee("depth_anything_depth_estimation_filter")),s=n.addNode({id:ee("depth_anything_depth_estimation"),type:"depth_anything_depth_estimation",image:{image_name:e},model_size:t});return{graph:n,outputNodeId:s.id}}},hed_edge_detection:{type:"hed_edge_detection",buildDefaults:()=>({type:"hed_edge_detection",scribble:!1}),buildGraph:({image_name:e},{scribble:t})=>{const n=new hn(ee("hed_edge_detection_filter")),s=n.addNode({id:ee("hed_edge_detection"),type:"hed_edge_detection",image:{image_name:e},scribble:t});return{graph:n,outputNodeId:s.id}}},lineart_anime_edge_detection:{type:"lineart_anime_edge_detection",buildDefaults:()=>({type:"lineart_anime_edge_detection"}),buildGraph:({image_name:e})=>{const t=new hn(ee("lineart_anime_edge_detection_filter")),n=t.addNode({id:ee("lineart_anime_edge_detection"),type:"lineart_anime_edge_detection",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},lineart_edge_detection:{type:"lineart_edge_detection",buildDefaults:()=>({type:"lineart_edge_detection",coarse:!1}),buildGraph:({image_name:e},{coarse:t})=>{const n=new hn(ee("lineart_edge_detection_filter")),s=n.addNode({id:ee("lineart_edge_detection"),type:"lineart_edge_detection",image:{image_name:e},coarse:t});return{graph:n,outputNodeId:s.id}}},mediapipe_face_detection:{type:"mediapipe_face_detection",buildDefaults:()=>({type:"mediapipe_face_detection",max_faces:1,min_confidence:.5}),buildGraph:({image_name:e},{max_faces:t,min_confidence:n})=>{const s=new hn(ee("mediapipe_face_detection_filter")),i=s.addNode({id:ee("mediapipe_face_detection"),type:"mediapipe_face_detection",image:{image_name:e},max_faces:t,min_confidence:n});return{graph:s,outputNodeId:i.id}}},mlsd_detection:{type:"mlsd_detection",buildDefaults:()=>({type:"mlsd_detection",score_threshold:.1,distance_threshold:20}),buildGraph:({image_name:e},{score_threshold:t,distance_threshold:n})=>{const s=new hn(ee("mlsd_detection_filter")),i=s.addNode({id:ee("mlsd_detection"),type:"mlsd_detection",image:{image_name:e},score_threshold:t,distance_threshold:n});return{graph:s,outputNodeId:i.id}}},normal_map:{type:"normal_map",buildDefaults:()=>({type:"normal_map"}),buildGraph:({image_name:e})=>{const t=new hn(ee("normal_map_filter")),n=t.addNode({id:ee("normal_map"),type:"normal_map",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},pidi_edge_detection:{type:"pidi_edge_detection",buildDefaults:()=>({type:"pidi_edge_detection",quantize_edges:!1,scribble:!1}),buildGraph:({image_name:e},{quantize_edges:t,scribble:n})=>{const s=new hn(ee("pidi_edge_detection_filter")),i=s.addNode({id:ee("pidi_edge_detection"),type:"pidi_edge_detection",image:{image_name:e},quantize_edges:t,scribble:n});return{graph:s,outputNodeId:i.id}}},dw_openpose_detection:{type:"dw_openpose_detection",buildDefaults:()=>({type:"dw_openpose_detection",draw_body:!0,draw_face:!0,draw_hands:!0}),buildGraph:({image_name:e},{draw_body:t,draw_face:n,draw_hands:s})=>{const i=new hn(ee("dw_openpose_detection_filter")),o=i.addNode({id:ee("dw_openpose_detection"),type:"dw_openpose_detection",image:{image_name:e},draw_body:t,draw_face:n,draw_hands:s});return{graph:i,outputNodeId:o.id}}},spandrel_filter:{type:"spandrel_filter",buildDefaults:()=>({type:"spandrel_filter",model:null,autoScale:!0,scale:1}),buildGraph:({image_name:e},{model:t,scale:n,autoScale:s})=>{ae(t!==null);const i=new hn(ee("spandrel_filter")),o=i.addNode(s?{id:ee("spandrel_image_to_image_autoscale"),type:"spandrel_image_to_image_autoscale",image_to_image_model:t,image:{image_name:e},scale:n}:{id:ee("spandrel_image_to_image"),type:"spandrel_image_to_image",image_to_image_model:t,image:{image_name:e}});return{graph:i,outputNodeId:o.id}},validateConfig:e=>!!e.model},img_blur:{type:"img_blur",buildDefaults:()=>({type:"img_blur",blur_type:"gaussian",radius:8}),buildGraph:({image_name:e},{blur_type:t,radius:n})=>{const s=new hn(ee("img_blur")),i=s.addNode({id:ee("img_blur"),type:"img_blur",image:{image_name:e},blur_type:t,radius:n});return{graph:s,outputNodeId:i.id}}},img_noise:{type:"img_noise",buildDefaults:()=>({type:"img_noise",noise_type:"gaussian",amount:.3,noise_color:!0,size:1}),buildGraph:({image_name:e},{noise_type:t,amount:n,noise_color:s,size:i})=>{const o=new hn(ee("img_noise")),r=o.addNode({id:ee("img_noise"),type:"img_noise",image:{image_name:e},noise_type:t,amount:n,noise_color:s,size:i}),l=o.addNode({id:ee("rand_int"),use_cache:!1,type:"rand_int",low:0,high:2147483647});return o.addEdge(l,"value",r,"seed"),{graph:o,outputNodeId:r.id}}}},JGe={canny_image_processor:"canny_edge_detection",mlsd_image_processor:"mlsd_detection",depth_anything_image_processor:"depth_anything_depth_estimation",normalbae_image_processor:"normal_map",pidi_image_processor:"pidi_edge_detection",lineart_image_processor:"lineart_edge_detection",lineart_anime_image_processor:"lineart_anime_edge_detection",hed_image_processor:"hed_edge_detection",content_shuffle_image_processor:"content_shuffle",dw_openpose_image_processor:"dw_openpose_detection",mediapipe_face_processor:"mediapipe_face_detection",zoe_depth_image_processor:"depth_anything_depth_estimation",color_map_image_processor:"color_map"},zse=e=>{if(!e)return null;const t=e?.default_settings?.preprocessor;if(!t)return null;if(Bse(t))return Vs[t];const n=JGe[t];return n?Vs[n]:null},eHe=e=>ve(rt,t=>co(t,e,"ControlLayerControlAdapter").controlAdapter),Vse=h.memo(()=>{const{t:e}=T(),{dispatch:t,getState:n}=Ze(),s=dt("control_layer"),i=h.useMemo(()=>eHe(s),[s]),o=M(i),r=VS(s),l=M(Hc),c=Zne("control_layer"),d=h.useCallback(C=>{t(Jbe({entityIdentifier:s,beginEndStepPct:C}))},[t,s]),u=h.useCallback(C=>{t(exe({entityIdentifier:s,controlMode:C}))},[t,s]),p=h.useCallback(C=>{t(txe({entityIdentifier:s,weight:C}))},[t,s]),m=h.useCallback(C=>{t(nxe({entityIdentifier:s,modelConfig:C}));const y=c.filterer.$isFiltering.get(),x=c.filterer.$simple.get();if(y&&!x)return;const w=zse(C);if(!w){y&&c.filterer.cancel();return}const _=w.buildDefaults();y?(c.filterer.$filterConfig.set(_),c.filterer.process()):c.filterer.start(_)},[c.filterer,t,s]),f=use(s),g=xt(),v=h.useMemo(()=>({onUpload:C=>{O4({entityIdentifier:s,imageDTO:C,dispatch:t,getState:n})},allowMultiple:!1}),[t,s,n]),b=Yo(v);return a.jsxs(A,{flexDir:"column",gap:3,position:"relative",w:"full",children:[a.jsxs(A,{w:"full",gap:2,children:[a.jsx(Lse,{modelKey:o.model?.key??null,onChange:m}),a.jsx(oe,{onClick:r.start,isDisabled:r.isDisabled,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:a.jsx(nS,{})}),a.jsx(oe,{onClick:f,isDisabled:g,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.pullBboxIntoLayer"),tooltip:e("controlLayers.pullBboxIntoLayer"),icon:a.jsx(nc,{})}),a.jsx(oe,{isDisabled:g,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("accessibility.uploadImage"),tooltip:e("accessibility.uploadImage"),icon:a.jsx(qo,{}),...b.getUploadButtonProps()}),a.jsx("input",{...b.getUploadInputProps()})]}),a.jsx(HS,{weight:o.weight,onChange:p}),o.type!=="control_lora"&&a.jsx(GS,{beginEndStepPct:o.beginEndStepPct,onChange:d}),o.type==="controlnet"&&!l&&a.jsx(Mse,{controlMode:o.controlMode,onChange:u})]})});Vse.displayName="ControlLayerControlAdapter";const $se=h.memo(()=>{const e=dt("control_layer"),{dispatch:t,getState:n}=Ze(),s=xt(),i=h.useCallback(c=>{O4({imageDTO:c,entityIdentifier:e,dispatch:t,getState:n})},[t,e,n]),o=Yo({onUpload:i,allowMultiple:!1}),r=use(e),l=h.useMemo(()=>({UploadButton:a.jsx(he,{isDisabled:s,size:"sm",variant:"link",color:"base.300",...o.getUploadButtonProps()}),PullBboxButton:a.jsx(he,{onClick:r,isDisabled:s,size:"sm",variant:"link",color:"base.300"})}),[s,r,o]);return a.jsxs(A,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[a.jsx(q,{textAlign:"center",color:"base.300",children:a.jsx(Bn,{i18nKey:"controlLayers.controlLayerEmptyState",components:l})}),a.jsx("input",{...o.getUploadInputProps()})]})});$se.displayName="ControlLayerSettingsEmptyState";const Gse=h.memo(()=>{const e=dt();return D1(e)?a.jsx($se,{}):a.jsx(Vse,{})});Gse.displayName="ControlLayerSettings";const tHe={position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",pointerEvents:"auto",'&[data-dnd-state="idle"]':{pointerEvents:"none"}},ds=h.memo(e=>{const{dndTarget:t,dndTargetData:n,label:s,isDisabled:i}=e,[o,r]=h.useState("idle"),l=h.useRef(null),c=Q();return h.useEffect(()=>{const d=l.current;if(!d||i)return;const{dispatch:u,getState:p}=uu();return zi(o1({element:d,canDrop:({source:m})=>{const f={sourceData:m.data,targetData:n,dispatch:u,getState:p};return t.isValid(f)},onDragEnter:()=>{r("over")},onDragLeave:()=>{r("potential")},getData:()=>n}),Gh({canMonitor:({source:m})=>{const f={sourceData:m.data,targetData:n,dispatch:u,getState:p};return t.isValid(f)},onDragStart:()=>{r("potential")},onDrop:()=>{r("idle")}}))},[c,i,t,n]),a.jsx(ke,{ref:l,sx:tHe,"data-dnd-state":o,children:a.jsx(N5,{dndState:o,label:s})})});ds.displayName="DndDropTarget";const Hse=h.memo(({id:e})=>{const{t}=T(),n=xt(),s=h.useMemo(()=>({id:e,type:"control_layer"}),[e]),i=h.useMemo(()=>Uv.getData({entityIdentifier:s},s.id),[s]);return a.jsx(Wm.Provider,{value:s,children:a.jsx(Une,{children:a.jsx(wu,{entityIdentifier:s,children:a.jsxs(A1,{children:[a.jsxs(N1,{children:[a.jsx(B1,{}),a.jsx(z1,{}),a.jsx(At,{}),a.jsx(Dse,{}),a.jsx(F1,{})]}),a.jsx($S,{children:a.jsx(Gse,{})}),a.jsx(ds,{dndTarget:Uv,dndTargetData:i,label:t("controlLayers.replaceLayer"),isDisabled:n})]})})})})});Hse.displayName="ControlLayer";const nHe=Yn(rt,e=>e.controlLayers.entities.map(xa).toReversed()),sHe=ve($n,e=>e?.type==="control_layer"),Wse=h.memo(()=>{const e=M(sHe),t=M(nHe);if(t.length===0)return null;if(t.length>0)return a.jsx(E1,{type:"control_layer",isSelected:e,entityIdentifiers:t,children:t.map(n=>a.jsx(Hse,{id:n.id},n.id))})});Wse.displayName="ControlLayerEntityList";const Q6=h.memo(({onDelete:e,...t})=>{const{t:n}=T();return a.jsx(oe,{tooltip:n("common.delete"),variant:"link","aria-label":n("common.delete"),icon:a.jsx(fn,{}),onClick:e,flexGrow:0,size:"sm",p:0,colorScheme:"error",...t})});Q6.displayName="InpaintMaskDeleteNoiseButton";const Use=h.memo(()=>{const e=dt("inpaint_mask"),{t}=T(),n=Q(),s=h.useMemo(()=>ve(rt,l=>co(l,e,"InpaintMaskDenoiseLimitSlider").denoiseLimit),[e]),i=M(s),o=h.useCallback(l=>{n(sxe({entityIdentifier:e,denoiseLimit:l}))},[n,e]),r=h.useCallback(()=>{n(ixe({entityIdentifier:e}))},[n,e]);return i===void 0?null:a.jsxs(A,{direction:"column",gap:1,w:"full",px:2,pb:2,children:[a.jsxs(A,{justifyContent:"space-between",w:"full",alignItems:"center",children:[a.jsx(q,{fontSize:"sm",children:t("controlLayers.denoiseLimit")}),a.jsxs(A,{alignItems:"center",gap:1,children:[a.jsx(q,{fontSize:"sm",children:i.toFixed(2)}),a.jsx(Q6,{onDelete:r})]})]}),a.jsxs(zW,{"aria-label":t("controlLayers.denoiseLimit"),value:i,min:0,max:1,step:.01,onChange:o,children:[a.jsx(VW,{children:a.jsx($W,{})}),a.jsx(GW,{})]})]})});Use.displayName="InpaintMaskDenoiseLimitSlider";const qse=h.memo(()=>{const e=dt("inpaint_mask"),{t}=T(),n=Q(),s=h.useMemo(()=>ve(rt,l=>co(l,e,"InpaintMaskNoiseSlider").noiseLevel),[e]),i=M(s),o=h.useCallback(l=>{n(oxe({entityIdentifier:e,noiseLevel:l}))},[n,e]),r=h.useCallback(()=>{n(axe({entityIdentifier:e}))},[n,e]);return i===void 0?null:a.jsxs(A,{direction:"column",gap:1,w:"full",px:2,pb:2,children:[a.jsxs(A,{justifyContent:"space-between",w:"full",alignItems:"center",children:[a.jsx(q,{fontSize:"sm",children:t("controlLayers.imageNoise")}),a.jsxs(A,{alignItems:"center",gap:1,children:[a.jsxs(q,{fontSize:"sm",children:[Math.round(i*100),"%"]}),a.jsx(Q6,{onDelete:r})]})]}),a.jsxs(zW,{"aria-label":t("controlLayers.imageNoise"),value:i,min:0,max:1,step:.01,onChange:o,children:[a.jsx(VW,{children:a.jsx($W,{})}),a.jsx(GW,{})]})]})});qse.displayName="InpaintMaskNoiseSlider";const iHe=e=>ve(rt,t=>co(t,e,"InpaintMaskSettings").denoiseLimit!==void 0),oHe=e=>ve(rt,t=>co(t,e,"InpaintMaskSettings").noiseLevel!==void 0),Kse=h.memo(()=>{const e=dt("inpaint_mask"),t=h.useMemo(()=>iHe(e),[e]),n=h.useMemo(()=>oHe(e),[e]),s=M(t),i=M(n);return!i&&!s?null:a.jsxs($S,{children:[i&&a.jsx(qse,{}),s&&a.jsx(Use,{})]})});Kse.displayName="InpaintMaskSettings";const Zse=h.memo(({id:e})=>{const t=h.useMemo(()=>({id:e,type:"inpaint_mask"}),[e]);return a.jsx(Wm.Provider,{value:t,children:a.jsx(qne,{children:a.jsx(wu,{entityIdentifier:t,children:a.jsxs(A1,{children:[a.jsxs(N1,{children:[a.jsx(B1,{}),a.jsx(z1,{}),a.jsx(At,{}),a.jsx(F1,{})]}),a.jsx(Kse,{})]})})})})});Zse.displayName="InpaintMask";const aHe=Yn(rt,e=>e.inpaintMasks.entities.map(xa).toReversed()),rHe=ve($n,e=>e?.type==="inpaint_mask"),Xse=h.memo(()=>{const e=M(rHe),t=M(aHe);if(t.length===0)return null;if(t.length>0)return a.jsx(E1,{type:"inpaint_mask",isSelected:e,entityIdentifiers:t,children:t.map(n=>a.jsx(Zse,{id:n.id},n.id))})});Xse.displayName="InpaintMaskList";const Tx=[[0,0],[255,255]],RT={master:"#888",r:"#e53e3e",g:"#38a169",b:"#3182ce"},Wc=(e,t,n)=>e<t?t:e>n?n:e,Gp=e=>[...e].sort((t,n)=>{const s=t[0]-n[0];return s||(t[0]===0||t[0]===255?t[1]-n[1]:0)}).map(([t,n])=>[Wc(Math.round(t),0,255),Wc(Math.round(n),0,255)]),dy=256,WS=160,za=8,J6=8,Ir=8,e3=10,lHe={width:"100%",aspectRatio:`${dy} / ${WS}`,height:"auto",touchAction:"none",borderRadius:4,background:"#111",display:"block"},lz=(e,t,n,s)=>{const i=window.devicePixelRatio||1,o=e.clientWidth||dy,r=o*WS/dy,l=Math.round(o*i),c=Math.round(r*i);(e.width!==l||e.height!==c)&&(e.width=l,e.height=c),e.style.height!==`${r}px`&&(e.style.height=`${r}px`);const d=e.getContext("2d");if(!d)return;d.setTransform(1,0,0,1,0,0),d.scale(i,i);const u=o-za-J6,p=r-Ir-e3,m=v=>za+Wc(v,0,255)/255*u,f=v=>Ir+p-Wc(v,0,255)/255*p;d.clearRect(0,0,o,r),d.fillStyle="#111",d.fillRect(0,0,o,r),d.strokeStyle="#2a2a2a",d.lineWidth=1;for(let v=0;v<=4;v++){const b=Ir+v*p/4;d.beginPath(),d.moveTo(za+.5,b+.5),d.lineTo(za+u-.5,b+.5),d.stroke()}for(let v=0;v<=4;v++){const b=za+v*u/4;d.beginPath(),d.moveTo(b+.5,Ir+.5),d.lineTo(b+.5,Ir+p-.5),d.stroke()}if(n){const v=n.map(C=>Math.log10((C??0)+1)),b=Math.max(1e-6,...v);if(d.fillStyle="#5557",u>=256)for(let C=0;C<256;C++){const x=(v[C]??0)/b*(p-2),w=za+C/256*u,S=za+(C+1)/256*u-w;if(S<=0)continue;const I=Ir+p-x;d.fillRect(w,I,S,x)}else{const C=Math.max(1,Math.round(u)),y=256/C;for(let x=0;x<C;x++){const w=Math.floor(x*y),_=Math.min(255,Math.floor((x+1)*y-1));let S=0,I=0;for(let D=w;D<=_;D++)S+=v[D]??0,I++;const E=(I>0?S/I:0)/b*(p-2),j=za+x,P=Ir+p-E;d.fillRect(j,P,1,E)}}}const g=Gp(s);d.strokeStyle=RT[t],d.lineWidth=2,d.beginPath();for(let v=0;v<g.length;v++){const[b,C]=g[v],y=m(b),x=f(C);v===0?d.moveTo(y,x):d.lineTo(y,x)}d.stroke();for(let v=0;v<g.length;v++){const[b,C]=g[v],y=m(b),x=f(C);d.fillStyle="#000",d.beginPath(),d.arc(y,x,3.5,0,Math.PI*2),d.fill(),d.strokeStyle=RT[t],d.lineWidth=1.5,d.stroke()}},cz=(e,t,n,s)=>{const i=e.clientWidth||dy,o=e.clientHeight||WS,r=i-za-J6,l=o-Ir-e3,c=g=>Wc(Math.round((g-za)/r*255),0,255),d=g=>Wc(Math.round(255-(g-Ir)/l*255),0,255),u=c(n),p=d(s);let m=-1,f=9999;for(let g=0;g<t.length;g++){const[v,b]=t[g],C=v-u,y=b-p,x=C*C+y*y;x<f&&(m=g,f=x)}return m!==-1&&f<=20*20?m:-1},dz=(e,t)=>{const s=(e.clientWidth||dy)-za-J6;return Wc(Math.round((t-za)/s*255),0,255)},uz=(e,t)=>{const s=(e.clientHeight||WS)-Ir-e3;return Wc(Math.round(255-(t-Ir)/s*255),0,255)},W0=h.memo(e=>{const{title:t,channel:n,points:s,histogram:i,onChange:o}=e,r=h.useRef(null),[l,c]=h.useState(Gp(s??Tx)),[d,u]=h.useState(null);h.useEffect(()=>{c(Gp(s??Tx))},[s]),h.useEffect(()=>{const y=r.current;y&&lz(y,n,i,l)},[n,i,l]);const p=h.useCallback(y=>{y.preventDefault(),y.stopPropagation();const x=r.current;if(!x)return;try{x.setPointerCapture(y.pointerId)}catch{}const w=x.getBoundingClientRect(),_=y.clientX-w.left,S=y.clientY-w.top,I=cz(x,l,_,S);if(I!==-1&&I!==0&&I!==l.length-1){u(I);return}const k=dz(x,_),E=uz(x,S),j=Gp([...l,[k,E]]);c(j),u(j.findIndex(([P,D])=>P===k&&D===E))},[l]),m=h.useCallback(y=>{if(y.preventDefault(),y.stopPropagation(),d===null)return;const x=r.current;if(!x)return;const w=x.getBoundingClientRect(),_=y.clientX-w.left,S=y.clientY-w.top,I=dz(x,_),k=uz(x,S);c(E=>{if(d===0||d===E.length-1)return E;const j=E[d-1][0],P=E[d+1][0],D=Math.min(254,j),O=Math.max(1,P),N=Wc(I,D,O),F=D>O?j+1-1:N,X=[...E];return X[d]=[F,k],X})},[d]),f=h.useCallback(y=>{o(Gp(y))},[o]),g=h.useCallback(y=>{y.preventDefault(),y.stopPropagation();const x=r.current;if(x)try{x.releasePointerCapture(y.pointerId)}catch{}u(null),f(l)},[f,l]),v=h.useCallback(y=>{const x=r.current;if(x)try{x.releasePointerCapture(y.pointerId)}catch{}u(null),f(l)},[f,l]),b=h.useCallback(y=>{y.preventDefault(),y.stopPropagation();const x=r.current;if(!x)return;const w=x.getBoundingClientRect(),_=y.clientX-w.left,S=y.clientY-w.top,I=cz(x,l,_,S);if(I>0&&I<l.length-1){const k=l.filter((E,j)=>j!==I);c(k),f(k)}},[f,l]);h.useEffect(()=>{const y=r.current;if(!y)return;const x=new ResizeObserver(()=>{lz(y,n,i,l)});return x.observe(y),()=>x.disconnect()},[n,i,l]);const C=h.useCallback(()=>{c(Gp(Tx)),f(Tx)},[f]);return a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsxs(A,{justifyContent:"space-between",children:[a.jsx(q,{fontSize:"sm",color:RT[n],fontWeight:"semibold",children:t}),a.jsx(oe,{icon:a.jsx(Gs,{}),"aria-label":"Reset",size:"sm",variant:"link",onClick:C})]}),a.jsx("canvas",{ref:r,onPointerDown:p,onPointerMove:m,onPointerUp:g,onPointerCancel:v,onDoubleClick:b,style:lHe})]})});W0.displayName="RasterLayerCurvesAdjustmentsGraph";const Dx=[[0,0],[255,255]],cHe={master:Dx,r:Dx,g:Dx,b:Dx},dHe=e=>{try{const t=e.data,n=t.length/4,s=new Array(256).fill(0),i=new Array(256).fill(0),o=new Array(256).fill(0),r=new Array(256).fill(0);for(let l=0;l<n;l+=4){const c=l*4,d=t[c],u=t[c+1],p=t[c+2],m=Math.round(.2126*d+.7152*u+.0722*p);m>=0&&m<256&&(s[m]=(s[m]??0)+1),d>=0&&d<256&&(i[d]=(i[d]??0)+1),u>=0&&u<256&&(o[u]=(o[u]??0)+1),p>=0&&p<256&&(r[p]=(r[p]??0)+1)}return{master:s,r:i,g:o,b:r}}catch{return null}},Yse=h.memo(()=>{const e=Q(),t=dt(),n=Zne("raster_layer"),{t:s}=T(),i=h.useMemo(()=>ve(rt,I=>bo(I,t)?.adjustments?.curves??cHe),[t]),o=M(i),r=h.useMemo(()=>ve(rt,I=>bo(I,t)?.adjustments?.enabled!==!0),[t]),l=M(r),c=le(n.$canvasCache),[d,u]=h.useState(null),[p,m]=h.useState(null),[f,g]=h.useState(null),[v,b]=h.useState(null),C=h.useCallback(()=>{try{const I=n.transformer.getRelativeRect();if(I.width===0||I.height===0){u(Array(256).fill(0)),m(Array(256).fill(0)),g(Array(256).fill(0)),b(Array(256).fill(0));return}const k=n.renderer.getImageData({rect:I}),E=dHe(k);E&&(u(E.master),m(E.r),g(E.g),b(E.b))}catch{}},[n]);h.useEffect(()=>{C()},[c,C]);const y=h.useCallback((I,k)=>{e(rxe({entityIdentifier:t,channel:I,points:k}))},[e,t]),x=h.useCallback(I=>y("master",I),[y]),w=h.useCallback(I=>y("r",I),[y]),_=h.useCallback(I=>y("g",I),[y]),S=h.useCallback(I=>y("b",I),[y]);return a.jsx(A,{direction:"column",gap:2,px:3,pb:3,opacity:l?.3:1,pointerEvents:l?"none":"auto",children:a.jsxs(ke,{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:4,children:[a.jsx(W0,{title:s("controlLayers.adjustments.master"),channel:"master",points:o.master,histogram:d,onChange:x}),a.jsx(W0,{title:s("common.red"),channel:"r",points:o.r,histogram:p,onChange:w}),a.jsx(W0,{title:s("common.green"),channel:"g",points:o.g,histogram:f,onChange:_}),a.jsx(W0,{title:s("common.blue"),channel:"b",points:o.b,histogram:v,onChange:S})]})})});Yse.displayName="RasterLayerCurvesEditor";const Cp=({label:e,name:t,onChange:n,min:s=-1,max:i=1,step:o=.01})=>{const r=dt(),l=h.useMemo(()=>ve(rt,d=>bo(d,r)?.adjustments?.simple?.[t]??uHe[t]),[r,t]),c=M(l);return a.jsxs(te,{orientation:"horizontal",mb:1,w:"full",children:[a.jsx(ne,{m:0,minW:"90px",children:e}),a.jsx(it,{value:c,onChange:n,defaultValue:0,min:s,max:i,step:o,marks:!0}),a.jsx(Pe,{value:c,onChange:n,defaultValue:0,min:s,max:i,step:o})]})},uHe={brightness:0,contrast:0,saturation:0,temperature:0,tint:0,sharpness:0},Qse=h.memo(()=>{const e=Q(),t=dt(),{t:n}=T(),s=h.useMemo(()=>ve(rt,p=>bo(p,t)?.adjustments?.enabled!==!0),[t]),i=M(s),o=h.useCallback(p=>e(lp({entityIdentifier:t,simple:{brightness:p}})),[e,t]),r=h.useCallback(p=>e(lp({entityIdentifier:t,simple:{contrast:p}})),[e,t]),l=h.useCallback(p=>e(lp({entityIdentifier:t,simple:{saturation:p}})),[e,t]),c=h.useCallback(p=>e(lp({entityIdentifier:t,simple:{temperature:p}})),[e,t]),d=h.useCallback(p=>e(lp({entityIdentifier:t,simple:{tint:p}})),[e,t]),u=h.useCallback(p=>e(lp({entityIdentifier:t,simple:{sharpness:p}})),[e,t]);return a.jsxs(A,{px:3,pb:2,direction:"column",opacity:i?.3:1,pointerEvents:i?"none":"auto",children:[a.jsx(Cp,{label:n("controlLayers.adjustments.brightness"),name:"brightness",onChange:o}),a.jsx(Cp,{label:n("controlLayers.adjustments.contrast"),name:"contrast",onChange:r}),a.jsx(Cp,{label:n("controlLayers.adjustments.saturation"),name:"saturation",onChange:l}),a.jsx(Cp,{label:n("controlLayers.adjustments.temperature"),name:"temperature",onChange:c}),a.jsx(Cp,{label:n("controlLayers.adjustments.tint"),name:"tint",onChange:d}),a.jsx(Cp,{label:n("controlLayers.adjustments.sharpness"),name:"sharpness",onChange:u,min:0,max:1})]})});Qse.displayName="RasterLayerSimpleAdjustmentsEditor";const Jse=h.memo(()=>{const{t:e}=T(),t=Q(),n=dt(),s=Tt(),i=h.useMemo(()=>ve(rt,x=>!!bo(x,n)?.adjustments),[n]),o=M(i),r=h.useMemo(()=>ve(rt,x=>bo(x,n)?.adjustments?.mode??"simple"),[n]),l=M(r),c=h.useMemo(()=>ve(rt,x=>bo(x,n)?.adjustments?.enabled??!1),[n]),d=M(c),u=h.useMemo(()=>ve(rt,x=>bo(x,n)?.adjustments?.collapsed??!1),[n]),p=M(u),m=h.useCallback(()=>{t(lxe({entityIdentifier:n}))},[t,n]),f=h.useCallback(()=>{t(cxe({entityIdentifier:n}))},[t,n]),g=h.useCallback(()=>{t(DW({entityIdentifier:n}))},[t,n]),v=h.useCallback(()=>{t(dxe({entityIdentifier:n}))},[t,n]),b=h.useCallback(()=>t($L({entityIdentifier:n,mode:"simple"})),[t,n]),C=h.useCallback(()=>t($L({entityIdentifier:n,mode:"curves"})),[t,n]),y=h.useCallback(async()=>{const x=s.getAdapter(n);if(!x||x.type!=="raster_layer_adapter")return;const w=x.transformer.getRelativeRect();try{await x.renderer.rasterize({rect:w,replaceObjects:!0,attrs:{opacity:1}}),t(MW({entityIdentifier:n,adjustments:null}))}catch{}},[s,n,t]);return o?a.jsxs(a.Fragment,{children:[a.jsxs(A,{px:2,pb:2,alignItems:"center",gap:2,children:[a.jsx(oe,{"aria-label":e(p?"controlLayers.adjustments.expand":"controlLayers.adjustments.collapse"),size:"sm",variant:"ghost",onClick:v,icon:a.jsx(Do,{style:{transform:p?"rotate(-90deg)":"rotate(0deg)",transition:"transform 0.2s"}})}),a.jsx(q,{fontWeight:600,flex:1,children:"Adjustments"}),a.jsxs(zn,{size:"sm",isAttached:!0,variant:"outline",children:[a.jsx(he,{onClick:b,colorScheme:l==="simple"?"invokeBlue":void 0,children:e("controlLayers.adjustments.simple")}),a.jsx(he,{onClick:C,colorScheme:l==="curves"?"invokeBlue":void 0,children:e("controlLayers.adjustments.curves")})]}),a.jsx(mt,{isChecked:d,onChange:m}),a.jsx(oe,{"aria-label":e("controlLayers.adjustments.cancel"),size:"md",onClick:g,isDisabled:!o,colorScheme:"red",icon:a.jsx(Qc,{}),variant:"ghost"}),a.jsx(oe,{"aria-label":e("controlLayers.adjustments.reset"),size:"md",onClick:f,isDisabled:!o,icon:a.jsx(Gs,{}),variant:"ghost"}),a.jsx(oe,{"aria-label":e("controlLayers.adjustments.finish"),size:"md",onClick:y,isDisabled:!o,colorScheme:"green",icon:a.jsx(Yc,{}),variant:"ghost"})]}),!p&&l==="simple"&&a.jsx(Qse,{}),!p&&l==="curves"&&a.jsx(Yse,{})]}):null});Jse.displayName="RasterLayerAdjustmentsPanel";const eie=h.memo(({id:e})=>{const{t}=T(),n=xt(),s=h.useMemo(()=>({id:e,type:"raster_layer"}),[e]),i=h.useMemo(()=>Uv.getData({entityIdentifier:s},s.id),[s]);return a.jsx(Wm.Provider,{value:s,children:a.jsx(Wne,{children:a.jsx(wu,{entityIdentifier:s,children:a.jsxs(A1,{children:[a.jsxs(N1,{children:[a.jsx(B1,{}),a.jsx(z1,{}),a.jsx(At,{}),a.jsx(F1,{})]}),a.jsx(Jse,{}),a.jsx(ds,{dndTarget:Uv,dndTargetData:i,label:t("controlLayers.replaceLayer"),isDisabled:n})]})})})})});eie.displayName="RasterLayer";const hHe=Yn(rt,e=>e.rasterLayers.entities.map(xa).toReversed()),pHe=ve($n,e=>e?.type==="raster_layer"),tie=h.memo(()=>{const e=M(pHe),t=M(hHe);if(t.length===0)return null;if(t.length>0)return a.jsx(E1,{type:"raster_layer",isSelected:e,entityIdentifiers:t,children:t.map(n=>a.jsx(eie,{id:n.id},n.id))})});tie.displayName="RasterLayerEntityList";const nie=h.memo(()=>{const e=dt("regional_guidance"),{t}=T(),n=h.useMemo(()=>ve(rt,i=>co(i,e,"RegionalGuidanceBadges").autoNegative),[e]),s=M(n);return a.jsx(a.Fragment,{children:s&&a.jsx(Bi,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.autoNegative")})})});nie.displayName="RegionalGuidanceBadges";const fHe=()=>{const e=dt("regional_guidance"),{t}=T(),n=PZ(e),s=TZ(e),i=DZ(e),o=h.useMemo(()=>MZ(e),[e]),r=M(o);return a.jsxs(A,{w:"full",p:2,justifyContent:"space-between",children:[a.jsx(he,{size:"sm",variant:"ghost",leftIcon:a.jsx(Sn,{}),onClick:s,isDisabled:!r.canAddPositivePrompt,children:t("controlLayers.prompt")}),a.jsx(he,{size:"sm",variant:"ghost",leftIcon:a.jsx(Sn,{}),onClick:i,isDisabled:!r.canAddNegativePrompt,children:t("controlLayers.negativePrompt")}),a.jsx(he,{size:"sm",variant:"ghost",leftIcon:a.jsx(Sn,{}),onClick:n,children:t("controlLayers.referenceImage")})]})},t3=h.memo(({imageInfluence:e,onChange:t})=>{const{t:n}=T(),s=h.useMemo(()=>[{label:n("controlLayers.fluxReduxImageInfluence.lowest"),value:"lowest"},{label:n("controlLayers.fluxReduxImageInfluence.low"),value:"low"},{label:n("controlLayers.fluxReduxImageInfluence.medium"),value:"medium"},{label:n("controlLayers.fluxReduxImageInfluence.high"),value:"high"},{label:n("controlLayers.fluxReduxImageInfluence.highest"),value:"highest"}],[n]),i=h.useCallback(r=>{ae(uxe(r?.value)),t(r.value)},[t]),o=h.useMemo(()=>s.find(r=>r.value===e),[s,e]);return a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.fluxReduxImageInfluence.imageInfluence")}),a.jsx(pt,{value:o,options:s,onChange:i})]})});t3.displayName="FLUXReduxImageInfluence";const OT="ViT-L",hz=[{label:"ViT-H",value:"ViT-H"},{label:"ViT-G",value:"ViT-G"},{label:OT,value:OT}],n3=h.memo(({model:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(l=>{ae(hxe(l?.value)),t(l.value)},[t]),i=M(Hc),o=h.useMemo(()=>hz.map(l=>({...l,isDisabled:i&&l.value!==OT})),[i]),r=h.useMemo(()=>hz.find(l=>l.value===e),[e]);return a.jsx(te,{width:"max-content",minWidth:28,children:a.jsx(pt,{options:o,placeholder:n("common.placeholderSelectAModel"),value:r,onChange:s})})});n3.displayName="IPAdapterCLIPVisionModel";const s3=h.memo(({method:e,onChange:t})=>{const{t:n}=T(),s=M(d_),i=h.useMemo(()=>[{label:n("controlLayers.ipAdapterMethod.full"),value:"full",description:s?n("controlLayers.ipAdapterMethod.fullDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.style"),value:"style",description:s?n("controlLayers.ipAdapterMethod.styleDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.styleStrong"),value:"style_strong",description:s?n("controlLayers.ipAdapterMethod.styleStrongDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.stylePrecise"),value:"style_precise",description:s?n("controlLayers.ipAdapterMethod.stylePreciseDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.composition"),value:"composition",description:s?n("controlLayers.ipAdapterMethod.compositionDesc"):void 0}],[n,s]),o=h.useCallback(l=>{ae(pxe(l?.value)),t(l.value)},[t]),r=h.useMemo(()=>i.find(l=>l.value===e),[i,e]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"ipAdapterMethod",children:a.jsx(ne,{m:0,children:n("controlLayers.ipAdapterMethod.ipAdapterMethod")})}),a.jsx(pt,{value:r,options:i,onChange:o})]})});s3.displayName="IPAdapterMethod";const sie=h.memo(({referenceImageId:e})=>{const{t}=T(),n=dt("regional_guidance"),s=Q(),i=xt(),o=h.useCallback(p=>{GZ({imageDTO:p,entityIdentifier:n,referenceImageId:e,dispatch:s})},[s,n,e]),r=Yo({onUpload:o,allowMultiple:!1}),l=h.useCallback(()=>{s(HW({entityIdentifier:n,referenceImageId:e}))},[s,n,e]),c=hse(n,e),d=h.useMemo(()=>Gv.getData({entityIdentifier:n,referenceImageId:e}),[n,e]),u=h.useMemo(()=>({UploadButton:a.jsx(he,{isDisabled:i,size:"sm",variant:"link",color:"base.300",...r.getUploadButtonProps()}),PullBboxButton:a.jsx(he,{onClick:c,isDisabled:i,size:"sm",variant:"link",color:"base.300"})}),[i,c,r]);return a.jsxs(A,{flexDir:"column",gap:2,position:"relative",w:"full",children:[a.jsxs(A,{alignItems:"center",gap:2,children:[a.jsx(q,{fontWeight:"semibold",color:"base.400",children:t("controlLayers.referenceImage")}),a.jsx(At,{}),a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",icon:a.jsx(fn,{}),tooltip:t("controlLayers.deleteReferenceImage"),"aria-label":t("controlLayers.deleteReferenceImage"),onClick:l,colorScheme:"error"})]}),a.jsx(A,{alignItems:"center",gap:2,p:4,children:a.jsx(q,{textAlign:"center",color:"base.300",children:a.jsx(Bn,{i18nKey:"controlLayers.referenceImageEmptyStateWithCanvasOptions",components:u})})}),a.jsx("input",{...r.getUploadInputProps()}),a.jsx(ds,{dndTarget:Gv,dndTargetData:d,label:t("controlLayers.useImage"),isDisabled:i})]})});sie.displayName="RegionalGuidanceIPAdapterSettingsEmptyState";const mHe=e=>!(e.base==="flux"&&e.type==="ip_adapter"),iie=h.memo(({modelKey:e,onChangeModel:t})=>{const{t:n}=T(),s=M(qc),[i,{isLoading:o}]=fxe(mHe),r=h.useMemo(()=>i.find(f=>f.key===e),[i,e]),l=h.useCallback(f=>{f&&t(f)},[t]),c=h.useCallback(f=>{const g=!!s,v=s===f.base;return!g||!v},[s]),{options:d,value:u,onChange:p,noOptionsMessage:m}=Jh({modelConfigs:i,onChange:l,selectedModel:r,getIsDisabled:c,isLoading:o});return a.jsx(He,{label:r?.description,children:a.jsx(te,{isInvalid:!u||s!==r?.base,w:"full",children:a.jsx(pt,{options:d,placeholder:n("common.placeholderSelectAModel"),value:u,onChange:p,noOptionsMessage:m})})})});iie.displayName="RegionalReferenceImageModel";function gHe(){return{x:0,y:0}}function oie(e){var t=e.render,n=e.nativeSetDragImage,s=e.getOffset,i=s===void 0?gHe:s,o=document.createElement("div");Object.assign(o.style,{position:"fixed",top:0,left:0,zIndex:CZ,pointerEvents:"none"}),document.body.append(o);var r=t({container:o});queueMicrotask(function(){var d=i({container:o});if(Cm()){var u=o.getBoundingClientRect();if(u.width===0)return;o.style.left="-".concat(u.width-1e-4,"px")}n?.(o,d.x,d.y)});function l(){c(),r?.(),document.body.removeChild(o)}var c=Gh({onDragStart:l,onDrop:l})}const vHe=ec("img"),aie=h.memo(({imageDTO:e})=>a.jsx(A,{w:qC,h:qC,children:a.jsx(vHe,{margin:"auto",maxW:"full",maxH:"full",objectFit:"contain",borderRadius:"base",src:e.thumbnail_url})}));aie.displayName="DndDragPreviewSingleImage";const rie=e=>pu.createPortal(a.jsx(aie,{imageDTO:e.imageDTO}),e.container),lie=({singleImageDndData:e,onGenerateDragPreviewArgs:t,setDragPreviewState:n})=>{const{nativeSetDragImage:s,source:i,location:o}=t;oie({render({container:r}){return n({type:"single-image",container:r,imageDTO:e.payload.imageDTO}),()=>n(null)},nativeSetDragImage:s,getOffset:$ne({element:i.element,input:o.current.input})})},yHe={objectFit:"contain",maxW:"full",maxH:"full",cursor:"grab","&[data-is-dragging=true]":{opacity:.3}},lc=h.memo(h.forwardRef(({imageDTO:e,asThumbnail:t,...n},s)=>{const i=Ze(),[o,r]=h.useState(!1),l=h.useRef(null);h.useImperativeHandle(s,()=>l.current,[]);const[c,d]=h.useState(null);return h.useEffect(()=>{const u=l.current;if(u)return zi(Hm(u),wm({element:u,getInitialData:()=>Ss.getData({imageDTO:e},e.image_name),onDragStart:()=>{r(!0)},onDrop:()=>{r(!1)},onGenerateDragPreview:p=>{Ss.typeGuard(p.source.data)&&lie({singleImageDndData:p.source.data,onGenerateDragPreviewArgs:p,setDragPreviewState:d})}}))},[s,e,i]),QQ(e,l),a.jsxs(a.Fragment,{children:[a.jsx(Nn,{role:"button",ref:l,src:t?e.thumbnail_url:e.image_url,fallbackSrc:t?void 0:e.thumbnail_url,width:e.width,height:e.height,sx:yHe,"data-is-dragging":o,...n}),c?.type==="single-image"?rie(c):null]})}));lc.displayName="DndImage";const bHe={minW:0,svg:{transitionProperty:"common",transitionDuration:"normal",fill:"base.100",_hover:{fill:"base.50"},filter:`drop-shadow(0px 0px 0.1rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))`}},nr=h.memo(e=>{const{onClick:t,tooltip:n,icon:s,...i}=e;return a.jsx(oe,{onClick:t,tooltip:n,"aria-label":n,icon:s,variant:"link",sx:bHe,"data-testid":n,...i})});nr.displayName="DndImageIcon";const cie=h.memo(({image:e,onChangeImage:t,dndTarget:n,dndTargetData:s})=>{const{t:i}=T(),o=Ze(),r=le(ks),l=M(un),c=Io(),{currentData:d,isError:u}=eu(e?.image_name??Ri),p=h.useCallback(()=>{t(null)},[t]);h.useEffect(()=>{r&&u&&p()},[p,u,r]);const m=h.useCallback(g=>{t(g)},[t]),f=h.useCallback(()=>{if(!d||l==="canvas"&&c)return;const{width:g,height:v}=d;l==="canvas"?(o.dispatch(WW({width:g,height:v})),o.dispatch(xM())):l==="generate"&&(o.dispatch(UW({width:g,height:v})),o.dispatch(CM()))},[d,c,o,l]);return a.jsxs(A,{position:"relative",w:"full",h:"full",alignItems:"center","data-error":!d&&!e?.image_name,children:[!d&&a.jsx(C1,{w:"full",h:"full",isError:!d&&!e?.image_name,onUpload:m,fontSize:36}),d&&a.jsxs(a.Fragment,{children:[a.jsx(lc,{imageDTO:d,borderRadius:"base",borderWidth:1,borderStyle:"solid",w:"full"}),a.jsx(A,{position:"absolute",flexDir:"column",top:2,insetInlineEnd:2,gap:1,children:a.jsx(nr,{onClick:p,icon:a.jsx(Gs,{size:16}),tooltip:i("common.reset")})}),a.jsx(A,{position:"absolute",flexDir:"column",bottom:2,insetInlineEnd:2,gap:1,children:a.jsx(nr,{onClick:f,icon:a.jsx(qv,{size:16}),tooltip:i("parameters.useSize"),isDisabled:!d||l==="canvas"&&c})})]}),a.jsx(ds,{dndTarget:n,dndTargetData:s,label:i("gallery.drop")})]})});cie.displayName="RegionalGuidanceRefImageImage";const die=h.memo(({referenceImageId:e})=>{const t=dt("regional_guidance"),{t:n}=T(),s=Q(),i=h.useCallback(()=>{s(HW({entityIdentifier:t,referenceImageId:e}))},[s,t,e]),o=h.useMemo(()=>ve(rt,C=>{const y=qW(C,t,e);return ae(y,`Regional Guidance IP Adapter with id ${e} not found`),y.config}),[t,e]),r=M(o),l=h.useCallback(C=>{s(mxe({entityIdentifier:t,referenceImageId:e,beginEndStepPct:C}))},[s,t,e]),c=h.useCallback(C=>{s(gxe({entityIdentifier:t,referenceImageId:e,weight:C}))},[s,t,e]),d=h.useCallback(C=>{s(vxe({entityIdentifier:t,referenceImageId:e,method:C}))},[s,t,e]),u=h.useCallback(C=>{s(yxe({entityIdentifier:t,referenceImageId:e,imageInfluence:C}))},[s,t,e]),p=h.useCallback(C=>{s(bxe({entityIdentifier:t,referenceImageId:e,modelConfig:C}))},[s,t,e]),m=h.useCallback(C=>{s(xxe({entityIdentifier:t,referenceImageId:e,clipVisionModel:C}))},[s,t,e]),f=h.useCallback(C=>{s(eM({entityIdentifier:t,referenceImageId:e,imageDTO:C}))},[s,t,e]),g=h.useMemo(()=>Gv.getData({entityIdentifier:t,referenceImageId:e},r.image?.image_name),[t,r.image,e]),v=hse(t,e),b=xt();return a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsxs(A,{alignItems:"center",gap:2,children:[a.jsx(q,{fontWeight:"semibold",color:"base.400",children:n("controlLayers.referenceImage")}),a.jsx(At,{}),a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",icon:a.jsx(fn,{}),tooltip:n("controlLayers.deleteReferenceImage"),"aria-label":n("controlLayers.deleteReferenceImage"),onClick:i,colorScheme:"error"})]}),a.jsxs(A,{flexDir:"column",gap:2,position:"relative",w:"full",children:[a.jsxs(A,{gap:2,alignItems:"center",w:"full",children:[a.jsx(iie,{modelKey:r.model?.key??null,onChangeModel:p}),r.type==="ip_adapter"&&a.jsx(n3,{model:r.clipVisionModel,onChange:m}),a.jsx(oe,{onClick:v,isDisabled:b,variant:"ghost","aria-label":n("controlLayers.pullBboxIntoReferenceImage"),tooltip:n("controlLayers.pullBboxIntoReferenceImage"),icon:a.jsx(nc,{})})]}),a.jsxs(A,{gap:2,w:"full",children:[r.type==="ip_adapter"&&a.jsxs(A,{flexDir:"column",gap:2,w:"full",children:[a.jsx(s3,{method:r.method,onChange:d}),a.jsx(HS,{weight:r.weight,onChange:c}),a.jsx(GS,{beginEndStepPct:r.beginEndStepPct,onChange:l})]}),r.type==="flux_redux"&&a.jsx(A,{flexDir:"column",gap:2,w:"full",children:a.jsx(t3,{imageInfluence:r.imageInfluence??"lowest",onChange:u})}),a.jsx(A,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",flexGrow:1,children:a.jsx(cie,{image:r.image,onChangeImage:f,dndTarget:Gv,dndTargetData:g})})]})]})]})});die.displayName="RegionalGuidanceIPAdapterSettingsContent";const xHe=(e,t)=>ve(rt,n=>{const s=qW(n,e,t);return!!s&&s.config.image!==null}),uie=h.memo(({referenceImageId:e})=>{const t=dt("regional_guidance"),n=h.useMemo(()=>xHe(t,e),[t,e]);return M(n)?a.jsx(die,{referenceImageId:e}):a.jsx(sie,{referenceImageId:e})});uie.displayName="RegionalGuidanceIPAdapterSettings";const hie=h.memo(()=>{const e=dt("regional_guidance"),t=h.useMemo(()=>Yn(rt,s=>{const i=co(s,e,"RegionalGuidanceIPAdapters").referenceImages.map(({id:o})=>o);return i.length===0?os:i}),[e]),n=M(t);return n.length===0?null:a.jsx(a.Fragment,{children:n.map((s,i)=>a.jsxs(h.Fragment,{children:[i>0&&a.jsx(vt,{}),a.jsx(uie,{referenceImageId:s})]},s))})});hie.displayName="RegionalGuidanceLayerIPAdapterList";const i3=h.memo(({onDelete:e,...t})=>{const{t:n}=T();return a.jsx(oe,{tooltip:n("common.delete"),variant:"link","aria-label":n("common.delete"),icon:a.jsx(fn,{}),onClick:e,flexGrow:0,size:"sm",p:0,colorScheme:"error",...t})});i3.displayName="RegionalGuidanceDeletePromptButton";const V1=h.memo(e=>{const{onOpen:t,isOpen:n}=e,{t:s}=T();return a.jsx(He,{label:s("prompt.addPromptTrigger"),children:a.jsx(oe,{variant:"promptOverlay",isDisabled:n,"aria-label":s("prompt.addPromptTrigger"),icon:a.jsx(BDe,{}),onClick:t})})});V1.displayName="AddPromptTriggerButton";const _0="ModelRelationships",CHe=Sr.injectEndpoints({endpoints:e=>({getRelatedModelIds:e.query({query:t=>`/api/v1/model_relationships/i/${t}`,providesTags:(t,n,s)=>[{type:_0,id:s}]}),addModelRelationship:e.mutation({query:t=>({url:"/api/v1/model_relationships/",method:"POST",body:t}),invalidatesTags:(t,n,{model_key_1:s,model_key_2:i})=>[{type:_0,id:s},{type:_0,id:i}]}),removeModelRelationship:e.mutation({query:t=>({url:"/api/v1/model_relationships/",method:"DELETE",body:t}),invalidatesTags:(t,n,{model_key_1:s,model_key_2:i})=>[{type:_0,id:s},{type:_0,id:i}]}),getRelatedModelIdsBatch:e.query({query:t=>({url:"/api/v1/model_relationships/batch",method:"POST",body:{model_keys:t}}),providesTags:(t,n,s)=>s.map(i=>({type:"ModelRelationships",id:i}))})}),overrideExisting:!1}),{useGetRelatedModelIdsQuery:wHe,useAddModelRelationshipMutation:_He,useRemoveModelRelationshipMutation:SHe,useGetRelatedModelIdsBatchQuery:pie}=CHe,kHe=()=>ye("prompt.noMatchingTriggers"),fie=h.memo(({onSelect:e,onClose:t})=>{const{t:n}=T(),s=M(Fy),i=M(dH),{data:o,isLoading:r}=om(s?.key??Ri),[l,{isLoading:c}]=KW(),[d,{isLoading:u}]=Cxe(),p=h.useMemo(()=>{const C=[];s&&C.push(s.key);for(const{model:y}of i)C.push(y.key);return C},[s,i]),{relatedModelKeys:m}=pie(p,{selectFromResult:({data:C})=>C?{relatedModelKeys:C}:{relatedModelKeys:[]}}),f=h.useCallback(C=>{if(!C){e("");return}e(C.value)},[e]),g=h.useMemo(()=>{const C=[];if(l){const y=l.filter(x=>Wr(i,w=>w.model.key).includes(x.key)).map(x=>x.trigger_phrases?x.trigger_phrases.map(w=>({label:w,value:w})):[]).flatMap(x=>x);y.length>0&&C.push({label:n("modelManager.loraTriggerPhrases"),options:hK(y)})}if(d){const y=d.filter(x=>x.base===o?.base).map(x=>({label:x.name,value:`<${x.name}>`,starred:m.includes(x.key)}));y.sort((x,w)=>x.starred&&!w.starred?-1:!x.starred&&w.starred?1:0),y.length>0&&C.push({label:n("prompt.compatibleEmbeddings"),options:y})}return o&&If(o)&&o.trigger_phrases?.length&&C.push({label:n("modelManager.mainModelTriggerPhrases"),options:o.trigger_phrases.map(y=>({label:y,value:y}))}),C},[d,l,o,n,i,m]),v=h.useCallback(C=>a.jsxs(A,{alignItems:"center",gap:2,children:[C.starred&&a.jsx(Je,{as:SX,color:"invokeYellow.500",boxSize:4}),C.label]}),[]),b=h.useMemo(()=>n(c||u||r?"common.loading":"prompt.addPromptTrigger"),[n,c,u,r]);return a.jsx(te,{children:a.jsx(pt,{placeholder:b,defaultMenuIsOpen:!0,autoFocus:!0,value:null,options:g,noOptionsMessage:kHe,onChange:f,onMenuClose:t,"data-testid":"add-prompt-trigger",sx:IHe,formatOptionLabel:v})})});fie.displayName="PromptTriggerSelect";const IHe={w:"full"},$1=h.memo(e=>{const{onSelect:t,isOpen:n,onClose:s,width:i,children:o}=e;return a.jsxs(yi,{isOpen:n,onClose:s,placement:"bottom",openDelay:0,closeDelay:0,closeOnBlur:!0,returnFocusOnClose:!1,isLazy:!0,children:[a.jsx(f_,{children:o}),a.jsx(Ls,{children:a.jsx(bi,{p:0,insetBlockStart:-1,shadow:"dark-lg",borderColor:"invokeBlue.300",borderWidth:"2px",borderStyle:"solid",children:a.jsx(Fi,{p:0,width:`calc(${i}px - 0.25rem)`,children:a.jsx(fie,{onClose:s,onSelect:t})})})})]})});$1.displayName="PromptPopover";const US=({prompt:e,textareaRef:t,onChange:n,isDisabled:s=!1})=>{const{isOpen:i,onClose:o,onOpen:r}=jo(),l=h.useCallback(f=>{n(f.target.value)},[n]),c=h.useCallback(f=>{if(!t.current)return;const g=t.current.selectionStart;if(st(g))return;let v=e.slice(0,g);v+=`${f}`;const b=v.length;v+=e.slice(g),pu.flushSync(()=>{n(v)}),t.current.selectionStart=b,t.current.selectionEnd=b},[t,n,e]),d=h.useCallback(()=>{t.current?.focus()},[t]),u=h.useCallback(()=>{o(),d()},[d,o]),p=h.useCallback(f=>{c(f),u()},[u,c]),m=h.useCallback(f=>{f.key==="<"&&!s&&(r(),f.preventDefault())},[r,s]);return{onChange:l,isOpen:i,onClose:o,onOpen:r,onSelect:p,onKeyDown:m,onFocus:d}},jHe=/^[+-]?(\d+(\.\d+)?|[+-]+)/,EHe=/^\s+/,AHe=/^[.,]/,PHe=/\s/;function THe(e){if(!e)return[];const t=e.length;let n=[],s=0;for(;s<t;){const i=e[s];if(!i)break;const o=DHe(i,s)||MHe(e,s)||LHe(i,s)||RHe(e,s)||FHe(i,s)||NHe(e,s)||OHe(i,s)||BHe(i,s);o?(o.token&&n.push(o.token),o.extraToken&&n.push(o.extraToken),s=o.nextIndex):s++}return n}function DHe(e,t){return EHe.test(e)?{token:{type:"whitespace",value:e,start:t,end:t+1},nextIndex:t+1}:null}function MHe(e,t){if(e[t]==="\\"&&t+1<e.length){const s=e[t+1];if(s==="("||s===")")return{token:{type:"escaped_paren",value:s,start:t,end:t+2},nextIndex:t+2}}return null}function LHe(e,t){return e==="("?{token:{type:"lparen",start:t,end:t+1},nextIndex:t+1}:null}function RHe(e,t){if(e[t]===")"){const s=e.slice(t+1).match(jHe);if(s&&s[0]){let i=s[0];isNaN(Number(i))||(i=Number(i));const o=t+1+s[0].length;return{token:{type:"rparen",start:t,end:t+1},extraToken:{type:"weight",value:i,start:t+1,end:o},nextIndex:o}}return{token:{type:"rparen",start:t,end:t+1},nextIndex:t+1}}return null}function OHe(e,t){return AHe.test(e)?{token:{type:"punct",value:e,start:t,end:t+1},nextIndex:t+1}:null}function NHe(e,t){const n=e[t];if(!n)return null;if(/[a-zA-Z0-9_]/.test(n)){let s=t;for(;s<e.length&&/[a-zA-Z0-9_]/.test(e[s]);)s++;const i=e.slice(t,s),o=e.slice(s).match(/^[+-]?(\d+(\.\d+)?|[+-]+)/);if(o&&o[0]){const r=s+o[0].length;return{token:{type:"word",value:i,start:t,end:s},extraToken:{type:"weight",value:o[0],start:s,end:r},nextIndex:r}}return{token:{type:"word",value:i,start:t,end:s},nextIndex:s}}return null}function FHe(e,t){return e==="<"?{token:{type:"lembed",start:t,end:t+1},nextIndex:t+1}:e===">"?{token:{type:"rembed",start:t,end:t+1},nextIndex:t+1}:null}function BHe(e,t){return PHe.test(e)?{token:{type:"punct",value:e,start:t,end:t+1},nextIndex:t+1}:null}function zHe(e){let t=0;function n(){return e[t]}function s(){return e[t++]}function i(){const o=[];for(;t<e.length;){const r=n();if(!r||r.type==="rparen")break;switch(r.type){case"whitespace":{const l=s();o.push({type:"whitespace",value:l.value,range:{start:l.start,end:l.end}});break}case"lparen":{const l=s(),c=i();let d,u=l.end;if(n()?.type==="rparen"&&(u=s().end,n()?.type==="weight")){const m=s();d=m.value,u=m.end}u===l.end&&c.length>0&&(u=c[c.length-1].range.end),o.push({type:"group",children:c,attention:d,range:{start:l.start,end:u}});break}case"lembed":{const l=s();let c="",d=l.end;for(;n()&&n().type!=="rembed";){const u=s();c+=u.type==="word"||u.type==="punct"||u.type==="whitespace"?u.value:"",d=u.end}n()?.type==="rembed"&&(d=s().end),o.push({type:"embedding",value:c.trim(),range:{start:l.start,end:d}});break}case"word":{const l=s();let c,d=l.end;if(n()?.type==="weight"){const u=s();c=u.value,d=u.end}o.push({type:"word",text:l.value,attention:c,range:{start:l.start,end:d}});break}case"punct":{const l=s();o.push({type:"punct",value:l.value,range:{start:l.start,end:l.end}});break}case"escaped_paren":{const l=s();o.push({type:"escaped_paren",value:l.value,range:{start:l.start,end:l.end}});break}default:s()}}return o}return i()}function mv(e){let t="";for(const n of e)switch(n.type){case"punct":case"whitespace":{t+=n.value;break}case"escaped_paren":{t+=`\\${n.value}`;break}case"word":{t+=n.text,n.attention&&(t+=String(n.attention));break}case"group":{t+="(",t+=mv(n.children),t+=")",n.attention&&(t+=String(n.attention));break}case"embedding":{t+=`<${n.value}>`;break}}return t}const VHe=Ft("events").child({filePath:"common/util/promptAttention.ts"}),$a=1.1;function $He(e,t,n,s){try{const i=THe(e),o=zHe(i),r=mie(o);let l=r.filter(p=>{if(!(p.range.start<n&&p.range.end>t||t===n&&p.range.start<=t&&p.range.end>=t))return!1;if(p.parentRange){const f=p.parentRange.start<=t&&p.parentRange.end>=n,g=t<=p.parentRange.start&&n>=p.parentRange.end;if(!f&&!g&&p.hasExplicitAttention)return!1}return!0});for(const p of l)p.isSelected=!0;if(l.length===0){const p=gie(o,t,n);if(p){l=r.filter(m=>m.range.start>=p.range.start&&m.range.end<=p.range.end);for(const m of l)m.isSelected=!0}}if(l.length===0)return{prompt:e,selectionStart:t,selectionEnd:n};for(const p of l)s==="increment"?p.weight*=$a:p.weight/=$a;const c=I2(r),d=mv(c),u=WHe(c);return{prompt:d,selectionStart:u.start,selectionEnd:u.end}}catch(i){return VHe.error({error:cn(i)},"Failed to adjust prompt attention"),{prompt:e,selectionStart:t,selectionEnd:n}}}function mie(e,t=1,n){let s=[];for(const i of e){let o=t;"attention"in i&&i.attention&&(o*=HHe(i.attention)),i.type==="group"?s.push(...mie(i.children,o,i.range)):s.push({text:i.type==="word"?i.text:i.value,type:i.type,weight:o,range:i.range,hasExplicitAttention:"attention"in i&&!!i.attention,parentRange:n,isSelected:!1})}return s}function gie(e,t,n){for(const s of e)if(s.type==="group"){const i=gie(s.children,t,n);if(i)return i;if(GHe(s.range,{start:t,end:n}))return s}return null}function GHe(e,t){return e.start<t.end&&e.end>t.start}function HHe(e){if(typeof e=="number")return e;if(e.startsWith("+"))return Math.pow($a,e.length);if(e.startsWith("-"))return Math.pow($a,-e.length);const t=Number(e);return isNaN(t)?1:t}function WHe(e){let t=1/0,n=-1,s=0;function i(o){for(const r of o)if(r.isSelection){const l=mv([r]).length;t=Math.min(t,s),n=Math.max(n,s+l),s+=l}else if(r.type==="group")s+=1,i(r.children),s+=1,r.attention&&(s+=String(r.attention).length);else{const l=mv([r]).length;s+=l}}return i(e),t===1/0?{start:0,end:mv(e).length}:{start:t,end:n}}function I2(e){if(e.length===0)return[];const t=[];let n=0;for(;n<e.length;){const s=e[n],i=s.weight,o=r=>{let l=n;for(;l<e.length;){const c=e[l];if(r(c.weight))l++;else if(c.type==="whitespace"){let d=l+1;for(;d<e.length&&e[d].type==="whitespace";)d++;if(d<e.length&&r(e[d].weight))l=d;else break}else break}return l};if(i>=$a-.001){const r=o(d=>d>=$a-.001);let l=n,c=r;for(;l<c&&e[l].type==="whitespace";)l++;for(;c>l&&e[c-1].type==="whitespace";)c--;for(let d=n;d<l;d++)t.push(S0(e[d]));if(l<c){const d=e.slice(l,c).map(m=>({...m,weight:m.weight/$a})),u=I2(d),p=d.every(m=>m.isSelected);if(u.length===1){const m=u[0];if(m.type==="word"||m.type==="group"){const f=pz(m.attention,"+");t.push({...m,attention:f})}else t.push({type:"group",children:u,attention:"+",range:{start:0,end:0},isSelection:p})}else t.push({type:"group",children:u,attention:"+",range:{start:0,end:0},isSelection:p})}for(let d=c;d<r;d++)t.push(S0(e[d]));n=r;continue}if(i<=1/$a+.001){const r=o(d=>d<=1/$a+.001);let l=n,c=r;for(;l<c&&e[l].type==="whitespace";)l++;for(;c>l&&e[c-1].type==="whitespace";)c--;for(let d=n;d<l;d++)t.push(S0(e[d]));if(l<c){const d=e.slice(l,c).map(m=>({...m,weight:m.weight*$a})),u=I2(d),p=d.every(m=>m.isSelected);if(u.length===1){const m=u[0];if(m.type==="word"||m.type==="group"){const f=pz(m.attention,"-");t.push({...m,attention:f})}else t.push({type:"group",children:u,attention:"-",range:{start:0,end:0},isSelection:p})}else t.push({type:"group",children:u,attention:"-",range:{start:0,end:0},isSelection:p})}for(let d=c;d<r;d++)t.push(S0(e[d]));n=r;continue}if(Math.abs(i-1)<.001)t.push(S0(s)),n++;else{let r=n;for(;r<e.length&&Math.abs(e[r].weight-i)<.001;)r++;const l=e.slice(n,r).map(p=>({...p,weight:1})),c=I2(l),d=l.every(p=>p.isSelected),u=Number(i.toFixed(4));if(c.length===1){const p=c[0];p.type==="word"||p.type==="group"?t.push({...p,attention:u}):t.push({type:"group",children:c,attention:u,range:{start:0,end:0},isSelection:d})}else t.push({type:"group",children:c,attention:u,range:{start:0,end:0},isSelection:d});n=r}}return t}function S0(e){return e.type==="word"?{type:"word",text:e.text,range:e.range,isSelection:e.isSelected}:e.type==="whitespace"?{type:"whitespace",value:e.text,range:e.range,isSelection:e.isSelected}:e.type==="punct"?{type:"punct",value:e.text,range:e.range,isSelection:e.isSelected}:e.type==="embedding"?{type:"embedding",value:e.text,range:e.range,isSelection:e.isSelected}:e.type==="escaped_paren"?{type:"escaped_paren",value:e.text,range:e.range,isSelection:e.isSelected}:{type:"word",text:e.text,range:e.range,isSelection:e.isSelected}}function pz(e,t){if(!e)return t;if(typeof e=="number")return t==="+"?e*$a:t==="-"?e/$a:e;if(t==="+"){if(e.startsWith("-")){const n=e.substring(1);return n===""?void 0:n}return`${e}+`}if(t==="-"){if(e.startsWith("+")){const n=e.substring(1);return n===""?void 0:n}return`${e}-`}return e}const qS=({textareaRef:e,onPromptChange:t})=>{const n=h.useCallback(()=>document.activeElement===e.current,[e]),s=h.useCallback(i=>{const o=e.current;if(!o)return;const r=$He(o.value,o.selectionStart,o.selectionEnd,i);o.focus(),o.setSelectionRange(0,o.value.length),document.execCommand("insertText",!1,r.prompt),o.setSelectionRange(r.selectionStart,r.selectionEnd)},[e]);Be({id:"promptWeightUp",category:"app",callback:i=>{n()&&e.current&&(i.preventDefault(),s("increment"))},options:{preventDefault:!0,enableOnFormTags:["TEXTAREA"]},dependencies:[n,s]}),Be({id:"promptWeightDown",category:"app",callback:i=>{n()&&e.current&&(i.preventDefault(),s("decrement"))},options:{preventDefault:!0,enableOnFormTags:["TEXTAREA"]},dependencies:[n,s]})},UHe={outline:"none"},vie=h.memo(()=>{const e=dt("regional_guidance"),t=h.useMemo(()=>ve(rt,g=>co(g,e,"RegionalGuidanceNegativePrompt").negativePrompt??""),[e]),n=M(t),s=Q(),i=h.useRef(null),{t:o}=T(),r=h.useCallback(g=>{s(BA({entityIdentifier:e,prompt:g}))},[s,e]),l=h.useCallback(()=>{s(BA({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:c,isOpen:d,onClose:u,onOpen:p,onSelect:m,onKeyDown:f}=US({prompt:n,textareaRef:i,onChange:r});return qS({textareaRef:i,onPromptChange:r}),a.jsx($1,{isOpen:d,onClose:u,onSelect:m,width:i.current?.clientWidth,children:a.jsxs(ke,{pos:"relative",w:"full",children:[a.jsx(no,{id:"prompt",name:"prompt",ref:i,value:n,placeholder:o("parameters.negativePromptPlaceholder"),onChange:c,onKeyDown:f,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,zIndex:"0 !important",fontFamily:"mono",fontSize:"0.82rem",_focusVisible:UHe}),a.jsxs(A,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[a.jsx(i3,{onDelete:l}),a.jsx(V1,{isOpen:d,onOpen:p})]})]})})});vie.displayName="RegionalGuidanceNegativePrompt";const qHe={outline:"none"},yie=h.memo(()=>{const e=dt("regional_guidance"),t=h.useMemo(()=>ve(rt,g=>co(g,e,"RegionalGuidancePositivePrompt").positivePrompt??""),[e]),n=M(t),s=Q(),i=h.useRef(null),{t:o}=T(),r=h.useCallback(g=>{s(FA({entityIdentifier:e,prompt:g}))},[s,e]),l=h.useCallback(()=>{s(FA({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:c,isOpen:d,onClose:u,onOpen:p,onSelect:m,onKeyDown:f}=US({prompt:n,textareaRef:i,onChange:r});return qS({textareaRef:i,onPromptChange:r}),a.jsx($1,{isOpen:d,onClose:u,onSelect:m,width:i.current?.clientWidth,children:a.jsxs(ke,{pos:"relative",w:"full",children:[a.jsx(no,{id:"prompt",name:"prompt",ref:i,value:n,placeholder:o("parameters.positivePromptPlaceholder"),onChange:c,onKeyDown:f,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,minH:28,zIndex:"0 !important",fontFamily:"mono",fontSize:"0.82rem",_focusVisible:qHe}),a.jsxs(A,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[a.jsx(i3,{onDelete:l}),a.jsx(V1,{isOpen:d,onOpen:p})]})]})})});yie.displayName="RegionalGuidancePositivePrompt";const KHe=e=>Yn(rt,t=>{const n=co(t,e,"RegionalGuidanceSettings");return{hasPositivePrompt:n.positivePrompt!==null,hasNegativePrompt:n.negativePrompt!==null,hasIPAdapters:n.referenceImages.length>0}}),bie=h.memo(()=>{const e=dt("regional_guidance"),t=h.useMemo(()=>KHe(e),[e]),n=M(t);return a.jsxs($S,{children:[!n.hasPositivePrompt&&!n.hasNegativePrompt&&!n.hasIPAdapters&&a.jsx(fHe,{}),n.hasPositivePrompt&&a.jsxs(a.Fragment,{children:[a.jsx(yie,{}),!n.hasNegativePrompt&&n.hasIPAdapters&&a.jsx(vt,{})]}),n.hasNegativePrompt&&a.jsxs(a.Fragment,{children:[a.jsx(vie,{}),n.hasIPAdapters&&a.jsx(vt,{})]}),n.hasIPAdapters&&a.jsx(hie,{})]})});bie.displayName="RegionalGuidanceSettings";const xie=h.memo(({id:e})=>{const t=h.useMemo(()=>({id:e,type:"regional_guidance"}),[e]);return a.jsx(Wm.Provider,{value:t,children:a.jsx(Kne,{children:a.jsx(wu,{entityIdentifier:t,children:a.jsxs(A1,{children:[a.jsxs(N1,{children:[a.jsx(B1,{}),a.jsx(z1,{}),a.jsx(At,{}),a.jsx(nie,{}),a.jsx(F1,{})]}),a.jsx(bie,{})]})})})})});xie.displayName="RegionalGuidance";const ZHe=Yn(rt,e=>e.regionalGuidance.entities.map(xa).toReversed()),XHe=ve($n,e=>e?.type==="regional_guidance"),Cie=h.memo(()=>{const e=M(XHe),t=M(ZHe);if(t.length===0)return null;if(t.length>0)return a.jsx(E1,{type:"regional_guidance",isSelected:e,entityIdentifiers:t,children:t.map(n=>a.jsx(xie,{id:n.id},n.id))})});Cie.displayName="RegionalGuidanceEntityList";const wie=h.memo(()=>a.jsx(Hs,{children:a.jsxs(A,{flexDir:"column",gap:2,"data-testid":"control-layers-layer-list",w:"full",h:"full",children:[a.jsx(Xse,{}),a.jsx(Cie,{}),a.jsx(Wse,{}),a.jsx(tie,{})]})}));wie.displayName="CanvasEntityList";const _ie=h.memo(()=>{const{t:e}=T(),t=xt(),n=A4(),s=P4(),i=AZ(),o=E4(),r=j4(),l=xf("regional_guidance"),c=xf("control_layer"),d=xf("inpaint_mask");return a.jsxs(An,{children:[a.jsx(Pn,{as:oe,minW:8,variant:"link",alignSelf:"stretch",tooltip:e("controlLayers.addLayer"),"aria-label":e("controlLayers.addLayer"),icon:a.jsx(Sn,{}),"data-testid":"control-layers-add-layer-menu-button",isDisabled:t}),a.jsxs(Zt,{children:[a.jsxs(Ya,{title:e("controlLayers.regional"),children:[a.jsx(be,{icon:a.jsx(Sn,{}),onClick:n,isDisabled:!d,children:e("controlLayers.inpaintMask")}),a.jsx(be,{icon:a.jsx(Sn,{}),onClick:s,isDisabled:!l,children:e("controlLayers.regionalGuidance")}),a.jsx(be,{icon:a.jsx(Sn,{}),onClick:i,isDisabled:!l,children:e("controlLayers.regionalReferenceImage")})]}),a.jsxs(Ya,{title:e("controlLayers.layer_other"),children:[a.jsx(be,{icon:a.jsx(Sn,{}),onClick:r,isDisabled:!c,children:e("controlLayers.controlLayer")}),a.jsx(be,{icon:a.jsx(Sn,{}),onClick:o,children:e("controlLayers.rasterLayer")})]})]})]})});_ie.displayName="EntityListGlobalActionBarAddLayerMenu";const Sie=h.memo(()=>{const{t:e}=T(),t=Q(),n=xt(),s=M($n),i=h.useCallback(()=>{s&&t(jW({entityIdentifier:s}))},[t,s]);return a.jsx(oe,{onClick:i,isDisabled:!s||n,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),icon:a.jsx(yX,{})})});Sie.displayName="EntityListSelectedEntityActionBarDuplicateButton";const kie=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1},{r:255,g:90,b:94,a:1},{r:255,g:146,b:75,a:1},{r:255,g:202,b:59,a:1},{r:197,g:202,b:48,a:1},{r:138,g:201,b:38,a:1},{r:83,g:165,b:117,a:1},{r:23,g:130,b:196,a:1},{r:66,g:103,b:172,a:1},{r:107,g:76,b:147,a:1}],YHe=kie,QHe=kie.map(({r:e,g:t,b:n})=>({r:e,g:t,b:n}));function _u(){return(_u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function G1(e,t){if(e==null)return{};var n,s,i={},o=Object.keys(e);for(s=0;s<o.length;s++)t.indexOf(n=o[s])>=0||(i[n]=e[n]);return i}function uy(e){var t=h.useRef(e),n=h.useRef(function(s){t.current&&t.current(s)});return t.current=e,n.current}var Gf=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1),e>n?n:e<t?t:e},gv=function(e){return"touches"in e},NT=function(e){return e&&e.ownerDocument.defaultView||self},fz=function(e,t,n){var s=e.getBoundingClientRect(),i=gv(t)?function(o,r){for(var l=0;l<o.length;l++)if(o[l].identifier===r)return o[l];return o[0]}(t.touches,n):t;return{left:Gf((i.pageX-(s.left+NT(e).pageXOffset))/s.width),top:Gf((i.pageY-(s.top+NT(e).pageYOffset))/s.height)}},mz=function(e){!gv(e)&&e.preventDefault()},o3=ce.memo(function(e){var t=e.onMove,n=e.onKey,s=G1(e,["onMove","onKey"]),i=h.useRef(null),o=uy(t),r=uy(n),l=h.useRef(null),c=h.useRef(!1),d=h.useMemo(function(){var f=function(b){mz(b),(gv(b)?b.touches.length>0:b.buttons>0)&&i.current?o(fz(i.current,b,l.current)):v(!1)},g=function(){return v(!1)};function v(b){var C=c.current,y=NT(i.current),x=b?y.addEventListener:y.removeEventListener;x(C?"touchmove":"mousemove",f),x(C?"touchend":"mouseup",g)}return[function(b){var C=b.nativeEvent,y=i.current;if(y&&(mz(C),!function(w,_){return _&&!gv(w)}(C,c.current)&&y)){if(gv(C)){c.current=!0;var x=C.changedTouches||[];x.length&&(l.current=x[0].identifier)}y.focus(),o(fz(y,C,l.current)),v(!0)}},function(b){var C=b.which||b.keyCode;C<37||C>40||(b.preventDefault(),r({left:C===39?.05:C===37?-.05:0,top:C===40?.05:C===38?-.05:0}))},v]},[r,o]),u=d[0],p=d[1],m=d[2];return h.useEffect(function(){return m},[m]),ce.createElement("div",_u({},s,{onTouchStart:u,onMouseDown:u,className:"react-colorful__interactive",ref:i,onKeyDown:p,tabIndex:0,role:"slider"}))}),H1=function(e){return e.filter(Boolean).join(" ")},a3=function(e){var t=e.color,n=e.left,s=e.top,i=s===void 0?.5:s,o=H1(["react-colorful__pointer",e.className]);return ce.createElement("div",{className:o,style:{top:100*i+"%",left:100*n+"%"}},ce.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},Co=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=Math.pow(10,t)),Math.round(n*e)/n},Iie=function(e){var t=e.s,n=e.v,s=e.a,i=(200-t)*n/100;return{h:Co(e.h),s:Co(i>0&&i<200?t*n/100/(i<=100?i:200-i)*100:0),l:Co(i/2),a:Co(s,2)}},FT=function(e){var t=Iie(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},EE=function(e){var t=Iie(e);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},jie=function(e){var t=e.h,n=e.s,s=e.v,i=e.a;t=t/360*6,n/=100,s/=100;var o=Math.floor(t),r=s*(1-n),l=s*(1-(t-o)*n),c=s*(1-(1-t+o)*n),d=o%6;return{r:Co(255*[s,l,r,r,c,s][d]),g:Co(255*[c,s,s,l,r,r][d]),b:Co(255*[r,r,c,s,s,l][d]),a:Co(i,2)}},Eie=function(e){var t=e.r,n=e.g,s=e.b,i=e.a,o=Math.max(t,n,s),r=o-Math.min(t,n,s),l=r?o===t?(n-s)/r:o===n?2+(s-t)/r:4+(t-n)/r:0;return{h:Co(60*(l<0?l+6:l)),s:Co(o?r/o*100:0),v:Co(o/255*100),a:i}},Aie=ce.memo(function(e){var t=e.hue,n=e.onChange,s=H1(["react-colorful__hue",e.className]);return ce.createElement("div",{className:s},ce.createElement(o3,{onMove:function(i){n({h:360*i.left})},onKey:function(i){n({h:Gf(t+360*i.left,0,360)})},"aria-label":"Hue","aria-valuenow":Co(t),"aria-valuemax":"360","aria-valuemin":"0"},ce.createElement(a3,{className:"react-colorful__hue-pointer",left:t/360,color:FT({h:t,s:100,v:100,a:1})})))}),Pie=ce.memo(function(e){var t=e.hsva,n=e.onChange,s={backgroundColor:FT({h:t.h,s:100,v:100,a:1})};return ce.createElement("div",{className:"react-colorful__saturation",style:s},ce.createElement(o3,{onMove:function(i){n({s:100*i.left,v:100-100*i.top})},onKey:function(i){n({s:Gf(t.s+100*i.left,0,100),v:Gf(t.v-100*i.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Co(t.s)+"%, Brightness "+Co(t.v)+"%"},ce.createElement(a3,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:FT(t)})))}),r3=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0};function Tie(e,t,n){var s=uy(n),i=h.useState(function(){return e.toHsva(t)}),o=i[0],r=i[1],l=h.useRef({color:t,hsva:o});h.useEffect(function(){if(!e.equal(t,l.current.color)){var d=e.toHsva(t);l.current={hsva:d,color:t},r(d)}},[t,e]),h.useEffect(function(){var d;r3(o,l.current.hsva)||e.equal(d=e.fromHsva(o),l.current.color)||(l.current={hsva:o,color:d},s(d))},[o,e,s]);var c=h.useCallback(function(d){r(function(u){return Object.assign({},u,d)})},[]);return[o,c]}var JHe=typeof window<"u"?h.useLayoutEffect:h.useEffect,eWe=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},gz=new Map,Die=function(e){JHe(function(){var t=e.current?e.current.ownerDocument:document;if(t!==void 0&&!gz.has(t)){var n=t.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,gz.set(t,n);var s=eWe();s&&n.setAttribute("nonce",s),t.head.appendChild(n)}},[])},tWe=function(e){var t=e.className,n=e.colorModel,s=e.color,i=s===void 0?n.defaultColor:s,o=e.onChange,r=G1(e,["className","colorModel","color","onChange"]),l=h.useRef(null);Die(l);var c=Tie(n,i,o),d=c[0],u=c[1],p=H1(["react-colorful",t]);return ce.createElement("div",_u({},r,{ref:l,className:p}),ce.createElement(Pie,{hsva:d,onChange:u}),ce.createElement(Aie,{hue:d.h,onChange:u,className:"react-colorful__last-control"}))},nWe=function(e){var t=e.className,n=e.hsva,s=e.onChange,i={backgroundImage:"linear-gradient(90deg, "+EE(Object.assign({},n,{a:0}))+", "+EE(Object.assign({},n,{a:1}))+")"},o=H1(["react-colorful__alpha",t]),r=Co(100*n.a);return ce.createElement("div",{className:o},ce.createElement("div",{className:"react-colorful__alpha-gradient",style:i}),ce.createElement(o3,{onMove:function(l){s({a:l.left})},onKey:function(l){s({a:Gf(n.a+l.left)})},"aria-label":"Alpha","aria-valuetext":r+"%","aria-valuenow":r,"aria-valuemin":"0","aria-valuemax":"100"},ce.createElement(a3,{className:"react-colorful__alpha-pointer",left:n.a,color:EE(n)})))},sWe=function(e){var t=e.className,n=e.colorModel,s=e.color,i=s===void 0?n.defaultColor:s,o=e.onChange,r=G1(e,["className","colorModel","color","onChange"]),l=h.useRef(null);Die(l);var c=Tie(n,i,o),d=c[0],u=c[1],p=H1(["react-colorful",t]);return ce.createElement("div",_u({},r,{ref:l,className:p}),ce.createElement(Pie,{hsva:d,onChange:u}),ce.createElement(Aie,{hue:d.h,onChange:u}),ce.createElement(nWe,{hsva:d,onChange:u,className:"react-colorful__last-control"}))},iWe={defaultColor:{r:0,g:0,b:0,a:1},toHsva:Eie,fromHsva:jie,equal:r3},Mie=function(e){return ce.createElement(sWe,_u({},e,{colorModel:iWe}))},oWe={defaultColor:{r:0,g:0,b:0},toHsva:function(e){return Eie({r:e.r,g:e.g,b:e.b,a:1})},fromHsva:function(e){return{r:(t=jie(e)).r,g:t.g,b:t.b};var t},equal:r3},aWe=function(e){return ce.createElement(tWe,_u({},e,{colorModel:oWe}))},rWe=/^#?([0-9A-F]{3,8})$/i,lWe=function(e){var t=e.color,n=t===void 0?"":t,s=e.onChange,i=e.onBlur,o=e.escape,r=e.validate,l=e.format,c=e.process,d=G1(e,["color","onChange","onBlur","escape","validate","format","process"]),u=h.useState(function(){return o(n)}),p=u[0],m=u[1],f=uy(s),g=uy(i),v=h.useCallback(function(C){var y=o(C.target.value);m(y),r(y)&&f(c?c(y):y)},[o,c,r,f]),b=h.useCallback(function(C){r(C.target.value)||m(o(n)),g(C)},[n,o,r,g]);return h.useEffect(function(){m(o(n))},[n,o]),ce.createElement("input",_u({},d,{value:l?l(p):p,spellCheck:"false",onChange:v,onBlur:b}))},vz=function(e){return"#"+e},cWe=function(e){var t=e.prefixed,n=e.alpha,s=G1(e,["prefixed","alpha"]),i=h.useCallback(function(r){return r.replace(/([^0-9A-F]+)/gi,"").substring(0,n?8:6)},[n]),o=h.useCallback(function(r){return function(l,c){var d=rWe.exec(l),u=d?d[1].length:0;return u===3||u===6||!!c&&u===4||!!c&&u===8}(r,n)},[n]);return ce.createElement(lWe,_u({},s,{escape:i,format:t?vz:void 0,process:vz,validate:o}))};const AE={width:6,height:6,borderColor:"base.100"},dWe={".react-colorful__hue-pointer":AE,".react-colorful__saturation-pointer":AE,".react-colorful__alpha-pointer":AE,gap:4,flexDir:"column"},uWe={width:"100%"},PE="3.5rem",hWe=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:i=!1}=e,{t:o}=T(),r=h.useCallback(d=>n({...t,r:d}),[t,n]),l=h.useCallback(d=>n({...t,g:d}),[t,n]),c=h.useCallback(d=>n({...t,b:d}),[t,n]);return a.jsxs(A,{sx:dWe,children:[a.jsx(aWe,{color:t,onChange:n,style:uWe}),s&&a.jsxs(A,{gap:4,children:[a.jsxs(te,{gap:0,children:[a.jsx(ne,{children:o("common.red")[0]}),a.jsx(Pe,{flexGrow:1,value:t.r,onChange:r,min:0,max:255,step:1,w:PE,defaultValue:90})]}),a.jsxs(te,{gap:0,children:[a.jsx(ne,{children:o("common.green")[0]}),a.jsx(Pe,{flexGrow:1,value:t.g,onChange:l,min:0,max:255,step:1,w:PE,defaultValue:90})]}),a.jsxs(te,{gap:0,children:[a.jsx(ne,{children:o("common.blue")[0]}),a.jsx(Pe,{flexGrow:1,value:t.b,onChange:c,min:0,max:255,step:1,w:PE,defaultValue:255})]})]}),i&&a.jsx(A,{gap:2,justifyContent:"space-between",children:QHe.map((d,u)=>a.jsx(fWe,{color:d,onChange:n},u))})]})},pWe=h.memo(hWe),fWe=({color:e,onChange:t})=>{const n=h.useCallback(()=>{t(e)},[e,t]);return a.jsx(ke,{role:"button",onClick:n,h:8,w:8,bg:Eh(e),borderRadius:"base"})},Lie=h.memo(({style:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(r=>{wxe(r?.value)&&t(r.value)},[t]),i=h.useMemo(()=>[{value:"solid",label:n("controlLayers.fill.solid")},{value:"diagonal",label:n("controlLayers.fill.diagonal")},{value:"crosshatch",label:n("controlLayers.fill.crosshatch")},{value:"grid",label:n("controlLayers.fill.grid")},{value:"horizontal",label:n("controlLayers.fill.horizontal")},{value:"vertical",label:n("controlLayers.fill.vertical")}],[n]),o=h.useMemo(()=>i.find(r=>r.value===e),[i,e]);return a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.fill.fillStyle")}),a.jsx(pt,{value:o,options:i,onChange:s,isSearchable:!1})]})});Lie.displayName="MaskFillStyle";const Rie=h.memo(()=>{const{t:e}=T(),t=Q(),n=M($n),s=M(_xe),i=h.useCallback(r=>{n&&XA(n)&&t(Sxe({entityIdentifier:n,color:r}))},[t,n]),o=h.useCallback(r=>{n&&XA(n)&&t(kxe({entityIdentifier:n,style:r}))},[t,n]);return!n||!s?null:a.jsxs(yi,{isLazy:!0,children:[a.jsx(Ni,{children:a.jsx(A,{role:"button","aria-label":e("controlLayers.maskFill"),tabIndex:-1,w:8,h:8,children:a.jsx(He,{label:e("controlLayers.maskFill"),children:a.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:a.jsx(ke,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:Eh(s.color)})})})})}),a.jsx(Ls,{children:a.jsx(bi,{children:a.jsx(Fi,{minH:64,children:a.jsxs(A,{flexDir:"column",gap:4,children:[a.jsx(pWe,{color:s.color,onChange:i,withNumberInput:!0,withSwatches:!0}),a.jsx(Lie,{style:s.style,onChange:o})]})})})})]})});Rie.displayName="EntityListSelectedEntityActionBarFill";const Oie=h.memo(()=>{const{t:e}=T(),t=M($n),n=VS(t);return!t||!KA(t)?null:a.jsx(oe,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:a.jsx(nS,{})})});Oie.displayName="EntityListSelectedEntityActionBarFilterButton";const Nie=()=>{const{t:e}=T(),t=Q(),n=Tt(),s=M($n);return h.useCallback(async()=>{try{const o=n.stateApi.getBbox().rect,r=n.compositor.getVisibleAdaptersOfType("inpaint_mask");if(r.length===0){pe({id:"NO_VISIBLE_MASKS",title:e("toast.noVisibleMasks"),description:e("toast.noVisibleMasksDesc"),status:"warning"});return}const l=document.createElement("canvas");l.width=o.width,l.height=o.height;const c=l.getContext("2d");if(!c)throw new Error("Failed to get canvas context");c.fillStyle="rgba(0, 0, 0, 0)",c.fillRect(0,0,o.width,o.height);const d=n.compositor.getVisibleRectOfType("inpaint_mask");if(d.width>0&&d.height>0){const v=n.compositor.getCompositeCanvas(r,d),b=d.x-o.x,C=d.y-o.y;c.drawImage(v,b,C)}const u=Dv(l),p=u.data;for(let v=3;v<p.length;v+=4)p[v]=255-(p[v]??0);c.putImageData(u,0,0);const m=await mh(l),f=await Yd({file:new File([m],"inverted-mask.png",{type:"image/png"}),image_category:"general",is_intermediate:!0,silent:!0}),g=_o(f);s&&t(Zw({entityIdentifier:s,imageObject:g,position:{x:o.x,y:o.y},replaceObjects:!0,isSelected:!0})),pe({id:"MASK_INVERTED",title:e("toast.maskInverted"),status:"success"})}catch(o){pe({id:"MASK_INVERT_FAILED",title:e("toast.maskInvertFailed"),description:String(o),status:"error"})}},[n,t,s,e])},Fie=h.memo(()=>{const{t:e}=T(),t=M($n),n=xt(),s=Nie();return!t||!wM(t)?null:a.jsx(oe,{onClick:s,isDisabled:n,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.invertMask"),tooltip:e("controlLayers.invertMask"),icon:a.jsx(fX,{})})});Fie.displayName="EntityListSelectedEntityActionBarInvertMaskButton";function mWe(e){return isNaN(Number(e))?"":`${Vh(Number(e),2).toLocaleString()}%`}function gWe(e){return e/100}function Hp(e){return e*100}function vWe(e){return String(e)}const BT=[Hp(0),Hp(.25),Hp(.5),Hp(.75),Hp(1)],yWe=Hp(1),bWe=BT.slice(1,BT.length-1),xWe=ve(rt,e=>{const t=e.selectedEntityIdentifier;if(!t)return 1;const n=bo(e,t);return n?n.opacity:1}),Bie=h.memo(()=>{const{t:e}=T(),t=Q(),n=M($n),s=M(xWe),[i,o]=h.useState(s*100),r=h.useCallback(u=>{if(!n)return;let p=u;_M.get()||(p=ZW(u,bWe,2));const m=gWe(p);t(GL({entityIdentifier:n,opacity:m}))},[t,n]),l=h.useCallback(()=>{if(n){if(isNaN(Number(i))){o(100);return}t(GL({entityIdentifier:n,opacity:fi(i/100,0,1)}))}},[t,i,n]),c=h.useCallback((u,p)=>{o(p)},[]),d=h.useCallback(u=>{u.key==="Enter"&&l()},[l]);return h.useEffect(()=>{o((s??1)*100)},[s]),a.jsxs(yi,{children:[a.jsxs(te,{w:"min-content",gap:2,isDisabled:n===null,children:[a.jsx(ne,{m:0,children:e("controlLayers.opacity")}),a.jsx(f_,{children:a.jsxs(SM,{display:"flex",alignItems:"center",min:0,max:100,step:1,value:i,onChange:c,onBlur:l,w:"76px",format:mWe,defaultValue:1,onKeyDown:d,clampValueOnBlur:!1,variant:"outline",children:[a.jsx(kM,{paddingInlineEnd:7,_focusVisible:{zIndex:0},title:""}),a.jsx(Ni,{children:a.jsx(oe,{"aria-label":"open-slider",icon:a.jsx(Do,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full",isDisabled:n===null})})]})})]}),a.jsx(Ls,{children:a.jsxs(bi,{w:200,pt:0,pb:2,px:4,children:[a.jsx(hr,{}),a.jsx(Fi,{children:a.jsx(it,{min:0,max:100,value:i,onChange:r,defaultValue:yWe,marks:BT,formatValue:vWe,alwaysShowMarks:!0,isDisabled:n===null})})]})})]})});Bie.displayName="EntityListSelectedEntityActionBarOpacity";const zie=h.memo(()=>{const{t:e}=T(),t=M($n),n=Yne(t);return!t||!ZA(t)?null:a.jsx(oe,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.selectObject.selectObject"),tooltip:e("controlLayers.selectObject.selectObject"),icon:a.jsx(wX,{})})});zie.displayName="EntityListSelectedEntityActionBarSelectObjectButton";const Vie=h.memo(()=>{const{t:e}=T(),t=M($n),n=W6(t);return!t||!s2(t)?null:a.jsx(oe,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.transform.transform"),tooltip:e("controlLayers.transform.transform"),icon:a.jsx(Sm,{})})});Vie.displayName="EntityListSelectedEntityActionBarTransformButton";const $ie=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(Ixe),s=h.useCallback(i=>{i.stopPropagation(),t(XW())},[t]);return a.jsx(oe,{size:"sm","aria-label":e(n?"controlLayers.showNonRasterLayers":"controlLayers.hideNonRasterLayers"),tooltip:e(n?"controlLayers.showNonRasterLayers":"controlLayers.hideNonRasterLayers"),variant:"link",icon:n?a.jsx(aX,{}):a.jsx(bu,{}),onClick:s,alignSelf:"stretch"})});$ie.displayName="EntityListNonRasterLayerToggle";const Gie=h.memo(()=>{const{t:e}=T(),t=xt(),n=M($n),s=ac(n),i=Xne(),o=h.useCallback(()=>{i(s)},[i,s]);return!n||!jxe(n)?null:a.jsx(oe,{onClick:o,isDisabled:!n||t,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.saveLayerToAssets"),tooltip:e("controlLayers.saveLayerToAssets"),icon:a.jsx(Ol,{})})});Gie.displayName="EntityListSelectedEntityActionBarSaveToAssetsButton";const Hie=h.memo(()=>a.jsxs(A,{w:"full",gap:2,alignItems:"center",ps:1,children:[a.jsx(Bie,{}),a.jsx(At,{}),a.jsx(Rie,{}),a.jsxs(A,{h:"full",children:[a.jsx(zie,{}),a.jsx(Oie,{}),a.jsx(Vie,{}),a.jsx(Fie,{}),a.jsx(Gie,{}),a.jsx(Sie,{}),a.jsx($ie,{}),a.jsx(_ie,{})]})]}));Hie.displayName="EntityListSelectedEntityActionBar";const CWe=({amplitude:e,stroke:t,strokeWidth:n,width:s,height:i,segments:o=5})=>{const r=()=>{if(e===0)return`M0,${i/2} L${s},${i/2}`;const l=Math.min(i/2,e),c=s/o;let d=`M0,${i/2}`;for(let u=1;u<=o;u++){const p=u*c,m=i/2+(u%2===0?l:-l);d+=` Q${p-c/2},${m} ${p},${i/2}`}return d};return a.jsx("svg",{width:s,height:i,viewBox:`0 0 ${s} ${i}`,xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:r(),fill:"none",stroke:t,strokeWidth:n})})},W1=()=>{const e=M(Exe),{data:t}=om(e??Ri);return t},cl={initial:.7,sliderMin:0,sliderMax:1,numberInputMin:0,numberInputMax:1,fineStep:.01,coarseStep:.05},wWe=ve(yM,e=>e.length>0),Wie=h.memo(()=>{const e=M(Axe),t=Q(),n=M(wWe),s=W1(),i=h.useCallback(c=>{t(qH(c))},[t]),{t:o}=T(),[r]=YW("colors",["invokeBlue.300"]),l=h.useMemo(()=>!!(!n||s&&IM(s)),[n,s]);return a.jsxs(te,{isDisabled:l,p:1,justifyContent:"space-between",h:8,children:[a.jsxs(A,{gap:3,alignItems:"center",children:[a.jsx(Ue,{feature:"paramDenoisingStrength",children:a.jsx(ne,{mr:0,children:`${o("parameters.denoisingStrength")}`})}),n&&a.jsx(CWe,{amplitude:e*10,stroke:r,strokeWidth:1,width:40,height:14})]}),l?a.jsx(A,{alignItems:"center",children:a.jsx(Bi,{opacity:"0.6",children:o("parameters.disabledNoRasterContent")})}):a.jsxs(a.Fragment,{children:[a.jsx(it,{step:cl.coarseStep,fineStep:cl.fineStep,min:cl.sliderMin,max:cl.sliderMax,defaultValue:cl.initial,onChange:i,value:e}),a.jsx(Pe,{step:cl.coarseStep,fineStep:cl.fineStep,min:cl.numberInputMin,max:cl.numberInputMax,defaultValue:cl.initial,onChange:i,value:e,variant:"outline"})]})]})});Wie.displayName="ParamDenoisingStrength";const Uie=h.memo(()=>{const e=M(Pxe);return a.jsx(fa,{children:a.jsxs(A,{flexDir:"column",gap:2,w:"full",h:"full",children:[a.jsx(Hie,{}),a.jsx(vt,{py:0}),a.jsx(Wie,{}),a.jsx(vt,{py:0}),!e&&a.jsx(Eee,{}),e&&a.jsx(wie,{})]})})});Uie.displayName="CanvasLayersPanel";const _We=()=>{const{t:e}=T(),t=Q(),[n,{isLoading:s}]=Txe(),i=h.useCallback(async()=>{try{const o=await n({board_name:e("boards.myBoard")}).unwrap();t(sm({boardId:o.board_id})),t(H2(""))}catch{}},[e,n,t]);return a.jsx(oe,{icon:a.jsx(Sn,{}),isLoading:s,tooltip:e("boards.addBoard"),"aria-label":e("boards.addBoard"),onClick:i,size:"md","data-testid":"add-board-button",variant:"link",w:8,h:8})},SWe=h.memo(_We),l3=h.memo(()=>{const{t:e}=T();return a.jsx(Bi,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:e("common.auto")})});l3.displayName="AutoAddBadge";const kWe=({board:e,children:t})=>{const{t:n}=T(),s=Q(),i=M(am),o=h.useMemo(()=>ve(ko,b=>e.board_id===b),[e.board_id]),[r]=QW(),l=M(o),c=v1(e.board_id),[d]=vM(),u=h.useCallback(()=>{s(By(e.board_id))},[e.board_id,s]),p=h.useCallback(()=>{d({image_names:[],board_id:e.board_id})},[e.board_id,d]),m=h.useCallback(async()=>{try{await r({board_id:e.board_id,changes:{archived:!0}}).unwrap()}catch{pe({status:"error",title:"Unable to archive board"})}},[e.board_id,r]),f=h.useCallback(()=>{r({board_id:e.board_id,changes:{archived:!1}})},[e.board_id,r]),g=h.useCallback(()=>{Gu.set(e)},[e]),v=h.useCallback(()=>a.jsx(Zt,{visibility:"visible",children:a.jsxs(Ya,{title:c,children:[!i&&a.jsx(be,{icon:a.jsx(Sn,{}),isDisabled:l,onClick:u,children:n(l?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),a.jsx(be,{icon:a.jsx(oX,{}),onClickCapture:p,children:n("boards.downloadBoard")}),e.archived&&a.jsx(be,{icon:a.jsx(YZ,{}),onClick:f,children:n("boards.unarchiveBoard")}),!e.archived&&a.jsx(be,{icon:a.jsx(AMe,{}),onClick:m,children:n("boards.archiveBoard")}),a.jsx(be,{color:"error.300",icon:a.jsx(Ea,{}),onClick:g,isDestructive:!0,children:n("boards.deleteBoard")})]})}),[c,i,l,u,n,p,e.archived,f,m,g]);return a.jsx(p_,{renderMenu:v,children:t})},IWe=h.memo(kWe),qie=h.memo(({board:e,isSelected:t})=>{const{t:n}=T(),s=s5(!1),i=h.useRef(null),[o,r]=QW(),l=h.useCallback(async d=>{(await Kn(()=>o({board_id:e.board_id,changes:{board_name:d}}).unwrap())).isErr()&&pe({status:"error",title:n("boards.updateBoardError")})},[e.board_id,n,o]),c=rc({value:e.board_name,defaultValue:e.board_name,onChange:l,inputRef:i,onStartEditing:s.setTrue});return c.isEditing?a.jsx(Nt,{ref:i,...c.inputProps,variant:"outline",isDisabled:r.isLoading,_focusVisible:{borderWidth:1,borderColor:"invokeBlueAlpha.400",borderRadius:"base"}}):a.jsxs(A,{alignItems:"center",gap:3,onMouseOver:s.setTrue,onMouseOut:s.setFalse,children:[a.jsx(q,{size:"sm",fontWeight:"semibold",userSelect:"none",color:t?"base.100":"base.300",onDoubleClick:c.startEditing,cursor:"text",noOfLines:1,children:c.value}),s.isTrue&&a.jsx(oe,{"aria-label":"edit name",icon:a.jsx(Im,{}),size:"sm",variant:"ghost",onClick:c.startEditing})]})});qie.displayName="CanvasEntityTitleEdit";const Kie=({board:e,boardCounts:t})=>{const{t:n}=T(),{currentData:s}=eu(e?.cover_image_name??Ri);return a.jsxs(A,{flexDir:"column",alignItems:"center",gap:1,children:[s&&a.jsx(Nn,{src:s.thumbnail_url,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),a.jsxs(A,{flexDir:"column",alignItems:"center",children:[e&&a.jsx(q,{fontWeight:"semibold",children:e.board_name}),a.jsxs(q,{noOfLines:1,children:[n("boards.imagesWithCount",{count:t.image_count}),","," ",n("boards.assetsWithCount",{count:t.asset_count})]}),e?.archived&&a.jsxs(q,{children:["(",n("boards.archived"),")"]})]})]})},jWe={bg:"base.850"},EWe=({board:e,isSelected:t})=>{const n=Q(),{t:s}=T(),i=M(ko),o=M(am),r=M(nm),l=h.useCallback(()=>{r!==e.board_id&&n(sm({boardId:e.board_id})),o&&i!==e.board_id&&n(By(e.board_id))},[r,e.board_id,o,i,n]),c=h.useMemo(()=>TP.getData({boardId:e.board_id}),[e.board_id]),d=h.useMemo(()=>({image_count:e.image_count,asset_count:e.asset_count}),[e]);return a.jsxs(ke,{position:"relative",w:"full",h:12,children:[a.jsx(IWe,{board:e,children:u=>a.jsx(He,{label:a.jsx(Kie,{board:e,boardCounts:d}),openDelay:1e3,placement:"right",closeOnScroll:!0,p:2,children:a.jsxs(A,{ref:u,onClick:l,alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:t?"base.850":void 0,_hover:jWe,w:"full",h:"full",children:[a.jsx(PWe,{board:e}),a.jsx(A,{flex:1,children:a.jsx(qie,{board:e,isSelected:t})}),i===e.board_id&&a.jsx(l3,{}),e.archived&&a.jsx(Je,{as:YZ,fill:"base.300"}),a.jsx(A,{justifyContent:"flex-end",children:a.jsxs(q,{variant:"subtext",children:[e.image_count," | ",e.asset_count]})})]})})}),a.jsx(ds,{dndTarget:TP,dndTargetData:c,label:s("gallery.move")})]})},AWe=h.memo(EWe),PWe=({board:e})=>{const{currentData:t}=eu(e.cover_image_name??Ri);return t?a.jsx(Nn,{src:t.thumbnail_url,draggable:!1,objectFit:"cover",w:10,h:10,borderRadius:"base",borderBottomRadius:"lg"}):a.jsx(A,{w:10,h:10,justifyContent:"center",alignItems:"center",children:a.jsx(Je,{boxSize:10,as:GMe,opacity:.7,color:"base.500"})})},TWe=ve(ko,e=>e==="none"),DWe=({children:e})=>{const{t}=T(),n=Q(),s=M(am),i=M(TWe),[o]=vM(),r=h.useCallback(()=>{n(By("none"))},[n]),l=h.useCallback(()=>{o({image_names:[],board_id:"none"})},[o]),c=h.useCallback(()=>{Gu.set("none")},[]),d=h.useCallback(()=>a.jsx(Zt,{visibility:"visible",children:a.jsxs(Ya,{title:t("boards.uncategorized"),children:[!s&&a.jsx(be,{icon:a.jsx(Sn,{}),isDisabled:i,onClick:r,children:t(i?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),a.jsx(be,{icon:a.jsx(oX,{}),onClickCapture:l,children:t("boards.downloadBoard")}),a.jsx(be,{color:"error.300",icon:a.jsx(Ea,{}),onClick:c,isDestructive:!0,children:t("boards.deleteAllUncategorizedImages")})]})}),[s,l,r,i,t,c]);return a.jsx(p_,{renderMenu:d,children:e})},MWe=h.memo(DWe),LWe={bg:"base.850"},Zie=h.memo(({isSelected:e})=>{const t=Q(),{imagesTotal:n}=Dxe("none",{selectFromResult:({data:p})=>({imagesTotal:p?.total??0})}),{assetsTotal:s}=Mxe("none",{selectFromResult:({data:p})=>({assetsTotal:p?.total??0})}),i=M(ko),o=M(am),r=M(m_),l=v1("none"),c=h.useCallback(()=>{t(sm({boardId:"none"})),o&&t(By("none"))},[t,o]),d=h.useMemo(()=>DP.getData(),[]),{t:u}=T();return r.length?null:a.jsxs(ke,{position:"relative",w:"full",h:12,children:[a.jsx(MWe,{children:p=>a.jsx(He,{label:a.jsx(Kie,{board:null,boardCounts:{image_count:n,asset_count:s}}),openDelay:1e3,placement:"right",closeOnScroll:!0,children:a.jsxs(A,{ref:p,onClick:c,w:"full",h:"full",alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:e?"base.850":void 0,_hover:LWe,children:[a.jsx(A,{w:"10",justifyContent:"space-around",children:a.jsx(Je,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",children:a.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})})}),a.jsx(q,{fontSize:"sm",color:e?"base.100":"base.300",fontWeight:"semibold",noOfLines:1,flexGrow:1,children:l}),i==="none"&&a.jsx(l3,{}),a.jsxs(q,{variant:"subtext",children:[n," | ",s]})]})})}),a.jsx(ds,{dndTarget:DP,dndTargetData:d,label:u("gallery.move")})]})});Zie.displayName="HoverableBoard";const RWe=h.memo(Zie),Xie=h.memo(()=>{const{t:e}=T(),t=M(nm),n=M(m_),s=M(xH),{data:i}=Oh(s),{isOpen:o}=jo({defaultIsOpen:!0}),r=h.useMemo(()=>i?n.length?i.filter(c=>c.board_name.toLowerCase().includes(n.toLowerCase())):i:os,[n,i]),l=h.useMemo(()=>{const c=[];return n.length||c.push(a.jsx(RWe,{isSelected:t==="none"},"none")),r.forEach(d=>{c.push(a.jsx(AWe,{board:d,isSelected:t===d.board_id},d.board_id))}),c},[n.length,r,t]);return a.jsxs(A,{direction:"column",children:[a.jsxs(A,{position:"sticky",w:"full",justifyContent:"space-between",alignItems:"center",ps:2,py:1,zIndex:1,top:0,bg:"base.900",children:[a.jsx(q,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:e("boards.boards")}),a.jsx(SWe,{})]}),a.jsx(mu,{in:o,style:S6,children:a.jsx(A,{direction:"column",gap:1,children:l.length?l:a.jsx(q,{variant:"subtext",textAlign:"center",children:e("boards.noBoards",{boardType:n.length?"Matching":""})})})})]})});Xie.displayName="BoardsList";const OWe={height:"100%",width:"100%"},Yie=h.memo(()=>{const[e,t]=h.useState(null);return h.useEffect(()=>{const n=e?.osInstance();if(!n)return;const s=n.elements().viewport,i=s.style.overflowY;s.style.setProperty("overflow-y","scroll","important");const o=zi(B5({element:s}),$Y({element:s}));return s.style.setProperty("overflow-y",i),o},[e]),a.jsx(ke,{position:"relative",w:"full",h:"full",children:a.jsx(ke,{position:"absolute",top:0,right:0,bottom:0,left:0,children:a.jsx(ti,{ref:t,style:OWe,options:iu.options,children:a.jsx(Xie,{})})})})});Yie.displayName="BoardsListWrapper";const Qie=h.memo(()=>{const e=Q(),t=M(m_),{t:n}=T(),s=h.useCallback(l=>{e(H2(l))},[e]),i=h.useCallback(()=>{e(H2(""))},[e]),o=h.useCallback(l=>{l.key==="Escape"&&i()},[i]),r=h.useCallback(l=>{s(l.target.value)},[s]);return a.jsxs(tc,{children:[a.jsx(Nt,{placeholder:n("boards.searchBoard"),value:t,onKeyDown:o,onChange:r,"data-testid":"board-search-input"}),t&&t.length&&a.jsx(Hr,{h:"full",pe:2,children:a.jsx(oe,{onClick:i,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:a.jsx(fn,{})})})]})});Qie.displayName="BoardsSearch";const NWe=()=>{const e=Q(),{t}=T(),n=M(ko),s=M(am),{options:i,hasBoards:o}=Oh({},{selectFromResult:({data:d})=>{const u=[{label:t("common.none"),value:"none"}].concat((d??[]).map(({board_id:p,board_name:m})=>({label:m,value:p})));return{options:u,hasBoards:u.length>1}}}),r=h.useCallback(d=>{d&&e(By(d.value))},[e]),l=h.useMemo(()=>i.find(d=>d.value===n),[i,n]),c=h.useCallback(()=>t("boards.noMatching"),[t]);return a.jsxs(te,{isDisabled:!o||s,children:[a.jsx(ne,{children:t("boards.autoAddBoard")}),a.jsx(pt,{value:l,options:i,onChange:r,placeholder:t("boards.selectBoard"),noOptionsMessage:c})]})},FWe=h.memo(NWe),BWe=()=>{const e=Q(),{t}=T(),n=M(am),s=h.useCallback(i=>e(Lxe(i.target.checked)),[e]);return a.jsxs(te,{children:[a.jsx(ne,{flexGrow:1,children:t("gallery.autoAssignBoardOnClick")}),a.jsx(us,{isChecked:n,onChange:s})]})},zWe=h.memo(BWe),VWe=ve(ir,e=>e.shouldShowArchivedBoards),$We=()=>{const e=Q(),{t}=T(),n=M(VWe),s=h.useCallback(i=>{e(Rxe(i.target.checked))},[e]);return a.jsxs(te,{children:[a.jsx(ne,{flexGrow:1,children:t("gallery.showArchivedBoards")}),a.jsx(us,{isChecked:n,onChange:s})]})},GWe=h.memo($We),HWe=Ds(["created_at","board_name"]),WWe=e=>HWe.safeParse(e).success,UWe=Ds(["ASC","DESC"]),qWe=e=>UWe.safeParse(e).success,Jie=h.memo(()=>{const{t:e}=T(),t=M(Oxe),n=M(Nxe),s=h.useMemo(()=>[{value:"created_at",label:e("workflows.created")},{value:"board_name",label:e("workflows.name")}],[e]),i=h.useMemo(()=>[{value:"ASC",label:e("workflows.ascending")},{value:"DESC",label:e("workflows.descending")}],[e]),o=Q(),r=h.useCallback(u=>{!WWe(u?.value)||u.value===t||o(Fxe(u.value))},[t,o]),l=h.useMemo(()=>s.find(u=>u.value===t)||s[0],[t,s]),c=h.useCallback(u=>{!qWe(u?.value)||u.value===n||o(Bxe(u.value))},[n,o]),d=h.useMemo(()=>i.find(u=>u.value===n),[n,i]);return a.jsxs(A,{flexDir:"column",gap:4,children:[a.jsxs(te,{orientation:"horizontal",gap:1,children:[a.jsx(ne,{children:e("common.orderBy")}),a.jsx(pt,{isSearchable:!1,value:l,options:s,onChange:r})]}),a.jsxs(te,{orientation:"horizontal",gap:1,children:[a.jsx(ne,{children:e("common.direction")}),a.jsx(pt,{isSearchable:!1,value:d,options:i,onChange:c})]})]})});Jie.displayName="BoardsListSortControls";const eoe=h.memo(()=>{const{t:e}=T();return a.jsxs(yi,{isLazy:!0,children:[a.jsx(Ni,{children:a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.boardsSettings"),icon:a.jsx(f1,{}),tooltip:e("gallery.boardsSettings")})}),a.jsx(Ls,{children:a.jsxs(bi,{children:[a.jsx(hr,{}),a.jsx(Fi,{children:a.jsxs(A,{direction:"column",gap:2,children:[a.jsx(q,{fontWeight:"semibold",color:"base.300",children:"Boards Settings"}),a.jsx(vt,{}),a.jsx(zWe,{}),a.jsx(GWe,{}),a.jsx(FWe,{}),a.jsx(vt,{}),a.jsx(Jie,{})]})})]})})]})});eoe.displayName="BoardsSettingsPopover";const KWe={position:"relative",w:"full",h:"full",p:2,'&[data-highlighted="true"]::after':{borderColor:"invokeBlue.300"},"&::after":{content:'""',position:"absolute",inset:"2px",zIndex:1,borderRadius:"base",border:"1px solid",borderColor:"transparent",pointerEvents:"none"}},toe=h.memo(e=>{const t=h.useRef(null),n=M(xW);Qy(e.params.focusRegion,t);const i=So(e.params.focusRegion)&&n;return a.jsx(ke,{ref:t,tabIndex:-1,sx:KWe,"data-highlighted":i,children:e.children})});toe.displayName="AutoLayoutPanelContainer";const noe=h.createContext(null),Zm=e=>{const{tab:t,children:n}=e,s=h.useMemo(()=>({tab:t}),[t]);return a.jsx(noe.Provider,{value:s,children:n})},Qo=()=>{const e=h.useContext(noe);if(!e)throw new Error("useAutoLayoutContext must be used within an AutoLayoutProvider");return e},vs=e=>h.memo(t=>a.jsx(toe,{...t,children:a.jsx(e,{})})),ZWe={flexShrink:0,minHeight:0},U1=h.memo(()=>{const e=M(m_),t=cS(!!e),{tab:n}=Qo(),s=OQ(n,Ia,"vertical",B_,n1,oAe),i=le(s.$isCollapsed),{t:o}=T(),r=Q(),l=h.useCallback(()=>{e.length&&r(H2("")),!t.isOpen&&s.$isCollapsed.get()&&s.expand(),t.toggle()},[e.length,t,s,r]);return a.jsxs(A,{flexDir:"column",w:"full",h:"full",children:[a.jsxs(A,{alignItems:"center",justifyContent:"space-between",w:"full",children:[a.jsx(A,{flexGrow:1,flexBasis:0,children:a.jsx(he,{size:"sm",variant:"ghost",onClick:s.toggle,leftIcon:i?a.jsx(Do,{}):a.jsx(B4,{}),children:o("boards.boards")})}),a.jsxs(A,{flexGrow:1,flexBasis:0,justifyContent:"flex-end",children:[a.jsx(eoe,{}),a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",onClick:l,tooltip:t.isOpen?`${o("gallery.exitBoardSearch")}`:`${o("gallery.displayBoardSearch")}`,"aria-label":o("gallery.displayBoardSearch"),icon:a.jsx(dX,{}),colorScheme:t.isOpen?"invokeBlue":"base"})]})]}),a.jsx(mu,{in:t.isOpen,style:ZWe,children:a.jsx(ke,{w:"full",pt:2,children:a.jsx(Qie,{})})}),a.jsx(vt,{pt:2}),a.jsx(Yie,{})]})});U1.displayName="BoardsPanel";const XWe=()=>{const e=Q(),t=M(zxe),n=h.useCallback(i=>{e(HL(i))},[e]),s=h.useCallback(()=>{e(HL(""))},[e]);return[t,n,s]},YWe=(e,t,n)=>{const s=new Set,i=new Set(t);for(const o of n)for(let r=o.startIndex;r<=o.endIndex;r++){const l=e[r];l&&!i.has(l)&&s.add(l)}return Array.from(s)},QWe=({imageNames:e,enabled:t})=>{const n=Ze(),[s]=Vxe(),[i,o]=h.useState(null),[r,l]=h.useState([]),c=h.useCallback((p,m)=>{if(!t)return;const f=$r.util.selectCachedArgsForQuery(n.getState(),"getImageDTO"),g=YWe(m,f,p);g.length!==0&&(s({image_names:g}),l([]))},[t,s,n]),d=wY(c,500),u=h.useCallback(p=>{o(p),l(m=>[...m,p])},[]);return h.useEffect(()=>{const p=i?[...r,i]:r;d(p,e)},[e,i,r,d]),{onRangeChanged:u}},KS=0,Su=1,Xm=2,soe=4;function yz(e){return()=>e}function JWe(e){e()}function ioe(e,t){return n=>e(t(n))}function bz(e,t){return()=>e(t)}function eUe(e,t){return n=>e(t,n)}function c3(e){return e!==void 0}function tUe(...e){return()=>{e.map(JWe)}}function Ym(){}function ZS(e,t){return t(e),e}function nUe(e,t){return t(e)}function as(...e){return e}function Rn(e,t){return e(Su,t)}function Gt(e,t){e(KS,t)}function d3(e){e(Xm)}function pi(e){return e(soe)}function gt(e,t){return Rn(e,eUe(t,KS))}function Yl(e,t){const n=e(Su,s=>{n(),t(s)});return n}function xz(e){let t,n;return s=>i=>{t=i,n&&clearTimeout(n),n=setTimeout(()=>{s(t)},e)}}function ooe(e,t){return e===t}function ns(e=ooe){let t;return n=>s=>{e(t,s)||(t=s,n(s))}}function Lt(e){return t=>n=>{e(n)&&t(n)}}function nt(e){return t=>ioe(t,e)}function Cl(e){return t=>()=>{t(e)}}function Te(e,...t){const n=sUe(...t);return(s,i)=>{switch(s){case Xm:d3(e);return;case Su:return Rn(e,n(i))}}}function Tl(e,t){return n=>s=>{n(t=e(t,s))}}function Hf(e){return t=>n=>{e>0?e--:t(n)}}function Od(e){let t=null,n;return s=>i=>{t=i,!n&&(n=setTimeout(()=>{n=void 0,s(t)},e))}}function qt(...e){const t=new Array(e.length);let n=0,s=null;const i=Math.pow(2,e.length)-1;return e.forEach((o,r)=>{const l=Math.pow(2,r);Rn(o,c=>{const d=n;n=n|l,t[r]=c,d!==i&&n===i&&s&&(s(),s=null)})}),o=>r=>{const l=()=>{o([r].concat(t))};n===i?l():s=l}}function sUe(...e){return t=>e.reduceRight(nUe,t)}function iUe(e){let t,n;const s=()=>t?.();return function(i,o){switch(i){case Su:return o?n===o?void 0:(s(),n=o,t=Rn(e,o),t):(s(),Ym);case Xm:s(),n=null;return}}}function Fe(e){let t=e;const n=pn();return(s,i)=>{switch(s){case KS:t=i;break;case Su:{i(t);break}case soe:return t}return n(s,i)}}function Zi(e,t){return ZS(Fe(t),n=>gt(e,n))}function pn(){const e=[];return(t,n)=>{switch(t){case KS:e.slice().forEach(s=>{s(n)});return;case Xm:e.splice(0,e.length);return;case Su:return e.push(n),()=>{const s=e.indexOf(n);s>-1&&e.splice(s,1)}}}}function _a(e){return ZS(pn(),t=>gt(e,t))}function En(e,t=[],{singleton:n}={singleton:!0}){return{constructor:e,dependencies:t,id:oUe(),singleton:n}}const oUe=()=>Symbol();function aUe(e){const t=new Map,n=({constructor:s,dependencies:i,id:o,singleton:r})=>{if(r&&t.has(o))return t.get(o);const l=s(i.map(c=>n(c)));return r&&t.set(o,l),l};return n(e)}function ei(...e){const t=pn(),n=new Array(e.length);let s=0;const i=Math.pow(2,e.length)-1;return e.forEach((o,r)=>{const l=Math.pow(2,r);Rn(o,c=>{n[r]=c,s=s|l,s===i&&Gt(t,n)})}),function(o,r){switch(o){case Xm:{d3(t);return}case Su:return s===i&&r(n),Rn(t,r)}}}function Rt(e,t=ooe){return Te(e,ns(t))}function Cz(...e){return function(t,n){switch(t){case Xm:return;case Su:return tUe(...e.map(s=>Rn(s,n)))}}}var Wo=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(Wo||{});const rUe={0:"debug",3:"error",1:"log",2:"warn"},lUe=()=>typeof globalThis>"u"?window:globalThis,ku=En(()=>{const e=Fe(3);return{log:Fe((t,n,s=1)=>{var i;const o=(i=lUe().VIRTUOSO_LOG_LEVEL)!=null?i:pi(e);s>=o&&console[rUe[s]]("%creact-virtuoso: %c%s %o","color: #0253b3; font-weight: bold","color: initial",t,n)}),logLevel:e}},[],{singleton:!0});function ep(e,t,n){return u3(e,t,n).callbackRef}function u3(e,t,n){const s=ce.useRef(null);let i=r=>{};const o=ce.useMemo(()=>typeof ResizeObserver<"u"?new ResizeObserver(r=>{const l=()=>{const c=r[0].target;c.offsetParent!==null&&e(c)};n?l():requestAnimationFrame(l)}):null,[e,n]);return i=r=>{r&&t?(o?.observe(r),s.current=r):(s.current&&o?.unobserve(s.current),s.current=null)},{callbackRef:i,ref:s}}function cUe(e,t,n,s,i,o,r,l,c){const d=ce.useCallback(u=>{const p=dUe(u.children,t,l?"offsetWidth":"offsetHeight",i);let m=u.parentElement;for(;!m.dataset.virtuosoScroller;)m=m.parentElement;const f=m.lastElementChild.dataset.viewportType==="window";let g;f&&(g=m.ownerDocument.defaultView);const v=r?l?r.scrollLeft:r.scrollTop:f?l?g.scrollX||g.document.documentElement.scrollLeft:g.scrollY||g.document.documentElement.scrollTop:l?m.scrollLeft:m.scrollTop,b=r?l?r.scrollWidth:r.scrollHeight:f?l?g.document.documentElement.scrollWidth:g.document.documentElement.scrollHeight:l?m.scrollWidth:m.scrollHeight,C=r?l?r.offsetWidth:r.offsetHeight:f?l?g.innerWidth:g.innerHeight:l?m.offsetWidth:m.offsetHeight;s({scrollHeight:b,scrollTop:Math.max(v,0),viewportHeight:C}),o?.(l?wz("column-gap",getComputedStyle(u).columnGap,i):wz("row-gap",getComputedStyle(u).rowGap,i)),p!==null&&e(p)},[e,t,i,o,r,s,l]);return u3(d,n,c)}function dUe(e,t,n,s){const i=e.length;if(i===0)return null;const o=[];for(let r=0;r<i;r++){const l=e.item(r);if(l.dataset.index===void 0)continue;const c=parseInt(l.dataset.index),d=parseFloat(l.dataset.knownSize),u=t(l,n);if(u===0&&s("Zero-sized element, this should not happen",{child:l},Wo.ERROR),u===d)continue;const p=o[o.length-1];o.length===0||p.size!==u||p.endIndex!==c-1?o.push({endIndex:c,size:u,startIndex:c}):o[o.length-1].endIndex++}return o}function wz(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,Wo.WARN),t==="normal"?0:parseInt(t??"0",10)}function aoe(e,t,n){const s=ce.useRef(null),i=ce.useCallback(c=>{if(!(c!=null&&c.offsetParent))return;const d=c.getBoundingClientRect(),u=d.width;let p,m;if(t){const f=t.getBoundingClientRect(),g=d.top-f.top;m=f.height-Math.max(0,g),p=g+t.scrollTop}else{const f=r.current.ownerDocument.defaultView;m=f.innerHeight-Math.max(0,d.top),p=d.top+f.scrollY}s.current={offsetTop:p,visibleHeight:m,visibleWidth:u},e(s.current)},[e,t]),{callbackRef:o,ref:r}=u3(i,!0,n),l=ce.useCallback(()=>{i(r.current)},[i,r]);return ce.useEffect(()=>{var c;if(t){t.addEventListener("scroll",l);const d=new ResizeObserver(()=>{requestAnimationFrame(l)});return d.observe(t),()=>{t.removeEventListener("scroll",l),d.unobserve(t)}}else{const d=(c=r.current)==null?void 0:c.ownerDocument.defaultView;return d?.addEventListener("scroll",l),d?.addEventListener("resize",l),()=>{d?.removeEventListener("scroll",l),d?.removeEventListener("resize",l)}}},[l,t,r]),o}const Mo=En(()=>{const e=pn(),t=pn(),n=Fe(0),s=pn(),i=Fe(0),o=pn(),r=pn(),l=Fe(0),c=Fe(0),d=Fe(0),u=Fe(0),p=pn(),m=pn(),f=Fe(!1),g=Fe(!1),v=Fe(!1);return gt(Te(e,nt(({scrollTop:b})=>b)),t),gt(Te(e,nt(({scrollHeight:b})=>b)),r),gt(t,i),{deviation:n,fixedFooterHeight:d,fixedHeaderHeight:c,footerHeight:u,headerHeight:l,horizontalDirection:g,scrollBy:m,scrollContainerState:e,scrollHeight:r,scrollingInProgress:f,scrollTo:p,scrollTop:t,skipAnimationFrameInResizeObserver:v,smoothScrollTargetReached:s,statefulScrollTop:i,viewportHeight:o}},[],{singleton:!0}),hy={lvl:0};function roe(e,t){const n=e.length;if(n===0)return[];let{index:s,value:i}=t(e[0]);const o=[];for(let r=1;r<n;r++){const{index:l,value:c}=t(e[r]);o.push({end:l-1,start:s,value:i}),s=l,i=c}return o.push({end:1/0,start:s,value:i}),o}function Un(e){return e===hy}function py(e,t){if(!Un(e))return t===e.k?e.v:t<e.k?py(e.l,t):py(e.r,t)}function Zr(e,t,n="k"){if(Un(e))return[-1/0,void 0];if(Number(e[n])===t)return[e.k,e.v];if(Number(e[n])<t){const s=Zr(e.r,t,n);return s[0]===-1/0?[e.k,e.v]:s}return Zr(e.l,t,n)}function ya(e,t,n){return Un(e)?doe(t,n,1):t===e.k?Xs(e,{k:t,v:n}):t<e.k?_z(Xs(e,{l:ya(e.l,t,n)})):_z(Xs(e,{r:ya(e.r,t,n)}))}function _f(){return hy}function XS(e,t,n){if(Un(e))return[];const s=Zr(e,t)[0];return uUe(VT(e,s,n))}function zT(e,t){if(Un(e))return hy;const{k:n,l:s,r:i}=e;if(t===n){if(Un(s))return i;if(Un(i))return s;{const[o,r]=coe(s);return j2(Xs(e,{k:o,l:loe(s),v:r}))}}else return t<n?j2(Xs(e,{l:zT(s,t)})):j2(Xs(e,{r:zT(i,t)}))}function nh(e){return Un(e)?[]:[...nh(e.l),{k:e.k,v:e.v},...nh(e.r)]}function VT(e,t,n){if(Un(e))return[];const{k:s,l:i,r:o,v:r}=e;let l=[];return s>t&&(l=l.concat(VT(i,t,n))),s>=t&&s<=n&&l.push({k:s,v:r}),s<=n&&(l=l.concat(VT(o,t,n))),l}function j2(e){const{l:t,lvl:n,r:s}=e;if(s.lvl>=n-1&&t.lvl>=n-1)return e;if(n>s.lvl+1){if(TE(t))return uoe(Xs(e,{lvl:n-1}));if(!Un(t)&&!Un(t.r))return Xs(t.r,{l:Xs(t,{r:t.r.l}),lvl:n,r:Xs(e,{l:t.r.r,lvl:n-1})});throw new Error("Unexpected empty nodes")}else{if(TE(e))return $T(Xs(e,{lvl:n-1}));if(!Un(s)&&!Un(s.l)){const i=s.l,o=TE(i)?s.lvl-1:s.lvl;return Xs(i,{l:Xs(e,{lvl:n-1,r:i.l}),lvl:i.lvl+1,r:$T(Xs(s,{l:i.r,lvl:o}))})}else throw new Error("Unexpected empty nodes")}}function Xs(e,t){return doe(t.k!==void 0?t.k:e.k,t.v!==void 0?t.v:e.v,t.lvl!==void 0?t.lvl:e.lvl,t.l!==void 0?t.l:e.l,t.r!==void 0?t.r:e.r)}function loe(e){return Un(e.r)?e.l:j2(Xs(e,{r:loe(e.r)}))}function TE(e){return Un(e)||e.lvl>e.r.lvl}function coe(e){return Un(e.r)?[e.k,e.v]:coe(e.r)}function doe(e,t,n,s=hy,i=hy){return{k:e,l:s,lvl:n,r:i,v:t}}function _z(e){return $T(uoe(e))}function uoe(e){const{l:t}=e;return!Un(t)&&t.lvl===e.lvl?Xs(t,{r:Xs(e,{l:t.r})}):e}function $T(e){const{lvl:t,r:n}=e;return!Un(n)&&!Un(n.r)&&n.lvl===t&&n.r.lvl===t?Xs(n,{l:Xs(e,{r:n.l}),lvl:t+1}):e}function uUe(e){return roe(e,({k:t,v:n})=>({index:t,value:n}))}function hoe(e,t){return!!(e&&e.startIndex===t.startIndex&&e.endIndex===t.endIndex)}function fy(e,t){return!!(e&&e[0]===t[0]&&e[1]===t[1])}const h3=En(()=>({recalcInProgress:Fe(!1)}),[],{singleton:!0});function poe(e,t,n){return e[XC(e,t,n)]}function XC(e,t,n,s=0){let i=e.length-1;for(;s<=i;){const o=Math.floor((s+i)/2),r=e[o],l=n(r,t);if(l===0)return o;if(l===-1){if(i-s<2)return o-1;i=o-1}else{if(i===s)return o;s=o+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function hUe(e,t,n,s){const i=XC(e,t,s),o=XC(e,n,s,i);return e.slice(i,o+1)}function ou(e,t){return Math.round(e.getBoundingClientRect()[t])}function YS(e){return!Un(e.groupOffsetTree)}function p3({index:e},t){return t===e?0:t<e?-1:1}function pUe(){return{groupIndices:[],groupOffsetTree:_f(),lastIndex:0,lastOffset:0,lastSize:0,offsetTree:[],sizeTree:_f()}}function fUe(e,t){let n=Un(e)?0:1/0;for(const s of t){const{endIndex:i,size:o,startIndex:r}=s;if(n=Math.min(n,r),Un(e)){e=ya(e,0,o);continue}const l=XS(e,r-1,i+1);if(l.some(CUe(s)))continue;let c=!1,d=!1;for(const{end:u,start:p,value:m}of l)c?(i>=p||o===m)&&(e=zT(e,p)):(d=m!==o,c=!0),u>i&&i>=p&&m!==o&&(e=ya(e,i+1,m));d&&(e=ya(e,r,o))}return[e,n]}function mUe(e){return typeof e.groupIndex<"u"}function gUe({offset:e},t){return t===e?0:t<e?-1:1}function my(e,t,n){if(t.length===0)return 0;const{index:s,offset:i,size:o}=poe(t,e,p3),r=e-s,l=o*r+(r-1)*n+i;return l>0?l+n:l}function foe(e,t){if(!YS(t))return e;let n=0;for(;t.groupIndices[n]<=e+n;)n++;return e+n}function moe(e,t,n){if(mUe(e))return t.groupIndices[e.groupIndex]+1;{const s=e.index==="LAST"?n:e.index;let i=foe(s,t);return i=Math.max(0,i,Math.min(n,i)),i}}function vUe(e,t,n,s=0){return s>0&&(t=Math.max(t,poe(e,s,p3).offset)),roe(hUe(e,t,n,gUe),xUe)}function yUe(e,[t,n,s,i]){t.length>0&&s("received item sizes",t,Wo.DEBUG);const o=e.sizeTree;let r=o,l=0;if(n.length>0&&Un(o)&&t.length===2){const m=t[0].size,f=t[1].size;r=n.reduce((g,v)=>ya(ya(g,v,m),v+1,f),r)}else[r,l]=fUe(r,t);if(r===o)return e;const{lastIndex:c,lastOffset:d,lastSize:u,offsetTree:p}=GT(e.offsetTree,l,r,i);return{groupIndices:n,groupOffsetTree:n.reduce((m,f)=>ya(m,f,my(f,p,i)),_f()),lastIndex:c,lastOffset:d,lastSize:u,offsetTree:p,sizeTree:r}}function bUe(e){return nh(e).map(({k:t,v:n},s,i)=>{const o=i[s+1];return{endIndex:o?o.k-1:1/0,size:n,startIndex:t}})}function Sz(e,t){let n=0,s=0;for(;n<e;)n+=t[s+1]-t[s]-1,s++;return s-(n===e?0:1)}function GT(e,t,n,s){let i=e,o=0,r=0,l=0,c=0;if(t!==0){c=XC(i,t-1,p3),l=i[c].offset;const d=Zr(n,t-1);o=d[0],r=d[1],i.length&&i[c].size===Zr(n,t)[1]&&(c-=1),i=i.slice(0,c+1)}else i=[];for(const{start:d,value:u}of XS(n,t,1/0)){const p=d-o,m=p*r+l+p*s;i.push({index:d,offset:m,size:u}),o=d,l=m,r=u}return{lastIndex:o,lastOffset:l,lastSize:r,offsetTree:i}}function xUe(e){return{index:e.index,value:e}}function CUe(e){const{endIndex:t,size:n,startIndex:s}=e;return i=>i.start===s&&(i.end===t||i.end===1/0)&&i.value===n}const wUe={offsetHeight:"height",offsetWidth:"width"},cc=En(([{log:e},{recalcInProgress:t}])=>{const n=pn(),s=pn(),i=Zi(s,0),o=pn(),r=pn(),l=Fe(0),c=Fe([]),d=Fe(void 0),u=Fe(void 0),p=Fe((_,S)=>ou(_,wUe[S])),m=Fe(void 0),f=Fe(0),g=pUe(),v=Zi(Te(n,qt(c,e,f),Tl(yUe,g),ns()),g),b=Zi(Te(c,ns(),Tl((_,S)=>({current:S,prev:_.current}),{current:[],prev:[]}),nt(({prev:_})=>_)),[]);gt(Te(c,Lt(_=>_.length>0),qt(v,f),nt(([_,S,I])=>{const k=_.reduce((E,j,P)=>ya(E,j,my(j,S.offsetTree,I)||P),_f());return{...S,groupIndices:_,groupOffsetTree:k}})),v),gt(Te(s,qt(v),Lt(([_,{lastIndex:S}])=>_<S),nt(([_,{lastIndex:S,lastSize:I}])=>[{endIndex:S,size:I,startIndex:_}])),n),gt(d,u);const C=Zi(Te(d,nt(_=>_===void 0)),!0);gt(Te(u,Lt(_=>_!==void 0&&Un(pi(v).sizeTree)),nt(_=>[{endIndex:0,size:_,startIndex:0}])),n);const y=_a(Te(n,qt(v),Tl(({sizes:_},[S,I])=>({changed:I!==_,sizes:I}),{changed:!1,sizes:g}),nt(_=>_.changed)));Rn(Te(l,Tl((_,S)=>({diff:_.prev-S,prev:S}),{diff:0,prev:0}),nt(_=>_.diff)),_=>{const{groupIndices:S}=pi(v);if(_>0)Gt(t,!0),Gt(o,_+Sz(_,S));else if(_<0){const I=pi(b);I.length>0&&(_-=Sz(-_,I)),Gt(r,_)}}),Rn(Te(l,qt(e)),([_,S])=>{_<0&&S("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:l},Wo.ERROR)});const x=_a(o);gt(Te(o,qt(v),nt(([_,S])=>{const I=S.groupIndices.length>0,k=[],E=S.lastSize;if(I){const j=py(S.sizeTree,0);let P=0,D=0;for(;P<_;){const N=S.groupIndices[D],F=S.groupIndices.length===D+1?1/0:S.groupIndices[D+1]-N-1;k.push({endIndex:N,size:j,startIndex:N}),k.push({endIndex:N+1+F-1,size:E,startIndex:N+1}),D++,P+=F+1}const O=nh(S.sizeTree);return P!==_&&O.shift(),O.reduce((N,{k:F,v:X})=>{let L=N.ranges;return N.prevSize!==0&&(L=[...N.ranges,{endIndex:F+_-1,size:N.prevSize,startIndex:N.prevIndex}]),{prevIndex:F+_,prevSize:X,ranges:L}},{prevIndex:_,prevSize:0,ranges:k}).ranges}return nh(S.sizeTree).reduce((j,{k:P,v:D})=>({prevIndex:P+_,prevSize:D,ranges:[...j.ranges,{endIndex:P+_-1,size:j.prevSize,startIndex:j.prevIndex}]}),{prevIndex:0,prevSize:E,ranges:[]}).ranges})),n);const w=_a(Te(r,qt(v,f),nt(([_,{offsetTree:S},I])=>{const k=-_;return my(k,S,I)})));return gt(Te(r,qt(v,f),nt(([_,S,I])=>{if(S.groupIndices.length>0){if(Un(S.sizeTree))return S;let k=_f();const E=pi(b);let j=0,P=0,D=0;for(;j<-_;){D=E[P];const O=E[P+1]-D-1;P++,j+=O+1}if(k=nh(S.sizeTree).reduce((O,{k:N,v:F})=>ya(O,Math.max(0,N+_),F),k),j!==-_){const O=py(S.sizeTree,D);k=ya(k,0,O);const N=Zr(S.sizeTree,-_+1)[1];k=ya(k,1,N)}return{...S,sizeTree:k,...GT(S.offsetTree,0,k,I)}}else{const k=nh(S.sizeTree).reduce((E,{k:j,v:P})=>ya(E,Math.max(0,j+_),P),_f());return{...S,sizeTree:k,...GT(S.offsetTree,0,k,I)}}})),v),{beforeUnshiftWith:x,data:m,defaultItemSize:u,firstItemIndex:l,fixedItemSize:d,gap:f,groupIndices:c,itemSize:p,listRefresh:y,shiftWith:r,shiftWithOffset:w,sizeRanges:n,sizes:v,statefulTotalCount:i,totalCount:s,trackItemSizes:C,unshiftWith:o}},as(ku,h3),{singleton:!0});function _Ue(e){return e.reduce((t,n)=>(t.groupIndices.push(t.totalCount),t.totalCount+=n+1,t),{groupIndices:[],totalCount:0})}const goe=En(([{groupIndices:e,sizes:t,totalCount:n},{headerHeight:s,scrollTop:i}])=>{const o=pn(),r=pn(),l=_a(Te(o,nt(_Ue)));return gt(Te(l,nt(c=>c.totalCount)),n),gt(Te(l,nt(c=>c.groupIndices)),e),gt(Te(ei(i,t,s),Lt(([c,d])=>YS(d)),nt(([c,d,u])=>Zr(d.groupOffsetTree,Math.max(c-u,0),"v")[0]),ns(),nt(c=>[c])),r),{groupCounts:o,topItemsIndexes:r}},as(cc,Mo)),Iu=En(([{log:e}])=>{const t=Fe(!1),n=_a(Te(t,Lt(s=>s),ns()));return Rn(t,s=>{s&&pi(e)("props updated",{},Wo.DEBUG)}),{didMount:n,propsReady:t}},as(ku),{singleton:!0}),SUe=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function voe(e){const t=typeof e=="number"?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!SUe)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const q1=En(([{gap:e,listRefresh:t,sizes:n,totalCount:s},{fixedFooterHeight:i,fixedHeaderHeight:o,footerHeight:r,headerHeight:l,scrollingInProgress:c,scrollTo:d,smoothScrollTargetReached:u,viewportHeight:p},{log:m}])=>{const f=pn(),g=pn(),v=Fe(0);let b=null,C=null,y=null;function x(){b&&(b(),b=null),y&&(y(),y=null),C&&(clearTimeout(C),C=null),Gt(c,!1)}return gt(Te(f,qt(n,p,s,v,l,r,m),qt(e,o,i),nt(([[w,_,S,I,k,E,j,P],D,O,N])=>{const F=voe(w),{align:X,behavior:L,offset:V}=F,K=I-1,U=moe(F,_,K);let Z=my(U,_.offsetTree,D)+E;X==="end"?(Z+=O+Zr(_.sizeTree,U)[1]-S+N,U===K&&(Z+=j)):X==="center"?Z+=(O+Zr(_.sizeTree,U)[1]-S+N)/2:Z-=k,V&&(Z+=V);const W=R=>{x(),R?(P("retrying to scroll to",{location:w},Wo.DEBUG),Gt(f,w)):(Gt(g,!0),P("list did not change, scroll successful",{},Wo.DEBUG))};if(x(),L==="smooth"){let R=!1;y=Rn(t,G=>{R=R||G}),b=Yl(u,()=>{W(R)})}else b=Yl(Te(t,kUe(150)),W);return C=setTimeout(()=>{x()},1200),Gt(c,!0),P("scrolling from index to",{behavior:L,index:U,top:Z},Wo.DEBUG),{behavior:L,top:Z}})),d),{scrollTargetReached:g,scrollToIndex:f,topListHeight:v}},as(cc,Mo,ku),{singleton:!0});function kUe(e){return t=>{const n=setTimeout(()=>{t(!1)},e);return s=>{s&&(t(!0),clearTimeout(n))}}}function f3(e,t){e==0?t():requestAnimationFrame(()=>{f3(e-1,t)})}function m3(e,t){const n=t-1;return typeof e=="number"?e:e.index==="LAST"?n:e.index}const K1=En(([{defaultItemSize:e,listRefresh:t,sizes:n},{scrollTop:s},{scrollTargetReached:i,scrollToIndex:o},{didMount:r}])=>{const l=Fe(!0),c=Fe(0),d=Fe(!0);return gt(Te(r,qt(c),Lt(([u,p])=>!!p),Cl(!1)),l),gt(Te(r,qt(c),Lt(([u,p])=>!!p),Cl(!1)),d),Rn(Te(ei(t,r),qt(l,n,e,d),Lt(([[,u],p,{sizeTree:m},f,g])=>u&&(!Un(m)||c3(f))&&!p&&!g),qt(c)),([,u])=>{Yl(i,()=>{Gt(d,!0)}),f3(4,()=>{Yl(s,()=>{Gt(l,!0)}),Gt(o,u)})}),{initialItemFinalLocationReached:d,initialTopMostItemIndex:c,scrolledToInitialItem:l}},as(cc,Mo,q1,Iu),{singleton:!0});function yoe(e,t){return Math.abs(e-t)<1.01}const gy="up",vv="down",IUe="none",jUe={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollHeight:0,scrollTop:0,viewportHeight:0}},EUe=0,Z1=En(([{footerHeight:e,headerHeight:t,scrollBy:n,scrollContainerState:s,scrollTop:i,viewportHeight:o}])=>{const r=Fe(!1),l=Fe(!0),c=pn(),d=pn(),u=Fe(4),p=Fe(EUe),m=Zi(Te(Cz(Te(Rt(i),Hf(1),Cl(!0)),Te(Rt(i),Hf(1),Cl(!1),xz(100))),ns()),!1),f=Zi(Te(Cz(Te(n,Cl(!0)),Te(n,Cl(!1),xz(200))),ns()),!1);gt(Te(ei(Rt(i),Rt(p)),nt(([y,x])=>y<=x),ns()),l),gt(Te(l,Od(50)),d);const g=_a(Te(ei(s,Rt(o),Rt(t),Rt(e),Rt(u)),Tl((y,[{scrollHeight:x,scrollTop:w},_,S,I,k])=>{const E=w+_-x>-k,j={scrollHeight:x,scrollTop:w,viewportHeight:_};if(E){let D,O;return w>y.state.scrollTop?(D="SCROLLED_DOWN",O=y.state.scrollTop-w):(D="SIZE_DECREASED",O=y.state.scrollTop-w||y.scrollTopDelta),{atBottom:!0,atBottomBecause:D,scrollTopDelta:O,state:j}}let P;return j.scrollHeight>y.state.scrollHeight?P="SIZE_INCREASED":_<y.state.viewportHeight?P="VIEWPORT_HEIGHT_DECREASING":w<y.state.scrollTop?P="SCROLLING_UPWARDS":P="NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:P,state:j}},jUe),ns((y,x)=>y&&y.atBottom===x.atBottom))),v=Zi(Te(s,Tl((y,{scrollHeight:x,scrollTop:w,viewportHeight:_})=>{if(yoe(y.scrollHeight,x))return{changed:!1,jump:0,scrollHeight:x,scrollTop:w};{const S=x-(w+_)<1;return y.scrollTop!==w&&S?{changed:!0,jump:y.scrollTop-w,scrollHeight:x,scrollTop:w}:{changed:!0,jump:0,scrollHeight:x,scrollTop:w}}},{changed:!1,jump:0,scrollHeight:0,scrollTop:0}),Lt(y=>y.changed),nt(y=>y.jump)),0);gt(Te(g,nt(y=>y.atBottom)),r),gt(Te(r,Od(50)),c);const b=Fe(vv);gt(Te(s,nt(({scrollTop:y})=>y),ns(),Tl((y,x)=>pi(f)?{direction:y.direction,prevScrollTop:x}:{direction:x<y.prevScrollTop?gy:vv,prevScrollTop:x},{direction:vv,prevScrollTop:0}),nt(y=>y.direction)),b),gt(Te(s,Od(50),Cl(IUe)),b);const C=Fe(0);return gt(Te(m,Lt(y=>!y),Cl(0)),C),gt(Te(i,Od(100),qt(m),Lt(([y,x])=>!!x),Tl(([y,x],[w])=>[x,w],[0,0]),nt(([y,x])=>x-y)),C),{atBottomState:g,atBottomStateChange:c,atBottomThreshold:u,atTopStateChange:d,atTopThreshold:p,isAtBottom:r,isAtTop:l,isScrolling:m,lastJumpDueToItemResize:v,scrollDirection:b,scrollVelocity:C}},as(Mo)),YC="top",QC="bottom",kz="none";function Iz(e,t,n){return typeof e=="number"?n===gy&&t===YC||n===vv&&t===QC?e:0:n===gy?t===YC?e.main:e.reverse:t===QC?e.main:e.reverse}function jz(e,t){var n;return typeof e=="number"?e:(n=e[t])!=null?n:0}const g3=En(([{deviation:e,fixedHeaderHeight:t,headerHeight:n,scrollTop:s,viewportHeight:i}])=>{const o=pn(),r=Fe(0),l=Fe(0),c=Fe(0),d=Zi(Te(ei(Rt(s),Rt(i),Rt(n),Rt(o,fy),Rt(c),Rt(r),Rt(t),Rt(e),Rt(l)),nt(([u,p,m,[f,g],v,b,C,y,x])=>{const w=u-y,_=b+C,S=Math.max(m-w,0);let I=kz;const k=jz(x,YC),E=jz(x,QC);return f-=y,f+=m+C,g+=m+C,g-=y,f>u+_-k&&(I=gy),g<u-S+p+E&&(I=vv),I!==kz?[Math.max(w-m-Iz(v,YC,I)-k,0),w-S-C+p+Iz(v,QC,I)+E]:null}),Lt(u=>u!=null),ns(fy)),[0,0]);return{increaseViewportBy:l,listBoundary:o,overscan:c,topListHeight:r,visibleRange:d}},as(Mo),{singleton:!0});function AUe(e,t,n){if(YS(t)){const s=foe(e,t);return[{index:Zr(t.groupOffsetTree,s)[0],offset:0,size:0},{data:n?.[0],index:s,offset:0,size:0}]}return[{data:n?.[0],index:e,offset:0,size:0}]}const DE={bottom:0,firstItemIndex:0,items:[],offsetBottom:0,offsetTop:0,top:0,topItems:[],topListHeight:0,totalCount:0};function E2(e,t,n,s,i,o){const{lastIndex:r,lastOffset:l,lastSize:c}=i;let d=0,u=0;if(e.length>0){d=e[0].offset;const v=e[e.length-1];u=v.offset+v.size}const p=n-r,m=l+p*c+(p-1)*s,f=d,g=m-u;return{bottom:u,firstItemIndex:o,items:Ez(e,i,o),offsetBottom:g,offsetTop:d,top:f,topItems:Ez(t,i,o),topListHeight:t.reduce((v,b)=>b.size+v,0),totalCount:n}}function boe(e,t,n,s,i,o){let r=0;if(n.groupIndices.length>0)for(const u of n.groupIndices){if(u-r>=e)break;r++}const l=e+r,c=m3(t,l),d=Array.from({length:l}).map((u,p)=>({data:o[p+c],index:p+c,offset:0,size:0}));return E2(d,[],l,i,n,s)}function Ez(e,t,n){if(e.length===0)return[];if(!YS(t))return e.map(d=>({...d,index:d.index+n,originalIndex:d.index}));const s=e[0].index,i=e[e.length-1].index,o=[],r=XS(t.groupOffsetTree,s,i);let l,c=0;for(const d of e){(!l||l.end<d.index)&&(l=r.shift(),c=t.groupIndices.indexOf(l.start));let u;d.index===l.start?u={index:c,type:"group"}:u={groupIndex:c,index:d.index-(c+1)+n},o.push({...u,data:d.data,offset:d.offset,originalIndex:d.index,size:d.size})}return o}const tp=En(([{data:e,firstItemIndex:t,gap:n,sizes:s,totalCount:i},o,{listBoundary:r,topListHeight:l,visibleRange:c},{initialTopMostItemIndex:d,scrolledToInitialItem:u},{topListHeight:p},m,{didMount:f},{recalcInProgress:g}])=>{const v=Fe([]),b=Fe(0),C=pn();gt(o.topItemsIndexes,v);const y=Zi(Te(ei(f,g,Rt(c,fy),Rt(i),Rt(s),Rt(d),u,Rt(v),Rt(t),Rt(n),e),Lt(([S,I,,k,,,,,,,E])=>{const j=E&&E.length!==k;return S&&!I&&!j}),nt(([,,[S,I],k,E,j,P,D,O,N,F])=>{const X=E,{offsetTree:L,sizeTree:V}=X,K=pi(b);if(k===0)return{...DE,totalCount:k};if(S===0&&I===0)return K===0?{...DE,totalCount:k}:boe(K,j,E,O,N,F||[]);if(Un(V))return K>0?null:E2(AUe(m3(j,k),X,F),[],k,N,X,O);const U=[];if(D.length>0){const H=D[0],$=D[D.length-1];let z=0;for(const B of XS(V,H,$)){const Y=B.value,ie=Math.max(B.start,H),ge=Math.min(B.end,$);for(let xe=ie;xe<=ge;xe++)U.push({data:F?.[xe],index:xe,offset:z,size:Y}),z+=Y}}if(!P)return E2([],U,k,N,X,O);const Z=D.length>0?D[D.length-1]+1:0,W=vUe(L,S,I,Z);if(W.length===0)return null;const R=k-1,G=ZS([],H=>{for(const $ of W){const z=$.value;let B=z.offset,Y=$.start;const ie=z.size;if(z.offset<S){Y+=Math.floor((S-z.offset+N)/(ie+N));const xe=Y-$.start;B+=xe*ie+xe*N}Y<Z&&(B+=(Z-Y)*ie,Y=Z);const ge=Math.min($.end,R);for(let xe=Y;xe<=ge&&!(B>=I);xe++)H.push({data:F?.[xe],index:xe,offset:B,size:ie}),B+=ie+N}});return E2(G,U,k,N,X,O)}),Lt(S=>S!==null),ns()),DE);gt(Te(e,Lt(c3),nt(S=>S?.length)),i),gt(Te(y,nt(S=>S.topListHeight)),p),gt(p,l),gt(Te(y,nt(S=>[S.top,S.bottom])),r),gt(Te(y,nt(S=>S.items)),C);const x=_a(Te(y,Lt(({items:S})=>S.length>0),qt(i,e),Lt(([{items:S},I])=>S[S.length-1].originalIndex===I-1),nt(([,S,I])=>[S-1,I]),ns(fy),nt(([S])=>S))),w=_a(Te(y,Od(200),Lt(({items:S,topItems:I})=>S.length>0&&S[0].originalIndex===I.length),nt(({items:S})=>S[0].index),ns())),_=_a(Te(y,Lt(({items:S})=>S.length>0),nt(({items:S})=>{let I=0,k=S.length-1;for(;S[I].type==="group"&&I<k;)I++;for(;S[k].type==="group"&&k>I;)k--;return{endIndex:S[k].index,startIndex:S[I].index}}),ns(hoe)));return{endReached:x,initialItemCount:b,itemsRendered:C,listState:y,rangeChanged:_,startReached:w,topItemsIndexes:v,...m}},as(cc,goe,g3,K1,q1,Z1,Iu,h3),{singleton:!0}),xoe=En(([{fixedFooterHeight:e,fixedHeaderHeight:t,footerHeight:n,headerHeight:s},{listState:i}])=>{const o=pn(),r=Zi(Te(ei(n,e,s,t,i),nt(([l,c,d,u,p])=>l+c+d+u+p.offsetBottom+p.bottom)),0);return gt(Rt(r),o),{totalListHeight:r,totalListHeightChanged:o}},as(Mo,tp),{singleton:!0}),PUe=En(([{viewportHeight:e},{totalListHeight:t}])=>{const n=Fe(!1),s=Zi(Te(ei(n,e,t),Lt(([i])=>i),nt(([,i,o])=>Math.max(0,i-o)),Od(0),ns()),0);return{alignToBottom:n,paddingTopAddition:s}},as(Mo,xoe),{singleton:!0});function Az(e){return e?e==="smooth"?"smooth":"auto":!1}const TUe=(e,t)=>typeof e=="function"?Az(e(t)):t&&Az(e),DUe=En(([{listRefresh:e,totalCount:t,fixedItemSize:n},{atBottomState:s,isAtBottom:i},{scrollToIndex:o},{scrolledToInitialItem:r},{didMount:l,propsReady:c},{log:d},{scrollingInProgress:u}])=>{const p=Fe(!1),m=pn();let f=null;function g(b){Gt(o,{align:"end",behavior:b,index:"LAST"})}Rn(Te(ei(Te(Rt(t),Hf(1)),l),qt(Rt(p),i,r,u),nt(([[b,C],y,x,w,_])=>{let S=C&&w,I="auto";return S&&(I=TUe(y,x||_),S=S&&!!I),{followOutputBehavior:I,shouldFollow:S,totalCount:b}}),Lt(({shouldFollow:b})=>b)),({followOutputBehavior:b,totalCount:C})=>{f&&(f(),f=null),pi(n)?requestAnimationFrame(()=>{pi(d)("following output to ",{totalCount:C},Wo.DEBUG),g(b)}):f=Yl(e,()=>{pi(d)("following output to ",{totalCount:C},Wo.DEBUG),g(b),f=null})});function v(b){const C=Yl(s,y=>{b&&!y.atBottom&&y.notAtBottomBecause==="SIZE_INCREASED"&&!f&&(pi(d)("scrolling to bottom due to increased size",{},Wo.DEBUG),g("auto"))});setTimeout(C,100)}return Rn(Te(ei(Rt(p),t,c),Lt(([b,,C])=>b&&C),Tl(({value:b},[,C])=>({refreshed:b===C,value:C}),{refreshed:!1,value:0}),Lt(({refreshed:b})=>b),qt(p,t)),([,b])=>{pi(r)&&v(b!==!1)}),Rn(m,()=>{v(pi(p)!==!1)}),Rn(ei(Rt(p),s),([b,C])=>{b&&!C.atBottom&&C.notAtBottomBecause==="VIEWPORT_HEIGHT_DECREASING"&&g("auto")}),{autoscrollToBottom:m,followOutput:p}},as(cc,Z1,q1,K1,Iu,ku,Mo)),MUe=En(([{data:e,firstItemIndex:t,gap:n,sizes:s},{initialTopMostItemIndex:i},{initialItemCount:o,listState:r},{didMount:l}])=>(gt(Te(l,qt(o),Lt(([,c])=>c!==0),qt(i,s,t,n,e),nt(([[,c],d,u,p,m,f=[]])=>boe(c,d,u,p,m,f))),r),{}),as(cc,K1,tp,Iu),{singleton:!0}),LUe=En(([{didMount:e},{scrollTo:t},{listState:n}])=>{const s=Fe(0);return Rn(Te(e,qt(s),Lt(([,i])=>i!==0),nt(([,i])=>({top:i}))),i=>{Yl(Te(n,Hf(1),Lt(o=>o.items.length>1)),()=>{requestAnimationFrame(()=>{Gt(t,i)})})}),{initialScrollTop:s}},as(Iu,Mo,tp),{singleton:!0}),RUe=({itemBottom:e,itemTop:t,locationParams:{align:n,behavior:s,...i},viewportBottom:o,viewportTop:r})=>t<r?{...i,align:n??"start",behavior:s}:e>o?{...i,align:n??"end",behavior:s}:null,OUe=En(([{gap:e,sizes:t,totalCount:n},{fixedFooterHeight:s,fixedHeaderHeight:i,headerHeight:o,scrollingInProgress:r,scrollTop:l,viewportHeight:c},{scrollToIndex:d}])=>{const u=pn();return gt(Te(u,qt(t,c,n,o,i,s,l),qt(e),nt(([[p,m,f,g,v,b,C,y],x])=>{const{align:w,behavior:_,calculateViewLocation:S=RUe,done:I,...k}=p,E=moe(p,m,g-1),j=my(E,m.offsetTree,x)+v+b,P=j+Zr(m.sizeTree,E)[1],D=y+b,O=y+f-C,N=S({itemBottom:P,itemTop:j,locationParams:{align:w,behavior:_,...k},viewportBottom:O,viewportTop:D});return N?I&&Yl(Te(r,Lt(F=>!F),Hf(pi(r)?1:2)),I):I&&I(),N}),Lt(p=>p!==null)),d),{scrollIntoView:u}},as(cc,Mo,q1,tp,ku),{singleton:!0}),Coe=En(([{scrollVelocity:e}])=>{const t=Fe(!1),n=pn(),s=Fe(!1);return gt(Te(e,qt(s,t,n),Lt(([i,o])=>!!o),nt(([i,o,r,l])=>{const{enter:c,exit:d}=o;if(r){if(d(i,l))return!1}else if(c(i,l))return!0;return r}),ns()),t),Rn(Te(ei(t,e,n),qt(s)),([[i,o,r],l])=>{i&&l&&l.change&&l.change(o,r)}),{isSeeking:t,scrollSeekConfiguration:s,scrollSeekRangeChanged:n,scrollVelocity:e}},as(Z1),{singleton:!0}),v3=En(([{scrollContainerState:e,scrollTo:t}])=>{const n=pn(),s=pn(),i=pn(),o=Fe(!1),r=Fe(void 0);return gt(Te(ei(n,s),nt(([{scrollHeight:l,scrollTop:c,viewportHeight:d},{offsetTop:u}])=>({scrollHeight:l,scrollTop:Math.max(0,c-u),viewportHeight:d}))),e),gt(Te(t,qt(s),nt(([l,{offsetTop:c}])=>({...l,top:l.top+c}))),i),{customScrollParent:r,useWindowScroll:o,windowScrollContainerState:n,windowScrollTo:i,windowViewportRect:s}},as(Mo)),NUe=En(([{sizeRanges:e,sizes:t},{headerHeight:n,scrollTop:s},{initialTopMostItemIndex:i},{didMount:o},{useWindowScroll:r,windowScrollContainerState:l,windowViewportRect:c}])=>{const d=pn(),u=Fe(void 0),p=Fe(null),m=Fe(null);return gt(l,p),gt(c,m),Rn(Te(d,qt(t,s,r,p,m,n)),([f,g,v,b,C,y,x])=>{const w=bUe(g.sizeTree);b&&C!==null&&y!==null&&(v=C.scrollTop-y.offsetTop),v-=x,f({ranges:w,scrollTop:v})}),gt(Te(u,Lt(c3),nt(FUe)),i),gt(Te(o,qt(u),Lt(([,f])=>f!==void 0),ns(),nt(([,f])=>f.ranges)),e),{getState:d,restoreStateFrom:u}},as(cc,Mo,K1,Iu,v3));function FUe(e){return{align:"start",index:0,offset:e.scrollTop}}const BUe=En(([{topItemsIndexes:e}])=>{const t=Fe(0);return gt(Te(t,Lt(n=>n>=0),nt(n=>Array.from({length:n}).map((s,i)=>i))),e),{topItemCount:t}},as(tp));function woe(e){let t=!1,n;return()=>(t||(t=!0,n=e()),n)}const zUe=woe(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),VUe=En(([{deviation:e,scrollBy:t,scrollingInProgress:n,scrollTop:s},{isAtBottom:i,isScrolling:o,lastJumpDueToItemResize:r,scrollDirection:l},{listState:c},{beforeUnshiftWith:d,gap:u,shiftWithOffset:p,sizes:m},{log:f},{recalcInProgress:g}])=>{const v=_a(Te(c,qt(r),Tl(([,C,y,x],[{bottom:w,items:_,offsetBottom:S,totalCount:I},k])=>{const E=w+S;let j=0;return y===I&&C.length>0&&_.length>0&&(_[0].originalIndex===0&&C[0].originalIndex===0||(j=E-x,j!==0&&(j+=k))),[j,_,I,E]},[0,[],0,0]),Lt(([C])=>C!==0),qt(s,l,n,i,f,g),Lt(([,C,y,x,,,w])=>!w&&!x&&C!==0&&y===gy),nt(([[C],,,,,y])=>(y("Upward scrolling compensation",{amount:C},Wo.DEBUG),C))));function b(C){C>0?(Gt(t,{behavior:"auto",top:-C}),Gt(e,0)):(Gt(e,0),Gt(t,{behavior:"auto",top:-C}))}return Rn(Te(v,qt(e,o)),([C,y,x])=>{x&&zUe()?Gt(e,y-C):b(-C)}),Rn(Te(ei(Zi(o,!1),e,g),Lt(([C,y,x])=>!C&&!x&&y!==0),nt(([C,y])=>y),Od(1)),b),gt(Te(p,nt(C=>({top:-C}))),t),Rn(Te(d,qt(m,u),nt(([C,{groupIndices:y,lastSize:x,sizeTree:w},_])=>{function S(I){return I*(x+_)}if(y.length===0)return S(C);{let I=0;const k=py(w,0);let E=0,j=0;for(;E<C;){E++,I+=k;let P=y.length===j+1?1/0:y[j+1]-y[j]-1;E+P>C&&(I-=k,P=C-E+1),E+=P,I+=S(P),j++}return I}})),C=>{Gt(e,C),requestAnimationFrame(()=>{Gt(t,{top:C}),requestAnimationFrame(()=>{Gt(e,0),Gt(g,!1)})})}),{deviation:e}},as(Mo,Z1,tp,cc,ku,h3)),$Ue=En(([e,t,n,s,i,o,r,l,c,d])=>({...e,...t,...n,...s,...i,...o,...r,...l,...c,...d}),as(g3,MUe,Iu,Coe,xoe,LUe,PUe,v3,OUe,ku)),_oe=En(([{data:e,defaultItemSize:t,firstItemIndex:n,fixedItemSize:s,gap:i,groupIndices:o,itemSize:r,sizeRanges:l,sizes:c,statefulTotalCount:d,totalCount:u,trackItemSizes:p},{initialItemFinalLocationReached:m,initialTopMostItemIndex:f,scrolledToInitialItem:g},v,b,C,{listState:y,topItemsIndexes:x,...w},{scrollToIndex:_},S,{topItemCount:I},{groupCounts:k},E])=>(gt(w.rangeChanged,E.scrollSeekRangeChanged),gt(Te(E.windowViewportRect,nt(j=>j.visibleHeight)),v.viewportHeight),{data:e,defaultItemHeight:t,firstItemIndex:n,fixedItemHeight:s,gap:i,groupCounts:k,initialItemFinalLocationReached:m,initialTopMostItemIndex:f,scrolledToInitialItem:g,sizeRanges:l,topItemCount:I,topItemsIndexes:x,totalCount:u,...C,groupIndices:o,itemSize:r,listState:y,scrollToIndex:_,statefulTotalCount:d,trackItemSizes:p,...w,...E,...v,sizes:c,...b}),as(cc,K1,Mo,NUe,DUe,tp,q1,VUe,BUe,goe,$Ue));function GUe(e,t){const n={},s={};let i=0;const o=e.length;for(;i<o;)s[e[i]]=1,i+=1;for(const r in t)Object.hasOwn(s,r)||(n[r]=t[r]);return n}const Mx=typeof document<"u"?ce.useLayoutEffect:ce.useEffect;function Soe(e,t,n){const s=Object.keys(t.required||{}),i=Object.keys(t.optional||{}),o=Object.keys(t.methods||{}),r=Object.keys(t.events||{}),l=ce.createContext({});function c(b,C){b.propsReady&&Gt(b.propsReady,!1);for(const y of s){const x=b[t.required[y]];Gt(x,C[y])}for(const y of i)if(y in C){const x=b[t.optional[y]];Gt(x,C[y])}b.propsReady&&Gt(b.propsReady,!0)}function d(b){return o.reduce((C,y)=>(C[y]=x=>{const w=b[t.methods[y]];Gt(w,x)},C),{})}function u(b){return r.reduce((C,y)=>(C[y]=iUe(b[t.events[y]]),C),{})}const p=ce.forwardRef((b,C)=>{const{children:y,...x}=b,[w]=ce.useState(()=>ZS(aUe(e),I=>{c(I,x)})),[_]=ce.useState(bz(u,w));Mx(()=>{for(const I of r)I in x&&Rn(_[I],x[I]);return()=>{Object.values(_).map(d3)}},[x,_,w]),Mx(()=>{c(w,x)}),ce.useImperativeHandle(C,yz(d(w)));const S=n;return a.jsx(l.Provider,{value:w,children:n?a.jsx(S,{...GUe([...s,...i,...r],x),children:y}):y})}),m=b=>{const C=ce.useContext(l);return ce.useCallback(y=>{Gt(C[b],y)},[C,b])},f=b=>{const C=ce.useContext(l)[b],y=ce.useCallback(x=>Rn(C,x),[C]);return ce.useSyncExternalStore(y,()=>pi(C),()=>pi(C))},g=b=>{const C=ce.useContext(l)[b],[y,x]=ce.useState(bz(pi,C));return Mx(()=>Rn(C,w=>{w!==y&&x(yz(w))}),[C,y]),y},v=ce.version.startsWith("18")?f:g;return{Component:p,useEmitter:(b,C)=>{const y=ce.useContext(l)[b];Mx(()=>Rn(y,C),[C,y])},useEmitterValue:v,usePublisher:m}}const koe=ce.createContext(void 0),Ioe=ce.createContext(void 0),joe=typeof document<"u"?ce.useLayoutEffect:ce.useEffect;function ME(e){return"self"in e}function HUe(e){return"body"in e}function Eoe(e,t,n,s=Ym,i,o){const r=ce.useRef(null),l=ce.useRef(null),c=ce.useRef(null),d=ce.useCallback(m=>{let f,g,v;const b=m.target;if(HUe(b)||ME(b)){const y=ME(b)?b:b.defaultView;v=o?y.scrollX:y.scrollY,f=o?y.document.documentElement.scrollWidth:y.document.documentElement.scrollHeight,g=o?y.innerWidth:y.innerHeight}else v=o?b.scrollLeft:b.scrollTop,f=o?b.scrollWidth:b.scrollHeight,g=o?b.offsetWidth:b.offsetHeight;const C=()=>{e({scrollHeight:f,scrollTop:Math.max(v,0),viewportHeight:g})};m.suppressFlushSync?C():HD.flushSync(C),l.current!==null&&(v===l.current||v<=0||v===f-g)&&(l.current=null,t(!0),c.current&&(clearTimeout(c.current),c.current=null))},[e,t,o]);ce.useEffect(()=>{const m=i||r.current;return s(i||r.current),d({suppressFlushSync:!0,target:m}),m.addEventListener("scroll",d,{passive:!0}),()=>{s(null),m.removeEventListener("scroll",d)}},[r,d,n,s,i]);function u(m){const f=r.current;if(!f||(o?"offsetWidth"in f&&f.offsetWidth===0:"offsetHeight"in f&&f.offsetHeight===0))return;const g=m.behavior==="smooth";let v,b,C;ME(f)?(b=Math.max(ou(f.document.documentElement,o?"width":"height"),o?f.document.documentElement.scrollWidth:f.document.documentElement.scrollHeight),v=o?f.innerWidth:f.innerHeight,C=o?window.scrollX:window.scrollY):(b=f[o?"scrollWidth":"scrollHeight"],v=ou(f,o?"width":"height"),C=f[o?"scrollLeft":"scrollTop"]);const y=b-v;if(m.top=Math.ceil(Math.max(Math.min(y,m.top),0)),yoe(v,b)||m.top===C){e({scrollHeight:b,scrollTop:C,viewportHeight:v}),g&&t(!0);return}g?(l.current=m.top,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{c.current=null,l.current=null,t(!0)},1e3)):l.current=null,o&&(m={behavior:m.behavior,left:m.top}),f.scrollTo(m)}function p(m){o&&(m={behavior:m.behavior,left:m.top}),r.current.scrollBy(m)}return{scrollByCallback:p,scrollerRef:r,scrollToCallback:u}}const LE="-webkit-sticky",Pz="sticky",y3=woe(()=>{if(typeof document>"u")return Pz;const e=document.createElement("div");return e.style.position=LE,e.style.position===LE?LE:Pz});function b3(e){return e}const WUe=En(()=>{const e=Fe(c=>`Item ${c}`),t=Fe(null),n=Fe(c=>`Group ${c}`),s=Fe({}),i=Fe(b3),o=Fe("div"),r=Fe(Ym),l=(c,d=null)=>Zi(Te(s,nt(u=>u[c]),ns()),d);return{components:s,computeItemKey:i,context:t,EmptyPlaceholder:l("EmptyPlaceholder"),FooterComponent:l("Footer"),GroupComponent:l("Group","div"),groupContent:n,HeaderComponent:l("Header"),HeaderFooterTag:o,ItemComponent:l("Item","div"),itemContent:e,ListComponent:l("List","div"),ScrollerComponent:l("Scroller","div"),scrollerRef:r,ScrollSeekPlaceholder:l("ScrollSeekPlaceholder"),TopItemListComponent:l("TopItemList")}}),UUe=En(([e,t])=>({...e,...t}),as(_oe,WUe)),qUe=({height:e})=>a.jsx("div",{style:{height:e}}),KUe={overflowAnchor:"none",position:y3(),zIndex:1},Aoe={overflowAnchor:"none"},ZUe={...Aoe,display:"inline-block",height:"100%"},Tz=ce.memo(function({showTopList:e=!1}){const t=Ot("listState"),n=Za("sizeRanges"),s=Ot("useWindowScroll"),i=Ot("customScrollParent"),o=Za("windowScrollContainerState"),r=Za("scrollContainerState"),l=i||s?o:r,c=Ot("itemContent"),d=Ot("context"),u=Ot("groupContent"),p=Ot("trackItemSizes"),m=Ot("itemSize"),f=Ot("log"),g=Za("gap"),v=Ot("horizontalDirection"),{callbackRef:b}=cUe(n,m,p,e?Ym:l,f,g,i,v,Ot("skipAnimationFrameInResizeObserver")),[C,y]=ce.useState(0);x3("deviation",N=>{C!==N&&y(N)});const x=Ot("EmptyPlaceholder"),w=Ot("ScrollSeekPlaceholder")||qUe,_=Ot("ListComponent"),S=Ot("ItemComponent"),I=Ot("GroupComponent"),k=Ot("computeItemKey"),E=Ot("isSeeking"),j=Ot("groupIndices").length>0,P=Ot("alignToBottom"),D=Ot("initialItemFinalLocationReached"),O=e?{}:{boxSizing:"border-box",...v?{display:"inline-block",height:"100%",marginLeft:C!==0?C:P?"auto":0,paddingLeft:t.offsetTop,paddingRight:t.offsetBottom,whiteSpace:"nowrap"}:{marginTop:C!==0?C:P?"auto":0,paddingBottom:t.offsetBottom,paddingTop:t.offsetTop},...D?{}:{visibility:"hidden"}};return!e&&t.totalCount===0&&x?a.jsx(x,{...Di(x,d)}):a.jsx(_,{...Di(_,d),"data-testid":e?"virtuoso-top-item-list":"virtuoso-item-list",ref:b,style:O,children:(e?t.topItems:t.items).map(N=>{const F=N.originalIndex,X=k(F+t.firstItemIndex,N.data,d);return E?h.createElement(w,{...Di(w,d),height:N.size,index:N.index,key:X,type:N.type||"item",...N.type==="group"?{}:{groupIndex:N.groupIndex}}):N.type==="group"?h.createElement(I,{...Di(I,d),"data-index":F,"data-item-index":N.index,"data-known-size":N.size,key:X,style:KUe},u(N.index,d)):h.createElement(S,{...Di(S,d),...JUe(S,N.data),"data-index":F,"data-item-group-index":N.groupIndex,"data-item-index":N.index,"data-known-size":N.size,key:X,style:v?ZUe:Aoe},j?c(N.index,N.groupIndex,N.data,d):c(N.index,N.data,d))})})}),XUe={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},YUe={outline:"none",overflowX:"auto",position:"relative"},QS=e=>({height:"100%",position:"absolute",top:0,width:"100%",...e?{display:"flex",flexDirection:"column"}:{}}),QUe={position:y3(),top:0,width:"100%",zIndex:1};function Di(e,t){if(typeof e!="string")return{context:t}}function JUe(e,t){return{item:typeof e=="string"?void 0:t}}const eqe=ce.memo(function(){const e=Ot("HeaderComponent"),t=Za("headerHeight"),n=Ot("HeaderFooterTag"),s=ep(ce.useMemo(()=>o=>{t(ou(o,"height"))},[t]),!0,Ot("skipAnimationFrameInResizeObserver")),i=Ot("context");return e?a.jsx(n,{ref:s,children:a.jsx(e,{...Di(e,i)})}):null}),tqe=ce.memo(function(){const e=Ot("FooterComponent"),t=Za("footerHeight"),n=Ot("HeaderFooterTag"),s=ep(ce.useMemo(()=>o=>{t(ou(o,"height"))},[t]),!0,Ot("skipAnimationFrameInResizeObserver")),i=Ot("context");return e?a.jsx(n,{ref:s,children:a.jsx(e,{...Di(e,i)})}):null});function Poe({useEmitter:e,useEmitterValue:t,usePublisher:n}){return ce.memo(function({children:s,style:i,...o}){const r=n("scrollContainerState"),l=t("ScrollerComponent"),c=n("smoothScrollTargetReached"),d=t("scrollerRef"),u=t("context"),p=t("horizontalDirection")||!1,{scrollByCallback:m,scrollerRef:f,scrollToCallback:g}=Eoe(r,c,l,d,void 0,p);return e("scrollTo",g),e("scrollBy",m),a.jsx(l,{"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,ref:f,style:{...p?YUe:XUe,...i},tabIndex:0,...o,...Di(l,u),children:s})})}function Toe({useEmitter:e,useEmitterValue:t,usePublisher:n}){return ce.memo(function({children:s,style:i,...o}){const r=n("windowScrollContainerState"),l=t("ScrollerComponent"),c=n("smoothScrollTargetReached"),d=t("totalListHeight"),u=t("deviation"),p=t("customScrollParent"),m=t("context"),f=ce.useRef(null),g=t("scrollerRef"),{scrollByCallback:v,scrollerRef:b,scrollToCallback:C}=Eoe(r,c,l,g,p);return joe(()=>{var y;return b.current=p||((y=f.current)==null?void 0:y.ownerDocument.defaultView),()=>{b.current=null}},[b,p]),e("windowScrollTo",C),e("scrollBy",v),a.jsx(l,{ref:f,"data-virtuoso-scroller":!0,style:{position:"relative",...i,...d!==0?{height:d+u}:{}},...o,...Di(l,m),children:s})})}const nqe=({children:e})=>{const t=ce.useContext(koe),n=Za("viewportHeight"),s=Za("fixedItemHeight"),i=Ot("alignToBottom"),o=Ot("horizontalDirection"),r=ce.useMemo(()=>ioe(n,c=>ou(c,o?"width":"height")),[n,o]),l=ep(r,!0,Ot("skipAnimationFrameInResizeObserver"));return ce.useEffect(()=>{t&&(n(t.viewportHeight),s(t.itemHeight))},[t,n,s]),a.jsx("div",{"data-viewport-type":"element",ref:l,style:QS(i),children:e})},sqe=({children:e})=>{const t=ce.useContext(koe),n=Za("windowViewportRect"),s=Za("fixedItemHeight"),i=Ot("customScrollParent"),o=aoe(n,i,Ot("skipAnimationFrameInResizeObserver")),r=Ot("alignToBottom");return ce.useEffect(()=>{t&&(s(t.itemHeight),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:100}))},[t,n,s]),a.jsx("div",{"data-viewport-type":"window",ref:o,style:QS(r),children:e})},iqe=({children:e})=>{const t=Ot("TopItemListComponent")||"div",n=Ot("headerHeight"),s={...QUe,marginTop:`${n}px`},i=Ot("context");return a.jsx(t,{style:s,...Di(t,i),children:e})},oqe=ce.memo(function(e){const t=Ot("useWindowScroll"),n=Ot("topItemsIndexes").length>0,s=Ot("customScrollParent"),i=Ot("context"),o=s||t?lqe:rqe,r=s||t?sqe:nqe;return a.jsxs(o,{...e,...Di(o,i),children:[n&&a.jsx(iqe,{children:a.jsx(Tz,{showTopList:!0})}),a.jsxs(r,{children:[a.jsx(eqe,{}),a.jsx(Tz,{}),a.jsx(tqe,{})]})]})}),{Component:aqe,useEmitter:x3,useEmitterValue:Ot,usePublisher:Za}=Soe(UUe,{required:{},optional:{restoreStateFrom:"restoreStateFrom",context:"context",followOutput:"followOutput",itemContent:"itemContent",groupContent:"groupContent",overscan:"overscan",increaseViewportBy:"increaseViewportBy",totalCount:"totalCount",groupCounts:"groupCounts",topItemCount:"topItemCount",firstItemIndex:"firstItemIndex",initialTopMostItemIndex:"initialTopMostItemIndex",components:"components",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",computeItemKey:"computeItemKey",defaultItemHeight:"defaultItemHeight",fixedItemHeight:"fixedItemHeight",itemSize:"itemSize",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"HeaderFooterTag",data:"data",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",alignToBottom:"alignToBottom",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",horizontalDirection:"horizontalDirection",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver"},methods:{scrollToIndex:"scrollToIndex",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollBy:"scrollBy",autoscrollToBottom:"autoscrollToBottom",getState:"getState"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",totalListHeightChanged:"totalListHeightChanged",itemsRendered:"itemsRendered",groupIndices:"groupIndices"}},oqe),rqe=Poe({useEmitter:x3,useEmitterValue:Ot,usePublisher:Za}),lqe=Toe({useEmitter:x3,useEmitterValue:Ot,usePublisher:Za}),Doe=aqe,cqe=En(()=>{const e=Fe(d=>a.jsxs("td",{children:["Item $",d]})),t=Fe(null),n=Fe(d=>a.jsxs("td",{colSpan:1e3,children:["Group ",d]})),s=Fe(null),i=Fe(null),o=Fe({}),r=Fe(b3),l=Fe(Ym),c=(d,u=null)=>Zi(Te(o,nt(p=>p[d]),ns()),u);return{components:o,computeItemKey:r,context:t,EmptyPlaceholder:c("EmptyPlaceholder"),FillerRow:c("FillerRow"),fixedFooterContent:i,fixedHeaderContent:s,itemContent:e,groupContent:n,ScrollerComponent:c("Scroller","div"),scrollerRef:l,ScrollSeekPlaceholder:c("ScrollSeekPlaceholder"),TableBodyComponent:c("TableBody","tbody"),TableComponent:c("Table","table"),TableFooterComponent:c("TableFoot","tfoot"),TableHeadComponent:c("TableHead","thead"),TableRowComponent:c("TableRow","tr"),GroupComponent:c("Group","tr")}});as(_oe,cqe);y3();const Dz={bottom:0,itemHeight:0,items:[],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},dqe={bottom:0,itemHeight:0,items:[{index:0}],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},{ceil:Mz,floor:JC,max:yv,min:RE,round:Lz}=Math;function Rz(e,t,n){return Array.from({length:t-e+1}).map((s,i)=>({data:n===null?null:n[i+e],index:i+e}))}function uqe(e){return{...dqe,items:e}}function Lx(e,t){return e&&e.width===t.width&&e.height===t.height}function hqe(e,t){return e&&e.column===t.column&&e.row===t.row}const pqe=En(([{increaseViewportBy:e,listBoundary:t,overscan:n,visibleRange:s},{footerHeight:i,headerHeight:o,scrollBy:r,scrollContainerState:l,scrollTo:c,scrollTop:d,smoothScrollTargetReached:u,viewportHeight:p},m,f,{didMount:g,propsReady:v},{customScrollParent:b,useWindowScroll:C,windowScrollContainerState:y,windowScrollTo:x,windowViewportRect:w},_])=>{const S=Fe(0),I=Fe(0),k=Fe(Dz),E=Fe({height:0,width:0}),j=Fe({height:0,width:0}),P=pn(),D=pn(),O=Fe(0),N=Fe(null),F=Fe({column:0,row:0}),X=pn(),L=pn(),V=Fe(!1),K=Fe(0),U=Fe(!0),Z=Fe(!1),W=Fe(!1);Rn(Te(g,qt(K),Lt(([B,Y])=>!!Y)),()=>{Gt(U,!1)}),Rn(Te(ei(g,U,j,E,K,Z),Lt(([B,Y,ie,ge,,xe])=>B&&!Y&&ie.height!==0&&ge.height!==0&&!xe)),([,,,,B])=>{Gt(Z,!0),f3(1,()=>{Gt(P,B)}),Yl(Te(d),()=>{Gt(t,[0,0]),Gt(U,!0)})}),gt(Te(L,Lt(B=>B!=null&&B.scrollTop>0),Cl(0)),I),Rn(Te(g,qt(L),Lt(([,B])=>B!=null)),([,B])=>{B&&(Gt(E,B.viewport),Gt(j,B.item),Gt(F,B.gap),B.scrollTop>0&&(Gt(V,!0),Yl(Te(d,Hf(1)),Y=>{Gt(V,!1)}),Gt(c,{top:B.scrollTop})))}),gt(Te(E,nt(({height:B})=>B)),p),gt(Te(ei(Rt(E,Lx),Rt(j,Lx),Rt(F,(B,Y)=>B&&B.column===Y.column&&B.row===Y.row),Rt(d)),nt(([B,Y,ie,ge])=>({gap:ie,item:Y,scrollTop:ge,viewport:B}))),X),gt(Te(ei(Rt(S),s,Rt(F,hqe),Rt(j,Lx),Rt(E,Lx),Rt(N),Rt(I),Rt(V),Rt(U),Rt(K)),Lt(([,,,,,,,B])=>!B),nt(([B,[Y,ie],ge,xe,we,je,Re,,Ct,Xe])=>{const{column:Qe,row:Dt}=ge,{height:se,width:re}=xe,{width:ue}=we;if(Re===0&&(B===0||ue===0))return Dz;if(re===0){const $t=m3(Xe,B),Ws=$t+Math.max(Re-1,0);return uqe(Rz($t,Ws,je))}const Se=Moe(ue,re,Qe);let de,me;Ct?Y===0&&ie===0&&Re>0?(de=0,me=Re-1):(de=Se*JC((Y+Dt)/(se+Dt)),me=Se*Mz((ie+Dt)/(se+Dt))-1,me=RE(B-1,yv(me,Se-1)),de=RE(me,yv(0,de))):(de=0,me=-1);const Ee=Rz(de,me,je),{bottom:tt,top:ut}=Oz(we,ge,xe,Ee),Yt=Mz(B/Se),gn=Yt*se+(Yt-1)*Dt-tt;return{bottom:tt,itemHeight:se,items:Ee,itemWidth:re,offsetBottom:gn,offsetTop:ut,top:ut}})),k),gt(Te(N,Lt(B=>B!==null),nt(B=>B.length)),S),gt(Te(ei(E,j,k,F),Lt(([B,Y,{items:ie}])=>ie.length>0&&Y.height!==0&&B.height!==0),nt(([B,Y,{items:ie},ge])=>{const{bottom:xe,top:we}=Oz(B,ge,Y,ie);return[we,xe]}),ns(fy)),t);const R=Fe(!1);gt(Te(d,qt(R),nt(([B,Y])=>Y||B!==0)),R);const G=_a(Te(ei(k,S),Lt(([{items:B}])=>B.length>0),qt(R),Lt(([[B,Y],ie])=>{const ge=B.items[B.items.length-1].index===Y-1;return(ie||B.bottom>0&&B.itemHeight>0&&B.offsetBottom===0&&B.items.length===Y)&&ge}),nt(([[,B]])=>B-1),ns())),H=_a(Te(Rt(k),Lt(({items:B})=>B.length>0&&B[0].index===0),Cl(0),ns())),$=_a(Te(Rt(k),qt(V),Lt(([{items:B},Y])=>B.length>0&&!Y),nt(([{items:B}])=>({endIndex:B[B.length-1].index,startIndex:B[0].index})),ns(hoe),Od(0)));gt($,f.scrollSeekRangeChanged),gt(Te(P,qt(E,j,S,F),nt(([B,Y,ie,ge,xe])=>{const we=voe(B),{align:je,behavior:Re,offset:Ct}=we;let Xe=we.index;Xe==="LAST"&&(Xe=ge-1),Xe=yv(0,Xe,RE(ge-1,Xe));let Qe=HT(Y,xe,ie,Xe);return je==="end"?Qe=Lz(Qe-Y.height+ie.height):je==="center"&&(Qe=Lz(Qe-Y.height/2+ie.height/2)),Ct&&(Qe+=Ct),{behavior:Re,top:Qe}})),c);const z=Zi(Te(k,nt(B=>B.offsetBottom+B.bottom)),0);return gt(Te(w,nt(B=>({height:B.visibleHeight,width:B.visibleWidth}))),E),{customScrollParent:b,data:N,deviation:O,footerHeight:i,gap:F,headerHeight:o,increaseViewportBy:e,initialItemCount:I,itemDimensions:j,overscan:n,restoreStateFrom:L,scrollBy:r,scrollContainerState:l,scrollHeight:D,scrollTo:c,scrollToIndex:P,scrollTop:d,smoothScrollTargetReached:u,totalCount:S,useWindowScroll:C,viewportDimensions:E,windowScrollContainerState:y,windowScrollTo:x,windowViewportRect:w,...f,gridState:k,horizontalDirection:W,initialTopMostItemIndex:K,totalListHeight:z,...m,endReached:G,propsReady:v,rangeChanged:$,startReached:H,stateChanged:X,stateRestoreInProgress:V,..._}},as(g3,Mo,Z1,Coe,Iu,v3,ku));function Moe(e,t,n){return yv(1,JC((e+n)/(JC(t)+n)))}function Oz(e,t,n,s){const{height:i}=n;if(i===void 0||s.length===0)return{bottom:0,top:0};const o=HT(e,t,n,s[0].index);return{bottom:HT(e,t,n,s[s.length-1].index)+i,top:o}}function HT(e,t,n,s){const i=Moe(e.width,n.width,t.column),o=JC(s/i),r=o*n.height+yv(0,o-1)*t.row;return r>0?r+t.row:r}const fqe=En(()=>{const e=Fe(p=>`Item ${p}`),t=Fe({}),n=Fe(null),s=Fe("virtuoso-grid-item"),i=Fe("virtuoso-grid-list"),o=Fe(b3),r=Fe("div"),l=Fe(Ym),c=(p,m=null)=>Zi(Te(t,nt(f=>f[p]),ns()),m),d=Fe(!1),u=Fe(!1);return gt(Rt(u),d),{components:t,computeItemKey:o,context:n,FooterComponent:c("Footer"),HeaderComponent:c("Header"),headerFooterTag:r,itemClassName:s,ItemComponent:c("Item","div"),itemContent:e,listClassName:i,ListComponent:c("List","div"),readyStateChanged:d,reportReadyState:u,ScrollerComponent:c("Scroller","div"),scrollerRef:l,ScrollSeekPlaceholder:c("ScrollSeekPlaceholder","div")}}),mqe=En(([e,t])=>({...e,...t}),as(pqe,fqe)),gqe=ce.memo(function(){const e=ls("gridState"),t=ls("listClassName"),n=ls("itemClassName"),s=ls("itemContent"),i=ls("computeItemKey"),o=ls("isSeeking"),r=Xa("scrollHeight"),l=ls("ItemComponent"),c=ls("ListComponent"),d=ls("ScrollSeekPlaceholder"),u=ls("context"),p=Xa("itemDimensions"),m=Xa("gap"),f=ls("log"),g=ls("stateRestoreInProgress"),v=Xa("reportReadyState"),b=ep(ce.useMemo(()=>C=>{const y=C.parentElement.parentElement.scrollHeight;r(y);const x=C.firstChild;if(x){const{height:w,width:_}=x.getBoundingClientRect();p({height:w,width:_})}m({column:Nz("column-gap",getComputedStyle(C).columnGap,f),row:Nz("row-gap",getComputedStyle(C).rowGap,f)})},[r,p,m,f]),!0,!1);return joe(()=>{e.itemHeight>0&&e.itemWidth>0&&v(!0)},[e]),g?null:a.jsx(c,{className:t,ref:b,...Di(c,u),"data-testid":"virtuoso-item-list",style:{paddingBottom:e.offsetBottom,paddingTop:e.offsetTop},children:e.items.map(C=>{const y=i(C.index,C.data,u);return o?a.jsx(d,{...Di(d,u),height:e.itemHeight,index:C.index,width:e.itemWidth},y):h.createElement(l,{...Di(l,u),className:n,"data-index":C.index,key:y},s(C.index,C.data,u))})})}),vqe=ce.memo(function(){const e=ls("HeaderComponent"),t=Xa("headerHeight"),n=ls("headerFooterTag"),s=ep(ce.useMemo(()=>o=>{t(ou(o,"height"))},[t]),!0,!1),i=ls("context");return e?a.jsx(n,{ref:s,children:a.jsx(e,{...Di(e,i)})}):null}),yqe=ce.memo(function(){const e=ls("FooterComponent"),t=Xa("footerHeight"),n=ls("headerFooterTag"),s=ep(ce.useMemo(()=>o=>{t(ou(o,"height"))},[t]),!0,!1),i=ls("context");return e?a.jsx(n,{ref:s,children:a.jsx(e,{...Di(e,i)})}):null}),bqe=({children:e})=>{const t=ce.useContext(Ioe),n=Xa("itemDimensions"),s=Xa("viewportDimensions"),i=ep(ce.useMemo(()=>o=>{s(o.getBoundingClientRect())},[s]),!0,!1);return ce.useEffect(()=>{t&&(s({height:t.viewportHeight,width:t.viewportWidth}),n({height:t.itemHeight,width:t.itemWidth}))},[t,s,n]),a.jsx("div",{ref:i,style:QS(!1),children:e})},xqe=({children:e})=>{const t=ce.useContext(Ioe),n=Xa("windowViewportRect"),s=Xa("itemDimensions"),i=ls("customScrollParent"),o=aoe(n,i,!1);return ce.useEffect(()=>{t&&(s({height:t.itemHeight,width:t.itemWidth}),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:t.viewportWidth}))},[t,n,s]),a.jsx("div",{ref:o,style:QS(!1),children:e})},Cqe=ce.memo(function({...e}){const t=ls("useWindowScroll"),n=ls("customScrollParent"),s=n||t?Sqe:_qe,i=n||t?xqe:bqe,o=ls("context");return a.jsx(s,{...e,...Di(s,o),children:a.jsxs(i,{children:[a.jsx(vqe,{}),a.jsx(gqe,{}),a.jsx(yqe,{})]})})}),{Component:wqe,useEmitter:Loe,useEmitterValue:ls,usePublisher:Xa}=Soe(mqe,{optional:{context:"context",totalCount:"totalCount",overscan:"overscan",itemContent:"itemContent",components:"components",computeItemKey:"computeItemKey",data:"data",initialItemCount:"initialItemCount",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"headerFooterTag",listClassName:"listClassName",itemClassName:"itemClassName",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",restoreStateFrom:"restoreStateFrom",initialTopMostItemIndex:"initialTopMostItemIndex",increaseViewportBy:"increaseViewportBy"},methods:{scrollTo:"scrollTo",scrollBy:"scrollBy",scrollToIndex:"scrollToIndex"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",stateChanged:"stateChanged",readyStateChanged:"readyStateChanged"}},Cqe),_qe=Poe({useEmitter:Loe,useEmitterValue:ls,usePublisher:Xa}),Sqe=Toe({useEmitter:Loe,useEmitterValue:ls,usePublisher:Xa});function Nz(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,Wo.WARN),t==="normal"?0:parseInt(t??"0",10)}const kqe=wqe,Iqe=(e,t)=>{if(!e||t.length===0)return 0;const n=t.findIndex(s=>s===e);return n>=0?n:0},jqe=e=>{const t=e.querySelector(".virtuoso-grid-list");if(!t)return 0;const n=t.querySelector(".virtuoso-grid-item");if(!n)return 0;const s=n.getBoundingClientRect(),i=t.getBoundingClientRect(),r=window.getComputedStyle(t).gap,l=parseFloat(r);if(isNaN(l)||!s.width||!s.height||!i.width||!i.height)return 0;let c=0,d=0;for(;d+s.width<=i.width+1;)c++,d+=s.width,d+l<=i.width&&(d+=l);return Math.max(1,c)},Roe=h.memo(({image_names:e})=>{const{t}=T();return a.jsxs(A,{w:qC,h:qC,alignItems:"center",justifyContent:"center",flexDir:"column",bg:"base.900",borderRadius:"base",children:[a.jsx(Pt,{children:e.length}),a.jsx(Pt,{size:"sm",children:t("parameters.images_withCount",{count:e.length})})]})});Roe.displayName="DndDragPreviewMultipleImage";const Eqe=e=>pu.createPortal(a.jsx(Roe,{image_names:e.image_names}),e.container),Aqe=({multipleImageDndData:e,onGenerateDragPreviewArgs:t,setDragPreviewState:n})=>{const{nativeSetDragImage:s,source:i,location:o}=t;oie({render({container:r}){return n({type:"multiple-image",container:r,image_names:e.payload.image_names}),()=>n(null)},nativeSetDragImage:s,getOffset:$ne({element:i.element,input:o.current.input})})},Ooe=h.memo(({imageDTO:e})=>{const t=Jr(),{t:n}=T(),s=Jf(),i=h.useCallback(o=>{o.stopPropagation(),s.delete([e.image_name])},[s,e]);return t?a.jsx(nr,{onClick:i,icon:a.jsx(Y4,{}),tooltip:n("gallery.deleteImage_one"),position:"absolute",bottom:2,insetInlineEnd:2}):null});Ooe.displayName="GalleryItemDeleteIconButton";const Noe=h.memo(({imageDTO:e})=>{const t=Q(),{t:n}=T(),s=h.useCallback(()=>{t($c(null)),t(Lv(e.image_name)),Ne.focusPanelInActiveTab(cs)},[t,e]);return a.jsx(nr,{onClick:s,icon:a.jsx(X_,{}),tooltip:n("gallery.openInViewer"),position:"absolute",insetBlockStart:2,insetInlineStart:2})});Noe.displayName="GalleryItemOpenInViewerIconButton";const Foe=h.memo(({imageDTO:e})=>a.jsx(q,{className:"gallery-image-size-badge",position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:1,left:1,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",pointerEvents:"none",children:`${e.width}x${e.height}`}));Foe.displayName="GalleryItemSizeBadge";const Boe=h.memo(({imageDTO:e})=>{const[t]=s_(),[n]=i_(),s=h.useCallback(()=>{e.starred?n({image_names:[e.image_name]}):t({image_names:[e.image_name]})},[t,n,e]);return a.jsx(nr,{onClick:s,icon:e.starred?a.jsx(sS,{}):a.jsx(eS,{}),tooltip:e.starred?"Unstar":"Star",position:"absolute",top:2,insetInlineEnd:2})});Boe.displayName="GalleryItemStarIconButton";const zoe=h.memo(({imageDTO:e,isHovered:t})=>{const n=M($xe);return a.jsxs(a.Fragment,{children:[(t||n)&&a.jsx(Foe,{imageDTO:e}),(t||e.starred)&&a.jsx(Boe,{imageDTO:e}),t&&a.jsx(Ooe,{imageDTO:e}),t&&a.jsx(Noe,{imageDTO:e})]})});zoe.displayName="GalleryItemHoverIcons";const Pqe={containerType:"inline-size",w:"full",h:"full",".gallery-image-size-badge":{"@container (max-width: 80px)":{"&":{display:"none"}}},"&[data-is-dragging=true]":{opacity:.3},userSelect:"none",webkitUserSelect:"none",position:"relative",justifyContent:"center",alignItems:"center",aspectRatio:"1/1","::before":{content:'""',display:"inline-block",position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",borderRadius:"base"},"&[data-selected=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-500), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},"&[data-selected-for-compare=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-300), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"},"&:hover::before":{boxShadow:"inset 0px 0px 0px 1px var(--invoke-colors-invokeBlue-300), inset 0px 0px 0px 2px var(--invoke-colors-invokeBlue-800)"},"&:hover[data-selected=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-400), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},"&:hover[data-selected-for-compare=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-200), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"}},Tqe=(e,t,n)=>s=>{const{shiftKey:i,ctrlKey:o,metaKey:r,altKey:l}=s,c=n(),d=rM(c),u=$r.endpoints.getImageNames.select(d)(c).data?.image_names??[];if(u.length===0){!i&&!o&&!r&&!l&&t(_l([e]));return}const p=c.gallery.selection;if(l)c.gallery.imageToCompare===e?t($c(null)):t($c(e));else if(i){const m=e,f=p.at(-1),g=u.findIndex(b=>b===f),v=u.findIndex(b=>b===m);if(g>-1&&v>-1){const b=Math.min(g,v),C=Math.max(g,v),y=u.slice(b,C+1);v<g&&y.reverse(),t(_l(Xk(p.concat(y))))}}else o||r?p.some(m=>m===e)&&p.length>1?t(_l(Xk(p.filter(m=>m!==e)))):t(_l(Xk(p.concat(e)))):t(_l([e]))},Dqe=e=>/\.(mp4|webm|mov)$/i.test(e),Mqe=e=>/\.(mp3|wav|ogg)$/i.test(e),Voe=h.memo(({imageDTO:e})=>{const t=Ze(),[n,s]=h.useState(!1),[i,o]=h.useState(null),r=h.useRef(null),l=h.useMemo(()=>ve(ir,y=>y.imageToCompare===e.image_name),[e.image_name]),c=M(l),d=h.useMemo(()=>ve(ir,y=>y.selection.some(x=>x===e.image_name)),[e.image_name]),u=M(d);h.useEffect(()=>{const y=r.current;if(y)return zi(Hm(y),wm({element:y,getInitialData:()=>{const x=YD(t.getState()),w=nm(t.getState());return x.length>1&&x.some(_=>_===e.image_name)?Rl.getData({image_names:x,board_id:w}):Ss.getData({imageDTO:e},e.image_name)},onDragStart:({source:x})=>{if(Ss.typeGuard(x.data)){s(!0);return}},onGenerateDragPreview:x=>{Rl.typeGuard(x.source.data)?Aqe({multipleImageDndData:x.source.data,onGenerateDragPreviewArgs:x,setDragPreviewState:o}):Ss.typeGuard(x.source.data)&&lie({singleImageDndData:x.source.data,onGenerateDragPreviewArgs:x,setDragPreviewState:o})}}),Gh({onDragStart:({source:x})=>{Rl.typeGuard(x.data)&&x.data.payload.image_names.includes(e.image_name)&&s(!0)},onDrop:()=>{s(!1)}}))},[e,t]);const[p,m]=h.useState(!1),f=h.useCallback(()=>{m(!0)},[]),g=h.useCallback(()=>{m(!1)},[]),v=h.useMemo(()=>Tqe(e.image_name,t.dispatch,t.getState),[e,t]),b=h.useCallback(()=>{t.dispatch($c(null)),Ne.focusPanelInActiveTab(cs)},[t]);QQ(e,r);let C;return Mqe(e.image_name)?C=a.jsx(A,{w:"full",h:"full",bg:"base.850",borderRadius:"base",alignItems:"center",justifyContent:"center",children:a.jsx(q,{fontSize:"xl",fontWeight:"bold",color:"base.500",children:"Audio"})}):C=a.jsxs(a.Fragment,{children:[a.jsx(Nn,{pointerEvents:"none",src:e.thumbnail_url,w:e.width,fallback:a.jsx(JS,{}),objectFit:"contain",maxW:"full",maxH:"full",borderRadius:"base"}),Dqe(e.image_name)&&a.jsx(A,{position:"absolute",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center",pointerEvents:"none",children:a.jsx(ke,{w:12,h:12,borderRadius:"full",bg:"whiteAlpha.600",display:"flex",alignItems:"center",justifyContent:"center",children:a.jsx(ke,{w:0,h:0,borderLeft:"12px solid white",borderTop:"8px solid transparent",borderBottom:"8px solid transparent",ml:1})})})]}),a.jsxs(a.Fragment,{children:[a.jsxs(A,{ref:r,sx:Pqe,"data-is-dragging":n,"data-item-id":e.image_name,role:"button",onMouseOver:f,onMouseOut:g,onClick:v,onDoubleClick:b,"data-selected":u,"data-selected-for-compare":c,children:[C,a.jsx(zoe,{imageDTO:e,isHovered:p})]}),i?.type==="multiple-image"?Eqe(i):null,i?.type==="single-image"?rie(i):null]})});Voe.displayName="GalleryImage";const JS=h.memo(e=>a.jsx(A,{w:"full",h:"full",bg:"base.850",borderRadius:"base",alignItems:"center",justifyContent:"center",...e,children:a.jsx(q,{children:"..."})}));JS.displayName="GalleryImagePlaceholder";const Lqe={refetchOnReconnect:!0,selectFromResult:({currentData:e,isLoading:t,isFetching:n})=>({imageNames:e?.image_names??os,isLoading:t,isFetching:n})},ek=()=>{const e=M(rM),[t]=el(e,300),{imageNames:n,isLoading:s,isFetching:i}=Gxe(t,Lqe);return{imageNames:n,isLoading:s,isFetching:i,queryArgs:t}},$oe=h.memo(()=>{const{dispatch:e}=Ze(),t=M(Oy),{imageNames:n}=ek(),s=So("gallery"),i=h.useCallback(()=>{e(_l(n))},[e,n]);return Be({id:"selectAllOnPage",category:"gallery",callback:i,options:{preventDefault:!0,enabled:s},dependencies:[i,s]}),t<=1?null:a.jsx(Goe,{})});$oe.displayName="GallerySelectionCountTag";const Goe=h.memo(()=>{const{t:e}=T(),t=Q(),n=So("gallery"),s=M(Hxe),i=M(Oy),o=h.useCallback(()=>{s&&t(_l([s]))},[t,s]);return Be({id:"clearSelection",category:"gallery",callback:o,options:{enabled:i>0&&n},dependencies:[o,i,n]}),a.jsxs(r_,{position:"absolute",bg:"invokeBlue.800",color:"base.50",py:2,px:4,userSelect:"none",shadow:"dark-lg",fontWeight:"semibold",border:1,borderStyle:"solid",borderColor:"whiteAlpha.300",children:[a.jsxs(jM,{children:[i," ",e("common.selected")]}),a.jsx(l_,{onClick:o})]})});Goe.displayName="GallerySelectionCountTagContent";const dd=Ft("gallery").child({filePath:"features/gallery/components/scrollIntoView.tsx"}),Rqe=(e,t,n,s,i)=>{if(i.endIndex===0){dd.trace("Not scrolling into view: Range endIdex is 0");return}const o=t.findIndex(d=>d===e);if(o===-1){dd.trace("Not scrolling into view: targetIndex is -1");return}const r=n.querySelector(`.virtuoso-grid-item:has([data-item-id="${e}"])`);if(!r){o>i.endIndex?(dd.trace({index:o,behavior:"auto",align:"start"},"Scrolling into view: not in DOM"),s.scrollToIndex({index:o,behavior:"auto",align:"start"})):o<i.startIndex?(dd.trace({index:o,behavior:"auto",align:"end"},"Scrolling into view: not in DOM"),s.scrollToIndex({index:o,behavior:"auto",align:"end"})):dd.debug(`Unable to find image ${e} at index ${o} but it is in the rendered range ${i.startIndex}-${i.endIndex}`);return}const l=r.getBoundingClientRect(),c=n.getBoundingClientRect();l.top<c.top?(dd.trace({index:o,behavior:"auto",align:"start"},"Scrolling into view: in overscan"),s.scrollToIndex({index:o,behavior:"auto",align:"start"})):l.bottom>c.bottom?(dd.trace({index:o,behavior:"auto",align:"end"},"Scrolling into view: in overscan"),s.scrollToIndex({index:o,behavior:"auto",align:"end"})):dd.debug("Not scrolling into view: Image is already in view")},Oqe=e=>{const[t,n]=h.useState(null),[s,i]=SS({defer:!0,events:{initialized(o){const{viewport:r}=o.elements();r.style.overflowX="var(--os-viewport-overflow-x)",r.style.overflowY="var(--os-viewport-overflow-y)"}},options:{scrollbars:{visibility:"auto",autoHide:"scroll",autoHideDelay:1300,theme:"os-theme-dark"}}});return h.useEffect(()=>{const{current:o}=e;return t&&o&&s({target:o,elements:{viewport:t}}),()=>{i()?.destroy()}},[t,s,i,e]),n},Hoe=h.memo(({imageName:e})=>{const{currentData:t,isUninitialized:n}=$r.endpoints.getImageDTO.useQueryState(e);return $r.endpoints.getImageDTO.useQuerySubscription(e,{skip:n}),t?a.jsx(Voe,{imageDTO:t}):a.jsx(JS,{"data-item-id":e})});Hoe.displayName="ImageAtPosition";const Nqe=(e,t,{queryArgs:n})=>`${JSON.stringify(n)}-${t??e}`,Fqe=(e,t,n)=>{const{dispatch:s,getState:i}=Ze(),o=h.useCallback(r=>{if(Yy()!=="gallery"||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(r.key)||r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement)return;const l=n.current,c=t.current;if(!l||!c||e.length===0)return;const d=jqe(l);if(d===0)return;r.preventDefault();const u=i(),p=r.altKey?JW(u)??or(u):or(u),m=Iqe(p??null,e);let f=m;switch(r.key){case"ArrowLeft":m>0&&(f=m-1);break;case"ArrowRight":m<e.length-1&&(f=m+1);break;case"ArrowUp":m<d?f=m:f=Math.max(0,m-d);break;case"ArrowDown":m>=e.length-d?f=m:f=Math.min(e.length-1,m+d);break}if(f!==m&&f>=0&&f<e.length){const g=e[f];g&&(r.altKey?s($c(g)):s(_l([g])))}},[n,t,e,i,s]);Be({id:"galleryNavLeft",category:"gallery",callback:o,options:{preventDefault:!0},dependencies:[o]}),Be({id:"galleryNavRight",category:"gallery",callback:o,options:{preventDefault:!0},dependencies:[o]}),Be({id:"galleryNavUp",category:"gallery",callback:o,options:{preventDefault:!0},dependencies:[o]}),Be({id:"galleryNavDown",category:"gallery",callback:o,options:{preventDefault:!0},dependencies:[o]}),Be({id:"galleryNavLeftAlt",category:"gallery",callback:o,options:{preventDefault:!0},dependencies:[o]}),Be({id:"galleryNavRightAlt",category:"gallery",callback:o,options:{preventDefault:!0},dependencies:[o]}),Be({id:"galleryNavUpAlt",category:"gallery",callback:o,options:{preventDefault:!0},dependencies:[o]}),Be({id:"galleryNavDownAlt",category:"gallery",callback:o,options:{preventDefault:!0},dependencies:[o]})},Bqe=(e,t,n,s)=>{const i=M(YD);h.useEffect(()=>{const o=i.at(-1),r=t.current,l=n.current,c=s.current;!r||!l||!o||!e||e.length===0||setTimeout(()=>{Rqe(o,e,l,r,c)},0)},[e,s,n,t,i])},zqe=()=>{const e=M(or),t=M(Oy),n=So("gallery"),s=Jd(e),[i]=s_(),[o]=i_(),r=h.useCallback(()=>{s&&n&&(s.starred?o({image_names:[s.image_name]}):i({image_names:[s.image_name]}))},[s,n,i,o]);Be({id:"starImage",category:"gallery",callback:r,options:{enabled:!!s&&t===1&&n},dependencies:[s,t,n,r]})},Woe=h.memo(()=>{const e=h.useRef(null),t=h.useRef({startIndex:0,endIndex:0}),n=h.useRef(null),{queryArgs:s,imageNames:i,isLoading:o}=ek(),{onRangeChanged:r}=QWe({imageNames:i,enabled:!o});zqe(),Bqe(i,e,n,t),Fqe(i,e,n);const l=Oqe(n),c=h.useCallback(u=>{t.current=u,r(u)},[r]),d=h.useMemo(()=>({imageNames:i,queryArgs:s}),[i,s]);return o?a.jsxs(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",gap:4,children:[a.jsx(ao,{size:"lg",opacity:.3}),a.jsx(q,{color:"base.300",children:"Loading gallery..."})]}):i.length===0?a.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:a.jsx(q,{color:"base.300",children:"No images found"})}):a.jsxs(ke,{"data-overlayscrollbars-initialize":"",ref:n,position:"relative",w:"full",h:"full",children:[a.jsx(kqe,{ref:e,context:d,data:i,increaseViewportBy:4096,itemContent:Hqe,computeItemKey:Nqe,components:Wqe,style:$qe,scrollerRef:l,scrollSeekConfiguration:Vqe,rangeChanged:c}),a.jsx($oe,{})]})});Woe.displayName="GalleryImageGrid";const Vqe={enter:e=>Math.abs(e)>2048,exit:e=>e===0},$qe={height:"100%",width:"100%"},Gqe=ve(eU,e=>`repeat(auto-fill, minmax(${e}px, 1fr))`),Uoe=rm(({context:e,...t},n)=>{const s=M(Gqe),[i]=el(s,300);return a.jsx(Ms,{ref:n,gridTemplateColumns:i,gap:1,...t})});Uoe.displayName="ListComponent";const Hqe=(e,t)=>a.jsx(Hoe,{index:e,imageName:t}),qoe=rm(({context:e,...t},n)=>a.jsx(_t,{ref:n,aspectRatio:"1/1",...t}));qoe.displayName="ItemComponent";const Koe=e=>a.jsx(_t,{aspectRatio:"1/1",...e,children:a.jsx(JS,{})});Koe.displayName="ScrollSeekPlaceholderComponent";const Wqe={Item:qoe,List:Uoe,ScrollSeekPlaceholder:Koe},Uqe=ve(ir,e=>e.alwaysShowImageSizeBadge),qqe=()=>{const e=Q(),{t}=T(),n=M(Uqe),s=h.useCallback(i=>e(Wxe(i.target.checked)),[e]);return a.jsxs(te,{children:[a.jsx(ne,{flexGrow:1,children:t("gallery.alwaysShowImageSizeBadge")}),a.jsx(us,{isChecked:n,onChange:s})]})},Kqe=h.memo(qqe),Zqe=ve(ir,e=>e.shouldAutoSwitch),Xqe=()=>{const e=Q(),{t}=T(),n=M(Zqe),s=h.useCallback(i=>{e(Uxe(i.target.checked))},[e]);return a.jsxs(te,{children:[a.jsx(ne,{flexGrow:1,children:t("gallery.autoSwitchNewImages")}),a.jsx(us,{isChecked:n,onChange:s})]})},Yqe=h.memo(Xqe),Qqe=()=>{const e=Q(),{t}=T(),n=M(eU),s=h.useCallback(i=>{e(qxe(i))},[e]);return a.jsxs(te,{children:[a.jsx(ne,{children:t("gallery.galleryImageSize")}),a.jsx(it,{value:n,onChange:s,min:45,max:256,defaultValue:90})]})},Jqe=h.memo(Qqe),eKe=ve(ir,e=>e.starredFirst),tKe=()=>{const e=Q(),{t}=T(),n=M(eKe),s=h.useCallback(i=>{e(Kxe(i.target.checked))},[e]);return a.jsxs(te,{w:"full",children:[a.jsx(ne,{flexGrow:1,m:0,children:t("gallery.showStarredImagesFirst")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})},nKe=h.memo(tKe),sKe=ve(ir,e=>e.orderDir),iKe=()=>{const e=Q(),{t}=T(),n=M(sKe),s=h.useMemo(()=>[{value:"DESC",label:t("gallery.newestFirst")},{value:"ASC",label:t("gallery.oldestFirst")}],[t]),i=h.useCallback(r=>{ae(r?.value==="ASC"||r?.value==="DESC"),e(Zxe(r.value))},[e]),o=h.useMemo(()=>s.find(r=>r.value===n),[n,s]);return a.jsxs(te,{children:[a.jsx(ne,{flexGrow:1,m:0,children:t("gallery.sortDirection")}),a.jsx(pt,{isSearchable:!1,value:o,options:s,onChange:i})]})},oKe=h.memo(iKe),Zoe=h.memo(()=>{const{t:e}=T();return a.jsxs(yi,{isLazy:!0,children:[a.jsx(Ni,{children:a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.imagesSettings"),icon:a.jsx(f1,{}),tooltip:e("gallery.imagesSettings")})}),a.jsx(Ls,{children:a.jsxs(bi,{children:[a.jsx(hr,{}),a.jsx(Fi,{children:a.jsxs(A,{direction:"column",gap:2,children:[a.jsx(q,{fontWeight:"semibold",color:"base.300",children:e("gallery.gallerySettings")}),a.jsx(vt,{}),a.jsx(Jqe,{}),a.jsx(Yqe,{}),a.jsx(Kqe,{}),a.jsx(vt,{}),a.jsx(nKe,{}),a.jsx(oKe,{})]})})]})})]})});Zoe.displayName="GallerySettingsPopover";const aKe={allowMultiple:!0},Xoe=h.memo(()=>{const e=Yo(aKe);return a.jsxs(a.Fragment,{children:[a.jsx(oe,{size:"sm",alignSelf:"stretch",variant:"link","aria-label":ye("accessibility.uploadImages"),tooltip:ye("accessibility.uploadImages"),icon:a.jsx(qo,{}),...e.getUploadButtonProps()}),a.jsx("input",{...e.getUploadInputProps()})]})});Xoe.displayName="GalleryUploadButton";const Yoe=h.memo(({searchTerm:e,onChangeSearchTerm:t,onResetSearchTerm:n})=>{const{t:s}=T(),{isFetching:i}=ek(),o=h.useCallback(l=>{t(l.target.value)},[t]),r=h.useCallback(l=>{l.key==="Escape"&&n()},[n]);return a.jsxs(tc,{children:[a.jsx(Nt,{placeholder:s("gallery.searchImages"),value:e,onChange:o,"data-testid":"image-search-input",onKeyDown:r}),i&&a.jsx(Hr,{h:"full",pe:2,children:a.jsx(ao,{size:"sm",opacity:.5})}),!i&&e.length&&a.jsx(Hr,{h:"full",pe:2,children:a.jsx(oe,{onClick:n,size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:a.jsx(fn,{})})})]})});Yoe.displayName="GallerySearch";const rKe={flexShrink:0,minHeight:0,width:"100%"},lKe=ve(ir,e=>e.galleryView),cKe=ve(ir,e=>e.searchTerm),X1=h.memo(()=>{const{t:e}=T(),t=Q(),{tab:n}=Qo(),s=n6(n),i=le(s.$isCollapsed),o=M(lKe),r=M(cKe),l=cS(!!r),[c,d,u]=XWe(),p=h.useCallback(()=>{t($A("images"))},[t]),m=h.useCallback(()=>{t($A("assets"))},[t]),f=h.useCallback(()=>{u(),!l.isOpen&&s.$isCollapsed.get()&&s.expand(),l.toggle()},[s,u,l]),g=M(nm),v=v1(g);return a.jsxs(A,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",h:"full",w:"full",minH:0,children:[a.jsxs(A,{gap:2,fontSize:"sm",alignItems:"center",w:"full",children:[a.jsx(he,{size:"sm",variant:"ghost",onClick:s.toggle,leftIcon:i?a.jsx(Do,{}):a.jsx(B4,{}),noOfLines:1,children:v}),a.jsx(At,{}),a.jsxs(zn,{size:"sm",variant:"outline",children:[a.jsx(he,{tooltip:e("gallery.imagesTab"),onClick:p,"data-testid":"images-tab",colorScheme:o==="images"?"invokeBlue":void 0,children:e("parameters.images")}),a.jsx(he,{tooltip:e("gallery.assetsTab"),onClick:m,"data-testid":"assets-tab",colorScheme:o==="assets"?"invokeBlue":void 0,children:e("gallery.assets")})]}),a.jsxs(A,{flexGrow:1,flexBasis:0,justifyContent:"flex-end",children:[a.jsx(Xoe,{}),a.jsx(Zoe,{}),a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",onClick:f,tooltip:l.isOpen?`${e("gallery.exitSearch")}`:`${e("gallery.displaySearch")}`,"aria-label":e("gallery.displaySearch"),icon:a.jsx(dX,{})})]})]}),a.jsx(mu,{in:l.isOpen,style:rKe,children:a.jsx(ke,{w:"full",pt:2,children:a.jsx(Yoe,{searchTerm:c,onChangeSearchTerm:d,onResetSearchTerm:u})})}),a.jsx(vt,{pt:2}),a.jsx(A,{w:"full",h:"full",pt:2,children:a.jsx(Woe,{})})]})});X1.displayName="GalleryPanel";const Qoe=h.createContext(null),Fz=Ft("events").child({filePath:"features/gallery/components/ImageViewer/context.tsx"}),Joe=h.memo(e=>{const t=le(E_),n=M(CH),s=h.useState(()=>De(null))[0],i=h.useState(()=>De(null))[0],o=h.useState(()=>Ut(i,d=>d!==null))[0],[r]=h.useState(()=>new jc({max:200}));h.useEffect(()=>{if(!t)return;const d=u=>{if(r.has(u.item_id)){Fz.trace({data:u},`Received InvocationProgressEvent event for already-finished queue item ${u.item_id}`);return}s.set(u),u.image&&i.set(u.image)};return t.on("invocation_progress",d),()=>{t.off("invocation_progress",d)}},[s,i,r,t]),h.useEffect(()=>{if(!t)return;const d=u=>{if(r.has(u.item_id)){Fz.trace({data:u},`Received QueueItemStatusChangedEvent event for already-finished queue item ${u.item_id}`);return}(u.status==="completed"||u.status==="canceled"||u.status==="failed")&&(r.set(u.item_id,!0),(u.status==="canceled"||u.status==="failed"||!n||u.origin==="canvas"&&u.destination!=="canvas")&&(s.set(null),i.set(null)))};return t.on("queue_item_status_changed",d),()=>{t.off("queue_item_status_changed",d)}},[s,i,n,r,t]);const l=h.useCallback(()=>{s.set(null),i.set(null)},[s,i]),c=h.useMemo(()=>({$progressEvent:s,$progressImage:i,$hasProgressImage:o,onLoadImage:l}),[o,s,i,l]);return a.jsx(Qoe.Provider,{value:c,children:e.children})});Joe.displayName="ImageViewerContextProvider";const eae=()=>{const e=h.useContext(Qoe);return ae(e!==null,"useImageViewerContext must be used within a ImageViewerContextProvider"),e},tae=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(tU),s=M(EM),i=h.useCallback(()=>{t(Yk("slider"))},[t]),o=h.useCallback(()=>{t(Yk("side-by-side"))},[t]),r=h.useCallback(()=>{t(Yk("hover"))},[t]),l=h.useCallback(()=>{t(Xxe())},[t]);Be({id:"swapImages",category:"viewer",callback:l,dependencies:[l]});const c=h.useCallback(()=>{t(Yxe(s==="contain"?"fill":"contain"))},[t,s]),d=h.useCallback(()=>{t($c(null))},[t]);Ul("esc",d,[d]);const u=h.useCallback(()=>{t(Qxe())},[t]);return Be({id:"nextComparisonMode",category:"viewer",callback:u,dependencies:[u]}),a.jsxs(A,{w:"full",justifyContent:"center",h:8,children:[a.jsx(A,{flex:1,justifyContent:"center",children:a.jsxs(A,{marginInlineEnd:"auto",alignItems:"center",children:[a.jsx(oe,{icon:a.jsx(JZ,{}),"aria-label":`${e("gallery.swapImages")} (C)`,tooltip:`${e("gallery.swapImages")} (C)`,onClick:l,variant:"link",alignSelf:"stretch"}),n!=="side-by-side"&&a.jsx(oe,{"aria-label":e("gallery.stretchToFit"),tooltip:e("gallery.stretchToFit"),onClick:c,colorScheme:s==="fill"?"invokeBlue":"base",variant:"link",alignSelf:"stretch",icon:a.jsx(X_,{})})]})}),a.jsx(A,{flex:1,justifyContent:"center",children:a.jsxs(zn,{size:"sm",variant:"outline",alignItems:"center",children:[a.jsx(he,{flexShrink:0,onClick:i,colorScheme:n==="slider"?"invokeBlue":"base",children:e("gallery.slider")}),a.jsx(he,{flexShrink:0,onClick:o,colorScheme:n==="side-by-side"?"invokeBlue":"base",children:e("gallery.sideBySide")}),a.jsx(he,{flexShrink:0,onClick:r,colorScheme:n==="hover"?"invokeBlue":"base",children:e("gallery.hover")})]})}),a.jsx(A,{flex:1,justifyContent:"center",children:a.jsxs(A,{gap:2,marginInlineStart:"auto",alignItems:"center",children:[a.jsx(He,{label:a.jsx(dKe,{}),children:a.jsx(A,{alignItems:"center",children:a.jsx(Je,{boxSize:6,color:"base.300",as:HMe,lineHeight:0})})}),a.jsx(he,{size:"sm",variant:"link",alignSelf:"stretch",px:2,"aria-label":`${e("gallery.exitCompare")} (Esc)`,tooltip:`${e("gallery.exitCompare")} (Esc)`,onClick:d,children:e("gallery.exitCompare")})]})})]})});tae.displayName="CompareToolbar";const dKe=()=>a.jsxs(Li,{children:[a.jsx(rn,{children:a.jsx(Bn,{i18nKey:"gallery.compareHelp1",components:{Kbd:a.jsx(Zu,{})}})}),a.jsx(rn,{children:a.jsx(Bn,{i18nKey:"gallery.compareHelp2",components:{Kbd:a.jsx(Zu,{})}})}),a.jsx(rn,{children:a.jsx(Bn,{i18nKey:"gallery.compareHelp3",components:{Kbd:a.jsx(Zu,{})}})}),a.jsx(rn,{children:a.jsx(Bn,{i18nKey:"gallery.compareHelp4",components:{Kbd:a.jsx(Zu,{})}})})]}),nae=h.memo(()=>{const{t:e}=T(),t=h.useMemo(()=>Wv.getData(),[]);return a.jsx(ds,{dndTarget:Wv,dndTargetData:t,label:e("gallery.selectForCompare")})});nae.displayName="ImageComparisonDroppable";const sae=e=>{e.preventDefault()},Wf=h.memo(({type:e,...t})=>{const{t:n}=T();return a.jsx(q,{position:"absolute",bottom:4,insetInlineEnd:e==="first"?void 0:4,insetInlineStart:e==="first"?4:void 0,textOverflow:"clip",whiteSpace:"nowrap",filter:EP,color:"base.50",transitionDuration:"0.2s",transitionProperty:"common",...t,children:n(e==="first"?"gallery.viewerImage":"gallery.compareImage")})});Wf.displayName="ImageComparisonLabel";const iae=h.memo(({firstImage:e,secondImage:t,rect:n})=>{const s=M(EM),i=h.useRef(null),o=s5(!1),r=h.useMemo(()=>n?LZ(n,e):{width:0,height:0},[e,n]),l=h.useMemo(()=>RZ(s,r,e,t),[s,r,e,t]);return a.jsx(A,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:a.jsx(A,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:a.jsxs(ke,{ref:i,position:"relative",id:"image-comparison-hover-image-container",w:r.width,h:r.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[a.jsx(Nn,{id:"image-comparison-hover-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:r.width,h:r.height,maxW:"full",maxH:"full",objectFit:"cover",objectPosition:"top left"}),a.jsx(Wf,{type:"first",opacity:o.isTrue?0:1}),a.jsxs(ke,{id:"image-comparison-hover-second-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",opacity:o.isTrue?1:0,transitionDuration:"0.2s",transitionProperty:"common",children:[a.jsx(ke,{id:"image-comparison-hover-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:Qh,backgroundRepeat:"repeat"}),a.jsx(Nn,{position:"relative",id:"image-comparison-hover-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:l.width,h:l.height,maxW:r.width,maxH:r.height,objectFit:s,objectPosition:"top left"}),a.jsx(Wf,{type:"second",opacity:o.isTrue?1:0})]}),a.jsx(ke,{id:"image-comparison-hover-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseOver:o.setTrue,onMouseOut:o.setFalse,onContextMenu:sae,userSelect:"none"})]})})})});iae.displayName="ImageComparisonHover";const tk=h.createContext(null);tk.displayName="PanelGroupContext";const Cs={group:"data-panel-group",groupDirection:"data-panel-group-direction",groupId:"data-panel-group-id",panel:"data-panel",panelCollapsible:"data-panel-collapsible",panelId:"data-panel-id",panelSize:"data-panel-size",resizeHandle:"data-resize-handle",resizeHandleActive:"data-resize-handle-active",resizeHandleEnabled:"data-panel-resize-handle-enabled",resizeHandleId:"data-panel-resize-handle-id",resizeHandleState:"data-resize-handle-state"},C3=10,hh=h.useLayoutEffect,Bz=AM.useId,uKe=typeof Bz=="function"?Bz:()=>null;let hKe=0;function w3(e=null){const t=uKe(),n=h.useRef(e||t||null);return n.current===null&&(n.current=""+hKe++),e??n.current}function oae({children:e,className:t="",collapsedSize:n,collapsible:s,defaultSize:i,forwardedRef:o,id:r,maxSize:l,minSize:c,onCollapse:d,onExpand:u,onResize:p,order:m,style:f,tagName:g="div",...v}){const b=h.useContext(tk);if(b===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:C,expandPanel:y,getPanelSize:x,getPanelStyle:w,groupId:_,isPanelCollapsed:S,reevaluatePanelConstraints:I,registerPanel:k,resizePanel:E,unregisterPanel:j}=b,P=w3(r),D=h.useRef({callbacks:{onCollapse:d,onExpand:u,onResize:p},constraints:{collapsedSize:n,collapsible:s,defaultSize:i,maxSize:l,minSize:c},id:P,idIsFromProps:r!==void 0,order:m});h.useRef({didLogMissingDefaultSizeWarning:!1}),hh(()=>{const{callbacks:N,constraints:F}=D.current,X={...F};D.current.id=P,D.current.idIsFromProps=r!==void 0,D.current.order=m,N.onCollapse=d,N.onExpand=u,N.onResize=p,F.collapsedSize=n,F.collapsible=s,F.defaultSize=i,F.maxSize=l,F.minSize=c,(X.collapsedSize!==F.collapsedSize||X.collapsible!==F.collapsible||X.maxSize!==F.maxSize||X.minSize!==F.minSize)&&I(D.current,X)}),hh(()=>{const N=D.current;return k(N),()=>{j(N)}},[m,P,k,j]),h.useImperativeHandle(o,()=>({collapse:()=>{C(D.current)},expand:N=>{y(D.current,N)},getId(){return P},getSize(){return x(D.current)},isCollapsed(){return S(D.current)},isExpanded(){return!S(D.current)},resize:N=>{E(D.current,N)}}),[C,y,x,S,P,E]);const O=w(D.current,i);return h.createElement(g,{...v,children:e,className:t,id:P,style:{...O,...f},[Cs.groupId]:_,[Cs.panel]:"",[Cs.panelCollapsible]:s||void 0,[Cs.panelId]:P,[Cs.panelSize]:parseFloat(""+O.flexGrow).toFixed(1)})}const vy=h.forwardRef((e,t)=>h.createElement(oae,{...e,forwardedRef:t}));oae.displayName="Panel";vy.displayName="forwardRef(Panel)";let WT=null,A2=-1,Sd=null;function pKe(e,t){if(t){const n=(t&dae)!==0,s=(t&uae)!==0,i=(t&hae)!==0,o=(t&pae)!==0;if(n)return i?"se-resize":o?"ne-resize":"e-resize";if(s)return i?"sw-resize":o?"nw-resize":"w-resize";if(i)return"s-resize";if(o)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function fKe(){Sd!==null&&(document.head.removeChild(Sd),WT=null,Sd=null,A2=-1)}function OE(e,t){var n,s;const i=pKe(e,t);if(WT!==i){if(WT=i,Sd===null&&(Sd=document.createElement("style"),document.head.appendChild(Sd)),A2>=0){var o;(o=Sd.sheet)===null||o===void 0||o.removeRule(A2)}A2=(n=(s=Sd.sheet)===null||s===void 0?void 0:s.insertRule(`*{cursor: ${i} !important;}`))!==null&&n!==void 0?n:-1}}function aae(e){return e.type==="keydown"}function rae(e){return e.type.startsWith("pointer")}function lae(e){return e.type.startsWith("mouse")}function nk(e){if(rae(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(lae(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function mKe(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function gKe(e,t,n){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function vKe(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:$z(e),b:$z(t)};let s;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),s=e;zt(s,"Stacking order can only be calculated for elements with a common ancestor");const i={a:Vz(zz(n.a)),b:Vz(zz(n.b))};if(i.a===i.b){const o=s.childNodes,r={a:n.a.at(-1),b:n.b.at(-1)};let l=o.length;for(;l--;){const c=o[l];if(c===r.a)return 1;if(c===r.b)return-1}}return Math.sign(i.a-i.b)}const yKe=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function bKe(e){var t;const n=getComputedStyle((t=cae(e))!==null&&t!==void 0?t:e).display;return n==="flex"||n==="inline-flex"}function xKe(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||bKe(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||yKe.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function zz(e){let t=e.length;for(;t--;){const n=e[t];if(zt(n,"Missing node"),xKe(n))return n}return null}function Vz(e){return e&&Number(getComputedStyle(e).zIndex)||0}function $z(e){const t=[];for(;e;)t.push(e),e=cae(e);return t}function cae(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const dae=1,uae=2,hae=4,pae=8,CKe=mKe()==="coarse";let zr=[],Sf=!1,kd=new Map,sk=new Map;const yy=new Set;function wKe(e,t,n,s,i){var o;const{ownerDocument:r}=t,l={direction:n,element:t,hitAreaMargins:s,setResizeHandlerState:i},c=(o=kd.get(r))!==null&&o!==void 0?o:0;return kd.set(r,c+1),yy.add(l),ew(),function(){var u;sk.delete(e),yy.delete(l);const p=(u=kd.get(r))!==null&&u!==void 0?u:1;if(kd.set(r,p-1),ew(),p===1&&kd.delete(r),zr.includes(l)){const m=zr.indexOf(l);m>=0&&zr.splice(m,1),S3(),i("up",!0,null)}}}function _Ke(e){const{target:t}=e,{x:n,y:s}=nk(e);Sf=!0,_3({target:t,x:n,y:s}),ew(),zr.length>0&&(tw("down",e),e.preventDefault(),fae(t)||e.stopImmediatePropagation())}function NE(e){const{x:t,y:n}=nk(e);if(Sf&&e.buttons===0&&(Sf=!1,tw("up",e)),!Sf){const{target:s}=e;_3({target:s,x:t,y:n})}tw("move",e),S3(),zr.length>0&&e.preventDefault()}function FE(e){const{target:t}=e,{x:n,y:s}=nk(e);sk.clear(),Sf=!1,zr.length>0&&(e.preventDefault(),fae(t)||e.stopImmediatePropagation()),tw("up",e),_3({target:t,x:n,y:s}),S3(),ew()}function fae(e){let t=e;for(;t;){if(t.hasAttribute(Cs.resizeHandle))return!0;t=t.parentElement}return!1}function _3({target:e,x:t,y:n}){zr.splice(0);let s=null;(e instanceof HTMLElement||e instanceof SVGElement)&&(s=e),yy.forEach(i=>{const{element:o,hitAreaMargins:r}=i,l=o.getBoundingClientRect(),{bottom:c,left:d,right:u,top:p}=l,m=CKe?r.coarse:r.fine;if(t>=d-m&&t<=u+m&&n>=p-m&&n<=c+m){if(s!==null&&document.contains(s)&&o!==s&&!o.contains(s)&&!s.contains(o)&&vKe(s,o)>0){let g=s,v=!1;for(;g&&!g.contains(o);){if(gKe(g.getBoundingClientRect(),l)){v=!0;break}g=g.parentElement}if(v)return}zr.push(i)}})}function BE(e,t){sk.set(e,t)}function S3(){let e=!1,t=!1;zr.forEach(s=>{const{direction:i}=s;i==="horizontal"?e=!0:t=!0});let n=0;sk.forEach(s=>{n|=s}),e&&t?OE("intersection",n):e?OE("horizontal",n):t?OE("vertical",n):fKe()}let zE;function ew(){var e;(e=zE)===null||e===void 0||e.abort(),zE=new AbortController;const t={capture:!0,signal:zE.signal};yy.size&&(Sf?(zr.length>0&&kd.forEach((n,s)=>{const{body:i}=s;n>0&&(i.addEventListener("contextmenu",FE,t),i.addEventListener("pointerleave",NE,t),i.addEventListener("pointermove",NE,t))}),kd.forEach((n,s)=>{const{body:i}=s;i.addEventListener("pointerup",FE,t),i.addEventListener("pointercancel",FE,t)})):kd.forEach((n,s)=>{const{body:i}=s;n>0&&(i.addEventListener("pointerdown",_Ke,t),i.addEventListener("pointermove",NE,t))}))}function tw(e,t){yy.forEach(n=>{const{setResizeHandlerState:s}=n,i=zr.includes(n);s(e,i,t)})}function SKe(){const[e,t]=h.useState(0);return h.useCallback(()=>t(n=>n+1),[])}function zt(e,t){if(!e)throw console.error(t),Error(t)}function Ah(e,t,n=C3){return e.toFixed(n)===t.toFixed(n)?0:e>t?1:-1}function Ac(e,t,n=C3){return Ah(e,t,n)===0}function la(e,t,n){return Ah(e,t,n)===0}function kKe(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const i=e[s],o=t[s];if(!la(i,o,n))return!1}return!0}function of({panelConstraints:e,panelIndex:t,size:n}){const s=e[t];zt(s!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:i=0,collapsible:o,maxSize:r=100,minSize:l=0}=s;if(Ah(n,l)<0)if(o){const c=(i+l)/2;Ah(n,c)<0?n=i:n=l}else n=l;return n=Math.min(r,n),n=parseFloat(n.toFixed(C3)),n}function U0({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:s,prevLayout:i,trigger:o}){if(la(e,0))return t;const r=[...t],[l,c]=s;zt(l!=null,"Invalid first pivot index"),zt(c!=null,"Invalid second pivot index");let d=0;if(o==="keyboard"){{const p=e<0?c:l,m=n[p];zt(m,`Panel constraints not found for index ${p}`);const{collapsedSize:f=0,collapsible:g,minSize:v=0}=m;if(g){const b=t[p];if(zt(b!=null,`Previous layout not found for panel index ${p}`),la(b,f)){const C=v-b;Ah(C,Math.abs(e))>0&&(e=e<0?0-C:C)}}}{const p=e<0?l:c,m=n[p];zt(m,`No panel constraints found for index ${p}`);const{collapsedSize:f=0,collapsible:g,minSize:v=0}=m;if(g){const b=t[p];if(zt(b!=null,`Previous layout not found for panel index ${p}`),la(b,v)){const C=b-f;Ah(C,Math.abs(e))>0&&(e=e<0?0-C:C)}}}}{const p=e<0?1:-1;let m=e<0?c:l,f=0;for(;;){const v=t[m];zt(v!=null,`Previous layout not found for panel index ${m}`);const C=of({panelConstraints:n,panelIndex:m,size:100})-v;if(f+=C,m+=p,m<0||m>=n.length)break}const g=Math.min(Math.abs(e),Math.abs(f));e=e<0?0-g:g}{let m=e<0?l:c;for(;m>=0&&m<n.length;){const f=Math.abs(e)-Math.abs(d),g=t[m];zt(g!=null,`Previous layout not found for panel index ${m}`);const v=g-f,b=of({panelConstraints:n,panelIndex:m,size:v});if(!la(g,b)&&(d+=g-b,r[m]=b,d.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?m--:m++}}if(kKe(i,r))return i;{const p=e<0?c:l,m=t[p];zt(m!=null,`Previous layout not found for panel index ${p}`);const f=m+d,g=of({panelConstraints:n,panelIndex:p,size:f});if(r[p]=g,!la(g,f)){let v=f-g,C=e<0?c:l;for(;C>=0&&C<n.length;){const y=r[C];zt(y!=null,`Previous layout not found for panel index ${C}`);const x=y+v,w=of({panelConstraints:n,panelIndex:C,size:x});if(la(y,w)||(v-=w-y,r[C]=w),la(v,0))break;e>0?C--:C++}}}const u=r.reduce((p,m)=>m+p,0);return la(u,100)?r:i}function IKe({layout:e,panelsArray:t,pivotIndices:n}){let s=0,i=100,o=0,r=0;const l=n[0];zt(l!=null,"No pivot index found"),t.forEach((p,m)=>{const{constraints:f}=p,{maxSize:g=100,minSize:v=0}=f;m===l?(s=v,i=g):(o+=v,r+=g)});const c=Math.min(i,100-o),d=Math.max(s,100-r),u=e[l];return{valueMax:c,valueMin:d,valueNow:u}}function by(e,t=document){return Array.from(t.querySelectorAll(`[${Cs.resizeHandleId}][data-panel-group-id="${e}"]`))}function mae(e,t,n=document){const i=by(e,n).findIndex(o=>o.getAttribute(Cs.resizeHandleId)===t);return i??null}function gae(e,t,n){const s=mae(e,t,n);return s!=null?[s,s+1]:[-1,-1]}function jKe(e){return e instanceof HTMLElement?!0:typeof e=="object"&&e!==null&&"tagName"in e&&"getAttribute"in e}function vae(e,t=document){if(jKe(t)&&t.dataset.panelGroupId==e)return t;const n=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return n||null}function ik(e,t=document){const n=t.querySelector(`[${Cs.resizeHandleId}="${e}"]`);return n||null}function EKe(e,t,n,s=document){var i,o,r,l;const c=ik(t,s),d=by(e,s),u=c?d.indexOf(c):-1,p=(i=(o=n[u])===null||o===void 0?void 0:o.id)!==null&&i!==void 0?i:null,m=(r=(l=n[u+1])===null||l===void 0?void 0:l.id)!==null&&r!==void 0?r:null;return[p,m]}function AKe({committedValuesRef:e,eagerValuesRef:t,groupId:n,layout:s,panelDataArray:i,panelGroupElement:o,setLayout:r}){h.useRef({didWarnAboutMissingResizeHandle:!1}),hh(()=>{if(!o)return;const l=by(n,o);for(let c=0;c<i.length-1;c++){const{valueMax:d,valueMin:u,valueNow:p}=IKe({layout:s,panelsArray:i,pivotIndices:[c,c+1]}),m=l[c];if(m!=null){const f=i[c];zt(f,`No panel data found for index "${c}"`),m.setAttribute("aria-controls",f.id),m.setAttribute("aria-valuemax",""+Math.round(d)),m.setAttribute("aria-valuemin",""+Math.round(u)),m.setAttribute("aria-valuenow",p!=null?""+Math.round(p):"")}}return()=>{l.forEach((c,d)=>{c.removeAttribute("aria-controls"),c.removeAttribute("aria-valuemax"),c.removeAttribute("aria-valuemin"),c.removeAttribute("aria-valuenow")})}},[n,s,i,o]),h.useEffect(()=>{if(!o)return;const l=t.current;zt(l,"Eager values not found");const{panelDataArray:c}=l,d=vae(n,o);zt(d!=null,`No group found for id "${n}"`);const u=by(n,o);zt(u,`No resize handles found for group id "${n}"`);const p=u.map(m=>{const f=m.getAttribute(Cs.resizeHandleId);zt(f,"Resize handle element has no handle id attribute");const[g,v]=EKe(n,f,c,o);if(g==null||v==null)return()=>{};const b=C=>{if(!C.defaultPrevented)switch(C.key){case"Enter":{C.preventDefault();const y=c.findIndex(x=>x.id===g);if(y>=0){const x=c[y];zt(x,`No panel data found for index ${y}`);const w=s[y],{collapsedSize:_=0,collapsible:S,minSize:I=0}=x.constraints;if(w!=null&&S){const k=U0({delta:la(w,_)?I-_:_-w,initialLayout:s,panelConstraints:c.map(E=>E.constraints),pivotIndices:gae(n,f,o),prevLayout:s,trigger:"keyboard"});s!==k&&r(k)}}break}}};return m.addEventListener("keydown",b),()=>{m.removeEventListener("keydown",b)}});return()=>{p.forEach(m=>m())}},[o,e,t,n,s,i,r])}function Gz(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function yae(e,t){const n=e==="horizontal",{x:s,y:i}=nk(t);return n?s:i}function PKe(e,t,n,s,i){const o=n==="horizontal",r=ik(t,i);zt(r,`No resize handle element found for id "${t}"`);const l=r.getAttribute(Cs.groupId);zt(l,"Resize handle element has no group id attribute");let{initialCursorPosition:c}=s;const d=yae(n,e),u=vae(l,i);zt(u,`No group element found for id "${l}"`);const p=u.getBoundingClientRect(),m=o?p.width:p.height;return(d-c)/m*100}function TKe(e,t,n,s,i,o){if(aae(e)){const r=n==="horizontal";let l=0;e.shiftKey?l=100:i!=null?l=i:l=10;let c=0;switch(e.key){case"ArrowDown":c=r?0:l;break;case"ArrowLeft":c=r?-l:0;break;case"ArrowRight":c=r?l:0;break;case"ArrowUp":c=r?0:-l;break;case"End":c=100;break;case"Home":c=-100;break}return c}else return s==null?0:PKe(e,t,n,s,o)}function DKe({panelDataArray:e}){const t=Array(e.length),n=e.map(o=>o.constraints);let s=0,i=100;for(let o=0;o<e.length;o++){const r=n[o];zt(r,`Panel constraints not found for index ${o}`);const{defaultSize:l}=r;l!=null&&(s++,t[o]=l,i-=l)}for(let o=0;o<e.length;o++){const r=n[o];zt(r,`Panel constraints not found for index ${o}`);const{defaultSize:l}=r;if(l!=null)continue;const c=e.length-s,d=i/c;s++,t[o]=d,i-=d}return t}function wp(e,t,n){t.forEach((s,i)=>{const o=e[i];zt(o,`Panel data not found for index ${i}`);const{callbacks:r,constraints:l,id:c}=o,{collapsedSize:d=0,collapsible:u}=l,p=n[c];if(p==null||s!==p){n[c]=s;const{onCollapse:m,onExpand:f,onResize:g}=r;g&&g(s,p),u&&(m||f)&&(f&&(p==null||Ac(p,d))&&!Ac(s,d)&&f(),m&&(p==null||!Ac(p,d))&&Ac(s,d)&&m())}})}function Rx(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function MKe({defaultSize:e,dragState:t,layout:n,panelData:s,panelIndex:i,precision:o=3}){const r=n[i];let l;return r==null?l=e!=null?e.toPrecision(o):"1":s.length===1?l="1":l=r.toPrecision(o),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function LKe(e,t=10){let n=null;return(...i)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...i)},t)}}function Hz(e){try{if(typeof localStorage<"u")e.getItem=t=>localStorage.getItem(t),e.setItem=(t,n)=>{localStorage.setItem(t,n)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function bae(e){return`react-resizable-panels:${e}`}function xae(e){return e.map(t=>{const{constraints:n,id:s,idIsFromProps:i,order:o}=t;return i?s:o?`${o}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((t,n)=>t.localeCompare(n)).join(",")}function Cae(e,t){try{const n=bae(e),s=t.getItem(n);if(s){const i=JSON.parse(s);if(typeof i=="object"&&i!=null)return i}}catch{}return null}function RKe(e,t,n){var s,i;const o=(s=Cae(e,n))!==null&&s!==void 0?s:{},r=xae(t);return(i=o[r])!==null&&i!==void 0?i:null}function OKe(e,t,n,s,i){var o;const r=bae(e),l=xae(t),c=(o=Cae(e,i))!==null&&o!==void 0?o:{};c[l]={expandToSizes:Object.fromEntries(n.entries()),layout:s};try{i.setItem(r,JSON.stringify(c))}catch(d){console.error(d)}}function Wz({layout:e,panelConstraints:t}){const n=[...e],s=n.reduce((o,r)=>o+r,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(o=>`${o}%`).join(", ")}`);if(!la(s,100)&&n.length>0)for(let o=0;o<t.length;o++){const r=n[o];zt(r!=null,`No layout data found for index ${o}`);const l=100/s*r;n[o]=l}let i=0;for(let o=0;o<t.length;o++){const r=n[o];zt(r!=null,`No layout data found for index ${o}`);const l=of({panelConstraints:t,panelIndex:o,size:r});r!=l&&(i+=r-l,n[o]=l)}if(!la(i,0))for(let o=0;o<t.length;o++){const r=n[o];zt(r!=null,`No layout data found for index ${o}`);const l=r+i,c=of({panelConstraints:t,panelIndex:o,size:l});if(r!==c&&(i-=c-r,n[o]=c,la(i,0)))break}return n}const NKe=100,q0={getItem:e=>(Hz(q0),q0.getItem(e)),setItem:(e,t)=>{Hz(q0),q0.setItem(e,t)}},Uz={};function wae({autoSaveId:e=null,children:t,className:n="",direction:s,forwardedRef:i,id:o=null,onLayout:r=null,keyboardResizeBy:l=null,storage:c=q0,style:d,tagName:u="div",...p}){const m=w3(o),f=h.useRef(null),[g,v]=h.useState(null),[b,C]=h.useState([]),y=SKe(),x=h.useRef({}),w=h.useRef(new Map),_=h.useRef(0),S=h.useRef({autoSaveId:e,direction:s,dragState:g,id:m,keyboardResizeBy:l,onLayout:r,storage:c}),I=h.useRef({layout:b,panelDataArray:[],panelDataArrayChanged:!1});h.useRef({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),h.useImperativeHandle(i,()=>({getId:()=>S.current.id,getLayout:()=>{const{layout:R}=I.current;return R},setLayout:R=>{const{onLayout:G}=S.current,{layout:H,panelDataArray:$}=I.current,z=Wz({layout:R,panelConstraints:$.map(B=>B.constraints)});Gz(H,z)||(C(z),I.current.layout=z,G&&G(z),wp($,z,x.current))}}),[]),hh(()=>{S.current.autoSaveId=e,S.current.direction=s,S.current.dragState=g,S.current.id=m,S.current.onLayout=r,S.current.storage=c}),AKe({committedValuesRef:S,eagerValuesRef:I,groupId:m,layout:b,panelDataArray:I.current.panelDataArray,setLayout:C,panelGroupElement:f.current}),h.useEffect(()=>{const{panelDataArray:R}=I.current;if(e){if(b.length===0||b.length!==R.length)return;let G=Uz[e];G==null&&(G=LKe(OKe,NKe),Uz[e]=G);const H=[...R],$=new Map(w.current);G(e,H,$,b,c)}},[e,b,c]),h.useEffect(()=>{});const k=h.useCallback(R=>{const{onLayout:G}=S.current,{layout:H,panelDataArray:$}=I.current;if(R.constraints.collapsible){const z=$.map(ge=>ge.constraints),{collapsedSize:B=0,panelSize:Y,pivotIndices:ie}=Lu($,R,H);if(zt(Y!=null,`Panel size not found for panel "${R.id}"`),!Ac(Y,B)){w.current.set(R.id,Y);const xe=Wp($,R)===$.length-1?Y-B:B-Y,we=U0({delta:xe,initialLayout:H,panelConstraints:z,pivotIndices:ie,prevLayout:H,trigger:"imperative-api"});Rx(H,we)||(C(we),I.current.layout=we,G&&G(we),wp($,we,x.current))}}},[]),E=h.useCallback((R,G)=>{const{onLayout:H}=S.current,{layout:$,panelDataArray:z}=I.current;if(R.constraints.collapsible){const B=z.map(je=>je.constraints),{collapsedSize:Y=0,panelSize:ie=0,minSize:ge=0,pivotIndices:xe}=Lu(z,R,$),we=G??ge;if(Ac(ie,Y)){const je=w.current.get(R.id),Re=je!=null&&je>=we?je:we,Xe=Wp(z,R)===z.length-1?ie-Re:Re-ie,Qe=U0({delta:Xe,initialLayout:$,panelConstraints:B,pivotIndices:xe,prevLayout:$,trigger:"imperative-api"});Rx($,Qe)||(C(Qe),I.current.layout=Qe,H&&H(Qe),wp(z,Qe,x.current))}}},[]),j=h.useCallback(R=>{const{layout:G,panelDataArray:H}=I.current,{panelSize:$}=Lu(H,R,G);return zt($!=null,`Panel size not found for panel "${R.id}"`),$},[]),P=h.useCallback((R,G)=>{const{panelDataArray:H}=I.current,$=Wp(H,R);return MKe({defaultSize:G,dragState:g,layout:b,panelData:H,panelIndex:$})},[g,b]),D=h.useCallback(R=>{const{layout:G,panelDataArray:H}=I.current,{collapsedSize:$=0,collapsible:z,panelSize:B}=Lu(H,R,G);return zt(B!=null,`Panel size not found for panel "${R.id}"`),z===!0&&Ac(B,$)},[]),O=h.useCallback(R=>{const{layout:G,panelDataArray:H}=I.current,{collapsedSize:$=0,collapsible:z,panelSize:B}=Lu(H,R,G);return zt(B!=null,`Panel size not found for panel "${R.id}"`),!z||Ah(B,$)>0},[]),N=h.useCallback(R=>{const{panelDataArray:G}=I.current;G.push(R),G.sort((H,$)=>{const z=H.order,B=$.order;return z==null&&B==null?0:z==null?-1:B==null?1:z-B}),I.current.panelDataArrayChanged=!0,y()},[y]);hh(()=>{if(I.current.panelDataArrayChanged){I.current.panelDataArrayChanged=!1;const{autoSaveId:R,onLayout:G,storage:H}=S.current,{layout:$,panelDataArray:z}=I.current;let B=null;if(R){const ie=RKe(R,z,H);ie&&(w.current=new Map(Object.entries(ie.expandToSizes)),B=ie.layout)}B==null&&(B=DKe({panelDataArray:z}));const Y=Wz({layout:B,panelConstraints:z.map(ie=>ie.constraints)});Gz($,Y)||(C(Y),I.current.layout=Y,G&&G(Y),wp(z,Y,x.current))}}),hh(()=>{const R=I.current;return()=>{R.layout=[]}},[]);const F=h.useCallback(R=>{let G=!1;const H=f.current;return H&&window.getComputedStyle(H,null).getPropertyValue("direction")==="rtl"&&(G=!0),function(z){z.preventDefault();const B=f.current;if(!B)return()=>null;const{direction:Y,dragState:ie,id:ge,keyboardResizeBy:xe,onLayout:we}=S.current,{layout:je,panelDataArray:Re}=I.current,{initialLayout:Ct}=ie??{},Xe=gae(ge,R,B);let Qe=TKe(z,R,Y,ie,xe,B);const Dt=Y==="horizontal";Dt&&G&&(Qe=-Qe);const se=Re.map(Se=>Se.constraints),re=U0({delta:Qe,initialLayout:Ct??je,panelConstraints:se,pivotIndices:Xe,prevLayout:je,trigger:aae(z)?"keyboard":"mouse-or-touch"}),ue=!Rx(je,re);(rae(z)||lae(z))&&_.current!=Qe&&(_.current=Qe,!ue&&Qe!==0?Dt?BE(R,Qe<0?dae:uae):BE(R,Qe<0?hae:pae):BE(R,0)),ue&&(C(re),I.current.layout=re,we&&we(re),wp(Re,re,x.current))}},[]),X=h.useCallback((R,G)=>{const{onLayout:H}=S.current,{layout:$,panelDataArray:z}=I.current,B=z.map(je=>je.constraints),{panelSize:Y,pivotIndices:ie}=Lu(z,R,$);zt(Y!=null,`Panel size not found for panel "${R.id}"`);const xe=Wp(z,R)===z.length-1?Y-G:G-Y,we=U0({delta:xe,initialLayout:$,panelConstraints:B,pivotIndices:ie,prevLayout:$,trigger:"imperative-api"});Rx($,we)||(C(we),I.current.layout=we,H&&H(we),wp(z,we,x.current))},[]),L=h.useCallback((R,G)=>{const{layout:H,panelDataArray:$}=I.current,{collapsedSize:z=0,collapsible:B}=G,{collapsedSize:Y=0,collapsible:ie,maxSize:ge=100,minSize:xe=0}=R.constraints,{panelSize:we}=Lu($,R,H);we!=null&&(B&&ie&&Ac(we,z)?Ac(z,Y)||X(R,Y):we<xe?X(R,xe):we>ge&&X(R,ge))},[X]),V=h.useCallback((R,G)=>{const{direction:H}=S.current,{layout:$}=I.current;if(!f.current)return;const z=ik(R,f.current);zt(z,`Drag handle element not found for id "${R}"`);const B=yae(H,G);v({dragHandleId:R,dragHandleRect:z.getBoundingClientRect(),initialCursorPosition:B,initialLayout:$})},[]),K=h.useCallback(()=>{v(null)},[]),U=h.useCallback(R=>{const{panelDataArray:G}=I.current,H=Wp(G,R);H>=0&&(G.splice(H,1),delete x.current[R.id],I.current.panelDataArrayChanged=!0,y())},[y]),Z=h.useMemo(()=>({collapsePanel:k,direction:s,dragState:g,expandPanel:E,getPanelSize:j,getPanelStyle:P,groupId:m,isPanelCollapsed:D,isPanelExpanded:O,reevaluatePanelConstraints:L,registerPanel:N,registerResizeHandle:F,resizePanel:X,startDragging:V,stopDragging:K,unregisterPanel:U,panelGroupElement:f.current}),[k,g,s,E,j,P,m,D,O,L,N,F,X,V,K,U]),W={display:"flex",flexDirection:s==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return h.createElement(tk.Provider,{value:Z},h.createElement(u,{...p,children:t,className:n,id:o,ref:f,style:{...W,...d},[Cs.group]:"",[Cs.groupDirection]:s,[Cs.groupId]:m}))}const k3=h.forwardRef((e,t)=>h.createElement(wae,{...e,forwardedRef:t}));wae.displayName="PanelGroup";k3.displayName="forwardRef(PanelGroup)";function Wp(e,t){return e.findIndex(n=>n===t||n.id===t.id)}function Lu(e,t,n){const s=Wp(e,t),o=s===e.length-1?[s-1,s]:[s,s+1],r=n[s];return{...t.constraints,panelSize:r,pivotIndices:o}}function FKe({disabled:e,handleId:t,resizeHandler:n,panelGroupElement:s}){h.useEffect(()=>{if(e||n==null||s==null)return;const i=ik(t,s);if(i==null)return;const o=r=>{if(!r.defaultPrevented)switch(r.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{r.preventDefault(),n(r);break}case"F6":{r.preventDefault();const l=i.getAttribute(Cs.groupId);zt(l,`No group element found for id "${l}"`);const c=by(l,s),d=mae(l,t,s);zt(d!==null,`No resize element found for id "${t}"`);const u=r.shiftKey?d>0?d-1:c.length-1:d+1<c.length?d+1:0;c[u].focus();break}}};return i.addEventListener("keydown",o),()=>{i.removeEventListener("keydown",o)}},[s,e,t,n])}function _ae({children:e=null,className:t="",disabled:n=!1,hitAreaMargins:s,id:i,onBlur:o,onClick:r,onDragging:l,onFocus:c,onPointerDown:d,onPointerUp:u,style:p={},tabIndex:m=0,tagName:f="div",...g}){var v,b;const C=h.useRef(null),y=h.useRef({onClick:r,onDragging:l,onPointerDown:d,onPointerUp:u});h.useEffect(()=>{y.current.onClick=r,y.current.onDragging=l,y.current.onPointerDown=d,y.current.onPointerUp=u});const x=h.useContext(tk);if(x===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:w,groupId:_,registerResizeHandle:S,startDragging:I,stopDragging:k,panelGroupElement:E}=x,j=w3(i),[P,D]=h.useState("inactive"),[O,N]=h.useState(!1),[F,X]=h.useState(null),L=h.useRef({state:P});hh(()=>{L.current.state=P}),h.useEffect(()=>{if(n)X(null);else{const Z=S(j);X(()=>Z)}},[n,j,S]);const V=(v=s?.coarse)!==null&&v!==void 0?v:15,K=(b=s?.fine)!==null&&b!==void 0?b:5;h.useEffect(()=>{if(n||F==null)return;const Z=C.current;zt(Z,"Element ref not attached");let W=!1;return wKe(j,Z,w,{coarse:V,fine:K},(G,H,$)=>{if(!H){D("inactive");return}switch(G){case"down":{D("drag"),W=!1,zt($,'Expected event to be defined for "down" action'),I(j,$);const{onDragging:z,onPointerDown:B}=y.current;z?.(!0),B?.();break}case"move":{const{state:z}=L.current;W=!0,z!=="drag"&&D("hover"),zt($,'Expected event to be defined for "move" action'),F($);break}case"up":{D("hover"),k();const{onClick:z,onDragging:B,onPointerUp:Y}=y.current;B?.(!1),Y?.(),W||z?.();break}}})},[V,w,n,K,S,j,F,I,k]),FKe({disabled:n,handleId:j,resizeHandler:F,panelGroupElement:E});const U={touchAction:"none",userSelect:"none"};return h.createElement(f,{...g,children:e,className:t,id:i,onBlur:()=>{N(!1),o?.()},onFocus:()=>{N(!0),c?.()},ref:C,role:"separator",style:{...U,...p},tabIndex:m,[Cs.groupDirection]:w,[Cs.groupId]:_,[Cs.resizeHandle]:"",[Cs.resizeHandleActive]:P==="drag"?"pointer":O?"keyboard":void 0,[Cs.resizeHandleEnabled]:!n,[Cs.resizeHandleId]:j,[Cs.resizeHandleState]:P})}_ae.displayName="PanelResizeHandle";const Sae=ec(_ae),kae={'&[data-resize-handle-state="hover"]':{_before:{background:"base.600 !important"},".resize-handle-dots":{color:"base.400"}},'&[data-resize-handle-state="drag"]':{_before:{background:"base.500 !important"},".resize-handle-dots":{color:"base.300"}},".resize-handle-dots":{pointerEvents:"none",position:"absolute",left:"50%",top:"50%",transform:"translateX(-50%) translateY(-50%) scale(0.75)",background:"base.900",color:"base.500"}},BKe={...kae,'&[data-panel-group-direction="vertical"]':{h:4,w:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"fast",content:'""',w:"full",h:"2px",background:"base.800",position:"absolute",top:"50%",left:0,transform:"translateY(-50%)"}}},Iae=h.memo(e=>a.jsx(Sae,{...e,sx:BKe,children:a.jsxs(A,{className:"resize-handle-dots",clipPath:"inset(0px 2px 2px 0px)",px:1,children:[a.jsx(Je,{as:_N,me:-.5}),a.jsx(Je,{as:_N,ms:-.5})]})}));Iae.displayName="HorizontalResizeHandle";const zKe={...kae,'&[data-panel-group-direction="horizontal"]':{w:4,h:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"normal",content:'""',w:"2px",h:"full",background:"base.800",position:"absolute",left:"50%",top:0,transform:"translateX(-50%)"}}},jae=h.memo(e=>a.jsx(Sae,{...e,sx:zKe,children:a.jsxs(A,{flexDir:"column",className:"resize-handle-dots",clipPath:"inset(2px 0px 0px 2px)",py:1,children:[a.jsx(Je,{as:wN,mb:-.5}),a.jsx(Je,{as:wN,mt:-.5})]})}));jae.displayName="VerticalResizeHandle";const Eae=h.memo(({firstImage:e,secondImage:t})=>{const n=h.useRef(null),s=h.useCallback(()=>{n.current&&n.current.setLayout([50,50])},[]);return a.jsx(A,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:a.jsx(A,{w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:a.jsxs(k3,{ref:n,direction:"horizontal",id:"image-comparison-side-by-side",autoSaveId:"image-comparison-side-by-side",children:[a.jsx(vy,{minSize:20,children:a.jsx(UT,{imageDTO:e,type:"first"})}),a.jsx(jae,{id:"image-comparison-side-by-side-handle",onDoubleClick:s}),a.jsx(vy,{minSize:20,children:a.jsx(UT,{imageDTO:t,type:"second"})})]})})})});Eae.displayName="ImageComparisonSideBySide";const UT=h.memo(({imageDTO:e,type:t})=>a.jsx(A,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:a.jsxs(A,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:e.width/e.height,children:[a.jsx(Nn,{id:`image-comparison-side-by-side-${t}-image`,w:e.width,h:e.height,maxW:"full",maxH:"full",src:e.image_url,fallbackSrc:e.thumbnail_url,objectFit:"contain",borderRadius:"base"}),a.jsx(Wf,{type:t})]})}));UT.displayName="SideBySideImage";const Aae="50%",I3=2,VKe=`${I3}px`,ok=20,$Ke=`${ok}px`,GKe=`${ok/2-I3/2}px`,HKe=`calc(${Aae} - ${ok/2}px)`,Pae=h.memo(({firstImage:e,secondImage:t,rect:n})=>{const s=M(EM),[i,o]=h.useState(HKe),[r,l]=h.useState(Aae),c=h.useRef(null),d=h.useRef(null),u=h.useRef(null),p=h.useRef(0),m=h.useMemo(()=>n?LZ(n,e):{width:0,height:0},[e,n]),f=h.useMemo(()=>RZ(s,m,e,t),[s,m,e,t]),g=h.useCallback(y=>{if(!c.current||!d.current)return;p.current=performance.now();const{x,width:w}=d.current.getBoundingClientRect(),_=(y-x)*100/w,S=I3*100/w,I=Math.min(100-S,Math.max(0,_));l(`${I}%`),o(`calc(${I}% - ${ok/2}px)`)},[]),v=h.useCallback(y=>{u.current===null&&performance.now()>p.current+1e3/60&&(u.current=window.requestAnimationFrame(()=>{g(y.clientX),u.current=null}))},[g]),b=h.useCallback(()=>{window.removeEventListener("mousemove",v)},[v]),C=h.useCallback(y=>{g(y.clientX),window.addEventListener("mouseup",b,{once:!0}),window.addEventListener("mousemove",v)},[v,b,g]);return h.useEffect(()=>()=>{u.current!==null&&cancelAnimationFrame(u.current)},[]),a.jsx(A,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:a.jsx(A,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:a.jsxs(ke,{ref:d,position:"relative",id:"image-comparison-image-container",w:m.width,h:m.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[a.jsx(ke,{id:"image-comparison-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:Qh,backgroundRepeat:"repeat"}),a.jsx(Nn,{position:"relative",id:"image-comparison-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:f.width,h:f.height,maxW:m.width,maxH:m.height,objectFit:s,objectPosition:"top left"}),a.jsx(Wf,{type:"second"}),a.jsxs(ke,{id:"image-comparison-first-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,w:r,overflow:"hidden",children:[a.jsx(Nn,{id:"image-comparison-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:m.width,h:m.height,objectFit:"cover",objectPosition:"top left"}),a.jsx(Wf,{type:"first"})]}),a.jsxs(A,{id:"image-comparison-handle",ref:c,position:"absolute",top:0,bottom:0,left:i,w:$Ke,cursor:"ew-resize",filter:EP,opacity:.8,color:"base.50",children:[a.jsx(ke,{id:"image-comparison-handle-divider",w:VKe,h:"full",bg:"currentColor",shadow:"dark-lg",position:"absolute",top:0,left:GKe}),a.jsxs(A,{id:"image-comparison-handle-icons",gap:4,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, 0)",filter:EP,children:[a.jsx(Je,{as:tX}),a.jsx(Je,{as:Y_})]})]}),a.jsx(ke,{id:"image-comparison-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseDown:C,onContextMenu:sae,userSelect:"none",cursor:"ew-resize"})]})})})});Pae.displayName="ImageComparisonSlider";const Tae=h.memo(({firstImage:e,secondImage:t,rect:n})=>{const s=M(tU);if(!e||!t)return null;if(s==="slider")return a.jsx(Pae,{firstImage:e,secondImage:t,rect:n});if(s==="side-by-side")return a.jsx(Eae,{firstImage:e,secondImage:t,rect:n});if(s==="hover")return a.jsx(iae,{firstImage:e,secondImage:t,rect:n});ae(!1)});Tae.displayName="ImageComparisonContent";const Dae=h.memo(()=>{const e=M(or),t=Jd(e),n=Jd(M(UPe)),[s,i]=h.useState(null),o=h.useRef(null),r=h.useCallback(l=>{if(l){o.current=l;const c=l.getBoundingClientRect();i(c)}},[]);return h.useLayoutEffect(()=>{const l=o.current;if(!l)return;const c=Y2(()=>{const u=l.getBoundingClientRect();i(u)},300),d=new ResizeObserver(c);return d.observe(l),()=>{d.disconnect()}},[]),a.jsxs(A,{flexDir:"column",w:"full",h:"full",overflow:"hidden",gap:2,position:"relative",children:[a.jsx(tae,{}),a.jsx(vt,{}),a.jsxs(A,{w:"full",h:"full",position:"relative",children:[a.jsx(ke,{ref:r,w:"full",h:"full",overflow:"hidden",children:a.jsx(Tae,{firstImage:t,secondImage:n,rect:s})}),a.jsx(nae,{})]})]})});Dae.displayName="ImageComparison";const WKe=()=>{const{t:e}=T(),t=le(bK),[n,s]=h.useState(null);return h.useEffect(()=>{if(!t){s(null);return}if(t&&!t.startsWith("Loading model")){s(null);return}const i=setTimeout(()=>{s(`${e("common.loadingModel")}...`)},5e3);return()=>clearTimeout(i)},[t,e]),n},Mae=h.memo(()=>{const{t:e}=T(),t=le(bK);return t?a.jsxs(hu,{status:"loading",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[a.jsx(Nh,{}),a.jsx(zy,{children:e("common.generating")}),a.jsx(oM,{children:t})]}):null});Mae.displayName="CanvasAlertsInvocationProgressContentLocal";const UKe=h.memo(()=>{const e=WKe();return e?a.jsxs(hu,{status:"loading",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[a.jsx(Nh,{}),a.jsx(oM,{children:e})]}):null});UKe.displayName="CanvasAlertsInvocationProgressContentCommercial";const j3=h.memo(()=>M(CW)?a.jsx(Mae,{}):null);j3.displayName="CanvasAlertsInvocationProgress";const Lae=e=>{const[t]=el(e?.has_workflow?e.image_name:null,300);return Jxe(t??Ri)},qKe=({image:e})=>{const{t}=T(),{currentData:n}=Lae(e),s=h.useMemo(()=>{if(n?.graph)try{return JSON.parse(n.graph)}catch{return null}return null},[n]);return s?a.jsx(Xl,{fileName:`${e.image_name.replace(".png","")}_graph`,data:s,label:t("nodes.graph")}):a.jsx(On,{label:t("nodes.noGraph")})},KKe=h.memo(qKe),sn=h.memo,Rae=h.memo(e=>{const{metadata:t}=e;return!t||Object.keys(t).length===0?null:a.jsxs(A,{flexDir:"column",ps:8,children:[a.jsx(E3,{metadata:t,handler:kt.GenerationMode}),a.jsx(Qn,{metadata:t,handler:kt.PositivePrompt}),a.jsx(Qn,{metadata:t,handler:kt.NegativePrompt}),a.jsx(Qn,{metadata:t,handler:kt.MainModel}),a.jsx(Qn,{metadata:t,handler:kt.VAEModel}),a.jsx(Qn,{metadata:t,handler:kt.Width}),a.jsx(Qn,{metadata:t,handler:kt.Height}),a.jsx(Qn,{metadata:t,handler:kt.Seed}),a.jsx(Qn,{metadata:t,handler:kt.Steps}),a.jsx(Qn,{metadata:t,handler:kt.Scheduler}),a.jsx(Qn,{metadata:t,handler:kt.CLIPSkip}),a.jsx(Qn,{metadata:t,handler:kt.CFGScale}),a.jsx(Qn,{metadata:t,handler:kt.CFGRescaleMultiplier}),a.jsx(Qn,{metadata:t,handler:kt.Guidance}),a.jsx(Qn,{metadata:t,handler:kt.DenoisingStrength}),a.jsx(Qn,{metadata:t,handler:kt.SeamlessX}),a.jsx(Qn,{metadata:t,handler:kt.SeamlessY}),a.jsx(Qn,{metadata:t,handler:kt.RefinerModel}),a.jsx(Qn,{metadata:t,handler:kt.RefinerCFGScale}),a.jsx(Qn,{metadata:t,handler:kt.RefinerPositiveAestheticScore}),a.jsx(Qn,{metadata:t,handler:kt.RefinerNegativeAestheticScore}),a.jsx(Qn,{metadata:t,handler:kt.RefinerScheduler}),a.jsx(Qn,{metadata:t,handler:kt.RefinerDenoisingStart}),a.jsx(Qn,{metadata:t,handler:kt.RefinerSteps}),a.jsx(Qn,{metadata:t,handler:kt.CanvasLayers}),a.jsx(qT,{metadata:t,handler:kt.RefImages}),a.jsx(qT,{metadata:t,handler:kt.LoRAs})]})});Rae.displayName="ImageMetadataActions";const E3=sn(({metadata:e,handler:t})=>{const{data:n}=rRe(e,t);if(!n.isParsed)return null;if(n.isSuccess)return a.jsx(Oae,{data:n,handler:t})});E3.displayName="UnrecallableMetadataDatum";const Oae=sn(({data:e,handler:t})=>{const{LabelComponent:n,ValueComponent:s}=t;return a.jsxs(ke,{as:"span",lineHeight:1,children:[a.jsx(n,{i18nKey:t.i18nKey}),a.jsx(s,{value:e.value})]})});Oae.displayName="UnrecallableMetadataParsed";const Qn=sn(({metadata:e,handler:t})=>{const{data:n}=oRe(e,t);if(!n.isParsed)return null;if(n.isSuccess)return a.jsx(Nae,{data:n,handler:t})});Qn.displayName="SingleMetadataDatum";const Nae=sn(({data:e,handler:t})=>{const n=Ze(),{LabelComponent:s,ValueComponent:i}=t,o=h.useCallback(()=>{t.recall(e.value,n)},[e.value,t,n]);return a.jsxs(A,{gap:2,children:[a.jsx(oe,{"aria-label":"Recall Parameter",icon:a.jsx(K_,{}),size:"xs",variant:"ghost",onClick:o}),a.jsxs(ke,{as:"span",lineHeight:1,children:[a.jsx(s,{i18nKey:t.i18nKey}),a.jsx(i,{value:e.value})]})]})});Nae.displayName="SingleMetadataParsed";const qT=sn(({metadata:e,handler:t})=>{const{data:n}=aRe(e,t);if(!n.isParsed)return null;if(n.isSuccess)return a.jsx(a.Fragment,{children:n.value.map((s,i)=>a.jsx(Fae,{value:s,handler:t},i))})});qT.displayName="CollectionMetadataDatum";const Fae=sn(({value:e,handler:t})=>{const n=Ze(),{LabelComponent:s,ValueComponent:i}=t,o=h.useCallback(()=>{t.recallOne(e,n)},[t,n,e]);return a.jsxs(A,{gap:2,children:[a.jsx(oe,{"aria-label":"Recall Parameter",icon:a.jsx(K_,{}),size:"xs",variant:"ghost",onClick:o}),a.jsxs(ke,{as:"span",lineHeight:1,children:[a.jsx(s,{i18nKey:t.i18nKey}),a.jsx(i,{value:e})]})]})});Fae.displayName="CollectionMetadataParsed";const ZKe=({image:e})=>{const{t}=T(),{currentData:n}=Lae(e),s=h.useMemo(()=>{if(n?.workflow)try{return JSON.parse(n.workflow)}catch{return null}return null},[n]);return s?a.jsx(Xl,{fileName:`${e.image_name.replace(".png","")}_workflow`,data:s,label:t("metadata.workflow")}):a.jsx(On,{label:t("nodes.noWorkflow")})},XKe=h.memo(ZKe),YKe=({image:e})=>{const{t}=T(),{metadata:n,isLoading:s}=Zh(e.image_name);return a.jsxs(A,{layerStyle:"first",padding:4,gap:1,flexDirection:"column",width:"full",height:"full",borderRadius:"base",position:"absolute",overflow:"hidden",children:[a.jsx(to,{href:e.image_url,label:e.image_name}),a.jsx(E3,{metadata:n,handler:kt.CreatedBy}),a.jsxs(Vy,{variant:"line",isLazy:!0,display:"flex",flexDir:"column",w:"full",h:"full",children:[a.jsxs($y,{children:[a.jsx(Qs,{children:t("metadata.recallParameters")}),a.jsx(Qs,{children:t("metadata.metadata")}),a.jsx(Qs,{children:t("metadata.imageDetails")}),a.jsx(Qs,{children:t("metadata.workflow")}),a.jsx(Qs,{children:t("nodes.graph")})]}),a.jsxs(Gy,{children:[a.jsxs(Js,{children:[s&&a.jsx(m1,{label:"Loading metadata..."}),n&&!s&&a.jsx(Hs,{children:a.jsx(Rae,{metadata:n})}),!n&&!s&&a.jsx(On,{label:t("metadata.noRecallParameters")})]}),a.jsx(Js,{children:n?a.jsx(Xl,{fileName:`${e.image_name.replace(".png","")}_metadata`,data:n,label:t("metadata.metadata")}):a.jsx(On,{label:t("metadata.noMetaData")})}),a.jsx(Js,{children:e?a.jsx(Xl,{fileName:`${e.image_name.replace(".png","")}_details`,data:e,label:t("metadata.imageDetails")}):a.jsx(On,{label:t("metadata.noImageDetails")})}),a.jsx(Js,{children:a.jsx(XKe,{image:e})}),a.jsx(Js,{children:a.jsx(KKe,{image:e})})]})]})]})},QKe=h.memo(YKe),JKe=({inset:e=8})=>{const{t}=T(),n=Q(),s=M(or),{imageNames:i,isFetching:o}=ek(),r=h.useMemo(()=>s?i.at(0)===s:!1,[i,s]),l=h.useMemo(()=>s?i.at(-1)===s:!1,[i,s]),c=h.useCallback(()=>{const u=s?i.findIndex(f=>f===s)-1:0,p=fi(u,0,i.length-1),m=i.at(p);m&&n(Lv(m))},[n,i,s]),d=h.useCallback(()=>{const u=s?i.findIndex(f=>f===s)+1:0,p=fi(u,0,i.length-1),m=i.at(p);m&&n(Lv(m))},[n,i,s]);return a.jsxs(ke,{pos:"relative",h:"full",w:"full",children:[!r&&a.jsx(oe,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.previousImage"),icon:a.jsx(tX,{size:64}),variant:"unstyled",onClick:c,isDisabled:o,color:"base.100",pointerEvents:"auto",insetInlineStart:e}),!l&&a.jsx(oe,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.nextImage"),icon:a.jsx(Y_,{size:64}),variant:"unstyled",onClick:d,isDisabled:o,color:"base.100",pointerEvents:"auto",insetInlineEnd:e})]})},Bae=h.memo(JKe),A3=h.createContext({});function P3(e){const t=h.useRef(null);return t.current===null&&(t.current=e()),t.current}const ak=h.createContext(null),T3=h.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class eZe extends h.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function tZe({children:e,isPresent:t}){const n=h.useId(),s=h.useRef(null),i=h.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=h.useContext(T3);return h.useInsertionEffect(()=>{const{width:r,height:l,top:c,left:d}=i.current;if(t||!s.current||!r||!l)return;s.current.dataset.motionPopId=n;const u=document.createElement("style");return o&&(u.nonce=o),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${r}px !important;
            height: ${l}px !important;
            top: ${c}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[t]),a.jsx(eZe,{isPresent:t,childRef:s,sizeRef:i,children:h.cloneElement(e,{ref:s})})}const nZe=({children:e,initial:t,isPresent:n,onExitComplete:s,custom:i,presenceAffectsLayout:o,mode:r})=>{const l=P3(sZe),c=h.useId(),d=h.useCallback(p=>{l.set(p,!0);for(const m of l.values())if(!m)return;s&&s()},[l,s]),u=h.useMemo(()=>({id:c,initial:t,isPresent:n,custom:i,onExitComplete:d,register:p=>(l.set(p,!1),()=>l.delete(p))}),o?[Math.random(),d]:[n,d]);return h.useMemo(()=>{l.forEach((p,m)=>l.set(m,!1))},[n]),h.useEffect(()=>{!n&&!l.size&&s&&s()},[n]),r==="popLayout"&&(e=a.jsx(tZe,{isPresent:n,children:e})),a.jsx(ak.Provider,{value:u,children:e})};function sZe(){return new Map}function zae(e=!0){const t=h.useContext(ak);if(t===null)return[!0,null];const{isPresent:n,onExitComplete:s,register:i}=t,o=h.useId();h.useEffect(()=>{e&&i(o)},[e]);const r=h.useCallback(()=>e&&s&&s(o),[o,s,e]);return!n&&s?[!1,r]:[!0]}const Ox=e=>e.key||"";function qz(e){const t=[];return h.Children.forEach(e,n=>{h.isValidElement(n)&&t.push(n)}),t}const D3=typeof window<"u",Vae=D3?h.useLayoutEffect:h.useEffect,iZe=({children:e,custom:t,initial:n=!0,onExitComplete:s,presenceAffectsLayout:i=!0,mode:o="sync",propagate:r=!1})=>{const[l,c]=zae(r),d=h.useMemo(()=>qz(e),[e]),u=r&&!l?[]:d.map(Ox),p=h.useRef(!0),m=h.useRef(d),f=P3(()=>new Map),[g,v]=h.useState(d),[b,C]=h.useState(d);Vae(()=>{p.current=!1,m.current=d;for(let w=0;w<b.length;w++){const _=Ox(b[w]);u.includes(_)?f.delete(_):f.get(_)!==!0&&f.set(_,!1)}},[b,u.length,u.join("-")]);const y=[];if(d!==g){let w=[...d];for(let _=0;_<b.length;_++){const S=b[_],I=Ox(S);u.includes(I)||(w.splice(_,0,S),y.push(S))}o==="wait"&&y.length&&(w=y),C(qz(w)),v(d);return}const{forceRender:x}=h.useContext(A3);return a.jsx(a.Fragment,{children:b.map(w=>{const _=Ox(w),S=r&&!l?!1:d===b||u.includes(_),I=()=>{if(f.has(_))f.set(_,!0);else return;let k=!0;f.forEach(E=>{E||(k=!1)}),k&&(x?.(),C(m.current),r&&c?.(),s&&s())};return a.jsx(nZe,{isPresent:S,initial:!p.current||n?void 0:!1,custom:S?void 0:t,presenceAffectsLayout:i,mode:o,onExitComplete:S?void 0:I,children:w},_)})})},Sa=e=>e;let $ae=Sa;function M3(e){let t;return()=>(t===void 0&&(t=e()),t)}const Uf=(e,t,n)=>{const s=t-e;return s===0?1:(n-e)/s},Nc=e=>e*1e3,Fc=e=>e/1e3,oZe={useManualTiming:!1};function aZe(e){let t=new Set,n=new Set,s=!1,i=!1;const o=new WeakSet;let r={delta:0,timestamp:0,isProcessing:!1};function l(d){o.has(d)&&(c.schedule(d),e()),d(r)}const c={schedule:(d,u=!1,p=!1)=>{const f=p&&s?t:n;return u&&o.add(d),f.has(d)||f.add(d),d},cancel:d=>{n.delete(d),o.delete(d)},process:d=>{if(r=d,s){i=!0;return}s=!0,[t,n]=[n,t],t.forEach(l),t.clear(),s=!1,i&&(i=!1,c.process(d))}};return c}const Nx=["read","resolveKeyframes","update","preRender","render","postRender"],rZe=40;function Gae(e,t){let n=!1,s=!0;const i={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,r=Nx.reduce((C,y)=>(C[y]=aZe(o),C),{}),{read:l,resolveKeyframes:c,update:d,preRender:u,render:p,postRender:m}=r,f=()=>{const C=performance.now();n=!1,i.delta=s?1e3/60:Math.max(Math.min(C-i.timestamp,rZe),1),i.timestamp=C,i.isProcessing=!0,l.process(i),c.process(i),d.process(i),u.process(i),p.process(i),m.process(i),i.isProcessing=!1,n&&t&&(s=!1,e(f))},g=()=>{n=!0,s=!0,i.isProcessing||e(f)};return{schedule:Nx.reduce((C,y)=>{const x=r[y];return C[y]=(w,_=!1,S=!1)=>(n||g(),x.schedule(w,_,S)),C},{}),cancel:C=>{for(let y=0;y<Nx.length;y++)r[Nx[y]].cancel(C)},state:i,steps:r}}const{schedule:is,cancel:au,state:Ei,steps:VE}=Gae(typeof requestAnimationFrame<"u"?requestAnimationFrame:Sa,!0),Hae=h.createContext({strict:!1}),Kz={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},qf={};for(const e in Kz)qf[e]={isEnabled:t=>Kz[e].some(n=>!!t[n])};function lZe(e){for(const t in e)qf[t]={...qf[t],...e[t]}}const cZe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function nw(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||cZe.has(e)}let Wae=e=>!nw(e);function dZe(e){e&&(Wae=t=>t.startsWith("on")?!nw(t):e(t))}try{dZe(require("@emotion/is-prop-valid").default)}catch{}function uZe(e,t,n){const s={};for(const i in e)i==="values"&&typeof e.values=="object"||(Wae(i)||n===!0&&nw(i)||!t&&!nw(i)||e.draggable&&i.startsWith("onDrag"))&&(s[i]=e[i]);return s}function hZe(e){if(typeof Proxy>"u")return e;const t=new Map,n=(...s)=>e(...s);return new Proxy(n,{get:(s,i)=>i==="create"?e:(t.has(i)||t.set(i,e(i)),t.get(i))})}const rk=h.createContext({});function xy(e){return typeof e=="string"||Array.isArray(e)}function lk(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const L3=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],R3=["initial",...L3];function ck(e){return lk(e.animate)||R3.some(t=>xy(e[t]))}function Uae(e){return!!(ck(e)||e.variants)}function pZe(e,t){if(ck(e)){const{initial:n,animate:s}=e;return{initial:n===!1||xy(n)?n:void 0,animate:xy(s)?s:void 0}}return e.inherit!==!1?t:{}}function fZe(e){const{initial:t,animate:n}=pZe(e,h.useContext(rk));return h.useMemo(()=>({initial:t,animate:n}),[Zz(t),Zz(n)])}function Zz(e){return Array.isArray(e)?e.join(" "):e}const mZe=Symbol.for("motionComponentSymbol");function af(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function gZe(e,t,n){return h.useCallback(s=>{s&&e.onMount&&e.onMount(s),t&&(s?t.mount(s):t.unmount()),n&&(typeof n=="function"?n(s):af(n)&&(n.current=s))},[t])}const O3=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),vZe="framerAppearId",qae="data-"+O3(vZe),{schedule:N3}=Gae(queueMicrotask,!1),Kae=h.createContext({});function yZe(e,t,n,s,i){var o,r;const{visualElement:l}=h.useContext(rk),c=h.useContext(Hae),d=h.useContext(ak),u=h.useContext(T3).reducedMotion,p=h.useRef(null);s=s||c.renderer,!p.current&&s&&(p.current=s(e,{visualState:t,parent:l,props:n,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:u}));const m=p.current,f=h.useContext(Kae);m&&!m.projection&&i&&(m.type==="html"||m.type==="svg")&&bZe(p.current,n,i,f);const g=h.useRef(!1);h.useInsertionEffect(()=>{m&&g.current&&m.update(n,d)});const v=n[qae],b=h.useRef(!!v&&!(!((o=window.MotionHandoffIsComplete)===null||o===void 0)&&o.call(window,v))&&((r=window.MotionHasOptimisedAnimation)===null||r===void 0?void 0:r.call(window,v)));return Vae(()=>{m&&(g.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),N3.render(m.render),b.current&&m.animationState&&m.animationState.animateChanges())}),h.useEffect(()=>{m&&(!b.current&&m.animationState&&m.animationState.animateChanges(),b.current&&(queueMicrotask(()=>{var C;(C=window.MotionHandoffMarkAsComplete)===null||C===void 0||C.call(window,v)}),b.current=!1))}),m}function bZe(e,t,n,s){const{layoutId:i,layout:o,drag:r,dragConstraints:l,layoutScroll:c,layoutRoot:d}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:Zae(e.parent)),e.projection.setOptions({layoutId:i,layout:o,alwaysMeasureLayout:!!r||l&&af(l),visualElement:e,animationType:typeof o=="string"?o:"both",initialPromotionConfig:s,layoutScroll:c,layoutRoot:d})}function Zae(e){if(e)return e.options.allowProjection!==!1?e.projection:Zae(e.parent)}function xZe({preloadedFeatures:e,createVisualElement:t,useRender:n,useVisualState:s,Component:i}){var o,r;e&&lZe(e);function l(d,u){let p;const m={...h.useContext(T3),...d,layoutId:CZe(d)},{isStatic:f}=m,g=fZe(d),v=s(d,f);if(!f&&D3){wZe();const b=_Ze(m);p=b.MeasureLayout,g.visualElement=yZe(i,v,m,t,b.ProjectionNode)}return a.jsxs(rk.Provider,{value:g,children:[p&&g.visualElement?a.jsx(p,{visualElement:g.visualElement,...m}):null,n(i,d,gZe(v,g.visualElement,u),v,f,g.visualElement)]})}l.displayName=`motion.${typeof i=="string"?i:`create(${(r=(o=i.displayName)!==null&&o!==void 0?o:i.name)!==null&&r!==void 0?r:""})`}`;const c=h.forwardRef(l);return c[mZe]=i,c}function CZe({layoutId:e}){const t=h.useContext(A3).id;return t&&e!==void 0?t+"-"+e:e}function wZe(e,t){h.useContext(Hae).strict}function _Ze(e){const{drag:t,layout:n}=qf;if(!t&&!n)return{};const s={...t,...n};return{MeasureLayout:t?.isEnabled(e)||n?.isEnabled(e)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}const SZe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function F3(e){return typeof e!="string"||e.includes("-")?!1:!!(SZe.indexOf(e)>-1||/[A-Z]/u.test(e))}function Xz(e){const t=[{},{}];return e?.values.forEach((n,s)=>{t[0][s]=n.get(),t[1][s]=n.getVelocity()}),t}function B3(e,t,n,s){if(typeof t=="function"){const[i,o]=Xz(s);t=t(n!==void 0?n:e.custom,i,o)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[i,o]=Xz(s);t=t(n!==void 0?n:e.custom,i,o)}return t}const KT=e=>Array.isArray(e),kZe=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),IZe=e=>KT(e)?e[e.length-1]||0:e,Xi=e=>!!(e&&e.getVelocity);function P2(e){const t=Xi(e)?e.get():e;return kZe(t)?t.toValue():t}function jZe({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:n},s,i,o){const r={latestValues:EZe(s,i,o,e),renderState:t()};return n&&(r.onMount=l=>n({props:s,current:l,...r}),r.onUpdate=l=>n(l)),r}const Xae=e=>(t,n)=>{const s=h.useContext(rk),i=h.useContext(ak),o=()=>jZe(e,t,s,i);return n?o():P3(o)};function EZe(e,t,n,s){const i={},o=s(e,{});for(const m in o)i[m]=P2(o[m]);let{initial:r,animate:l}=e;const c=ck(e),d=Uae(e);t&&d&&!c&&e.inherit!==!1&&(r===void 0&&(r=t.initial),l===void 0&&(l=t.animate));let u=n?n.initial===!1:!1;u=u||r===!1;const p=u?l:r;if(p&&typeof p!="boolean"&&!lk(p)){const m=Array.isArray(p)?p:[p];for(let f=0;f<m.length;f++){const g=B3(e,m[f]);if(g){const{transitionEnd:v,transition:b,...C}=g;for(const y in C){let x=C[y];if(Array.isArray(x)){const w=u?x.length-1:0;x=x[w]}x!==null&&(i[y]=x)}for(const y in v)i[y]=v[y]}}}return i}const Qm=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],np=new Set(Qm),Yae=e=>t=>typeof t=="string"&&t.startsWith(e),Qae=Yae("--"),AZe=Yae("var(--"),z3=e=>AZe(e)?PZe.test(e.split("/*")[0].trim()):!1,PZe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Jae=(e,t)=>t&&typeof e=="number"?t.transform(e):e,Uc=(e,t,n)=>n>t?t:n<e?e:n,Jm={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Cy={...Jm,transform:e=>Uc(0,1,e)},Fx={...Jm,default:1},Y1=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),gd=Y1("deg"),zl=Y1("%"),St=Y1("px"),TZe=Y1("vh"),DZe=Y1("vw"),Yz={...zl,parse:e=>zl.parse(e)/100,transform:e=>zl.transform(e*100)},MZe={borderWidth:St,borderTopWidth:St,borderRightWidth:St,borderBottomWidth:St,borderLeftWidth:St,borderRadius:St,radius:St,borderTopLeftRadius:St,borderTopRightRadius:St,borderBottomRightRadius:St,borderBottomLeftRadius:St,width:St,maxWidth:St,height:St,maxHeight:St,top:St,right:St,bottom:St,left:St,padding:St,paddingTop:St,paddingRight:St,paddingBottom:St,paddingLeft:St,margin:St,marginTop:St,marginRight:St,marginBottom:St,marginLeft:St,backgroundPositionX:St,backgroundPositionY:St},LZe={rotate:gd,rotateX:gd,rotateY:gd,rotateZ:gd,scale:Fx,scaleX:Fx,scaleY:Fx,scaleZ:Fx,skew:gd,skewX:gd,skewY:gd,distance:St,translateX:St,translateY:St,translateZ:St,x:St,y:St,z:St,perspective:St,transformPerspective:St,opacity:Cy,originX:Yz,originY:Yz,originZ:St},Qz={...Jm,transform:Math.round},V3={...MZe,...LZe,zIndex:Qz,size:St,fillOpacity:Cy,strokeOpacity:Cy,numOctaves:Qz},RZe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},OZe=Qm.length;function NZe(e,t,n){let s="",i=!0;for(let o=0;o<OZe;o++){const r=Qm[o],l=e[r];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(r.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=Jae(l,V3[r]);if(!c){i=!1;const u=RZe[r]||r;s+=`${u}(${d}) `}n&&(t[r]=d)}}return s=s.trim(),n?s=n(t,i?"":s):i&&(s="none"),s}function $3(e,t,n){const{style:s,vars:i,transformOrigin:o}=e;let r=!1,l=!1;for(const c in t){const d=t[c];if(np.has(c)){r=!0;continue}else if(Qae(c)){i[c]=d;continue}else{const u=Jae(d,V3[c]);c.startsWith("origin")?(l=!0,o[c]=u):s[c]=u}}if(t.transform||(r||n?s.transform=NZe(t,e.transform,n):s.transform&&(s.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=o;s.transformOrigin=`${c} ${d} ${u}`}}const FZe={offset:"stroke-dashoffset",array:"stroke-dasharray"},BZe={offset:"strokeDashoffset",array:"strokeDasharray"};function zZe(e,t,n=1,s=0,i=!0){e.pathLength=1;const o=i?FZe:BZe;e[o.offset]=St.transform(-s);const r=St.transform(t),l=St.transform(n);e[o.array]=`${r} ${l}`}function Jz(e,t,n){return typeof e=="string"?e:St.transform(t+n*e)}function VZe(e,t,n){const s=Jz(t,e.x,e.width),i=Jz(n,e.y,e.height);return`${s} ${i}`}function G3(e,{attrX:t,attrY:n,attrScale:s,originX:i,originY:o,pathLength:r,pathSpacing:l=1,pathOffset:c=0,...d},u,p){if($3(e,d,p),u){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:m,style:f,dimensions:g}=e;m.transform&&(g&&(f.transform=m.transform),delete m.transform),g&&(i!==void 0||o!==void 0||f.transform)&&(f.transformOrigin=VZe(g,i!==void 0?i:.5,o!==void 0?o:.5)),t!==void 0&&(m.x=t),n!==void 0&&(m.y=n),s!==void 0&&(m.scale=s),r!==void 0&&zZe(m,r,l,c,!1)}const H3=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),ere=()=>({...H3(),attrs:{}}),W3=e=>typeof e=="string"&&e.toLowerCase()==="svg";function tre(e,{style:t,vars:n},s,i){Object.assign(e.style,t,i&&i.getProjectionStyles(s));for(const o in n)e.style.setProperty(o,n[o])}const nre=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function sre(e,t,n,s){tre(e,t,void 0,s);for(const i in t.attrs)e.setAttribute(nre.has(i)?i:O3(i),t.attrs[i])}const sw={};function $Ze(e){Object.assign(sw,e)}function ire(e,{layout:t,layoutId:n}){return np.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!sw[e]||e==="opacity")}function U3(e,t,n){var s;const{style:i}=e,o={};for(const r in i)(Xi(i[r])||t.style&&Xi(t.style[r])||ire(r,e)||((s=n?.getValue(r))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(o[r]=i[r]);return o}function ore(e,t,n){const s=U3(e,t,n);for(const i in e)if(Xi(e[i])||Xi(t[i])){const o=Qm.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;s[o]=e[i]}return s}function GZe(e,t){try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const eV=["x","y","width","height","cx","cy","r"],HZe={useVisualState:Xae({scrapeMotionValuesFromProps:ore,createRenderState:ere,onUpdate:({props:e,prevProps:t,current:n,renderState:s,latestValues:i})=>{if(!n)return;let o=!!e.drag;if(!o){for(const l in i)if(np.has(l)){o=!0;break}}if(!o)return;let r=!t;if(t)for(let l=0;l<eV.length;l++){const c=eV[l];e[c]!==t[c]&&(r=!0)}r&&is.read(()=>{GZe(n,s),is.render(()=>{G3(s,i,W3(n.tagName),e.transformTemplate),sre(n,s)})})}})},WZe={useVisualState:Xae({scrapeMotionValuesFromProps:U3,createRenderState:H3})};function are(e,t,n){for(const s in t)!Xi(t[s])&&!ire(s,n)&&(e[s]=t[s])}function UZe({transformTemplate:e},t){return h.useMemo(()=>{const n=H3();return $3(n,t,e),Object.assign({},n.vars,n.style)},[t])}function qZe(e,t){const n=e.style||{},s={};return are(s,n,e),Object.assign(s,UZe(e,t)),s}function KZe(e,t){const n={},s=qZe(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=s,n}function ZZe(e,t,n,s){const i=h.useMemo(()=>{const o=ere();return G3(o,t,W3(s),e.transformTemplate),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};are(o,e.style,e),i.style={...o,...i.style}}return i}function XZe(e=!1){return(n,s,i,{latestValues:o},r)=>{const c=(F3(n)?ZZe:KZe)(s,o,r,n),d=uZe(s,typeof n=="string",e),u=n!==h.Fragment?{...d,...c,ref:i}:{},{children:p}=s,m=h.useMemo(()=>Xi(p)?p.get():p,[p]);return h.createElement(n,{...u,children:m})}}function YZe(e,t){return function(s,{forwardMotionProps:i}={forwardMotionProps:!1}){const r={...F3(s)?HZe:WZe,preloadedFeatures:e,useRender:XZe(i),createVisualElement:t,Component:s};return xZe(r)}}function rre(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}function dk(e,t,n){const s=e.getProps();return B3(s,t,n!==void 0?n:s.custom,e)}const QZe=M3(()=>window.ScrollTimeline!==void 0);class JZe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,n){for(let s=0;s<this.animations.length;s++)this.animations[s][t]=n}attachTimeline(t,n){const s=this.animations.map(i=>{if(QZe()&&i.attachTimeline)return i.attachTimeline(t);if(typeof n=="function")return n(i)});return()=>{s.forEach((i,o)=>{i&&i(),this.animations[o].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let n=0;n<this.animations.length;n++)t=Math.max(t,this.animations[n].duration);return t}runAll(t){this.animations.forEach(n=>n[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class eXe extends JZe{then(t,n){return Promise.all(this.animations).then(t).catch(n)}}function q3(e,t){return e?e[t]||e.default||e:void 0}const ZT=2e4;function lre(e){let t=0;const n=50;let s=e.next(t);for(;!s.done&&t<ZT;)t+=n,s=e.next(t);return t>=ZT?1/0:t}function K3(e){return typeof e=="function"}function tV(e,t){e.timeline=t,e.onfinish=null}const Z3=e=>Array.isArray(e)&&typeof e[0]=="number",tXe={linearEasing:void 0};function nXe(e,t){const n=M3(e);return()=>{var s;return(s=tXe[t])!==null&&s!==void 0?s:n()}}const iw=nXe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cre=(e,t,n=10)=>{let s="";const i=Math.max(Math.round(t/n),2);for(let o=0;o<i;o++)s+=e(Uf(0,i-1,o))+", ";return`linear(${s.substring(0,s.length-2)})`};function dre(e){return!!(typeof e=="function"&&iw()||!e||typeof e=="string"&&(e in XT||iw())||Z3(e)||Array.isArray(e)&&e.every(dre))}const K0=([e,t,n,s])=>`cubic-bezier(${e}, ${t}, ${n}, ${s})`,XT={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:K0([0,.65,.55,1]),circOut:K0([.55,0,1,.45]),backIn:K0([.31,.01,.66,-.59]),backOut:K0([.33,1.53,.69,.99])};function ure(e,t){if(e)return typeof e=="function"&&iw()?cre(e,t):Z3(e)?K0(e):Array.isArray(e)?e.map(n=>ure(n,t)||XT.easeOut):XT[e]}const _r={x:!1,y:!1};function hre(){return _r.x||_r.y}function sXe(e,t,n){var s;if(e instanceof Element)return[e];if(typeof e=="string"){let i=document;const o=(s=void 0)!==null&&s!==void 0?s:i.querySelectorAll(e);return o?Array.from(o):[]}return Array.from(e)}function pre(e,t){const n=sXe(e),s=new AbortController,i={passive:!0,...t,signal:s.signal};return[n,i,()=>s.abort()]}function nV(e){return t=>{t.pointerType==="touch"||hre()||e(t)}}function iXe(e,t,n={}){const[s,i,o]=pre(e,n),r=nV(l=>{const{target:c}=l,d=t(l);if(typeof d!="function"||!c)return;const u=nV(p=>{d(p),c.removeEventListener("pointerleave",u)});c.addEventListener("pointerleave",u,i)});return s.forEach(l=>{l.addEventListener("pointerenter",r,i)}),o}const fre=(e,t)=>t?e===t?!0:fre(e,t.parentElement):!1,X3=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,oXe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function aXe(e){return oXe.has(e.tagName)||e.tabIndex!==-1}const Z0=new WeakSet;function sV(e){return t=>{t.key==="Enter"&&e(t)}}function $E(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const rXe=(e,t)=>{const n=e.currentTarget;if(!n)return;const s=sV(()=>{if(Z0.has(n))return;$E(n,"down");const i=sV(()=>{$E(n,"up")}),o=()=>$E(n,"cancel");n.addEventListener("keyup",i,t),n.addEventListener("blur",o,t)});n.addEventListener("keydown",s,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",s),t)};function iV(e){return X3(e)&&!hre()}function lXe(e,t,n={}){const[s,i,o]=pre(e,n),r=l=>{const c=l.currentTarget;if(!iV(l)||Z0.has(c))return;Z0.add(c);const d=t(l),u=(f,g)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",m),!(!iV(f)||!Z0.has(c))&&(Z0.delete(c),typeof d=="function"&&d(f,{success:g}))},p=f=>{u(f,n.useGlobalTarget||fre(c,f.target))},m=f=>{u(f,!1)};window.addEventListener("pointerup",p,i),window.addEventListener("pointercancel",m,i)};return s.forEach(l=>{!aXe(l)&&l.getAttribute("tabindex")===null&&(l.tabIndex=0),(n.useGlobalTarget?window:l).addEventListener("pointerdown",r,i),l.addEventListener("focus",d=>rXe(d,i),i)}),o}function cXe(e){return e==="x"||e==="y"?_r[e]?null:(_r[e]=!0,()=>{_r[e]=!1}):_r.x||_r.y?null:(_r.x=_r.y=!0,()=>{_r.x=_r.y=!1})}const mre=new Set(["width","height","top","left","right","bottom",...Qm]);let T2;function dXe(){T2=void 0}const Vl={now:()=>(T2===void 0&&Vl.set(Ei.isProcessing||oZe.useManualTiming?Ei.timestamp:performance.now()),T2),set:e=>{T2=e,queueMicrotask(dXe)}};function Y3(e,t){e.indexOf(t)===-1&&e.push(t)}function Q3(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class J3{constructor(){this.subscriptions=[]}add(t){return Y3(this.subscriptions,t),()=>Q3(this.subscriptions,t)}notify(t,n,s){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](t,n,s);else for(let o=0;o<i;o++){const r=this.subscriptions[o];r&&r(t,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function gre(e,t){return t?e*(1e3/t):0}const oV=30,uXe=e=>!isNaN(parseFloat(e));class hXe{constructor(t,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(s,i=!0)=>{const o=Vl.now();this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),i&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=Vl.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=uXe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new J3);const s=this.events[t].add(n);return t==="change"?()=>{s(),is.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t,n=!0){!n||!this.passiveEffect?this.updateAndNotify(t,n):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-s}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Vl.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>oV)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,oV);return gre(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function wy(e,t){return new hXe(e,t)}function pXe(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,wy(n))}function fXe(e,t){const n=dk(e,t);let{transitionEnd:s={},transition:i={},...o}=n||{};o={...o,...s};for(const r in o){const l=IZe(o[r]);pXe(e,r,l)}}function mXe(e){return!!(Xi(e)&&e.add)}function YT(e,t){const n=e.getValue("willChange");if(mXe(n))return n.add(t)}function vre(e){return e.props[qae]}const yre=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,gXe=1e-7,vXe=12;function yXe(e,t,n,s,i){let o,r,l=0;do r=t+(n-t)/2,o=yre(r,s,i)-e,o>0?n=r:t=r;while(Math.abs(o)>gXe&&++l<vXe);return r}function Q1(e,t,n,s){if(e===t&&n===s)return Sa;const i=o=>yXe(o,0,1,e,n);return o=>o===0||o===1?o:yre(i(o),t,s)}const bre=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,xre=e=>t=>1-e(1-t),Cre=Q1(.33,1.53,.69,.99),e8=xre(Cre),wre=bre(e8),_re=e=>(e*=2)<1?.5*e8(e):.5*(2-Math.pow(2,-10*(e-1))),t8=e=>1-Math.sin(Math.acos(e)),Sre=xre(t8),kre=bre(t8),Ire=e=>/^0[^.\s]+$/u.test(e);function bXe(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||Ire(e):!0}const bv=e=>Math.round(e*1e5)/1e5,n8=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function xXe(e){return e==null}const CXe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,s8=(e,t)=>n=>!!(typeof n=="string"&&CXe.test(n)&&n.startsWith(e)||t&&!xXe(n)&&Object.prototype.hasOwnProperty.call(n,t)),jre=(e,t,n)=>s=>{if(typeof s!="string")return s;const[i,o,r,l]=s.match(n8);return{[e]:parseFloat(i),[t]:parseFloat(o),[n]:parseFloat(r),alpha:l!==void 0?parseFloat(l):1}},wXe=e=>Uc(0,255,e),GE={...Jm,transform:e=>Math.round(wXe(e))},sh={test:s8("rgb","red"),parse:jre("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:s=1})=>"rgba("+GE.transform(e)+", "+GE.transform(t)+", "+GE.transform(n)+", "+bv(Cy.transform(s))+")"};function _Xe(e){let t="",n="",s="",i="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),s=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),s=e.substring(3,4),i=e.substring(4,5),t+=t,n+=n,s+=s,i+=i),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:i?parseInt(i,16)/255:1}}const QT={test:s8("#"),parse:_Xe,transform:sh.transform},rf={test:s8("hsl","hue"),parse:jre("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:s=1})=>"hsla("+Math.round(e)+", "+zl.transform(bv(t))+", "+zl.transform(bv(n))+", "+bv(Cy.transform(s))+")"},Hi={test:e=>sh.test(e)||QT.test(e)||rf.test(e),parse:e=>sh.test(e)?sh.parse(e):rf.test(e)?rf.parse(e):QT.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?sh.transform(e):rf.transform(e)},SXe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function kXe(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(n8))===null||t===void 0?void 0:t.length)||0)+(((n=e.match(SXe))===null||n===void 0?void 0:n.length)||0)>0}const Ere="number",Are="color",IXe="var",jXe="var(",aV="${}",EXe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function _y(e){const t=e.toString(),n=[],s={color:[],number:[],var:[]},i=[];let o=0;const l=t.replace(EXe,c=>(Hi.test(c)?(s.color.push(o),i.push(Are),n.push(Hi.parse(c))):c.startsWith(jXe)?(s.var.push(o),i.push(IXe),n.push(c)):(s.number.push(o),i.push(Ere),n.push(parseFloat(c))),++o,aV)).split(aV);return{values:n,split:l,indexes:s,types:i}}function Pre(e){return _y(e).values}function Tre(e){const{split:t,types:n}=_y(e),s=t.length;return i=>{let o="";for(let r=0;r<s;r++)if(o+=t[r],i[r]!==void 0){const l=n[r];l===Ere?o+=bv(i[r]):l===Are?o+=Hi.transform(i[r]):o+=i[r]}return o}}const AXe=e=>typeof e=="number"?0:e;function PXe(e){const t=Pre(e);return Tre(e)(t.map(AXe))}const ru={test:kXe,parse:Pre,createTransformer:Tre,getAnimatableNone:PXe},TXe=new Set(["brightness","contrast","saturate","opacity"]);function DXe(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[s]=n.match(n8)||[];if(!s)return e;const i=n.replace(s,"");let o=TXe.has(t)?1:0;return s!==n&&(o*=100),t+"("+o+i+")"}const MXe=/\b([a-z-]*)\(.*?\)/gu,JT={...ru,getAnimatableNone:e=>{const t=e.match(MXe);return t?t.map(DXe).join(" "):e}},LXe={...V3,color:Hi,backgroundColor:Hi,outlineColor:Hi,fill:Hi,stroke:Hi,borderColor:Hi,borderTopColor:Hi,borderRightColor:Hi,borderBottomColor:Hi,borderLeftColor:Hi,filter:JT,WebkitFilter:JT},i8=e=>LXe[e];function Dre(e,t){let n=i8(e);return n!==JT&&(n=ru),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const RXe=new Set(["auto","none","0"]);function OXe(e,t,n){let s=0,i;for(;s<e.length&&!i;){const o=e[s];typeof o=="string"&&!RXe.has(o)&&_y(o).values.length&&(i=e[s]),s++}if(i&&n)for(const o of t)e[o]=Dre(n,i)}const rV=e=>e===Jm||e===St,lV=(e,t)=>parseFloat(e.split(", ")[t]),cV=(e,t)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const i=s.match(/^matrix3d\((.+)\)$/u);if(i)return lV(i[1],t);{const o=s.match(/^matrix\((.+)\)$/u);return o?lV(o[1],e):0}},NXe=new Set(["x","y","z"]),FXe=Qm.filter(e=>!NXe.has(e));function BXe(e){const t=[];return FXe.forEach(n=>{const s=e.getValue(n);s!==void 0&&(t.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),t}const Kf={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:cV(4,13),y:cV(5,14)};Kf.translateX=Kf.x;Kf.translateY=Kf.y;const ph=new Set;let eD=!1,tD=!1;function Mre(){if(tD){const e=Array.from(ph).filter(s=>s.needsMeasurement),t=new Set(e.map(s=>s.element)),n=new Map;t.forEach(s=>{const i=BXe(s);i.length&&(n.set(s,i),s.render())}),e.forEach(s=>s.measureInitialState()),t.forEach(s=>{s.render();const i=n.get(s);i&&i.forEach(([o,r])=>{var l;(l=s.getValue(o))===null||l===void 0||l.set(r)})}),e.forEach(s=>s.measureEndState()),e.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}tD=!1,eD=!1,ph.forEach(e=>e.complete()),ph.clear()}function Lre(){ph.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(tD=!0)})}function zXe(){Lre(),Mre()}class o8{constructor(t,n,s,i,o,r=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=s,this.motionValue=i,this.element=o,this.isAsync=r}scheduleResolve(){this.isScheduled=!0,this.isAsync?(ph.add(this),eD||(eD=!0,is.read(Lre),is.resolveKeyframes(Mre))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:s,motionValue:i}=this;for(let o=0;o<t.length;o++)if(t[o]===null)if(o===0){const r=i?.get(),l=t[t.length-1];if(r!==void 0)t[0]=r;else if(s&&n){const c=s.readValue(n,l);c!=null&&(t[0]=c)}t[0]===void 0&&(t[0]=l),i&&r===void 0&&i.set(t[0])}else t[o]=t[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),ph.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,ph.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Rre=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),VXe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function $Xe(e){const t=VXe.exec(e);if(!t)return[,];const[,n,s,i]=t;return[`--${n??s}`,i]}function Ore(e,t,n=1){const[s,i]=$Xe(e);if(!s)return;const o=window.getComputedStyle(t).getPropertyValue(s);if(o){const r=o.trim();return Rre(r)?parseFloat(r):r}return z3(i)?Ore(i,t,n+1):i}const Nre=e=>t=>t.test(e),GXe={test:e=>e==="auto",parse:e=>e},Fre=[Jm,St,zl,gd,DZe,TZe,GXe],dV=e=>Fre.find(Nre(e));class Bre extends o8{constructor(t,n,s,i,o){super(t,n,s,i,o,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:s}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<t.length;c++){let d=t[c];if(typeof d=="string"&&(d=d.trim(),z3(d))){const u=Ore(d,n.current);u!==void 0&&(t[c]=u),c===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!mre.has(s)||t.length!==2)return;const[i,o]=t,r=dV(i),l=dV(o);if(r!==l)if(rV(r)&&rV(l))for(let c=0;c<t.length;c++){const d=t[c];typeof d=="string"&&(t[c]=parseFloat(d))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,s=[];for(let i=0;i<t.length;i++)bXe(t[i])&&s.push(i);s.length&&OXe(t,s,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:s}=this;if(!t||!t.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Kf[s](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const i=n[n.length-1];i!==void 0&&t.getValue(s,i).jump(i,!1)}measureEndState(){var t;const{element:n,name:s,unresolvedKeyframes:i}=this;if(!n||!n.current)return;const o=n.getValue(s);o&&o.jump(this.measuredOrigin,!1);const r=i.length-1,l=i[r];i[r]=Kf[s](n.measureViewportBox(),window.getComputedStyle(n.current)),l!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=l),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([c,d])=>{n.getValue(c).set(d)}),this.resolveNoneKeyframes()}}const uV=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(ru.test(e)||e==="0")&&!e.startsWith("url("));function HXe(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function WXe(e,t,n,s){const i=e[0];if(i===null)return!1;if(t==="display"||t==="visibility")return!0;const o=e[e.length-1],r=uV(i,t),l=uV(o,t);return!r||!l?!1:HXe(e)||(n==="spring"||K3(n))&&s}const UXe=e=>e!==null;function uk(e,{repeat:t,repeatType:n="loop"},s){const i=e.filter(UXe),o=t&&n!=="loop"&&t%2===1?0:i.length-1;return!o||s===void 0?i[o]:s}const qXe=40;class zre{constructor({autoplay:t=!0,delay:n=0,type:s="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:r="loop",...l}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Vl.now(),this.options={autoplay:t,delay:n,type:s,repeat:i,repeatDelay:o,repeatType:r,...l},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>qXe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&zXe(),this._resolved}onKeyframesResolved(t,n){this.resolvedAt=Vl.now(),this.hasAttemptedResolve=!0;const{name:s,type:i,velocity:o,delay:r,onComplete:l,onUpdate:c,isGenerator:d}=this.options;if(!d&&!WXe(t,s,i,o))if(r)this.options.duration=0;else{c&&c(uk(t,this.options,n)),l&&l(),this.resolveFinishedPromise();return}const u=this.initPlayback(t,n);u!==!1&&(this._resolved={keyframes:t,finalKeyframe:n,...u},this.onPostResolved())}onPostResolved(){}then(t,n){return this.currentFinishedPromise.then(t,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const gs=(e,t,n)=>e+(t-e)*n;function HE(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function KXe({hue:e,saturation:t,lightness:n,alpha:s}){e/=360,t/=100,n/=100;let i=0,o=0,r=0;if(!t)i=o=r=n;else{const l=n<.5?n*(1+t):n+t-n*t,c=2*n-l;i=HE(c,l,e+1/3),o=HE(c,l,e),r=HE(c,l,e-1/3)}return{red:Math.round(i*255),green:Math.round(o*255),blue:Math.round(r*255),alpha:s}}function ow(e,t){return n=>n>0?t:e}const WE=(e,t,n)=>{const s=e*e,i=n*(t*t-s)+s;return i<0?0:Math.sqrt(i)},ZXe=[QT,sh,rf],XXe=e=>ZXe.find(t=>t.test(e));function hV(e){const t=XXe(e);if(!t)return!1;let n=t.parse(e);return t===rf&&(n=KXe(n)),n}const pV=(e,t)=>{const n=hV(e),s=hV(t);if(!n||!s)return ow(e,t);const i={...n};return o=>(i.red=WE(n.red,s.red,o),i.green=WE(n.green,s.green,o),i.blue=WE(n.blue,s.blue,o),i.alpha=gs(n.alpha,s.alpha,o),sh.transform(i))},YXe=(e,t)=>n=>t(e(n)),J1=(...e)=>e.reduce(YXe),nD=new Set(["none","hidden"]);function QXe(e,t){return nD.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function JXe(e,t){return n=>gs(e,t,n)}function a8(e){return typeof e=="number"?JXe:typeof e=="string"?z3(e)?ow:Hi.test(e)?pV:nYe:Array.isArray(e)?Vre:typeof e=="object"?Hi.test(e)?pV:eYe:ow}function Vre(e,t){const n=[...e],s=n.length,i=e.map((o,r)=>a8(o)(o,t[r]));return o=>{for(let r=0;r<s;r++)n[r]=i[r](o);return n}}function eYe(e,t){const n={...e,...t},s={};for(const i in n)e[i]!==void 0&&t[i]!==void 0&&(s[i]=a8(e[i])(e[i],t[i]));return i=>{for(const o in s)n[o]=s[o](i);return n}}function tYe(e,t){var n;const s=[],i={color:0,var:0,number:0};for(let o=0;o<t.values.length;o++){const r=t.types[o],l=e.indexes[r][i[r]],c=(n=e.values[l])!==null&&n!==void 0?n:0;s[o]=c,i[r]++}return s}const nYe=(e,t)=>{const n=ru.createTransformer(t),s=_y(e),i=_y(t);return s.indexes.var.length===i.indexes.var.length&&s.indexes.color.length===i.indexes.color.length&&s.indexes.number.length>=i.indexes.number.length?nD.has(e)&&!i.values.length||nD.has(t)&&!s.values.length?QXe(e,t):J1(Vre(tYe(s,i),i.values),n):ow(e,t)};function $re(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?gs(e,t,n):a8(e)(e,t)}const sYe=5;function Gre(e,t,n){const s=Math.max(t-sYe,0);return gre(n-e(s),t-s)}const xs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},UE=.001;function iYe({duration:e=xs.duration,bounce:t=xs.bounce,velocity:n=xs.velocity,mass:s=xs.mass}){let i,o,r=1-t;r=Uc(xs.minDamping,xs.maxDamping,r),e=Uc(xs.minDuration,xs.maxDuration,Fc(e)),r<1?(i=d=>{const u=d*r,p=u*e,m=u-n,f=sD(d,r),g=Math.exp(-p);return UE-m/f*g},o=d=>{const p=d*r*e,m=p*n+n,f=Math.pow(r,2)*Math.pow(d,2)*e,g=Math.exp(-p),v=sD(Math.pow(d,2),r);return(-i(d)+UE>0?-1:1)*((m-f)*g)/v}):(i=d=>{const u=Math.exp(-d*e),p=(d-n)*e+1;return-UE+u*p},o=d=>{const u=Math.exp(-d*e),p=(n-d)*(e*e);return u*p});const l=5/e,c=aYe(i,o,l);if(e=Nc(e),isNaN(c))return{stiffness:xs.stiffness,damping:xs.damping,duration:e};{const d=Math.pow(c,2)*s;return{stiffness:d,damping:r*2*Math.sqrt(s*d),duration:e}}}const oYe=12;function aYe(e,t,n){let s=n;for(let i=1;i<oYe;i++)s=s-e(s)/t(s);return s}function sD(e,t){return e*Math.sqrt(1-t*t)}const rYe=["duration","bounce"],lYe=["stiffness","damping","mass"];function fV(e,t){return t.some(n=>e[n]!==void 0)}function cYe(e){let t={velocity:xs.velocity,stiffness:xs.stiffness,damping:xs.damping,mass:xs.mass,isResolvedFromDuration:!1,...e};if(!fV(e,lYe)&&fV(e,rYe))if(e.visualDuration){const n=e.visualDuration,s=2*Math.PI/(n*1.2),i=s*s,o=2*Uc(.05,1,1-(e.bounce||0))*Math.sqrt(i);t={...t,mass:xs.mass,stiffness:i,damping:o}}else{const n=iYe(e);t={...t,...n,mass:xs.mass},t.isResolvedFromDuration=!0}return t}function Hre(e=xs.visualDuration,t=xs.bounce){const n=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:s,restDelta:i}=n;const o=n.keyframes[0],r=n.keyframes[n.keyframes.length-1],l={done:!1,value:o},{stiffness:c,damping:d,mass:u,duration:p,velocity:m,isResolvedFromDuration:f}=cYe({...n,velocity:-Fc(n.velocity||0)}),g=m||0,v=d/(2*Math.sqrt(c*u)),b=r-o,C=Fc(Math.sqrt(c/u)),y=Math.abs(b)<5;s||(s=y?xs.restSpeed.granular:xs.restSpeed.default),i||(i=y?xs.restDelta.granular:xs.restDelta.default);let x;if(v<1){const _=sD(C,v);x=S=>{const I=Math.exp(-v*C*S);return r-I*((g+v*C*b)/_*Math.sin(_*S)+b*Math.cos(_*S))}}else if(v===1)x=_=>r-Math.exp(-C*_)*(b+(g+C*b)*_);else{const _=C*Math.sqrt(v*v-1);x=S=>{const I=Math.exp(-v*C*S),k=Math.min(_*S,300);return r-I*((g+v*C*b)*Math.sinh(k)+_*b*Math.cosh(k))/_}}const w={calculatedDuration:f&&p||null,next:_=>{const S=x(_);if(f)l.done=_>=p;else{let I=0;v<1&&(I=_===0?Nc(g):Gre(x,_,S));const k=Math.abs(I)<=s,E=Math.abs(r-S)<=i;l.done=k&&E}return l.value=l.done?r:S,l},toString:()=>{const _=Math.min(lre(w),ZT),S=cre(I=>w.next(_*I).value,_,30);return _+"ms "+S}};return w}function mV({keyframes:e,velocity:t=0,power:n=.8,timeConstant:s=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:r,min:l,max:c,restDelta:d=.5,restSpeed:u}){const p=e[0],m={done:!1,value:p},f=k=>l!==void 0&&k<l||c!==void 0&&k>c,g=k=>l===void 0?c:c===void 0||Math.abs(l-k)<Math.abs(c-k)?l:c;let v=n*t;const b=p+v,C=r===void 0?b:r(b);C!==b&&(v=C-p);const y=k=>-v*Math.exp(-k/s),x=k=>C+y(k),w=k=>{const E=y(k),j=x(k);m.done=Math.abs(E)<=d,m.value=m.done?C:j};let _,S;const I=k=>{f(m.value)&&(_=k,S=Hre({keyframes:[m.value,g(m.value)],velocity:Gre(x,k,m.value),damping:i,stiffness:o,restDelta:d,restSpeed:u}))};return I(0),{calculatedDuration:null,next:k=>{let E=!1;return!S&&_===void 0&&(E=!0,w(k),I(k)),_!==void 0&&k>=_?S.next(k-_):(!E&&w(k),m)}}}const dYe=Q1(.42,0,1,1),uYe=Q1(0,0,.58,1),Wre=Q1(.42,0,.58,1),hYe=e=>Array.isArray(e)&&typeof e[0]!="number",pYe={linear:Sa,easeIn:dYe,easeInOut:Wre,easeOut:uYe,circIn:t8,circInOut:kre,circOut:Sre,backIn:e8,backInOut:wre,backOut:Cre,anticipate:_re},gV=e=>{if(Z3(e)){$ae(e.length===4);const[t,n,s,i]=e;return Q1(t,n,s,i)}else if(typeof e=="string")return pYe[e];return e};function fYe(e,t,n){const s=[],i=n||$re,o=e.length-1;for(let r=0;r<o;r++){let l=i(e[r],e[r+1]);if(t){const c=Array.isArray(t)?t[r]||Sa:t;l=J1(c,l)}s.push(l)}return s}function mYe(e,t,{clamp:n=!0,ease:s,mixer:i}={}){const o=e.length;if($ae(o===t.length),o===1)return()=>t[0];if(o===2&&t[0]===t[1])return()=>t[1];const r=e[0]===e[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const l=fYe(t,s,i),c=l.length,d=u=>{if(r&&u<e[0])return t[0];let p=0;if(c>1)for(;p<e.length-2&&!(u<e[p+1]);p++);const m=Uf(e[p],e[p+1],u);return l[p](m)};return n?u=>d(Uc(e[0],e[o-1],u)):d}function gYe(e,t){const n=e[e.length-1];for(let s=1;s<=t;s++){const i=Uf(0,t,s);e.push(gs(n,1,i))}}function vYe(e){const t=[0];return gYe(t,e.length-1),t}function yYe(e,t){return e.map(n=>n*t)}function bYe(e,t){return e.map(()=>t||Wre).splice(0,e.length-1)}function aw({duration:e=300,keyframes:t,times:n,ease:s="easeInOut"}){const i=hYe(s)?s.map(gV):gV(s),o={done:!1,value:t[0]},r=yYe(n&&n.length===t.length?n:vYe(t),e),l=mYe(r,t,{ease:Array.isArray(i)?i:bYe(t,i)});return{calculatedDuration:e,next:c=>(o.value=l(c),o.done=c>=e,o)}}const xYe=e=>{const t=({timestamp:n})=>e(n);return{start:()=>is.update(t,!0),stop:()=>au(t),now:()=>Ei.isProcessing?Ei.timestamp:Vl.now()}},CYe={decay:mV,inertia:mV,tween:aw,keyframes:aw,spring:Hre},wYe=e=>e/100;class r8 extends zre{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:c}=this.options;c&&c()};const{name:n,motionValue:s,element:i,keyframes:o}=this.options,r=i?.KeyframeResolver||o8,l=(c,d)=>this.onKeyframesResolved(c,d);this.resolver=new r(o,l,n,s,i),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:n="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:o,velocity:r=0}=this.options,l=K3(n)?n:CYe[n]||aw;let c,d;l!==aw&&typeof t[0]!="number"&&(c=J1(wYe,$re(t[0],t[1])),t=[0,100]);const u=l({...this.options,keyframes:t});o==="mirror"&&(d=l({...this.options,keyframes:[...t].reverse(),velocity:-r})),u.calculatedDuration===null&&(u.calculatedDuration=lre(u));const{calculatedDuration:p}=u,m=p+i,f=m*(s+1)-i;return{generator:u,mirroredGenerator:d,mapPercentToKeyframes:c,calculatedDuration:p,resolvedDuration:m,totalDuration:f}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,n=!1){const{resolved:s}=this;if(!s){const{keyframes:k}=this.options;return{done:!0,value:k[k.length-1]}}const{finalKeyframe:i,generator:o,mirroredGenerator:r,mapPercentToKeyframes:l,keyframes:c,calculatedDuration:d,totalDuration:u,resolvedDuration:p}=s;if(this.startTime===null)return o.next(0);const{delay:m,repeat:f,repeatType:g,repeatDelay:v,onUpdate:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-u/this.speed,this.startTime)),n?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const C=this.currentTime-m*(this.speed>=0?1:-1),y=this.speed>=0?C<0:C>u;this.currentTime=Math.max(C,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let x=this.currentTime,w=o;if(f){const k=Math.min(this.currentTime,u)/p;let E=Math.floor(k),j=k%1;!j&&k>=1&&(j=1),j===1&&E--,E=Math.min(E,f+1),!!(E%2)&&(g==="reverse"?(j=1-j,v&&(j-=v/p)):g==="mirror"&&(w=r)),x=Uc(0,1,j)*p}const _=y?{done:!1,value:c[0]}:w.next(x);l&&(_.value=l(_.value));let{done:S}=_;!y&&d!==null&&(S=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const I=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&S);return I&&i!==void 0&&(_.value=uk(c,this.options,i)),b&&b(_.value),I&&this.finish(),_}get duration(){const{resolved:t}=this;return t?Fc(t.calculatedDuration):0}get time(){return Fc(this.currentTime)}set time(t){t=Nc(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=Fc(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=xYe,onPlay:n,startTime:s}=this.options;this.driver||(this.driver=t(o=>this.tick(o))),n&&n();const i=this.driver.now();this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=i):this.startTime=s??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const _Ye=new Set(["opacity","clipPath","filter","transform"]);function SYe(e,t,n,{delay:s=0,duration:i=300,repeat:o=0,repeatType:r="loop",ease:l="easeInOut",times:c}={}){const d={[t]:n};c&&(d.offset=c);const u=ure(l,i);return Array.isArray(u)&&(d.easing=u),e.animate(d,{delay:s,duration:i,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:o+1,direction:r==="reverse"?"alternate":"normal"})}const kYe=M3(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),rw=10,IYe=2e4;function jYe(e){return K3(e.type)||e.type==="spring"||!dre(e.ease)}function EYe(e,t){const n=new r8({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:e[0]};const i=[];let o=0;for(;!s.done&&o<IYe;)s=n.sample(o),i.push(s.value),o+=rw;return{times:void 0,keyframes:i,duration:o-rw,ease:"linear"}}const Ure={anticipate:_re,backInOut:wre,circInOut:kre};function AYe(e){return e in Ure}class vV extends zre{constructor(t){super(t);const{name:n,motionValue:s,element:i,keyframes:o}=this.options;this.resolver=new Bre(o,(r,l)=>this.onKeyframesResolved(r,l),n,s,i),this.resolver.scheduleResolve()}initPlayback(t,n){let{duration:s=300,times:i,ease:o,type:r,motionValue:l,name:c,startTime:d}=this.options;if(!l.owner||!l.owner.current)return!1;if(typeof o=="string"&&iw()&&AYe(o)&&(o=Ure[o]),jYe(this.options)){const{onComplete:p,onUpdate:m,motionValue:f,element:g,...v}=this.options,b=EYe(t,v);t=b.keyframes,t.length===1&&(t[1]=t[0]),s=b.duration,i=b.times,o=b.ease,r="keyframes"}const u=SYe(l.owner.current,c,t,{...this.options,duration:s,times:i,ease:o});return u.startTime=d??this.calcStartTime(),this.pendingTimeline?(tV(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:p}=this.options;l.set(uk(t,this.options,n)),p&&p(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:s,times:i,type:r,ease:o,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:n}=t;return Fc(n)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:n}=t;return Fc(n.currentTime||0)}set time(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.currentTime=Nc(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:n}=t;return n.playbackRate}set speed(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:n}=t;return n.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:n}=t;return n.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:n}=this;if(!n)return Sa;const{animation:s}=n;tV(s,t)}return Sa}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:n,keyframes:s,duration:i,type:o,ease:r,times:l}=t;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:d,onUpdate:u,onComplete:p,element:m,...f}=this.options,g=new r8({...f,keyframes:s,duration:i,type:o,ease:r,times:l,isGenerator:!0}),v=Nc(this.time);d.setWithVelocity(g.sample(v-rw).value,g.sample(v).value,rw)}const{onStop:c}=this.options;c&&c(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:n,name:s,repeatDelay:i,repeatType:o,damping:r,type:l}=t;if(!n||!n.owner||!(n.owner.current instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=n.owner.getProps();return kYe()&&s&&_Ye.has(s)&&!c&&!d&&!i&&o!=="mirror"&&r!==0&&l!=="inertia"}}const PYe={type:"spring",stiffness:500,damping:25,restSpeed:10},TYe=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),DYe={type:"keyframes",duration:.8},MYe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},LYe=(e,{keyframes:t})=>t.length>2?DYe:np.has(e)?e.startsWith("scale")?TYe(t[1]):PYe:MYe;function RYe({when:e,delay:t,delayChildren:n,staggerChildren:s,staggerDirection:i,repeat:o,repeatType:r,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const l8=(e,t,n,s={},i,o)=>r=>{const l=q3(s,e)||{},c=l.delay||s.delay||0;let{elapsed:d=0}=s;d=d-Nc(c);let u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:m=>{t.set(m),l.onUpdate&&l.onUpdate(m)},onComplete:()=>{r(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:o?void 0:i};RYe(l)||(u={...u,...LYe(e,u)}),u.duration&&(u.duration=Nc(u.duration)),u.repeatDelay&&(u.repeatDelay=Nc(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let p=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(p=!0)),p&&!o&&t.get()!==void 0){const m=uk(u.keyframes,l);if(m!==void 0)return is.update(()=>{u.onUpdate(m),u.onComplete()}),new eXe([])}return!o&&vV.supports(u)?new vV(u):new r8(u)};function OYe({protectedKeys:e,needsAnimating:t},n){const s=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,s}function qre(e,t,{delay:n=0,transitionOverride:s,type:i}={}){var o;let{transition:r=e.getDefaultTransition(),transitionEnd:l,...c}=t;s&&(r=s);const d=[],u=i&&e.animationState&&e.animationState.getState()[i];for(const p in c){const m=e.getValue(p,(o=e.latestValues[p])!==null&&o!==void 0?o:null),f=c[p];if(f===void 0||u&&OYe(u,p))continue;const g={delay:n,...q3(r||{},p)};let v=!1;if(window.MotionHandoffAnimation){const C=vre(e);if(C){const y=window.MotionHandoffAnimation(C,p,is);y!==null&&(g.startTime=y,v=!0)}}YT(e,p),m.start(l8(p,m,f,e.shouldReduceMotion&&mre.has(p)?{type:!1}:g,e,v));const b=m.animation;b&&d.push(b)}return l&&Promise.all(d).then(()=>{is.update(()=>{l&&fXe(e,l)})}),d}function iD(e,t,n={}){var s;const i=dk(e,t,n.type==="exit"?(s=e.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:o=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(o=n.transitionOverride);const r=i?()=>Promise.all(qre(e,i,n)):()=>Promise.resolve(),l=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:u=0,staggerChildren:p,staggerDirection:m}=o;return NYe(e,t,u+d,p,m,n)}:()=>Promise.resolve(),{when:c}=o;if(c){const[d,u]=c==="beforeChildren"?[r,l]:[l,r];return d().then(()=>u())}else return Promise.all([r(),l(n.delay)])}function NYe(e,t,n=0,s=0,i=1,o){const r=[],l=(e.variantChildren.size-1)*s,c=i===1?(d=0)=>d*s:(d=0)=>l-d*s;return Array.from(e.variantChildren).sort(FYe).forEach((d,u)=>{d.notify("AnimationStart",t),r.push(iD(d,t,{...o,delay:n+c(u)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(r)}function FYe(e,t){return e.sortNodePosition(t)}function BYe(e,t,n={}){e.notify("AnimationStart",t);let s;if(Array.isArray(t)){const i=t.map(o=>iD(e,o,n));s=Promise.all(i)}else if(typeof t=="string")s=iD(e,t,n);else{const i=typeof t=="function"?dk(e,t,n.custom):t;s=Promise.all(qre(e,i,n))}return s.then(()=>{e.notify("AnimationComplete",t)})}const zYe=R3.length;function Kre(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?Kre(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<zYe;n++){const s=R3[n],i=e.props[s];(xy(i)||i===!1)&&(t[s]=i)}return t}const VYe=[...L3].reverse(),$Ye=L3.length;function GYe(e){return t=>Promise.all(t.map(({animation:n,options:s})=>BYe(e,n,s)))}function HYe(e){let t=GYe(e),n=yV(),s=!0;const i=c=>(d,u)=>{var p;const m=dk(e,u,c==="exit"?(p=e.presenceContext)===null||p===void 0?void 0:p.custom:void 0);if(m){const{transition:f,transitionEnd:g,...v}=m;d={...d,...v,...g}}return d};function o(c){t=c(e)}function r(c){const{props:d}=e,u=Kre(e.parent)||{},p=[],m=new Set;let f={},g=1/0;for(let b=0;b<$Ye;b++){const C=VYe[b],y=n[C],x=d[C]!==void 0?d[C]:u[C],w=xy(x),_=C===c?y.isActive:null;_===!1&&(g=b);let S=x===u[C]&&x!==d[C]&&w;if(S&&s&&e.manuallyAnimateOnMount&&(S=!1),y.protectedKeys={...f},!y.isActive&&_===null||!x&&!y.prevProp||lk(x)||typeof x=="boolean")continue;const I=WYe(y.prevProp,x);let k=I||C===c&&y.isActive&&!S&&w||b>g&&w,E=!1;const j=Array.isArray(x)?x:[x];let P=j.reduce(i(C),{});_===!1&&(P={});const{prevResolvedValues:D={}}=y,O={...D,...P},N=L=>{k=!0,m.has(L)&&(E=!0,m.delete(L)),y.needsAnimating[L]=!0;const V=e.getValue(L);V&&(V.liveStyle=!1)};for(const L in O){const V=P[L],K=D[L];if(f.hasOwnProperty(L))continue;let U=!1;KT(V)&&KT(K)?U=!rre(V,K):U=V!==K,U?V!=null?N(L):m.add(L):V!==void 0&&m.has(L)?N(L):y.protectedKeys[L]=!0}y.prevProp=x,y.prevResolvedValues=P,y.isActive&&(f={...f,...P}),s&&e.blockInitialAnimation&&(k=!1),k&&(!(S&&I)||E)&&p.push(...j.map(L=>({animation:L,options:{type:C}})))}if(m.size){const b={};m.forEach(C=>{const y=e.getBaseTarget(C),x=e.getValue(C);x&&(x.liveStyle=!0),b[C]=y??null}),p.push({animation:b})}let v=!!p.length;return s&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(v=!1),s=!1,v?t(p):Promise.resolve()}function l(c,d){var u;if(n[c].isActive===d)return Promise.resolve();(u=e.variantChildren)===null||u===void 0||u.forEach(m=>{var f;return(f=m.animationState)===null||f===void 0?void 0:f.setActive(c,d)}),n[c].isActive=d;const p=r(c);for(const m in n)n[m].protectedKeys={};return p}return{animateChanges:r,setActive:l,setAnimateFunction:o,getState:()=>n,reset:()=>{n=yV(),s=!0}}}function WYe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!rre(t,e):!1}function Ru(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function yV(){return{animate:Ru(!0),whileInView:Ru(),whileHover:Ru(),whileTap:Ru(),whileDrag:Ru(),whileFocus:Ru(),exit:Ru()}}class ju{constructor(t){this.isMounted=!1,this.node=t}update(){}}class UYe extends ju{constructor(t){super(t),t.animationState||(t.animationState=HYe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();lk(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let qYe=0;class KYe extends ju{constructor(){super(...arguments),this.id=qYe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const i=this.node.animationState.setActive("exit",!t);n&&!t&&i.then(()=>n(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const ZYe={animation:{Feature:UYe},exit:{Feature:KYe}};function Sy(e,t,n,s={passive:!0}){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n)}function eb(e){return{point:{x:e.pageX,y:e.pageY}}}const XYe=e=>t=>X3(t)&&e(t,eb(t));function xv(e,t,n,s){return Sy(e,t,XYe(n),s)}const bV=(e,t)=>Math.abs(e-t);function YYe(e,t){const n=bV(e.x,t.x),s=bV(e.y,t.y);return Math.sqrt(n**2+s**2)}class Zre{constructor(t,n,{transformPagePoint:s,contextWindow:i,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=KE(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,f=YYe(p.offset,{x:0,y:0})>=3;if(!m&&!f)return;const{point:g}=p,{timestamp:v}=Ei;this.history.push({...g,timestamp:v});const{onStart:b,onMove:C}=this.handlers;m||(b&&b(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),C&&C(this.lastMoveEvent,p)},this.handlePointerMove=(p,m)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=qE(m,this.transformPagePoint),is.update(this.updatePoint,!0)},this.handlePointerUp=(p,m)=>{this.end();const{onEnd:f,onSessionEnd:g,resumeAnimation:v}=this.handlers;if(this.dragSnapToOrigin&&v&&v(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=KE(p.type==="pointercancel"?this.lastMoveEventInfo:qE(m,this.transformPagePoint),this.history);this.startEvent&&f&&f(p,b),g&&g(p,b)},!X3(t))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=s,this.contextWindow=i||window;const r=eb(t),l=qE(r,this.transformPagePoint),{point:c}=l,{timestamp:d}=Ei;this.history=[{...c,timestamp:d}];const{onSessionStart:u}=n;u&&u(t,KE(l,this.history)),this.removeListeners=J1(xv(this.contextWindow,"pointermove",this.handlePointerMove),xv(this.contextWindow,"pointerup",this.handlePointerUp),xv(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),au(this.updatePoint)}}function qE(e,t){return t?{point:t(e.point)}:e}function xV(e,t){return{x:e.x-t.x,y:e.y-t.y}}function KE({point:e},t){return{point:e,delta:xV(e,Xre(t)),offset:xV(e,QYe(t)),velocity:JYe(t,.1)}}function QYe(e){return e[0]}function Xre(e){return e[e.length-1]}function JYe(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,s=null;const i=Xre(e);for(;n>=0&&(s=e[n],!(i.timestamp-s.timestamp>Nc(t)));)n--;if(!s)return{x:0,y:0};const o=Fc(i.timestamp-s.timestamp);if(o===0)return{x:0,y:0};const r={x:(i.x-s.x)/o,y:(i.y-s.y)/o};return r.x===1/0&&(r.x=0),r.y===1/0&&(r.y=0),r}const Yre=1e-4,eQe=1-Yre,tQe=1+Yre,Qre=.01,nQe=0-Qre,sQe=0+Qre;function Aa(e){return e.max-e.min}function iQe(e,t,n){return Math.abs(e-t)<=n}function CV(e,t,n,s=.5){e.origin=s,e.originPoint=gs(t.min,t.max,e.origin),e.scale=Aa(n)/Aa(t),e.translate=gs(n.min,n.max,e.origin)-e.originPoint,(e.scale>=eQe&&e.scale<=tQe||isNaN(e.scale))&&(e.scale=1),(e.translate>=nQe&&e.translate<=sQe||isNaN(e.translate))&&(e.translate=0)}function Cv(e,t,n,s){CV(e.x,t.x,n.x,s?s.originX:void 0),CV(e.y,t.y,n.y,s?s.originY:void 0)}function wV(e,t,n){e.min=n.min+t.min,e.max=e.min+Aa(t)}function oQe(e,t,n){wV(e.x,t.x,n.x),wV(e.y,t.y,n.y)}function _V(e,t,n){e.min=t.min-n.min,e.max=e.min+Aa(t)}function wv(e,t,n){_V(e.x,t.x,n.x),_V(e.y,t.y,n.y)}function aQe(e,{min:t,max:n},s){return t!==void 0&&e<t?e=s?gs(t,e,s.min):Math.max(e,t):n!==void 0&&e>n&&(e=s?gs(n,e,s.max):Math.min(e,n)),e}function SV(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function rQe(e,{top:t,left:n,bottom:s,right:i}){return{x:SV(e.x,n,i),y:SV(e.y,t,s)}}function kV(e,t){let n=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,s]=[s,n]),{min:n,max:s}}function lQe(e,t){return{x:kV(e.x,t.x),y:kV(e.y,t.y)}}function cQe(e,t){let n=.5;const s=Aa(e),i=Aa(t);return i>s?n=Uf(t.min,t.max-s,e.min):s>i&&(n=Uf(e.min,e.max-i,t.min)),Uc(0,1,n)}function dQe(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const oD=.35;function uQe(e=oD){return e===!1?e=0:e===!0&&(e=oD),{x:IV(e,"left","right"),y:IV(e,"top","bottom")}}function IV(e,t,n){return{min:jV(e,t),max:jV(e,n)}}function jV(e,t){return typeof e=="number"?e:e[t]||0}const EV=()=>({translate:0,scale:1,origin:0,originPoint:0}),lf=()=>({x:EV(),y:EV()}),AV=()=>({min:0,max:0}),js=()=>({x:AV(),y:AV()});function Na(e){return[e("x"),e("y")]}function Jre({top:e,left:t,right:n,bottom:s}){return{x:{min:t,max:n},y:{min:e,max:s}}}function hQe({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function pQe(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function ZE(e){return e===void 0||e===1}function aD({scale:e,scaleX:t,scaleY:n}){return!ZE(e)||!ZE(t)||!ZE(n)}function zu(e){return aD(e)||ele(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function ele(e){return PV(e.x)||PV(e.y)}function PV(e){return e&&e!=="0%"}function lw(e,t,n){const s=e-n,i=t*s;return n+i}function TV(e,t,n,s,i){return i!==void 0&&(e=lw(e,i,s)),lw(e,n,s)+t}function rD(e,t=0,n=1,s,i){e.min=TV(e.min,t,n,s,i),e.max=TV(e.max,t,n,s,i)}function tle(e,{x:t,y:n}){rD(e.x,t.translate,t.scale,t.originPoint),rD(e.y,n.translate,n.scale,n.originPoint)}const DV=.999999999999,MV=1.0000000000001;function fQe(e,t,n,s=!1){const i=n.length;if(!i)return;t.x=t.y=1;let o,r;for(let l=0;l<i;l++){o=n[l],r=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(s&&o.options.layoutScroll&&o.scroll&&o!==o.root&&df(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),r&&(t.x*=r.x.scale,t.y*=r.y.scale,tle(e,r)),s&&zu(o.latestValues)&&df(e,o.latestValues))}t.x<MV&&t.x>DV&&(t.x=1),t.y<MV&&t.y>DV&&(t.y=1)}function cf(e,t){e.min=e.min+t,e.max=e.max+t}function LV(e,t,n,s,i=.5){const o=gs(e.min,e.max,i);rD(e,t,n,o,s)}function df(e,t){LV(e.x,t.x,t.scaleX,t.scale,t.originX),LV(e.y,t.y,t.scaleY,t.scale,t.originY)}function nle(e,t){return Jre(pQe(e.getBoundingClientRect(),t))}function mQe(e,t,n){const s=nle(e,n),{scroll:i}=t;return i&&(cf(s.x,i.offset.x),cf(s.y,i.offset.y)),s}const sle=({current:e})=>e?e.ownerDocument.defaultView:null,gQe=new WeakMap;class vQe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=js(),this.visualElement=t}start(t,{snapToCursor:n=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=u=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(eb(u).point)},o=(u,p)=>{const{drag:m,dragPropagation:f,onDragStart:g}=this.getProps();if(m&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=cXe(m),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Na(b=>{let C=this.getAxisMotionValue(b).get()||0;if(zl.test(C)){const{projection:y}=this.visualElement;if(y&&y.layout){const x=y.layout.layoutBox[b];x&&(C=Aa(x)*(parseFloat(C)/100))}}this.originPoint[b]=C}),g&&is.postRender(()=>g(u,p)),YT(this.visualElement,"transform");const{animationState:v}=this.visualElement;v&&v.setActive("whileDrag",!0)},r=(u,p)=>{const{dragPropagation:m,dragDirectionLock:f,onDirectionLock:g,onDrag:v}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:b}=p;if(f&&this.currentDirection===null){this.currentDirection=yQe(b),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",p.point,b),this.updateAxis("y",p.point,b),this.visualElement.render(),v&&v(u,p)},l=(u,p)=>this.stop(u,p),c=()=>Na(u=>{var p;return this.getAnimationState(u)==="paused"&&((p=this.getAxisMotionValue(u).animation)===null||p===void 0?void 0:p.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new Zre(t,{onSessionStart:i,onStart:o,onMove:r,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:sle(this.visualElement)})}stop(t,n){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:i}=n;this.startAnimation(i);const{onDragEnd:o}=this.getProps();o&&is.postRender(()=>o(t,n))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,s){const{drag:i}=this.getProps();if(!s||!Bx(t,i,this.currentDirection))return;const o=this.getAxisMotionValue(t);let r=this.originPoint[t]+s[t];this.constraints&&this.constraints[t]&&(r=aQe(r,this.constraints[t],this.elastic[t])),o.set(r)}resolveConstraints(){var t;const{dragConstraints:n,dragElastic:s}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,o=this.constraints;n&&af(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&i?this.constraints=rQe(i.layoutBox,n):this.constraints=!1,this.elastic=uQe(s),o!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Na(r=>{this.constraints!==!1&&this.getAxisMotionValue(r)&&(this.constraints[r]=dQe(i.layoutBox[r],this.constraints[r]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!af(t))return!1;const s=t.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const o=mQe(s,i.root,this.visualElement.getTransformPagePoint());let r=lQe(i.layout.layoutBox,o);if(n){const l=n(hQe(r));this.hasMutatedConstraints=!!l,l&&(r=Jre(l))}return r}startAnimation(t){const{drag:n,dragMomentum:s,dragElastic:i,dragTransition:o,dragSnapToOrigin:r,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Na(u=>{if(!Bx(u,n,this.currentDirection))return;let p=c&&c[u]||{};r&&(p={min:0,max:0});const m=i?200:1e6,f=i?40:1e7,g={type:"inertia",velocity:s?t[u]:0,bounceStiffness:m,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...o,...p};return this.startAxisValueAnimation(u,g)});return Promise.all(d).then(l)}startAxisValueAnimation(t,n){const s=this.getAxisMotionValue(t);return YT(this.visualElement,t),s.start(l8(t,s,0,n,this.visualElement,!1))}stopAnimation(){Na(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Na(t=>{var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(t){var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,s=this.visualElement.getProps(),i=s[n];return i||this.visualElement.getValue(t,(s.initial?s.initial[t]:void 0)||0)}snapToCursor(t){Na(n=>{const{drag:s}=this.getProps();if(!Bx(n,s,this.currentDirection))return;const{projection:i}=this.visualElement,o=this.getAxisMotionValue(n);if(i&&i.layout){const{min:r,max:l}=i.layout.layoutBox[n];o.set(t[n]-gs(r,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!af(n)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Na(r=>{const l=this.getAxisMotionValue(r);if(l&&this.constraints!==!1){const c=l.get();i[r]=cQe({min:c,max:c},this.constraints[r])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Na(r=>{if(!Bx(r,t,null))return;const l=this.getAxisMotionValue(r),{min:c,max:d}=this.constraints[r];l.set(gs(c,d,i[r]))})}addListeners(){if(!this.visualElement.current)return;gQe.set(this.visualElement,this);const t=this.visualElement.current,n=xv(t,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),s=()=>{const{dragConstraints:c}=this.getProps();af(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,o=i.addEventListener("measure",s);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),is.read(s);const r=Sy(window,"resize",()=>this.scalePositionWithinConstraints()),l=i.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Na(u=>{const p=this.getAxisMotionValue(u);p&&(this.originPoint[u]+=c[u].translate,p.set(p.get()+c[u].translate))}),this.visualElement.render())});return()=>{r(),n(),o(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:o=!1,dragElastic:r=oD,dragMomentum:l=!0}=t;return{...t,drag:n,dragDirectionLock:s,dragPropagation:i,dragConstraints:o,dragElastic:r,dragMomentum:l}}}function Bx(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function yQe(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class bQe extends ju{constructor(t){super(t),this.removeGroupControls=Sa,this.removeListeners=Sa,this.controls=new vQe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Sa}unmount(){this.removeGroupControls(),this.removeListeners()}}const RV=e=>(t,n)=>{e&&is.postRender(()=>e(t,n))};class xQe extends ju{constructor(){super(...arguments),this.removePointerDownListener=Sa}onPointerDown(t){this.session=new Zre(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:sle(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:RV(t),onStart:RV(n),onMove:s,onEnd:(o,r)=>{delete this.session,i&&is.postRender(()=>i(o,r))}}}mount(){this.removePointerDownListener=xv(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const D2={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function OV(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const k0={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(St.test(e))e=parseFloat(e);else return e;const n=OV(e,t.target.x),s=OV(e,t.target.y);return`${n}% ${s}%`}},CQe={correct:(e,{treeScale:t,projectionDelta:n})=>{const s=e,i=ru.parse(e);if(i.length>5)return s;const o=ru.createTransformer(e),r=typeof i[0]!="number"?1:0,l=n.x.scale*t.x,c=n.y.scale*t.y;i[0+r]/=l,i[1+r]/=c;const d=gs(l,c,.5);return typeof i[2+r]=="number"&&(i[2+r]/=d),typeof i[3+r]=="number"&&(i[3+r]/=d),o(i)}};class wQe extends h.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s,layoutId:i}=this.props,{projection:o}=t;$Ze(_Qe),o&&(n.group&&n.group.add(o),s&&s.register&&i&&s.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),D2.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:s,drag:i,isPresent:o}=this.props,r=s.projection;return r&&(r.isPresent=o,i||t.layoutDependency!==n||n===void 0?r.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?r.promote():r.relegate()||is.postRender(()=>{const l=r.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),N3.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:i}=t;i&&(i.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function ile(e){const[t,n]=zae(),s=h.useContext(A3);return a.jsx(wQe,{...e,layoutGroup:s,switchLayoutGroup:h.useContext(Kae),isPresent:t,safeToRemove:n})}const _Qe={borderRadius:{...k0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:k0,borderTopRightRadius:k0,borderBottomLeftRadius:k0,borderBottomRightRadius:k0,boxShadow:CQe};function SQe(e,t,n){const s=Xi(e)?e:wy(e);return s.start(l8("",s,t,n)),s.animation}function kQe(e){return e instanceof SVGElement&&e.tagName!=="svg"}const IQe=(e,t)=>e.depth-t.depth;class jQe{constructor(){this.children=[],this.isDirty=!1}add(t){Y3(this.children,t),this.isDirty=!0}remove(t){Q3(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(IQe),this.isDirty=!1,this.children.forEach(t)}}function EQe(e,t){const n=Vl.now(),s=({timestamp:i})=>{const o=i-n;o>=t&&(au(s),e(o-t))};return is.read(s,!0),()=>au(s)}const ole=["TopLeft","TopRight","BottomLeft","BottomRight"],AQe=ole.length,NV=e=>typeof e=="string"?parseFloat(e):e,FV=e=>typeof e=="number"||St.test(e);function PQe(e,t,n,s,i,o){i?(e.opacity=gs(0,n.opacity!==void 0?n.opacity:1,TQe(s)),e.opacityExit=gs(t.opacity!==void 0?t.opacity:1,0,DQe(s))):o&&(e.opacity=gs(t.opacity!==void 0?t.opacity:1,n.opacity!==void 0?n.opacity:1,s));for(let r=0;r<AQe;r++){const l=`border${ole[r]}Radius`;let c=BV(t,l),d=BV(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||FV(c)===FV(d)?(e[l]=Math.max(gs(NV(c),NV(d),s),0),(zl.test(d)||zl.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||n.rotate)&&(e.rotate=gs(t.rotate||0,n.rotate||0,s))}function BV(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const TQe=ale(0,.5,Sre),DQe=ale(.5,.95,Sa);function ale(e,t,n){return s=>s<e?0:s>t?1:n(Uf(e,t,s))}function zV(e,t){e.min=t.min,e.max=t.max}function Ma(e,t){zV(e.x,t.x),zV(e.y,t.y)}function VV(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function $V(e,t,n,s,i){return e-=t,e=lw(e,1/n,s),i!==void 0&&(e=lw(e,1/i,s)),e}function MQe(e,t=0,n=1,s=.5,i,o=e,r=e){if(zl.test(t)&&(t=parseFloat(t),t=gs(r.min,r.max,t/100)-r.min),typeof t!="number")return;let l=gs(o.min,o.max,s);e===o&&(l-=t),e.min=$V(e.min,t,n,l,i),e.max=$V(e.max,t,n,l,i)}function GV(e,t,[n,s,i],o,r){MQe(e,t[n],t[s],t[i],t.scale,o,r)}const LQe=["x","scaleX","originX"],RQe=["y","scaleY","originY"];function HV(e,t,n,s){GV(e.x,t,LQe,n?n.x:void 0,s?s.x:void 0),GV(e.y,t,RQe,n?n.y:void 0,s?s.y:void 0)}function WV(e){return e.translate===0&&e.scale===1}function rle(e){return WV(e.x)&&WV(e.y)}function UV(e,t){return e.min===t.min&&e.max===t.max}function OQe(e,t){return UV(e.x,t.x)&&UV(e.y,t.y)}function qV(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function lle(e,t){return qV(e.x,t.x)&&qV(e.y,t.y)}function KV(e){return Aa(e.x)/Aa(e.y)}function ZV(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class NQe{constructor(){this.members=[]}add(t){Y3(this.members,t),t.scheduleRender()}remove(t){if(Q3(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(i=>t===i);if(n===0)return!1;let s;for(let i=n;i>=0;i--){const o=this.members[i];if(o.isPresent!==!1){s=o;break}}return s?(this.promote(s),!0):!1}promote(t,n){const s=this.lead;if(t!==s&&(this.prevLead=s,this.lead=t,t.show(),s)){s.instance&&s.scheduleRender(),t.scheduleRender(),t.resumeFrom=s,n&&(t.resumeFrom.preserveOpacity=!0),s.snapshot&&(t.snapshot=s.snapshot,t.snapshot.latestValues=s.animationValues||s.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:i}=t.options;i===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:s}=t;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function FQe(e,t,n){let s="";const i=e.x.translate/t.x,o=e.y.translate/t.y,r=n?.z||0;if((i||o||r)&&(s=`translate3d(${i}px, ${o}px, ${r}px) `),(t.x!==1||t.y!==1)&&(s+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:p,rotateY:m,skewX:f,skewY:g}=n;d&&(s=`perspective(${d}px) ${s}`),u&&(s+=`rotate(${u}deg) `),p&&(s+=`rotateX(${p}deg) `),m&&(s+=`rotateY(${m}deg) `),f&&(s+=`skewX(${f}deg) `),g&&(s+=`skewY(${g}deg) `)}const l=e.x.scale*t.x,c=e.y.scale*t.y;return(l!==1||c!==1)&&(s+=`scale(${l}, ${c})`),s||"none"}const Vu={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},X0=typeof window<"u"&&window.MotionDebug!==void 0,XE=["","X","Y","Z"],BQe={visibility:"hidden"},XV=1e3;let zQe=0;function YE(e,t,n,s){const{latestValues:i}=t;i[e]&&(n[e]=i[e],t.setStaticValue(e,0),s&&(s[e]=0))}function cle(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=vre(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:i,layoutId:o}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",is,!(i||o))}const{parent:s}=e;s&&!s.hasCheckedOptimisedAppear&&cle(s)}function dle({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:s,resetTransform:i}){return class{constructor(r={},l=t?.()){this.id=zQe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,X0&&(Vu.totalNodes=Vu.resolvedTargetDeltas=Vu.recalculatedProjection=0),this.nodes.forEach(GQe),this.nodes.forEach(KQe),this.nodes.forEach(ZQe),this.nodes.forEach(HQe),X0&&window.MotionDebug.record(Vu)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=r,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new jQe)}addEventListener(r,l){return this.eventHandlers.has(r)||this.eventHandlers.set(r,new J3),this.eventHandlers.get(r).add(l)}notifyListeners(r,...l){const c=this.eventHandlers.get(r);c&&c.notify(...l)}hasListeners(r){return this.eventHandlers.has(r)}mount(r,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=kQe(r),this.instance=r;const{layoutId:c,layout:d,visualElement:u}=this.options;if(u&&!u.current&&u.mount(r),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||c)&&(this.isLayoutDirty=!0),e){let p;const m=()=>this.root.updateBlockedByResize=!1;e(r,()=>{this.root.updateBlockedByResize=!0,p&&p(),p=EQe(m,250),D2.hasAnimatedSinceResize&&(D2.hasAnimatedSinceResize=!1,this.nodes.forEach(QV))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&u&&(c||d)&&this.addEventListener("didUpdate",({delta:p,hasLayoutChanged:m,hasRelativeTargetChanged:f,layout:g})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||u.getDefaultTransition()||eJe,{onLayoutAnimationStart:b,onLayoutAnimationComplete:C}=u.getProps(),y=!this.targetLayout||!lle(this.targetLayout,g)||f,x=!m&&f;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||x||m&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(p,x);const w={...q3(v,"layout"),onPlay:b,onComplete:C};(u.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w)}else m||QV(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=g})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const r=this.getStack();r&&r.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,au(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(XQe),this.animationId++)}getTransformTemplate(){const{visualElement:r}=this.options;return r&&r.getProps().transformTemplate}willUpdate(r=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cle(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const p=this.path[u];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),r&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(YV);return}this.isUpdating||this.nodes.forEach(UQe),this.isUpdating=!1,this.nodes.forEach(qQe),this.nodes.forEach(VQe),this.nodes.forEach($Qe),this.clearAllSnapshots();const l=Vl.now();Ei.delta=Uc(0,1e3/60,l-Ei.timestamp),Ei.timestamp=l,Ei.isProcessing=!0,VE.update.process(Ei),VE.preRender.process(Ei),VE.render.process(Ei),Ei.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,N3.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(WQe),this.sharedNodes.forEach(YQe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,is.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){is.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const r=this.layout;this.layout=this.measure(!1),this.layoutCorrected=js(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,r?r.layoutBox:void 0)}updateScroll(r="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===r&&(l=!1),l){const c=s(this.instance);this.scroll={animationId:this.root.animationId,phase:r,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const r=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!rle(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;r&&(l||zu(this.latestValues)||u)&&(i(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(r=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return r&&(c=this.removeTransform(c)),tJe(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var r;const{visualElement:l}=this.options;if(!l)return js();const c=l.measureViewportBox();if(!(((r=this.scroll)===null||r===void 0?void 0:r.wasRoot)||this.path.some(nJe))){const{scroll:u}=this.root;u&&(cf(c.x,u.offset.x),cf(c.y,u.offset.y))}return c}removeElementScroll(r){var l;const c=js();if(Ma(c,r),!((l=this.scroll)===null||l===void 0)&&l.wasRoot)return c;for(let d=0;d<this.path.length;d++){const u=this.path[d],{scroll:p,options:m}=u;u!==this.root&&p&&m.layoutScroll&&(p.wasRoot&&Ma(c,r),cf(c.x,p.offset.x),cf(c.y,p.offset.y))}return c}applyTransform(r,l=!1){const c=js();Ma(c,r);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&df(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),zu(u.latestValues)&&df(c,u.latestValues)}return zu(this.latestValues)&&df(c,this.latestValues),c}removeTransform(r){const l=js();Ma(l,r);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!zu(d.latestValues))continue;aD(d.latestValues)&&d.updateSnapshot();const u=js(),p=d.measurePageBox();Ma(u,p),HV(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return zu(this.latestValues)&&HV(l,this.latestValues),l}setTargetDelta(r){this.targetDelta=r,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(r){this.options={...this.options,...r,crossfade:r.crossfade!==void 0?r.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ei.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(r=!1){var l;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(r||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:p,layoutId:m}=this.options;if(!(!this.layout||!(p||m))){if(this.resolvedRelativeTargetAt=Ei.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=js(),this.relativeTargetOrigin=js(),wv(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),Ma(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=js(),this.targetWithTransforms=js()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),oQe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ma(this.target,this.layout.layoutBox),tle(this.target,this.targetDelta)):Ma(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=js(),this.relativeTargetOrigin=js(),wv(this.relativeTargetOrigin,this.target,f.target),Ma(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}X0&&Vu.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||aD(this.parent.latestValues)||ele(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var r;const l=this.getLead(),c=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((r=this.parent)===null||r===void 0)&&r.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===Ei.timestamp&&(d=!1),d)return;const{layout:u,layoutId:p}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||p))return;Ma(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,f=this.treeScale.y;fQe(this.layoutCorrected,this.treeScale,this.path,c),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox,l.targetWithTransforms=js());const{target:g}=l;if(!g){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(VV(this.prevProjectionDelta.x,this.projectionDelta.x),VV(this.prevProjectionDelta.y,this.projectionDelta.y)),Cv(this.projectionDelta,this.layoutCorrected,g,this.latestValues),(this.treeScale.x!==m||this.treeScale.y!==f||!ZV(this.projectionDelta.x,this.prevProjectionDelta.x)||!ZV(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",g)),X0&&Vu.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(r=!0){var l;if((l=this.options.visualElement)===null||l===void 0||l.scheduleRender(),r){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=lf(),this.projectionDelta=lf(),this.projectionDeltaWithTransform=lf()}setAnimationOrigin(r,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},p=lf();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const m=js(),f=c?c.source:void 0,g=this.layout?this.layout.source:void 0,v=f!==g,b=this.getStack(),C=!b||b.members.length<=1,y=!!(v&&!C&&this.options.crossfade===!0&&!this.path.some(JQe));this.animationProgress=0;let x;this.mixTargetDelta=w=>{const _=w/1e3;JV(p.x,r.x,_),JV(p.y,r.y,_),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(wv(m,this.layout.layoutBox,this.relativeParent.layout.layoutBox),QQe(this.relativeTarget,this.relativeTargetOrigin,m,_),x&&OQe(this.relativeTarget,x)&&(this.isProjectionDirty=!1),x||(x=js()),Ma(x,this.relativeTarget)),v&&(this.animationValues=u,PQe(u,d,this.latestValues,_,y,C)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=_},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(r){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(au(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=is.update(()=>{D2.hasAnimatedSinceResize=!0,this.currentAnimation=SQe(0,XV,{...r,onUpdate:l=>{this.mixTargetDelta(l),r.onUpdate&&r.onUpdate(l)},onComplete:()=>{r.onComplete&&r.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const r=this.getStack();r&&r.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(XV),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const r=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=r;if(!(!l||!c||!d)){if(this!==r&&this.layout&&d&&ule(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||js();const p=Aa(this.layout.layoutBox.x);c.x.min=r.target.x.min,c.x.max=c.x.min+p;const m=Aa(this.layout.layoutBox.y);c.y.min=r.target.y.min,c.y.max=c.y.min+m}Ma(l,c),df(l,u),Cv(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(r,l){this.sharedNodes.has(r)||this.sharedNodes.set(r,new NQe),this.sharedNodes.get(r).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const r=this.getStack();return r?r.lead===this:!0}getLead(){var r;const{layoutId:l}=this.options;return l?((r=this.getStack())===null||r===void 0?void 0:r.lead)||this:this}getPrevLead(){var r;const{layoutId:l}=this.options;return l?(r=this.getStack())===null||r===void 0?void 0:r.prevLead:void 0}getStack(){const{layoutId:r}=this.options;if(r)return this.root.sharedNodes.get(r)}promote({needsReset:r,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),r&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const r=this.getStack();return r?r.relegate(this):!1}resetSkewAndRotation(){const{visualElement:r}=this.options;if(!r)return;let l=!1;const{latestValues:c}=r;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&YE("z",r,d,this.animationValues);for(let u=0;u<XE.length;u++)YE(`rotate${XE[u]}`,r,d,this.animationValues),YE(`skew${XE[u]}`,r,d,this.animationValues);r.render();for(const u in d)r.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);r.scheduleRender()}getProjectionStyles(r){var l,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return BQe;const d={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=P2(r?.pointerEvents)||"",d.transform=u?u(this.latestValues,""):"none",d;const p=this.getLead();if(!this.projectionDelta||!this.layout||!p.target){const v={};return this.options.layoutId&&(v.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,v.pointerEvents=P2(r?.pointerEvents)||""),this.hasProjected&&!zu(this.latestValues)&&(v.transform=u?u({},""):"none",this.hasProjected=!1),v}const m=p.animationValues||p.latestValues;this.applyTransformsToTarget(),d.transform=FQe(this.projectionDeltaWithTransform,this.treeScale,m),u&&(d.transform=u(m,d.transform));const{x:f,y:g}=this.projectionDelta;d.transformOrigin=`${f.origin*100}% ${g.origin*100}% 0`,p.animationValues?d.opacity=p===this?(c=(l=m.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:m.opacityExit:d.opacity=p===this?m.opacity!==void 0?m.opacity:"":m.opacityExit!==void 0?m.opacityExit:0;for(const v in sw){if(m[v]===void 0)continue;const{correct:b,applyTo:C}=sw[v],y=d.transform==="none"?m[v]:b(m[v],p);if(C){const x=C.length;for(let w=0;w<x;w++)d[C[w]]=y}else d[v]=y}return this.options.layoutId&&(d.pointerEvents=p===this?P2(r?.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(r=>{var l;return(l=r.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(YV),this.root.sharedNodes.clear()}}}function VQe(e){e.updateLayout()}function $Qe(e){var t;const n=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:i}=e.layout,{animationType:o}=e.options,r=n.source!==e.layout.source;o==="size"?Na(p=>{const m=r?n.measuredBox[p]:n.layoutBox[p],f=Aa(m);m.min=s[p].min,m.max=m.min+f}):ule(o,n.layoutBox,s)&&Na(p=>{const m=r?n.measuredBox[p]:n.layoutBox[p],f=Aa(s[p]);m.max=m.min+f,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[p].max=e.relativeTarget[p].min+f)});const l=lf();Cv(l,s,n.layoutBox);const c=lf();r?Cv(c,e.applyTransform(i,!0),n.measuredBox):Cv(c,s,n.layoutBox);const d=!rle(l);let u=!1;if(!e.resumeFrom){const p=e.getClosestProjectingParent();if(p&&!p.resumeFrom){const{snapshot:m,layout:f}=p;if(m&&f){const g=js();wv(g,n.layoutBox,m.layoutBox);const v=js();wv(v,s,f.layoutBox),lle(g,v)||(u=!0),p.options.layoutRoot&&(e.relativeTarget=v,e.relativeTargetOrigin=g,e.relativeParent=p)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:s}=e.options;s&&s()}e.options.transition=void 0}function GQe(e){X0&&Vu.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function HQe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function WQe(e){e.clearSnapshot()}function YV(e){e.clearMeasurements()}function UQe(e){e.isLayoutDirty=!1}function qQe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function QV(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function KQe(e){e.resolveTargetDelta()}function ZQe(e){e.calcProjection()}function XQe(e){e.resetSkewAndRotation()}function YQe(e){e.removeLeadSnapshot()}function JV(e,t,n){e.translate=gs(t.translate,0,n),e.scale=gs(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function e$(e,t,n,s){e.min=gs(t.min,n.min,s),e.max=gs(t.max,n.max,s)}function QQe(e,t,n,s){e$(e.x,t.x,n.x,s),e$(e.y,t.y,n.y,s)}function JQe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const eJe={duration:.45,ease:[.4,0,.1,1]},t$=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),n$=t$("applewebkit/")&&!t$("chrome/")?Math.round:Sa;function s$(e){e.min=n$(e.min),e.max=n$(e.max)}function tJe(e){s$(e.x),s$(e.y)}function ule(e,t,n){return e==="position"||e==="preserve-aspect"&&!iQe(KV(t),KV(n),.2)}function nJe(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const sJe=dle({attachResizeListener:(e,t)=>Sy(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),QE={current:void 0},hle=dle({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!QE.current){const e=new sJe({});e.mount(window),e.setOptions({layoutScroll:!0}),QE.current=e}return QE.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),iJe={pan:{Feature:xQe},drag:{Feature:bQe,ProjectionNode:hle,MeasureLayout:ile}};function i$(e,t,n){const{props:s}=e;e.animationState&&s.whileHover&&e.animationState.setActive("whileHover",n==="Start");const i="onHover"+n,o=s[i];o&&is.postRender(()=>o(t,eb(t)))}class oJe extends ju{mount(){const{current:t}=this.node;t&&(this.unmount=iXe(t,n=>(i$(this.node,n,"Start"),s=>i$(this.node,s,"End"))))}unmount(){}}class aJe extends ju{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=J1(Sy(this.node.current,"focus",()=>this.onFocus()),Sy(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function o$(e,t,n){const{props:s}=e;e.animationState&&s.whileTap&&e.animationState.setActive("whileTap",n==="Start");const i="onTap"+(n==="End"?"":n),o=s[i];o&&is.postRender(()=>o(t,eb(t)))}class rJe extends ju{mount(){const{current:t}=this.node;t&&(this.unmount=lXe(t,n=>(o$(this.node,n,"Start"),(s,{success:i})=>o$(this.node,s,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const lD=new WeakMap,JE=new WeakMap,lJe=e=>{const t=lD.get(e.target);t&&t(e)},cJe=e=>{e.forEach(lJe)};function dJe({root:e,...t}){const n=e||document;JE.has(n)||JE.set(n,{});const s=JE.get(n),i=JSON.stringify(t);return s[i]||(s[i]=new IntersectionObserver(cJe,{root:e,...t})),s[i]}function uJe(e,t,n){const s=dJe(t);return lD.set(e,n),s.observe(e),()=>{lD.delete(e),s.unobserve(e)}}const hJe={some:0,all:1};class pJe extends ju{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:s,amount:i="some",once:o}=t,r={root:n?n.current:void 0,rootMargin:s,threshold:typeof i=="number"?i:hJe[i]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:p}=this.node.getProps(),m=d?u:p;m&&m(c)};return uJe(this.node.current,r,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(fJe(t,n))&&this.startObserver()}unmount(){}}function fJe({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const mJe={inView:{Feature:pJe},tap:{Feature:rJe},focus:{Feature:aJe},hover:{Feature:oJe}},gJe={layout:{ProjectionNode:hle,MeasureLayout:ile}},cD={current:null},ple={current:!1};function vJe(){if(ple.current=!0,!!D3)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>cD.current=e.matches;e.addListener(t),t()}else cD.current=!1}const yJe=[...Fre,Hi,ru],bJe=e=>yJe.find(Nre(e)),a$=new WeakMap;function xJe(e,t,n){for(const s in t){const i=t[s],o=n[s];if(Xi(i))e.addValue(s,i);else if(Xi(o))e.addValue(s,wy(i,{owner:e}));else if(o!==i)if(e.hasValue(s)){const r=e.getValue(s);r.liveStyle===!0?r.jump(i):r.hasAnimated||r.set(i)}else{const r=e.getStaticValue(s);e.addValue(s,wy(r!==void 0?r:i,{owner:e}))}}for(const s in n)t[s]===void 0&&e.removeValue(s);return t}const r$=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class CJe{scrapeMotionValuesFromProps(t,n,s){return{}}constructor({parent:t,props:n,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:o,visualState:r},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=o8,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=Vl.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,is.render(this.render,!1,!0))};const{latestValues:c,renderState:d,onUpdate:u}=r;this.onUpdate=u,this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=t,this.props=n,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=i,this.options=l,this.blockInitialAnimation=!!o,this.isControllingVariants=ck(n),this.isVariantNode=Uae(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:p,...m}=this.scrapeMotionValuesFromProps(n,{},this);for(const f in m){const g=m[f];c[f]!==void 0&&Xi(g)&&g.set(c[f],!1)}}mount(t){this.current=t,a$.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),ple.current||vJe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:cD.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){a$.delete(this.current),this.projection&&this.projection.unmount(),au(this.notifyUpdate),au(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const n=this.features[t];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const s=np.has(t),i=n.on("change",l=>{this.latestValues[t]=l,this.props.onUpdate&&is.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),o=n.on("renderRequest",this.scheduleRender);let r;window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{i(),o(),r&&r(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in qf){const n=qf[t];if(!n)continue;const{isEnabled:s,Feature:i}=n;if(!this.features[t]&&i&&s(this.props)&&(this.features[t]=new i(this)),this.features[t]){const o=this.features[t];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):js()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<r$.length;s++){const i=r$[s];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const o="on"+i,r=t[o];r&&(this.propEventSubscriptions[i]=this.on(i,r))}this.prevMotionValues=xJe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const s=this.values.get(t);n!==s&&(s&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let s=this.values.get(t);return s===void 0&&n!==void 0&&(s=wy(n===null?void 0:n,{owner:this}),this.addValue(t,s)),s}readValue(t,n){var s;let i=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(s=this.getBaseTargetFromProps(this.props,t))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,t,this.options);return i!=null&&(typeof i=="string"&&(Rre(i)||Ire(i))?i=parseFloat(i):!bJe(i)&&ru.test(n)&&(i=Dre(t,n)),this.setBaseTarget(t,Xi(i)?i.get():i)),Xi(i)?i.get():i}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var n;const{initial:s}=this.props;let i;if(typeof s=="string"||typeof s=="object"){const r=B3(this.props,s,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);r&&(i=r[t])}if(s&&i!==void 0)return i;const o=this.getBaseTargetFromProps(this.props,t);return o!==void 0&&!Xi(o)?o:this.initialValues[t]!==void 0&&i===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new J3),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}}class fle extends CJe{constructor(){super(...arguments),this.KeyframeResolver=Bre}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:s}){delete n[t],delete s[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Xi(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function wJe(e){return window.getComputedStyle(e)}class _Je extends fle{constructor(){super(...arguments),this.type="html",this.renderInstance=tre}readValueFromInstance(t,n){if(np.has(n)){const s=i8(n);return s&&s.default||0}else{const s=wJe(t),i=(Qae(n)?s.getPropertyValue(n):s[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(t,{transformPagePoint:n}){return nle(t,n)}build(t,n,s){$3(t,n,s.transformTemplate)}scrapeMotionValuesFromProps(t,n,s){return U3(t,n,s)}}class SJe extends fle{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=js}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(np.has(n)){const s=i8(n);return s&&s.default||0}return n=nre.has(n)?n:O3(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,s){return ore(t,n,s)}build(t,n,s){G3(t,n,this.isSVGTag,s.transformTemplate)}renderInstance(t,n,s,i){sre(t,n,s,i)}mount(t){this.isSVGTag=W3(t.tagName),super.mount(t)}}const kJe=(e,t)=>F3(e)?new SJe(t):new _Je(t,{allowProjection:e!==h.Fragment}),IJe=YZe({...ZYe,...mJe,...iJe,...gJe},kJe),mle=hZe(IJe),jJe=ve(sM,e=>e.shouldAntialiasProgressImage),gle=h.memo(({progressImage:e})=>{const t=M(jJe),n=h.useMemo(()=>({imageRendering:t?"auto":"pixelated"}),[t]);return a.jsx(A,{width:"full",height:"full",alignItems:"center",justifyContent:"center",minW:0,minH:0,children:a.jsx(Nn,{src:e.dataURL,width:e.width,height:e.height,draggable:!1,"data-testid":"progress-image",objectFit:"contain",maxWidth:"full",maxHeight:"full",borderRadius:"base",sx:n,minH:0,minW:0})})});gle.displayName="ProgressImage";const EJe={circle:{transitionProperty:"none",transitionDuration:"0s"}},vle=h.memo(({progressEvent:e,...t})=>a.jsx(He,{label:n4(e),children:a.jsx(W2,{size:"14px",color:"invokeBlue.500",thickness:14,isIndeterminate:!e||e.percentage===null,value:e?.percentage?e.percentage*100:void 0,sx:EJe,...t})}));vle.displayName="ProgressMessage";const AJe=e=>/\.(mp4|webm|mov)$/i.test(e),PJe=e=>/\.(mp3|wav|ogg)$/i.test(e),yle=h.memo(({imageDTO:e})=>{const t=M(nU),n=M(c_),{onLoadImage:s,$progressEvent:i,$progressImage:o}=eae(),r=le(i),l=le(o),[c,d]=h.useState(!1),u=h.useRef(0),p=h.useCallback(()=>{d(!0),window.clearTimeout(u.current)},[]),m=h.useCallback(()=>{u.current=window.setTimeout(()=>{d(!1)},500)},[]),f=n&&l!==null;return a.jsxs(A,{onMouseOver:p,onMouseOut:m,width:"full",height:"full",alignItems:"center",justifyContent:"center",position:"relative",children:[e&&a.jsx(A,{w:"full",h:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:AJe(e.image_name)?a.jsx("video",{controls:!0,autoPlay:!0,src:e.image_url,style:{maxWidth:"100%",maxHeight:"100%"}}):PJe(e.image_name)?a.jsx("audio",{controls:!0,autoPlay:!0,src:e.image_url}):a.jsx(lc,{imageDTO:e,onLoad:s,borderRadius:"base"})},e.image_name),!e&&a.jsx(EX,{}),f&&a.jsxs(A,{w:"full",h:"full",position:"absolute",alignItems:"center",justifyContent:"center",bg:"base.900",children:[a.jsx(gle,{progressImage:l}),r&&a.jsx(vle,{progressEvent:r,position:"absolute",top:6,right:6,size:8})]}),a.jsx(A,{flexDir:"column",gap:2,position:"absolute",top:0,insetInlineStart:0,alignItems:"flex-start",children:a.jsx(j3,{})}),t&&e&&!f&&a.jsx(ke,{position:"absolute",opacity:.8,top:0,width:"full",height:"full",borderRadius:"base",children:a.jsx(QKe,{image:e})}),a.jsx(iZe,{children:c&&e&&a.jsx(ke,{as:mle.div,initial:TJe,animate:DJe,exit:MJe,position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:a.jsx(Bae,{})},"nextPrevButtons")})]})});yle.displayName="CurrentImagePreview";const TJe={opacity:0},DJe={opacity:1,transition:{duration:.07}},MJe={opacity:0,transition:{duration:.07}},ble=h.memo(()=>{const e=Q(),t=eae(),n=le(t.$hasProgressImage),s=M(c_),i=n&&s,o=M(nU),r=M(or),{t:l}=T(),c=h.useCallback(()=>{e(e2e(!o))},[e,o]);return Be({id:"toggleMetadata",category:"viewer",callback:c,dependencies:[r,o]}),a.jsx(oe,{icon:a.jsx(km,{}),tooltip:`${l("parameters.info")} (I)`,"aria-label":`${l("parameters.info")} (I)`,onClick:c,variant:"link",alignSelf:"stretch",colorScheme:o?"invokeBlue":"base","data-testid":"toggle-show-metadata-button",isDisabled:i})});ble.displayName="ToggleMetadataViewerButton";const xle=h.memo(e=>{const{onClick:t,isDisabled:n}=e,{t:s}=T(),i=le(ks),o=M(Oy),r=`${s("gallery.deleteImage",{count:o})} (Del)`;return a.jsx(oe,{onClick:t,icon:a.jsx(Ea,{}),tooltip:r,"aria-label":r,isDisabled:n||!i,colorScheme:"error",variant:"link",alignSelf:"stretch"})});xle.displayName="DeleteImageButton";const LJe=e=>{const t=Jf(),n=h.useMemo(()=>{if(e)return!0},[e]);return{delete:h.useCallback(()=>{e&&n&&t.delete([e.image_name])},[t,e,n]),isEnabled:n}},RJe=e=>{const{t}=T(),{getState:n,dispatch:s}=Ze(),i=pm(),o=Io(),r=h.useMemo(()=>!(!e||o),[e,o]);return{edit:h.useCallback(async()=>{e&&r&&(await Dd({imageDTO:e,type:"raster_layer",withInpaintMask:!0,getState:n,dispatch:s}),Ne.focusPanel("canvas",Zn),i&&i.tool.$tool.set("brush"),pe({id:"SENT_TO_CANVAS",title:t("toast.sentToCanvas"),status:"success"}))},[e,r,n,s,i,t]),isEnabled:r}},nl=e=>{const{t}=T(),{modelConfigs:n,selectedModel:s,getIsDisabled:i,onChange:o,isLoading:r,optionsFilter:l=()=>!0}=e,c=M(d_),d=h.useMemo(()=>n.filter(l).map(g=>({label:g.name,value:g.key,description:c&&g.description||void 0,isDisabled:i?i(g):!1})),[l,i,n,c]),u=h.useMemo(()=>d.find(g=>s?g.value===s.key:!1)??null,[d,s]),p=h.useCallback(g=>{if(!g){o(null);return}const v=n.find(b=>b.key===g.value);if(!v){o(null);return}o(v)},[n,o]),m=h.useMemo(()=>r?t("common.loading"):d.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[r,d,t]),f=h.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:d,value:u,onChange:p,placeholder:m,noOptionsMessage:f}},OJe=()=>{const{t:e}=T(),[t,{isLoading:n}]=PM(),s=M(sU),i=Q(),o=h.useMemo(()=>{if(!(!t.length||!s))return t.find(m=>m.key===s?.key)?.description},[t,s]),r=h.useCallback(m=>{i(t2e(m))},[i]),{options:l,value:c,onChange:d,placeholder:u,noOptionsMessage:p}=nl({modelConfigs:t,onChange:r,selectedModel:s,isLoading:n});return a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:e("upscaling.postProcessingModel")}),a.jsx(A,{w:"full",alignItems:"center",gap:2,children:a.jsx(He,{label:o,children:a.jsx(ke,{w:"full",children:a.jsx(pt,{value:c,placeholder:u,options:l,onChange:d,noOptionsMessage:p,isDisabled:l.length===0})})})})]})},NJe=h.memo(OJe),FJe=()=>{const[e,{isLoading:t}]=XD(cu),[n,{isLoading:s}]=iU({fixedCacheKey:"resumeProcessor"}),[i,{isLoading:o}]=oU({fixedCacheKey:"pauseProcessor"}),[r,{isLoading:l}]=aU({fixedCacheKey:"cancelQueueItem"}),[c,{isLoading:d}]=$G({fixedCacheKey:"clearQueue"}),[u,{isLoading:p}]=rU({fixedCacheKey:"pruneQueue"});return t||s||o||l||d||p},Cle=h.memo(e=>{const{imageDTO:t,isDisabled:n}=e,s=Q(),i=M(sU),o=FJe(),{t:r}=T(),{isOpen:l,onOpen:c,onClose:d}=jo(),u=h.useCallback(()=>{d(),t&&s(n2e({imageDTO:t}))},[s,t,d]);return a.jsxs(yi,{isOpen:l,onClose:d,isLazy:!0,children:[a.jsx(Ni,{children:a.jsx(oe,{tooltip:r("parameters.postProcessing"),onClick:c,icon:a.jsx(Sm,{}),"aria-label":r("parameters.postProcessing"),variant:"link",alignSelf:"stretch",isDisabled:n})}),a.jsx(Ls,{children:a.jsx(bi,{children:a.jsx(Fi,{w:96,children:a.jsxs(A,{flexDirection:"column",gap:4,children:[a.jsx(NJe,{}),!i&&a.jsx(BJe,{}),a.jsx(he,{size:"sm",isDisabled:n||!t||o||!i,onClick:u,children:r("parameters.processImage")})]})})})})]})});Cle.displayName="PostProcessingPopover";const BJe=()=>{const e=h.useCallback(()=>{Ne.switchToTab("models"),El("launchpad")},[]);return a.jsx(A,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:a.jsx(q,{children:a.jsx(Bn,{i18nKey:"upscaling.postProcessingMissingModelWarning",components:{LinkComponent:a.jsx(he,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:e})}})})})},wle=h.memo(({imageDTO:e})=>{const{t}=T(),n=M(un),s=Q(),i=M(un),o=n6(i),r=h.useMemo(()=>!e.is_intermediate,[e]),l=h.useCallback(()=>{Ne.expandRightPanel(),o.expand(),pu.flushSync(()=>{s(sm({boardId:e.board_id??"none",select:{selection:[e.image_name],galleryView:dW.includes(e.image_category)?"images":"assets"}}))})},[s,o,e]),c=n==="canvas"||n==="generate",d=n==="canvas"||n==="generate"||n==="upscaling",u=n==="canvas"||n==="generate"||n==="workflows"||n==="upscaling",p=T5(e),m=M5(e),f=hS(e),g=pS(e),v=D5(e),b=bY(e),C=RJe(e),y=LJe(e);return a.jsxs(a.Fragment,{children:[a.jsxs(An,{isLazy:!0,children:[a.jsx(Pn,{as:oe,"aria-label":t("parameters.imageActions"),tooltip:t("parameters.imageActions"),isDisabled:!e,variant:"link",alignSelf:"stretch",icon:a.jsx(Z4,{})}),a.jsx(Zt,{children:e&&a.jsx(YQ,{imageDTO:e})})]}),a.jsx(vt,{orientation:"vertical",h:8,mx:2}),a.jsx(he,{leftIcon:a.jsx(Im,{}),onClick:C.edit,isDisabled:!C.isEnabled,variant:"link",size:"sm",alignSelf:"stretch",px:2,children:t("common.edit")}),a.jsx(vt,{orientation:"vertical",h:8,mx:2}),u&&r&&a.jsx(oe,{icon:a.jsx(iX,{}),"aria-label":t("boards.locateInGalery"),tooltip:t("boards.locateInGalery"),onClick:l,variant:"link",size:"sm",alignSelf:"stretch"}),a.jsx(oe,{icon:a.jsx(h1,{}),tooltip:`${t("nodes.loadWorkflow")} (W)`,"aria-label":`${t("nodes.loadWorkflow")} (W)`,isDisabled:!b.isEnabled,variant:"link",alignSelf:"stretch",onClick:b.load}),c&&a.jsx(oe,{icon:a.jsx(aC,{}),tooltip:`${t("parameters.remixImage")} (R)`,"aria-label":`${t("parameters.remixImage")} (R)`,isDisabled:!m.isEnabled,variant:"link",alignSelf:"stretch",onClick:m.recall}),d&&a.jsx(oe,{icon:a.jsx(q4,{}),tooltip:`${t("parameters.usePrompt")} (P)`,"aria-label":`${t("parameters.usePrompt")} (P)`,isDisabled:!f.isEnabled,variant:"link",alignSelf:"stretch",onClick:f.recall}),d&&a.jsx(oe,{icon:a.jsx(W4,{}),tooltip:`${t("parameters.useSeed")} (S)`,"aria-label":`${t("parameters.useSeed")} (S)`,isDisabled:!g.isEnabled,variant:"link",alignSelf:"stretch",onClick:g.recall}),c&&a.jsx(oe,{icon:a.jsx(qv,{}),tooltip:`${t("parameters.useSize")} (D)`,"aria-label":`${t("parameters.useSize")} (D)`,variant:"link",alignSelf:"stretch",onClick:v.recall,isDisabled:!v.isEnabled}),c&&a.jsx(oe,{icon:a.jsx(eX,{}),tooltip:`${t("parameters.useAll")} (A)`,"aria-label":`${t("parameters.useAll")} (A)`,isDisabled:!p.isEnabled,variant:"link",alignSelf:"stretch",onClick:p.recall}),a.jsx(Cle,{imageDTO:e,isDisabled:!1}),a.jsx(vt,{orientation:"vertical",h:8,mx:2}),a.jsx(xle,{onClick:y.delete,isDisabled:!y.isEnabled})]})});wle.displayName="CurrentImageButtons";const _le=h.memo(()=>{const e=Q(),t=M(c_),{t:n}=T(),s=h.useCallback(()=>{e(_W(!t))},[e,t]);return a.jsx(oe,{"aria-label":n("settings.displayInProgress"),tooltip:n("settings.displayInProgress"),icon:a.jsx(YDe,{}),onClick:s,variant:"link",alignSelf:"stretch",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-progress-button"})});_le.displayName="ToggleProgressButton";const Sle=h.memo(()=>{const e=M(or),t=Jd(e);return a.jsxs(A,{w:"full",justifyContent:"center",h:8,children:[a.jsx(_le,{}),a.jsx(At,{}),t&&a.jsx(wle,{imageDTO:t}),a.jsx(At,{}),t&&a.jsx(ble,{})]})});Sle.displayName="ImageViewerToolbar";const zJe=Wv.getData(),dD=h.memo(()=>{const{t:e}=T(),t=M(or),n=Jd(t??null);return a.jsxs(A,{flexDir:"column",w:"full",h:"full",overflow:"hidden",gap:2,position:"relative",children:[a.jsx(Sle,{}),a.jsx(vt,{}),a.jsxs(A,{w:"full",h:"full",position:"relative",children:[a.jsx(yle,{imageDTO:n}),a.jsx(ds,{dndTarget:Wv,dndTargetData:zJe,label:e("gallery.selectForCompare")})]})]})});dD.displayName="ImageViewer";const VJe=ve([or,JW],(e,t)=>!!e&&!!t),tb=h.memo(()=>{const e=M(VJe),t=M(or);return a.jsxs(Joe,{children:[!e&&!t&&a.jsx(dD,{}),!e&&a.jsx(dD,{}),e&&a.jsx(Dae,{})]})});tb.displayName="ImageViewerPanel";const Xr=e=>{const t=Tt();return le(Ut(t.tool.$tool,s=>s===e))},sp=e=>{const t=Tt();return h.useCallback(()=>{t.tool.$tool.set(e)},[t.tool.$tool,e])},kle=h.memo(()=>{const{t:e}=T(),t=sp("bbox"),n=Xr("bbox");return Be({id:"selectBboxTool",category:"canvas",callback:t,options:{enabled:!n},dependencies:[t,n]}),a.jsx(He,{label:`${e("controlLayers.tool.bbox")} (C)`,placement:"end",children:a.jsx(oe,{"aria-label":`${e("controlLayers.tool.bbox")} (C)`,icon:a.jsx(nc,{}),colorScheme:n?"invokeBlue":"base",variant:"solid",onClick:t})})});kle.displayName="ToolBboxButton";const Ile=h.memo(()=>{const{t:e}=T(),t=Xr("brush"),n=sp("brush");return Be({id:"selectBrushTool",category:"canvas",callback:n,options:{enabled:!t},dependencies:[t,n]}),a.jsx(He,{label:`${e("controlLayers.tool.brush")} (B)`,placement:"end",children:a.jsx(oe,{"aria-label":`${e("controlLayers.tool.brush")} (B)`,icon:a.jsx(pX,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});Ile.displayName="ToolBrushButton";const jle=h.memo(()=>{const{t:e}=T(),t=Xr("colorPicker"),n=sp("colorPicker");return Be({id:"selectColorPickerTool",category:"canvas",callback:n,options:{enabled:!t},dependencies:[n,t]}),a.jsx(He,{label:`${e("controlLayers.tool.colorPicker")} (I)`,placement:"end",children:a.jsx(oe,{"aria-label":`${e("controlLayers.tool.colorPicker")} (I)`,icon:a.jsx(UDe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});jle.displayName="ToolColorPickerButton";const Ele=h.memo(()=>{const{t:e}=T(),t=Xr("move"),n=sp("move");return Be({id:"selectMoveTool",category:"canvas",callback:n,options:{enabled:!t},dependencies:[t,n]}),a.jsx(He,{label:`${e("controlLayers.tool.move")} (V)`,placement:"end",children:a.jsx(oe,{"aria-label":`${e("controlLayers.tool.move")} (V)`,icon:a.jsx(zDe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});Ele.displayName="ToolMoveButton";const Ale=h.memo(()=>{const{t:e}=T(),t=Xr("rect"),n=sp("rect");return Be({id:"selectRectTool",category:"canvas",callback:n,options:{enabled:!t},dependencies:[t,n]}),a.jsx(He,{label:`${e("controlLayers.tool.rectangle")} (U)`,placement:"end",children:a.jsx(oe,{"aria-label":`${e("controlLayers.tool.rectangle")} (U)`,icon:a.jsx(fMe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});Ale.displayName="ToolRectButton";const Ple=h.memo(()=>{const{t:e}=T(),t=Xr("eraser"),n=sp("eraser");return Be({id:"selectEraserTool",category:"canvas",callback:n,options:{enabled:!t},dependencies:[t,n]}),a.jsx(He,{label:`${e("controlLayers.tool.eraser")} (E)`,placement:"end",children:a.jsx(oe,{"aria-label":`${e("controlLayers.tool.eraser")} (E)`,icon:a.jsx(WDe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});Ple.displayName="ToolEraserButton";const Tle=h.memo(()=>{const{t:e}=T(),t=Xr("view"),n=sp("view");return Be({id:"selectViewTool",category:"canvas",callback:n,options:{enabled:!t},dependencies:[n,t]}),a.jsx(He,{label:`${e("controlLayers.tool.view")} (H)`,placement:"end",children:a.jsx(oe,{"aria-label":`${e("controlLayers.tool.view")} (H)`,icon:a.jsx(XDe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});Tle.displayName="ToolViewButton";const $Je=()=>a.jsx(a.Fragment,{children:a.jsxs(zn,{isAttached:!0,orientation:"vertical",children:[a.jsx(Ile,{}),a.jsx(Ple,{}),a.jsx(Ale,{}),a.jsx(Ele,{}),a.jsx(Tle,{}),a.jsx(kle,{}),a.jsx(jle,{})]})}),Dle=({prepend:e,children:t,...n})=>a.jsx(He,{label:a.jsx(Mle,{prepend:e}),maxW:512,...n,children:t}),Mle=h.memo(({prepend:e=!1})=>{const t=M(un);return t==="canvas"||t==="generate"?a.jsx(Lle,{prepend:e}):t==="workflows"?a.jsx(Ole,{prepend:e}):t==="upscaling"?a.jsx(Rle,{prepend:e}):null});Mle.displayName="TooltipContent";const Lle=h.memo(({prepend:e=!1})=>{const t=le(P_),n=le(Ic);return a.jsxs(A,{flexDir:"column",gap:1,children:[a.jsx(hk,{isReady:t,prepend:e}),a.jsx(c8,{}),n.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(ky,{}),a.jsx(pk,{reasons:n})]}),a.jsx(ky,{}),a.jsx(Ble,{})]})});Lle.displayName="CanvasTabTooltipContent";const Rle=h.memo(({prepend:e=!1})=>{const t=le(P_),n=le(Ic);return a.jsxs(A,{flexDir:"column",gap:1,children:[a.jsx(hk,{isReady:t,prepend:e}),a.jsx(c8,{}),n.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(ky,{}),a.jsx(pk,{reasons:n})]})]})});Rle.displayName="UpscaleTabTooltipContent";const Ole=h.memo(({prepend:e=!1})=>{const t=le(P_),n=le(Ic);return a.jsxs(A,{flexDir:"column",gap:1,children:[a.jsx(hk,{isReady:t,prepend:e}),a.jsx(Nle,{}),n.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(ky,{}),a.jsx(pk,{reasons:n})]})]})});Ole.displayName="WorkflowsTabTooltipContent";const c8=h.memo(()=>{const{t:e}=T(),t=M(_je),n=M(TM),s=h.useMemo(()=>{const i=Math.min(t*n,1e4),o=e("queue.prompts",{count:t}),r=e("queue.iterations",{count:n}),l=e("queue.generations",{count:i});return`${t} ${o}  ${n} ${r} -> ${i} ${l}`.toLowerCase()},[n,t,e]);return a.jsx(q,{children:s})});c8.displayName="QueueCountPredictionCanvasOrUpscaleTab";const Nle=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(Xn),[s,i]=h.useState("LOADING"),o=h.useMemo(()=>pr(async c=>{i("LOADING");const d=await WIe(c,t);i(d)},300),[t]);h.useEffect(()=>{o(n)},[o,n]);const r=M(TM),l=h.useMemo(()=>{if(s==="LOADING")return`${e("common.loading")}...`;const c=e("queue.iterations",{count:r});if(s==="NO_BATCHES"){const p=Math.min(1e4,r),m=e("queue.generations",{count:p});return`${r} ${c} -> ${p} ${m}`.toLowerCase()}if(s==="EMPTY_BATCHES")return e("parameters.invoke.batchNodeEmptyCollection");if(s==="MISMATCHED_BATCH_GROUP")return e("parameters.invoke.batchNodeCollectionSizeMismatchNoGroupId");const d=Math.min(s*r,1e4),u=e("queue.generations",{count:d});return`${s} ${e("queue.batchSize")}  ${r} ${c} -> ${d} ${u}`.toLowerCase()},[s,r,e]);return a.jsx(q,{children:l})});Nle.displayName="QueueCountPredictionWorkflowsTab";const hk=h.memo(({isReady:e,prepend:t})=>{const{t:n}=T(),s=M(t_),[i,o]=XD(cu),r=h.useMemo(()=>o.isLoading?n("queue.enqueueing"):n(s?"dynamicPrompts.loading":e?t?"queue.queueFront":"queue.queueBack":"queue.notReady"),[o.isLoading,s,e,n,t]);return a.jsx(q,{fontWeight:"semibold",children:r})});hk.displayName="IsReadyText";const pk=h.memo(({reasons:e})=>a.jsx(Li,{children:e.map((t,n)=>a.jsx(Fle,{reason:t},`${t.content}.${n}`))}));pk.displayName="ReasonsList";const Fle=h.memo(({reason:e})=>a.jsx(rn,{children:a.jsxs("span",{children:[e.prefix&&a.jsxs(q,{as:"span",fontWeight:"semibold",children:[e.prefix,":"," "]}),a.jsx(q,{as:"span",children:e.content})]})}));Fle.displayName="ReasonListItem";const ky=h.memo(()=>a.jsx(vt,{opacity:.2,borderColor:"base.900"}));ky.displayName="StyledDivider";const Ble=h.memo(()=>{const{t:e}=T(),t=M(ko),n=v1(t);return a.jsxs(q,{fontStyle:"oblique 10deg",children:[e("parameters.invoke.addingImagesTo")," ",a.jsx(q,{as:"span",fontWeight:"semibold",children:n||e("boards.uncategorized")})]})});Ble.displayName="AddingToText";const fk=h.memo(()=>a.jsx(A,{pos:"absolute",transform:"translate(0, -50%)",top:"50%",insetInlineStart:2,direction:"column",gap:2,children:a.jsxs(zn,{orientation:"vertical",h:48,children:[a.jsx(d8,{}),a.jsx(u8,{}),a.jsx(h8,{}),a.jsx(p8,{})]})}));fk.displayName="FloatingLeftPanelButtons";const zle=h.memo(()=>a.jsxs(A,{pos:"absolute",transform:"translate(0, -50%)",top:"50%",insetInlineStart:2,direction:"column",gap:2,children:[a.jsx(fa,{children:a.jsx($Je,{})}),a.jsxs(zn,{orientation:"vertical",h:48,children:[a.jsx(d8,{}),a.jsx(u8,{}),a.jsx(h8,{}),a.jsx(p8,{})]})]}));zle.displayName="FloatingCanvasLeftPanelButtons";const d8=h.memo(()=>{const{t:e}=T();return a.jsx(He,{label:e("accessibility.toggleLeftPanel"),placement:"end",children:a.jsx(oe,{"aria-label":e("accessibility.toggleLeftPanel"),onClick:Ne.toggleLeftPanel,icon:a.jsx(mX,{}),flexGrow:1})})});d8.displayName="ToggleLeftPanelButton";const u8=h.memo(()=>{const{t:e}=T(),t=$_(),n=Jr();return a.jsx(Dle,{prepend:n,placement:"end",children:a.jsx(oe,{"aria-label":e("queue.queueBack"),onClick:n?t.enqueueFront:t.enqueueBack,isLoading:t.isLoading,isDisabled:t.isDisabled,icon:a.jsx(Vle,{}),colorScheme:"invokeYellow",flexGrow:1})})});u8.displayName="InvokeIconButton";const Vle=h.memo(()=>{const e=Jr(),t=$_(),{isProcessing:n}=ur(void 0,{selectFromResult:({data:s})=>s?{isProcessing:s.queue.in_progress>0}:{isProcessing:!1}});return!t.isDisabled&&n?a.jsx(Je,{boxSize:6,as:FDe,animation:g_}):e?a.jsx(tS,{}):a.jsx(Em,{})});Vle.displayName="InvokeIconButtonIcon";const h8=h.memo(()=>{const{t:e}=T(),t=s4();return a.jsx(He,{label:e("queue.cancelTooltip"),placement:"end",children:a.jsx(oe,{onClick:t.trigger,isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.cancelTooltip"),icon:a.jsx(fn,{}),colorScheme:"error",flexGrow:1})})});h8.displayName="DeleteCurrentIconButton";const p8=h.memo(()=>{const{t:e}=T(),t=r6();return a.jsx(He,{label:e("queue.cancelAllExceptCurrentTooltip"),placement:"end",children:a.jsx(oe,{isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clear"),icon:a.jsx(iS,{}),colorScheme:"error",onClick:t.openDialog,flexGrow:1})})});p8.displayName="DeleteAllExceptCurrentIconButton";const nb=h.memo(()=>a.jsx(A,{pos:"absolute",transform:"translate(0, -50%)",minW:8,top:"50%",insetInlineEnd:2,children:a.jsx($le,{})}));nb.displayName="FloatingRightPanelButtons";const $le=h.memo(()=>{const{t:e}=T();return a.jsx(He,{label:e("accessibility.toggleRightPanel"),placement:"start",children:a.jsx(oe,{"aria-label":e("accessibility.toggleRightPanel"),onClick:Ne.toggleRightPanel,icon:a.jsx(JDe,{}),h:48})})});$le.displayName="ToggleRightPanelButton";const GJe=`${kn} ${bt}`,uD=Symbol("uniqueGroupKey"),HJe=e=>({...e,[uD]:!0}),Ql=e=>uD in e&&e[uD]===!0,Gle=sn(({option:e})=>{const{getOptionId:t}=Vi();return a.jsx(q,{fontWeight:"bold",children:t(e)})});Gle.displayName="DefaultOptionComponent";const WJe=sn(({group:e,children:t})=>a.jsxs(A,{flexDir:"column",gap:2,w:"full",children:[a.jsx(q,{fontWeight:"bold",children:e.id}),a.jsx(A,{flexDir:"column",gap:1,w:"full",children:t})]}));WJe.displayName="DefaultGroupComponent";const Hle=sn(({children:e})=>{const{t}=T();return a.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:typeof e=="string"?a.jsx(q,{variant:"subtext",children:e}):e??a.jsx(q,{variant:"subtext",children:t("common.noOptions")})})});Hle.displayName="NoOptionsFallbackWrapper";const Wle=sn(({children:e})=>{const{t}=T();return a.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:typeof e=="string"?a.jsx(q,{variant:"subtext",children:e}):e??a.jsx(q,{variant:"subtext",children:t("common.noMatches")})})});Wle.displayName="NoMatchesFallbackWrapper";const UJe=e=>ve([s2e],t=>e?t[e]??!0:!0),Ule=h.createContext(null),Vi=()=>{const e=h.useContext(Ule);return ae(e!==null,"usePickerContext must be used within a PickerProvider"),e},qJe=e=>{const t=e.trim().replace(/[-[\]{}()*+!<=:?./\\^$|#,]/g,"").split(" ").filter(s=>s.length>0);if(t.length===0)return new RegExp("","gi");const n=t.map(s=>`(?=.*${s})`).join("");return new RegExp(`${n}.+`,"i")},KJe=e=>{const t=e[0];if(t)return Ql(t)?t.options[0]:t},hD=(e,t)=>{const n=KJe(e);if(n)return t(n)},ZJe=(e,t,n)=>{for(const s of e)if(Ql(s)){const i=s.options.find(o=>n(o)===t);if(i)return i}else if(n(s)===t)return s},XJe=e=>{const t=[];for(const n of e)Ql(n)?t.push(...n.options):t.push(n);return t},YJe=(e,t)=>{const n=h.useMemo(()=>{const r=[];for(const l of e)Ql(l)&&!r.includes(l.id)&&r.push(l.id);return r},[e]),[s]=h.useState(De({})),[i]=h.useState(()=>Ut(s,r=>Object.values(r).every(l=>l===!1)));h.useEffect(()=>{const r=s.get(),l={};for(const c of n)t&&t[c]!==void 0?l[c]=t[c]:r[c]!==void 0?l[c]=r[c]:l[c]=!1;s.set(l)},[n,s,t]);const o=h.useCallback(r=>{const l=s.get(),c={};for(const d of n){const u=!!l[d];c[d]=d===r?!u:u}s.set(c)},[s,n]);return{$groupStatusMap:s,$areAllGroupsDisabled:i,toggleGroup:o}},QJe=()=>{const{getOptionId:e,$activeOptionId:t,$flattenedFilteredOptions:n,onSelectById:s,rootRef:i,onClose:o,inputRef:r}=Vi(),l=h.useCallback(m=>{t.set(m);const f=i.current;if(!f)return;const g=f.querySelector(`#${CSS.escape(m)}`);g&&g.scrollIntoView({block:"nearest"})},[t,i]),c=h.useCallback(m=>{m.preventDefault();const f=n.get(),g=t.get();if(f.length===0)return;if(m.metaKey){const y=f.at(0);y&&l(e(y));return}const v=f.findIndex(y=>e(y)===g);if(v<0)return;let b=v-1;b<0&&(b=f.length-1);const C=f.at(b);C&&l(e(C))},[t,n,l,e]),d=h.useCallback(m=>{m.preventDefault();const f=t.get(),g=n.get();if(g.length===0)return;if(m.metaKey){const y=g.at(-1);y&&l(e(y));return}const v=g.findIndex(y=>e(y)===f);if(v<0)return;let b=v+1;b>=g.length&&(b=0);const C=g.at(b);C&&l(e(C))},[t,n,l,e]),u=h.useCallback(m=>{if(m.key==="ArrowUp")c(m);else if(m.key==="ArrowDown")d(m);else if(m.key==="Enter"){const f=t.get();if(!f)return;s(f)}else m.key==="Escape"?o?.():m.key==="/"&&(m.preventDefault(),r.current?.focus(),r.current?.select())},[c,d,t,s,o,r]);return h.useMemo(()=>({onKeyDown:u}),[u])},I0=e=>h.useState(()=>De(e))[0],$u=(e,t)=>h.useState(()=>Ut(e,t))[0],JJe=e=>{let t=0;for(const n of e)Ql(n)?t+=n.options.length:t++;return t},qle=sn(e=>{const{pickerId:t,getOptionId:n,optionsOrGroups:s,handleRef:i,isMatch:o,getIsOptionDisabled:r,onClose:l,onSelect:c,selectedOption:d,searchPlaceholder:u,noMatchesFallback:p,noOptionsFallback:m,OptionComponent:f=Gle,NextToSearchBar:g,searchable:v,initialGroupStates:b}=e,C=h.useRef(null),y=h.useRef(null),{$groupStatusMap:x,$areAllGroupsDisabled:w,toggleGroup:_}=YJe(s,b),S=I0(hD(s,n)),I=I0(s),k=$u([I],JJe),E=I0([]),j=$u([E],XJe),P=$u([k],Z=>Z>0),D=$u([j],Z=>Z.length),O=$u([D],Z=>Z>0),N=I0(void 0),F=I0(""),X=$u([N],Z=>Z?n(Z):void 0),L=h.useMemo(()=>UJe(t),[t]),V=M(L),K=h.useCallback(Z=>{const W=E.get(),R=ZJe(W,Z,n);R&&c?.(R)},[E,n,c]);h.useEffect(()=>{N.set(d)},[N,d]),h.useEffect(()=>{I.set(s)},[s,I]);const U=h.useMemo(()=>({$optionsOrGroups:I,$groupStatusMap:x,isCompactView:V,$activeOptionId:S,$filteredOptions:E,$flattenedFilteredOptions:j,$totalOptionCount:k,$selectedItem:N,$searchTerm:F,getOptionId:n,isMatch:o,getIsOptionDisabled:r,onSelectById:K,noOptionsFallback:m,noMatchesFallback:p,toggleGroup:_,rootRef:C,inputRef:y,searchPlaceholder:u,OptionComponent:f,NextToSearchBar:g,onClose:l,searchable:v,$areAllGroupsDisabled:w,$selectedItemId:X,$hasOptions:P,$hasFilteredOptions:O,$filteredOptionsCount:D,pickerId:t}),[I,x,V,S,E,j,k,N,F,n,o,r,K,m,p,_,u,f,g,l,v,w,X,P,O,D,t]);return h.useImperativeHandle(i,()=>U,[U]),a.jsxs(Ule.Provider,{value:U,children:[a.jsxs(Zle,{children:[a.jsx(Qle,{}),a.jsxs(A,{tabIndex:-1,w:"full",flexGrow:1,children:[a.jsx(Xle,{}),a.jsx(Yle,{}),a.jsx(sce,{})]})]}),a.jsx(Kle,{})]})});qle.displayName="Picker";const Kle=sn(()=>{const{$optionsOrGroups:e,$searchTerm:t,$activeOptionId:n,$groupStatusMap:s,$areAllGroupsDisabled:i,$filteredOptions:o,searchable:r,isMatch:l,getOptionId:c}=Vi(),d=le(t),u=le(s),p=le(i),m=le(e),[f]=el(d,300);return h.useEffect(()=>{if(!f||!r){const g=m.filter(v=>Ql(v)?u[v.id]||p:!0);o.set(g),n.set(hD(g,c))}else{const g=f.toLowerCase(),v=[];for(const b of m)if(Ql(b)){if(!u[b.id]&&!p)continue;const C=b.options.filter(y=>l(y,g));C.length>0&&v.push({...b,options:C})}else l(b,f)&&v.push(b);o.set(v),n.set(hD(v,c))}},[f,n,c,l,o,r,m,u,p]),null});Kle.displayName="PickerSyncer";const Zle=sn(({children:e})=>{const{rootRef:t}=Vi(),n=QJe();return a.jsx(A,{className:GJe,tabIndex:-1,ref:t,flexGrow:1,flexDir:"column",p:2,w:"full",h:"full",gap:2,...n,children:e})});Zle.displayName="PickerContainer";const Xle=sn(()=>{const{noOptionsFallback:e,$hasOptions:t}=Vi();return le(t)?null:a.jsx(Hle,{children:e})});Xle.displayName="NoOptionsFallback";const Yle=sn(()=>{const{noMatchesFallback:e,$hasOptions:t,$hasFilteredOptions:n}=Vi(),s=le(t),i=le(n);return!s||i?null:a.jsx(Wle,{children:e})});Yle.displayName="NoMatchesFallback";const Qle=sn(()=>{const{NextToSearchBar:e,searchable:t}=Vi();return t?a.jsxs(A,{flexDir:"column",w:"full",gap:2,children:[a.jsxs(A,{gap:2,alignItems:"center",children:[a.jsx(Jle,{}),e,a.jsx(tce,{})]}),a.jsx(ece,{})]}):null});Qle.displayName="PickerSearchBar";const Jle=sn(()=>{const{inputRef:e,$totalOptionCount:t,$searchTerm:n,searchPlaceholder:s}=Vi(),{t:i}=T(),o=le(n),r=le(t),l=s??i("common.search"),c=h.useCallback(()=>{n.set(""),e.current?.focus()},[n,e]),d=h.useCallback(u=>{n.set(u.target.value)},[n]);return a.jsxs(tc,{children:[a.jsx(Nt,{ref:e,value:o,onChange:d,placeholder:l}),o&&a.jsx(Hr,{h:"full",pe:2,children:a.jsx(oe,{onClick:c,size:"sm",variant:"link","aria-label":i("common.clear"),tooltip:i("common.clear"),icon:a.jsx(fn,{}),isDisabled:r===0,disabled:!1})})]})});Jle.displayName="SearchInput";const ece=sn(()=>{const{$optionsOrGroups:e,$groupStatusMap:t,$areAllGroupsDisabled:n}=Vi(),{t:s}=T(),i=$u([e],c=>{const d=[];for(const u of c)Ql(u)&&d.push(u);return d}),o=le(i),r=le(n),l=h.useCallback(()=>{const c={};for(const{id:d}of o)c[d]=!1;t.set(c)},[t,o]);return o.length?a.jsxs(A,{gap:2,alignItems:"center",children:[o.map(c=>a.jsx(nce,{group:c},c.id)),a.jsx(At,{}),a.jsx(oe,{icon:a.jsx(Gs,{}),"aria-label":s("common.reset"),tooltip:s("common.reset"),size:"sm",variant:"link",alignSelf:"stretch",onClick:l,opacity:r?.5:void 0,pointerEvents:r?"none":void 0})]}):null});ece.displayName="GroupToggleButtons";const tce=sn(()=>{const{t:e}=T(),t=Q(),{isCompactView:n,pickerId:s}=Vi(),i=h.useCallback(()=>{s&&t(i2e({pickerId:s,isCompact:!n}))},[t,s,n]),o=e(n?"common.fullView":"common.compactView"),r=n?a.jsx(DDe,{}):a.jsx(TDe,{});return a.jsx(oe,{"aria-label":o,tooltip:o,size:"sm",variant:"ghost",icon:r,onClick:i})});tce.displayName="CompactViewToggleButton";const nce=sn(({group:e})=>{const{toggleGroup:t,$groupStatusMap:n}=Vi(),s=le(n),i=h.useCallback(()=>{t(e.id)},[e.id,t]),o=m8(e),r=tet(e),l=s[e.id]?o:"transparent",c=s[e.id]?void 0:"base.200";return a.jsx(Bi,{role:"button",size:"xs",variant:"solid",userSelect:"none",bg:l,color:c,borderColor:o,borderWidth:1,onClick:i,children:r})});nce.displayName="GroupToggleButton";const eet={flexDir:"column",w:"full",gap:2,'&[data-is-compact="true"]':{gap:1}},sce=sn(()=>{const{getOptionId:e,isCompactView:t,$filteredOptions:n}=Vi(),s=le(n);return s.length===0?null:a.jsx(Hs,{children:a.jsx(A,{sx:eet,"data-is-compact":t,children:s.map((i,o)=>{if(Ql(i)){const r=!t&&o<s.length-1;return a.jsxs(ce.Fragment,{children:[a.jsx(ice,{group:i}),r&&a.jsx(vt,{})]},i.id)}else{const r=e(i);return a.jsx(f8,{id:r,option:i},r)}})})})});sce.displayName="PickerList";const ice=sn(({group:e})=>{const{getOptionId:t,$groupStatusMap:n,$areAllGroupsDisabled:s}=Vi(),[i]=h.useState(()=>Ut([n,s],(r,l)=>!r[e.id]&&!l));return le(i)?null:a.jsx(oce,{group:e,children:e.options.map(r=>{const l=t(r);return a.jsx(f8,{id:l,option:r},l)})})});ice.displayName="PickerGroup";const f8=sn(e=>{const{OptionComponent:t,$activeOptionId:n,$selectedItemId:s,onSelectById:i,getIsOptionDisabled:o}=Vi(),{id:r,option:l}=e,[c]=h.useState(()=>Ut(n,C=>C===r)),[d]=h.useState(()=>Ut(s,C=>C===r)),u=le(c),p=le(d),m=h.useCallback(()=>{n.set(r)},[n,r]),f=h.useCallback(()=>{i(r)},[r,i]),g=o?.(l)??!1,v=g?void 0:m,b=g?void 0:f;return a.jsx(t,{tabIndex:-1,option:l,id:r,"data-disabled":g,"data-selected":p,"data-active":u,onPointerMove:v,onClick:b})});f8.displayName="PickerOption";const m8=e=>e.color??"base.300",tet=e=>e.shortName??e.name??e.id,net=e=>e.name??e.id,set=(e,t)=>e.getOptionCountString?.(e.options.length)??t("common.options_withCount",{count:e.options.length}),iet={flexDir:"column",w:"full",borderLeftWidth:4,ps:2,'&[data-all-disabled="true"]':{opacity:.5,cursor:"not-allowed"}},oce=sn(({group:e,children:t})=>{const{getIsOptionDisabled:n}=Vi(),s=m8(e),i=e.options.every(o=>n?.(o)??!1);return a.jsxs(A,{sx:iet,borderLeftColor:s,"data-all-disabled":i,children:[a.jsx(ace,{group:e}),a.jsx(A,{flexDir:"column",gap:1,w:"full",children:t})]})});oce.displayName="PickerGroupContainer";const oet={flexDir:"column",flex:1,ps:2,pe:4,py:1,userSelect:"none",position:"sticky",top:0,bg:"base.800",minH:8,'&[data-is-compact="true"]':{ps:1}},ace=sn(({group:e})=>{const{t}=T(),{isCompactView:n}=Vi(),s=m8(e),i=net(e),o=set(e,t);return a.jsx(A,{sx:oet,"data-is-compact":n,children:a.jsxs(A,{gap:2,alignItems:"center",children:[a.jsx(q,{fontSize:"sm",fontWeight:"semibold",color:s,noOfLines:1,children:i}),a.jsx(At,{}),a.jsx(q,{fontSize:"sm",color:"base.300",noOfLines:1,children:o})]})})});ace.displayName="PickerGroupHeader";const uf="54px",l$="28px",eA={rounded:"base",height:uf,minWidth:uf,bg:"base.850",borderWidth:"1px",borderColor:"base.750",borderStyle:"solid"},aet=({image_url:e})=>e?a.jsx(Nn,{src:e,objectFit:"cover",objectPosition:"50% 50%",width:uf,minHeight:uf,sx:eA,fallback:a.jsx(A,{height:uf,minWidth:uf,sx:eA,alignItems:"center",justifyContent:"center",children:a.jsx(Je,{color:"base.500",as:rC,boxSize:l$})})}):a.jsx(A,{alignItems:"center",justifyContent:"center",sx:eA,children:a.jsx(Je,{color:"base.500",as:rC,boxSize:l$})}),rce=sn(aet),lce=h.memo(e=>{const{t}=T(),n=h.useCallback(()=>{Ne.switchToTab("models")},[]);return a.jsx(oe,{icon:a.jsx(u1,{}),tooltip:`${t("modelManager.manageModels")}`,"aria-label":`${t("modelManager.manageModels")}`,onClick:n,size:"sm",variant:"ghost",...e})});lce.displayName="NavigateToModelManagerButton";/**
 * filesize
 *
 * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 10.1.6
 */const ret="array",cet="bit",c$="bits",det="byte",d$="bytes",_p="",uet="exponent",het="function",u$="iec",pet="Invalid number",fet="Invalid rounding method",tA="jedec",met="object",h$=".",get="round",vet="s",yet="si",bet="kbit",xet="kB",Cet=" ",wet="string",_et="0",nA={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function g8(e,{bits:t=!1,pad:n=!1,base:s=-1,round:i=2,locale:o=_p,localeOptions:r={},separator:l=_p,spacer:c=Cet,symbols:d={},standard:u=_p,output:p=wet,fullform:m=!1,fullforms:f=[],exponent:g=-1,roundingMethod:v=get,precision:b=0}={}){let C=g,y=Number(e),x=[],w=0,_=_p;u===yet?(s=10,u=tA):u===u$||u===tA?s=2:s===2?u=u$:(s=10,u=tA);const S=s===10?1e3:1024,I=m===!0,k=y<0,E=Math[v];if(typeof e!="bigint"&&isNaN(e))throw new TypeError(pet);if(typeof E!==het)throw new TypeError(fet);if(k&&(y=-y),(C===-1||isNaN(C))&&(C=Math.floor(Math.log(y)/Math.log(S)),C<0&&(C=0)),C>8&&(b>0&&(b+=8-C),C=8),p===uet)return C;if(y===0)x[0]=0,_=x[1]=nA.symbol[u][t?c$:d$][C];else{w=y/(s===2?Math.pow(2,C*10):Math.pow(1e3,C)),t&&(w=w*8,w>=S&&C<8&&(w=w/S,C++));const j=Math.pow(10,C>0?i:0);x[0]=E(w*j)/j,x[0]===S&&C<8&&g===-1&&(x[0]=1,C++),_=x[1]=s===10&&C===1?t?bet:xet:nA.symbol[u][t?c$:d$][C]}if(k&&(x[0]=-x[0]),b>0&&(x[0]=x[0].toPrecision(b)),x[1]=d[x[1]]||x[1],o===!0?x[0]=x[0].toLocaleString():o.length>0?x[0]=x[0].toLocaleString(o,r):l.length>0&&(x[0]=x[0].toString().replace(h$,l)),n&&i>0){const j=x[0].toString(),P=l||(j.match(/(\D)/g)||[]).pop()||h$,D=j.toString().split(P),O=D[1]||_p,N=O.length,F=i-N;x[0]=`${D[0]}${P}${O.padEnd(N+F,_et)}`}return I&&(x[1]=f[C]?f[C]:nA.fullform[u][C]+(t?cet:det)+(x[0]===1?_p:vet)),p===ret?x:p===met?{value:x[0],symbol:x[1],exponent:C,unit:_}:x.join(c)}const ket=Yn(oo,Hy,(e,t)=>{const n=[],s=e.model,i=e.vae,o=e.refinerModel,r=e.controlLora;s&&n.push(s.key),i&&n.push(i.key),o&&n.push(o.key),r&&n.push(r.key);for(const{model:l}of t.loras)n.push(l.key);return FG(n)}),Iet=e=>e.key,cce=h.memo(e=>{const t=h.useCallback(()=>{Ne.switchToTab("models"),El("launchpad")},[]);return a.jsx(he,{size:"sm",flexGrow:0,variant:"link",color:"base.200",onClick:t,...e})});cce.displayName="ModelManagerLink";const jet={LinkComponent:a.jsx(cce,{})},dce=h.memo(({noOptionsText:e})=>{const{t}=T();return a.jsxs(A,{flexDir:"column",gap:4,alignItems:"center",children:[a.jsx(q,{color:"base.200",children:e??t("modelManager.modelPickerFallbackNoModelsInstalled")}),a.jsx(q,{color:"base.200",children:a.jsx(Bn,{i18nKey:"modelManager.modelPickerFallbackNoModelsInstalled2",components:jet})})]})});dce.displayName="NoOptionsFallback";const Eet=e=>e.base,Aet=e=>lU[e.base],Pet=e=>cU[e.base],Tet=e=>dU[e.base],Det={selectFromResult:({data:e})=>e?{relatedModelKeys:e}:{relatedModelKeys:os}},Met=[{name:"preventOverflow",options:{padding:16}}],Let=e=>{const{starred:t,...n}=e;return n},sb=sn(({pickerId:e,modelConfigs:t,selectedModelConfig:n,onChange:s,grouped:i,getIsOptionDisabled:o,placeholder:r,allowEmpty:l,isDisabled:c,isInvalid:d,className:u,noOptionsText:p,initialGroupStates:m})=>{const{t:f}=T(),g=M(ket),{relatedModelKeys:v}=pie(g,{...Det}),b=h.useMemo(()=>{if(!i)return t.map(j=>({...j,starred:v.includes(j.key)})).sort((j,P)=>j.starred&&!P.starred?-1:!j.starred&&P.starred?1:0);const I={};for(const E of t){const j=Eet(E);let P=I[j];if(P||(P=HJe({id:E.base,color:`${Tet(E)}.300`,shortName:Pet(E),name:Aet(E),getOptionCountString:D=>f("common.model_withCount",{count:D}),options:[]}),I[j]=P),P){const D={...E,starred:v.includes(E.key)};P.options.push(D)}}const k=[];for(const E of["api","flux","z-image","cogview4","sdxl","sd-3","sd-2","sd-1"]){const j=I[E];j&&(j.options.sort((P,D)=>P.starred&&!D.starred?-1:!P.starred&&D.starred?1:0),k.push(j),delete I[E])}return k.push(...Object.values(I)),k},[i,t,v,f]),C=cS(!1),y=h.useRef(null),x=h.useMemo(()=>{if(!n)return;let I;for(const k of b)if(Ql(k)){const E=k.options.find(j=>j.key===n.key);if(E){I=E;break}}else if(k.key===n.key){I=k;break}return I},[b,n]),w=h.useCallback(()=>{C.close(),y.current?.$searchTerm.set("")},[C]),_=h.useCallback(I=>{w(),s(Let(I))},[s,w]),S=h.useMemo(()=>{if(!n&&!l||d)return"error"},[l,d,n]);return a.jsxs(yi,{isOpen:C.isOpen,onOpen:C.open,onClose:w,initialFocusRef:y.current?.inputRef,modifiers:Met,children:[a.jsx(Ni,{children:a.jsxs(he,{className:u,size:"sm",flexGrow:1,variant:"outline",colorScheme:S,isDisabled:c,children:[n?.name??r??"Select Model",a.jsx(At,{}),a.jsx(Do,{})]})}),a.jsx(Ls,{appendToParentPortal:!1,children:a.jsxs(bi,{p:0,w:400,h:400,children:[a.jsx(hr,{}),a.jsx(Fi,{p:0,w:"full",h:"full",borderWidth:1,borderColor:"base.700",borderRadius:"base",children:a.jsx(qle,{pickerId:e,handleRef:y,optionsOrGroups:b,getOptionId:Iet,onSelect:_,selectedOption:x,isMatch:Fet,OptionComponent:uce,noOptionsFallback:a.jsx(dce,{noOptionsText:p}),noMatchesFallback:f("modelManager.noMatchingModels"),NextToSearchBar:a.jsx(lce,{}),getIsOptionDisabled:o,searchable:!0,initialGroupStates:m})})]})})]})});sb.displayName="ModelPicker";const Ret={p:2,gap:2,cursor:"pointer",borderRadius:"base",'&[data-selected="true"]':{bg:"invokeBlue.300",color:"base.900",".extra-info":{color:"base.700"},".picker-option":{fontWeight:"bold",'&[data-is-compact="true"]':{fontWeight:"semibold"}},'&[data-active="true"]':{bg:"invokeBlue.250"}},'&[data-active="true"]':{bg:"base.750"},'&[data-disabled="true"]':{cursor:"not-allowed",opacity:.5},'&[data-is-compact="true"]':{px:1,py:.5},scrollMarginTop:"24px"},Oet={fontSize:"sm",noOfLines:1,fontWeight:"semibold",'&[data-is-compact="true"]':{fontWeight:"normal"}},uce=sn(({option:e,...t})=>{const{isCompactView:n}=Vi();return a.jsxs(A,{...t,sx:Ret,"data-is-compact":n,children:[!n&&e.cover_image&&a.jsx(rce,{image_url:e.cover_image}),a.jsxs(A,{flexDir:"column",gap:1,flex:1,children:[a.jsxs(A,{gap:2,alignItems:"center",children:[e.starred&&a.jsx(Je,{as:SX,color:"invokeYellow.500",boxSize:4}),a.jsx(q,{className:"picker-option",sx:Oet,"data-is-compact":n,children:e.name}),a.jsx(At,{}),e.file_size>0&&a.jsx(q,{className:"extra-info",variant:"subtext",fontStyle:"italic",noOfLines:1,flexShrink:0,overflow:"visible",children:g8(e.file_size)})]}),e.description&&!n&&a.jsx(q,{className:"extra-info",color:"base.200",children:e.description})]})]})});uce.displayName="PickerItemComponent";const Net={"sd-1":["sd1","sd1.4","sd1.5","sd-1"],"sd-2":["sd2","sd2.0","sd2.1","sd-2"],"sd-3":["sd3","sd3.0","sd3.5","sd-3"]},Fet=(e,t)=>{const n=qJe(t),s=Net[e.base]??[e.base],i=`${e.name} ${s.join(" ")} ${e.type} ${e.description??""} ${e.format}`.toLowerCase();return!!(i.includes(t)||n.test(i))};function hce(e){return fe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.53.12-1.03.3-1.48.54l1.47 1.47c.41-.17.91-.27 1.51-.27zM5.33 4.06 4.06 5.33 7.5 8.77c0 2.08 1.56 3.21 3.91 3.91l3.51 3.51c-.34.48-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.82-.55 2.45-1.12l2.22 2.22 1.27-1.27L5.33 4.06z"},child:[]}]})(e)}const v8=h.memo(()=>{const{t:e}=T(),t=Q(),[n]=Xw(),s=W1(),i=h.useCallback(r=>{t(pM(r))},[t]),o=h.useMemo(()=>s&&uU(s),[s]);return a.jsxs(te,{orientation:"vertical",alignItems:"unset",children:[a.jsxs(ne,{display:"flex",fontSize:"md",gap:2,children:[e("common.selectYourModel")," ",o&&a.jsx(Ue,{feature:"fluxDevLicense",hideDisable:!0,children:a.jsx(A,{justifyContent:"flex-start",children:a.jsx(Je,{as:hce})})})]}),a.jsx(sb,{pickerId:"initial-state-main-model",modelConfigs:n,selectedModelConfig:s,onChange:i,grouped:!0})]})});v8.displayName="InitialStateMainModelPicker";const sr=h.memo(rm(({children:e,...t},n)=>a.jsx(he,{ref:n,variant:"outline",display:"flex",position:"relative",alignItems:"center",justifyContent:"left",borderWidth:1,borderRadius:"base",pe:6,pb:6,ps:8,pt:6,gap:2,w:"full",h:"full",...t,children:e})));sr.displayName="LaunchpadButton";const Bet=l1.getData(),y8=h.memo(e=>{const{t}=T(),{dispatch:n,getState:s}=Ze(),i=h.useMemo(()=>({onUpload:r=>{const l=a1(s);l.image=Dl(r),n(Dy({overrides:{config:l}})),e.extraAction?.()},allowMultiple:!1}),[n,s,e]),o=Yo(i);return a.jsxs(sr,{...o.getUploadButtonProps(),position:"relative",gap:8,children:[a.jsx(Je,{as:IMe,boxSize:8,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:t("ui.launchpad.addStyleRef.title")}),a.jsx(q,{children:t("ui.launchpad.addStyleRef.description")})]}),a.jsxs(A,{position:"absolute",right:3,bottom:3,children:[a.jsx(qo,{}),a.jsx("input",{...o.getUploadInputProps()})]}),a.jsx(ds,{dndTarget:l1,dndTargetData:Bet,label:"Drop"})]})});y8.displayName="LaunchpadAddStyleReference";const ib=h.memo(e=>a.jsx(A,{flexDir:"column",h:"full",w:"full",alignItems:"center",justifyContent:"center",gap:2,children:a.jsxs(A,{flexDir:"column",w:"full",gap:4,px:14,maxW:768,children:[a.jsx(Pt,{children:e.heading}),a.jsx(A,{flexDir:"column",gap:4,children:e.children})]})}));ib.displayName="LaunchpadContainer";const pce={type:"raster_layer",withInpaintMask:!0},zet=c1.getData(pce),fce=h.memo(e=>{const{t}=T(),{getState:n,dispatch:s}=Ze(),i=Io(),o=h.useCallback(l=>{Dd({imageDTO:l,getState:n,dispatch:s,...pce}),e.extraAction?.()},[s,n,e]),r=Yo({allowMultiple:!1,onUpload:o});return a.jsxs(sr,{...r.getUploadButtonProps(),position:"relative",gap:8,isDisabled:i,children:[a.jsx(Je,{as:Im,boxSize:8,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:t("ui.launchpad.editImage.title")}),a.jsx(q,{children:t("ui.launchpad.editImage.description")})]}),a.jsxs(A,{position:"absolute",right:3,bottom:3,children:[a.jsx(qo,{}),a.jsx("input",{...r.getUploadInputProps()})]}),a.jsx(ds,{dndTarget:c1,dndTargetData:zet,label:"Drop",isDisabled:i})]})});fce.displayName="LaunchpadEditImageButton";const Vet=()=>{const e=document.querySelector(".positive-prompt-textarea");e instanceof HTMLTextAreaElement&&(e.focus(),e.select())},b8=h.memo(e=>{const{t}=T(),n=M(un),s=Io(),i=h.useCallback(()=>{Vet(),e.extraAction?.()},[e]);return a.jsxs(sr,{onClick:i,position:"relative",gap:8,isDisabled:n==="canvas"&&s,children:[a.jsx(Je,{as:K4,boxSize:8,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:t("ui.launchpad.generateFromText.title")}),a.jsx(q,{children:t("ui.launchpad.generateFromText.description")})]}),a.jsx(A,{position:"absolute",right:3,bottom:3,children:a.jsx(VDe,{})})]})});b8.displayName="LaunchpadGenerateFromTextButton";const mce={type:"control_layer",withResize:!0},$et=c1.getData(mce),gce=h.memo(e=>{const{t}=T(),{getState:n,dispatch:s}=Ze(),i=Io(),o=h.useCallback(l=>{Dd({imageDTO:l,getState:n,dispatch:s,...mce}),e.extraAction?.()},[s,n,e]),r=Yo({allowMultiple:!1,onUpload:o});return a.jsxs(sr,{...r.getUploadButtonProps(),position:"relative",gap:8,isDisabled:i,children:[a.jsx(Je,{as:mMe,boxSize:8,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:t("ui.launchpad.useALayoutImage.title")}),a.jsx(q,{children:t("ui.launchpad.useALayoutImage.description")})]}),a.jsxs(A,{position:"absolute",right:3,bottom:3,children:[a.jsx(qo,{}),a.jsx("input",{...r.getUploadInputProps()})]}),a.jsx(ds,{dndTarget:c1,dndTargetData:$et,label:"Drop",isDisabled:i})]})});gce.displayName="LaunchpadUseALayoutImageButton";const vce=h.memo(()=>{const{t:e}=T(),t=h.useCallback(()=>{Ne.focusPanel("canvas",Zn)},[]);return a.jsxs(ib,{heading:e("ui.launchpad.canvasTitle"),children:[a.jsxs(Ms,{gridTemplateColumns:"1fr 1fr",gap:8,children:[a.jsx(v8,{}),a.jsx(A,{flexDir:"column",gap:2,justifyContent:"center",children:a.jsxs(q,{children:[e("ui.launchpad.modelGuideText")," ",a.jsx(he,{as:"a",variant:"link",href:"https://support.invoke.ai/support/solutions/articles/151000216086-model-guide",target:"_blank",rel:"noopener noreferrer",size:"sm",children:e("ui.launchpad.modelGuideLink")})]})})]}),a.jsx(b8,{extraAction:t}),a.jsx(y8,{extraAction:t}),a.jsx(fce,{extraAction:t}),a.jsx(gce,{extraAction:t})]})});vce.displayName="CanvasLaunchpadPanel";const mk={name:"invoke",className:"dockview-theme-invoke"},yce=h.memo(()=>{const{t:e}=T(),t=r6();return a.jsx(oe,{size:"lg",isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clear"),tooltip:e("queue.cancelAllExceptCurrentTooltip"),icon:a.jsx(iS,{}),colorScheme:"error",onClick:t.openDialog})});yce.displayName="DeleteAllExceptCurrentIconButton";const bce=h.memo(()=>{const{t:e}=T(),t=s4();return a.jsx(oe,{size:"lg",onClick:t.trigger,isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.cancel"),tooltip:e("queue.cancelTooltip"),icon:a.jsx(fn,{}),colorScheme:"error"})});bce.displayName="DeleteCurrentQueueItemIconButton";const x8=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(un),s=h.useCallback(()=>{t(o2e()),t(yl({isSelected:!0,isBookmarked:!0})),yh.get()?.stage.fitBboxToStage()},[t]),i=h.useCallback(()=>{t(a2e())},[t]);return a.jsxs(a.Fragment,{children:[n==="canvas"&&a.jsx(be,{icon:a.jsx(aC,{}),onClick:s,children:e("controlLayers.resetCanvasLayers")}),(n==="canvas"||n==="generate")&&a.jsx(be,{icon:a.jsx(aC,{}),onClick:i,children:e("controlLayers.resetGenerationSettings")})]})});x8.displayName="SessionMenuItems";const xce=h.memo(({targetRef:e})=>{const[t,n]=h.useState(null),{queueSize:s}=ur(void 0,{selectFromResult:i=>({queueSize:i.data?i.data.queue.pending+i.data.queue.in_progress:0})});return h.useEffect(()=>{if(!e.current)return;const i=e.current,o=i.parentElement;if(!o)return;const r=()=>{const c=i.getBoundingClientRect(),d=o.getBoundingClientRect();if(c.x===0||c.y===0||c.width===0||c.height===0||d.x===0||d.y===0||d.width===0||d.height===0){n(null);return}n({x:`${c.x-7}px`,y:`${c.y-5}px`})},l=new ResizeObserver(r);return l.observe(o),r(),()=>{l.disconnect()}},[e]),s===0||!t?null:a.jsx(Ls,{children:a.jsx(Bi,{pos:"absolute",insetInlineStart:t.x,insetBlockStart:t.y,colorScheme:"invokeYellow",zIndex:"docked",shadow:"dark-lg",userSelect:"none",children:s})})});xce.displayName="QueueCountBadge";const Get={withToast:!0},gk=()=>{const e=le(ks),[t,{isLoading:n}]=aU(),{t:s}=T();return{trigger:h.useCallback(async(o,r)=>{const{withToast:l}={...Get,...r};try{await t({item_id:o}).unwrap(),l&&pe({id:"QUEUE_CANCEL_SUCCEEDED",title:s("queue.cancelSucceeded"),status:"success"})}catch{l&&pe({id:"QUEUE_CANCEL_FAILED",title:s("queue.cancelFailed"),status:"error"})}},[s,t]),isLoading:n,isDisabled:!e}},Cce=()=>{const e=CK(),t=gk();return{trigger:h.useCallback(s=>{e!==null&&t.trigger(e,s)},[e,t]),isLoading:t.isLoading,isDisabled:t.isDisabled||e===null}},wce=()=>{const{t:e}=T(),t=le(ks),{data:n}=ur(),[s,{isLoading:i}]=oU({fixedCacheKey:"pauseProcessor"});return{trigger:h.useCallback(async()=>{try{await s().unwrap(),pe({id:"PAUSE_SUCCEEDED",title:e("queue.pauseSucceeded"),status:"success"})}catch{pe({id:"PAUSE_FAILED",title:e("queue.pauseFailed"),status:"error"})}},[s,e]),isLoading:i,isDisabled:!t||!n?.processor.is_started}},_ce=()=>{const e=le(ks),{data:t}=ur(),{t:n}=T(),[s,{isLoading:i}]=iU({fixedCacheKey:"resumeProcessor"});return{trigger:h.useCallback(async()=>{try{await s().unwrap(),pe({id:"PROCESSOR_RESUMED",title:n("queue.resumeSucceeded"),status:"success"})}catch{pe({id:"PROCESSOR_RESUME_FAILED",title:n("queue.resumeFailed"),status:"error"})}},[s,n]),isLoading:i,isDisabled:!e||t?.processor.is_started}},Sce=h.memo(()=>{const e=h.useRef(null),{t}=T(),n=o6(),s=Cce(),i=a6(),o=_ce(),r=wce(),l=h.useCallback(()=>{Ne.switchToTab("queue")},[]),c=M(un),d=h.useCallback(()=>{s.trigger({withToast:!0})},[s]);return a.jsxs(a.Fragment,{children:[a.jsxs(An,{placement:"bottom-end",isLazy:!0,lazyBehavior:"unmount",children:[a.jsx(Pn,{ref:e,as:oe,size:"lg","aria-label":"Queue Actions Menu",icon:a.jsx(sMe,{})}),a.jsxs(Zt,{children:[(c==="canvas"||c==="generate")&&a.jsx(Ya,{title:t("common.new"),children:a.jsx(x8,{})}),a.jsxs(Ya,{title:t("queue.queue"),children:[a.jsx(be,{isDestructive:!0,icon:a.jsx(fn,{}),onClick:d,isLoading:s.isLoading,isDisabled:s.isDisabled,children:t("queue.cancelTooltip")}),a.jsx(be,{isDestructive:!0,icon:a.jsx(iS,{}),onClick:n.openDialog,isLoading:n.isLoading,isDisabled:n.isDisabled,children:t("queue.cancelAllExceptCurrentTooltip")}),a.jsx(be,{isDestructive:!0,icon:a.jsx(Qc,{}),onClick:i.openDialog,isLoading:i.isLoading,isDisabled:i.isDisabled,children:t("queue.clearTooltip")}),a.jsx(be,{icon:a.jsx(CX,{}),onClick:o.trigger,isLoading:o.isLoading,isDisabled:o.isDisabled,children:t("queue.resumeTooltip")}),a.jsx(be,{icon:a.jsx(xX,{}),onClick:r.trigger,isLoading:r.isLoading,isDisabled:r.isDisabled,children:t("queue.pauseTooltip")}),a.jsx(be,{icon:a.jsx(U4,{}),onClick:l,children:t("queue.openQueue")})]})]})]}),a.jsx(xce,{targetRef:e})]})});Sce.displayName="QueueActionsMenuButton";const Het=e=>{const{t}=T(),{data:n}=ur(),s=le(ks),i=le(Sl),o=h.useMemo(()=>i?(i.percentage??0)*100:0,[i]),r=h.useMemo(()=>!s||!n?.queue.in_progress?!1:!i||i.percentage===null||i.percentage===0,[s,i,n?.queue.in_progress]);return a.jsx(hU,{value:o,"aria-label":t("accessibility.invokeProgressBar"),isIndeterminate:r,h:2,w:"full",colorScheme:"invokeBlue",...e})},vk=h.memo(Het),kce=h.memo(()=>{const{t:e}=T(),t=o6();return a.jsx(oe,{size:"lg",isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.clear"),tooltip:e("queue.cancelAllExceptCurrentTooltip"),icon:a.jsx(iS,{}),colorScheme:"error",onClick:t.openDialog})});kce.displayName="CancelAllExceptCurrentIconButton";const Ice=h.memo(()=>{const{t:e}=T(),t=Cce(),n=h.useCallback(()=>{t.trigger({withToast:!0})},[t]);return a.jsx(oe,{size:"lg",onClick:n,isDisabled:t.isDisabled,isLoading:t.isLoading,"aria-label":e("queue.cancel"),tooltip:e("queue.cancelTooltip"),icon:a.jsx(fn,{}),colorScheme:"error"})});Ice.displayName="CancelCurrentQueueItemIconButton";const jce=h.memo(()=>{const e=M(TM),t=Q(),n=h.useCallback(s=>{t(r2e(s))},[t]);return a.jsx(Ue,{feature:"paramIterations",children:a.jsx(Pe,{step:1,fineStep:1,min:1,max:1e4,onChange:n,value:e,defaultValue:1,pos:"absolute",insetInlineEnd:0,h:"full",ps:0,w:"72px",flexShrink:0,variant:"iterations"})})});jce.displayName="QueueIterationsNumberInput";const p$="Invoke",Ece=h.memo(()=>{const e=$_(),t=Jr(),n=M(t_);return a.jsxs(A,{pos:"relative",w:"200px",children:[a.jsx(jce,{}),a.jsx(Dle,{prepend:t,children:a.jsxs(he,{onClick:t?e.enqueueFront:e.enqueueBack,isLoading:e.isLoading||n,loadingText:p$,isDisabled:e.isDisabled,rightIcon:t?a.jsx(tS,{}):a.jsx(Em,{}),variant:"solid",colorScheme:"invokeYellow",size:"lg",w:"calc(100% - 60px)",flexShrink:0,justifyContent:"space-between",spinnerPlacement:"end",children:[a.jsx("span",{children:p$}),a.jsx(At,{})]})})]})});Ece.displayName="InvokeQueueBackButton";const Wet=()=>a.jsxs(A,{w:"full",position:"relative",borderRadius:"base",gap:2,flexDir:"column",children:[a.jsxs(A,{gap:2,children:[a.jsx(Ece,{}),a.jsx(At,{}),a.jsx(Sce,{}),a.jsx(Ace,{})]}),a.jsx(vk,{})]}),yk=h.memo(Wet),Uet=h.memo(()=>Jr()?a.jsx(yce,{}):a.jsx(bce,{}));Uet.displayName="DeleteIconButton";const Ace=h.memo(()=>Jr()?a.jsx(kce,{}):a.jsx(Ice,{}));Ace.displayName="CancelIconButton";const Pce=e=>{const t=h.useMemo(()=>ve(Vc,s=>pU(s,e,`useRefImageState(${e})`)),[e]);return M(t)},Tce=({warnings:e})=>{const{t}=T();return a.jsxs(A,{flexDir:"column",children:[a.jsx(q,{fontWeight:"semibold",children:"Invalid Reference Image:"}),a.jsx(Li,{children:e.map(n=>a.jsx(rn,{children:Cd(t(n))},n))})]})},Dce={'&[data-is-open="true"]':{borderColor:"invokeBlue.300"},'&[data-is-disabled="true"]':{img:{opacity:.4,filter:"grayscale(100%)"}},'&[data-is-error="true"]':{borderColor:"error.500",img:{opacity:.4,filter:"grayscale(100%)"}}},qet={pointerEvents:"none",transitionProperty:"opacity",transitionDuration:"normal",opacity:0,'&[data-visible="true"]':{opacity:1}},Ket=e=>{const t=Math.max(0,Math.min(100,e*100));return{...Dce,_after:{content:'""',position:"absolute",inset:0,background:`linear-gradient(to top, transparent ${t}%, rgba(0, 0, 0, 0.8) ${t}%)`,pointerEvents:"none",borderRadius:"base"}}},Mce=h.memo(()=>{const e=Q(),t=Cu(),n=Pce(t),s=M(wo),i=M(fU),o=M(mU),[r,l]=h.useState(!1),c=l2e(n.config.image),d=h.useMemo(()=>rh(n.config)?Ket(n.config.weight):Dce,[n.config]);h.useEffect(()=>{if(!rh(n.config))return;l(!0);const m=window.setTimeout(()=>{l(!1)},1e3);return()=>{window.clearTimeout(m)}},[n.config]);const u=h.useMemo(()=>vu(n,s),[n,s]),p=h.useCallback(()=>{e(c2e({id:t}))},[e,t]);return n.config.image?a.jsx(He,{label:u.length>0?a.jsx(Tce,{warnings:u}):void 0,children:a.jsxs(A,{position:"relative",borderWidth:1,borderStyle:"solid",borderRadius:"base",aspectRatio:"1/1",maxW:"full",maxH:"full",flexShrink:0,sx:d,"data-is-open":i===t&&o,"data-is-error":u.length>0,"data-is-disabled":!n.isEnabled,role:"button",onClick:p,cursor:"pointer",overflow:"hidden",children:[a.jsx(Nn,{src:c?.image_url,objectFit:"contain",aspectRatio:"1/1",height:c?.height,fallback:a.jsx(iM,{h:"full",aspectRatio:"1/1"}),maxW:"full",maxH:"full"}),rh(n.config)&&a.jsx(A,{position:"absolute",inset:0,fontWeight:"semibold",alignItems:"center",justifyContent:"center",zIndex:1,"data-visible":r,sx:qet,children:a.jsx(q,{filter:"drop-shadow(0px 0px 4px rgb(0, 0, 0)) drop-shadow(0px 0px 2px rgba(0, 0, 0, 1))",children:`${Vh(n.config.weight*100,2)}%`})}),!n.isEnabled&&a.jsx(Je,{position:"absolute",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)",filter:"drop-shadow(0px 0px 4px rgb(0, 0, 0)) drop-shadow(0px 0px 2px rgba(0, 0, 0, 1))",color:"base.300",boxSize:8,as:$4}),n.isEnabled&&u.length>0&&a.jsx(Je,{position:"absolute",top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)",filter:"drop-shadow(0px 0px 4px rgb(0, 0, 0)) drop-shadow(0px 0px 2px rgba(0, 0, 0, 1))",color:"error.500",boxSize:12,as:V4})]})}):a.jsx(oe,{"aria-label":"Select Ref Image",h:"full",variant:"ghost",aspectRatio:"1/1",borderWidth:1,borderStyle:"solid",borderColor:"error.300",borderRadius:"base",icon:a.jsx(xh,{}),colorScheme:"error",onClick:p,flexShrink:0,"data-is-open":i===t&&o,"data-is-error":!0,"data-is-disabled":!n.isEnabled,sx:d})});Mce.displayName="RefImagePreview";const Zet={color:"base.300",'&[data-is-error="true"]':{color:"error.300"}},Lce=h.memo(()=>{const e=Q(),t=Cu(),n=h.useMemo(()=>ve(gU,d=>d.indexOf(t)+1),[t]),s=M(n),i=Pce(t),o=M(wo),r=h.useMemo(()=>vu(i,o),[i,o]),l=h.useCallback(()=>{e(d2e({id:t}))},[e,t]),c=h.useCallback(()=>{e(u2e({id:t}))},[e,t]);return a.jsxs(A,{justifyContent:"space-between",alignItems:"center",w:"full",ps:2,children:[a.jsxs(q,{fontWeight:"semibold",sx:Zet,"data-is-error":!i.config.image,children:["Reference Image #",s]}),a.jsxs(A,{alignItems:"center",gap:1,children:[r.length>0&&a.jsx(oe,{as:"span",size:"sm",variant:"link",alignSelf:"stretch","aria-label":"warnings",tooltip:a.jsx(Tce,{warnings:r}),icon:a.jsx(jm,{}),colorScheme:"warning"}),!i.isEnabled&&a.jsx(q,{fontSize:"xs",fontStyle:"italic",color:"base.400",children:"Disabled"}),a.jsx(oe,{tooltip:i.isEnabled?"Disable Reference Image":"Enable Reference Image",size:"xs",variant:"link",alignSelf:"stretch","aria-label":i.isEnabled?"Disable ref image":"Enable ref image",onClick:c,icon:i.isEnabled?a.jsx(vX,{}):a.jsx(nX,{})}),a.jsx(oe,{tooltip:"Delete Reference Image",size:"xs",variant:"link",alignSelf:"stretch","aria-label":"Delete ref image",onClick:l,icon:a.jsx(Qc,{}),colorScheme:"error"})]})]})});Lce.displayName="RefImageHeader";const Rce=h.memo(()=>{const{t:e}=T(),t=Cu(),n=Z6(t),s=xt();return a.jsx(oe,{onClick:n,isDisabled:s,variant:"ghost","aria-label":e("controlLayers.pullBboxIntoReferenceImage"),tooltip:e("controlLayers.pullBboxIntoReferenceImage"),icon:a.jsx(nc,{})})});Rce.displayName="PullBboxIntoRefImageIconButton";const Oce=h.memo(({modelKey:e,onChangeModel:t})=>{const{t:n}=T(),s=M(wo),[i,{isLoading:o}]=h2e(),r=h.useMemo(()=>i.find(f=>f.key===e),[i,e]),l=h.useCallback(f=>{f&&t(f)},[t]),c=h.useCallback(f=>!dP(s,f),[s]),{options:d,value:u,onChange:p,noOptionsMessage:m}=Jh({modelConfigs:i,onChange:l,selectedModel:r,getIsDisabled:c,isLoading:o});return a.jsx(He,{label:r?.description,children:a.jsx(te,{isInvalid:!u||!dP(s,r),w:"full",minW:0,children:a.jsx(pt,{options:d,placeholder:n("common.placeholderSelectAModel"),value:u,onChange:p,noOptionsMessage:m})})})});Oce.displayName="RefImageModel";const Nce=h.memo(()=>{const{t:e}=T(),t=Cu(),n=Q(),s=h.useCallback(l=>{R4({imageDTO:l,id:t,dispatch:n})},[n,t]),i=Yo({onUpload:s,allowMultiple:!1}),o=h.useMemo(()=>bh.getData({id:t}),[t]),r=h.useMemo(()=>({UploadButton:a.jsx(he,{size:"sm",variant:"link",color:"base.300",...i.getUploadButtonProps()})}),[i]);return a.jsxs(A,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[a.jsx(q,{textAlign:"center",color:"base.300",children:a.jsx(Bn,{i18nKey:"controlLayers.referenceImageEmptyState",components:r})}),a.jsx("input",{...i.getUploadInputProps()}),a.jsx(ds,{dndTarget:bh,dndTargetData:o,label:e("controlLayers.useImage")})]})});Nce.displayName="RefImageNoImageState";const Fce=h.memo(()=>{const{t:e}=T(),t=Cu(),n=Q(),s=xt(),i=h.useCallback(d=>{R4({imageDTO:d,id:t,dispatch:n})},[n,t]),o=Yo({onUpload:i,allowMultiple:!1}),r=Z6(t),l=h.useMemo(()=>bh.getData({id:t}),[t]),c=h.useMemo(()=>({UploadButton:a.jsx(he,{isDisabled:s,size:"sm",variant:"link",color:"base.300",...o.getUploadButtonProps()}),PullBboxButton:a.jsx(he,{onClick:r,isDisabled:s,size:"sm",variant:"link",color:"base.300"})}),[s,r,o]);return a.jsxs(A,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[a.jsx(q,{textAlign:"center",color:"base.300",children:a.jsx(Bn,{i18nKey:"controlLayers.referenceImageEmptyStateWithCanvasOptions",components:c})}),a.jsx("input",{...o.getUploadInputProps()}),a.jsx(ds,{dndTarget:bh,dndTargetData:l,label:e("controlLayers.useImage"),isDisabled:s})]})});Fce.displayName="RefImageNoImageStateWithCanvasOptions";const Xet={MIN_CROP_DIMENSION:64,ZOOM_WHEEL_FACTOR:1.1,ZOOM_BUTTON_FACTOR:1.2,CROP_HANDLE_SIZE:8,CROP_HANDLE_STROKE_WIDTH:1,CROP_HANDLE_FILL:"white",CROP_HANDLE_STROKE:"black",CROP_GUIDE_STROKE:"rgba(255, 255, 255, 0.5)",CROP_GUIDE_STROKE_WIDTH:1,CROP_OVERLAY_FILL_COLOR:"rgba(0, 0, 0, 0.8)",FIT_TO_CONTAINER_PADDING_PCT:.9,DEFAULT_CROP_BOX_SCALE:.8,ZOOM_MIN_PCT:.1,ZOOM_MAX_PCT:10};class Yet{konva=null;originalImage=null;config=Xet;aspectRatio=null;callbacks={onCropBoxChange:new Set,onZoomChange:new Set,onAspectRatioChange:new Set};cropBox=null;isPanning=!1;lastPointerPosition=null;isSpacePressed=!1;cleanupFunctions=new Set;init=(t,n)=>{this.config={...this.config,...n};const s=new Ae.Stage({container:t,width:t.clientWidth,height:t.clientHeight}),i=this.createKonvaBgObjects(),o=this.createKonvaImageObjects(),r=this.createKonvaCropObjects();s.add(i.layer),s.add(o.layer),s.add(r.layer),this.konva={stage:s,bg:i,image:o,crop:r},this.setupListeners()};createKonvaBgObjects=()=>{const t=new Ae.Layer,n=new Ae.Rect,s=new Image;return s.onload=()=>{n.fillPatternImage(s),this.updateKonvaBg()},s.src=Qh,t.add(n),{layer:t,rect:n}};createKonvaImageObjects=()=>({layer:new Ae.Layer});createKonvaCropObjects=()=>{const t=new Ae.Layer,n=this.createKonvaCropOverlayObjects(),s=this.createKonvaCropInteractionObjects();return t.add(n.group),t.add(s.group),{layer:t,overlay:n,interaction:s}};createKonvaCropOverlayObjects=()=>{const t=new Ae.Group,n=new Ae.Rect({fill:this.config.CROP_OVERLAY_FILL_COLOR}),s=new Ae.Rect({fill:"black",globalCompositeOperation:"destination-out"});return t.add(n),t.add(s),{group:t,full:n,clear:s}};createKonvaCropInteractionObjects=()=>{const t=new Ae.Group,n=this.createKonvaCropInteractionRect(),s={"top-left":this.createKonvaCropInteractionHandle("top-left"),"top-right":this.createKonvaCropInteractionHandle("top-right"),"bottom-right":this.createKonvaCropInteractionHandle("bottom-right"),"bottom-left":this.createKonvaCropInteractionHandle("bottom-left"),top:this.createKonvaCropInteractionHandle("top"),right:this.createKonvaCropInteractionHandle("right"),bottom:this.createKonvaCropInteractionHandle("bottom"),left:this.createKonvaCropInteractionHandle("left")},i={left:this.createKonvaCropInteractionGuide("left"),right:this.createKonvaCropInteractionGuide("right"),top:this.createKonvaCropInteractionGuide("top"),bottom:this.createKonvaCropInteractionGuide("bottom")};t.add(n);for(const o of Object.values(s))t.add(o);for(const o of Object.values(i))t.add(o);return{group:t,rect:n,handles:s,guides:i}};createKonvaCropInteractionRect=()=>{const t=new Ae.Rect({stroke:"white",strokeWidth:1,strokeScaleEnabled:!1,draggable:!0});return t.on("dragstart",n=>{if(this.isSpacePressed||this.isPanning)return n.target.stopDrag(),!1}),t.on("dragmove",()=>{if(!this.konva?.image.image||!this.cropBox)return;const n=this.konva.image.image.width(),s=this.konva.image.image.height(),i=Math.max(0,Math.min(t.x(),n-t.width())),o=Math.max(0,Math.min(t.y(),s-t.height())),{width:r,height:l}=this.cropBox;t.x(i),t.y(o),this.updateCropBox({x:i,y:o,width:r,height:l})}),t.on("mouseenter",()=>{const n=this.konva?.stage;n&&(this.isSpacePressed||(n.container().style.cursor="move"))}),t.on("mouseleave",()=>{const n=this.konva?.stage;n&&(this.isSpacePressed||(n.container().style.cursor="default"))}),t};createKonvaCropInteractionGuide=t=>new Ae.Line({name:t,stroke:this.config.CROP_GUIDE_STROKE,strokeWidth:this.config.CROP_GUIDE_STROKE_WIDTH,strokeScaleEnabled:!1,listening:!1});createKonvaCropInteractionHandle=t=>{const n=new Ae.Rect({name:t,x:0,y:0,width:this.config.CROP_HANDLE_SIZE,height:this.config.CROP_HANDLE_SIZE,fill:this.config.CROP_HANDLE_FILL,stroke:this.config.CROP_HANDLE_STROKE,strokeWidth:this.config.CROP_HANDLE_STROKE_WIDTH,strokeScaleEnabled:!0,draggable:!0,hitStrokeWidth:16});return n.on("dragstart",()=>{const s=this.konva?.stage;if(s&&s.isDragging())return n.stopDrag(),!1}),n.on("mouseenter",()=>{const s=this.konva?.stage;if(s&&!s.isDragging()){let i="pointer";t==="top-left"||t==="bottom-right"?i="nwse-resize":t==="top-right"||t==="bottom-left"?i="nesw-resize":t==="top"||t==="bottom"?i="ns-resize":(t==="left"||t==="right")&&(i="ew-resize"),s.container().style.cursor=i}}),n.on("mouseleave",()=>{const s=this.konva?.stage;s&&(s.isDragging()||(s.container().style.cursor="default"))}),n.on("dragmove",()=>{if(!this.konva)return;const{newX:s,newY:i,newWidth:o,newHeight:r}=this.aspectRatio?this.getNextCropBoxByHandleWithAspectRatio(t,n):this.getNextCropBoxByHandleFree(t,n);this.updateCropBox({x:s,y:i,width:o,height:r})}),n};updateKonvaCropInteractionRect=()=>{!this.konva||!this.cropBox||this.konva.crop.interaction.rect.setAttrs({...this.cropBox})};updateKonvaCropInteractionGuides=()=>{if(!this.konva||!this.cropBox)return;const{x:t,y:n,width:s,height:i}=this.cropBox,o=s/3;this.konva.crop.interaction.guides.left.points([t+o,n,t+o,n+i]),this.konva.crop.interaction.guides.right.points([t+o*2,n,t+o*2,n+i]);const r=i/3;this.konva.crop.interaction.guides.top.points([t,n+r,t+s,n+r]),this.konva.crop.interaction.guides.bottom.points([t,n+r*2,t+s,n+r*2])};updateKonvaCropInteractionHandlePositions=()=>{if(!(!this.konva||!this.cropBox))for(const[t,n]of Gr(this.konva.crop.interaction.handles)){const{x:s,y:i,width:o,height:r}=this.cropBox,l=n.width();let c=s,d=i;t.includes("right")?c+=o:t.includes("left")||(c+=o/2),t.includes("bottom")?d+=r:t.includes("top")||(d+=r/2),n.x(c-l/2),n.y(d-l/2)}};updateKonvaCropInteractionHandleScales=()=>{if(!this.konva)return;const t=this.konva.stage.scaleX(),n=this.config.CROP_HANDLE_SIZE/t,s=this.config.CROP_HANDLE_STROKE_WIDTH/t;for(const i of Object.values(this.konva.crop.interaction.handles)){const o=i.x(),r=i.y(),l=i.width(),c=o+l/2,d=r+l/2;i.width(n),i.height(n),i.strokeWidth(s),i.x(c-n/2),i.y(d-n/2)}};updateCropBox=t=>{this.cropBox=t,this.updateKonvaCropOverlay(),this.updateKonvaCropInteractionRect(),this.updateKonvaCropInteractionGuides(),this.updateKonvaCropInteractionHandlePositions();for(const n of this.callbacks.onCropBoxChange)n(t)};updateKonvaBg=()=>{if(!this.konva)return;const t=this.konva.stage.scaleX(),n=1/t,{x:s,y:i}=this.konva.stage.getPosition(),{width:o,height:r}=this.konva.stage.size();this.konva.bg.rect.setAttrs({visible:!0,x:Math.floor(-s/t),y:Math.floor(-i/t),width:Math.ceil(o/t),height:Math.ceil(r/t),fillPatternScaleX:n,fillPatternScaleY:n})};updateKonvaCropOverlay=()=>{!this.konva?.image.image||!this.cropBox||(this.konva.crop.overlay.full.setAttrs({...this.konva.image.image.getPosition(),...this.konva.image.image.getSize()}),this.konva.crop.overlay.clear.setAttrs({...this.cropBox}))};updateImage=t=>{if(!this.originalImage||!this.konva)return;this.konva.image.image&&(this.konva.image.image.destroy(),this.konva.image.image=void 0);const n=new Ae.Image({image:this.originalImage,x:0,y:0,width:this.originalImage.width,height:this.originalImage.height});if(this.konva.image.image=n,this.konva.image.layer.add(n),this.resetView(),t)this.setCropAspectRatio(t.aspectRatio),this.updateCropBox(t.cropBox);else{const s=this.konva.image.image.width(),i=this.konva.image.image.height(),o=s*this.config.DEFAULT_CROP_BOX_SCALE,r=i*this.config.DEFAULT_CROP_BOX_SCALE,l=(s-o)/2,c=(i-r)/2;this.updateCropBox({x:l,y:c,width:o,height:r})}};getNextCropBoxByHandleFree=(t,n)=>{if(!this.konva?.image.image||!this.cropBox)throw new Error("Crop box or image not found");const s=this.konva.image.image.width(),i=this.konva.image.image.height();let o=this.cropBox.x,r=this.cropBox.y,l=this.cropBox.width,c=this.cropBox.height;const d=n.x()+n.width()/2,u=n.y()+n.height()/2,p=this.config.MIN_CROP_DIMENSION,m=this.config.MIN_CROP_DIMENSION;if(t.includes("left")){const f=o+l;o=Math.max(0,Math.min(d,f-p)),l=f-o}if(t.includes("right")&&(l=Math.max(p,Math.min(d-o,s-o))),t.includes("top")){const f=r+c;r=Math.max(0,Math.min(u,f-m)),c=f-r}return t.includes("bottom")&&(c=Math.max(m,Math.min(u-r,i-r))),{newX:o,newY:r,newWidth:l,newHeight:c}};getNextCropBoxByHandleWithAspectRatio=(t,n)=>{if(!this.konva?.image.image||!this.aspectRatio||!this.cropBox)throw new Error("Crop box, image, or aspect ratio not found");const s=this.konva.image.image.width(),i=this.konva.image.image.height(),o=this.aspectRatio,r=n.x()+n.width()/2,l=n.y()+n.height()/2,c=this.config.MIN_CROP_DIMENSION,d=this.config.MIN_CROP_DIMENSION,u=this.cropBox.x<=0,p=this.cropBox.x+this.cropBox.width>=s,m=this.cropBox.y<=0,f=this.cropBox.y+this.cropBox.height>=i;if(t==="left"&&u&&r<this.cropBox.x||t==="right"&&p&&r>this.cropBox.x+this.cropBox.width||t==="top"&&m&&l<this.cropBox.y||t==="bottom"&&f&&l>this.cropBox.y+this.cropBox.height)return{newX:this.cropBox.x,newY:this.cropBox.y,newWidth:this.cropBox.width,newHeight:this.cropBox.height};const{newX:g,newY:v,newWidth:b,newHeight:C}=this.getNextCropBoxByHandleFree(t,n);let y=g,x=v,w=b,_=C;const S=this.cropBox.x,I=this.cropBox.y,k=this.cropBox.width,E=this.cropBox.height;let j=S,P=I;if(t.includes("right")?j=S:t.includes("left")?j=S+k:j=S+k/2,t.includes("bottom")?P=I:t.includes("top")?P=I+E:P=I+E/2,t==="left"||t==="right"||t==="top"||t==="bottom")t==="left"||t==="right"?(_=w/o,x=P-_/2):(w=_*o,y=j-w/2);else{const D=Math.abs(r-j),O=Math.abs(l-P);let N=t.includes("left")?j:s-j,F=t.includes("top")?P:i-P;const X=Math.min(D,N),L=Math.min(O,F);X/o>L?(w=X,_=w/o,_>F&&(_=F,w=_*o)):(_=L,w=_*o,w>N&&(w=N,_=w/o)),y=t.includes("left")?j-w:j,x=t.includes("top")?P-_:P}return y<0&&(y=0,w=S+k,_=w/o,x=t.includes("top")?I+E-_:I),x<0&&(x=0,_=I+E,w=_*o,y=t.includes("left")?S+k-w:S),y+w>s&&(w=s-y,_=w/o,x=t.includes("top")?I+E-_:I),x+_>i&&(_=i-x,w=_*o,y=t.includes("left")?S+k-w:S),(w<c||_<d)&&(c/o>d?(w=c,_=w/o):(_=d,w=_*o),y=t.includes("left")?j-w:j,x=t.includes("top")?P-_:P),{newX:y,newY:x,newWidth:w,newHeight:_}};setupListeners=()=>{if(!this.konva)return;const t=this.konva.stage;t.on("wheel",this.onWheel),t.on("contextmenu",this.onContextMenu),t.on("pointerdown",this.onPointerDown),t.on("pointerup",this.onPointerUp),t.on("pointermove",this.onPointerMove),this.cleanupFunctions.add(()=>{t.off("wheel",this.onWheel),t.off("contextmenu",this.onContextMenu),t.off("pointerdown",this.onPointerDown),t.off("pointerup",this.onPointerUp),t.off("pointermove",this.onPointerMove)}),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.cleanupFunctions.add(()=>{window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)})};onKeyDown=t=>{this.konva?.stage&&t.code==="Space"&&!this.isSpacePressed&&(t.preventDefault(),this.isSpacePressed=!0,this.konva.stage.container().style.cursor="grab")};onKeyUp=t=>{this.konva?.stage&&t.code==="Space"&&(t.preventDefault(),this.isSpacePressed=!1,this.isPanning=!1,this.konva.stage.container().style.cursor="default")};onWheel=t=>{if(!this.konva?.stage)return;t.evt.preventDefault();const n=this.konva.stage.scaleX(),s=this.konva.stage.getPointerPosition();if(!s)return;const i={x:(s.x-this.konva.stage.x())/n,y:(s.y-this.konva.stage.y())/n},o=t.evt.deltaY>0?-1:1,r=this.config.ZOOM_WHEEL_FACTOR;let l=o>0?n*r:n/r;l=Math.max(this.config.ZOOM_MIN_PCT,Math.min(this.config.ZOOM_MAX_PCT,l)),this.konva.stage.scale({x:l,y:l});const c={x:s.x-i.x*l,y:s.y-i.y*l};this.konva.stage.position(c),this.updateKonvaCropInteractionHandleScales(),this.updateKonvaBg();for(const d of this.callbacks.onZoomChange)d(l)};onPointerDown=t=>{if(this.konva?.stage&&(this.isSpacePressed||t.evt.button===1)&&(t.evt.preventDefault(),t.evt.stopPropagation(),this.isPanning=!0,this.lastPointerPosition=this.konva.stage.getPointerPosition(),this.konva.stage.container().style.cursor="grabbing",this.konva.crop)){this.konva.crop.interaction.rect.isDragging()&&this.konva.crop.interaction.rect.stopDrag();for(const n of Object.values(this.konva.crop.interaction.handles))n.isDragging()&&n.stopDrag()}};onPointerMove=t=>{if(!this.konva?.stage||!this.isPanning||!this.lastPointerPosition)return;const n=this.konva.stage.getPointerPosition();if(!n)return;const s=n.x-this.lastPointerPosition.x,i=n.y-this.lastPointerPosition.y;this.konva.stage.x(this.konva.stage.x()+s),this.konva.stage.y(this.konva.stage.y()+i),this.updateKonvaBg(),this.lastPointerPosition=n};onPointerUp=t=>{this.konva?.stage&&this.isPanning&&(this.isPanning=!1,this.konva.stage.container().style.cursor=this.isSpacePressed?"grab":"default")};onContextMenu=t=>{t.evt.preventDefault()};loadImage=(t,n)=>new Promise((s,i)=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{this.originalImage=o,this.updateImage(n),s()},o.onerror=()=>{i(new Error("Failed to load image"))},o.src=t});resetCrop=()=>{this.konva?.image.image&&this.updateCropBox({x:0,y:0,...this.konva.image.image.size()})};exportImage=(t="blob",n)=>{const{withCropOverlay:s}={withCropOverlay:!1,...n};return new Promise((i,o)=>{if(!this.originalImage)throw new Error("No image loaded");const r=document.createElement("canvas"),l=r.getContext("2d");if(!l)throw new Error("Failed to get canvas context");try{if(this.cropBox)if(!s)r.width=this.cropBox.width,r.height=this.cropBox.height,l.drawImage(this.originalImage,this.cropBox.x,this.cropBox.y,this.cropBox.width,this.cropBox.height,0,0,this.cropBox.width,this.cropBox.height);else{r.width=this.originalImage.width,r.height=this.originalImage.height,l.drawImage(this.originalImage,0,0);const c=document.createElement("canvas");c.width=this.originalImage.width,c.height=this.originalImage.height;const d=c.getContext("2d");if(!d)throw new Error("Failed to get canvas context");d.fillStyle=this.config.CROP_OVERLAY_FILL_COLOR,d.fillRect(0,0,c.width,c.height),d.clearRect(this.cropBox.x,this.cropBox.y,this.cropBox.width,this.cropBox.height),l.globalCompositeOperation="multiply",l.drawImage(c,0,0),c.remove()}else r.width=this.originalImage.width,r.height=this.originalImage.height,l.drawImage(this.originalImage,0,0);if(t==="canvas")i(r);else if(t==="dataURL")try{i(r.toDataURL("image/png"))}catch(c){o(c)}else try{r.toBlob(c=>{c?i(c):o(new Error("Failed to create blob"))},"image/png")}catch(c){o(c)}}catch(c){o(c)}})};setZoom=(t,n)=>{if(this.konva){if(t=Math.max(this.config.ZOOM_MIN_PCT,Math.min(this.config.ZOOM_MAX_PCT,t)),!n&&this.konva.image){const s=this.konva.stage.width(),i=this.konva.stage.height();n={x:s/2,y:i/2}}if(n){const s=this.konva.stage.scaleX(),i={x:(n.x-this.konva.stage.x())/s,y:(n.y-this.konva.stage.y())/s};this.konva.stage.scale({x:t,y:t});const o={x:n.x-i.x*t,y:n.y-i.y*t};this.konva.stage.position(o)}else this.konva.stage.scale({x:t,y:t});this.updateKonvaCropInteractionHandleScales(),this.updateKonvaBg();for(const s of this.callbacks.onZoomChange)s(t)}};getZoom=()=>this.konva?.stage.scaleX()||1;zoomIn=t=>{const n=this.getZoom();this.setZoom(n*this.config.ZOOM_BUTTON_FACTOR,t)};zoomOut=t=>{const n=this.getZoom();this.setZoom(n/this.config.ZOOM_BUTTON_FACTOR,t)};resetView=()=>{if(!this.konva?.image.image)return;this.konva.stage.scale({x:1,y:1});const t=this.konva.stage.width(),n=this.konva.stage.height(),s=this.konva.image.image.width(),i=this.konva.image.image.height();this.konva.stage.position({x:(t-s)/2,y:(n-i)/2}),this.updateKonvaCropInteractionHandleScales(),this.updateKonvaBg();for(const o of this.callbacks.onZoomChange)o(1)};fitToContainer=()=>{if(!this.konva?.image?.image)return;const t=this.konva.stage.width(),n=this.konva.stage.height(),s=this.konva.image.image.width(),i=this.konva.image.image.height(),o=Math.min(t/s,n/i)*this.config.FIT_TO_CONTAINER_PADDING_PCT;this.konva.stage.scale({x:o,y:o});const r=s*o,l=i*o;this.konva.stage.position({x:(t-r)/2,y:(n-l)/2}),this.updateKonvaCropInteractionHandleScales(),this.updateKonvaBg();for(const c of this.callbacks.onZoomChange)c(o)};setCallbacks=(t,n=!1)=>{n?this.callbacks=t:this.callbacks={...this.callbacks,...t}};setCropAspectRatio=t=>{if(this.aspectRatio=t,!this.konva?.image.image||!this.cropBox)return;const n=this.cropBox.width,s=this.cropBox.height,i=n*s;if(t===null)return;let o=Math.sqrt(i*t),r=o/t;const l=this.konva.image.image.width(),c=this.konva.image.image.height();if(o>l||r>c){const v=l/o,b=c/r,C=Math.min(v,b);o*=C,r*=C}const d=this.config.MIN_CROP_DIMENSION,u=this.config.MIN_CROP_DIMENSION;o<d&&(o=d,r=o/t),r<u&&(r=u,o=r*t);const p=this.cropBox.x+n/2,m=this.cropBox.y+s/2;let f=p-o/2,g=m-r/2;f=Math.max(0,Math.min(f,l-o)),g=Math.max(0,Math.min(g,c-r)),this.updateCropBox({x:f,y:g,width:o,height:r});for(const v of this.callbacks.onAspectRatioChange)v(t)};setCropBox=t=>{this.updateCropBox(t)};getCropBox=()=>this.cropBox;getCropAspectRatio=()=>this.aspectRatio;onCropBoxChange=t=>(this.callbacks.onCropBoxChange.add(t),()=>{this.callbacks.onCropBoxChange.delete(t)});onZoomChange=t=>(this.callbacks.onZoomChange.add(t),()=>{this.callbacks.onZoomChange.delete(t)});onAspectRatioChange=t=>(this.callbacks.onAspectRatioChange.add(t),()=>{this.callbacks.onAspectRatioChange.delete(t)});resize=(t,n)=>{this.konva&&(this.konva.stage.width(t),this.konva.stage.height(n),this.updateKonvaBg())};destroy=()=>{for(const t of this.cleanupFunctions)t();this.konva?.stage.destroy(),this.konva=null,this.originalImage=null,this.cropBox=null;for(const t of Object.values(this.callbacks))t.clear()}}const Bce=h.memo(({image:e,onChangeImage:t,dndTarget:n,dndTargetData:s})=>{const{t:i}=T(),o=Ze(),r=le(ks),l=M(un),c=Io(),d=e?.crop?.image??e?.original.image??null,u=eu(e?.crop?.image?.image_name??Ri),p=eu(e?.original.image.image_name??Ri),[m]=e_(),f=p.currentData,v=u.currentData??f,b=h.useCallback(()=>{t(null)},[t]);h.useEffect(()=>{(r&&u.isError||p.isError)&&b()},[b,r,u.isError,p.isError]);const C=h.useCallback(w=>{t(Dl(w))},[t]),y=h.useCallback(()=>{if(!v||l==="canvas"&&c)return;const{width:w,height:_}=v;l==="canvas"?(o.dispatch(WW({width:w,height:_})),o.dispatch(xM())):l==="generate"&&(o.dispatch(UW({width:w,height:_})),o.dispatch(CM()))},[v,c,o,l]),x=h.useCallback(()=>{if(!f)return;const w=new Yet,_=async()=>{const I=w.getCropBox();if(yo(I,e?.crop?.box))return;if(!I||yo(I,{x:0,y:0,width:f.width,height:f.height})){t(Dl(f));return}const k=await w.exportImage("blob"),E=new File([k],"image.png",{type:"image/png"}),j=await m({file:E,is_intermediate:!0,image_category:"user"}).unwrap();t(Dl(f,{image:du(j),box:I,ratio:w.getCropAspectRatio()}))},S=async()=>{const I=e?.crop?{cropBox:e.crop.box,aspectRatio:e.crop.ratio}:void 0;await w.loadImage(f.image_url,I)};Zv.open({editor:w,onApplyCrop:_,onReady:S})},[e?.crop,t,f,m]);return a.jsxs(A,{position:"relative",w:"full",h:"full",alignItems:"center","data-error":!v&&!d?.image_name,children:[!v&&a.jsx(C1,{w:"full",h:"full",isError:!v&&!d?.image_name,onUpload:C,fontSize:36}),v&&a.jsxs(a.Fragment,{children:[a.jsx(lc,{imageDTO:v,borderRadius:"base",borderWidth:1,borderStyle:"solid",w:"full"}),a.jsx(A,{position:"absolute",flexDir:"column",top:2,insetInlineEnd:2,gap:1,children:a.jsx(nr,{onClick:b,icon:a.jsx(Gs,{size:16}),tooltip:i("common.reset")})}),a.jsx(A,{position:"absolute",flexDir:"column",bottom:2,insetInlineEnd:2,gap:1,children:a.jsx(nr,{onClick:y,icon:a.jsx(qv,{size:16}),tooltip:i("parameters.useSize"),isDisabled:!v||l==="canvas"&&c})}),a.jsx(A,{position:"absolute",flexDir:"column",top:2,insetInlineStart:2,gap:1,children:a.jsx(nr,{onClick:x,icon:a.jsx(z4,{size:16}),tooltip:i("common.crop"),isDisabled:!v})})]}),a.jsx(ds,{dndTarget:n,dndTargetData:s,label:i("gallery.drop")})]})});Bce.displayName="RefImageImage";const Qet=e=>ve(Vc,t=>pU(t,e,"IPAdapterSettings").config),zce=h.memo(()=>{const e=Q(),t=Cu(),n=h.useMemo(()=>Qet(t),[t]),s=M(n),i=M(un),o=h.useCallback(g=>{e(f2e({id:t,beginEndStepPct:g}))},[e,t]),r=h.useCallback(g=>{e(m2e({id:t,weight:g}))},[e,t]),l=h.useCallback(g=>{e(g2e({id:t,method:g}))},[e,t]),c=h.useCallback(g=>{e(v2e({id:t,imageInfluence:g}))},[e,t]),d=h.useCallback(g=>{e(y2e({id:t,modelConfig:g}))},[e,t]),u=h.useCallback(g=>{e(b2e({id:t,clipVisionModel:g}))},[e,t]),p=h.useCallback(g=>{e(JD({id:t,croppableImage:g}))},[e,t]),m=h.useMemo(()=>bh.getData({id:t},s.image?.crop?.image.image_name??s.image?.original.image.image_name),[t,s.image?.crop?.image.image_name,s.image?.original.image.image_name]),f=M(Hc);return a.jsxs(A,{flexDir:"column",gap:2,position:"relative",w:"full",children:[a.jsxs(A,{gap:2,alignItems:"center",w:"full",children:[a.jsx(Oce,{modelKey:s.model?.key??null,onChangeModel:d}),rh(s)&&a.jsx(n3,{model:s.clipVisionModel,onChange:u}),i==="canvas"&&a.jsx(fa,{children:a.jsx(Rce,{})})]}),a.jsxs(A,{gap:2,w:"full",children:[rh(s)&&a.jsxs(A,{flexDir:"column",gap:2,w:"full",children:[!f&&a.jsx(s3,{method:s.method,onChange:l}),a.jsx(HS,{weight:s.weight,onChange:r}),a.jsx(GS,{beginEndStepPct:s.beginEndStepPct,onChange:o})]}),NA(s)&&a.jsx(A,{flexDir:"column",gap:2,w:"full",alignItems:"flex-start",children:a.jsx(t3,{imageInfluence:s.imageInfluence??"lowest",onChange:c})}),a.jsx(A,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",flexGrow:1,children:a.jsx(Bce,{image:s.image,onChangeImage:p,dndTarget:bh,dndTargetData:m})})]})]})});zce.displayName="RefImageSettingsContent";const Jet=e=>ve(Vc,t=>{const n=p2e(t,e);return!!n&&n.config.image!==null}),Vce=h.memo(()=>{const e=Cu(),t=M(un),n=pm(),s=h.useMemo(()=>Jet(e),[e]),i=M(s);return!i&&n&&t==="canvas"?a.jsx(fa,{children:a.jsx(Fce,{})}):i?a.jsx(zce,{}):a.jsx(Nce,{})});Vce.displayName="RefImageSettings";const $ce=h.memo(()=>{const e=M(gU),t=M(mU),n=M(fU);return a.jsxs(A,{flexDir:"column",children:[a.jsxs(A,{gap:2,h:16,children:[e.map(s=>a.jsx(LT.Provider,{value:s,children:a.jsx(Mce,{})},s)),e.length<5&&a.jsx(Hce,{}),e.length>=5&&a.jsx(Gce,{})]}),a.jsx(mu,{in:t,children:a.jsx(A,{pt:2,w:"full",children:n!==null&&a.jsx(LT.Provider,{value:n,children:a.jsxs(A,{flexDir:"column",gap:2,w:"full",h:"full",borderRadius:"base",bg:"base.800",p:2,children:[a.jsx(Lce,{}),a.jsx(vt,{}),a.jsx(Vce,{})]})})})})]})});$ce.displayName="RefImageList";const ett=l1.getData(),Gce=h.memo(()=>{const{t:e}=T();return a.jsx(he,{position:"relative",size:"sm",variant:"ghost",h:"full",w:"full",borderWidth:"2px !important",borderStyle:"dashed !important",borderRadius:"base",isDisabled:!0,children:e("controlLayers.maxRefImages")})});Gce.displayName="MaxRefImages";const Hce=h.memo(()=>{const{dispatch:e,getState:t}=Ze(),{t:n}=T(),s=M(un),i=h.useMemo(()=>({onUpload:r=>{const l=a1(t);l.image=Dl(r),e(Dy({overrides:{config:l}}))},allowMultiple:!1}),[e,t]),o=Yo(i);return a.jsxs(A,{gap:1,h:"full",w:"full",children:[a.jsxs(he,{position:"relative",size:"sm",variant:"ghost",h:"full",w:"full",borderWidth:"2px !important",borderStyle:"dashed !important",borderRadius:"base",leftIcon:a.jsx(qo,{}),...o.getUploadButtonProps(),children:[n("controlLayers.referenceImage"),a.jsx("input",{...o.getUploadInputProps()}),a.jsx(ds,{label:"Drop",dndTarget:l1,dndTargetData:ett})]}),s==="canvas"&&a.jsx(fa,{children:a.jsx(Wce,{})})]})});Hce.displayName="AddRefImageDropTargetAndButton";const Wce=h.memo(()=>{const{t:e}=T(),t=IS(),n=dse();return a.jsx(oe,{size:"lg",variant:"outline",h:"full",icon:a.jsx(nc,{}),onClick:n,isDisabled:t,"aria-label":e("controlLayers.pullBboxIntoReferenceImage"),tooltip:e("controlLayers.pullBboxIntoReferenceImage")})});Wce.displayName="BboxButton";const Uce=(e,t,n)=>{const{dispatch:s,getState:i}=Ze(),o=h.useCallback(l=>{s(x2e({id:e,size:l}))},[s,e]),r=h.useMemo(()=>pr(o,300),[o]);h.useEffect(()=>{const l=t.current;if(!l||!n.trackHeight&&!n.trackWidth)return;const c=DM(i()).textAreaSizes[e];c?.width!==void 0?l.style.width=`${c.width}px`:n.initialWidth!==void 0&&(l.style.width=`${n.initialWidth}px`),c?.height!==void 0?l.style.height=`${c.height}px`:n.initialHeight!==void 0&&(l.style.height=`${n.initialHeight}px`);let d=l.offsetHeight,u=l.offsetWidth;const p=new ResizeObserver(()=>{let m=!1;const f={};n.trackHeight&&(l.offsetHeight!==d&&(m=!0,d=l.offsetHeight),f.height=d),n.trackWidth&&(l.offsetWidth!==u&&(m=!0,u=l.offsetWidth),f.width=u),m&&r(f)});return p.observe(l),()=>{r.cancel(),p.disconnect()}},[r,s,i,e,n.initialHeight,n.initialWidth,n.trackHeight,n.trackWidth,t])},C8=({label:e})=>a.jsx(q,{variant:"subtext",fontWeight:"semibold",pos:"absolute",top:1,left:2,children:e}),w8=h.memo(e=>a.jsx(A,{pos:"absolute",insetBlockStart:0,insetInlineEnd:0,flexDir:"column",p:2,gap:2,alignItems:"center",justifyContent:"space-between",bottom:4,pb:0,children:e.children}));w8.displayName="PromptOverlayButtonWrapper";const ttt=(e,t)=>{if(!t||!t.length)return["",e,""];if(!t.includes(lh))return["",`${e} `,t];const[n,...s]=t.split(lh);return[n||"",e,s.join(lh)||""]},qce=({presetPrompt:e,prompt:t,label:n})=>{const s=Q(),{t:i}=T(),o=h.useMemo(()=>ttt(t,e),[e,t]),r=h.useCallback(()=>{s(o2(!1))},[s]);return a.jsx(ke,{position:"absolute",top:0,bottom:0,left:0,right:0,layerStyle:"second",borderRadius:"base",children:a.jsxs(A,{flexDir:"column",onClick:r,justifyContent:"space-between",h:"full",borderWidth:1,borderTopWidth:24,borderColor:"transparent",paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3,children:[a.jsx(C8,{label:n}),a.jsx(A,{overflow:"scroll",children:a.jsx(q,{w:"full",lineHeight:"short",children:o.map((l,c)=>a.jsx(q,{as:"span",color:c===1?"white":"base.200",fontWeight:c===1?"semibold":"normal",children:l},c))})}),a.jsx(He,{label:i("stylePresets.viewModeTooltip"),children:a.jsx(A,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,alignItems:"center",justifyContent:"center",p:2,bg:"base.900",opacity:.8,backgroundClip:"border-box",borderBottomStartRadius:"base",children:a.jsx(Je,{as:bu,color:"base.500",boxSize:4})})})]})})},ntt={trackWidth:!1,trackHeight:!0},_8=h.memo(()=>{const e=Q(),t=M(C2e),n=M(MM),s=M(Ry),i=h.useRef(null);Uce("negative_prompt",i,ntt);const{activeStylePreset:o}=lm(void 0,{selectFromResult:({data:g})=>{let v=null;return g&&(v=g.find(b=>b.id===s)),{activeStylePreset:v}}}),{t:r}=T(),l=h.useCallback(g=>{e(Ef(g))},[e]),{onChange:c,isOpen:d,onClose:u,onOpen:p,onSelect:m,onKeyDown:f}=US({prompt:t,textareaRef:i,onChange:l});return qS({textareaRef:i,onPromptChange:g=>e(Ef(g))}),a.jsx($1,{isOpen:d,onClose:u,onSelect:m,width:i.current?.clientWidth,children:a.jsxs(ke,{pos:"relative",w:"full",children:[a.jsx(no,{className:"negative-prompt-textarea",name:"negativePrompt",ref:i,value:t,onChange:c,onKeyDown:f,variant:"darkFilled",minH:28,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3,fontFamily:"mono",fontSize:"0.82rem"}),a.jsx(w8,{children:a.jsx(V1,{isOpen:d,onOpen:p})}),a.jsx(C8,{label:r("parameters.negativePromptPlaceholder")}),n&&a.jsx(qce,{prompt:t,presetPrompt:o?.preset_data.negative_prompt||"",label:`${r("parameters.negativePromptPlaceholder")} (${r("stylePresets.preview")})`})]})})});_8.displayName="ParamNegativePrompt";const stt={svg:{animation:g_}},Kce=h.memo(()=>{const{t:e}=T(),t=M(t_),n=M(lW),{isOpen:s,onOpen:i}=LY();return a.jsx(He,{label:e(t?"dynamicPrompts.loading":"dynamicPrompts.showDynamicPrompts"),children:a.jsx(oe,{size:"sm",variant:"promptOverlay",isDisabled:s,"aria-label":e("dynamicPrompts.showDynamicPrompts"),icon:a.jsx(LDe,{}),onClick:i,sx:t?stt:void 0,colorScheme:n&&!t?"error":"base"})})});Kce.displayName="ShowDynamicPromptsPreviewButton";const Zce=h.memo(()=>{const{t:e}=T(),t=M(LM),n=Q(),s=h.useCallback(()=>{n(t?Ef(null):Ef(""))},[n,t]),i=h.useMemo(()=>e(t?"common.removeNegativePrompt":"common.addNegativePrompt"),[t,e]);return a.jsx(He,{label:i,children:a.jsx(oe,{"aria-label":i,onClick:s,icon:a.jsx(uMe,{size:14}),variant:"promptOverlay",fontSize:12,px:.5,colorScheme:t?"invokeBlue":"base"})})});Zce.displayName="NegativePromptToggleButton";var itt=function(){};function ott(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e&&e.addEventListener&&e.addEventListener.apply(e,t)}function att(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e&&e.removeEventListener&&e.removeEventListener.apply(e,t)}var Xce=typeof window<"u",rtt=["mousedown","touchstart"],ltt=function(e,t,n){n===void 0&&(n=rtt);var s=h.useRef(t);h.useEffect(function(){s.current=t},[t]),h.useEffect(function(){for(var i=function(c){var d=e.current;d&&!d.contains(c.target)&&s.current(c)},o=0,r=n;o<r.length;o++){var l=r[o];ott(document,l,i)}return function(){for(var c=0,d=n;c<d.length;c++){var u=d[c];att(document,u,i)}}},[n,e])},ctt=Xce?h.useLayoutEffect:h.useEffect,Yce={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function dtt(){var e=h.useState(null),t=e[0],n=e[1],s=h.useState(Yce),i=s[0],o=s[1],r=h.useMemo(function(){return new window.ResizeObserver(function(l){if(l[0]){var c=l[0].contentRect,d=c.x,u=c.y,p=c.width,m=c.height,f=c.top,g=c.left,v=c.bottom,b=c.right;o({x:d,y:u,width:p,height:m,top:f,left:g,bottom:v,right:b})}})},[]);return ctt(function(){if(t)return r.observe(t),function(){r.disconnect()}},[t]),[n,i]}const Qce=Xce&&typeof window.ResizeObserver<"u"?dtt:function(){return[itt,Yce]},Jce=h.memo(()=>a.jsxs(yi,{isLazy:!0,children:[a.jsx(Ni,{children:a.jsx(oe,{size:"sm",variant:"promptOverlay","aria-label":"Positive Prompt History",icon:a.jsx($Me,{}),tooltip:"Prompt History"})}),a.jsx(Ls,{children:a.jsx(bi,{children:a.jsx(Fi,{maxH:300,maxW:400,h:300,w:400,children:a.jsx(ede,{})})})})]}));Jce.displayName="PositivePromptHistoryIconButton";const ede=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(vU),[s,i]=h.useState(""),o=h.useCallback(()=>{t(w2e())},[t]),r=h.useMemo(()=>{const c=s.trim();return c?n.filter(d=>d.toLowerCase().includes(c.toLowerCase())):n},[n,s]),l=h.useCallback(c=>{i(c.target.value)},[]);return a.jsxs(A,{flexDir:"column",gap:2,w:"full",h:"full",children:[a.jsxs(A,{alignItems:"center",gap:2,justifyContent:"space-between",children:[a.jsx(q,{fontWeight:"semibold",color:"base.300",children:"Prompt History"}),a.jsx(Nt,{size:"sm",variant:"outline",placeholder:"Search...",value:s,onChange:l,width:"max-content",isDisabled:n.length===0}),a.jsx(he,{size:"sm",variant:"link",leftIcon:a.jsx(Ea,{}),onClick:o,isDisabled:n.length===0,children:"Clear History"})]}),a.jsx(vt,{}),a.jsxs(A,{flexDir:"column",flexGrow:1,minH:0,children:[n.length===0&&a.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:a.jsx(q,{color:"base.300",children:e("prompt.noPromptHistory")})}),n.length!==0&&r.length===0&&a.jsxs(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:[a.jsx(q,{color:"base.300",children:e("prompt.noMatchingPrompts")})," "]}),r.length>0&&a.jsx(Hs,{children:a.jsx(A,{flexDir:"column",children:r.map((c,d)=>a.jsx(tde,{prompt:c},`${c}-${d}`))})})]}),a.jsx(A,{alignItems:"center",justifyContent:"center",pt:1,children:a.jsxs(q,{color:"base.300",textAlign:"center",children:[a.jsx(Zu,{textTransform:"lowercase",children:"alt+up/down"})," ",e("prompt.toSwitchBetweenPrompts")]})})]})});ede.displayName="PromptHistoryContent";const tde=h.memo(({prompt:e})=>{const t=Q(),n=Jr(),s=h.useCallback(()=>{t(Nd(e))},[t,e]),i=h.useCallback(()=>{t(_2e(e))},[t,e]);return a.jsxs(A,{gap:2,children:[!n&&a.jsx(oe,{size:"sm",variant:"ghost","aria-label":"Use prompt",icon:a.jsx(wDe,{}),onClick:s}),n&&a.jsx(oe,{size:"sm",variant:"ghost","aria-label":"Delete",icon:a.jsx(Qc,{}),onClick:i,colorScheme:"error"}),a.jsx(q,{color:"base.300",children:e})]})});tde.displayName="PromptItem";const utt={trackWidth:!1,trackHeight:!0,initialHeight:120},htt=()=>{const e=Ze(),t=M(vU),n=h.useRef(null),s=h.useCallback(()=>{if(t.length===0)return;let r=n.current;if(!r)r={stashedPrompt:Qf(e.getState()),historyIdx:0},n.current=r;else{if(r.historyIdx===t.length-1)return;r.historyIdx=r.historyIdx+1}const l=t[r.historyIdx];l!==void 0&&e.dispatch(Nd(l))},[t,e]),i=h.useCallback(()=>{if(t.length===0)return;let r=n.current;if(!r)return;if(r.historyIdx=r.historyIdx-1,r.historyIdx<0){e.dispatch(Nd(r.stashedPrompt)),n.current=null;return}const l=t[r.historyIdx];l!==void 0&&e.dispatch(Nd(l))},[t,e]),o=h.useCallback(()=>{n.current=null},[]);return{prev:s,next:i,reset:o}},S8=h.memo(()=>{const e=Q(),t=M(Qf),n=M(MM),s=M(Ry),i=M(RM),o=htt(),r=h.useRef(null);Uce("positive_prompt",r,utt);const{activeStylePreset:l}=lm(void 0,{selectFromResult:({data:x})=>{let w=null;return x&&(w=x.find(_=>_.id===s)),{activeStylePreset:w}}}),{t:c}=T(),d=h.useCallback(x=>{e(Nd(x)),o.reset()},[e,o]),{onChange:u,isOpen:p,onClose:m,onOpen:f,onSelect:g,onKeyDown:v,onFocus:b}=US({prompt:t,textareaRef:r,onChange:d});ltt(r,o.reset);const C=h.useCallback(x=>{b(),x.preventDefault()},[b]);Be({id:"focusPrompt",category:"app",callback:C,options:{preventDefault:!0,enableOnFormTags:["INPUT","SELECT","TEXTAREA"]},dependencies:[C]});const y=h.useCallback(()=>document.activeElement===r.current,[]);return Be({id:"promptHistoryPrev",category:"app",callback:x=>{y()&&(x.preventDefault(),o.prev())},options:{preventDefault:!0,enableOnFormTags:["INPUT","SELECT","TEXTAREA"]},dependencies:[o.prev,y]}),Be({id:"promptHistoryNext",category:"app",callback:x=>{y()&&(x.preventDefault(),o.next())},options:{preventDefault:!0,enableOnFormTags:["INPUT","SELECT","TEXTAREA"]},dependencies:[o.next,y]}),qS({textareaRef:r,onPromptChange:x=>e(Nd(x))}),a.jsx(ke,{pos:"relative",children:a.jsx($1,{isOpen:p,onClose:m,onSelect:g,width:r.current?.clientWidth,children:a.jsxs(ke,{pos:"relative",children:[a.jsx(no,{className:"positive-prompt-textarea",name:"prompt",ref:r,value:t,onChange:u,onKeyDown:v,variant:"darkFilled",borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3,resize:"vertical",minH:32,fontFamily:"mono",fontSize:"0.82rem"}),a.jsx(w8,{children:a.jsxs(A,{flexDir:"column",gap:2,justifyContent:"flex-start",alignItems:"center",children:[a.jsx(V1,{isOpen:p,onOpen:f}),a.jsx(Kce,{}),a.jsx(Jce,{}),i&&a.jsx(Zce,{})]})}),a.jsx(C8,{label:"Prompt"}),n&&a.jsx(qce,{prompt:t,presetPrompt:l?.preset_data.positive_prompt||"",label:`${c("parameters.positivePromptPlaceholder")} (${c("stylePresets.preview")})`})]})})})});S8.displayName="ParamPositivePrompt";const k8=h.memo(()=>{const e=M(RM),t=M(S2e),n=M(LM);return a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsx(S8,{}),e&&n&&a.jsx(_8,{}),t&&a.jsx($ce,{})]})});k8.displayName="Prompts";const ci={initial:0,sliderMin:0,sliderMax:.99,numberInputMin:0,numberInputMax:.99,fineStep:.05,coarseStep:.1},ptt=()=>{const e=M(yU),t=Q(),{t:n}=T(),s=h.useCallback(i=>t(QH(i)),[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"paramCFGRescaleMultiplier",children:a.jsx(ne,{children:n("parameters.cfgRescaleMultiplier")})}),a.jsx(it,{value:e,defaultValue:ci.initial,min:ci.sliderMin,max:ci.sliderMax,step:ci.coarseStep,fineStep:ci.fineStep,onChange:s,marks:!0}),a.jsx(Pe,{value:e,defaultValue:ci.initial,min:ci.numberInputMin,max:ci.numberInputMax,step:ci.coarseStep,fineStep:ci.fineStep,onChange:s})]})},ftt=h.memo(ptt),mtt=()=>{const e=Q(),{t}=T(),n=M(k2e),[s,{isLoading:i}]=OM(),o=h.useCallback(u=>{u&&e(I2e(_s.parse(u)))},[e]),{options:r,value:l,onChange:c,noOptionsMessage:d}=nl({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return a.jsxs(te,{isDisabled:!r.length,isInvalid:!r.length,minW:0,flexGrow:1,gap:2,children:[a.jsx(ne,{m:0,children:t("modelManager.clipEmbed")}),a.jsx(pt,{value:l,options:r,onChange:c,noOptionsMessage:d})]})},gtt=h.memo(mtt),vtt=()=>{const e=Q(),{t}=T(),n=M(j2e),[s,{isLoading:i}]=OM(),o=h.useCallback(u=>{u&&e(E2e(_s.parse(u)))},[e]),{options:r,value:l,onChange:c,noOptionsMessage:d}=nl({modelConfigs:s.filter(u=>A2e(u)),onChange:o,selectedModel:n,isLoading:i});return a.jsxs(te,{isDisabled:!r.length,isInvalid:!r.length,minW:0,flexGrow:1,gap:2,children:[a.jsx(ne,{m:0,children:t("modelManager.clipGEmbed")}),a.jsx(pt,{value:l,options:r,onChange:c,noOptionsMessage:d})]})},ytt=h.memo(vtt),btt=()=>{const e=Q(),{t}=T(),n=M(P2e),[s,{isLoading:i}]=OM(),o=h.useCallback(u=>{u&&e(T2e(_s.parse(u)))},[e]),{options:r,value:l,onChange:c,noOptionsMessage:d}=nl({modelConfigs:s.filter(u=>D2e(u)),onChange:o,selectedModel:n,isLoading:i});return a.jsxs(te,{isDisabled:!r.length,isInvalid:!r.length,minW:0,flexGrow:1,gap:2,children:[a.jsx(ne,{m:0,children:t("modelManager.clipLEmbed")}),a.jsx(pt,{value:l,options:r,onChange:c,noOptionsMessage:d})]})},xtt=h.memo(btt),ud={initial:0,sliderMin:0,numberInputMin:0,fineStep:1,coarseStep:1},Ctt=()=>{const e=M(M2e),t=M(Fy),n=Q(),{t:s}=T(),i=h.useCallback(l=>{n(YH(l))},[n]),o=h.useMemo(()=>t?Ab[t.base]?.maxClip:Ab["sd-1"]?.maxClip,[t]),r=h.useMemo(()=>t?Ab[t.base]?.markers:Ab["sd-1"]?.markers,[t]);return t?.base==="sdxl"?null:a.jsxs(te,{children:[a.jsx(Ue,{feature:"clipSkip",children:a.jsx(ne,{children:s("parameters.clipSkip")})}),a.jsx(it,{value:e,defaultValue:ud.initial,min:ud.sliderMin,max:o??0,step:ud.coarseStep,fineStep:ud.fineStep,onChange:i,marks:r}),a.jsx(Pe,{value:e,defaultValue:ud.initial,min:ud.numberInputMin,max:o??0,step:ud.coarseStep,fineStep:ud.fineStep,onChange:i})]})},wtt=h.memo(Ctt),_tt=()=>{const e=Q(),{t}=T(),n=M(L2e),[s,{isLoading:i}]=R2e(),o=h.useCallback(u=>{u&&e(O2e(_s.parse(u)))},[e]),{options:r,value:l,onChange:c,noOptionsMessage:d}=nl({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return a.jsxs(te,{isDisabled:!r.length,isInvalid:!r.length,minW:0,flexGrow:1,gap:2,children:[a.jsx(ne,{m:0,children:t("modelManager.t5Encoder")}),a.jsx(pt,{value:l,options:r,onChange:c,noOptionsMessage:d})]})},f$=h.memo(_tt),nde=h.memo(()=>{const e=Q(),{t}=T(),n=M(UD),s=M(Uw),[i,{isLoading:o}]=bU(),r=s!==null,l=h.useCallback(m=>{e(m?WA(_s.parse(m)):WA(null))},[e]),{options:c,value:d,onChange:u,noOptionsMessage:p}=nl({modelConfigs:i,onChange:l,selectedModel:n,isLoading:o});return a.jsxs(te,{minW:0,flexGrow:1,gap:2,isDisabled:r,children:[a.jsx(ne,{m:0,children:t("modelManager.zImageVae")}),a.jsx(pt,{value:d,options:c,onChange:u,noOptionsMessage:p,isClearable:!0,isDisabled:r,placeholder:t("modelManager.zImageVaePlaceholder")})]})});nde.displayName="ParamZImageVaeModelSelect";const sde=h.memo(()=>{const e=Q(),{t}=T(),n=M(qD),s=M(Uw),[i,{isLoading:o}]=N2e(),r=s!==null,l=h.useCallback(m=>{e(m?UA(_s.parse(m)):UA(null))},[e]),{options:c,value:d,onChange:u,noOptionsMessage:p}=nl({modelConfigs:i,onChange:l,selectedModel:n,isLoading:o});return a.jsxs(te,{minW:0,flexGrow:1,gap:2,isDisabled:r,children:[a.jsx(ne,{m:0,children:t("modelManager.zImageQwen3Encoder")}),a.jsx(pt,{value:d,options:c,onChange:u,noOptionsMessage:p,isClearable:!0,isDisabled:r,placeholder:t("modelManager.zImageQwen3EncoderPlaceholder")})]})});sde.displayName="ParamZImageQwen3EncoderModelSelect";const ide=h.memo(()=>{const e=Q(),{t}=T(),n=M(Uw),s=M(UD),i=M(qD),[o,{isLoading:r}]=F2e(),l=s!==null||i!==null,c=h.useCallback(f=>{e(f?HA(_s.parse(f)):HA(null))},[e]),{options:d,value:u,onChange:p,noOptionsMessage:m}=nl({modelConfigs:o,onChange:c,selectedModel:n,isLoading:r});return a.jsxs(te,{minW:0,flexGrow:1,gap:2,isDisabled:l,children:[a.jsx(ne,{m:0,children:t("modelManager.zImageQwen3Source")}),a.jsx(pt,{value:u,options:d,onChange:p,noOptionsMessage:m,isClearable:!0,isDisabled:l,placeholder:t("modelManager.zImageQwen3SourcePlaceholder")})]})});ide.displayName="ParamZImageQwen3SourceModelSelect";const Stt=()=>a.jsxs(a.Fragment,{children:[a.jsx(nde,{}),a.jsx(sde,{}),a.jsx(ide,{})]}),ktt=h.memo(Stt),Itt=()=>{const{t:e}=T(),t=M(B2e),n=Q(),s=h.useCallback(i=>{n(UH(i.target.checked))},[n]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"seamlessTilingXAxis",children:a.jsx(ne,{children:e("parameters.seamlessXAxis")})}),a.jsx(mt,{isChecked:t,onChange:s})]})},jtt=h.memo(Itt),Ett=()=>{const{t:e}=T(),t=M(z2e),n=Q(),s=h.useCallback(i=>{n(WH(i.target.checked))},[n]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"seamlessTilingYAxis",children:a.jsx(ne,{children:e("parameters.seamlessYAxis")})}),a.jsx(mt,{isChecked:t,onChange:s})]})},Att=h.memo(Ett),Ptt=()=>{const{t:e}=T(),t=M(V2e),n=Q(),s=h.useCallback(i=>{n($2e(i.target.checked))},[n]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"colorCompensation",children:a.jsx(ne,{children:e("parameters.colorCompensation")})}),a.jsx(mt,{isChecked:t,onChange:s})]})},Ttt=h.memo(Ptt),Dtt=()=>{const e=Q(),{t}=T(),n=M(G2e),[s,{isLoading:i}]=bU(),o=h.useCallback(u=>{u&&e(H2e(_s.parse(u)))},[e]),{options:r,value:l,onChange:c,noOptionsMessage:d}=Jh({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return a.jsxs(te,{isDisabled:!r.length,isInvalid:!r.length,minW:0,flexGrow:1,gap:2,children:[a.jsx(Ue,{feature:"paramVAE",children:a.jsx(ne,{m:0,children:t("modelManager.vae")})}),a.jsx(pt,{value:l,options:r,onChange:c,noOptionsMessage:d})]})},ode=h.memo(Dtt),Mtt=()=>{const e=Q(),{t}=T(),n=M(qc),s=M(xU),[i,{isLoading:o}]=CU(),r=h.useCallback(m=>{const f=n===m.base;return!!!n||!f},[n]),l=h.useCallback(m=>{e(RH(m?_s.parse(m):null))},[e]),{options:c,value:d,onChange:u,noOptionsMessage:p}=Jh({modelConfigs:i,onChange:l,selectedModel:s,isLoading:o,getIsDisabled:r});return a.jsxs(te,{isDisabled:!c.length,isInvalid:!c.length,minW:0,flexGrow:1,gap:2,children:[a.jsx(Ue,{feature:"paramVAE",children:a.jsx(ne,{m:0,children:t("modelManager.vae")})}),a.jsx(pt,{isClearable:!0,value:d,placeholder:d?d.value:t("models.defaultVAE"),options:c,onChange:u,noOptionsMessage:p})]})},ade=h.memo(Mtt),m$=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],Ltt=()=>{const{t:e}=T(),t=Q(),n=M(wU),s=h.useCallback(o=>{_U(o?.value)&&t(W2e(o.value))},[t]),i=h.useMemo(()=>m$.find(o=>o.value===n),[n]);return a.jsxs(te,{flexGrow:0,children:[a.jsx(Ue,{feature:"paramVAEPrecision",children:a.jsx(ne,{m:0,children:e("modelManager.vaePrecision")})}),a.jsx(pt,{value:i,options:m$,onChange:s})]})},rde=h.memo(Ltt),sd=e=>{const t=Q(),n=h.useMemo(()=>ve(DM,o=>o.accordions[e.id]??e.defaultIsOpen),[e]),s=M(n),i=h.useCallback(()=>{t(U2e({id:e.id,isOpen:!s}))},[e.id,t,s]);return{isOpen:s,onToggle:i}},Rtt={minW:"9.2rem"},Ott={flexGrow:1},I8=h.memo(()=>{const e=M(SU),{currentData:t}=om(e??Ri),n=M(Hc),s=M(u_),i=M(kU),o=h.useMemo(()=>Yn([oo,Hc],(u,p)=>{const m=[];if(p){if(t){let f=t.name;u.vaePrecision==="fp16"&&(f+=` ${u.vaePrecision}`),m.push(f)}}else{if(t){let f=t.name;u.vaePrecision==="fp16"&&(f+=` ${u.vaePrecision}`),m.push(f)}else u.vaePrecision==="fp16"&&m.push(`VAE ${u.vaePrecision}`);u.clipSkip&&m.push(`Skip ${u.clipSkip}`),u.cfgRescaleMultiplier&&m.push(`Rescale ${u.cfgRescaleMultiplier}`),(u.seamlessXAxis||u.seamlessYAxis)&&m.push("seamless")}return m}),[t]),r=M(o),{t:l}=T(),{isOpen:c,onToggle:d}=sd({id:"'advanced-settings-generate",defaultIsOpen:!1});return a.jsx(Kc,{label:l("accordions.advanced.title"),badges:r,isOpen:c,onToggle:d,children:a.jsxs(A,{gap:4,alignItems:"center",p:4,flexDir:"column","data-testid":"advanced-settings-accordion",children:[!i&&a.jsxs(A,{gap:4,w:"full",children:[n?a.jsx(ode,{}):a.jsx(ade,{}),!n&&!s&&a.jsx(rde,{})]}),!n&&!s&&!i&&a.jsxs(a.Fragment,{children:[a.jsxs(Ys,{formLabelProps:Rtt,children:[a.jsx(wtt,{}),a.jsx(ftt,{})]}),a.jsx(A,{gap:4,w:"full",children:a.jsx(Ys,{formLabelProps:Ott,children:a.jsxs(cm,{columns:2,spacing:4,w:"full",children:[a.jsx(jtt,{}),a.jsx(Att,{}),a.jsx(Ttt,{}),a.jsx(ke,{})]})})})]}),n&&a.jsxs(Ys,{children:[a.jsx(f$,{}),a.jsx(gtt,{})]}),s&&a.jsxs(Ys,{children:[a.jsx(f$,{}),a.jsx(xtt,{}),a.jsx(ytt,{})]}),i&&a.jsx(Ys,{children:a.jsx(ktt,{})})]})})});I8.displayName="AdvancedSettingsAccordion";const dl={initial:16,sliderMin:0,sliderMax:128,numberInputMin:0,numberInputMax:1024,fineStep:8,coarseStep:16},Ntt=()=>{const e=Q(),t=M(q2e),{t:n}=T(),s=h.useCallback(i=>{e(K2e(i))},[e]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"compositingCoherenceEdgeSize",children:a.jsx(ne,{children:n("parameters.coherenceEdgeSize")})}),a.jsx(it,{min:dl.sliderMin,max:dl.sliderMax,step:dl.coarseStep,fineStep:dl.fineStep,value:t,defaultValue:dl.initial,onChange:s,marks:!0}),a.jsx(Pe,{min:dl.numberInputMin,max:dl.numberInputMax,step:dl.coarseStep,fineStep:dl.fineStep,value:t,defaultValue:dl.initial,onChange:s})]})},Ftt=h.memo(Ntt),Btt=()=>{const e=Q(),t=M(Z2e),{t:n}=T(),s=h.useCallback(i=>{e(X2e(i))},[e]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"compositingCoherenceMinDenoise",children:a.jsx(ne,{children:n("parameters.coherenceMinDenoise")})}),a.jsx(it,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s}),a.jsx(Pe,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s})]})},ztt=h.memo(Btt),Vtt=()=>{const e=Q(),t=M(Y2e),{t:n}=T(),s=h.useMemo(()=>[{label:n("parameters.gaussianBlur"),value:"Gaussian Blur"},{label:n("parameters.boxBlur"),value:"Box Blur"},{label:n("parameters.staged"),value:"Staged"}],[n]),i=h.useCallback(r=>{Q2e(r?.value)&&e(J2e(r.value))},[e]),o=h.useMemo(()=>s.find(r=>r.value===t),[t,s]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"compositingCoherenceMode",children:a.jsx(ne,{children:n("parameters.coherenceMode")})}),a.jsx(pt,{options:s,value:o,onChange:i})]})},$tt=h.memo(Vtt),ul={initial:16,sliderMin:0,sliderMax:128,numberInputMin:0,numberInputMax:512,fineStep:1,coarseStep:1},Gtt=()=>{const{t:e}=T(),t=Q(),n=M(IU),s=h.useCallback(i=>{t(eCe(i))},[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"compositingMaskBlur",children:a.jsx(ne,{children:e("parameters.maskBlur")})}),a.jsx(it,{value:n,onChange:s,min:ul.sliderMin,max:ul.sliderMax,defaultValue:ul.initial,step:ul.coarseStep,fineStep:ul.fineStep,marks:!0}),a.jsx(Pe,{value:n,onChange:s,defaultValue:ul.initial,min:ul.numberInputMin,max:ul.numberInputMax,step:ul.coarseStep,fineStep:ul.fineStep})]})},Htt=h.memo(Gtt),Wtt=()=>{const{t:e}=T(),t=Q(),n=M(Wy),{options:s}=tCe(void 0,{selectFromResult:({data:r})=>r===void 0?{options:os}:r?{options:Qk.options.map(l=>({label:l,value:l}))}:{options:Qk.options.filter(l=>l!=="patchmatch").map(l=>({label:l,value:l}))}}),i=h.useCallback(r=>{!r||!s.find(l=>l.value===r.value)||t(nCe(Qk.parse(r.value)))},[t,s]),o=h.useMemo(()=>s.find(r=>r.value===n),[s,n]);return a.jsxs(te,{isDisabled:s.length===0,children:[a.jsx(Ue,{feature:"infillMethod",children:a.jsx(ne,{children:e("parameters.infillMethod")})}),a.jsx(pt,{value:o,options:s,onChange:i})]})},Utt=h.memo(Wtt),sA={width:6,height:6,borderColor:"base.100"},qtt={".react-colorful__hue-pointer":sA,".react-colorful__saturation-pointer":sA,".react-colorful__alpha-pointer":sA,gap:4,flexDir:"column"},Ktt={width:"100%"},j0="3.5rem",Ztt=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:i=!1}=e,{t:o}=T(),r=h.useCallback(C=>n({...t,r:C}),[t,n]),l=h.useCallback(C=>n({...t,g:C}),[t,n]),c=h.useCallback(C=>n({...t,b:C}),[t,n]),d=h.useCallback(C=>n({...t,a:C}),[t,n]),[u,p]=h.useState("rgb"),[m,f]=h.useState(k2(t,!0));h.useEffect(()=>{f(k2(t,!0))},[t]);const g=h.useCallback(()=>p(C=>C==="rgb"?"hex":"rgb"),[]),v=h.useCallback(C=>{let y=C.target.value.trim();y.startsWith("#")||(y=`#${y}`);const x=y.replace(/[^#0-9a-fA-F]/g,"").slice(0,9);f(x);const w=x.replace("#","");if(w.length===6||w.length===8){const _=w.length===8?parseInt(w.slice(6,8),16)/255:t.a,S=kse(w.slice(0,6).padEnd(6,"0"),_);n(S)}},[t.a,n]),b=h.useCallback(C=>{const y={...t,a:Math.max(0,Math.min(1,C))};n(y),f(k2(y,!0))},[t,n]);return a.jsxs(A,{sx:qtt,children:[a.jsx(Mie,{color:t,onChange:n,style:Ktt}),s&&(u==="rgb"?a.jsxs(A,{gap:2,alignItems:"end",children:[a.jsx(he,{size:"xs",variant:"ghost",px:3,minW:"unset",h:10,whiteSpace:"nowrap",onClick:g,"aria-label":"Toggle RGB/HEX",children:"RGB"}),a.jsxs(te,{gap:0,children:[a.jsx(ne,{children:o("common.red")[0]}),a.jsx(Pe,{value:t.r,onChange:r,min:0,max:255,step:1,w:j0})]}),a.jsxs(te,{gap:0,children:[a.jsx(ne,{children:o("common.green")[0]}),a.jsx(Pe,{value:t.g,onChange:l,min:0,max:255,step:1,w:j0})]}),a.jsxs(te,{gap:0,children:[a.jsx(ne,{children:o("common.blue")[0]}),a.jsx(Pe,{value:t.b,onChange:c,min:0,max:255,step:1,w:j0})]}),a.jsxs(te,{gap:0,children:[a.jsx(ne,{children:o("common.alpha")[0]}),a.jsx(Pe,{value:t.a,onChange:d,step:.1,min:0,max:1,w:j0})]})]}):a.jsxs(A,{gap:2,alignItems:"end",children:[a.jsx(he,{size:"xs",variant:"ghost",px:3,minW:"unset",h:10,whiteSpace:"nowrap",onClick:g,"aria-label":"Toggle RGB/HEX",children:"HEX"}),a.jsxs(te,{gap:0,children:[a.jsx(ne,{children:o("common.hex",{defaultValue:"Hex"})}),a.jsx(Nt,{value:m,onChange:v,placeholder:"#RRGGBB or #RRGGBBAA",w:"10rem"})]}),a.jsxs(te,{gap:0,children:[a.jsx(ne,{children:o("common.alpha")[0]}),a.jsx(Pe,{value:t.a,onChange:b,step:.01,min:0,max:1,w:j0})]})]})),i&&a.jsx(A,{gap:2,justifyContent:"space-between",children:YHe.map((C,y)=>a.jsx(Xtt,{color:C,onChange:n},y))})]})},j8=h.memo(Ztt),Xtt=({color:e,onChange:t})=>{const n=h.useCallback(()=>{t(e)},[e,t]);return a.jsx(ke,{role:"button",onClick:n,h:8,w:8,bg:Bo(e),borderRadius:"base"})},Ytt=()=>{const e=Q(),t=M(sCe),n=M(Wy),{t:s}=T(),i=h.useCallback(o=>{e(iCe(o))},[e]);return a.jsx(A,{flexDir:"column",gap:4,children:a.jsxs(te,{isDisabled:n!=="color",children:[a.jsx(ne,{children:s("parameters.infillColorValue")}),a.jsx(ke,{w:"full",pt:2,pb:2,children:a.jsx(j8,{color:t,onChange:i})})]})})},Qtt=h.memo(Ytt),hl={initial:1,sliderMin:1,sliderMax:10,numberInputMin:1,numberInputMax:10,fineStep:1,coarseStep:1},Jtt=()=>{const e=Q(),t=M(Wy),n=M(oCe),{t:s}=T(),i=h.useCallback(o=>{e(aCe(o))},[e]);return a.jsxs(te,{isDisabled:t!=="patchmatch",children:[a.jsx(Ue,{feature:"patchmatchDownScaleSize",children:a.jsx(ne,{children:s("parameters.patchmatchDownScaleSize")})}),a.jsx(it,{value:n,onChange:i,marks:!0,defaultValue:hl.initial,min:hl.sliderMin,max:hl.sliderMax,step:hl.coarseStep,fineStep:hl.fineStep}),a.jsx(Pe,{value:n,onChange:i,defaultValue:hl.initial,min:hl.numberInputMin,max:hl.numberInputMax,step:hl.coarseStep,fineStep:hl.fineStep})]})},ent=h.memo(Jtt),pl={initial:32,sliderMin:16,sliderMax:64,numberInputMin:16,numberInputMax:256,fineStep:1,coarseStep:1},tnt=()=>{const e=Q(),t=M(rCe),n=M(Wy),{t:s}=T(),i=h.useCallback(o=>{e(lCe(o))},[e]);return a.jsxs(te,{isDisabled:n!=="tile",children:[a.jsx(ne,{children:s("parameters.tileSize")}),a.jsx(it,{value:t,onChange:i,defaultValue:pl.initial,min:pl.sliderMin,max:pl.sliderMax,step:pl.coarseStep,fineStep:pl.fineStep,marks:!0}),a.jsx(Pe,{value:t,onChange:i,defaultValue:pl.initial,min:pl.numberInputMin,max:pl.numberInputMax,step:pl.coarseStep,fineStep:pl.fineStep})]})},nnt=h.memo(tnt),snt=()=>{const e=M(Wy);return e==="tile"?a.jsx(nnt,{}):e==="patchmatch"?a.jsx(ent,{}):e==="color"?a.jsx(Qtt,{}):null},int=h.memo(snt),g$={minW:"4.5rem"},lde=h.memo(()=>{const{t:e}=T(),{isOpen:t,onToggle:n}=sd({id:"compositing-settings",defaultIsOpen:!1});return a.jsx(Kc,{isOpen:t,onToggle:n,label:e("accordions.compositing.title"),children:a.jsxs(Vy,{variant:"collapse",children:[a.jsxs($y,{children:[a.jsx(Qs,{children:e("accordions.compositing.coherenceTab")}),a.jsx(Qs,{children:e("accordions.compositing.infillTab")})]}),a.jsxs(Gy,{children:[a.jsx(Js,{children:a.jsx(A,{gap:4,p:4,flexDir:"column",children:a.jsxs(Ys,{formLabelProps:g$,children:[a.jsx($tt,{}),a.jsx(Ftt,{}),a.jsx(ztt,{}),a.jsx(Htt,{})]})})}),a.jsx(Js,{children:a.jsx(A,{gap:4,p:4,flexDir:"column",children:a.jsxs(Ys,{formLabelProps:g$,children:[a.jsx(Utt,{}),a.jsx(int,{})]})})})]})]})})});lde.displayName="CompositingSettingsAccordion";const ont=[-1,0,1,2],cde=h.memo(e=>{const t=h.useMemo(()=>cCe(e.id),[e.id]),n=M(t);return n?a.jsx(dde,{lora:n}):null});cde.displayName="LoRACard";const dde=h.memo(({lora:e})=>{const t=Q(),{data:n}=om(e.model.key),s=h.useCallback(r=>{t(dCe({id:e.id,weight:r}))},[t,e.id]),i=h.useCallback(()=>{t(uCe({id:e.id,isEnabled:!e.isEnabled}))},[t,e.id,e.isEnabled]),o=h.useCallback(()=>{t(hCe({id:e.id}))},[t,e.id]);return a.jsxs(pCe,{variant:"lora",children:[a.jsx(fCe,{children:a.jsxs(A,{alignItems:"center",justifyContent:"space-between",width:"100%",gap:2,children:[a.jsx(q,{noOfLines:1,wordBreak:"break-all",color:e.isEnabled?"base.200":"base.500",children:n?.name??e.model.key.substring(0,8)}),a.jsxs(A,{alignItems:"center",gap:2,children:[a.jsx(mt,{size:"sm",onChange:i,isChecked:e.isEnabled}),a.jsx(oe,{"aria-label":"Remove LoRA",variant:"ghost",size:"sm",onClick:o,icon:a.jsx(Ea,{})})]})]})}),a.jsx(Ue,{feature:"loraWeight",children:a.jsxs(mCe,{children:[a.jsx(it,{value:e.weight,onChange:s,min:Ks.sliderMin,max:Ks.sliderMax,step:Ks.coarseStep,fineStep:Ks.fineStep,marks:ont,defaultValue:Ks.initial,isDisabled:!e.isEnabled}),a.jsx(Pe,{value:e.weight,onChange:s,min:Ks.numberInputMin,max:Ks.numberInputMax,step:Ks.coarseStep,fineStep:Ks.fineStep,w:20,flexShrink:0,defaultValue:Ks.initial,isDisabled:!e.isEnabled})]})})]})});dde.displayName="LoRAContent";const ant=Yn(Hy,e=>e.loras.map(({id:t})=>t)),E8=h.memo(()=>{const e=M(ant);return e.length?a.jsx(A,{flexWrap:"wrap",gap:2,children:e.map(t=>a.jsx(cde,{id:t},t))}):null});E8.displayName="LoRAList";const rnt=Yn(Hy,({loras:e})=>e.map(({model:t})=>t.key)),lnt=()=>{const e=Q(),[t,{isLoading:n}]=KW(),{t:s}=T(),i=M(rnt),o=M(qc),r=h.useMemo(()=>o?t.filter(p=>p.base===o):os,[t,o]),l=h.useCallback(p=>i.includes(p.key),[i]),c=h.useCallback(p=>{p&&e(gCe({model:p}))},[e]),d=h.useMemo(()=>n?s("common.loading"):r.length===0?s(o?"models.noCompatibleLoRAs":"models.selectModel"):s("models.addLora"),[n,r.length,o,s]),u=h.useMemo(()=>{if(o)return{[o]:!0}},[o]);return a.jsxs(te,{gap:2,children:[a.jsx(Ue,{feature:"lora",children:a.jsxs(ne,{children:[s("models.concepts")," "]})}),a.jsx(sb,{pickerId:"lora-select",modelConfigs:r,onChange:c,grouped:!1,selectedModelConfig:void 0,allowEmpty:!0,placeholder:d,getIsOptionDisabled:l,initialGroupStates:u,noOptionsText:s(o?"models.noCompatibleLoRAs":"models.selectModel")})]})},ude=h.memo(lnt),Es={initial:7,sliderMin:1,sliderMax:20,numberInputMin:1,numberInputMax:200,fineStep:.1,coarseStep:.5},hde=[Es.sliderMin,Math.floor(Es.sliderMax/2),Es.sliderMax],cnt=()=>{const e=M(jU),t=Q(),{t:n}=T(),s=h.useCallback(i=>t(JH(i)),[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"paramCFGScale",children:a.jsx(ne,{children:n("parameters.cfgScale")})}),a.jsx(it,{value:e,defaultValue:Es.initial,min:Es.sliderMin,max:Es.sliderMax,step:Es.coarseStep,fineStep:Es.fineStep,onChange:s,marks:hde}),a.jsx(Pe,{value:e,defaultValue:Es.initial,min:Es.numberInputMin,max:Es.numberInputMax,step:Es.coarseStep,fineStep:Es.fineStep,onChange:s})]})},dnt=h.memo(cnt),ps={initial:4,sliderMin:2,sliderMax:6,numberInputMin:1,numberInputMax:20,fineStep:.1,coarseStep:.5},pde=[ps.sliderMin,Math.floor(ps.sliderMax-(ps.sliderMax-ps.sliderMin)/2),ps.sliderMax],unt=()=>{const e=M(EU),t=Q(),{t:n}=T(),s=h.useCallback(i=>t(XH(i)),[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"paramGuidance",children:a.jsx(ne,{children:n("parameters.guidance")})}),a.jsx(it,{value:e,defaultValue:ps.initial,min:ps.sliderMin,max:ps.sliderMax,step:ps.coarseStep,fineStep:ps.fineStep,onChange:s,marks:pde}),a.jsx(Pe,{value:e,defaultValue:ps.initial,min:ps.numberInputMin,max:ps.numberInputMax,step:ps.coarseStep,fineStep:ps.fineStep,onChange:s})]})},fde=h.memo(unt),hnt=()=>{const e=Q(),{t}=T(),n=M(AU),s=h.useCallback(o=>{Uy(o?.value)&&e(ZH(o.value))},[e]),i=h.useMemo(()=>Hl.find(o=>o.value===n),[n]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"paramScheduler",children:a.jsx(ne,{children:t("parameters.scheduler")})}),a.jsx(pt,{value:i,options:Hl,onChange:s})]})},pnt=h.memo(hnt),As={initial:30,sliderMin:1,sliderMax:100,numberInputMin:1,numberInputMax:500,fineStep:1,coarseStep:1},mde=[As.sliderMin,Math.floor(As.sliderMax/2),As.sliderMax],fnt=()=>{const e=M(PU),t=Q(),{t:n}=T(),s=h.useCallback(i=>{t(KH(i))},[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"paramSteps",children:a.jsx(ne,{children:n("parameters.steps")})}),a.jsx(it,{value:e,defaultValue:As.initial,min:As.sliderMin,max:As.sliderMax,step:As.coarseStep,fineStep:As.fineStep,onChange:s,marks:mde}),a.jsx(Pe,{value:e,defaultValue:As.initial,min:As.numberInputMin,max:As.numberInputMax,step:As.coarseStep,fineStep:As.fineStep,onChange:s})]})},gde=h.memo(fnt),mnt=()=>{const e=M(Fy),{t}=T(),n=Q(),{data:s}=Fh(),i=M(AU),o=M(PU),r=M(xU),l=M(wU),c=M(NM),d=M(FM),u=M(EU),p=M(jU),m=M(yU),f=h.useMemo(()=>!s||e===null?null:$l.selectById(s,e.key),[s,e]),g=h.useMemo(()=>{const x=f&&If(f)&&f.default_settings;return x&&Object.values(x).some(w=>!!w)},[f]),v=h.useMemo(()=>f&&If(f)&&f.default_settings?f.default_settings:bH,[f]),b=h.useMemo(()=>{const x=[];if(g){const{vae:w,vae_precision:_,cfg_scale:S,cfg_rescale_multiplier:I,steps:k,scheduler:E,width:j,height:P,guidance:D}=v;!st(w)&&r&&w!==r.key&&x.push(t("modelManager.vae")),!st(w)&&!r&&w!=="default"&&x.push(t("modelManager.vae")),!st(_)&&_!==l&&x.push(t("modelManager.vaePrecision")),!st(S)&&S!==p&&x.push(t("parameters.cfgScale")),!st(I)&&I!==m&&x.push(t("parameters.cfgRescaleMultiplier")),!st(k)&&k!==o&&x.push(t("parameters.steps")),!st(E)&&E!==i&&x.push(t("parameters.scheduler")),!st(j)&&j!==c&&x.push(t("parameters.width")),!st(P)&&P!==d&&x.push(t("parameters.height")),!st(D)&&D!==u&&x.push(t("parameters.guidance"))}return x},[g,r,l,p,m,o,i,c,d,u,t,v]),C=h.useMemo(()=>e?g?b.length===0?t("modelManager.usingDefaultSettings"):a.jsxs(A,{direction:"column",gap:2,children:[a.jsx(q,{children:t("modelManager.defaultSettingsOutOfSync")}),a.jsx(Li,{children:b.map(x=>a.jsx(rn,{children:x},x))}),a.jsx(q,{children:t("modelManager.restoreDefaultSettings")})]}):t("modelManager.noDefaultSettings"):t("modelManager.noModelSelected"),[e,g,b,t]),y=h.useCallback(()=>{n(vCe())},[n]);return a.jsx(oe,{icon:a.jsx(Em,{}),tooltip:C,"aria-label":t("modelManager.useDefaultSettings"),isDisabled:!e||!g||b.length===0,onClick:y,size:"sm",variant:"ghost",colorScheme:"warning"})},A8=h.memo(()=>{const{t:e}=T(),t=Q(),[n]=Xw(),s=W1(),i=h.useCallback(r=>{t(pM(r))},[t]),o=h.useMemo(()=>s&&uU(s),[s]);return a.jsxs(A,{alignItems:"center",gap:2,children:[a.jsx(Ue,{feature:"paramModel",children:a.jsx(ne,{children:e("modelManager.model")})}),o&&a.jsx(Ue,{feature:"fluxDevLicense",hideDisable:!0,children:a.jsx(A,{justifyContent:"flex-start",children:a.jsx(Je,{as:hce})})}),a.jsx(sb,{pickerId:"main-model",modelConfigs:n,selectedModelConfig:s,onChange:i,grouped:!0}),a.jsx(mnt,{})]})});A8.displayName="MainModelPicker";const bk=e=>{const t=Q(),n=h.useMemo(()=>ve(DM,o=>o.expanders[e.id]??e.defaultIsOpen),[e]),s=M(n),i=h.useCallback(()=>{t(yCe({id:e.id,isOpen:!s}))},[t,e.id,s]);return{isOpen:s,onToggle:i}},gnt={minW:"4rem"},P8=h.memo(()=>{const{t:e}=T(),t=W1(),n=M(Hc),s=M(u_),i=M(h_),o=M(kU),r=h.useMemo(()=>Yn(Hy,f=>{const g=f.loras.filter(C=>C.isEnabled).length,v=g?[`${g} ${e("models.concepts")}`]:os,b=t?[t.name,t.base]:os;return{loraTabBadges:v,accordionBadges:b}}),[t,e]),{loraTabBadges:l,accordionBadges:c}=M(r),{isOpen:d,onToggle:u}=bk({id:"generation-settings-advanced",defaultIsOpen:!1}),{isOpen:p,onToggle:m}=sd({id:"generation-settings-generate",defaultIsOpen:!0});return a.jsx(Kc,{label:e("accordions.generation.title"),badges:[...c,...l],isOpen:p,onToggle:m,children:a.jsxs(ke,{px:4,pt:4,"data-testid":"generation-accordion",children:[a.jsxs(A,{gap:4,flexDir:"column",pb:0,children:[a.jsx(A8,{}),a.jsx(ude,{}),a.jsx(E8,{})]}),a.jsx(v_,{label:e("accordions.advanced.options"),isOpen:d,onToggle:u,children:a.jsx(A,{gap:4,flexDir:"column",pb:4,children:a.jsxs(Ys,{formLabelProps:gnt,children:[!n&&!s&&!i&&!o&&a.jsx(pnt,{}),a.jsx(gde,{}),n&&t&&!IM(t)&&a.jsx(fde,{}),!n&&a.jsx(dnt,{})]})})})]})})});P8.displayName="GenerationSettingsAccordion";const vde=h.memo(()=>{const e=M(bCe),t=Q(),n=h.useCallback(i=>{t(xCe(i.target.checked))},[t]),{t:s}=T();return a.jsxs(te,{w:"min-content",children:[a.jsx(Ue,{feature:"optimizedDenoising",children:a.jsxs(ne,{m:0,children:[s("parameters.optimizedImageToImage")," (",s("settings.beta"),")"]})}),a.jsx(mt,{isChecked:e,onChange:n})]})});vde.displayName="ParamOptimizedDenoisingToggle";const ip=()=>Io(),vnt=ve(rt,e=>e.bbox.scaleMethod==="manual"),ynt=ve(rt,e=>e.bbox.scaledSize.height),Sp={sliderMin:64,sliderMax:1536,numberInputMin:64,numberInputMax:4096,coarseStep:64},bnt=()=>{const{t:e}=T(),t=Q(),n=ip(),s=M(gu),i=M(vnt),o=M(ynt),r=M(Bh),l=h.useCallback(c=>{t(CCe(c))},[t]);return a.jsxs(te,{isDisabled:!i||n,children:[a.jsx(ne,{children:e("parameters.scaledHeight")}),a.jsx(it,{min:Sp.sliderMin,max:Sp.sliderMax,step:Sp.coarseStep,fineStep:r,value:o,onChange:l,marks:!0,defaultValue:s}),a.jsx(Pe,{min:Sp.numberInputMin,max:Sp.numberInputMax,step:Sp.coarseStep,fineStep:r,value:o,onChange:l,defaultValue:s})]})},xnt=h.memo(bnt),Cnt=ve(rt,e=>e.bbox.scaleMethod==="manual"),wnt=ve(rt,e=>e.bbox.scaledSize.width),kp={sliderMin:64,sliderMax:1536,numberInputMin:64,numberInputMax:4096,coarseStep:64},_nt=()=>{const{t:e}=T(),t=Q(),n=ip(),s=M(gu),i=M(Cnt),o=M(wnt),r=M(Bh),l=h.useCallback(c=>{t(wCe(c))},[t]);return a.jsxs(te,{isDisabled:!i||n,children:[a.jsx(ne,{children:e("parameters.scaledWidth")}),a.jsx(it,{min:kp.sliderMin,max:kp.sliderMax,step:kp.coarseStep,fineStep:r,value:o,onChange:l,defaultValue:s,marks:!0}),a.jsx(Pe,{min:kp.numberInputMin,max:kp.numberInputMax,step:kp.coarseStep,fineStep:r,value:o,onChange:l,defaultValue:s})]})},Snt=h.memo(_nt),knt=ve(rt,e=>e.bbox.scaleMethod),Int=()=>{const e=Q(),{t}=T(),n=M(knt),s=ip(),i=h.useMemo(()=>[{label:t("modelManager.none"),value:"none"},{label:t("common.auto"),value:"auto"},{label:t("modelManager.manual"),value:"manual"}],[t]),o=h.useCallback(l=>{_Ce(l?.value)&&e(SCe(l.value))},[e]),r=h.useMemo(()=>i.find(l=>l.value===n),[n,i]);return a.jsxs(te,{isDisabled:s,children:[a.jsx(Ue,{feature:"scaleBeforeProcessing",children:a.jsx(ne,{children:t("parameters.scaleBeforeProcessing")})}),a.jsx(pt,{value:r,options:i,onChange:o})]})},jnt=h.memo(Int),yde=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(kCe),s=Io(),i=h.useCallback(o=>{mM(o.target.value)&&t(ICe({id:o.target.value}))},[t]);return a.jsxs(te,{isDisabled:s,children:[a.jsx(Ue,{feature:"paramAspect",children:a.jsx(ne,{children:e("parameters.aspect")})}),a.jsx(Mi,{size:"sm",value:n,onChange:i,cursor:"pointer",iconSize:"0.75rem",icon:a.jsx(Do,{}),children:TU.options.map(o=>a.jsx("option",{value:o,children:o},o))})]})});yde.displayName="BboxAspectRatioSelect";const hd={sliderMin:64,sliderMax:1536,numberInputMin:64,numberInputMax:4096,coarseStep:64},bde=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(gu),s=M(FM),i=ip(),o=M(Bh),r=h.useCallback(c=>{t(MH({height:c}))},[t]),l=h.useMemo(()=>[hd.sliderMin,n,hd.sliderMax],[n]);return a.jsxs(te,{isDisabled:i,children:[a.jsx(Ue,{feature:"paramHeight",children:a.jsx(ne,{children:e("parameters.height")})}),a.jsx(it,{value:s,defaultValue:n,onChange:r,min:hd.sliderMin,max:hd.sliderMax,step:hd.coarseStep,fineStep:o,marks:l}),a.jsx(Pe,{value:s,defaultValue:n,onChange:r,min:hd.numberInputMin,max:hd.numberInputMax,step:hd.coarseStep,fineStep:o})]})});bde.displayName="BboxHeight";const Ent=ve(rt,e=>e.bbox.aspectRatio.isLocked),xde=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(Ent),s=ip(),i=h.useCallback(()=>{t(jCe())},[t]);return a.jsx(oe,{tooltip:e("parameters.lockAspectRatio"),"aria-label":e("parameters.lockAspectRatio"),onClick:i,variant:n?"outline":"ghost",size:"sm",icon:n?a.jsx(X4,{}):a.jsx(H4,{}),isDisabled:s})});xde.displayName="BboxLockAspectRatioButton";const Cde=h.memo(()=>{const e=M(NM),t=M(FM),n=M(ECe),[s,i]=Qce(),o=h.useMemo(()=>{if(!i)return{width:0,height:0};let r=e,l=t;return e>t?(r=i.width,l=r/n):(l=i.height,r=l*n),{width:r,height:l}},[i,e,t,n]);return a.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",ref:s,children:a.jsx(A,{position:"relative",borderRadius:"base",borderColor:"base.600",borderWidth:"3px",width:`${o.width}px`,height:`${o.height}px`,alignItems:"center",justifyContent:"center",children:a.jsxs(Ms,{borderRadius:"base",position:"absolute",top:0,right:0,bottom:0,left:0,gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"1fr 1fr 1fr",gap:"1px",bg:"base.700",children:[a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"})]})})})});Cde.displayName="BboxPreview";const Ant=ve(rt,e=>e.bbox.rect.width),Pnt=ve(rt,e=>e.bbox.rect.height),wde=h.memo(()=>{const{t:e}=T(),t=Q(),n=ip(),s=M(Ant),i=M(Pnt),o=M(gu),r=h.useMemo(()=>DU(s,i,o),[i,s,o]),l=h.useMemo(()=>MU(s,i,o),[i,s,o]),c=h.useCallback(()=>{t(xM())},[t]),d=h.useMemo(()=>e(r?"parameters.setToOptimalSizeTooSmall":l?"parameters.setToOptimalSizeTooLarge":"parameters.setToOptimalSize"),[l,r,e]);return a.jsx(oe,{tooltip:d,"aria-label":e("parameters.setToOptimalSize"),onClick:c,variant:"ghost",size:"sm",icon:a.jsx(Em,{}),colorScheme:r||l?"warning":"base",isDisabled:n})});wde.displayName="BboxSetOptimalSizeButton";const _de=h.memo(()=>{const{t:e}=T(),t=Q(),n=Io(),s=h.useCallback(()=>{t(ACe())},[t]);return a.jsx(oe,{tooltip:e("parameters.swapDimensions"),"aria-label":e("parameters.swapDimensions"),onClick:s,variant:"ghost",size:"sm",icon:a.jsx(QZ,{}),isDisabled:n})});_de.displayName="BboxSwapDimensionsButton";const pd={sliderMin:64,sliderMax:1536,numberInputMin:64,numberInputMax:4096,coarseStep:64},Sde=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(NM),s=M(gu),i=ip(),o=M(Bh),r=h.useCallback(c=>{t(PH({width:c}))},[t]),l=h.useMemo(()=>[pd.sliderMin,s,pd.sliderMax],[s]);return a.jsxs(te,{isDisabled:i,children:[a.jsx(Ue,{feature:"paramWidth",children:a.jsx(ne,{children:e("parameters.width")})}),a.jsx(it,{value:n,onChange:r,defaultValue:s,min:pd.sliderMin,max:pd.sliderMax,step:pd.coarseStep,fineStep:o,marks:l}),a.jsx(Pe,{value:n,onChange:r,defaultValue:s,min:pd.numberInputMin,max:pd.numberInputMax,step:pd.coarseStep,fineStep:o})]})});Sde.displayName="BboxWidth";const kde=h.memo(()=>a.jsxs(A,{gap:4,alignItems:"center",children:[a.jsx(A,{gap:4,flexDirection:"column",width:"full",children:a.jsxs(Ys,{formLabelProps:Tnt,children:[a.jsxs(A,{gap:4,children:[a.jsx(yde,{}),a.jsx(_de,{}),a.jsx(xde,{}),a.jsx(wde,{})]}),a.jsx(Sde,{}),a.jsx(bde,{})]})}),a.jsx(A,{w:"108px",h:"108px",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"center",children:a.jsx(Cde,{})})]}));kde.displayName="BboxSettings";const Tnt={minW:10},Ide=h.memo(()=>{const e=M(NW),t=M(qy),{t:n}=T(),s=Q(),i=h.useCallback(o=>s(hM(o)),[s]);return a.jsxs(te,{flexGrow:1,isDisabled:t,children:[a.jsx(Ue,{feature:"paramSeed",children:a.jsx(ne,{children:n("parameters.seed")})}),a.jsx(Pe,{step:1,min:WD,max:Vr,onChange:i,value:e,flexGrow:1,defaultValue:0})]})});Ide.displayName="ParamSeedNumberInput";const jde=h.memo(()=>{const e=Q(),{t}=T(),n=M(qy),s=h.useCallback(i=>e(PCe(i.target.checked)),[e]);return a.jsxs(te,{w:"min-content",children:[a.jsx(ne,{m:0,children:t("common.random")}),a.jsx(mt,{isChecked:n,onChange:s})]})});jde.displayName="ParamSeedRandomize";const Ede=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),Ade=h.memo(()=>{const e=Q(),t=M(qy),{t:n}=T(),s=h.useCallback(()=>e(hM(Ede(WD,Vr))),[e]);return a.jsx(he,{size:"sm",isDisabled:t,onClick:s,leftIcon:a.jsx(Uh,{}),flexShrink:0,children:n("parameters.shuffle")})});Ade.displayName="ParamSeedShuffle";const xk=h.memo(e=>a.jsxs(A,{gap:4,alignItems:"center",...e,children:[a.jsx(Ide,{}),a.jsx(jde,{}),a.jsx(Ade,{})]}));xk.displayName="ParamSeed";const Dnt=Yn([Pc,qy],(e,t)=>{const n=[],{aspectRatio:s,rect:i}=e,{width:o,height:r}=i;return n.push(`${o}${r}`),n.push(s.id),s.isLocked&&n.push("locked"),t||n.push("Manual Seed"),n.length===0?os:n}),Mnt={minW:"4.5rem"},Pde=h.memo(()=>{const{t:e}=T(),t=M(Dnt),n=M(LU),{isOpen:s,onToggle:i}=sd({id:"image-settings",defaultIsOpen:!0}),{isOpen:o,onToggle:r}=bk({id:"image-settings-advanced",defaultIsOpen:!1}),l=M(TCe);return a.jsx(Kc,{label:e("accordions.image.title"),badges:t,isOpen:s,onToggle:i,children:a.jsxs(A,{px:4,pt:4,pb:0,w:"full",h:"full",flexDir:"column","data-testid":"image-settings-accordion",children:[a.jsx(kde,{}),a.jsx(xk,{pt:3,pb:0}),a.jsx(v_,{label:e("accordions.advanced.options"),isOpen:o,onToggle:r,children:a.jsxs(A,{gap:4,pb:4,flexDir:"column",children:[l&&a.jsx(vde,{}),a.jsx(jnt,{}),n!=="none"&&a.jsxs(Ys,{formLabelProps:Mnt,children:[a.jsx(Snt,{}),a.jsx(xnt,{})]})]})})]})})});Pde.displayName="CanvasTabImageSettingsAccordion";const sa={initial:7,sliderMin:1,sliderMax:20,numberInputMin:1,numberInputMax:200,fineStep:.1,coarseStep:.5},Lnt=[sa.sliderMin,Math.floor(sa.sliderMax/2),sa.sliderMax],Rnt=()=>{const{t:e}=T(),t=Q(),n=M(DCe),s=h.useCallback(i=>t(VH(i)),[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"refinerCfgScale",children:a.jsx(ne,{children:e("sdxl.cfgScale")})}),a.jsx(it,{value:n,defaultValue:sa.initial,min:sa.sliderMin,max:sa.sliderMax,step:sa.coarseStep,fineStep:sa.fineStep,onChange:s,marks:Lnt}),a.jsx(Pe,{value:n,defaultValue:sa.initial,min:sa.numberInputMin,max:sa.numberInputMax,step:sa.coarseStep,fineStep:sa.fineStep,onChange:s})]})},Ont=h.memo(Rnt),Nnt=e=>e.base==="sdxl-refiner",Fnt=()=>{const e=Q(),t=M(MCe),{t:n}=T(),[s,{isLoading:i}]=RU(),o=h.useCallback(m=>{if(!m){e(qA(null));return}e(qA(_s.parse(m)))},[e]),{options:r,value:l,onChange:c,placeholder:d,noOptionsMessage:u}=nl({modelConfigs:s,onChange:o,selectedModel:t,isLoading:i,optionsFilter:Nnt}),p=h.useCallback(()=>{o(null)},[o]);return a.jsxs(te,{isDisabled:!r.length,isInvalid:!r.length,w:"full",gap:2,children:[a.jsx(Ue,{feature:"refinerModel",children:a.jsx(ne,{children:n("sdxl.refinermodel")})}),a.jsx(pt,{value:l,placeholder:d,options:r,onChange:c,noOptionsMessage:u}),a.jsx(oe,{size:"sm",variant:"ghost",icon:a.jsx(fn,{}),"aria-label":n("common.reset"),onClick:p,isDisabled:!l})]})},Bnt=h.memo(Fnt),znt=()=>{const e=M(LCe),t=Q(),{t:n}=T(),s=h.useCallback(i=>t(NH(i)),[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"refinerNegativeAestheticScore",children:a.jsx(ne,{children:n("sdxl.negAestheticScore")})}),a.jsx(it,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5,marks:!0}),a.jsx(Pe,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5})]})},Vnt=h.memo(znt),$nt=()=>{const e=M(RCe),t=Q(),{t:n}=T(),s=h.useCallback(i=>t(FH(i)),[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"refinerPositiveAestheticScore",children:a.jsx(ne,{children:n("sdxl.posAestheticScore")})}),a.jsx(it,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6,marks:!0}),a.jsx(Pe,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6})]})},Gnt=h.memo($nt),Hnt=()=>{const e=Q(),{t}=T(),n=M(OCe),s=h.useCallback(o=>{Uy(o?.value)&&e(BH(o.value))},[e]),i=h.useMemo(()=>Hl.find(o=>o.value===n),[n]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"refinerScheduler",children:a.jsx(ne,{children:t("sdxl.scheduler")})}),a.jsx(pt,{value:i,options:Hl,onChange:s})]})},Wnt=h.memo(Hnt),Unt=()=>{const e=M(NCe),t=Q(),n=h.useCallback(i=>t(OH(i)),[t]),{t:s}=T();return a.jsxs(te,{children:[a.jsx(Ue,{feature:"refinerStart",children:a.jsx(ne,{children:s("sdxl.refinerStart")})}),a.jsx(it,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e,marks:!0}),a.jsx(Pe,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e})]})},qnt=h.memo(Unt),ia={initial:30,sliderMin:1,sliderMax:100,numberInputMin:1,numberInputMax:500,fineStep:1,coarseStep:1},Knt=[ia.sliderMin,Math.floor(ia.sliderMax/2),ia.sliderMax],Znt=()=>{const{t:e}=T(),t=Q(),n=M(FCe),s=h.useCallback(i=>{t(GH(i))},[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"refinerSteps",children:a.jsx(ne,{children:e("sdxl.steps")})}),a.jsx(it,{value:n,defaultValue:ia.initial,min:ia.sliderMin,max:ia.sliderMax,step:ia.coarseStep,fineStep:ia.fineStep,onChange:s,marks:Knt}),a.jsx(Pe,{value:n,defaultValue:ia.initial,min:ia.numberInputMin,max:ia.numberInputMax,step:ia.coarseStep,fineStep:ia.fineStep,onChange:s})]})},Xnt=h.memo(Znt),Ynt=()=>{const[e]=RU();return!!e.length},Qnt={minW:"9.2rem"},Jnt={minW:"5rem"},est=Yn(oo,e=>e.refinerModel?["Enabled"]:void 0),T8=h.memo(()=>{const{t:e}=T(),t=Ynt(),n=M(est),{isOpen:s,onToggle:i}=sd({id:"refiner-settings",defaultIsOpen:!1});return a.jsx(Kc,{label:e("sdxl.refiner"),badges:n,isOpen:s,onToggle:i,children:t?a.jsx(Dde,{}):a.jsx(Tde,{})})});T8.displayName="RefinerSettingsAccordion";const Tde=h.memo(()=>{const{t:e}=T();return a.jsx(A,{justifyContent:"center",p:4,children:a.jsx(q,{fontSize:"sm",color:"base.500",children:e("models.noRefinerModelsInstalled")})})});Tde.displayName="RefinerSettingsAccordionNoRefiner";const Dde=h.memo(()=>{const e=M(BCe);return a.jsx(Ys,{isDisabled:!e,children:a.jsxs(A,{p:4,gap:4,flexDir:"column",minW:0,children:[a.jsx(Bnt,{}),a.jsxs(Ys,{formLabelProps:Jnt,isDisabled:!e,children:[a.jsx(Wnt,{}),a.jsx(Xnt,{}),a.jsx(Ont,{}),a.jsx(qnt,{})]}),a.jsxs(Ys,{formLabelProps:Qnt,isDisabled:!e,children:[a.jsx(Gnt,{}),a.jsx(Vnt,{})]})]})})});Dde.displayName="RefinerSettingsAccordionContent";const tst={svg:{animation:g_}},nst=()=>{const[e,{isLoading:t}]=zCe(),{t:n}=T(),{presetCount:s}=lm(void 0,{selectFromResult:({data:o})=>({presetCount:(o?.filter(l=>l.type!=="default")??os).length})}),i=h.useCallback(async()=>{let o;try{const r=await e().unwrap();o=new Blob([r],{type:"text/csv"})}catch{pe({status:"error",title:n("stylePresets.exportFailed")});return}if(o){const r=window.URL.createObjectURL(o),l=document.createElement("a");l.href=r,l.download="data.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(r),pe({status:"success",title:n("stylePresets.exportDownloaded")})}},[e,n]);return a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",onClick:i,icon:t?a.jsx(kX,{}):a.jsx(Wh,{}),tooltip:n("stylePresets.exportPromptTemplates"),"aria-label":n("stylePresets.exportPromptTemplates"),sx:t?tst:void 0,isDisabled:t||s===0})},sst={svg:{animation:g_}},ist=()=>{const[e,{isLoading:t}]=VCe(),{t:n}=T(),s=h.useCallback(r=>{const l=r[0];l&&e(l).unwrap().then(()=>{pe({status:"success",title:n("toast.importSuccessful")})}).catch(c=>{pe({status:"error",title:n("toast.importFailed"),description:c?`${c.data.detail}`:void 0})})},[e,n]),{getInputProps:i,getRootProps:o}=oc({accept:{"text/csv":[".csv"],"application/json":[".json"]},onDropAccepted:s,noDrag:!0,multiple:!1});return a.jsxs(a.Fragment,{children:[a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",icon:t?a.jsx(kX,{}):a.jsx(p1,{}),tooltip:a.jsx(ost,{}),"aria-label":n("stylePresets.importTemplates"),sx:t?sst:void 0,isDisabled:t,...o()}),a.jsx("input",{...i()})]})},ost=()=>{const{t:e}=T();return a.jsxs(A,{flexDir:"column",children:[a.jsx(q,{pb:1,fontWeight:"semibold",children:e("stylePresets.importTemplates")}),a.jsx(q,{children:e("stylePresets.acceptedColumnsKeys")}),a.jsxs(Li,{children:[a.jsx(rn,{children:e("stylePresets.nameColumn")}),a.jsx(rn,{children:e("stylePresets.positivePromptColumn")}),a.jsx(rn,{children:e("stylePresets.negativePromptColumn")})]})]})},ast=()=>{const e=Q(),t=M(OU),{t:n}=T(),s=h.useCallback(()=>{e($Ce(!t))},[e,t]);return a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":n("stylePresets.togglePromptPreviews"),tooltip:n("stylePresets.togglePromptPreviews"),onClick:s,icon:t?a.jsx(bu,{}):a.jsx($4,{}),colorScheme:t?"invokeBlue":"base"})},rst=()=>{const e=h.useCallback(()=>{Ch.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!0})},[]),{t}=T();return a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",icon:a.jsx(Sn,{}),tooltip:t("stylePresets.createPromptTemplate"),"aria-label":t("stylePresets.createPromptTemplate"),onClick:e})},Ip="40px",lst="24px",cst=({presetImageUrl:e,imageWidth:t})=>a.jsx(He,{closeOnScroll:!0,openDelay:0,label:e&&a.jsx(Nn,{src:e,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),p:2,children:a.jsx(Nn,{src:e||"",fallbackStrategy:"beforeLoadOrError",fallback:a.jsx(A,{height:t||Ip,minWidth:t||Ip,bg:"base.650",borderRadius:"base",alignItems:"center",justifyContent:"center",children:a.jsx(Je,{color:"base.500",as:rC,boxSize:t?t/2:lst})}),objectFit:"cover",objectPosition:"50% 50%",height:t||Ip,width:t||Ip,minHeight:t||Ip,minWidth:t||Ip,borderRadius:"base"})}),Mde=sn(cst),dst=({preset:e})=>{const t=Q(),n=M(Ry),s=M(OU),{t:i}=T(),o=C7e(),r=h.useCallback(u=>{u.stopPropagation();const{name:p,preset_data:m}=e,{positive_prompt:f,negative_prompt:g}=m;Ch.set({prefilledFormData:{name:p,positivePrompt:f||"",negativePrompt:g||"",imageUrl:e.image,type:e.type},updatingStylePresetId:e.id,isModalOpen:!0})},[e]),l=h.useCallback(()=>{t(G2(e.id)),Af.set(!1)},[t,e.id]),c=h.useCallback(u=>{u.stopPropagation(),o(e)},[o,e]),d=h.useCallback(u=>{u.stopPropagation();const{name:p,preset_data:m}=e,{positive_prompt:f,negative_prompt:g}=m;Ch.set({prefilledFormData:{name:`${p} (${i("common.copy")})`,positivePrompt:f||"",negativePrompt:g||"",imageUrl:e.image,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[e,i]);return a.jsxs(he,{as:A,role:"button",gap:3,onClick:l,p:3,h:"unset",variant:"ghost",w:"full",alignItems:"flex-start",children:[a.jsx(Mde,{presetImageUrl:e.image}),a.jsxs(A,{flexDir:"column",w:"full",alignItems:"flex-start",flexGrow:1,minW:0,gap:2,children:[a.jsxs(A,{gap:2,w:"full",justifyContent:"space-between",alignItems:"center",minW:0,minH:8,children:[a.jsx(q,{fontSize:"md",noOfLines:2,fontWeight:"semibold",color:"base.100",children:e.name}),n===e.id&&a.jsx(Bi,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:i("stylePresets.active")}),a.jsx(At,{}),a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":i("stylePresets.copyTemplate"),onClick:d,icon:a.jsx(ws,{})}),e.type!=="default"&&a.jsxs(a.Fragment,{children:[a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":i("stylePresets.editTemplate"),onClick:r,icon:a.jsx(Im,{})}),a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":i("stylePresets.deleteTemplate"),onClick:c,colorScheme:"error",icon:a.jsx(Qc,{})})]})]}),s&&a.jsxs(a.Fragment,{children:[a.jsx(A,{gap:1,minW:0,fontSize:"sm",whiteSpace:"normal",children:a.jsxs(q,{children:[i("stylePresets.positivePrompt"),":"," ",a.jsx(q,{as:"span",fontWeight:"normal",children:e.preset_data.positive_prompt})]})}),a.jsx(A,{gap:1,minW:0,fontSize:"sm",whiteSpace:"normal",children:a.jsxs(q,{children:[i("stylePresets.negativePrompt"),":"," ",a.jsx(q,{as:"span",fontWeight:"normal",children:e.preset_data.negative_prompt})]})})]})]})]})},v$=({title:e,data:t})=>{const{t:n}=T(),{onToggle:s,isOpen:i}=jo({defaultIsOpen:!0}),o=M(BM);return a.jsxs(A,{flexDir:"column",children:[a.jsx(he,{variant:"unstyled",onClick:s,children:a.jsxs(A,{gap:2,alignItems:"center",children:[a.jsx(Je,{boxSize:4,as:Do,transform:i?void 0:"rotate(-90deg)",fill:"base.500"}),a.jsx(q,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:e})]})}),a.jsx(mu,{in:i,style:S6,children:t.length?t.map(r=>a.jsx(dst,{preset:r},r.id)):a.jsx(On,{fontSize:"sm",py:4,label:n(o?"stylePresets.noMatchingTemplates":"stylePresets.noTemplates"),icon:null})})]})},ust=()=>{const e=Q(),t=M(BM),{t:n}=T(),s=h.useCallback(l=>{e(WL(l))},[e]),i=h.useCallback(()=>{e(WL(""))},[e]),o=h.useCallback(l=>{l.key==="Escape"&&i()},[i]),r=h.useCallback(l=>{s(l.target.value)},[s]);return a.jsxs(tc,{children:[a.jsx(Nt,{placeholder:n("stylePresets.searchByName"),value:t,onKeyDown:o,onChange:r}),t&&t.length&&a.jsx(Hr,{h:"full",pe:2,children:a.jsx(oe,{onClick:i,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:a.jsx(fn,{})})})]})},hst=h.memo(ust),D8=()=>{const e=M(BM),{data:t}=lm(void 0,{selectFromResult:({data:s})=>({data:(s?.filter(r=>r.name.toLowerCase().includes(e.toLowerCase()))||os).reduce((r,l)=>(l.type==="default"?r.defaultPresets.push(l):r.presets.push(l),r),{defaultPresets:[],sharedPresets:[],presets:[]})})}),{t:n}=T();return a.jsxs(A,{flexDir:"column",gap:2,padding:3,layerStyle:"second",borderRadius:"base",children:[a.jsxs(A,{alignItems:"center",gap:2,w:"full",justifyContent:"space-between",children:[a.jsx(hst,{}),a.jsxs(A,{alignItems:"center",gap:1,children:[a.jsx(ast,{}),a.jsx(rst,{}),a.jsx(ist,{}),a.jsx(nst,{})]})]}),a.jsx(v$,{title:n("stylePresets.myTemplates"),data:t.presets}),a.jsx(v$,{title:n("stylePresets.defaultTemplates"),data:t.defaultPresets})]})},pst=()=>{const e=M(MM),t=M(Ry),{activeStylePreset:n}=lm(void 0,{selectFromResult:({data:u})=>{let p=null;return u&&(p=u.find(m=>m.id===t)),{activeStylePreset:p}}}),s=Q(),{t:i}=T(),{presetModifiedPositivePrompt:o,presetModifiedNegativePrompt:r}=GCe(),l=h.useCallback(u=>{u.stopPropagation(),s(o2(!1)),s(G2(null))},[s]),c=h.useCallback(u=>{u.stopPropagation(),s(Nd(o)),s(Ef(r)),s(o2(!1)),s(G2(null))},[s,o,r]),d=h.useCallback(u=>{u.stopPropagation(),s(o2(!e))},[s,e]);return n?a.jsxs(A,{w:"full",alignItems:"center",gap:2,minW:0,children:[a.jsx(Mde,{imageWidth:25,presetImageUrl:n.image}),a.jsx(Bi,{colorScheme:"invokeBlue",variant:"subtle",justifySelf:"flex-start",children:n.name}),a.jsx(At,{}),a.jsx(He,{label:i("stylePresets.toggleViewMode"),children:a.jsx(oe,{onClick:d,variant:"outline",size:"sm","aria-label":i("stylePresets.toggleViewMode"),colorScheme:e?"invokeBlue":"base",icon:a.jsx(bu,{})})}),a.jsx(He,{label:i("stylePresets.flatten"),children:a.jsx(oe,{onClick:c,variant:"outline",size:"sm","aria-label":i("stylePresets.flatten"),icon:a.jsx(gX,{})})}),a.jsx(He,{label:i("stylePresets.clearTemplateSelection"),children:a.jsx(oe,{onClick:l,variant:"outline",size:"sm","aria-label":i("stylePresets.clearTemplateSelection"),icon:a.jsx(fn,{})})})]}):a.jsx(A,{h:25,alignItems:"center",children:a.jsx(q,{fontSize:"sm",fontWeight:"semibold",color:"base.300",children:i("stylePresets.choosePromptTemplate")})})},fst={bg:"base.750"},M8=()=>{const e=le(Af),{t}=T(),n=h.useCallback(()=>{Af.set(!e)},[e]);return a.jsxs(A,{onClick:n,backgroundColor:"base.800",justifyContent:"space-between",alignItems:"center",py:2,px:3,borderRadius:"base",gap:2,role:"button",_hover:fst,transitionProperty:"background-color",transitionDuration:"normal",w:"full",children:[a.jsx(pst,{}),a.jsx(oe,{"aria-label":t("stylePresets.viewList"),variant:"ghost",icon:a.jsx(Do,{}),size:"sm"})]})},y$={height:"100%",width:"100%"},Lde=h.memo(()=>{const e=M(NU),t=M(h_),n=le(Af);return a.jsxs(A,{w:"full",h:"full",flexDir:"column",gap:2,children:[a.jsx(M8,{}),a.jsx(A,{w:"full",h:"full",position:"relative",children:a.jsxs(ke,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[n&&a.jsx(ti,{defer:!0,style:y$,options:iu.options,children:a.jsx(A,{gap:2,flexDirection:"column",h:"full",w:"full",children:a.jsx(D8,{})})}),a.jsx(ti,{defer:!0,style:y$,options:iu.options,children:a.jsxs(A,{gap:2,flexDirection:"column",h:"full",w:"full",children:[a.jsx(k8,{}),a.jsx(Pde,{}),a.jsx(P8,{}),a.jsx(lde,{}),e&&a.jsx(T8,{}),!t&&a.jsx(I8,{})]})})]})})]})});Lde.displayName="ParametersPanelCanvas";const Rde=h.memo(()=>a.jsxs(A,{flexDir:"column",w:"full",h:"full",gap:2,children:[a.jsx(yk,{}),a.jsx(ke,{position:"relative",w:"full",h:"full",children:a.jsx(Lde,{})})]}));Rde.displayName="CanvasTabLeftPanel";const Ode=h.memo(()=>{const{t:e}=T(),t=Tt();return le(t.tool.tools.bbox.$isBboxHidden)?a.jsxs(hu,{status:"warning",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[a.jsx(Nh,{}),a.jsx(zy,{children:e("controlLayers.warnings.bboxHidden")})]}):null});Ode.displayName="CanvasAlertsBboxVisibility";const Nde=h.memo(()=>{const{t:e}=T();return M(FU)?a.jsxs(hu,{status:"warning",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[a.jsx(Nh,{}),a.jsx(zy,{children:e("controlLayers.settings.preserveMask.alert")})]}):null});Nde.displayName="CanvasAlertsPreserveMask";const Fde=h.memo(()=>{const{t:e}=T();return M(ZD)?a.jsxs(hu,{status:"warning",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[a.jsx(Nh,{}),a.jsx(zy,{children:e("controlLayers.settings.saveAllImagesToGallery.alert")})]}):null});Fde.displayName="CanvasAlertsSaveAllImagesToGallery";const mst=De(!1),gst=e=>ve(rt,t=>co(t,e,"CanvasAlertsSelectedEntityStatusContent").isEnabled),vst=e=>ve(rt,t=>co(t,e,"CanvasAlertsSelectedEntityStatusContent").isLocked),Bde=h.memo(({entityIdentifier:e,adapter:t})=>{const{t:n}=T(),s=Ase(e),i=h.useMemo(()=>gst(e),[e]),o=h.useMemo(()=>vst(e),[e]),r=M(i),l=M(o),c=k6(e.type),d=le(t.filterer?.$isFiltering??mst),u=le(t.transformer.$isTransforming),p=le(t.$isEmpty),m=h.useMemo(()=>d?{status:"warning",title:n("controlLayers.HUD.entityStatus.isFiltering",{title:s})}:u?{status:"warning",title:n("controlLayers.HUD.entityStatus.isTransforming",{title:s})}:p?{status:"warning",title:n("controlLayers.HUD.entityStatus.isEmpty",{title:s})}:c?{status:"warning",title:n("controlLayers.HUD.entityStatus.isHidden",{title:s})}:l?{status:"warning",title:n("controlLayers.HUD.entityStatus.isLocked",{title:s})}:r?null:{status:"warning",title:n("controlLayers.HUD.entityStatus.isDisabled",{title:s})},[d,u,p,c,l,r,s,n]);return m?a.jsxs(hu,{status:m.status,borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[a.jsx(Nh,{}),a.jsx(zy,{children:m.title})]}):null});Bde.displayName="CanvasAlertsSelectedEntityStatusContent";const zde=h.memo(()=>{const e=M($n),t=ac(e);return!e||!t?null:a.jsx(wu,{entityIdentifier:e,children:a.jsx(Bde,{entityIdentifier:e,adapter:t})})});zde.displayName="CanvasAlertsSelectedEntityStatus";const Vde=h.memo(e=>{const t=Tt(),n=dGe(),s=h.useMemo(()=>Ut(n.map(({transformer:l})=>l.$isPendingRectCalculation),(...l)=>l.some(c=>c)),[n]),i=le(s),o=le(t.stateApi.$isRasterizing),r=le(t.compositor.$isBusy);return o||r||i?a.jsx(ao,{opacity:.3,...e}):null});Vde.displayName="CanvasBusySpinner";const $de=h.memo(()=>{const{t:e}=T(),t=xt(),n=Tt(),s=h.useCallback(async()=>{const i=n.getAllAdapters();for(const o of i)await o.cropToBbox()},[n]);return a.jsx(be,{icon:a.jsx(z4,{}),isDisabled:t,onClick:s,children:e("controlLayers.canvasContextMenu.cropCanvasToBbox")})});$de.displayName="CanvasContextMenuItemsCropCanvasToBbox";const Gde=h.memo(()=>{const{t:e}=T(),t=Qi(),n=Qi(),s=Qi(),i=xt(),o=lse(),r=cse(),l=gGe(),c=dse(),d=vGe(),u=yGe(),p=az("canvas"),m=az("bbox");return a.jsx(a.Fragment,{children:a.jsxs(Ya,{title:e("controlLayers.canvasContextMenu.canvasGroup"),children:[a.jsx($de,{}),a.jsx(be,{...t.parentMenuItemProps,icon:a.jsx(Ol,{}),children:a.jsxs(An,{...t.menuProps,children:[a.jsx(Pn,{...t.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.canvasContextMenu.saveToGalleryGroup")})}),a.jsxs(Zt,{...t.menuListProps,children:[a.jsx(be,{icon:a.jsx(Ol,{}),isDisabled:i,onClick:o,children:e("controlLayers.canvasContextMenu.saveCanvasToGallery")}),a.jsx(be,{icon:a.jsx(Ol,{}),isDisabled:i,onClick:r,children:e("controlLayers.canvasContextMenu.saveBboxToGallery")})]})]})}),a.jsx(be,{...n.parentMenuItemProps,icon:a.jsx(vo,{}),children:a.jsxs(An,{...n.menuProps,children:[a.jsx(Pn,{...n.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.canvasContextMenu.bboxGroup")})}),a.jsxs(Zt,{...n.menuListProps,children:[a.jsx(be,{icon:a.jsx(vo,{}),isDisabled:i,onClick:c,children:e("controlLayers.canvasContextMenu.newGlobalReferenceImage")}),a.jsx(be,{icon:a.jsx(vo,{}),isDisabled:i,onClick:l,children:e("controlLayers.canvasContextMenu.newRegionalReferenceImage")}),a.jsx(be,{icon:a.jsx(vo,{}),isDisabled:i,onClick:u,children:e("controlLayers.canvasContextMenu.newControlLayer")}),a.jsx(be,{icon:a.jsx(vo,{}),isDisabled:i,onClick:d,children:e("controlLayers.canvasContextMenu.newRasterLayer")})]})]})}),a.jsx(be,{...s.parentMenuItemProps,icon:a.jsx(ws,{}),children:a.jsxs(An,{...s.menuProps,children:[a.jsx(Pn,{...s.menuButtonProps,children:a.jsx(Ji,{label:e("controlLayers.canvasContextMenu.copyToClipboard")})}),a.jsxs(Zt,{...s.menuListProps,children:[a.jsx(be,{icon:a.jsx(ws,{}),isDisabled:i,onClick:p,children:e("controlLayers.canvasContextMenu.copyCanvasToClipboard")}),a.jsx(be,{icon:a.jsx(ws,{}),isDisabled:i,onClick:m,children:e("controlLayers.canvasContextMenu.copyBboxToClipboard")})]})]})})]})})});Gde.displayName="CanvasContextMenuGlobalMenuItems";const Hde=h.memo(()=>{const e=dt();if(e.type==="raster_layer")return a.jsx(K6,{});if(e.type==="control_layer")return a.jsx(U6,{});if(e.type==="inpaint_mask")return a.jsx(q6,{});if(e.type==="regional_guidance")return a.jsx(Y6,{});if(e.type==="reference_image")return a.jsx(X6,{});ae(!1)});Hde.displayName="CanvasContextMenuSelectedEntityMenuItemsContent";const Wde=h.memo(e=>{const t=dt(),n=Lee(t.type);return a.jsx(Ya,{title:n,children:e.children})});Wde.displayName="CanvasContextMenuSelectedEntityMenuGroup";const Ude=h.memo(()=>{const e=M($n);return e?a.jsx(Wm.Provider,{value:e,children:a.jsx(wu,{entityIdentifier:e,children:a.jsx(Wde,{children:a.jsx(Hde,{})})})}):null});Ude.displayName="CanvasContextMenuSelectedEntityMenuItems";const yst=Dc.getData({type:"raster_layer"}),bst=Dc.getData({type:"control_layer"}),xst=Dc.getData({type:"regional_guidance_with_reference_image"}),Cst=Dc.getData({type:"control_layer",withResize:!0}),qde=h.memo(()=>{const{t:e}=T(),t=xt();return a.jsx(a.Fragment,{children:a.jsxs(Ms,{gridTemplateRows:"1fr 1fr",gridTemplateColumns:"1fr 1fr",position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:[a.jsx(_t,{position:"relative",children:a.jsx(ds,{dndTarget:Dc,dndTargetData:yst,label:e("controlLayers.canvasContextMenu.newRasterLayer"),isDisabled:t})}),a.jsx(_t,{position:"relative",children:a.jsx(ds,{dndTarget:Dc,dndTargetData:bst,label:e("controlLayers.canvasContextMenu.newControlLayer"),isDisabled:t})}),a.jsx(_t,{position:"relative",children:a.jsx(ds,{dndTarget:Dc,dndTargetData:xst,label:e("controlLayers.canvasContextMenu.newRegionalReferenceImage"),isDisabled:t})}),a.jsx(_t,{position:"relative",children:a.jsx(ds,{dndTarget:Dc,dndTargetData:Cst,label:e("controlLayers.canvasContextMenu.newResizedControlLayer"),isDisabled:t})})]})})});qde.displayName="CanvasDropArea";const L8=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(Ky),s=h.useCallback(()=>{t(HCe())},[t]);return a.jsxs(te,{w:"min-content",children:[a.jsx(ne,{m:0,children:e("controlLayers.filter.autoProcess")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})});L8.displayName="CanvasAutoProcessSwitch";const Ck=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(U2),s=h.useCallback(()=>{t(BU())},[t]);return a.jsx(He,{label:e("controlLayers.settings.isolatedLayerPreviewDesc"),children:a.jsxs(te,{w:"min-content",children:[a.jsx(ne,{m:0,children:e("controlLayers.settings.isolatedPreview")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})})});Ck.displayName="CanvasOperationIsolatedLayerPreviewSwitch";const iA=Vs.adjust_image.buildDefaults(),Kde=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(c=>{DGe(c?.value)&&e({...t,channel:c.value})},[t,e]),i=h.useCallback(c=>{e({...t,value:c})},[t,e]),o=h.useCallback(c=>{e({...t,scale_values:c.target.checked})},[t,e]),r=h.useMemo(()=>[{label:n("controlLayers.filter.adjust_image.red"),value:"Red (RGBA)"},{label:n("controlLayers.filter.adjust_image.green"),value:"Green (RGBA)"},{label:n("controlLayers.filter.adjust_image.blue"),value:"Blue (RGBA)"},{label:n("controlLayers.filter.adjust_image.alpha"),value:"Alpha (RGBA)"},{label:n("controlLayers.filter.adjust_image.cyan"),value:"Cyan (CMYK)"},{label:n("controlLayers.filter.adjust_image.magenta"),value:"Magenta (CMYK)"},{label:n("controlLayers.filter.adjust_image.yellow"),value:"Yellow (CMYK)"},{label:n("controlLayers.filter.adjust_image.black"),value:"Black (CMYK)"},{label:n("controlLayers.filter.adjust_image.hue"),value:"Hue (HSV)"},{label:n("controlLayers.filter.adjust_image.saturation"),value:"Saturation (HSV)"},{label:n("controlLayers.filter.adjust_image.value"),value:"Value (HSV)"},{label:n("controlLayers.filter.adjust_image.luminosity"),value:"Luminosity (LAB)"},{label:n("controlLayers.filter.adjust_image.a"),value:"A (LAB)"},{label:n("controlLayers.filter.adjust_image.b"),value:"B (LAB)"},{label:n("controlLayers.filter.adjust_image.y"),value:"Y (YCbCr)"},{label:n("controlLayers.filter.adjust_image.cb"),value:"Cb (YCbCr)"},{label:n("controlLayers.filter.adjust_image.cr"),value:"Cr (YCbCr)"}],[n]),l=h.useMemo(()=>r.filter(c=>c.value===t.channel)[0],[r,t.channel]);return a.jsxs(a.Fragment,{children:[a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.adjust_image.channel")}),a.jsx(pt,{value:l,options:r,onChange:s,isSearchable:!1})]}),a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.adjust_image.value_setting")}),a.jsx(it,{value:t.value,defaultValue:iA.value,onChange:i,min:0,max:2,step:.0025,marks:!0}),a.jsx(Pe,{value:t.value,defaultValue:iA.value,onChange:i,min:0,max:255,step:.0025})]}),a.jsxs(te,{w:"max-content",children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.adjust_image.scale_values")}),a.jsx(mt,{defaultChecked:iA.scale_values,isChecked:t.scale_values,onChange:o})]})]})});Kde.displayName="FilterAdjustImage";const b$=Vs.img_blur.buildDefaults(),Zde=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(l=>{KGe(l?.value)&&e({...t,blur_type:l.value})},[t,e]),i=h.useCallback(l=>{e({...t,radius:l})},[t,e]),o=h.useMemo(()=>[{label:n("controlLayers.filter.img_blur.gaussian_type"),value:"gaussian"},{label:n("controlLayers.filter.img_blur.box_type"),value:"box"}],[n]),r=h.useMemo(()=>o.filter(l=>l.value===t.blur_type)[0],[o,t.blur_type]);return a.jsxs(a.Fragment,{children:[a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.img_blur.blur_type")}),a.jsx(pt,{value:r,options:o,onChange:s,isSearchable:!1})]}),a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.img_blur.blur_radius")}),a.jsx(it,{value:t.radius,defaultValue:b$.radius,onChange:i,min:1,max:64,step:.1,marks:!0}),a.jsx(Pe,{value:t.radius,defaultValue:b$.radius,onChange:i,min:1,max:4096,step:.1})]})]})});Zde.displayName="FilterBlur";const zx=Vs.canny_edge_detection.buildDefaults(),Xde=({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(o=>{e({...t,low_threshold:o})},[e,t]),i=h.useCallback(o=>{e({...t,high_threshold:o})},[e,t]);return a.jsxs(a.Fragment,{children:[a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.canny_edge_detection.low_threshold")}),a.jsx(it,{value:t.low_threshold,onChange:s,defaultValue:zx.low_threshold,min:0,max:255}),a.jsx(Pe,{value:t.low_threshold,onChange:s,defaultValue:zx.low_threshold,min:0,max:255})]}),a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.canny_edge_detection.high_threshold")}),a.jsx(it,{value:t.high_threshold,onChange:i,defaultValue:zx.high_threshold,min:0,max:255}),a.jsx(Pe,{value:t.high_threshold,onChange:i,defaultValue:zx.high_threshold,min:0,max:255})]})]})};Xde.displayName="FilterCannyEdgeDetection";const x$=Vs.color_map.buildDefaults(),Yde=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(i=>{e({...t,tile_size:i})},[t,e]);return a.jsx(a.Fragment,{children:a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.color_map.tile_size")}),a.jsx(it,{value:t.tile_size,defaultValue:x$.tile_size,onChange:s,min:1,max:256,step:1,marks:!0}),a.jsx(Pe,{value:t.tile_size,defaultValue:x$.tile_size,onChange:s,min:1,max:4096,step:1})]})})});Yde.displayName="FilterColorMap";const C$=Vs.content_shuffle.buildDefaults(),Qde=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(i=>{e({...t,scale_factor:i})},[t,e]);return a.jsx(a.Fragment,{children:a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.content_shuffle.scale_factor")}),a.jsx(it,{value:t.scale_factor,defaultValue:C$.scale_factor,onChange:s,min:0,max:4096,marks:!0}),a.jsx(Pe,{value:t.scale_factor,defaultValue:C$.scale_factor,onChange:s,min:0,max:4096})]})})});Qde.displayName="FilterContentShuffle";const Jde=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(r=>{NGe(r?.value)&&e({...t,model_size:r.value})},[t,e]),i=h.useMemo(()=>[{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small_v2"),value:"small_v2"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small"),value:"small"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_base"),value:"base"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_large"),value:"large"}],[n]),o=h.useMemo(()=>i.filter(r=>r.value===t.model_size)[0],[i,t.model_size]);return a.jsx(a.Fragment,{children:a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.depth_anything_depth_estimation.model_size")}),a.jsx(pt,{value:o,options:i,onChange:s,isSearchable:!1})]})})});Jde.displayName="FilterDepthAnythingDepthEstimation";const oA=Vs.dw_openpose_detection.buildDefaults(),eue=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(r=>{e({...t,draw_body:r.target.checked})},[t,e]),i=h.useCallback(r=>{e({...t,draw_face:r.target.checked})},[t,e]),o=h.useCallback(r=>{e({...t,draw_hands:r.target.checked})},[t,e]);return a.jsx(a.Fragment,{children:a.jsxs(A,{sx:{flexDir:"row",gap:6},children:[a.jsxs(te,{w:"max-content",children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_body")}),a.jsx(mt,{defaultChecked:oA.draw_body,isChecked:t.draw_body,onChange:s})]}),a.jsxs(te,{w:"max-content",children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_face")}),a.jsx(mt,{defaultChecked:oA.draw_face,isChecked:t.draw_face,onChange:i})]}),a.jsxs(te,{w:"max-content",children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_hands")}),a.jsx(mt,{defaultChecked:oA.draw_hands,isChecked:t.draw_hands,onChange:o})]})]})})});eue.displayName="FilterDWOpenposeDetection";const tue=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(i=>{e({...t,scribble:i.target.checked})},[t,e]);return a.jsx(a.Fragment,{children:a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.hed_edge_detection.scribble")}),a.jsx(mt,{isChecked:t.scribble,onChange:s})]})})});tue.displayName="FilterHEDEdgeDetection";const nue=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(i=>{e({...t,coarse:i.target.checked})},[t,e]);return a.jsx(a.Fragment,{children:a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.lineart_edge_detection.coarse")}),a.jsx(mt,{isChecked:t.coarse,onChange:s})]})})});nue.displayName="FilterLineartEdgeDetection";const Vx=Vs.mediapipe_face_detection.buildDefaults(),sue=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(o=>{e({...t,max_faces:o})},[t,e]),i=h.useCallback(o=>{e({...t,min_confidence:o})},[t,e]);return a.jsxs(a.Fragment,{children:[a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.max_faces")}),a.jsx(it,{value:t.max_faces,onChange:s,defaultValue:Vx.max_faces,min:1,max:20,marks:!0}),a.jsx(Pe,{value:t.max_faces,onChange:s,defaultValue:Vx.max_faces,min:1,max:20})]}),a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.min_confidence")}),a.jsx(it,{value:t.min_confidence,onChange:i,defaultValue:Vx.min_confidence,min:0,max:1,step:.01,marks:!0}),a.jsx(Pe,{value:t.min_confidence,onChange:i,defaultValue:Vx.min_confidence,min:0,max:1,step:.01})]})]})});sue.displayName="FilterMediaPipeFaceDetection";const $x=Vs.mlsd_detection.buildDefaults(),iue=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(o=>{e({...t,distance_threshold:o})},[t,e]),i=h.useCallback(o=>{e({...t,score_threshold:o})},[t,e]);return a.jsxs(a.Fragment,{children:[a.jsxs(te,{children:[a.jsxs(ne,{m:0,children:[n("controlLayers.filter.mlsd_detection.score_threshold")," "]}),a.jsx(it,{value:t.score_threshold,onChange:i,defaultValue:$x.score_threshold,min:0,max:1,step:.01,marks:!0}),a.jsx(Pe,{value:t.score_threshold,onChange:i,defaultValue:$x.score_threshold,min:0,max:1,step:.01})]}),a.jsxs(te,{children:[a.jsxs(ne,{m:0,children:[n("controlLayers.filter.mlsd_detection.distance_threshold")," "]}),a.jsx(it,{value:t.distance_threshold,onChange:s,defaultValue:$x.distance_threshold,min:0,max:100,step:1,marks:!0}),a.jsx(Pe,{value:t.distance_threshold,onChange:s,defaultValue:$x.distance_threshold,min:0,max:1e3,step:1})]})]})});iue.displayName="FilterMLSDDetection";const E0=Vs.img_noise.buildDefaults(),oue=h.memo(({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(d=>{XGe(d?.value)&&e({...t,noise_type:d.value})},[t,e]),i=h.useCallback(d=>{e({...t,amount:d})},[t,e]),o=h.useCallback(d=>{e({...t,noise_color:d.target.checked})},[t,e]),r=h.useCallback(d=>{e({...t,size:d})},[t,e]),l=h.useMemo(()=>[{label:n("controlLayers.filter.img_noise.gaussian_type"),value:"gaussian"},{label:n("controlLayers.filter.img_noise.salt_and_pepper_type"),value:"salt_and_pepper"}],[n]),c=h.useMemo(()=>l.filter(d=>d.value===t.noise_type)[0],[l,t.noise_type]);return a.jsxs(a.Fragment,{children:[a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.img_noise.noise_type")}),a.jsx(pt,{value:c,options:l,onChange:s,isSearchable:!1})]}),a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.img_noise.noise_amount")}),a.jsx(it,{value:t.amount,defaultValue:E0.amount,onChange:i,min:0,max:1,step:.01,marks:!0}),a.jsx(Pe,{value:t.amount,defaultValue:E0.amount,onChange:i,min:0,max:1,step:.01})]}),a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.img_noise.size")}),a.jsx(it,{value:t.size,defaultValue:E0.size,onChange:r,min:1,max:16,step:1,marks:!0}),a.jsx(Pe,{value:t.size,defaultValue:E0.size,onChange:r,min:1,max:256,step:1})]}),a.jsxs(te,{w:"max-content",children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.img_noise.noise_color")}),a.jsx(mt,{defaultChecked:E0.noise_color,isChecked:t.noise_color,onChange:o})]})]})});oue.displayName="Filternoise";const aue=({onChange:e,config:t})=>{const{t:n}=T(),s=h.useCallback(o=>{e({...t,scribble:o.target.checked})},[t,e]),i=h.useCallback(o=>{e({...t,quantize_edges:o.target.checked})},[t,e]);return a.jsxs(a.Fragment,{children:[a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.pidi_edge_detection.scribble")}),a.jsx(mt,{isChecked:t.scribble,onChange:s})]}),a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.pidi_edge_detection.quantize_edges")}),a.jsx(mt,{isChecked:t.quantize_edges,onChange:i})]})]})};aue.displayName="FilterPiDiNetEdgeDetection";const w$=Vs.spandrel_filter.buildDefaults(),rue=({onChange:e,config:t})=>{const{t:n}=T(),[s,{isLoading:i}]=PM(),o=h.useMemo(()=>{if(!(!s.length||!t.model))return s.find(g=>g.key===t.model?.key)?.description},[s,t.model]),r=h.useCallback(g=>{e({...t,model:g})},[t,e]),{options:l,value:c,onChange:d,placeholder:u,noOptionsMessage:p}=nl({modelConfigs:s,onChange:r,selectedModel:t.model,isLoading:i}),m=h.useCallback(g=>{e({...t,scale:g})},[e,t]),f=h.useCallback(g=>{e({...t,autoScale:g.target.checked})},[e,t]);return h.useEffect(()=>{const g=l[0];!t.model&&g&&d(g)},[t.model,d,l]),a.jsxs(a.Fragment,{children:[a.jsxs(te,{w:"full",orientation:"vertical",children:[a.jsxs(A,{w:"full",alignItems:"center",children:[a.jsx(ne,{m:0,flexGrow:1,children:n("controlLayers.filter.spandrel_filter.autoScale")}),a.jsx(mt,{size:"sm",isChecked:t.autoScale,onChange:f})]}),a.jsx(Vo,{children:n("controlLayers.filter.spandrel_filter.autoScaleDesc")})]}),a.jsxs(te,{isDisabled:!t.autoScale,children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.spandrel_filter.scale")}),a.jsx(it,{value:t.scale,onChange:m,defaultValue:w$.scale,min:1,max:16}),a.jsx(Pe,{value:t.scale,onChange:m,defaultValue:w$.scale,min:1,max:16})]}),a.jsxs(te,{children:[a.jsx(ne,{m:0,children:n("controlLayers.filter.spandrel_filter.model")}),a.jsx(He,{label:o,children:a.jsx(ke,{w:"full",children:a.jsx(pt,{value:c,placeholder:u,options:l,onChange:d,noOptionsMessage:p,isDisabled:l.length===0})})})]})]})};rue.displayName="FilterSpandrel";const lue=h.memo(({filterConfig:e,onChange:t})=>{const{t:n}=T();return e.type==="adjust_image"?a.jsx(Kde,{config:e,onChange:t}):e.type==="canny_edge_detection"?a.jsx(Xde,{config:e,onChange:t}):e.type==="color_map"?a.jsx(Yde,{config:e,onChange:t}):e.type==="content_shuffle"?a.jsx(Qde,{config:e,onChange:t}):e.type==="depth_anything_depth_estimation"?a.jsx(Jde,{config:e,onChange:t}):e.type==="dw_openpose_detection"?a.jsx(eue,{config:e,onChange:t}):e.type==="hed_edge_detection"?a.jsx(tue,{config:e,onChange:t}):e.type==="lineart_edge_detection"?a.jsx(nue,{config:e,onChange:t}):e.type==="mediapipe_face_detection"?a.jsx(sue,{config:e,onChange:t}):e.type==="mlsd_detection"?a.jsx(iue,{config:e,onChange:t}):e.type==="pidi_edge_detection"?a.jsx(aue,{config:e,onChange:t}):e.type==="img_blur"?a.jsx(Zde,{config:e,onChange:t}):e.type==="img_noise"?a.jsx(oue,{config:e,onChange:t}):e.type==="spandrel_filter"?a.jsx(rue,{config:e,onChange:t}):a.jsx(On,{py:4,label:`${n(`controlLayers.filter.${e.type}.label`)} has no settings`,icon:null})});lue.displayName="Filter";const cue=h.memo(({filterType:e,onChange:t})=>{const{t:n}=T(),s=h.useMemo(()=>Wr(Vs,(r,l)=>({value:l,label:n(`controlLayers.filter.${l}.label`)})),[n]),i=h.useCallback(r=>{r&&(ae(Bse(r.value)),t(r.value))},[t]),o=h.useMemo(()=>s.find(r=>r.value===e)??null,[s,e]);return a.jsx(A,{gap:2,children:a.jsxs(te,{children:[a.jsx(Ue,{feature:"controlNetProcessor",children:a.jsx(ne,{m:0,children:n("controlLayers.filter.filterType")})}),a.jsx(pt,{value:o,options:s,onChange:i,isSearchable:!1,isClearable:!1})]})})});cue.displayName="FilterTypeSelect";const due=h.memo(({adapter:e})=>{const{t}=T(),n=le(e.filterer.$filterConfig),s=le(e.filterer.$isProcessing),i=le(e.filterer.$hasImageState),o=M(Ky),r=h.useCallback(f=>{e.filterer.$filterConfig.set(f)},[e.filterer.$filterConfig]),l=h.useCallback(f=>{e.filterer.$filterConfig.set(Vs[f].buildDefaults())},[e.filterer.$filterConfig]),c=h.useMemo(()=>Vs[n.type].validateConfig?.(n)??!0,[n]),d=h.useCallback(()=>{e.filterer.saveAs("inpaint_mask")},[e.filterer]),u=h.useCallback(()=>{e.filterer.saveAs("regional_guidance")},[e.filterer]),p=h.useCallback(()=>{e.filterer.saveAs("raster_layer")},[e.filterer]),m=h.useCallback(()=>{e.filterer.saveAs("control_layer")},[e.filterer]);return a.jsxs(a.Fragment,{children:[a.jsxs(A,{w:"full",gap:4,children:[a.jsx(Pt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),a.jsx(At,{}),a.jsx(L8,{}),a.jsx(Ck,{})]}),a.jsx(cue,{filterType:n.type,onChange:l}),a.jsx(lue,{filterConfig:n,onChange:r}),a.jsxs(zn,{isAttached:!1,size:"sm",w:"full",children:[a.jsxs(he,{variant:"ghost",onClick:e.filterer.processImmediate,loadingText:t("controlLayers.filter.process"),isDisabled:s||!c||o&&i,children:[t("controlLayers.filter.process"),s&&a.jsx(ao,{ms:3,boxSize:5,color:"base.600"})]}),a.jsx(At,{}),a.jsx(he,{onClick:e.filterer.reset,isDisabled:s,loadingText:t("controlLayers.filter.reset"),variant:"ghost",children:t("controlLayers.filter.reset")}),a.jsx(he,{onClick:e.filterer.apply,loadingText:t("controlLayers.filter.apply"),variant:"ghost",isDisabled:s||!c||!i,children:t("controlLayers.filter.apply")}),a.jsxs(An,{children:[a.jsx(Pn,{as:he,loadingText:t("controlLayers.selectObject.saveAs"),variant:"ghost",isDisabled:s||!c||!i,rightIcon:a.jsx(Do,{}),children:t("controlLayers.selectObject.saveAs")}),a.jsxs(Zt,{children:[a.jsx(be,{isDisabled:s||!c||!i,onClick:d,children:t("controlLayers.newInpaintMask")}),a.jsx(be,{isDisabled:s||!c||!i,onClick:u,children:t("controlLayers.newRegionalGuidance")}),a.jsx(be,{isDisabled:s||!c||!i,onClick:m,children:t("controlLayers.newControlLayer")}),a.jsx(be,{isDisabled:s||!c||!i,onClick:p,children:t("controlLayers.newRasterLayer")})]})]}),a.jsx(he,{variant:"ghost",onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});due.displayName="FilterContentAdvanced";const uue=h.memo(({adapter:e})=>{const{t}=T(),n=le(e.filterer.$filterConfig),s=le(e.filterer.$isProcessing),i=le(e.filterer.$hasImageState),o=h.useMemo(()=>Vs[n.type].validateConfig?.(n)??!0,[n]),r=h.useCallback(()=>{e.filterer.$simple.set(!1)},[e.filterer.$simple]);return a.jsxs(a.Fragment,{children:[a.jsxs(A,{w:"full",gap:4,children:[a.jsx(Pt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),a.jsx(At,{})]}),a.jsxs(A,{flexDir:"column",w:"full",gap:2,pb:2,children:[a.jsx(q,{color:"base.500",textAlign:"center",children:t("controlLayers.filter.processingLayerWith",{type:t(`controlLayers.filter.${n.type}.label`)})}),a.jsx(q,{color:"base.500",textAlign:"center",children:t("controlLayers.filter.forMoreControl")})]}),a.jsxs(zn,{isAttached:!1,size:"sm",w:"full",children:[a.jsx(he,{variant:"ghost",onClick:r,children:t("controlLayers.filter.advanced")}),a.jsx(At,{}),a.jsx(he,{onClick:e.filterer.apply,loadingText:t("controlLayers.filter.apply"),variant:"ghost",isDisabled:s||!o||!i,children:t("controlLayers.filter.apply")}),a.jsx(he,{variant:"ghost",onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});uue.displayName="FilterContentSimple";const hue=()=>{const e=Tt(),t=le(e.stateApi.$filteringAdapter);return t?a.jsx(pue,{adapter:t}):null};hue.displayName="Filter";const pue=h.memo(({adapter:e})=>{const t=le(e.filterer.$simple),n=So("canvas"),s=le(e.filterer.$isProcessing),i=h.useRef(null);return Qy("canvas",i,{focusOnMount:!0}),Be({id:"applyFilter",category:"canvas",callback:e.filterer.apply,options:{enabled:!s&&n,enableOnFormTags:!0},dependencies:[e.filterer,s,n]}),Be({id:"cancelFilter",category:"canvas",callback:e.filterer.cancel,options:{enabled:!s&&n,enableOnFormTags:!0},dependencies:[e.filterer,s,n]}),a.jsxs(A,{ref:i,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,w:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[t&&a.jsx(uue,{adapter:e}),!t&&a.jsx(due,{adapter:e})]})});pue.displayName="FilterContent";const R8=h.memo(({label:e,value:t,color:n})=>a.jsxs(a.Fragment,{children:[a.jsx(_t,{children:a.jsxs(q,{textAlign:"end",children:[e,": "]})}),a.jsx(_t,{fontWeight:"semibold",children:a.jsx(q,{textAlign:"end",color:n,children:t})})]}));R8.displayName="CanvasHUDItem";const wst=ve(Pc,e=>e.rect),fue=h.memo(()=>{const{t:e}=T(),t=M(wst);return a.jsx(R8,{label:e("controlLayers.HUD.bbox"),value:`${t.width}${t.height} px`})});fue.displayName="CanvasHUDItemBbox";const mue=h.memo(()=>{const{t:e}=T(),t=M(LU),n=M(WCe);return t==="none"?null:a.jsx(R8,{label:e("controlLayers.HUD.scaledBbox"),value:`${n.width}${n.height} px`})});mue.displayName="CanvasHUDItemScaledBbox";const gue=h.memo(()=>a.jsxs(Ms,{bg:"base.900",borderBottomEndRadius:"base",p:2,gap:1,borderRadius:"base",templateColumns:"1fr 1fr",opacity:.6,minW:64,children:[a.jsx(fue,{}),a.jsx(mue,{})]}));gue.displayName="CanvasHUD";class Y0 extends Map{subscriptions=new Set;lastSnapshot=null;constructor(t){super(t)}set=(t,n)=>(super.set(t,n),this.notifySubscribers(),this);delete=t=>{const n=super.delete(t);return this.notifySubscribers(),n};clear=()=>{super.clear(),this.notifySubscribers()};notifySubscribers=()=>{for(const t of this.subscriptions)t()};subscribe=t=>(this.subscriptions.add(t),()=>{this.subscriptions.delete(t)});getSnapshot=()=>{const t=new Map(this);return(!this.lastSnapshot||!this.areSnapshotsEqual(this.lastSnapshot,t))&&(this.lastSnapshot=t),this.lastSnapshot};areSnapshotsEqual=(t,n)=>{if(t.size!==n.size)return!1;for(const[s,i]of t)if(!Object.is(i,n.get(s)))return!1;return!0}}const _st={imageNameCacheSize:1e3,imageDataCacheSize:32,transparencyCalculationCacheSize:1e3,canvasElementCacheSize:32,generationModeCacheSize:100};class pD extends Tn{type="cache";id;path;log;parent;manager;config=_st;imageNameCache=new jc({max:this.config.imageNameCacheSize});canvasElementCache=new jc({max:this.config.canvasElementCacheSize});imageDataCache=new jc({max:this.config.imageDataCacheSize});transparencyCalculationCache=new jc({max:this.config.imageDataCacheSize});generationModeCache=new jc({max:this.config.generationModeCacheSize});constructor(t){super(),this.id=ee("cache"),this.manager=t,this.parent=t,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating cache module")}static getWithFallback=async({cache:t,getValue:n,key:s,onHit:i,onMiss:o})=>{let r=t.get(s);return r===void 0?(o?.(),r=await n(),t.set(s,r)):i?.(r),r};clearAll=()=>{this.canvasElementCache.clear(),this.imageNameCache.clear(),this.generationModeCache.clear()};destroy=()=>{this.log.debug("Destroying cache module"),this.clearAll()}}class Sst extends Tn{type="compositor";id;path;log;parent;manager;$isCompositing=De(!1);$isProcessing=De(!1);$isUploading=De(!1);$isBusy=Ut([this.$isCompositing,this.$isProcessing,this.$isUploading],(t,n,s)=>t||n||s);constructor(t){super(),this.id=ee("canvas_compositor"),this.parent=t,this.manager=t,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating compositor module")}getVisibleRectOfType=t=>{const n=[];for(const s of this.manager.getAllAdapters())s.state.isEnabled&&(t&&s.state.type!==t||s.renderer.hasObjects()&&n.push(s.transformer.getRelativeRect()));return YA(...n)};getRectOfAdapters=t=>{const n=[];for(const s of t)s.renderer.hasObjects()&&n.push(s.transformer.getRelativeRect());return YA(...n)};getVisibleAdaptersOfType=t=>{let n;switch(t){case"raster_layer":n=this.manager.stateApi.getRasterLayersState().entities;break;case"inpaint_mask":n=this.manager.stateApi.getInpaintMasksState().entities;break;case"control_layer":n=this.manager.stateApi.getControlLayersState().entities;break;case"regional_guidance":n=this.manager.stateApi.getRegionsState().entities;break;default:ae(!1,`Unhandled entity type: ${t}`)}return n.map(i=>xa(i)).map(this.manager.getAdapter).filter(i=>!!i).filter(i=>!i.$isDisabled.get()&&i.renderer.hasObjects())};getCompositeHash=(t,n)=>{const s=[];for(const o of t)s.push(o.getHashableState());return Gc({extra:n,adapterHashes:s})};getCompositeCanvas=(t,n,s)=>{const i=t.map(d=>d.entityIdentifier),o=this.getCompositeHash(t,{rect:n}),r=this.manager.cache.canvasElementCache.get(o);if(r)return this.log.debug({entityIdentifiers:i,rect:n},"Using cached composite canvas"),r;this.log.debug({entityIdentifiers:i,rect:n},"Building composite canvas"),this.$isCompositing.set(!0);const l=document.createElement("canvas");l.width=n.width,l.height=n.height;const c=l.getContext("2d");ae(c!==null,"Canvas 2D context is null"),c.imageSmoothingEnabled=!1,s?.globalCompositeOperation&&(c.globalCompositeOperation=s.globalCompositeOperation);for(const d of t){this.log.debug({entityIdentifier:d.entityIdentifier},"Drawing entity to composite canvas");const u=d.getCanvas(n);c.drawImage(u,0,0)}return this.manager.cache.canvasElementCache.set(o,l),this.$isCompositing.set(!1),l};getCompositeImageDTO=async(t,n,s,i,o)=>{ae(n.width>0&&n.height>0,"Unable to rasterize empty rect");const r=this.getCompositeHash(t,{rect:n}),l=o?void 0:this.manager.cache.imageNameCache.get(r);let c=null;if(l){if(c=await fh(l),c)return this.log.debug({rect:n,imageName:l,imageDTO:c},"Using cached composite image"),c;this.log.warn({rect:n,imageName:l},"Cached image name not found, recompositing")}const d=Jy(()=>this.getCompositeCanvas(t,n,i));if(d.isErr())throw this.log.error({error:cn(d.error)},"Failed to get composite canvas"),d.error;this.$isProcessing.set(!0);const u=await Kn(()=>mh(d.value));if(this.$isProcessing.set(!1),u.isErr())throw this.log.error({error:cn(u.error)},"Failed to convert composite canvas to blob"),u.error;const p=u.value;this.manager._isDebugging&&QA(p,"Composite"),this.$isUploading.set(!0);const m=await Kn(()=>Yd({file:new File([p],"canvas-composite.png",{type:"image/png"}),image_category:"general",...s}));if(this.$isUploading.set(!1),m.isErr())throw m.error;return c=m.value,this.manager.cache.imageNameCache.set(r,c.image_name),c};mergeByEntityIdentifiers=async(t,n)=>{if(pe({id:"MERGE_LAYERS_TOAST",title:ye("controlLayers.mergingLayers"),withCount:!1}),t.length<=1)return this.log.warn({entityIdentifiers:t},"Cannot merge less than 2 entities"),null;const s=t[0]?.type;ae(s,"Cannot merge entities with no type (this should never happen)");const i=this.manager.getAdapters(t);ae(i.length===t.length,"Failed to get all adapters for entity identifiers");const o=this.getRectOfAdapters(i),r={globalCompositeOperation:s==="control_layer"?"lighter":void 0},l=await Kn(()=>this.getCompositeImageDTO(i,o,{is_intermediate:!0},r));if(l.isErr())return this.log.error({error:cn(l.error)},"Failed to merge selected entities"),pe({id:"MERGE_LAYERS_TOAST",title:ye("controlLayers.mergeVisibleError"),status:"error",withCount:!1}),null;const c={isSelected:!0,overrides:{objects:[_o(l.value)],position:{x:Math.floor(o.x),y:Math.floor(o.y)}},mergedEntitiesToDelete:n?t.map(UL):[],addAfter:t.map(UL).at(-1)};switch(s){case"raster_layer":this.manager.stateApi.addRasterLayer(c);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(c);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(c);break;case"control_layer":this.manager.stateApi.addControlLayer(c);break;default:ae(!1,"Unsupported type for merge")}return pe({id:"MERGE_LAYERS_TOAST",title:ye("controlLayers.mergeVisibleOk"),status:"success",withCount:!1}),l.value};mergeVisibleOfType=t=>{let n;switch(t){case"raster_layer":n=this.manager.stateApi.runSelector(yM);break;case"inpaint_mask":n=this.manager.stateApi.runSelector(kW);break;case"regional_guidance":n=this.manager.stateApi.runSelector(SW);break;case"control_layer":n=this.manager.stateApi.runSelector(IW);break;default:ae(!1,"Unsupported type for merge")}const s=n.map(xa);return this.mergeByEntityIdentifiers(s,!1)};getGrayscaleMaskCompositeImageDTO=async(t,n,s="noiseLevel",i=!1,o={is_intermediate:!0},r)=>{ae(n.width>0&&n.height>0,"Unable to rasterize empty rect");const l=this.getCompositeHash(t,{rect:n,attribute:s,invertMask:i,grayscale:!0}),c=r?void 0:this.manager.cache.imageNameCache.get(l);let d=null;if(c){if(d=await fh(c),d)return this.log.debug({rect:n,imageName:c,imageDTO:d},"Using cached grayscale composite image"),d;this.log.warn({rect:n,imageName:c},"Cached grayscale image name not found, recompositing")}const u=document.createElement("canvas");u.width=n.width,u.height=n.height;const p=u.getContext("2d");ae(p!==null,"Canvas 2D context is null"),p.fillStyle="white",p.fillRect(0,0,n.width,n.height),p.globalCompositeOperation="darken";for(const v of t){this.log.debug({entityIdentifier:v.entityIdentifier},"Drawing entity to grayscale composite canvas");const b=v.getCanvas(n),C=document.createElement("canvas");C.width=b.width,C.height=b.height;const y=C.getContext("2d");ae(y!==null,"Temp canvas 2D context is null"),y.drawImage(b,0,0);const x=y.getImageData(0,0,C.width,C.height),w=x.data,_=typeof v.state[s]=="number"?v.state[s]:1;for(let S=0;S<w.length;S+=4)if(S+3<w.length){let I=255;(i?(w[S+3]??0)<128:(w[S+3]??0)>127)&&(I=Math.max(0,Math.min(255,255-Math.round(255*_)))),w[S]=I,w[S+1]=I,w[S+2]=I,w[S+3]=255}x.data.set(w),y.putImageData(x,0,0),p.drawImage(C,0,0)}this.$isProcessing.set(!0);const m=await Kn(()=>mh(u));if(this.$isProcessing.set(!1),m.isErr())throw this.log.error({error:cn(m.error)},"Failed to convert grayscale composite canvas to blob"),m.error;const f=m.value;this.manager._isDebugging&&QA(f,"Grayscale Composite"),this.$isUploading.set(!0);const g=await Kn(()=>Yd({file:new File([f],"canvas-grayscale-composite.png",{type:"image/png"}),image_category:"general",...o}));if(this.$isUploading.set(!1),g.isErr())throw g.error;return d=g.value,this.manager.cache.imageNameCache.set(l,d.image_name),d};getTransparency=(t,n,s)=>{const o={entityIdentifiers:t.map(r=>r.entityIdentifier),rect:n};return pD.getWithFallback({cache:this.manager.cache.transparencyCalculationCache,key:s,getValue:async()=>{const r=this.getCompositeCanvas(t,n),l=await pD.getWithFallback({cache:this.manager.cache.imageDataCache,key:s,getValue:()=>Promise.resolve(Dv(r)),onHit:()=>this.log.trace(o,"Using cached image data"),onMiss:()=>this.log.trace(o,"Calculating image data")});return UCe(l)},onHit:()=>this.log.trace(o,"Using cached transparency"),onMiss:()=>this.log.trace(o,"Calculating transparency")})};getGenerationMode=async()=>{const{rect:t}=this.manager.stateApi.getBbox(),n=this.manager.compositor.getVisibleAdaptersOfType("raster_layer"),s=this.getCompositeHash(n,{rect:t}),i=this.manager.compositor.getVisibleAdaptersOfType("inpaint_mask"),o=this.getCompositeHash(i,{rect:t}),r=Gc({rect:t,compositeInpaintMaskHash:o,compositeRasterLayerHash:s}),l=this.manager.cache.generationModeCache.get(r);if(l)return this.log.debug({rect:t,cachedGenerationMode:l},"Using cached generation mode"),l;this.log.debug({rect:t},"Calculating generation mode"),this.$isProcessing.set(!0);const c=await Kn(async()=>{const d=await this.getTransparency(n,t,s),u=await this.getTransparency(i,t,o);let p;return d==="FULLY_TRANSPARENT"?p="txt2img":d==="PARTIALLY_TRANSPARENT"?p="outpaint":u==="FULLY_TRANSPARENT"?p="img2img":p="inpaint",this.manager.cache.generationModeCache.set(r,p),p});if(this.$isProcessing.set(!1),c.isErr())throw this.log.error({error:cn(c.error)},"Failed to calculate generation mode"),c.error;return c.value};repr=()=>({id:this.id,type:this.type,path:this.path,$isCompositing:this.$isCompositing.get(),$isProcessing:this.$isProcessing.get(),$isUploading:this.$isUploading.get(),$isBusy:this.$isBusy.get()})}var aA,_$;function kst(){if(_$)return aA;_$=1;var e=function(n){var s=null,i,o=function(c){return function(){s=null,n.apply(c,i)}},r=function(){for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];i=d,s===null&&(s=requestAnimationFrame(o(this)))};return r.cancel=function(){cancelAnimationFrame(s),s=null},r};return aA=e,aA}var Ist=kst();const vue=Xf(Ist);class eg extends Tn{type;id;path;manager;parent;log;entityIdentifier;static initCallbacks=new Set;static registerInitCallback=t=>{const n=async s=>{const i=await t(s);return i&&this.initCallbacks.delete(n),i};this.initCallbacks.add(n)};static runInitCallbacks=t=>{for(const n of this.initCallbacks)n(t)};selectIsTypeHidden;selectIsSelected;konva;state;subscriptions=new Set;$isLocked=De(!1);$isDisabled=De(!1);$isEntityTypeHidden=De(!1);$isEmpty=De(!0);$canvasCache=De(null);$isOnScreen=De(!0);$intersectsBbox=De(!1);constructor(t,n,s){super(),this.type=s,this.id=t.id,this.entityIdentifier=t,this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Ae.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1})},this.manager.stage.addLayer(this.konva.layer);const i=this.manager.stateApi.runSelector(this.selectState);ae(i!==void 0,"Missing entity state on creation"),this.state=i,this.selectIsTypeHidden=qCe(this.entityIdentifier.type),this.selectIsSelected=KCe(this.entityIdentifier),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectIsTypeHidden,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(U2,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(JA,this.syncVisibility)),this.subscriptions.add(this.manager.stagingArea.$isStaging.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$filteringAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$transformingAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$segmentingAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectIsSelected,this.syncVisibility)),this.subscriptions.add(this.$isDisabled.subscribe(this.manager.tool.render)),this.subscriptions.add(this.$isLocked.subscribe(this.manager.tool.render)),this.subscriptions.add(this.$isEntityTypeHidden.subscribe(this.manager.tool.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncIsOnscreen)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectPosition,this.syncIsOnscreen)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Kw,this.syncIntersectsBbox)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectPosition,this.syncIntersectsBbox))}selectState=ve(rt,t=>bo(t,this.entityIdentifier));selectPosition=ve(this.selectState,t=>t?.position);syncIsOnscreen=()=>{const t=this.manager.stage.getScaledStageRect(),n=this.checkIntersection(t),s=this.$isOnScreen.get();this.$isOnScreen.set(n),s!==n&&this.log.trace(`Moved ${n?"on-screen":"off-screen"}`),this.syncVisibility()};syncIntersectsBbox=()=>{const t=this.manager.stateApi.getBbox().rect,n=this.checkIntersection(t),s=this.$intersectsBbox.get();this.$intersectsBbox.set(n),s!==n&&this.log.trace(`Moved ${n?"into bbox":"out of bbox"}`)};checkIntersection=t=>{const n=this.transformer.$pixelRect.get(),s=this.manager.stateApi.runSelector(this.selectPosition);if(!s)return!1;const i={x:n.x+s.x,y:n.y+s.y,width:n.width,height:n.height},o=ZCe(t,i);return o.width>0&&o.height>0};initialize=async()=>{this.log.debug("Initializing module"),this.subscriptions.add(this.transformer.$pixelRect.listen(this.syncIsOnscreen)),this.subscriptions.add(this.transformer.$pixelRect.listen(this.syncIntersectsBbox)),await this.sync(this.manager.stateApi.runSelector(this.selectState),void 0),this.transformer.initialize(),await this.renderer.initialize(),this.syncZIndices(),this.syncVisibility(),eg.runInitCallbacks(this)};syncZIndices=()=>{this.log.trace("Updating z-indices");let t=0;this.renderer.konva.objectGroup.zIndex(t++),this.bufferRenderer.konva.group.zIndex(t++),this.renderer.konva.compositing&&this.renderer.konva.compositing.group.zIndex(t++),this.transformer.konva.outlineRect.zIndex(t++),this.transformer.konva.proxyRect.zIndex(t++),this.transformer.konva.transformer.zIndex(t++)};syncIsEnabled=()=>{this.log.trace("Updating visibility"),this.$isDisabled.set(!this.state.isEnabled),this.syncVisibility(),this.transformer.syncInteractionState()};syncObjects=async()=>{this.$isEmpty.set(this.state.objects.length===0),await this.renderer.render()&&(this.transformer.requestRectCalculation(),this.transformer.syncInteractionState())};syncPosition=()=>{this.transformer.updatePosition()};syncOpacity=()=>{this.renderer.updateOpacity()};syncVisibility=vue(()=>{if(this.manager.stateApi.runSelector(this.selectIsTypeHidden)){this.setVisibility(!1);return}if(this.manager.stateApi.runSelector(JA)){const t=this.manager.stagingArea.$isStaging.get(),n=zU(this.entityIdentifier);if(t&&!n){this.setVisibility(!1);return}}if(this.manager.stateApi.runSelector(U2)){const t=this.manager.stateApi.$filteringAdapter.get();if(t&&t.id!==this.id){this.setVisibility(!1);return}const n=this.manager.stateApi.$transformingAdapter.get();if(n&&n!==this&&!n.transformer.$silentTransform.get()){this.setVisibility(!1);return}const s=this.manager.stateApi.$segmentingAdapter.get();if(s&&s.id!==this.id){this.setVisibility(!1);return}}if(this.$isDisabled.get()){this.setVisibility(!1);return}if(!this.$isOnScreen.get()&&!this.manager.stateApi.getIsSelected(this.entityIdentifier.id)){this.setVisibility(!1);return}this.setVisibility(!0)});setVisibility=t=>{this.konva.layer.visible()!==t&&(this.log.trace(t?"Showing":"Hiding"),this.konva.layer.visible(t),t&&(this.renderer.updateCompositingRectSize(),this.renderer.updateCompositingRectPosition(),this.renderer.updateCompositingRectFill()),this.renderer.syncKonvaCache())};invalidateRasterCache=()=>{this.renderer.invalidateRasterCache()};syncIsLocked=()=>{this.$isLocked.set(this.state.isLocked),this.transformer.syncInteractionState()};hash=t=>{const n={state:this.getHashableState(),extra:t};return Gc(n)};cropToBbox=async()=>{const{rect:t}=this.manager.stateApi.getBbox(),n=await Kn(()=>this.renderer.rasterize({rect:t,replaceObjects:!0,attrs:{opacity:1,filters:[]}}));if(n.isErr())throw pe({status:"error",title:"Failed to crop to bbox"}),n.error;return n.value};destroy=()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear(),this.renderer.destroy(),this.transformer.$isTransforming.get()&&this.transformer.stopTransform(),this.transformer.destroy(),this.filterer&&(this.filterer.$isFiltering.get()&&this.filterer.cancel(),this.filterer?.destroy()),this.segmentAnything&&(this.segmentAnything.$isSegmenting.get()&&this.segmentAnything.cancel(),this.segmentAnything.destroy()),this.konva.layer.destroy(),this.manager.deleteAdapter(this.entityIdentifier)};repr=()=>({id:this.id,type:this.type,path:this.path,entityIdentifier:this.entityIdentifier,state:It(this.state),transformer:this.transformer.repr(),renderer:this.renderer.repr(),bufferRenderer:this.bufferRenderer.repr(),segmentAnything:this.segmentAnything?.repr()??null,filterer:this.filterer?.repr()??null,hasCache:this.$canvasCache.get()!==null,isLocked:this.$isLocked.get(),isDisabled:this.$isDisabled.get(),isEntityTypeHidden:this.$isEntityTypeHidden.get(),isEmpty:this.$isEmpty.get(),isOnScreen:this.$isOnScreen.get(),intersectsBbox:this.$intersectsBbox.get(),konva:Ai(this.konva.layer)})}class _v extends Tn{type="object_brush_line";id;path;parent;manager;log;state;konva;constructor(t,n){super();const{id:s,clip:i}=t;this.id=s,this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:t},"Creating module"),this.konva={group:new Ae.Group({name:`${this.type}:group`,clip:i,listening:!1}),line:new Ae.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=t}update(t,n=!1){if(n||this.state!==t){this.log.trace({state:t},"Updating brush line");const{points:s,color:i,strokeWidth:o}=t;return this.konva.line.setAttrs({points:s.length===2?[...s,...s]:s,stroke:Bo(i),strokeWidth:o}),this.state=t,!0}return!1}setVisibility(t){this.log.trace({isVisible:t},"Setting brush line visibility"),this.konva.group.visible(t)}destroy=()=>{this.log.debug("Destroying module"),this.konva.group.destroy()};repr=()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:It(this.state)})}class cw extends Tn{type="object_brush_line_with_pressure";id;path;parent;manager;log;state;konva;constructor(t,n){super();const{id:s,clip:i}=t;this.id=s,this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:t},"Creating module"),this.konva={group:new Ae.Group({name:`${this.type}:group`,clip:i,listening:!1}),line:new Ae.Path({name:`${this.type}:path`,listening:!1,shadowForStrokeEnabled:!1,globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=t}update(t,n=!1){if(n||this.state!==t){this.log.trace({state:t},"Updating brush line with pressure");const{points:s,color:i,strokeWidth:o}=t;return this.konva.line.setAttrs({data:VU(s,{size:o/2,simulatePressure:!1,last:!0,thinning:1}),fill:Bo(i)}),this.state=t,!0}return!1}setVisibility(t){this.log.trace({isVisible:t},"Setting brush line visibility"),this.konva.group.visible(t)}destroy=()=>{this.log.debug("Destroying module"),this.konva.group.destroy()};repr=()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:It(this.state)})}class Sv extends Tn{type="object_eraser_line";id;path;parent;manager;log;state;konva;constructor(t,n){super(),this.id=t.id,this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:t},"Creating eraser line renderer module"),this.konva={group:new Ae.Group({name:`${this.type}:group`,clip:t.clip,listening:!1}),line:new Ae.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,stroke:"red",tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=t}update(t,n=!1){if(n||this.state!==t){this.log.trace({state:t},"Updating eraser line");const{points:s,strokeWidth:i}=t;return this.konva.line.setAttrs({points:s.length===2?[...s,...s]:s,strokeWidth:i}),this.state=t,!0}return!1}setVisibility(t){this.log.trace({isVisible:t},"Setting brush line visibility"),this.konva.group.visible(t)}destroy=()=>{this.log.debug("Destroying module"),this.konva.group.destroy()};repr=()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:It(this.state)})}class dw extends Tn{type="object_eraser_line_with_pressure";id;path;parent;manager;log;state;konva;constructor(t,n){super();const{id:s,clip:i}=t;this.id=s,this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:t},"Creating module"),this.konva={group:new Ae.Group({name:`${this.type}:group`,clip:i,listening:!1}),line:new Ae.Path({name:`${this.type}:path`,listening:!1,fill:"red",shadowForStrokeEnabled:!1,globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=t}update(t,n=!1){if(n||this.state!==t){this.log.trace({state:t},"Updating eraser line with pressure");const{points:s,strokeWidth:i}=t;return this.konva.line.setAttrs({data:VU(s,{size:i/2,simulatePressure:!1,last:!0,thinning:1})}),this.state=t,!0}return!1}setVisibility(t){this.log.trace({isVisible:t},"Setting eraser line visibility"),this.konva.group.visible(t)}destroy=()=>{this.log.debug("Destroying module"),this.konva.group.destroy()};repr=()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:It(this.state)})}const jst={usePhysicalDimensions:!1};class Ud extends Tn{type="object_image";id;path;parent;manager;log;state;config=jst;konva;imageElement=null;isLoading=!1;isError=!1;mutex=new H_;constructor(t,n){super(),this.id=t.id,this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:t},"Creating module");const{width:s,height:i}=t.image;this.konva={group:new Ae.Group({name:`${this.type}:group`,listening:!1}),placeholder:{group:new Ae.Group({name:`${this.type}:placeholder_group`,listening:!1}),rect:new Ae.Rect({name:`${this.type}:placeholder_rect`,fill:"hsl(220 12% 45% / 1)",width:s,height:i,listening:!1,perfectDrawEnabled:!1}),text:new Ae.Text({name:`${this.type}:placeholder_text`,fill:"hsl(220 12% 10% / 1)",width:s,height:i,align:"center",verticalAlign:"middle",fontFamily:'"Inter Variable", sans-serif',fontSize:s/16,fontStyle:"600",text:ye("common.loadingImage","Loading Image"),listening:!1,perfectDrawEnabled:!1})},image:null},this.konva.placeholder.group.add(this.konva.placeholder.rect),this.konva.placeholder.group.add(this.konva.placeholder.text),this.konva.group.add(this.konva.placeholder.group),this.state=t}updateImageSourceByImageName=async t=>{this.log.trace({imageName:t},"Updating image source"),this.isLoading=!0,this.konva.group.visible(!0),this.konva.image||(this.konva.placeholder.group.visible(!1),this.konva.placeholder.text.text(ye("common.loadingImage","Loading Image")));const n=await fh(t);if(n===null){this.onFailedToLoadImage(ye("controlLayers.unableToFindImage","Unable to find image"));return}const s=await Kn(()=>qL(n.image_url));if(s.isErr()){this.onFailedToLoadImage(ye("controlLayers.unableToLoadImage","Unable to load image"),ts(s.error));return}this.imageElement=s.value,this.updateImageElement()};updateImageSourceByDataURL=async t=>{this.log.trace({dataURL:`${t.substring(0,16)}...`},"Updating image source"),this.isLoading=!0,this.konva.group.visible(!0),this.konva.image||(this.konva.placeholder.group.visible(!1),this.konva.placeholder.text.text(ye("common.loadingImage","Loading Image")));const n=await Kn(()=>qL(t));if(n.isErr()){this.onFailedToLoadImage(ye("controlLayers.unableToLoadImage","Unable to load image"),ts(n.error));return}this.imageElement=n.value,this.updateImageElement()};onFailedToLoadImage=(t,n)=>{this.log.error({image:this.state.image,error:n},t),this.konva.image?.visible(!1),this.isLoading=!1,this.isError=!0,this.konva.placeholder.text.text(t),this.konva.placeholder.group.visible(!0)};getDimensions=()=>this.config.usePhysicalDimensions&&this.imageElement?{width:this.imageElement.width,height:this.imageElement.height}:{width:this.state.image.width,height:this.state.image.height};updateImageElement=()=>{if(this.imageElement){const{width:t,height:n}=this.getDimensions();this.konva.image?(this.log.trace("Updating Konva image attrs"),this.konva.image.setAttrs({image:this.imageElement,width:t,height:n,visible:!0})):(this.log.trace("Creating new Konva image"),this.konva.image=new Ae.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,width:t,height:n,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.placeholder.rect.setAttrs({width:t,height:n}),this.konva.placeholder.text.setAttrs({width:t,height:n,fontSize:t/16}),this.isLoading=!1,this.isError=!1,this.konva.placeholder.group.visible(!1)}};update=async(t,n=!1)=>{if(n||this.state!==t){this.log.trace({state:t},"Updating image");const{image:s}=t;if(n||!yo(this.state,t)&&!this.isLoading){const i=await this.mutex.acquire();try{"image_name"in s?await this.updateImageSourceByImageName(s.image_name):await this.updateImageSourceByDataURL(s.dataURL)}finally{i()}}return this.konva.image?.setAttrs(this.getDimensions()),this.state=t,!0}return!1};destroy=()=>{this.log.debug("Destroying image renderer module"),this.konva.group.destroy()};setVisibility=t=>{this.log.trace({isVisible:t},"Setting image visibility"),this.konva.group.visible(t)};repr=()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isLoading:this.isLoading,isError:this.isError,state:It(this.state),konva:{group:Ai(this.konva.group),image:this.konva.image?Ai(this.konva.image):null}})}class uw extends Tn{type="object_rect";id;path;parent;manager;log;state;konva;isFirstRender=!1;constructor(t,n){super(),this.id=t.id,this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:t},"Creating module"),this.konva={group:new Ae.Group({name:`${this.type}:group`,listening:!1}),rect:new Ae.Rect({name:`${this.type}:rect`,listening:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.rect),this.state=t}update(t,n=!1){if(n||this.state!==t){this.isFirstRender=!1,this.log.trace({state:t},"Updating rect");const{rect:s,color:i}=t;return this.konva.rect.setAttrs({x:s.x,y:s.y,width:s.width,height:s.height,fill:Bo(i)}),this.state=t,!0}return!1}setVisibility(t){this.log.trace({isVisible:t},"Setting rect visibility"),this.konva.group.visible(t)}destroy=()=>{this.log.debug("Destroying module"),this.konva.group.destroy()};repr=()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isFirstRender:this.isFirstRender,state:It(this.state)})}class wk extends Tn{type="buffer_renderer";id;path;parent;manager;log;subscriptions=new Set;state=null;renderer=null;konva;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=t.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ae.Group({name:`${this.type}:buffer_group`,listening:!1})},this.parent.konva.layer.add(this.konva.group),this.subscriptions.add(this.manager.tool.$tool.listen(()=>{this.hasBuffer()&&!this.manager.$isBusy.get()&&this.commitBuffer()}))}renderBufferObject=async()=>{let t=!1;if(!this.state)return!1;let n=null;return this.renderer&&this.renderer.id!==this.state.id&&(n=this.renderer,this.renderer=null),this.state.type==="brush_line"?(ae(this.renderer instanceof _v||!this.renderer),this.renderer||(this.renderer=new _v(this.state,this),this.konva.group.add(this.renderer.konva.group)),t=this.renderer.update(this.state,!0)):this.state.type==="brush_line_with_pressure"?(ae(this.renderer instanceof cw||!this.renderer),this.renderer||(this.renderer=new cw(this.state,this),this.konva.group.add(this.renderer.konva.group)),t=this.renderer.update(this.state,!0)):this.state.type==="eraser_line"?(ae(this.renderer instanceof Sv||!this.renderer),this.renderer||(this.renderer=new Sv(this.state,this),this.konva.group.add(this.renderer.konva.group)),t=this.renderer.update(this.state,!0)):this.state.type==="eraser_line_with_pressure"?(ae(this.renderer instanceof dw||!this.renderer),this.renderer||(this.renderer=new dw(this.state,this),this.konva.group.add(this.renderer.konva.group)),t=this.renderer.update(this.state,!0)):this.state.type==="rect"?(ae(this.renderer instanceof uw||!this.renderer),this.renderer||(this.renderer=new uw(this.state,this),this.konva.group.add(this.renderer.konva.group)),t=this.renderer.update(this.state,!0)):this.state.type==="image"&&(ae(this.renderer instanceof Ud||!this.renderer),this.renderer||(this.renderer=new Ud(this.state,this),this.konva.group.add(this.renderer.konva.group)),t=await this.renderer.update(this.state,!0)),n&&n.destroy(),t};hasBuffer=()=>this.state!==null||this.renderer!==null;setBuffer=async(t,n=!1)=>(this.log.trace("Setting buffer"),this.state=t,n&&this.konva.group.offset({x:0,y:0}),await this.renderBufferObject());clearBuffer=()=>{(this.state||this.renderer)&&(this.log.trace("Clearing buffer"),this.renderer?.destroy(),this.renderer=null,this.state=null)};commitBuffer=t=>{if({...t},!this.state||!this.renderer){this.log.trace("No buffer to commit");return}this.log.trace({buffer:this.renderer.repr()},"Committing buffer"),this.parent.renderer.adoptObjectRenderer(this.renderer);{const n=this.parent.entityIdentifier;switch(this.state.type){case"brush_line":case"brush_line_with_pressure":this.manager.stateApi.addBrushLine({entityIdentifier:n,brushLine:this.state});break;case"eraser_line":case"eraser_line_with_pressure":this.manager.stateApi.addEraserLine({entityIdentifier:n,eraserLine:this.state});break;case"rect":this.manager.stateApi.addRect({entityIdentifier:n,rect:this.state});break}}this.renderer=null,this.state=null};destroy=()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear(),this.renderer&&this.renderer.destroy()};repr=()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,bufferState:It(this.state),bufferRenderer:this.renderer?.repr()??null})}const Est={PROCESS_DEBOUNCE_MS:1e3};class yue extends Tn{type="canvas_filterer";id;path;parent;manager;log;config=Est;subscriptions=new Set;abortController=null;$isFiltering=De(!1);$lastProcessedHash=De("");$isProcessing=De(!1);$filterConfig=De(Vs.adjust_image.buildDefaults());$initialFilterConfig=De(null);$imageState=De(null);$hasImageState=Ut(this.$imageState,t=>t!==null);$simple=De(!1);imageModule=null;konva;KONVA_GROUP_NAME=`${this.type}:group`;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating filter module"),this.konva={group:new Ae.Group({name:this.KONVA_GROUP_NAME})}}subscribe=()=>{this.subscriptions.add(this.$filterConfig.listen(()=>{this.manager.stateApi.getSettings().autoProcess&&this.$isFiltering.get()&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Ky,t=>{t&&this.$isFiltering.get()&&this.process()}))};unsubscribe=()=>{this.subscriptions.forEach(t=>t()),this.subscriptions.clear()};start=t=>{const n=this.manager.stateApi.$filteringAdapter.get();if(n){this.log.error(`Already filtering an entity: ${n.id}`);return}this.log.trace("Initializing filter"),this.resetEphemeralState(),this.$isFiltering.set(!0);const s=this.parent.transformer.$pixelRect.get(),i=Dp(this.parent.state.position,s);if(this.konva.group.setAttrs(i),this.parent.konva.layer.add(this.konva.group),t)this.$filterConfig.set(t),this.$initialFilterConfig.set(t),this.$simple.set(!0);else{const o=this.createInitialFilterConfig();this.$filterConfig.set(o),this.$initialFilterConfig.set(o),this.$simple.set(!1)}this.subscribe(),this.manager.stateApi.$filteringAdapter.set(this.parent),this.manager.stateApi.getSettings().autoProcess&&this.processImmediate()};createInitialFilterConfig=()=>{if(this.parent.type==="control_layer_adapter"&&this.parent.state.controlAdapter.model){const t=this.parent.state.controlAdapter.model.key,n=this.manager.stateApi.runSelector(i=>{const{data:o}=QD(i);return o?$l.selectAll(o).filter(fH).find(r=>r.key===t)??null:null});return(zse(n)??Vs.canny_edge_detection).buildDefaults()}else return Vs.adjust_image.buildDefaults()};processImmediate=async()=>{if(!this.$isFiltering.get()){this.log.warn("Cannot process filter when not initialized");return}const t=this.$filterConfig.get(),n=Vs[t.type];if(!(n.validateConfig?.(t)??!0)){this.log.error({config:t},"Invalid filter config");return}const i=Gc({config:t});if(i===this.$lastProcessedHash.get()){this.log.trace("Already processed config");return}this.log.trace({config:t},"Processing filter");const o=this.parent.transformer.getRelativeRect(),r=await Kn(()=>this.parent.renderer.rasterize({rect:o,attrs:{filters:[],opacity:1}}));if(r.isErr()){pe({status:"error",title:"Failed to process filter"}),this.log.error({error:cn(r.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}this.$isProcessing.set(!0);const l=r.value,c=Jy(()=>n.buildGraph(l,t));if(c.isErr()){this.log.error({error:cn(c.error)},"Error building filter graph"),this.$isProcessing.set(!1);return}const d=new AbortController;this.abortController=d;const{graph:u,outputNodeId:p}=c.value,m=await Kn(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:u,outputNodeId:p,options:{prepend:!0,signal:d.signal}}));if(m.isErr()){this.log.error({error:cn(m.error)},"Error filtering"),this.$isProcessing.set(!1),d.signal.aborted||d.abort(),this.abortController=null;return}this.log.trace({imageDTO:m.value},"Filtered");const f=_o(m.value);this.$imageState.set(f);const g=this.imageModule;this.imageModule=new Ud(f,this),await this.imageModule.update(f,!0),this.konva.group.add(this.imageModule.konva.group),this.parent.renderer.hideObjects(),g&&g.destroy(),this.$lastProcessedHash.set(i),this.$isProcessing.set(!1),d.signal.aborted||d.abort(),this.abortController=null};process=pr(this.processImmediate,this.config.PROCESS_DEBOUNCE_MS);apply=()=>{const t=this.$imageState.get();if(!t){this.log.warn("No image state to apply filter to");return}this.log.trace("Applying"),this.imageModule&&this.parent.renderer.adoptObjectRenderer(this.imageModule);const n=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:t,position:{x:Math.round(n.x),y:Math.round(n.y)},replaceObjects:!0}),this.teardown()};saveAs=t=>{const n=this.$imageState.get();if(!n){this.log.warn("No image state to apply filter to");return}this.log.trace(`Saving as ${t}`);const s=this.parent.transformer.getRelativeRect(),i={overrides:{objects:[n],position:{x:Math.round(s.x),y:Math.round(s.y)}},isSelected:!0};switch(t){case"raster_layer":this.manager.stateApi.addRasterLayer(i);break;case"control_layer":this.manager.stateApi.addControlLayer(i);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(i);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(i);break;default:ae(!1)}};resetEphemeralState=()=>{this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.imageModule&&this.imageModule.konva.group.parent===this.konva.group&&this.imageModule.destroy(),this.imageModule=null;const t=It(this.$initialFilterConfig.get()??this.createInitialFilterConfig());this.$filterConfig.set(t),this.$imageState.set(null),this.$lastProcessedHash.set(""),this.$isProcessing.set(!1)};teardown=()=>{this.unsubscribe(),this.parent.renderer.showObjects(),this.konva.group.remove(),this.resetEphemeralState(),this.$isFiltering.set(!1),this.manager.stateApi.$filteringAdapter.set(null)};reset=()=>{this.log.trace("Resetting"),this.resetEphemeralState()};cancel=()=>{this.log.trace("Canceling"),this.teardown()};repr=()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,config:this.config,imageState:It(this.$imageState.get()),$isFiltering:this.$isFiltering.get(),$lastProcessedHash:this.$lastProcessedHash.get(),$isProcessing:this.$isProcessing.get(),$filterConfig:this.$filterConfig.get(),konva:{group:Ai(this.konva.group)}});destroy=()=>{this.log.debug("Destroying module"),this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.unsubscribe(),this.konva.group.destroy()}}const Ast=e=>{const t=e.data.length/4;for(let n=0;n<t;n++){const s=e.data[n*4+0],i=e.data[n*4+1],o=e.data[n*4+2],r=e.data[n*4+3],l=Math.min(s,i,o),c=Math.max(s,i,o);e.data[n*4+3]=Math.min(r,(l+c)/2)}},rA=function(e){const t=this.getAttr("adjustmentsSimple"),n=XCe.safeParse(t);if(!n.success)return;const s=n.data,{brightness:i,contrast:o,saturation:r,temperature:l,tint:c,sharpness:d}=s,u=e.data,p=u.length/4,m=e.width,f=e.height,g=i*255,v=1+o,b=.5,C=.5,y=1+l*b,x=1-l*b,w=fi(c,-1,1)*C,_=Math.abs(w),S=w>=0?1+_:1-_,I=w>=0?1-_:1+_,k=w>=0?1+_:1-_,E=.2126,j=.7152,P=.0722,D=1+r,O=E*(1-D)+D,N=j*(1-D),F=P*(1-D),X=E*(1-D),L=j*(1-D)+D,V=P*(1-D),K=E*(1-D),U=j*(1-D),Z=P*(1-D)+D;for(let W=0;W<p;W++){const R=W*4;let G=u[R+0],H=u[R+1],$=u[R+2];const z=u[R+3];G=G+g,H=H+g,$=$+g,G=(G-128)*v+128,H=(H-128)*v+128,$=($-128)*v+128,G=G*y*S,H=H*I,$=$*x*k;const B=G*O+H*N+$*F,Y=G*X+H*L+$*V,ie=G*K+H*U+$*Z;u[R+0]=fi(B,0,255),u[R+1]=fi(Y,0,255),u[R+2]=fi(ie,0,255),u[R+3]=z}if(Math.abs(d)>.001&&m>2&&f>2){const W=new Uint8ClampedArray(u),R=Math.max(-1,Math.min(1,d))*.5,G=1+4*R,H=-R;for(let $=1;$<f-1;$++)for(let z=1;z<m-1;z++){const B=($*m+z)*4;for(let Y=0;Y<3;Y++){const ie=W[B+Y]??0,ge=W[B-4+Y]??0,xe=W[B+4+Y]??0,we=W[B-m*4+Y]??0,je=W[B+m*4+Y]??0,Re=ie*G+ge*H+xe*H+we*H+je*H;u[B+Y]=fi(Re,0,255)}}}},Gx=e=>{if(!e||e.length===0)return Array.from({length:256},(o,r)=>r);const t=e.map(([o,r])=>[fi(Math.round(o),0,255),fi(Math.round(r),0,255)]).sort((o,r)=>o[0]-r[0]);(t[0]?.[0]??0)!==0&&t.unshift([0,t[0]?.[1]??0]);const n=t[t.length-1];(n?.[0]??255)!==255&&t.push([255,n?.[1]??255]);const s=new Array(256);let i=0;for(let o=0;o<=255;o++){for(;i<t.length-2&&o>(t[i+1]?.[0]??255);)i++;const r=t[i]??[0,0],l=t[i+1]??[255,255],[c,d]=r,[u,p]=l,m=u===c?0:(o-c)/(u-c),f=d+(p-d)*m;s[o]=fi(Math.round(f),0,255)}return s},lA=function(e){const t=this.getAttr("adjustmentsCurves"),n=YCe.safeParse(t);if(!n.success)return;const s=n.data,{master:i,r:o,g:r,b:l}=s;if(!i||!o||!r||!l)return;const c=e.data,d=c.length/4;for(let u=0;u<d;u++){const p=u*4,m=c[p+0],f=c[p+1],g=c[p+2],v=i[m]??m,b=i[f]??f,C=i[g]??g;c[p+0]=fi(o[v]??v,0,255),c[p+1]=fi(r[b]??b,0,255),c[p+2]=fi(l[C]??C,0,255)}},Pst=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="6px" height="6px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
    <path d="M1,-2L13,10" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
    <path d="M-1,2L10,13" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
</svg>\r
`,Tst=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="6px" height="6px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.3px;"/>\r
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.3px;"/>\r
</svg>\r
`,Dst=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="12px" height="12px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0.5,-1L0.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M4.5,-1L4.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M8.5,-1L8.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M-1,0.5L12,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M-1,4.5L12,4.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M-1,8.5L12,8.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
</svg>\r
`,Mst=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="9px" height="9px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M10,0.5L-1,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M10,3.5L-1,3.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M10,6.5L-1,6.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
</svg>\r
`,Lst=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="9px" height="9px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0.5,-1L0.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M3.5,-1L3.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M6.5,-1L6.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>\r
</svg>\r
`;function Rst(e,t){let n="data:image/svg+xml;utf8,";return e==="crosshatch"?n+=Pst:e==="diagonal"?n+=Tst:e==="horizontal"?n+=Mst:e==="vertical"?n+=Lst:e==="grid"&&(n+=Dst),n=n.replaceAll("stroke:black",`stroke:${Eh(t)}`),n}function Ost(e,...t){const n=new Image;return n.onload=()=>{e.fillPatternImage(n)},n.crossOrigin="anonymous",n.src=Rst(...t),n}class _k extends Tn{type="object_renderer";id;path;parent;manager;log;subscriptions=new Set;renderers=new Y0;rasterCacheKeys=new Set;konva;constructor(t){if(super(),this.id=ee(this.type),this.parent=t,this.manager=t.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={objectGroup:new Ae.Group({name:`${this.type}:object_group`,listening:!1}),compositing:null},this.parent.konva.layer.add(this.konva.objectGroup),this.parent.entityIdentifier.type==="inpaint_mask"||this.parent.entityIdentifier.type==="regional_guidance"){const n=new Ae.Rect({name:`${this.type}:compositing_rect`,globalCompositeOperation:"source-in",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1});this.konva.compositing={group:new Ae.Group({name:`${this.type}:compositing_group`,listening:!1}),rect:n,patternImage:new Image},this.konva.compositing.group.add(this.konva.compositing.rect),this.parent.konva.layer.add(this.konva.compositing.group)}this.subscriptions.add(this.manager.stage.$stageAttrs.listen((n,s)=>{this.konva.compositing&&(qw(n)||((n.width!==s.width||n.height!==s.height||n.scale!==s.scale)&&this.updateCompositingRectSize(),(n.x!==s.x||n.y!==s.y)&&this.updateCompositingRectPosition()))}))}initialize=async()=>{this.log.debug("Initializing module"),await this.render()};render=async()=>{let t=!1;const n=this.parent.state.objects,s=n.map(i=>i.id);for(const i of this.renderers.values())s.includes(i.id)||(this.renderers.delete(i.id),i.destroy(),t=!0);for(const i of n)t=await this.renderObject(i)||t;return this.syncKonvaCache(t),t};hideObjects=()=>{this.konva.objectGroup.hide()};showObjects=()=>{this.konva.objectGroup.show()};adoptObjectRenderer=t=>{this.renderers.set(t.id,t),t.konva.group.moveTo(this.konva.objectGroup)};syncKonvaCache=(t=!1)=>{if(this.renderers.size===0){this.log.trace("Clearing object group cache"),this.konva.objectGroup.clearCache();return}const n=this.parent.konva.layer.visible(),s=this.konva.objectGroup.isCached();n&&(t||!s)&&(this.log.trace("Caching object group"),this.konva.objectGroup.clearCache(),this.konva.objectGroup.cache({pixelRatio:1,imageSmoothingEnabled:!1}))};updateTransparencyEffect=()=>{if(this.parent.state.type==="control_layer"){const t=this.parent.state.withTransparencyEffect?[Ast]:[];this.konva.objectGroup.filters(t)}};updateCompositingRectFill=rP(t=>{if(!t&&!this.hasObjects()||!this.parent.konva.layer.visible()||!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance")return;this.log.trace("Updating compositing rect fill");const n=this.parent.state.fill;n.style==="solid"?this.konva.compositing.rect.setAttrs({fill:Eh(n.color),fillPriority:"color"}):(this.konva.compositing.rect.setAttrs({fillPriority:"pattern"}),Ost(this.konva.compositing.rect,n.style,n.color))},100);updateCompositingRectSize=t=>{if(!t&&!this.hasObjects()||!this.parent.konva.layer.visible()||!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance")return;this.log.trace("Updating compositing rect size");const n=this.manager.stage.unscale(1);this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect(),fillPatternScaleX:n,fillPatternScaleY:n})};updateCompositingRectPosition=t=>{!t&&!this.hasObjects()||this.parent.konva.layer.visible()&&(!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance"||(this.log.trace("Updating compositing rect position"),this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect()})))};updateOpacity=rP(()=>{if(!this.parent.konva.layer.visible())return;this.log.trace("Updating opacity");const t=this.parent.state.opacity;this.konva.compositing?this.konva.compositing.group.opacity(t):this.konva.objectGroup.opacity(t),this.parent.bufferRenderer.konva.group.opacity(t)},100);renderObject=async(t,n=!1)=>{let s=!1,i=this.renderers.get(t.id);const o=!i;return t.type==="brush_line"?(ae(i instanceof _v||!i),i||(i=new _v(t,this),this.renderers.set(i.id,i),this.konva.objectGroup.add(i.konva.group)),s=i.update(t,n||o)):t.type==="brush_line_with_pressure"?(ae(i instanceof cw||!i),i||(i=new cw(t,this),this.renderers.set(i.id,i),this.konva.objectGroup.add(i.konva.group)),s=i.update(t,n||o)):t.type==="eraser_line"?(ae(i instanceof Sv||!i),i||(i=new Sv(t,this),this.renderers.set(i.id,i),this.konva.objectGroup.add(i.konva.group)),s=i.update(t,n||o)):t.type==="eraser_line_with_pressure"?(ae(i instanceof dw||!i),i||(i=new dw(t,this),this.renderers.set(i.id,i),this.konva.objectGroup.add(i.konva.group)),s=i.update(t,n||o)):t.type==="rect"?(ae(i instanceof uw||!i),i||(i=new uw(t,this),this.renderers.set(i.id,i),this.konva.objectGroup.add(i.konva.group)),s=i.update(t,n||o)):t.type==="image"&&(ae(i instanceof Ud||!i),i||(i=new Ud(t,this),this.renderers.set(i.id,i),this.konva.objectGroup.add(i.konva.group)),s=await i.update(t,n||o)),s&&this.konva.objectGroup.isCached()&&this.konva.objectGroup.clearCache(),s};needsPixelBbox=()=>{let t=!1;for(const n of this.renderers.values()){const s=n instanceof Sv,i=n instanceof Ud,o=n instanceof _v&&n.state.clip;if(s||o||i){t=!0;break}}return t};hasObjects=()=>this.renderers.size>0||this.parent.bufferRenderer.hasBuffer();rasterize=async t=>{this.manager.stateApi.$rasterizingAdapter.get()&&await this.manager.stateApi.waitForRasterizationToFinish();const{rect:s,replaceObjects:i,attrs:o,bg:r,ignoreCache:l}={replaceObjects:!1,ignoreCache:!1,attrs:{},...t};let c=null;const d={rect:s,attrs:o,bg:r},u=this.parent.hash(d),p=this.manager.cache.imageNameCache.get(u);if(p&&!l&&(c=await fh(p),c))return this.rasterCacheKeys.add(u),this.log.trace({rect:s,cachedImageName:p,imageDTO:c},"Using cached rasterized image"),c;this.log.trace({rasterizeArgs:d},"Rasterizing entity"),this.manager.stateApi.$rasterizingAdapter.set(this.parent);try{const m=await this.getBlob(d);this.manager._isDebugging&&QA(m,"Rasterized entity"),c=await Yd({file:new File([m],`${this.id}_rasterized.png`,{type:"image/png"}),image_category:"other",is_intermediate:!0,silent:!0});const f=_o(c);return i&&(await this.parent.bufferRenderer.setBuffer(f),this.parent.bufferRenderer.commitBuffer({pushToState:!1})),this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:f,position:{x:Math.round(s.x),y:Math.round(s.y)},replaceObjects:i}),this.manager.cache.imageNameCache.set(u,c.image_name),this.rasterCacheKeys.add(u),c}catch(m){throw this.log.error({rasterizeArgs:d,error:cn(m)},"Failed to rasterize entity"),m}finally{this.manager.stateApi.$rasterizingAdapter.set(null)}};invalidateRasterCache=()=>{if(this.rasterCacheKeys.size!==0){for(const t of this.rasterCacheKeys)this.manager.cache.imageNameCache.delete(t);this.rasterCacheKeys.clear()}};cloneObjectGroup=(t={})=>{const{attrs:n}=t,s=this.konva.objectGroup.clone();return n&&s.setAttrs(n),s.hasChildren()&&s.cache({pixelRatio:1,imageSmoothingEnabled:!1}),s};getCanvas=(t={})=>{const{rect:n,attrs:s,bg:i}=t,o=this.cloneObjectGroup({attrs:s}),r=QCe({node:o,rect:n,bg:i});return o.destroy(),r};getBlob=async(t={})=>{const{rect:n,attrs:s,bg:i}=t,o=this.cloneObjectGroup({attrs:s});return await JCe({node:o,rect:n,bg:i})};getImageData=(t={})=>{const{rect:n,attrs:s,bg:i}=t,o=this.cloneObjectGroup({attrs:s}),r=ewe({node:o,rect:n,bg:i});return o.destroy(),r};destroy=()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear();for(const t of this.renderers.values())t.destroy();this.renderers.clear()};repr=()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,renderers:Array.from(this.renderers.values()).map(t=>t.repr()),konva:{objectGroup:Ai(this.konva.objectGroup)}})}const Nst={SAM_POINT_RADIUS:8,SAM_POINT_BORDER_WIDTH:2,SAM_POINT_BORDER_COLOR:{r:0,g:0,b:0,a:1},SAM_POINT_FOREGROUND_COLOR:{r:50,g:255,b:0,a:1},SAM_POINT_BACKGROUND_COLOR:{r:255,g:0,b:50,a:1},SAM_POINT_NEUTRAL_COLOR:{r:0,g:225,b:255,a:1},MASK_COLOR:{r:0,g:225,b:255,a:1},PROCESS_DEBOUNCE_MS:1e3},Ou=e=>e.type==="prompt"?e.prompt.trim()!=="":e.points.length>0||e.bbox!==null,bue=e=>{const t=[];for(const{id:n,coord:s,label:i}of e.points)t.push({id:n,x:s.x,y:s.y,label:i});return t},S$=e=>e.type==="prompt"?{type:"prompt",prompt:e.prompt}:{type:"visual",points:bue(e),bbox:e.bbox};class Sk extends Tn{type="canvas_segment_anything";id;path;parent;manager;log;config=Nst;subscriptions=new Set;abortController=null;$isSegmenting=De(!1);$lastProcessedHash=De("");$isProcessing=De(!1);$pointType=De(1);$model=De("SAM1");$pointTypeString=Ut(this.$pointType,t=>Jk[t]);$isDraggingPoint=De(!1);$imageState=De(null);$hasImageState=Ut(this.$imageState,t=>t!==null);$inputData=De({type:"visual",points:[],bbox:null});$inputType=Ut(this.$inputData,t=>t.type);$hasInputData=Ut(this.$inputData,Ou);$invert=De(!1);$isBboxDrawing=De(!1);$bboxStartCoord=De(null);$bboxDragStart=De(null);$isBboxDragging=De(!1);imageModule=null;konva;KONVA_CIRCLE_NAME=`${this.type}:circle`;KONVA_GROUP_NAME=`${this.type}:group`;KONVA_POINT_GROUP_NAME=`${this.type}:point_group`;KONVA_BBOX_GROUP_NAME=`${this.type}:bbox_group`;KONVA_BBOX_RECT_NAME=`${this.type}:bbox_rect`;KONVA_BBOX_TRANSFORMER_NAME=`${this.type}:bbox_transformer`;KONVA_MASK_GROUP_NAME=`${this.type}:mask_group`;KONVA_COMPOSITING_RECT_NAME=`${this.type}:compositing_rect`;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ae.Group({name:this.KONVA_GROUP_NAME}),pointGroup:new Ae.Group({name:this.KONVA_POINT_GROUP_NAME}),bboxGroup:new Ae.Group({name:this.KONVA_BBOX_GROUP_NAME,listening:!0}),bboxRect:new Ae.Rect({name:this.KONVA_BBOX_RECT_NAME,borderDash:[5,5],stroke:Bo(this.config.MASK_COLOR),strokeWidth:2,strokeScaleEnabled:!1,fill:Bo({...this.config.MASK_COLOR,a:.1}),draggable:!1,listening:!0,visible:!1}),bboxTransformer:new Ae.Transformer({name:this.KONVA_BBOX_TRANSFORMER_NAME,borderDash:[5,5],borderStroke:Bo(this.config.MASK_COLOR),borderEnabled:!0,borderStrokeWidth:1,rotateEnabled:!1,keepRatio:!1,ignoreStroke:!0,flipEnabled:!1,anchorFill:Bo(this.config.MASK_COLOR),anchorStroke:"rgb(42,42,42)",anchorSize:12,anchorCornerRadius:3,listening:!0,visible:!1}),maskGroup:new Ae.Group({name:this.KONVA_MASK_GROUP_NAME,opacity:.6}),compositingRect:new Ae.Rect({name:this.KONVA_COMPOSITING_RECT_NAME,fill:Bo(this.config.MASK_COLOR),globalCompositeOperation:"source-atop",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1,visible:!1}),maskTween:null},this.konva.group.add(this.konva.maskGroup),this.konva.group.add(this.konva.bboxGroup),this.konva.group.add(this.konva.pointGroup),this.konva.bboxGroup.add(this.konva.bboxRect),this.konva.bboxGroup.add(this.konva.bboxTransformer),this.konva.bboxTransformer.nodes([this.konva.bboxRect]),this.konva.bboxTransformer.find("._anchor").forEach(n=>{n.hitStrokeWidth(12)}),this.konva.bboxTransformer.on("transformend",()=>{const n=this.$inputData.get();if(n.type!=="visual")return;const s=this.konva.bboxRect.x(),i=this.konva.bboxRect.y(),o=this.konva.bboxRect.scaleX(),r=this.konva.bboxRect.scaleY(),l=Math.max(1,this.konva.bboxRect.width()*o),c=Math.max(1,this.konva.bboxRect.height()*r);this.konva.bboxRect.setAttrs({x:s,y:i,width:l,height:c,scaleX:1,scaleY:1}),this.$inputData.set({...n,bbox:{x:s,y:i,width:l,height:c}})}),this.konva.bboxRect.on("dragend",()=>{const n=this.$inputData.get();if(n.type!=="visual")return;const s=this.konva.bboxRect.x(),i=this.konva.bboxRect.y(),o=this.konva.bboxRect.width()*this.konva.bboxRect.scaleX(),r=this.konva.bboxRect.height()*this.konva.bboxRect.scaleY();this.$inputData.set({...n,bbox:{x:s,y:i,width:o,height:r}})}),this.konva.bboxRect.on("pointerdown",n=>{if(n.evt.button!==0||this.$inputData.get().type!=="visual")return;const o=this.manager.stage.konva.stage.getPointerPosition();o&&(this.$bboxDragStart.set({x:o.x,y:o.y}),this.$isBboxDragging.set(!1),n.cancelBubble=!0)}),this.konva.bboxTransformer.on("pointerdown",n=>{n.evt.button===0&&(n.cancelBubble=!0)}),this.konva.maskGroup.add(this.konva.compositingRect)}syncCursorStyle=()=>{this.$isProcessing.get()?this.manager.stage.setCursor("wait"):this.$isSegmenting.get()&&this.manager.stage.setCursor("crosshair")};createPoint(t,n){const s=ee("sam_point"),i=KL(t),o=new Ae.Circle({name:this.KONVA_CIRCLE_NAME,x:i.x,y:i.y,radius:this.manager.stage.unscale(this.config.SAM_POINT_RADIUS),fill:Bo(this.getSAMPointColor(n)),stroke:Bo(this.config.SAM_POINT_BORDER_COLOR),strokeWidth:this.manager.stage.unscale(this.config.SAM_POINT_BORDER_WIDTH),draggable:!0,perfectDrawEnabled:!0,opacity:.6,dragDistance:3});return o.on("pointerup",r=>{if(this.$isDraggingPoint.get()||r.evt.button!==0)return;r.cancelBubble=!0,o.destroy();const l=this.$inputData.get();if(l.type!=="visual")return;const c=l.points.filter(d=>d.id!==s);this.$inputData.set({...l,points:c})}),o.on("dragstart",()=>{this.$isDraggingPoint.set(!0)}),o.on("dragend",()=>{const r=KL(o.position());this.log.trace({...r,label:Jk[n]},"Moved SAM point"),this.$isDraggingPoint.set(!1);const l=this.$inputData.get();if(l.type!=="visual")return;const c=l.points.map(d=>d.id===s?{...d,coord:r}:d);this.$inputData.set({...l,points:c})}),this.konva.pointGroup.add(o),this.log.trace({...i,label:Jk[n]},"Created SAM point"),{id:s,coord:i,label:n,konva:{circle:o}}}syncPointScales=()=>{const t=this.$inputData.get();if(t.type!=="visual")return;const n=this.manager.stage.unscale(this.config.SAM_POINT_RADIUS),s=this.manager.stage.unscale(this.config.SAM_POINT_BORDER_WIDTH);for(const i of t.points)i.konva.circle.radius(n),i.konva.circle.strokeWidth(s)};syncBboxVisibility=()=>{const t=this.$inputData.get();t.type==="visual"&&(t.bbox?(this.konva.bboxRect.setAttrs({x:t.bbox.x,y:t.bbox.y,width:t.bbox.width,height:t.bbox.height,visible:!0,listening:!0}),this.konva.bboxTransformer.visible(!0)):(this.konva.bboxRect.visible(!1),this.konva.bboxTransformer.visible(!1)))};onStagePointerDown=t=>{if(this.$inputData.get().type!=="visual"||t.evt.button!==0||t.target!==this.manager.stage.konva.stage||this.manager.stage.getIsDragging()||this.$isProcessing.get())return;const s=this.manager.tool.$cursorPos.get();if(!s)return;const i=this.parent.transformer.$pixelRect.get(),o=Dp(this.parent.state.position,i),r=ba(s.relative,o);this.$isBboxDrawing.set(!0),this.$bboxStartCoord.set(r)};onStagePointerMove=()=>{if(this.$inputData.get().type!=="visual"||!this.$isBboxDrawing.get())return;const n=this.$bboxStartCoord.get();if(!n)return;const s=this.manager.tool.$cursorPos.get();if(!s)return;const i=this.parent.transformer.$pixelRect.get(),o=Dp(this.parent.state.position,i),r=ba(s.relative,o),l=Math.min(n.x,r.x),c=Math.min(n.y,r.y),d=Math.abs(r.x-n.x),u=Math.abs(r.y-n.y);(d>5||u>5)&&(this.konva.bboxTransformer.visible(!1),this.konva.bboxRect.setAttrs({x:l,y:c,width:d,height:u,visible:!0,listening:!1}))};onStagePointerUp=t=>{const n=this.$inputData.get();if(n.type==="visual"){if(t.evt.button!==0)return;if(this.$isBboxDrawing.get()){const s=this.$bboxStartCoord.get(),i=this.manager.tool.$cursorPos.get();if(!i||!s){this.$isBboxDrawing.set(!1),this.$bboxStartCoord.set(null);return}this.$isBboxDrawing.set(!1),this.$bboxStartCoord.set(null);const o=this.parent.transformer.$pixelRect.get(),r=Dp(this.parent.state.position,o),l=ba(i.relative,r),c=Math.abs(l.x-s.x),d=Math.abs(l.y-s.y);if(c>5||d>5){const u=this.konva.bboxRect.x(),p=this.konva.bboxRect.y(),m=Math.max(1,this.konva.bboxRect.width()*this.konva.bboxRect.scaleX()),f=Math.max(1,this.konva.bboxRect.height()*this.konva.bboxRect.scaleY());this.konva.bboxRect.setAttrs({width:m,height:f,scaleX:1,scaleY:1}),this.$inputData.set({...n,bbox:{x:u,y:p,width:m,height:f}}),this.konva.bboxTransformer.visible(!0),this.konva.bboxRect.listening(!0)}else{if(this.syncBboxVisibility(),this.manager.stage.getIsDragging()||this.$isDraggingPoint.get()||this.$isProcessing.get()||!s)return;const u=this.createPoint(s,this.getPointType(t)),p=[...n.points,u];this.$inputData.set({...n,points:p}),this.syncBboxVisibility()}return}return}};onBboxDragMove=()=>{const t=this.$bboxDragStart.get();if(!t)return;if(this.manager.stage.getIsDragging()){this.$bboxDragStart.set(null),this.$isBboxDragging.set(!1);return}if(this.$isBboxDragging.get())return;const s=this.manager.stage.konva.stage.getPointerPosition();if(!s)return;const i=Math.abs(s.x-t.x),o=Math.abs(s.y-t.y);Math.sqrt(i*i+o*o)>5&&(this.$isBboxDragging.set(!0),this.konva.bboxRect.draggable(!0),this.konva.bboxRect.startDrag())};getPointType=t=>{let n=this.$pointType.get();return t.evt.shiftKey&&(n=n===1?-1:1),n};onBboxDragEnd=t=>{if(!(t.evt.button!==0||!this.$bboxDragStart.get())){if(this.$bboxDragStart.set(null),this.$isBboxDragging.get()){this.konva.bboxRect.draggable(!1);const s=this.$inputData.get();if(s.type==="visual"){const i=this.konva.bboxRect.x(),o=this.konva.bboxRect.y(),r=this.konva.bboxRect.width(),l=this.konva.bboxRect.height();this.$inputData.set({...s,bbox:{x:i,y:o,width:r,height:l}})}}else{const s=this.manager.stage.konva.stage,i=s.getPointerPosition();if(i){const r=s.getAbsoluteTransform().copy().invert().point(i),l=this.parent.transformer.$pixelRect.get(),c=Dp(this.parent.state.position,l),d=ba(r,c),u=this.$inputData.get();if(u.type==="visual"){const p=this.createPoint(d,this.getPointType(t)),m=[...u.points,p];this.$inputData.set({...u,points:m})}}}this.$isBboxDragging.set(!1)}};subscribe=()=>{this.manager.stage.konva.stage.on("pointerdown",this.onStagePointerDown),this.manager.stage.konva.stage.on("pointermove",this.onStagePointerMove),this.manager.stage.konva.stage.on("pointerup",this.onStagePointerUp),this.manager.stage.konva.stage.on("pointermove",this.onBboxDragMove),this.manager.stage.konva.stage.on("pointerup",this.onBboxDragEnd),this.subscriptions.add(()=>{this.manager.stage.konva.stage.off("pointerdown",this.onStagePointerDown),this.manager.stage.konva.stage.off("pointermove",this.onStagePointerMove),this.manager.stage.konva.stage.off("pointerup",this.onStagePointerUp),this.manager.stage.konva.stage.off("pointermove",this.onBboxDragMove),this.manager.stage.konva.stage.off("pointerup",this.onBboxDragEnd)}),this.subscriptions.add(this.$isProcessing.listen(t=>{this.syncCursorStyle(),this.parent.konva.layer.listening(!t)})),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((t,n)=>{qw(t)||t.scale!==n.scale&&this.syncPointScales()})),this.subscriptions.add(this.$inputData.listen(t=>{if(this.syncBboxVisibility(),!Ou(t)){this.resetEphemeralState();return}this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.$invert.listen(()=>{if(!Ou(this.$inputData.get())){this.resetEphemeralState();return}this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.$model.listen(()=>{if(!Ou(this.$inputData.get())){this.resetEphemeralState();return}this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Ky,t=>{if(!Ou(this.$inputData.get())){this.resetEphemeralState();return}t&&this.process()}))};unsubscribe=()=>{this.subscriptions.forEach(t=>t()),this.subscriptions.clear()};start=()=>{const t=this.manager.stateApi.$segmentingAdapter.get();if(t){this.log.error(`Already segmenting an entity: ${t.id}`);return}this.log.trace("Starting segment anything"),this.resetEphemeralState(),this.$isSegmenting.set(!0);const n=this.parent.transformer.$pixelRect.get(),s=Dp(this.parent.state.position,n);this.konva.group.setAttrs(s),this.parent.konva.layer.add(this.konva.group),this.parent.konva.layer.listening(!0),this.subscribe(),this.manager.stateApi.$segmentingAdapter.set(this.parent),this.syncCursorStyle()};processImmediate=async()=>{if(!this.$isSegmenting.get()){this.log.warn("Cannot process segmentation when not initialized");return}if(this.$isProcessing.get()){this.log.warn("Already processing");return}const t=this.$inputData.get(),n=this.$invert.get(),s=this.$model.get();if(!Ou(t)){this.log.trace("No points to segment and no prompt provided");return}const i=Gc({inputData:S$(t),invert:n,model:s});if(i===this.$lastProcessedHash.get()){this.log.trace("Already processed inputs");return}this.$isProcessing.set(!0),this.log.trace({inputData:S$(t),invert:n,model:s},"Segmenting");const o=this.parent.transformer.getRelativeRect(),r=await Kn(()=>this.parent.renderer.rasterize({rect:o,attrs:{filters:[],opacity:1}}));if(r.isErr()){pe({status:"error",title:"Failed to select object"}),this.log.error({error:cn(r.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}const l=new AbortController;this.abortController=l;const{graph:c,outputNodeId:d}=Sk.buildGraph(r.value,t,n,s),u=await Kn(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:c,outputNodeId:d,options:{prepend:!0,signal:l.signal}}));if(u.isErr()){this.log.error({error:cn(u.error)},"Error segmenting"),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null;return}this.log.trace({imageDTO:u.value},"Segmented");const p=_o(u.value);this.$imageState.set(p),this.imageModule&&this.imageModule.destroy(),this.konva.maskTween&&(this.konva.maskTween.destroy(),this.konva.maskTween=null),this.imageModule=new Ud(p,this),await this.imageModule.update(p,!0),this.konva.compositingRect.setAttrs({width:p.image.width,height:p.image.height,visible:!0}),this.konva.maskGroup.add(this.imageModule.konva.group),this.konva.compositingRect.moveToTop(),this.konva.maskGroup.cache(),this.konva.maskTween=new Ae.Tween({node:this.konva.maskGroup,duration:1,opacity:.4,yoyo:!0,repeat:1/0,easing:Ae.Easings.EaseOut}),this.konva.maskTween.play(),this.$lastProcessedHash.set(i),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null};process=pr(this.processImmediate,this.config.PROCESS_DEBOUNCE_MS);apply=()=>{const t=this.$imageState.get();if(!t){this.log.error("No image state to apply");return}this.log.trace("Applying");const n=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:t,position:{x:Math.round(n.x),y:Math.round(n.y)},replaceObjects:!0}),this.teardown()};saveAs=t=>{const n=this.$imageState.get();if(!n){this.log.error("No image state to save as");return}this.log.trace(`Saving as ${t}`),this.imageModule&&this.parent.renderer.adoptObjectRenderer(this.imageModule);const s=this.parent.transformer.getRelativeRect(),i={overrides:{objects:[n],position:{x:Math.round(s.x),y:Math.round(s.y)}},isSelected:!0};switch(t){case"raster_layer":this.manager.stateApi.addRasterLayer(i);break;case"control_layer":this.manager.stateApi.addControlLayer(i);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(i);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(i);break;default:ae(!1)}};reset=()=>{this.log.trace("Resetting"),this.resetEphemeralState()};setInputType=t=>{this.$inputData.get().type!==t&&(this.reset(),t==="prompt"?this.$inputData.set({type:"prompt",prompt:""}):(this.$inputData.set({type:"visual",points:[],bbox:null}),this.konva.bboxRect.visible(!1),this.konva.bboxTransformer.visible(!1)))};cancel=()=>{this.log.trace("Canceling"),this.teardown()};teardown=()=>{this.unsubscribe(),this.konva.group.remove(),this.resetEphemeralState(),this.$isSegmenting.set(!1),this.manager.stateApi.$segmentingAdapter.set(null)};resetEphemeralState=()=>{this.abortController?.abort(),this.abortController=null;const t=this.$inputData.get();if(t.type==="visual"){for(const n of t.points)n.konva.circle.destroy();this.konva.bboxRect.visible(!1),this.konva.bboxRect.draggable(!1),this.konva.bboxTransformer.visible(!1),this.$isBboxDrawing.set(!1),this.$bboxStartCoord.set(null),this.$bboxDragStart.set(null),this.$isBboxDragging.set(!1)}this.imageModule&&this.imageModule.konva.group.parent===this.konva.group&&(this.imageModule.destroy(),this.imageModule=null),this.konva.maskTween&&(this.konva.maskTween.destroy(),this.konva.maskTween=null),Ou(this.$inputData.get())&&this.$inputData.set({type:"visual",points:[],bbox:null}),this.$imageState.set(null),this.$pointType.set(1),this.$invert.set(!1),this.$lastProcessedHash.set(""),this.$isProcessing.set(!1),this.konva.compositingRect.visible(!1),this.konva.maskGroup.clearCache()};static buildGraph=({image_name:t},n,s,i)=>{const o=new hn(ee("canvas_segment_anything")),r=o.addNode({id:ee("image_primitive"),type:"image",image:{image_name:t}});let l,c;n.type==="visual"&&(n.points.length>0&&(l=[{points:bue(n).map(({x:p,y:m,label:f})=>({x:p,y:m,label:f}))}]),n.bbox&&(c=[{x_min:Math.round(n.bbox.x),y_min:Math.round(n.bbox.y),x_max:Math.round(n.bbox.x+n.bbox.width),y_max:Math.round(n.bbox.y+n.bbox.height)}]));const d=o.addNode({id:ee("segment_anything"),type:"segment_anything",model:i==="SAM1"?"segment-anything-huge":"segment-anything-2-large",point_lists:l,bounding_boxes:c,mask_filter:"largest",apply_polygon_refinement:!1});if(o.addEdge(r,"image",d,"image"),n.type==="prompt"){const p=o.addNode({id:ee("grounding_dino"),type:"grounding_dino",model:"grounding-dino-base",prompt:n.prompt});o.addEdge(r,"image",p,"image"),o.addEdge(p,"collection",d,"bounding_boxes")}const u=o.addNode({id:ee("apply_tensor_mask_to_image"),type:"apply_tensor_mask_to_image",image:{image_name:t},invert:s});return o.addEdge(d,"mask",u,"mask"),{graph:o,outputNodeId:u.id}};getSAMPointColor(t){return t===0?this.config.SAM_POINT_NEUTRAL_COLOR:t===1?this.config.SAM_POINT_FOREGROUND_COLOR:this.config.SAM_POINT_BACKGROUND_COLOR}repr=()=>{const t=this.$inputData.get();let n;return t.type==="prompt"?n={type:"prompt",prompt:t.prompt}:n={type:"visual",points:t.points.map(({id:s,konva:i,label:o})=>({id:s,label:o,circle:Ai(i.circle)})),bbox:t.bbox||null},{id:this.id,type:this.type,path:this.path,parent:this.parent.id,inputData:n,imageState:It(this.$imageState.get()),imageModule:this.imageModule?.repr()??null,config:It(this.config),$isSegmenting:this.$isSegmenting.get(),$lastProcessedHash:this.$lastProcessedHash.get(),$isProcessing:this.$isProcessing.get(),$pointType:this.$pointType.get(),$pointTypeString:this.$pointTypeString.get(),$isDraggingPoint:this.$isDraggingPoint.get(),konva:{group:Ai(this.konva.group),compositingRect:Ai(this.konva.compositingRect),maskGroup:Ai(this.konva.maskGroup),pointGroup:Ai(this.konva.pointGroup)}}};destroy=()=>{this.log.debug("Destroying module"),this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.unsubscribe(),this.konva.group.destroy()}}class Fst extends eg{renderer;bufferRenderer;transformer;filterer;segmentAnything;constructor(t,n){super(t,n,"control_layer_adapter"),this.renderer=new _k(this),this.bufferRenderer=new wk(this),this.transformer=new Hh(this),this.filterer=new yue(this),this.segmentAnything=new Sk(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}sync=async(t,n)=>{if(!t){this.destroy();return}this.state=t,!(n&&n===this.state)&&((!n||this.state.isEnabled!==n.isEnabled)&&this.syncIsEnabled(),(!n||this.state.isLocked!==n.isLocked)&&this.syncIsLocked(),(!n||this.state.objects!==n.objects)&&await this.syncObjects(),(!n||this.state.position!==n.position)&&this.syncPosition(),(!n||this.state.opacity!==n.opacity)&&this.syncOpacity(),(!n||this.state.withTransparencyEffect!==n.withTransparencyEffect)&&this.renderer.updateTransparencyEffect())};syncTransparencyEffect=()=>{this.renderer.updateTransparencyEffect()};getCanvas=t=>{this.log.trace({rect:t},"Getting canvas");const n={opacity:this.state.opacity};return this.renderer.getCanvas({rect:t,attrs:n})};getHashableState=()=>{const t=["name","controlAdapter","withTransparencyEffect","isLocked"];return zc(this.state,t)}}class Bst extends eg{renderer;bufferRenderer;transformer;filterer=void 0;segmentAnything=void 0;constructor(t,n){super(t,n,"inpaint_mask_adapter"),this.renderer=new _k(this),this.bufferRenderer=new wk(this),this.transformer=new Hh(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}sync=async(t,n)=>{if(!t){this.destroy();return}this.state=t,!(n&&n===this.state)&&((!n||this.state.isEnabled!==n.isEnabled)&&this.syncIsEnabled(),(!n||this.state.isLocked!==n.isLocked)&&this.syncIsLocked(),(!n||this.state.objects!==n.objects)&&await this.syncObjects(),(!n||this.state.position!==n.position)&&this.syncPosition(),(!n||this.state.opacity!==n.opacity)&&this.syncOpacity(),(!n||this.state.fill!==n.fill)&&this.renderer.updateCompositingRectFill(!0),(!n||this.state.objects!==n.objects)&&(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))};getHashableState=()=>{const t=["fill","name","opacity","isLocked"];return zc(this.state,t)};getCanvas=t=>{const n={opacity:1,filters:[]};return this.renderer.getCanvas({rect:t,attrs:n})}}class zst extends eg{renderer;bufferRenderer;transformer;filterer;segmentAnything;constructor(t,n){super(t,n,"raster_layer_adapter"),this.renderer=new _k(this),this.bufferRenderer=new wk(this),this.transformer=new Hh(this),this.filterer=new yue(this),this.segmentAnything=new Sk(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}sync=async(t,n)=>{if(!t){this.destroy();return}this.state=t,!(n&&n===this.state)&&((!n||this.state.isEnabled!==n.isEnabled)&&this.syncIsEnabled(),(!n||this.state.isLocked!==n.isLocked)&&this.syncIsLocked(),(!n||this.state.objects!==n.objects)&&await this.syncObjects(),(!n||this.state.position!==n.position)&&this.syncPosition(),(!n||this.state.opacity!==n.opacity)&&this.syncOpacity(),(!n||this.haveAdjustmentsChanged(n,this.state))&&this.syncAdjustmentsFilter())};getCanvas=t=>{this.log.trace({rect:t},"Getting canvas");const n={opacity:this.state.opacity};return this.renderer.getCanvas({rect:t,attrs:n})};getHashableState=()=>{const t=["name","isLocked"];return zc(this.state,t)};syncAdjustmentsFilter=()=>{const t=this.state.adjustments,n=!!t&&t.enabled,s=this.renderer.konva.objectGroup;if(n){let o=(s.filters()??[]).filter(r=>r!==rA&&r!==lA);if(t.mode==="simple")s.setAttr("adjustmentsSimple",t.simple),s.setAttr("adjustmentsCurves",null),o=[...o,rA];else{const r=Gx(t.curves.master),l=Gx(t.curves.r),c=Gx(t.curves.g),d=Gx(t.curves.b);s.setAttr("adjustmentsCurves",{master:r,r:l,g:c,b:d}),s.setAttr("adjustmentsSimple",null),o=[...o,lA]}s.filters(o),this._throttledCacheRefresh()}else{const i=(s.filters()??[]).filter(o=>o!==rA&&o!==lA);s.filters(i),s.setAttr("adjustmentsSimple",null),s.setAttr("adjustmentsCurves",null),this._throttledCacheRefresh()}};_throttledCacheRefresh=rP(()=>this.renderer.syncKonvaCache(!0),50);haveAdjustmentsChanged=(t,n)=>{const s=t.adjustments,i=n.adjustments;if(s===i)return!1;if(!s||!i||s.enabled!==i.enabled||s.mode!==i.mode)return!0;const o=s.simple,r=i.simple;if(o.brightness!==r.brightness||o.contrast!==r.contrast||o.saturation!==r.saturation||o.temperature!==r.temperature||o.tint!==r.tint||o.sharpness!==r.sharpness)return!0;const l=s.curves,c=i.curves;return l!==c}}class Vst extends eg{renderer;bufferRenderer;transformer;filterer=void 0;segmentAnything=void 0;constructor(t,n){super(t,n,"regional_guidance_adapter"),this.renderer=new _k(this),this.bufferRenderer=new wk(this),this.transformer=new Hh(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}sync=async(t,n)=>{if(!t){this.destroy();return}this.state=t,!(n&&n===this.state)&&((!n||this.state.isEnabled!==n.isEnabled)&&this.syncIsEnabled(),(!n||this.state.isLocked!==n.isLocked)&&this.syncIsLocked(),(!n||this.state.objects!==n.objects)&&await this.syncObjects(),(!n||this.state.position!==n.position)&&this.syncPosition(),(!n||this.state.opacity!==n.opacity)&&this.syncOpacity(),(!n||this.state.fill!==n.fill)&&this.renderer.updateCompositingRectFill(!0),(!n||this.state.objects!==n.objects)&&(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))};getHashableState=()=>{const t=["fill","name","opacity","isLocked","autoNegative","positivePrompt","negativePrompt","referenceImages"];return zc(this.state,t)};getCanvas=t=>{const n={opacity:1,filters:[]};return this.renderer.getCanvas({rect:t,attrs:n})}}class $st extends Tn{type="entity_renderer";id;path;log;parent;manager;subscriptions=new Set;constructor(t){super(),this.id=ee("canvas_renderer"),this.parent=t,this.manager=t,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(ZL,this.createNewRasterLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(XL,this.createNewControlLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(YL,this.createNewInpaintMasks)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(QL,this.createNewRegionalGuidance)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(rt,this.arrangeEntities))}initialize=()=>{this.log.debug("Initializing module"),this.createNewRasterLayers(this.manager.stateApi.runSelector(ZL)),this.createNewControlLayers(this.manager.stateApi.runSelector(XL)),this.createNewRegionalGuidance(this.manager.stateApi.runSelector(QL)),this.createNewInpaintMasks(this.manager.stateApi.runSelector(YL)),this.arrangeEntities(this.manager.stateApi.runSelector(rt),null)};createNewRasterLayers=t=>{for(const n of t)this.manager.adapters.rasterLayers.has(n.id)||this.manager.createAdapter(xa(n)).initialize()};createNewControlLayers=t=>{for(const n of t)this.manager.adapters.controlLayers.has(n.id)||this.manager.createAdapter(xa(n)).initialize()};createNewRegionalGuidance=t=>{for(const n of t)this.manager.adapters.regionMasks.has(n.id)||this.manager.createAdapter(xa(n)).initialize()};createNewInpaintMasks=t=>{for(const n of t)this.manager.adapters.inpaintMasks.has(n.id)||this.manager.createAdapter(xa(n)).initialize()};arrangeEntities=(t,n)=>{if(!n||t.rasterLayers.entities!==n.rasterLayers.entities||t.controlLayers.entities!==n.controlLayers.entities||t.regionalGuidance.entities!==n.regionalGuidance.entities||t.inpaintMasks.entities!==n.inpaintMasks.entities||t.selectedEntityIdentifier?.id!==n.selectedEntityIdentifier?.id){this.log.trace("Arranging entities");let s=0;this.manager.background.konva.layer.zIndex(s++);for(const{id:i}of this.manager.stateApi.getRasterLayersState().entities)this.manager.adapters.rasterLayers.get(i)?.konva.layer.zIndex(s++);for(const{id:i}of this.manager.stateApi.getControlLayersState().entities)this.manager.adapters.controlLayers.get(i)?.konva.layer.zIndex(s++);for(const{id:i}of this.manager.stateApi.getRegionsState().entities)this.manager.adapters.regionMasks.get(i)?.konva.layer.zIndex(s++);for(const{id:i}of this.manager.stateApi.getInpaintMasksState().entities)this.manager.adapters.inpaintMasks.get(i)?.konva.layer.zIndex(s++);this.manager.konva.previewLayer.zIndex(s++)}};destroy=()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear()}}const Gst={MIN_SCALE:.1,MAX_SCALE:20,SCALE_FACTOR:.999,FIT_LAYERS_TO_STAGE_PADDING_PX:48,SCALE_SNAP_POINTS:[.25,.5,.75,1,1.5,2,3,4,5],SCALE_SNAP_TOLERANCE:.02};class Hst extends Tn{type="stage";id;path;parent;manager;log;_intendedScale=1;_activeSnapPoint=null;_snapTimeout=null;_lastScrollEventTimestamp=null;container;konva;config=Gst;$stageAttrs=De({x:0,y:0,width:0,height:0,scale:0});$scale=Ut(this.$stageAttrs,t=>t.scale);subscriptions=new Set;resizeObserver=null;constructor(t,n){super(),this.id=ee("stage"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.container=t,this.konva={stage:new Ae.Stage({id:ee("konva_stage"),container:t})},this._intendedScale=this.konva.stage.scaleX()}setContainer=t=>{this.container=t,this.konva.stage.container(t),this.setResizeObserver()};setResizeObserver=()=>{this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(this.fitStageToContainer),this.resizeObserver.observe(this.container)};initialize=()=>{this.log.debug("Initializing module"),this.container.style.touchAction="none",this.container.style.userSelect="none",this.container.style.webkitUserSelect="none",this.konva.stage.container(this.container),this.setResizeObserver(),this.fitStageToContainer(),this.konva.stage.on("wheel",this.onStageMouseWheel),this.konva.stage.on("dragmove",this.onStageDragMove),this.konva.stage.on("dragend",this.onStageDragEnd),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.konva.stage.on("pointerup",this.onStagePointerUp),this.subscriptions.add(()=>this.konva.stage.off("wheel",this.onStageMouseWheel)),this.subscriptions.add(()=>this.konva.stage.off("dragmove",this.onStageDragMove)),this.subscriptions.add(()=>this.konva.stage.off("dragend",this.onStageDragEnd)),this.subscriptions.add(this.manager.tool.$tool.listen(this.stopDragging))};fitStageToContainer=()=>{this.log.trace("Fitting stage to container");const t=this.konva.stage.container().offsetWidth,n=this.konva.stage.container().offsetHeight;t===0||n===0||((this.konva.stage.width()===0||this.konva.stage.height()===0)&&this.fitLayersToStage({animate:!1,targetWidth:t,targetHeight:n}),this.konva.stage.width(t),this.konva.stage.height(n),this.syncStageAttrs())};fitBboxToStage=t=>{const{rect:n}=this.manager.stateApi.getBbox();this.log.trace({rect:n},"Fitting bbox to stage"),this.fitRect(n,t)};fitLayersToStage=t=>{const n=this.manager.compositor.getVisibleRectOfType();n.width===0||n.height===0?this.fitBboxToStage(t):(this.log.trace({rect:n},"Fitting layers to stage"),this.fitRect(n,t))};fitBboxAndLayersToStage=t=>{const n=this.manager.compositor.getVisibleRectOfType(),s=this.manager.stateApi.getBbox().rect,i=YA(n,s);this.log.trace({bboxRect:s,layersRect:n,unionRect:i},"Fitting bbox and layers to stage"),this.fitRect(i,t)};fitRect=(t,n)=>{const s=this.getSize(),{animate:i,targetWidth:o,targetHeight:r}={animate:!0,targetWidth:s.width,targetHeight:s.height,...n};if(o===0||r===0)return;const l=o-this.config.FIT_LAYERS_TO_STAGE_PADDING_PX*2,c=r-this.config.FIT_LAYERS_TO_STAGE_PADDING_PX*2,d=this.constrainScale(Math.min(Math.min(l/t.width,c/t.height),1)),u=Math.floor(-t.x*d+this.config.FIT_LAYERS_TO_STAGE_PADDING_PX+(l-t.width*d)/2),p=Math.floor(-t.y*d+this.config.FIT_LAYERS_TO_STAGE_PADDING_PX+(c-t.height*d)/2);if(this._intendedScale=d,this._activeSnapPoint=null,i){const m=new Ae.Tween({node:this.konva.stage,duration:.15,x:u,y:p,scaleX:d,scaleY:d,easing:Ae.Easings.EaseInOut,onUpdate:()=>{this.syncStageAttrs()},onFinish:()=>{this.syncStageAttrs(),m.destroy()}});m.play()}else this.konva.stage.setAttrs({x:u,y:p,scaleX:d,scaleY:d}),this.syncStageAttrs()};getCenter=(t=!1)=>{const n=this.getScale(),{x:s,y:i}=this.getPosition(),{width:o,height:r}=this.getSize(),l={x:(o/2-s)/n,y:(r/2-i)/n};return t?this.konva.stage.getAbsoluteTransform().point(l):l};constrainScale=t=>fi(t,this.config.MIN_SCALE,this.config.MAX_SCALE);setScale=(t,n)=>{this.log.trace({scale:t},"Programmatically setting scale");const s=this.constrainScale(t);this._intendedScale=s,this._activeSnapPoint=null,this._applyScale(s,n)};_applyScale=(t,n)=>{const s=this.getScale(),i=n??this.getCenter(!0),{x:o,y:r}=this.getPosition(),l=(i.x-o)/s,c=(i.y-r)/s,d=i.x-l*t,u=i.y-c*t;this.konva.stage.setAttrs({x:d,y:u,scaleX:t,scaleY:t}),this.syncStageAttrs()};onStageMouseWheel=t=>{if(t.evt.preventDefault(),this._snapTimeout!==null&&window.clearTimeout(this._snapTimeout),t.evt.ctrlKey||t.evt.metaKey)return;const n=this.konva.stage.getPointerPosition();if(!n)return;const s=t.evt.ctrlKey?-t.evt.deltaY:t.evt.deltaY,i=window.performance.now(),o=this._lastScrollEventTimestamp===null?1/0:i-this._lastScrollEventTimestamp;this._lastScrollEventTimestamp=i;let r=this.config.SCALE_FACTOR;o>300?r=this.config.SCALE_FACTOR+(1-this.config.SCALE_FACTOR)/2:o<300&&(r=Math.min(this.config.SCALE_FACTOR+(1-this.config.SCALE_FACTOR)*(o/200),.9999));const l=s>0?r**Math.abs(s):(1/r)**Math.abs(s),c=this._intendedScale*l;this._intendedScale=this.constrainScale(c),this._updateScaleWithSnapping(n),this._snapTimeout=window.setTimeout(()=>{this._intendedScale=this.getScale()},300)};_updateScaleWithSnapping=t=>{if(this._activeSnapPoint!==null){const n=this._activeSnapPoint*this.config.SCALE_SNAP_TOLERANCE;Math.abs(this._intendedScale-this._activeSnapPoint)>n?(this._activeSnapPoint=null,this._applyScale(this._intendedScale,t)):this._intendedScale=this._activeSnapPoint;return}for(const n of this.config.SCALE_SNAP_POINTS){const s=n*this.config.SCALE_SNAP_TOLERANCE;if(Math.abs(this._intendedScale-n)<s){this._activeSnapPoint=n,this._applyScale(n,t);return}}this._applyScale(this._intendedScale,t)};onStagePointerDown=t=>{t.evt.button===1&&this.startDragging()};onStagePointerUp=t=>{t.evt.button===1&&this.stopDragging()};startDragging=()=>{this.setIsDraggable(!0),this.getIsDragging()||this.konva.stage.startDrag(),this.manager.tool.render()};stopDragging=()=>{this.setIsDraggable(this.manager.tool.$tool.get()==="view"),this.getIsDragging()&&this.konva.stage.stopDrag(),this.manager.tool.render()};onStageDragMove=t=>{t.target===this.konva.stage&&this.syncStageAttrs()};onStageDragEnd=t=>{t.target===this.konva.stage&&this.stopDragging()};getScale=()=>this.konva.stage.scaleX();getPosition=()=>this.konva.stage.position();getSize(){return this.konva.stage.size()}unscale=t=>t/this.getScale();setCursor=t=>{this.container.style.cursor!==t&&(this.container.style.cursor=t)};syncStageAttrs=t=>{this.$stageAttrs.set({x:this.konva.stage.x(),y:this.konva.stage.y(),width:this.konva.stage.width(),height:this.konva.stage.height(),scale:this.konva.stage.scaleX(),...t})};setIsDraggable=t=>{this.konva.stage.draggable(t)};getIsDragging=()=>this.konva.stage.isDragging();addLayer=t=>{this.konva.stage.add(t)};getScaledStageRect=(t=!0)=>{const{x:n,y:s}=this.getPosition(),{width:i,height:o}=this.getSize(),r=this.getScale();return{x:t?Math.floor(-n/r):-n/r,y:t?Math.floor(-s/r):-s/r,width:t?Math.ceil(i/r):i/r,height:t?Math.ceil(o/r):o/r}};repr=()=>({id:this.id,type:this.type,path:this.path,config:this.config,$stageAttrs:this.$stageAttrs.get(),konva:{stage:Ai(this.konva.stage)}});destroy=()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear(),this.resizeObserver&&this.resizeObserver.disconnect(),this.konva.stage.destroy()}}const Hx=12,Wst=4,Ust=1,qst=14.4,k$=192,I$=36;class Kst extends Tn{type="staging_area";id;path;parent;manager;log;subscriptions=new Set;konva;image;mutex=new H_;$imageSrc=De(null);$shouldShowStagedImage=De(!0);$isStaging=De(!1);$isPending=De(!1);constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=t,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ae.Group({name:`${this.type}:group`,listening:!1}),placeholder:{group:new Ae.Group({name:`${this.type}:placeholder_group`,listening:!1,visible:!1}),badgeBg:new Ae.Rect({name:`${this.type}:placeholder_badge_bg`,fill:"hsl(220 12% 10% / 0.8)",x:Hx,y:Hx,width:k$,height:I$,cornerRadius:Wst,stroke:"hsl(220 12% 50% / 1)",strokeWidth:Ust,listening:!1,perfectDrawEnabled:!1}),text:new Ae.Text({name:`${this.type}:placeholder_text`,fill:"hsl(220 12% 80% / 1)",x:Hx,y:Hx,width:k$,height:I$,align:"center",verticalAlign:"middle",fontFamily:'"Inter Variable", sans-serif',fontSize:qst,fontStyle:"600",text:"Waiting for Image",listening:!1,perfectDrawEnabled:!1})}},this.konva.placeholder.group.add(this.konva.placeholder.badgeBg),this.konva.placeholder.group.add(this.konva.placeholder.text),this.konva.group.add(this.konva.placeholder.group),this.image=null,this.subscriptions.add(this.$imageSrc.listen(this.render)),this.subscriptions.add(this.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.$isPending.listen(this.render)),this.subscriptions.add(this.$isStaging.listen(this.render)),this.subscriptions.add(this.$isStaging.listen((n,s)=>{n&&!s&&this.$shouldShowStagedImage.set(!0)}))}initialize=()=>{this.log.debug("Initializing module"),this.render()};connectToSession=(t,n)=>{const s=d=>{if(!d){this.$imageSrc.set(null);return}if(d.progressData.imageDTO){this.$imageSrc.set({type:"imageName",data:d.progressData.imageDTO.image_name});return}else if(d.progressData?.progressImage){this.$imageSrc.set({type:"dataURL",data:d.progressData.progressImage.dataURL});return}else this.$imageSrc.set(null)},i=rI([n],s),o=d=>{this.$isPending.set(d.some(u=>u.status==="pending"||u.status==="in_progress"))},r=rI([t],o),l=d=>{this.$isStaging.set(d.length>0)},c=rI([t],l);return l(t.get()),o(t.get()),s(n.get()),this.render(),()=>{this.$isStaging.set(!1),c(),this.$isPending.set(!1),r(),this.$imageSrc.set(null),i()}};_getImageFromSrc=({type:t,data:n},s,i)=>t==="imageName"?{image_name:n,width:s,height:i}:{dataURL:n,width:s,height:i};render=async()=>{const t=await this.mutex.acquire();try{this.log.trace("Rendering staging area");const{x:n,y:s,width:i,height:o}=this.manager.stateApi.getBbox().rect,r=this.$shouldShowStagedImage.get(),l=this.$isPending.get();this.konva.group.position({x:n,y:s});const c=this.$imageSrc.get();if(c){const d=this._getImageFromSrc(c,i,o),u=c.type==="imageName";this.image?this.image.isLoading||this.image.isError||(this.image.config.usePhysicalDimensions=u,await this.image.update({...this.image.state,image:d})):(this.image=new Ud({id:"staging-area-image",type:"image",image:d},this),this.image.config.usePhysicalDimensions=u,await this.image.update(this.image.state,!0),this.konva.group.add(this.image.konva.group)),this.konva.placeholder.group.visible(!1)}else this.image?.destroy(),this.image=null,this.konva.placeholder.group.visible(l);this.konva.group.visible(r&&this.$isStaging.get())}finally{t()}};getNodes=()=>[this.konva.group];destroy=()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear(),this.image&&this.image.destroy();for(const t of this.getNodes())t.destroy()};repr=()=>({id:this.id,type:this.type,path:this.path,$shouldShowStagedImage:this.$shouldShowStagedImage.get(),$isStaging:this.$isStaging.get(),image:this.image?.repr()??null})}const Zst=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],Xst=[];class Yst extends Tn{type="bbox";id;path;parent;manager;log;subscriptions=new Set;konva;$aspectRatioBuffer=De(1);$isBboxHidden=De(!1);constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=t.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating bbox module"),this.konva={group:new Ae.Group({name:`${this.type}:group`,listening:!1}),proxyRect:new Ae.Rect({name:`${this.type}:rect`,listening:!1,strokeEnabled:!0,draggable:!0,stroke:"rgb(42,42,42)",strokeWidth:1,strokeScaleEnabled:!1,perfectDrawEnabled:!1}),overlayGroup:new Ae.Group({name:`${this.type}:overlayGroup`,listening:!1,clipFunc:n=>{const s=this.manager.stage.getScaledStageRect(),i=this.manager.stateApi.runSelector(Pc).rect;n.beginPath(),n.moveTo(s.x,s.y),n.lineTo(s.x+s.width,s.y),n.lineTo(s.x+s.width,s.y+s.height),n.lineTo(s.x,s.y+s.height),n.closePath(),n.moveTo(i.x,i.y),n.lineTo(i.x,i.y+i.height),n.lineTo(i.x+i.width,i.y+i.height),n.lineTo(i.x+i.width,i.y),n.closePath()}}),overlayRect:new Ae.Rect({name:`${this.type}:overlay`,listening:!1,strokeEnabled:!1,draggable:!1,fill:"hsl(220 12% 10% / 0.8)",perfectDrawEnabled:!1}),transformer:new Ae.Transformer({listening:!1,name:`${this.type}:transformer`,borderDash:[5,5],borderStroke:"rgba(212,216,234,1)",borderEnabled:!0,borderStrokeWidth:1,rotateEnabled:!1,keepRatio:!1,ignoreStroke:!0,flipEnabled:!1,anchorFill:"rgba(212,216,234,1)",anchorStroke:"rgb(42,42,42)",anchorSize:12,anchorCornerRadius:3,shiftBehavior:"none",centeredScaling:!1,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc})},this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.proxyRect.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.konva.transformer.on("transform",this.onTransform),this.konva.transformer.on("transformend",this.onTransformEnd),this.subscriptions.add(()=>{this.konva.proxyRect.off("dragmove pointerenter pointerleave"),this.konva.transformer.off("transform transformend")}),this.konva.transformer.nodes([this.konva.proxyRect]),this.konva.overlayGroup.add(this.konva.overlayRect),this.konva.group.add(this.konva.overlayGroup),this.konva.group.add(this.konva.proxyRect),this.konva.group.add(this.konva.transformer),this.subscriptions.add(this.parent.$tool.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Pc,this.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncOverlay)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription($U,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Fy,this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render)),this.subscriptions.add(this.$isBboxHidden.listen(this.render))}syncCursorStyle=mK;initialize=()=>{this.log.debug("Initializing module");const{width:t,height:n}=this.manager.stateApi.runSelector(Pc).rect;this.$aspectRatioBuffer.set(t/n),this.render()};render=()=>{const t=this.manager.tool.$tool.get(),{x:n,y:s,width:i,height:o}=this.manager.stateApi.runSelector(Pc).rect;this.konva.group.visible(!this.$isBboxHidden.get()),this.konva.group.listening(t==="bbox"&&!this.manager.$isBusy.get()),this.konva.proxyRect.setAttrs({x:n,y:s,width:i,height:o,scaleX:1,scaleY:1,listening:t==="bbox"}),this.syncOverlay(),this.konva.transformer.setAttrs({listening:t==="bbox",enabledAnchors:this.getEnabledAnchors(t)})};getEnabledAnchors=t=>t!=="bbox"?Xst:Zst;syncOverlay=()=>{const t=this.manager.stateApi.getSettings().bboxOverlay;if(this.konva.overlayGroup.visible(t),!t)return;const n=this.manager.stage.$stageAttrs.get();qw(n)||this.konva.overlayRect.setAttrs({x:-n.x/n.scale,y:-n.y/n.scale,width:n.width/n.scale,height:n.height/n.scale})};onDragMove=()=>{const t=this.manager.stateApi.getPositionGridSize(),n=this.manager.stateApi.getBbox(),s={...n.rect,x:Ba(this.konva.proxyRect.x(),t),y:Ba(this.konva.proxyRect.y(),t)};this.konva.proxyRect.setAttrs(s),(n.rect.x!==s.x||n.rect.y!==s.y)&&this.manager.stateApi.setGenerationBbox(s)};onTransform=()=>{const t=this.konva.transformer.getActiveAnchor();if(!t)return;const n=this.manager.stateApi.$altKey.get(),s=this.manager.stateApi.$ctrlKey.get(),i=this.manager.stateApi.$metaKey.get(),o=this.manager.stateApi.$shiftKey.get();let r=s||i?this.manager.stateApi.getBboxGridSize():64;this.manager.stateApi.$altKey.get()&&(r=r*2);let l=this.konva.proxyRect.x(),c=this.konva.proxyRect.y(),d=Pb(this.konva.proxyRect.width()*this.konva.proxyRect.scaleX(),r),u=Pb(this.konva.proxyRect.height()*this.konva.proxyRect.scaleY(),r),p=!1;if(n?p=!1:this.manager.stateApi.getBbox().aspectRatio.isLocked?p=!o:p=o,p){let f=Math.sqrt(d*u*this.$aspectRatioBuffer.get()),g=f/this.$aspectRatioBuffer.get();f=Pb(f,r),g=Pb(g,r),t==="top-left"&&(l=l-(f-d),c=c-(g-u)),t==="top-right"&&(c=c-(g-u)),t==="bottom-left"&&(l=l-(f-d)),d=f,u=g}const m={x:Math.round(l),y:Math.round(c),width:d,height:u};this.konva.proxyRect.setAttrs({...m,scaleX:1,scaleY:1}),this.manager.stateApi.setGenerationBbox(m),p||this.$aspectRatioBuffer.set(m.width/m.height)};onTransformEnd=()=>{this.$aspectRatioBuffer.set(this.konva.proxyRect.width()/this.konva.proxyRect.height())};anchorStyleFunc=t=>{(t.hasName("top-center")||t.hasName("bottom-center"))&&(t.height(8),t.offsetY(4),t.width(30),t.offsetX(15)),(t.hasName("middle-left")||t.hasName("middle-right"))&&(t.height(30),t.offsetY(15),t.width(8),t.offsetX(4))};fitToLayers=()=>{const t=this.manager.compositor.getVisibleRectOfType();if(t.height===0||t.width===0)return;const n=this.manager.stateApi.getBboxGridSize(),s=GU(t,n);this.manager.stateApi.setGenerationBbox(s)};anchorDragBoundFunc=(t,n)=>{const s=this.konva.transformer.getStage();ae(s,"Stage must exist");const o=(this.manager.stateApi.$ctrlKey.get()||this.manager.stateApi.$metaKey.get()?this.manager.stateApi.getBboxGridSize():64)*s.scaleX(),r=s.getAbsolutePosition(),l=r.x%o,c=r.y%o;return{x:Ba(n.x,o)+l,y:Ba(n.y,o)+c}};repr=()=>({id:this.id,type:this.type,path:this.path,aspectRatioBuffer:this.$aspectRatioBuffer.get(),konva:{group:Ai(this.konva.group),proxyRect:Ai(this.konva.proxyRect),transformer:Ai(this.konva.transformer)}});destroy=()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear(),this.konva.group.destroy()};toggleBboxVisibility=()=>{this.$isBboxHidden.set(!this.$isBboxHidden.get())}}const Qst={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",HIDE_FILL_TIMEOUT_MS:1500};class Jst extends Tn{type="brush_tool";id;path;parent;manager;log;config=Qst;hideFillTimeoutId=null;konva;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ae.Group({name:`${this.type}:brush_group`,listening:!1}),fillCircle:new Ae.Circle({name:`${this.type}:brush_fill_circle`,listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1}),innerBorder:new Ae.Ring({name:`${this.type}:brush_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Ae.Ring({name:`${this.type}:brush_outer_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.fillCircle,this.konva.innerBorder,this.konva.outerBorder)}syncCursorStyle=()=>{this.manager.stage.setCursor("none")};render=()=>{if(this.parent.$tool.get()!=="brush"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const t=this.parent.$cursorPos.get();if(!t){this.setVisibility(!1);return}const n=this.parent.$isPrimaryPointerDown.get(),s=this.parent.$lastPointerType.get();if(s!=="mouse"&&n){this.setVisibility(!1);return}this.setVisibility(!0),this.hideFillTimeoutId!==null&&(window.clearTimeout(this.hideFillTimeoutId),this.hideFillTimeoutId=null);const i=this.manager.stateApi.getSettings(),o=this.manager.stateApi.getBrushPreviewColor(),r=kc(t.relative,i.brushWidth),l=i.brushWidth/2;this.konva.fillCircle.setAttrs({x:r.x,y:r.y,radius:l,fill:Bo(o),visible:!n&&s==="mouse"});const c=this.manager.stage.unscale(1),d=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:t.relative.x,y:t.relative.y,innerRadius:l,outerRadius:l+c}),this.konva.outerBorder.setAttrs({x:t.relative.x,y:t.relative.y,innerRadius:l+c,outerRadius:l+d}),this.hideFillTimeoutId=window.setTimeout(()=>{this.konva.fillCircle.visible(!1),this.hideFillTimeoutId=null},this.config.HIDE_FILL_TIMEOUT_MS)};setVisibility=t=>{this.konva.group.visible(t)};onStagePointerEnter=async t=>{const n=this.parent.$cursorPos.get(),s=this.parent.$isPrimaryPointerDown.get(),i=this.manager.stateApi.getSelectedEntityAdapter();if(!n||!s||!i)return;const o=this.manager.stateApi.getSettings(),r=ba(n.relative,i.state.position),l=kc(r,o.brushWidth);t.evt.pointerType==="pen"&&o.pressureSensitivity?await i.bufferRenderer.setBuffer({id:ee("brush_line_with_pressure"),type:"brush_line_with_pressure",points:[l.x,l.y,t.evt.pressure],strokeWidth:o.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(i.state)}):await i.bufferRenderer.setBuffer({id:ee("brush_line"),type:"brush_line",points:[l.x,l.y],strokeWidth:o.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(i.state)})};onStagePointerDown=async t=>{const n=this.parent.$cursorPos.get(),s=this.parent.$isPrimaryPointerDown.get(),i=this.manager.stateApi.getSelectedEntityAdapter();if(!n||!i||!s)return;i.bufferRenderer.hasBuffer()&&i.bufferRenderer.commitBuffer();const o=this.manager.stateApi.getSettings(),r=ba(n.relative,i.state.position),l=kc(r,o.brushWidth);if(t.evt.pointerType==="pen"&&o.pressureSensitivity){const c=HU(i.state.objects,"brush_line_with_pressure");let d,u=!1;t.evt.shiftKey&&c?(u=!0,d=[c.x,c.y,c.pressure,l.x,l.y,t.evt.pressure]):d=[l.x,l.y,t.evt.pressure],await i.bufferRenderer.setBuffer({id:ee("brush_line_with_pressure"),type:"brush_line_with_pressure",points:d,strokeWidth:o.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:u&&!o.clipToBbox?null:this.parent.getClip(i.state)})}else{const c=WU(i.state.objects,"brush_line");let d,u=!1;t.evt.shiftKey&&c?(u=!0,d=[c.x,c.y,l.x,l.y]):d=[l.x,l.y],await i.bufferRenderer.setBuffer({id:ee("brush_line"),type:"brush_line",points:d,strokeWidth:o.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:u&&!o.clipToBbox?null:this.parent.getClip(i.state)})}};onStagePointerUp=t=>{const n=this.manager.stateApi.getSelectedEntityAdapter();n&&((n.bufferRenderer.state?.type==="brush_line"||n.bufferRenderer.state?.type==="brush_line_with_pressure")&&n.bufferRenderer.hasBuffer()?n.bufferRenderer.commitBuffer():n.bufferRenderer.clearBuffer())};onStagePointerMove=async t=>{const n=this.parent.$cursorPos.get();if(!n||!this.parent.$isPrimaryPointerDown.get())return;const s=this.manager.stateApi.getSelectedEntityAdapter();if(!s)return;const i=s.bufferRenderer.state;if(!i||i.type!=="brush_line"&&i.type!=="brush_line_with_pressure")return;const o=this.manager.stateApi.getSettings(),r=UU(i.points),l=o.brushWidth*this.parent.config.BRUSH_SPACING_TARGET_SCALE;if(!r||!qU(n.relative,r,l))return;const c=ba(n.relative,s.state.position),d=kc(c,o.brushWidth);r.x===d.x&&r.y===d.y||(i.points.push(d.x,d.y),i.type==="brush_line_with_pressure"&&o.pressureSensitivity&&i.points.push(t.evt.pressure),await s.bufferRenderer.setBuffer(i))};repr=()=>({id:this.id,type:this.type,path:this.path,config:this.config});destroy=()=>{this.log.debug("Destroying module"),this.konva.group.destroy()}}const eit={RING_INNER_RADIUS:25,RING_OUTER_RADIUS:35,RING_BORDER_INNER_COLOR:"rgba(0,0,0,1)",RING_BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",CROSSHAIR_INNER_RADIUS:5,CROSSHAIR_LINE_THICKNESS:1.5,CROSSHAIR_LINE_BORDER_THICKNESS:.75,CROSSHAIR_LINE_LENGTH:10,CROSSHAIR_LINE_COLOR:"rgba(0,0,0,1)",CROSSHAIR_BORDER_COLOR:"rgba(255,255,255,0.8)",TEXT_COLOR:"rgba(255,255,255,1)",TEXT_BG_COLOR:"rgba(0,0,0,0.8)",TEXT_BG_HEIGHT:62,TEXT_BG_WIDTH:62,TEXT_BG_CORNER_RADIUS:7,TEXT_PADDING:8,TEXT_FONT_SIZE:12,TEXT_BG_X_OFFSET:7};class tit extends Tn{type="color_picker_tool";id;path;parent;manager;log;config=eit;$colorUnderCursor=De(KU);konva;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ae.Group({name:`${this.type}:color_picker_group`,listening:!1}),ringCandidateColor:new Ae.Ring({listening:!1,name:`${this.type}:color_picker_candidate_color_ring`,innerRadius:0,outerRadius:0,strokeEnabled:!1,perfectDrawEnabled:!1}),ringCurrentColor:new Ae.Arc({listening:!1,name:`${this.type}:color_picker_current_color_arc`,innerRadius:0,outerRadius:0,angle:180,strokeEnabled:!1,perfectDrawEnabled:!1}),ringInnerBorder:new Ae.Ring({listening:!1,name:`${this.type}:color_picker_inner_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),ringOuterBorder:new Ae.Ring({listening:!1,name:`${this.type}:color_picker_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),crosshairNorthInner:new Ae.Line({listening:!1,name:`${this.type}:color_picker_crosshair_north1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairNorthOuter:new Ae.Line({listening:!1,name:`${this.type}:color_picker_crosshair_north2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairEastInner:new Ae.Line({listening:!1,name:`${this.type}:color_picker_crosshair_east1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairEastOuter:new Ae.Line({listening:!1,name:`${this.type}:color_picker_crosshair_east2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairSouthInner:new Ae.Line({listening:!1,name:`${this.type}:color_picker_crosshair_south1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairSouthOuter:new Ae.Line({listening:!1,name:`${this.type}:color_picker_crosshair_south2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairWestInner:new Ae.Line({listening:!1,name:`${this.type}:color_picker_crosshair_west1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairWestOuter:new Ae.Line({listening:!1,name:`${this.type}:color_picker_crosshair_west2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),rgbaTextGroup:new Ae.Group({listening:!1,name:`${this.type}:color_picker_text_group`}),rgbaText:new Ae.Text({listening:!1,name:`${this.type}:color_picker_text`,fill:this.config.TEXT_COLOR,fontFamily:"monospace",align:"left",fontStyle:"bold",verticalAlign:"middle"}),rgbaTextBackground:new Ae.Rect({listening:!1,name:`${this.type}:color_picker_text_background`,fill:this.config.TEXT_BG_COLOR})},this.konva.rgbaTextGroup.add(this.konva.rgbaTextBackground,this.konva.rgbaText),this.konva.group.add(this.konva.ringCandidateColor,this.konva.ringCurrentColor,this.konva.ringInnerBorder,this.konva.ringOuterBorder,this.konva.crosshairNorthOuter,this.konva.crosshairNorthInner,this.konva.crosshairEastOuter,this.konva.crosshairEastInner,this.konva.crosshairSouthOuter,this.konva.crosshairSouthInner,this.konva.crosshairWestOuter,this.konva.crosshairWestInner,this.konva.rgbaTextGroup)}syncCursorStyle=()=>{this.manager.stage.setCursor("none")};getCanPick=()=>!this.manager.stage.getIsDragging();render=()=>{if(this.parent.$tool.get()!=="colorPicker"){this.setVisibility(!1);return}if(!this.getCanPick()){this.setVisibility(!1);return}const t=this.parent.$cursorPos.get();if(!t){this.setVisibility(!1);return}this.setVisibility(!0);const{x:n,y:s}=t.relative,i=this.manager.stateApi.getSettings(),o=this.$colorUnderCursor.get(),r=this.manager.stage.unscale(this.config.RING_INNER_RADIUS),l=this.manager.stage.unscale(this.config.RING_OUTER_RADIUS),c=this.manager.stage.unscale(1),d=this.manager.stage.unscale(2),u=i.activeColor==="bgColor"?i.bgColor:i.fgColor;this.konva.ringCandidateColor.setAttrs({x:n,y:s,fill:Eh(o),innerRadius:r,outerRadius:l}),this.konva.ringCurrentColor.setAttrs({x:n,y:s,fill:Eh(u),innerRadius:r,outerRadius:l}),this.konva.ringInnerBorder.setAttrs({x:n,y:s,innerRadius:l,outerRadius:l+c}),this.konva.ringOuterBorder.setAttrs({x:n,y:s,innerRadius:l+c,outerRadius:l+d});const p=this.manager.stage.unscale(this.config.TEXT_BG_WIDTH),m=this.manager.stage.unscale(this.config.TEXT_BG_HEIGHT);this.konva.rgbaTextBackground.setAttrs({width:p,height:m,cornerRadius:this.manager.stage.unscale(this.config.TEXT_BG_CORNER_RADIUS)}),this.konva.rgbaText.setAttrs({padding:this.manager.stage.unscale(this.config.TEXT_PADDING),fontSize:this.manager.stage.unscale(this.config.TEXT_FONT_SIZE),text:`R: ${o.r}
G: ${o.g}
B: ${o.b}
A: ${o.a}`}),this.konva.rgbaTextGroup.setAttrs({x:n+this.manager.stage.unscale(this.config.RING_OUTER_RADIUS+this.config.TEXT_BG_X_OFFSET),y:s-m/2});const f=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_LENGTH),g=this.manager.stage.unscale(this.config.CROSSHAIR_INNER_RADIUS),v=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS),b=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS+this.config.CROSSHAIR_LINE_BORDER_THICKNESS*2);this.konva.crosshairNorthOuter.setAttrs({strokeWidth:b,points:[n,s-f,n,s-g]}),this.konva.crosshairNorthInner.setAttrs({strokeWidth:v,points:[n,s-f,n,s-g]}),this.konva.crosshairEastOuter.setAttrs({strokeWidth:b,points:[n+g,s,n+f,s]}),this.konva.crosshairEastInner.setAttrs({strokeWidth:v,points:[n+g,s,n+f,s]}),this.konva.crosshairSouthOuter.setAttrs({strokeWidth:b,points:[n,s+g,n,s+f]}),this.konva.crosshairSouthInner.setAttrs({strokeWidth:v,points:[n,s+g,n,s+f]}),this.konva.crosshairWestOuter.setAttrs({strokeWidth:b,points:[n-g,s,n-f,s]}),this.konva.crosshairWestInner.setAttrs({strokeWidth:v,points:[n-g,s,n-f,s]})};setVisibility=t=>{this.konva.group.visible(t)};onStagePointerUp=t=>{if(!this.getCanPick()){this.setVisibility(!1);return}const{a:n,...s}=this.$colorUnderCursor.get();this.manager.stateApi.setColor(s)};onStagePointerMove=t=>{if(!this.getCanPick()){this.setVisibility(!1);return}this.syncColorUnderCursor()};syncColorUnderCursor=vue(()=>{const t=this.parent.$cursorPos.get();if(!t)return;this.manager.background.konva.layer.visible(!1);const n=twe(this.manager.stage.konva.stage,t.absolute);this.manager.background.konva.layer.visible(!0),n&&this.$colorUnderCursor.set(n)});repr=()=>({id:this.id,type:this.type,path:this.path,config:this.config,$colorUnderCursor:this.$colorUnderCursor.get()});destroy=()=>{this.log.debug("Destroying color picker tool preview module"),this.konva.group.destroy()}}const nit={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)"};class sit extends Tn{type="eraser_tool";id;path;parent;manager;log;config=nit;konva;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ae.Group({name:`${this.type}:eraser_group`,listening:!1}),cutoutCircle:new Ae.Circle({name:`${this.type}:eraser_cutout_circle`,listening:!1,strokeEnabled:!1,fill:"white",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1}),innerBorder:new Ae.Ring({name:`${this.type}:eraser_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Ae.Ring({listening:!1,name:`${this.type}:eraser_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.cutoutCircle,this.konva.innerBorder,this.konva.outerBorder)}syncCursorStyle=()=>{this.manager.stage.setCursor("none")};render=()=>{if(this.parent.$tool.get()!=="eraser"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const t=this.parent.$cursorPos.get();if(!t){this.setVisibility(!1);return}const n=this.parent.$isPrimaryPointerDown.get();if(this.parent.$lastPointerType.get()!=="mouse"&&n){this.setVisibility(!1);return}this.setVisibility(!0);const i=this.manager.stateApi.getSettings(),o=kc(t.relative,i.eraserWidth),r=i.eraserWidth/2;this.konva.cutoutCircle.setAttrs({x:o.x,y:o.y,radius:r});const l=this.manager.stage.unscale(1),c=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:t.relative.x,y:t.relative.y,innerRadius:r,outerRadius:r+l}),this.konva.outerBorder.setAttrs({x:t.relative.x,y:t.relative.y,innerRadius:r+l,outerRadius:r+c})};setVisibility=t=>{this.konva.group.visible(t)};onStagePointerEnter=async t=>{const n=this.parent.$cursorPos.get(),s=this.parent.$isPrimaryPointerDown.get(),i=this.manager.stateApi.getSelectedEntityAdapter();if(!n||!s||!i)return;const o=this.manager.stateApi.getSettings(),r=ba(n.relative,i.state.position),l=kc(r,o.brushWidth);t.evt.pointerType==="pen"&&o.pressureSensitivity?await i.bufferRenderer.setBuffer({id:ee("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:[l.x,l.y,t.evt.pressure],strokeWidth:o.eraserWidth,clip:this.parent.getClip(i.state)}):await i.bufferRenderer.setBuffer({id:ee("eraser_line"),type:"eraser_line",points:[l.x,l.y],strokeWidth:o.eraserWidth,clip:this.parent.getClip(i.state)})};onStagePointerDown=async t=>{const n=this.parent.$cursorPos.get(),s=this.parent.$isPrimaryPointerDown.get(),i=this.manager.stateApi.getSelectedEntityAdapter();if(!n||!i||!s)return;const o=this.manager.stateApi.getSettings(),r=ba(n.relative,i.state.position);if(t.evt.pointerType==="pen"&&o.pressureSensitivity){const l=HU(i.state.objects,"eraser_line_with_pressure"),c=kc(r,o.eraserWidth);i.bufferRenderer.hasBuffer()&&i.bufferRenderer.commitBuffer();let d;t.evt.shiftKey&&l?d=[l.x,l.y,l.pressure,c.x,c.y,t.evt.pressure]:d=[c.x,c.y,t.evt.pressure],await i.bufferRenderer.setBuffer({id:ee("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:d,strokeWidth:o.eraserWidth,clip:this.parent.getClip(i.state)})}else{const l=WU(i.state.objects,"eraser_line"),c=kc(r,o.eraserWidth);i.bufferRenderer.hasBuffer()&&i.bufferRenderer.commitBuffer();let d;t.evt.shiftKey&&l?d=[l.x,l.y,c.x,c.y]:d=[c.x,c.y],await i.bufferRenderer.setBuffer({id:ee("eraser_line"),type:"eraser_line",points:d,strokeWidth:o.eraserWidth,clip:this.parent.getClip(i.state)})}};onStagePointerUp=t=>{const n=this.manager.stateApi.getSelectedEntityAdapter();n&&((n.bufferRenderer.state?.type==="eraser_line"||n.bufferRenderer.state?.type==="eraser_line_with_pressure")&&n.bufferRenderer.hasBuffer()?n.bufferRenderer.commitBuffer():n.bufferRenderer.clearBuffer())};onStagePointerMove=async t=>{const n=this.parent.$cursorPos.get();if(!n||!this.parent.$isPrimaryPointerDown.get())return;const s=this.manager.stateApi.getSelectedEntityAdapter();if(!s)return;const i=s.bufferRenderer.state;if(!i||i.type!=="eraser_line"&&i.type!=="eraser_line_with_pressure")return;const o=this.manager.stateApi.getSettings(),r=UU(i.points),l=o.eraserWidth*this.parent.config.BRUSH_SPACING_TARGET_SCALE;if(!r||!qU(n.relative,r,l))return;const c=ba(n.relative,s.state.position),d=kc(c,o.eraserWidth);r.x===d.x&&r.y===d.y||(i.points.push(d.x,d.y),i.type==="eraser_line_with_pressure"&&o.pressureSensitivity&&i.points.push(t.evt.pressure),await s.bufferRenderer.setBuffer(i))};repr=()=>({id:this.id,type:this.type,path:this.path,config:this.config});destroy=()=>{this.log.debug("Destroying eraser tool preview module"),this.konva.group.destroy()}}const iit={NUDGE_PX:1};class oit extends Tn{type="move_tool";id;path;parent;manager;log;config=iit;nudgeOffsets;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.nudgeOffsets={ArrowLeft:{x:-this.config.NUDGE_PX,y:0},ArrowRight:{x:this.config.NUDGE_PX,y:0},ArrowUp:{x:0,y:-this.config.NUDGE_PX},ArrowDown:{x:0,y:this.config.NUDGE_PX}}}isNudgeKey(t){return this.nudgeOffsets[t]!==void 0}syncCursorStyle=()=>{const t=this.manager.stateApi.getSelectedEntityAdapter();t?t.transformer.syncCursorStyle():this.manager.stage.setCursor("not-allowed")};nudge=t=>{if(Yy()!=="canvas")return;const n=this.manager.stateApi.getSelectedEntityAdapter();if(!n||n.$isDisabled.get()||n.$isEmpty.get()||n.$isLocked.get()||n.$isEntityTypeHidden.get())return;const s=this.manager.$isBusy.get(),i=this.parent.$tool.get()==="move",o=this.manager.stateApi.$transformingAdapter.get()===n;if(s){if(!o)return}else if(!i)return;const r=this.nudgeOffsets[t];n.transformer.nudgeBy(r)}}class ait extends Tn{type="rect_tool";id;path;parent;manager;log;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module")}syncCursorStyle=()=>{this.manager.stage.setCursor("crosshair")};onStagePointerDown=async t=>{const n=this.parent.$cursorPos.get(),s=this.parent.$isPrimaryPointerDown.get(),i=this.manager.stateApi.getSelectedEntityAdapter();if(!n||!s||!i)return;const o=ba(n.relative,i.state.position);await i.bufferRenderer.setBuffer({id:ee("rect"),type:"rect",rect:{x:Math.round(o.x),y:Math.round(o.y),width:0,height:0},color:this.manager.stateApi.getCurrentColor()})};onStagePointerUp=t=>{const n=this.manager.stateApi.getSelectedEntityAdapter();n&&(n.bufferRenderer.state?.type==="rect"&&n.bufferRenderer.hasBuffer()?n.bufferRenderer.commitBuffer():n.bufferRenderer.clearBuffer())};onStagePointerMove=async t=>{const n=this.parent.$cursorPos.get();if(!n||!this.parent.$isPrimaryPointerDown.get())return;const s=this.manager.stateApi.getSelectedEntityAdapter();if(!s)return;const i=s.bufferRenderer.state;if(!i||i.type!=="rect")return;const o=ba(n.relative,s.state.position),r=nwe(o);i.rect.width=Math.round(r.x-i.rect.x),i.rect.height=Math.round(r.y-i.rect.y),await s.bufferRenderer.setBuffer(i)}}class rit extends Tn{type="view_tool";id;path;parent;manager;log;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module")}syncCursorStyle=()=>{this.manager.stage.setCursor(this.manager.stage.getIsDragging()?"grabbing":"grab")}}Ae.dragButtons=[0];const lit="Escape",j$=" ",E$="Alt",cit={BRUSH_SPACING_TARGET_SCALE:.1};class dit extends Tn{type="tool";id;path;parent;manager;log;subscriptions=new Set;config=cit;tools;$tool=De("move");$toolBuffer=De(null);$isPrimaryPointerDown=De(!1);$cursorPos=De(null);$lastPointerType=De(null);konva;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=t,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating tool module"),this.tools={brush:new Jst(this),eraser:new sit(this),rect:new ait(this),colorPicker:new tit(this),bbox:new Yst(this),view:new rit(this),move:new oit(this)},this.konva={stage:this.manager.stage.konva.stage,group:new Ae.Group({name:`${this.type}:group`,listening:!0})},this.konva.group.add(this.tools.brush.konva.group),this.konva.group.add(this.tools.eraser.konva.group),this.konva.group.add(this.tools.colorPicker.konva.group),this.konva.group.add(this.tools.bbox.konva.group),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Oi,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(rt,this.render)),this.subscriptions.add(this.$tool.listen(()=>{this.manager.tool.$isPrimaryPointerDown.set(!1),this.render()}));const n=this.setEventListeners();this.subscriptions.add(n)}initialize=()=>{this.log.debug("Initializing module"),this.render(),this.syncCursorStyle()};syncCursorStyle=()=>{const t=this.manager.stage,n=this.$tool.get(),s=this.manager.stateApi.$segmentingAdapter.get(),i=this.manager.stateApi.$transformingAdapter.get(),o=this.manager.stateApi.getSelectedEntityAdapter();this.manager.stage.getIsDragging()?t.setCursor("grabbing"):n==="view"?this.tools.view.syncCursorStyle():s?s.segmentAnything.syncCursorStyle():i?i.transformer.syncCursorStyle():this.manager.stateApi.$isFiltering.get()||this.manager.stagingArea.$isStaging.get()?t.setCursor("not-allowed"):n==="bbox"?this.tools.bbox.syncCursorStyle():n==="colorPicker"?this.tools.colorPicker.syncCursorStyle():o?o.$isDisabled.get()||o.$isEntityTypeHidden.get()||o.$isLocked.get()?t.setCursor("not-allowed"):n==="brush"?this.tools.brush.syncCursorStyle():n==="eraser"?this.tools.eraser.syncCursorStyle():n==="move"?this.tools.move.syncCursorStyle():n==="rect"&&this.tools.rect.syncCursorStyle():(this.manager.stateApi.getRenderedEntityCount(),t.setCursor("not-allowed"))};render=()=>{this.syncCursorStyle(),this.tools.brush.render(),this.tools.eraser.render(),this.tools.colorPicker.render(),this.tools.bbox.render()};syncCursorPositions=()=>{const t=this.konva.stage.getRelativePointerPosition(),n=this.konva.stage.getPointerPosition();!t||!n||this.$cursorPos.set({relative:t,absolute:n})};getClip=t=>{if(this.manager.stateApi.getSettings().clipToBbox){const{x:s,y:i,width:o,height:r}=this.manager.stateApi.getBbox().rect;return{x:s-t.position.x,y:i-t.position.y,width:o,height:r}}else{const{x:s,y:i}=this.manager.stage.getPosition(),o=this.manager.stage.getScale(),{width:r,height:l}=this.manager.stage.getSize();return{x:-s/o-t.position.x,y:-i/o-t.position.y,width:r/o,height:l/o}}};setEventListeners=()=>(this.konva.stage.on("pointerenter",this.onStagePointerEnter),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.konva.stage.on("pointerup",this.onStagePointerUp),this.konva.stage.on("pointermove",this.onStagePointerMove),this.manager.stage.container.addEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.on("wheel",this.onStageMouseWheel),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("pointerup",this.onWindowPointerUp),window.addEventListener("blur",this.onWindowBlur),()=>{this.konva.stage.off("pointerenter",this.onStagePointerEnter),this.konva.stage.off("pointerdown",this.onStagePointerDown),this.konva.stage.off("pointerup",this.onStagePointerUp),this.konva.stage.off("pointermove",this.onStagePointerMove),this.manager.stage.container.removeEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.off("wheel",this.onStageMouseWheel),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("pointerup",this.onWindowPointerUp),window.removeEventListener("blur",this.onWindowBlur)});getCanDraw=()=>{if(this.manager.stateApi.getRenderedEntityCount()===0||this.manager.$isBusy.get()||this.manager.stage.getIsDragging())return!1;const t=this.manager.stateApi.getSelectedEntityAdapter();return!(!t||t.$isDisabled.get()||t.$isEntityTypeHidden.get()||t.$isLocked.get())};onStagePointerEnter=async t=>{try{if(this.$lastPointerType.set(t.evt.pointerType),!this.getCanDraw())return;this.syncCursorPositions();const n=this.$tool.get(),s=this.manager.stateApi.getSelectedEntityAdapter();if(s?.bufferRenderer.state?.type!=="rect"&&s?.bufferRenderer.hasBuffer()){s.bufferRenderer.commitBuffer();return}n==="brush"?await this.tools.brush.onStagePointerEnter(t):n==="eraser"&&await this.tools.eraser.onStagePointerEnter(t)}finally{this.render()}};onStagePointerDown=async t=>{if(t.target===this.konva.stage)try{if(this.$lastPointerType.set(t.evt.pointerType),!this.getCanDraw())return;this.$isPrimaryPointerDown.set(swe(t)),this.syncCursorPositions();const n=this.$tool.get();n==="brush"?await this.tools.brush.onStagePointerDown(t):n==="eraser"?await this.tools.eraser.onStagePointerDown(t):n==="rect"&&await this.tools.rect.onStagePointerDown(t)}finally{this.render()}};onStagePointerUp=t=>{if(t.target===this.konva.stage)try{this.$lastPointerType.set(t.evt.pointerType);const n=this.$tool.get();if(n==="colorPicker"&&this.tools.colorPicker.onStagePointerUp(t),!this.getCanDraw())return;n==="brush"?this.tools.brush.onStagePointerUp(t):n==="eraser"?this.tools.eraser.onStagePointerUp(t):n==="rect"&&this.tools.rect.onStagePointerUp(t)}finally{this.render()}};onStagePointerMove=async t=>{if(t.target===this.konva.stage)try{this.$lastPointerType.set(t.evt.pointerType),this.syncCursorPositions();const n=this.$tool.get();if(n==="colorPicker"&&this.tools.colorPicker.onStagePointerMove(t),!this.getCanDraw())return;n==="brush"?await this.tools.brush.onStagePointerMove(t):n==="eraser"?await this.tools.eraser.onStagePointerMove(t):n==="rect"?await this.tools.rect.onStagePointerMove(t):this.manager.stateApi.getSelectedEntityAdapter()?.bufferRenderer.clearBuffer()}finally{this.render()}};onStagePointerLeave=t=>{if(t.target===this.manager.stage.container)try{if(this.$lastPointerType.set(t.pointerType),this.$cursorPos.set(null),!this.getCanDraw())return;const n=this.manager.stateApi.getSelectedEntityAdapter();n&&n.bufferRenderer.state?.type!=="rect"&&n.bufferRenderer.hasBuffer()&&n.bufferRenderer.commitBuffer()}finally{this.render()}};onStageMouseWheel=t=>{if(t.target!==this.konva.stage||!this.getCanDraw()||(t.evt.preventDefault(),!t.evt.ctrlKey&&!t.evt.metaKey))return;const n=this.manager.stateApi.getSettings(),s=this.$tool.get();let i=t.evt.deltaY;n.invertScrollForToolWidth&&(i=-i),s==="brush"?this.manager.stateApi.setBrushWidth(JL(n.brushWidth,i)):s==="eraser"&&this.manager.stateApi.setEraserWidth(JL(n.eraserWidth,i)),this.render()};onWindowPointerUp=t=>{try{this.$isPrimaryPointerDown.set(!1);const n=this.manager.stateApi.getSelectedEntityAdapter();n&&n.bufferRenderer.hasBuffer()&&!this.manager.$isBusy.get()&&n.bufferRenderer.commitBuffer()}finally{this.render()}};onWindowBlur=()=>{this.revertToolBuffer()};onKeyDown=t=>{if(!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement)&&(this.tools.move.isNudgeKey(t.key)&&this.tools.move.nudge(t.key),!t.repeat)){if(t.key===lit){t.preventDefault();const n=this.manager.stateApi.getSelectedEntityAdapter();n&&!n.filterer?.$isFiltering.get()&&!n.transformer.$isTransforming.get()&&n.bufferRenderer.hasBuffer()&&n.bufferRenderer.clearBuffer();return}if(t.key===j$){t.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("view"),this.manager.stateApi.$spaceKey.set(!0),this.$cursorPos.set(null);return}t.key===E$&&(t.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("colorPicker"))}};onKeyUp=t=>{if(!t.repeat&&!(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement)){if(t.key===j$){t.preventDefault(),this.revertToolBuffer(),this.manager.stateApi.$spaceKey.set(!1);return}if(t.key===E$){t.preventDefault(),this.revertToolBuffer();return}}};revertToolBuffer=()=>{const t=this.$toolBuffer.get();t&&(this.$tool.set(t),this.$toolBuffer.set(null))};repr=()=>({id:this.id,type:this.type,path:this.path,config:this.config,$tool:this.$tool.get(),$toolBuffer:this.$toolBuffer.get(),$isPrimaryPointerDown:this.$isPrimaryPointerDown.get(),$cursorPos:this.$cursorPos.get(),$lastPointerType:this.$lastPointerType.get(),tools:{brush:this.tools.brush.repr(),eraser:this.tools.eraser.repr(),colorPicker:this.tools.colorPicker.repr(),rect:this.tools.rect.repr(),bbox:this.tools.bbox.repr(),view:this.tools.view.repr(),move:this.tools.move.repr()}});destroy=()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear();for(const t of Object.values(this.tools))t.destroy();this.konva.group.destroy()}}class uit extends Tn{type="worker";id;path;log;parent;manager;worker=new Worker(new URL(""+new URL("worker-Dywf1EVc.js",import.meta.url).href,import.meta.url),{type:"module",name:"worker"});tasks=new Map;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=t,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.worker.onmessage=n=>{const{type:s,data:i}=n.data;if(s==="log")i.ctx?this.log[i.level](i.ctx,i.message):this.log[i.level](i.message);else if(s==="extents"){const o=this.tasks.get(i.id);if(!o)return;o.onComplete(i.extents),this.tasks.delete(i.id)}},this.worker.onerror=n=>{this.log.error({message:n.message},"Worker error")},this.worker.onmessageerror=()=>{this.log.error("Worker message error")}}requestBbox(t,n){const s=ee("bbox_calculation"),i={type:"get_bbox",data:{...t,id:s}};this.tasks.set(s,{task:i,onComplete:n}),this.worker.postMessage(i,[t.buffer])}repr=()=>({id:this.id,type:this.type,path:this.path,tasks:Array.from(this.tasks.keys())});destroy=()=>{this.log.trace("Destroying worker module"),this.worker.terminate(),this.tasks.clear()}}const hit={GRID_LINE_COLOR_COARSE:eR(27),GRID_LINE_COLOR_FINE:eR(18),CHECKERBOARD_PATTERN_DATAURL:Qh};class O8 extends Tn{type="background";id;path;parent;manager;log;subscriptions=new Set;config=hit;checkboardPattern=new Image;konva;constructor(t){super(),this.id=ee(this.type),this.manager=t,this.parent=t,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Ae.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1}),linesGroup:new Ae.Group({name:`${this.type}:linesGroup`}),lines:[],patternRect:new Ae.Rect({name:`${this.type}:patternRect`,perfectDrawEnabled:!1})},this.konva.layer.add(this.konva.patternRect),this.konva.layer.add(this.konva.linesGroup),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(q2,this.render))}initialize=()=>{this.log.debug("Initializing module"),this.checkboardPattern.onload=()=>{this.konva.patternRect.fillPatternImage(this.checkboardPattern),this.render()},this.checkboardPattern.src="anonymous",this.checkboardPattern.src=this.config.CHECKERBOARD_PATTERN_DATAURL,this.render()};render=()=>{if(!this.manager.stateApi.runSelector(q2)){this.konva.linesGroup.visible(!1);const x=this.manager.stage.unscale(1);this.konva.patternRect.setAttrs({visible:!0,...this.manager.stage.getScaledStageRect(),fillPatternScaleX:x,fillPatternScaleY:x});return}this.konva.linesGroup.visible(!0),this.konva.patternRect.visible(!1);const n=this.manager.stage.getScale(),{x:s,y:i}=this.manager.stage.getPosition(),{width:o,height:r}=this.manager.stage.getSize(),l=O8.getGridSpacing(n),c={x1:0,y1:0,x2:o,y2:r},d={x:Math.ceil(s/n/l)*l,y:Math.ceil(i/n/l)*l},u={x1:-d.x,y1:-d.y,x2:o/n-d.x+l,y2:r/n-d.y+l},p={x1:Math.min(c.x1,u.x1),y1:Math.min(c.y1,u.y1),x2:Math.max(c.x2,u.x2),y2:Math.max(c.y2,u.y2)},m=p.x2-p.x1,f=p.y2-p.y1,g=Math.round(m/l)+1,v=Math.round(f/l)+1,b=1/n;let C=0,y=0;this.konva.linesGroup.destroyChildren(),this.konva.lines=[];for(let x=0;x<g;x++){C=p.x1+x*l;const w=new Ae.Line({x:C,y:p.y1,points:[0,0,0,f],stroke:C%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:b,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(w),this.konva.linesGroup.add(w)}for(let x=0;x<v;x++){y=p.y1+x*l;const w=new Ae.Line({x:p.x1,y,points:[0,0,m,0],stroke:y%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:b,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(w),this.konva.linesGroup.add(w)}};static getGridSpacing=t=>t>=2?8:t>=1&&t<2?16:t>=.5&&t<1?32:t>=.25&&t<.5?64:t>=.125&&t<.25?128:256;repr=()=>({id:this.id,type:this.type,path:this.path,config:this.config});destroy=()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear(),this.konva.layer.destroy()}}class pit extends Tn{type="composition_guide";id;path;parent;manager;log;subscriptions=new Set;konva;constructor(t){super(),this.id=ee(this.type),this.parent=t,this.manager=t,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating composition guide module"),this.konva={group:new Ae.Group({name:`${this.type}:group`,listening:!1,perfectDrawEnabled:!1}),verticalLine1:new Ae.Line({name:`${this.type}:vertical_line_1`,listening:!1,stroke:"hsl(220 12% 90% / 0.9)",strokeWidth:1,strokeScaleEnabled:!1,perfectDrawEnabled:!1,dash:[5,5]}),verticalLine2:new Ae.Line({name:`${this.type}:vertical_line_2`,listening:!1,stroke:"hsl(220 12% 90% / 0.9)",strokeWidth:1,strokeScaleEnabled:!1,perfectDrawEnabled:!1,dash:[5,5]}),horizontalLine1:new Ae.Line({name:`${this.type}:horizontal_line_1`,listening:!1,stroke:"hsl(220 12% 90% / 0.9)",strokeWidth:1,strokeScaleEnabled:!1,perfectDrawEnabled:!1,dash:[5,5]}),horizontalLine2:new Ae.Line({name:`${this.type}:horizontal_line_2`,listening:!1,stroke:"hsl(220 12% 90% / 0.9)",strokeWidth:1,strokeScaleEnabled:!1,perfectDrawEnabled:!1,dash:[5,5]})},this.konva.group.add(this.konva.verticalLine1),this.konva.group.add(this.konva.verticalLine2),this.konva.group.add(this.konva.horizontalLine1),this.konva.group.add(this.konva.horizontalLine2),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(ZU,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Pc,this.render))}initialize=()=>{this.log.debug("Initializing composition guide module"),this.render()};render=()=>{const t=this.manager.stateApi.getSettings().ruleOfThirds,{x:n,y:s,width:i,height:o}=this.manager.stateApi.runSelector(Pc).rect;if(this.konva.group.visible(t),!t)return;const r=n+i/3,l=n+2*i/3,c=s+o/3,d=s+2*o/3;this.konva.verticalLine1.points([r,s,r,s+o]),this.konva.verticalLine2.points([l,s,l,s+o]),this.konva.horizontalLine1.points([n,c,n+i,c]),this.konva.horizontalLine2.points([n,d,n+i,d])};destroy=()=>{this.log.debug("Destroying composition guide module"),this.subscriptions.forEach(t=>t()),this.subscriptions.clear(),this.konva.group.destroy()};repr=()=>({id:this.id,type:this.type,path:this.path,visible:this.konva.group.visible()})}const cA=Ft("system").child({filePath:"services/api/run-graph.ts"}),fit=e=>{const{promise:t,resolve:n,reject:s}=TK();return git(e,n,s),t},mit=(e,t)=>({executor:{enqueueBatch:n=>e(mi.endpoints.enqueueBatch.initiate(n,{...cu,track:!1})).unwrap(),getQueueItem:n=>e(mi.endpoints.getQueueItem.initiate(n,{subscribe:!1})).unwrap(),cancelQueueItem:n=>e(mi.endpoints.cancelQueueItem.initiate({item_id:n},{track:!1})).unwrap()},eventHandler:{subscribe:n=>t.on("queue_item_status_changed",n),unsubscribe:n=>t.off("queue_item_status_changed",n)}}),git=async(e,t,n)=>{const{graph:s,outputNodeId:i,dependencies:o,options:r}=e,{destination:l,prepend:c,timeout:d,signal:u}=r??{},p=ee(s.id);let m=null;const f=new Set,g=()=>{for(const x of f)try{x()}catch(w){cA.warn({error:ts(w)},"Error during runGraph cleanup")}f.clear()},v=new H_;let b=!1;const C=async x=>{await v.runExclusive(async()=>{if(b)return;b=!0,g();const w=await Kn(()=>Promise.resolve(x())),_={queueItemId:m,graphId:s.id,outputNodeId:i,destination:l??"not provided",prepend:c??!1,timeout:d??"not provided",signal:u!==void 0?"provided":"not provided"};w.isOk()?(cA.debug({..._,output:ts(w.value)},"Run completed successfully"),t(w.value)):(cA.debug({..._,error:ts(w.error)},"Run failed"),n(w.error))})};if(!s.hasNode(i)){await C(()=>{throw new yit(i,s)});return}if(s.getNodes().some(x=>x.type==="iterate")){await C(()=>{throw new bit(s)});return}if(d!==void 0){const x=setTimeout(async()=>{await C(async()=>{let w=!1,_=null;if(m!==null)try{await o.executor.cancelQueueItem(m)}catch(S){w=!0,_=Ll.wrap(S)}throw new Iit(m,w,_)})},d);f.add(()=>{clearTimeout(x)})}if(u!==void 0){const x=async()=>{await C(async()=>{let w=!1,_=null;if(m!==null)try{await o.executor.cancelQueueItem(m)}catch(S){w=!0,_=Ll.wrap(S)}throw new kit(m,w,_)})};u.addEventListener("abort",x),f.add(()=>{u.removeEventListener("abort",x)})}const y=async x=>{x.origin===p&&(x.status==="pending"||x.status==="in_progress"||await C(async()=>{const w=await o.executor.getQueueItem(x.item_id),{status:_,session:S,error_type:I,error_message:k,error_traceback:E}=w;if(_==="pending"||_==="in_progress")throw new xit(x.item_id,S,_);if(_==="completed"){const j=vit(m,S,i);return{session:S,output:j}}if(_==="failed")throw new _it(m,S,I,k,E);if(_==="canceled")throw new Sit(m,S);ae(!1)}))};o.eventHandler.subscribe(y),f.add(()=>{o.eventHandler.unsubscribe(y)});try{const x={prepend:c,batch:{graph:s.getGraph(),origin:p,destination:l,runs:1}},{item_ids:w}=await o.executor.enqueueBatch(x);ae(w.length===1),ae(w[0]!==void 0),m=w[0]}catch(x){C(()=>{throw Ll.wrap(x)})}},vit=(e,t,n)=>{const{results:s,source_prepared_mapping:i}=t,o=i[n]?.[0];if(!o)throw new Cit(e,t,n);const r=s[o];if(!r)throw new wit(e,t,n);return r};class yit extends Error{outputNodeId;graph;constructor(t,n){super(`Output node '${t}' not found in the graph.`),this.name=this.constructor.name,this.outputNodeId=t,this.graph=n}}class bit extends Error{graph;constructor(t){super("Iterate node(s) found in the graph."),this.name=this.constructor.name,this.graph=t}}class N8 extends Error{queueItemId;constructor(t,n){super(n??"Queue item error occurred"),this.name=this.constructor.name,this.queueItemId=t}}class ob extends N8{session;constructor(t,n,s){super(t,s??"Session error occurred"),this.name=this.constructor.name,this.session=n}}class xit extends ob{status;constructor(t,n,s){super(t,n,`Session has unexpected status ${s}.`),this.name="UnexpectedStatusError",this.status=s}}class Cit extends ob{nodeId;constructor(t,n,s){super(t,n,`Node '${s}' not found in session.`),this.name="OutputNodeNotFoundInCompletedSessionError",this.nodeId=s}}class wit extends ob{nodeId;constructor(t,n,s){super(t,n,`Result for node '${s}' not found in session.`),this.name="ResultNotFoundInCompletedSessionError",this.nodeId=s}}class _it extends ob{error_type;error_message;error_traceback;constructor(t,n,s,i,o){super(t,n,"Session execution failed"),this.name="SessionFailedError",this.error_type=s,this.error_traceback=o,this.error_message=i}}class Sit extends ob{constructor(t,n){super(t,n,"Session execution was canceled"),this.name="SessionCanceledError"}}class kit extends N8{cancellationFailed;cancellationError;constructor(t,n=!1,s){const i=n?"Session execution was aborted via signal and cancellation failed":"Session execution was aborted via signal";super(t,i),this.name="SessionAbortedError",this.cancellationFailed=n,this.cancellationError=s}}class Iit extends N8{cancellationFailed;cancellationError;constructor(t,n=!1,s){const i=n?"Session execution timed out and cancellation failed":"Session execution timed out";super(t,i),this.name="SessionTimeoutError",this.cancellationFailed=n,this.cancellationError=s}}class jit extends Tn{type="state_api";id;path;parent;manager;log;store;constructor(t,n){super(),this.id=ee(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating state api module"),this.store=t}runSelector=t=>t(this.store.getState());createStoreSubscription=(t,n)=>iwe(this.store,t,n);addStoreListener=t=>this.store.dispatch(owe(t));getCanvasState=()=>this.runSelector(rt);resetEntity=t=>{this.store.dispatch(XU(t))};setEntityPosition=t=>{this.store.dispatch(awe(t))};moveEntityBy=t=>{this.store.dispatch(rwe(t))};addBrushLine=t=>{this.store.dispatch(lwe(t))};addEraserLine=t=>{this.store.dispatch(cwe(t))};addRect=t=>{this.store.dispatch(dwe(t))};addRasterLayer=t=>{this.store.dispatch(em(t))};addControlLayer=t=>{this.store.dispatch(Ty(t))};addInpaintMask=t=>{this.store.dispatch(yl(t))};addRegionalGuidance=t=>{this.store.dispatch(Xd(t))};rasterizeEntity=t=>{this.store.dispatch(Zw(t))};setGenerationBbox=t=>{this.store.dispatch(D0(t)),this.manager.invalidateRegionalGuidanceRasterCache()};waitForRasterizationToFinish=async()=>{this.$rasterizingAdapter.get()&&await new Promise(t=>{let n=!1;if(!this.$rasterizingAdapter.get()){n=!0,t();return}const s=this.$rasterizingAdapter.listen(i=>{!i&&!n&&(n=!0,s(),t())});!this.$rasterizingAdapter.get()&&!n&&(n=!0,s(),t())})};setBrushWidth=t=>{this.store.dispatch(YU(t))};setEraserWidth=t=>{this.store.dispatch(QU(t))};setColor=t=>this.getSettings().activeColor==="bgColor"?this.store.dispatch(zM(t)):this.store.dispatch(VM(t));runGraphAndReturnImageOutput=async t=>{const n=mit(this.store.dispatch,this.manager.socket),{output:s}=await fit({dependencies:n,...t});return await this.getImageDTOFromResult(s)};getImageDTOFromResult=async t=>{const n=uwe.safeParse(t);if(!n.success)throw new Error(`Graph output is not a valid ImageOutput. Got: ${JSON.stringify(t)}`);const s=n.data;return await hwe(s.image.image_name)};getBbox=()=>this.runSelector(Pc);getSettings=()=>this.runSelector(Oi);getPositionGridSize=()=>this.getSettings().snapToGrid?this.$ctrlKey.get()||this.$metaKey.get()?8:64:this.$ctrlKey.get()||this.$metaKey.get()?this.$shiftKey.get()?8:64:1;getRegionsState=()=>this.getCanvasState().regionalGuidance;getRasterLayersState=()=>this.getCanvasState().rasterLayers;getControlLayersState=()=>this.getCanvasState().controlLayers;getInpaintMasksState=()=>this.getCanvasState().inpaintMasks;getStagingArea=()=>this.runSelector(pwe);getBboxGridSize=()=>this.runSelector(Bh);getIsSelected=t=>this.getCanvasState().selectedEntityIdentifier?.id===t;getRenderedEntityCount=()=>{const t=fwe(this.getCanvasState());let n=0;for(const s of t)s.isEnabled&&n++;return n};getSelectedEntityAdapter=()=>{const t=this.getCanvasState();return t.selectedEntityIdentifier?this.manager.getAdapter(t.selectedEntityIdentifier):null};getCurrentColor=()=>{let t=this.getSettings().activeColor==="bgColor"?this.getSettings().bgColor:this.getSettings().fgColor;const n=this.getSelectedEntityAdapter();return n&&(n.state.type==="regional_guidance"||n.state.type==="inpaint_mask")&&(t=KU),t};getBrushPreviewColor=()=>{const t=this.getSelectedEntityAdapter();return t?.state.type==="regional_guidance"||t?.state.type==="inpaint_mask"?{...t.state.fill.color,a:.5}:this.getSettings().activeColor==="bgColor"?this.getSettings().bgColor:this.getSettings().fgColor};$filteringAdapter=De(null);$isFiltering=Ut(this.$filteringAdapter,t=>!!t);$transformingAdapter=De(null);$isTransforming=Ut(this.$transformingAdapter,t=>!!t);$rasterizingAdapter=De(null);$isRasterizing=Ut(this.$rasterizingAdapter,t=>!!t);$segmentingAdapter=De(null);$isSegmenting=Ut(this.$segmentingAdapter,t=>!!t);$spaceKey=De(!1);$altKey=mwe;$ctrlKey=gwe;$metaKey=vwe;$shiftKey=_M;repr=()=>({id:this.id,type:this.type,path:this.path,$filteringAdapter:this.$filteringAdapter.get()?.entityIdentifier??null,$isFiltering:this.$isFiltering.get(),$transformingAdapter:this.$transformingAdapter.get()?.entityIdentifier??null,$isTransforming:this.$isTransforming.get(),$rasterizingAdapter:this.$rasterizingAdapter.get()?.entityIdentifier??null,$isRasterizing:this.$isRasterizing.get(),$segmentingAdapter:this.$segmentingAdapter.get()?.entityIdentifier??null,$isSegmenting:this.$isSegmenting.get()})}class Eit extends Tn{type="manager";id;path;manager;parent;log;store;socket;adapters={rasterLayers:new Y0,controlLayers:new Y0,regionMasks:new Y0,inpaintMasks:new Y0};stateApi;background;stage;worker;cache;entityRenderer;compositor;tool;stagingArea;compositionGuide;konva;_isDebugging=!1;$isBusy;constructor(t,n,s){super(),this.id=ee(this.type),this.path=[this.id],this.manager=this,this.parent=this,this.log=Ft("canvas").child({filePath:"features/controlLayers/konva/CanvasManager.ts"}).child(i=>({...i,context:{...this.getLoggingContext(),...i.context}})),this.log.debug("Creating canvas manager module"),this.store=n,this.socket=s,this.stateApi=new jit(this.store,this),this.stage=new Hst(t,this),this.worker=new uit(this),this.cache=new pD(this),this.entityRenderer=new $st(this),this.compositor=new Sst(this),this.stagingArea=new Kst(this),this.compositionGuide=new pit(this),this.$isBusy=Ut([this.stateApi.$isFiltering,this.stateApi.$isTransforming,this.stateApi.$isRasterizing,this.stateApi.$isSegmenting,this.stagingArea.$isStaging,this.compositor.$isBusy],(i,o,r,l,c,d)=>i||o||r||l||c||d),this.background=new O8(this),this.stage.addLayer(this.background.konva.layer),this.konva={previewLayer:new Ae.Layer({listening:!0,imageSmoothingEnabled:!1})},this.stage.addLayer(this.konva.previewLayer),this.tool=new dit(this),this.konva.previewLayer.add(this.stagingArea.konva.group),this.konva.previewLayer.add(this.tool.konva.group),this.konva.previewLayer.add(this.compositionGuide.konva.group)}getAdapter=t=>{let n;switch(t.type){case"raster_layer":n=this.adapters.rasterLayers.get(t.id);break;case"control_layer":n=this.adapters.controlLayers.get(t.id);break;case"regional_guidance":n=this.adapters.regionMasks.get(t.id);break;case"inpaint_mask":n=this.adapters.inpaintMasks.get(t.id);break;default:return null}return n||null};deleteAdapter=t=>{switch(t.type){case"raster_layer":return this.adapters.rasterLayers.delete(t.id);case"control_layer":return this.adapters.controlLayers.delete(t.id);case"regional_guidance":return this.adapters.regionMasks.delete(t.id);case"inpaint_mask":return this.adapters.inpaintMasks.delete(t.id);default:return!1}};getAdapters=t=>{const n=[];for(const s of t){const i=this.getAdapter(s);i&&n.push(i)}return n};getAllAdapters=()=>[...this.adapters.rasterLayers.values(),...this.adapters.controlLayers.values(),...this.adapters.regionMasks.values(),...this.adapters.inpaintMasks.values()];invalidateRegionalGuidanceRasterCache=()=>{for(const t of this.adapters.regionMasks.values())t.invalidateRasterCache()};createAdapter=t=>{if(zU(t)){const n=new zst(t,this);return this.adapters.rasterLayers.set(n.id,n),n}else if(ywe(t)){const n=new Fst(t,this);return this.adapters.controlLayers.set(n.id,n),n}else if(bwe(t)){const n=new Vst(t,this);return this.adapters.regionMasks.set(n.id,n),n}else if(wM(t)){const n=new Bst(t,this);return this.adapters.inpaintMasks.set(n.id,n),n}else ae(!1,"Unhandled entity type")};enableDebugging(){this._isDebugging=!0,this.logDebugInfo()}disableDebugging(){this._isDebugging=!1}getAllModules=()=>[this.stagingArea,this.tool,this.stateApi,this.background,this.worker,this.entityRenderer,this.compositor,this.stage,this.compositionGuide];initialize=()=>{this.log.debug("Initializing");for(const t of this.getAllModules())t.initialize?.();yh.set(this)};destroy=()=>{this.log.debug("Destroying module");for(const t of this.getAllAdapters())t.destroy();for(const t of this.getAllModules())t.destroy();yh.set(null)};repr=()=>({id:this.id,type:this.type,path:this.path,$isBusy:this.$isBusy.get(),rasterLayers:Array.from(this.adapters.rasterLayers.values()).map(t=>t.repr()),controlLayers:Array.from(this.adapters.controlLayers.values()).map(t=>t.repr()),inpaintMasks:Array.from(this.adapters.inpaintMasks.values()).map(t=>t.repr()),regionMasks:Array.from(this.adapters.regionMasks.values()).map(t=>t.repr()),stateApi:this.stateApi.repr(),stagingArea:this.stagingArea.repr(),tool:this.tool.repr(),background:this.background.repr(),worker:this.worker.repr(),entityRenderer:this.entityRenderer.repr(),compositor:this.compositor.repr(),stage:this.stage.repr(),compositionGuide:this.compositionGuide.repr()});getLoggingContext=()=>({path:this.path});buildPath=t=>t.parent.path.concat(t.id);buildLogger=t=>this.log.child(n=>({...n,context:{...n.context,...t.getLoggingContext()}}));logDebugInfo(){console.log("Canvas manager",{managerInstance:this,managerInfo:this.repr()})}}function Ait(e){const t=A$(e),[n,s]=h.useState(t),{defaultDpr:i,maxDpr:o,round:r}=e||{};return h.useEffect(()=>{if(!(typeof window<"u"&&"matchMedia"in window))return;const c=()=>s(A$({defaultDpr:i,maxDpr:o,round:r})),d=window.matchMedia(`screen and (resolution: ${n}dppx)`);return d.addEventListener?d.addEventListener("change",c):d.addListener(c),()=>{d.removeEventListener?d.removeEventListener("change",c):d.removeListener(c)}},[n,i,o,r]),n}function A$(e){const{defaultDpr:t=1,maxDpr:n=3,round:s=!0}=e||{},o=typeof window<"u"&&typeof window.devicePixelRatio=="number"?window.devicePixelRatio:t;return Math.min(Math.max(1,s?Math.floor(o):o),n)}const dA=Ft("canvas").child({filePath:"features/controlLayers/hooks/useInvokeCanvas.ts"});Ae.showWarnings=!1;const Pit=()=>{mn("useKonvaPixelRatioWatcher");const e=Ait({round:!1});h.useLayoutEffect(()=>{Ae.pixelRatio=e},[e])},Tit=()=>{mn("useInvokeCanvas"),Pit();const e=Ze(),t=le(E_),[n,s]=h.useState(null);return h.useLayoutEffect(()=>{if(dA.debug("Initializing renderer"),!n)return dA.debug("No stage container, skipping initialization"),()=>{};if(!t)return dA.debug("Socket not connected, skipping initialization"),()=>{};const i=yh.get();if(i){i.stage.setContainer(n);return}const o=new Eit(n,e,t);return o.initialize(),()=>{o.destroy(),yh.set(null)}},[n,t,e]),s},xue=h.memo(()=>{const e=Tit();return a.jsx(ke,{position:"absolute",top:0,right:0,bottom:0,left:0,ref:e,borderRadius:"base",overflow:"hidden","data-testid":"control-layers-canvas"})});xue.displayName="InvokeCanvasComponent";const Cue=h.memo(({adapter:e})=>{const{t}=T(),n=le(e.segmentAnything.$isProcessing),s=le(e.segmentAnything.$hasImageState),i=h.useCallback(()=>{e.segmentAnything.saveAs("inpaint_mask")},[e.segmentAnything]),o=h.useCallback(()=>{e.segmentAnything.saveAs("regional_guidance")},[e.segmentAnything]),r=h.useCallback(()=>{e.segmentAnything.saveAs("raster_layer")},[e.segmentAnything]),l=h.useCallback(()=>{e.segmentAnything.saveAs("control_layer")},[e.segmentAnything]);return a.jsxs(An,{children:[a.jsx(Pn,{as:he,loadingText:t("controlLayers.selectObject.saveAs"),variant:"ghost",isDisabled:n||!s,rightIcon:a.jsx(Do,{}),children:t("controlLayers.selectObject.saveAs")}),a.jsxs(Zt,{children:[a.jsx(be,{isDisabled:n||!s,onClick:i,children:t("controlLayers.newInpaintMask")}),a.jsx(be,{isDisabled:n||!s,onClick:o,children:t("controlLayers.newRegionalGuidance")}),a.jsx(be,{isDisabled:n||!s,onClick:l,children:t("controlLayers.newControlLayer")}),a.jsx(be,{isDisabled:n||!s,onClick:r,children:t("controlLayers.newRasterLayer")})]})]})});Cue.displayName="SelectObjectSaveAsMenu";const wue=h.memo(({adapter:e})=>{const{t}=T(),n=le(e.segmentAnything.$isProcessing),s=le(e.segmentAnything.$hasInputData),i=le(e.segmentAnything.$hasImageState),o=M(Ky);return a.jsxs(zn,{isAttached:!1,size:"sm",w:"full",children:[a.jsxs(he,{onClick:e.segmentAnything.processImmediate,loadingText:t("controlLayers.selectObject.process"),variant:"ghost",isDisabled:n||!s||o&&i,children:[t("controlLayers.selectObject.process"),n&&a.jsx(ao,{ms:3,boxSize:5,color:"base.600"})]}),a.jsx(At,{}),a.jsx(he,{onClick:e.segmentAnything.reset,isDisabled:n||!s,loadingText:t("controlLayers.selectObject.reset"),variant:"ghost",children:t("controlLayers.selectObject.reset")}),a.jsx(he,{onClick:e.segmentAnything.apply,loadingText:t("controlLayers.selectObject.apply"),variant:"ghost",isDisabled:n||!i,children:t("controlLayers.selectObject.apply")}),a.jsx(Cue,{adapter:e}),a.jsx(he,{onClick:e.segmentAnything.cancel,isDisabled:n,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.selectObject.cancel")})]})});wue.displayName="SelectObjectActionButtons";const Dit=e=>a.jsx(q,{as:"span",fontWeight:"semibold",children:e.children}),Nu={Bold:a.jsx(Dit,{})},_ue=h.memo(()=>a.jsxs(A,{gap:3,flexDir:"column",children:[a.jsx(q,{children:a.jsx(Bn,{i18nKey:"controlLayers.selectObject.desc",components:Nu})}),a.jsxs(Li,{children:[a.jsx(rn,{children:a.jsx(Bn,{i18nKey:"controlLayers.selectObject.visualMode1",components:Nu})}),a.jsx(rn,{children:a.jsx(Bn,{i18nKey:"controlLayers.selectObject.visualMode2",components:Nu})}),a.jsx(rn,{children:a.jsx(Bn,{i18nKey:"controlLayers.selectObject.visualMode3",components:Nu})})]}),a.jsx(q,{children:a.jsx(Bn,{i18nKey:"controlLayers.selectObject.promptModeDesc",components:Nu})}),a.jsxs(Li,{children:[a.jsx(rn,{children:a.jsx(Bn,{i18nKey:"controlLayers.selectObject.promptMode1",components:Nu})}),a.jsx(rn,{children:a.jsx(Bn,{i18nKey:"controlLayers.selectObject.promptMode2",components:Nu})})]})]}));_ue.displayName="SelectObjectHelpTooltipContent";const Sue=h.memo(()=>a.jsx(He,{label:a.jsx(_ue,{}),minW:420,children:a.jsx(A,{alignItems:"center",children:a.jsx(Je,{as:km,color:"base.500"})})}));Sue.displayName="SelectObjectInfoTooltip";const kue=h.memo(({adapter:e})=>{const t=le(e.segmentAnything.$inputType),n=h.useCallback(()=>{e.segmentAnything.setInputType("visual")},[e.segmentAnything]),s=h.useCallback(()=>{e.segmentAnything.setInputType("prompt")},[e.segmentAnything]);return a.jsxs(zn,{size:"sm",variant:"outline",children:[a.jsx(he,{colorScheme:t==="visual"?"invokeBlue":void 0,onClick:n,children:"Visual"}),a.jsx(he,{colorScheme:t==="prompt"?"invokeBlue":void 0,onClick:s,children:"Prompt"})]})});kue.displayName="SelectObjectInputTypeButtons";const Iue=h.memo(({adapter:e})=>{const{t}=T(),n=le(e.segmentAnything.$invert),s=h.useCallback(()=>{e.segmentAnything.$invert.set(!e.segmentAnything.$invert.get())},[e.segmentAnything.$invert]);return a.jsxs(te,{w:"min-content",children:[a.jsx(ne,{m:0,children:t("controlLayers.selectObject.invertSelection")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})});Iue.displayName="SelectObjectInvert";const jue=h.memo(({adapter:e})=>{const{t}=T(),n=le(e.segmentAnything.$pointTypeString),s=h.useCallback(i=>{const o=xwe.parse(i),r=Cwe[o];e.segmentAnything.$pointType.set(r)},[e.segmentAnything.$pointType]);return a.jsxs(te,{w:"min-content",children:[a.jsx(ne,{m:0,children:t("controlLayers.selectObject.pointType")}),a.jsx(JU,{value:n,onChange:s,w:"full",size:"md",children:a.jsxs(A,{alignItems:"center",w:"full",gap:4,color:"base.300",children:[a.jsx(K2,{value:"foreground",children:a.jsx(q,{children:t("controlLayers.selectObject.include")})}),a.jsx(K2,{value:"background",children:a.jsx(q,{children:t("controlLayers.selectObject.exclude")})})]})})]})});jue.displayName="SelectObject";const Eue=h.memo(({adapter:e})=>{const{t}=T(),n=le(e.segmentAnything.$model),s=h.useCallback(i=>{const o=wwe.parse(i);e.segmentAnything.$model.set(o)},[e.segmentAnything.$model]);return a.jsxs(te,{w:"full",children:[a.jsx(ne,{m:0,children:t("controlLayers.selectObject.model")}),a.jsx(JU,{value:n,onChange:s,w:"full",size:"md",children:a.jsxs(A,{alignItems:"center",w:"full",gap:4,color:"base.300",children:[a.jsx(K2,{value:"SAM1",children:a.jsx(q,{children:t("controlLayers.selectObject.segmentAnything1")})}),a.jsx(K2,{value:"SAM2",children:a.jsx(q,{children:t("controlLayers.selectObject.segmentAnything2")})})]})})]})});Eue.displayName="SelectObjectModel";const Aue=h.memo(({adapter:e})=>{const{t}=T(),n=le(e.segmentAnything.$inputData),s=h.useCallback(i=>{e.segmentAnything.$inputData.set({type:"prompt",prompt:i.target.value})},[e.segmentAnything.$inputData]);return n.type!=="prompt"?null:a.jsxs(te,{w:"full",children:[a.jsx(ne,{m:0,children:t("controlLayers.selectObject.prompt")}),a.jsx(Nt,{value:n.prompt,onChange:s})]})});Aue.displayName="SelectObjectPrompt";const Pue=h.memo(({adapter:e})=>{const{t}=T(),n=h.useRef(null);Qy("canvas",n,{focusOnMount:!0});const s=So("canvas"),i=le(e.segmentAnything.$isProcessing),o=le(e.segmentAnything.$inputType);return Be({id:"applySegmentAnything",category:"canvas",callback:e.segmentAnything.apply,options:{enabled:!i&&s},dependencies:[e.segmentAnything,i,s]}),Be({id:"cancelSegmentAnything",category:"canvas",callback:e.segmentAnything.cancel,options:{enabled:!i&&s},dependencies:[e.segmentAnything,i,s]}),a.jsxs(A,{ref:n,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[a.jsxs(A,{w:"full",gap:4,alignItems:"center",children:[a.jsxs(A,{gap:2,children:[a.jsx(Pt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.selectObject.selectObject")}),a.jsx(Sue,{})]}),a.jsx(At,{}),a.jsx(L8,{}),a.jsx(Ck,{})]}),a.jsxs(A,{w:"full",justifyContent:"space-between",py:2,children:[a.jsx(kue,{adapter:e}),a.jsx(Iue,{adapter:e})]}),o==="visual"&&a.jsx(jue,{adapter:e}),o==="prompt"&&a.jsx(Aue,{adapter:e}),a.jsx(Eue,{adapter:e}),a.jsx(wue,{adapter:e})]})});Pue.displayName="SegmentAnythingContent";const Tue=h.memo(()=>{const e=Tt(),t=le(e.stateApi.$segmentingAdapter);return t?a.jsx(Pue,{adapter:t}):null});Tue.displayName="SelectObject";const Mit=e=>e?n4(e):"Generating",Lit="drop-shadow(0px 0px 4px rgb(0, 0, 0)) drop-shadow(0px 0px 4px rgba(0, 0, 0, 0.3))",Due=e=>`queue-item-preview-${e}`,Rit=e=>{const t=Object.entries(e.session.source_prepared_mapping).find(([s])=>_we(s))?.[1][0],n=t?e.session.results[t]:void 0;if(!n)return null;for(const[s,i]of Gr(n))if(wH(i))return i.image_name;return null},hf=e=>({itemId:e,progressEvent:null,progressImage:null,imageDTO:null,imageLoaded:!1});class Oit{_sessionId=null;_app=null;_subscriptions=new Set;$lastStartedItemId=De(null);$lastCompletedItemId=De(null);$items=De([]);$progressData=Gw({});$selectedItemId=De(null);$itemCount=Ut([this.$items],t=>t.length);$hasItems=Ut([this.$items],t=>t.length>0);$isPending=Ut([this.$items],t=>t.some(n=>n.status==="pending"||n.status==="in_progress"));$selectedItem=Ut([this.$items,this.$selectedItemId,this.$progressData],(t,n,s)=>{if(t.length===0||n===null)return null;const i=t.find(({item_id:o})=>o===n);return i?{item:i,index:t.findIndex(({item_id:o})=>o===n),progressData:s[n]||hf(n)}:null});$selectedItemImageDTO=Ut([this.$selectedItem],t=>t?.progressData.imageDTO??null);$selectedItemIndex=Ut([this.$selectedItem],t=>t?.index??null);select=t=>{this.$selectedItemId.set(t),this._app?.onSelect?.(t)};selectNext=()=>{const t=this.$selectedItem.get();if(t===null)return;const n=this.$items.get(),s=(t.index+1)%n.length,i=n[s];i&&(this.$selectedItemId.set(i.item_id),this._app?.onSelectNext?.())};selectPrev=()=>{const t=this.$selectedItem.get();if(t===null)return;const n=this.$items.get(),s=(t.index-1+n.length)%n.length,i=n[s];i&&(this.$selectedItemId.set(i.item_id),this._app?.onSelectPrev?.())};selectFirst=()=>{const n=this.$items.get().at(0);n&&(this.$selectedItemId.set(n.item_id),this._app?.onSelectFirst?.())};selectLast=()=>{const n=this.$items.get().at(-1);n&&(this.$selectedItemId.set(n.item_id),this._app?.onSelectLast?.())};discardSelected=()=>{const t=this.$selectedItem.get();if(t===null)return;const n=this.$items.get(),s=Swe(t.index+1,0,n.length-1),i=n[s];i?this.$selectedItemId.set(i.item_id):this.$selectedItemId.set(null),this._app?.onDiscard?.(t.item)};$discardSelectedIsEnabled=Ut([this.$selectedItem],t=>t!==null);connectToApp=(t,n)=>{this._sessionId!==t&&(this.cleanup(),this._sessionId=t),this._app=n,this._subscriptions.add(this._app.onItemsChanged(this.onItemsChangedEvent)),this._subscriptions.add(this._app.onQueueItemStatusChanged(this.onQueueItemStatusChangedEvent)),this._subscriptions.add(this._app.onInvocationProgress(this.onInvocationProgressEvent))};discardAll=()=>{this.$selectedItemId.set(null),this._app?.onDiscardAll?.()};acceptSelected=()=>{const t=this.$selectedItem.get();if(t===null)return;const s=this.$progressData.get()[t.item.item_id];!s||!s.imageDTO||this._app?.onAccept?.(t.item,s.imageDTO)};$acceptSelectedIsEnabled=Ut([this.$selectedItem,this.$progressData],(t,n)=>{if(t===null)return!1;const s=n[t.item.item_id];return!!s&&!!s.imageDTO});setAutoSwitch=t=>{this._app?.onAutoSwitchChange?.(t)};onInvocationProgressEvent=t=>{t.destination===this._sessionId&&Nit(this.$progressData,t)};onQueueItemStatusChangedEvent=t=>{t.destination===this._sessionId&&(t.status==="completed"&&this.$lastCompletedItemId.set(t.item_id),t.status==="in_progress"&&this._app?.getAutoSwitch()==="switch_on_start"&&this.$lastStartedItemId.set(t.item_id))};onItemsChangedEvent=async t=>{const n=this.$items.get();if(t===n)return;t.length===0?this.$selectedItemId.set(null):this.$selectedItemId.get()===null&&t.length>0&&this.$selectedItemId.set(t[0]?.item_id??null);const s=this.$progressData.get();for(const[o,r]of Gr(s))if(!r||!t.find(({item_id:l})=>l===r.itemId)){this.$progressData.setKey(o,void 0);continue}for(const o of t){const r=s[o.item_id];if(o.status==="canceled"||o.status==="failed"){this.$progressData.setKey(o.item_id,{...r??hf(o.item_id),progressEvent:null,progressImage:null,imageDTO:null});continue}if(o.status==="in_progress"){this.$lastStartedItemId.get()===o.item_id&&this._app?.getAutoSwitch()==="switch_on_start"&&(this.$selectedItemId.set(o.item_id),this.$lastStartedItemId.set(null));continue}if(o.status==="completed"){if(r?.imageDTO)continue;const l=Rit(o);if(!l)continue;const c=await this._app?.getImageDTO(l);if(!c)continue;this.$progressData.setKey(o.item_id,{...r??hf(o.item_id),imageDTO:c})}}const i=this.$selectedItemId.get();if(i!==null&&!t.find(({item_id:o})=>o===i)){const o=n.findIndex(({item_id:r})=>r===i);if(o!==-1){const r=t[o]??t[o-1];r&&this.$selectedItemId.set(r.item_id)}else{const r=t.find(({status:l})=>l==="in_progress");r&&this.$selectedItemId.set(r.item_id),this.$selectedItemId.set(t[0]?.item_id??null)}}this.$items.set(t)};onImageLoaded=t=>{const n=this.$items.get().find(({item_id:i})=>i===t);if(!n)return;this.$lastCompletedItemId.get()===n.item_id&&this._app?.getAutoSwitch()==="switch_on_finish"&&(this.$selectedItemId.set(n.item_id),this.$lastCompletedItemId.set(null));const s=this.$progressData.get()[n.item_id];this.$progressData.setKey(n.item_id,{...s??hf(n.item_id),imageLoaded:!0})};buildIsSelectedComputed=t=>Ut([this.$selectedItemId],n=>n===t);cleanup=()=>{this.$lastStartedItemId.set(null),this.$lastCompletedItemId.set(null),this.$items.set([]),this.$progressData.set({}),this.$selectedItemId.set(null),this._subscriptions.forEach(t=>t()),this._subscriptions.clear()}}const Nit=(e,t)=>{const n=e.get(),i={...n[t.item_id]??hf(t.item_id)};i.progressEvent=t,t.image&&(i.progressImage=t.image),e.set({...n,[t.item_id]:i})},Mue=h.createContext(null),Lue=h.memo(({children:e,sessionId:t})=>{const n=Ze(),s=le(E_),i=h.useMemo(()=>{const r=kwe(t);return{getAutoSwitch:()=>$M(n.getState()),getImageDTO:c=>fh(c),onInvocationProgress:c=>(s?.on("invocation_progress",c),()=>{s?.off("invocation_progress",c)}),onQueueItemStatusChanged:c=>(s?.on("queue_item_status_changed",c),()=>{s?.off("queue_item_status_changed",c)}),onItemsChanged:c=>{let d=[];return n.subscribe(()=>{const u=r(n.getState());d!==u&&(d=u,c(u))})},onDiscard:({item_id:c,status:d})=>{n.dispatch(Iwe({itemId:c})),(d==="in_progress"||d==="pending")&&n.dispatch(mi.endpoints.cancelQueueItem.initiate({item_id:c},{track:!1}))},onDiscardAll:()=>{n.dispatch(tR()),n.dispatch(mi.endpoints.cancelQueueItemsByDestination.initiate({destination:t},{track:!1}))},onAccept:(c,d)=>{const u=Kw(n.getState()),{x:p,y:m}=u,f=_o(d),g=$n(n.getState()),v={position:{x:p,y:m},objects:[f]};n.dispatch(em({overrides:v,isSelected:g?.type==="raster_layer"})),n.dispatch(tR()),n.dispatch(mi.endpoints.cancelQueueItemsByDestination.initiate({destination:t},{track:!1}))},onAutoSwitchChange:c=>{n.dispatch(J0(c))}}},[t,s,n]),[o]=h.useState(()=>new Oit);return h.useEffect(()=>{o.connectToApp(t,i);const{unsubscribe:r}=n.dispatch(mi.endpoints.listAllQueueItems.initiate({destination:t}));return()=>{o.cleanup(),r()}},[t,o,i,n]),a.jsx(Mue.Provider,{value:o,children:e})});Lue.displayName="StagingAreaContextProvider";const Ta=()=>{const e=h.useContext(Mue);return ae(e!==null,"'useStagingAreaContext' must be used within a StagingAreaContextProvider"),e},Fit=e=>{const t=Ta();return le(t.$progressData,{keys:[e]})[e]?.imageDTO??null},F8=e=>{const t=Ta();return le(t.$progressData,{keys:[e]})[e]??hf(e)},Bit=ve(Oi,e=>e.activeColor),zit=ve(Oi,e=>e.bgColor),Vit=ve(Oi,e=>e.fgColor),$it=ve(Oi,e=>e.fillColorPickerPinned),Rue=h.memo(()=>{const{t:e}=T(),t=M($it),n=M(Bit),s=M(zit),i=M(Vit),o=Q(),r=h.useMemo(()=>n==="bgColor"?s:i,[n,s,i]),l=h.useCallback(u=>{o(n==="bgColor"?zM(u):VM(u))},[n,o]),c=h.useCallback(()=>o(eP(!1)),[o]),d=h.useCallback(()=>o(eq()),[o]);return t?a.jsx(A,{pointerEvents:"auto",direction:"column",gap:2,children:a.jsxs(A,{direction:"column",p:3,bg:"base.900",borderColor:"base.700",borderWidth:"1px",borderStyle:"solid",shadow:"dark-lg",borderRadius:"base",minW:88,children:[a.jsxs(A,{justifyContent:"space-between",alignItems:"center",mb:2,gap:2,children:[a.jsx(q,{fontWeight:"semibold",color:"base.300",children:e("controlLayers.fill.fillColor")}),a.jsxs(A,{gap:1,children:[a.jsx(oe,{"aria-label":e("controlLayers.fill.switchColors",{defaultValue:"Switch FG/BG (X)"}),tooltip:e("controlLayers.fill.switchColors",{defaultValue:"Switch FG/BG (X)"}),size:"sm",variant:"ghost",onClick:d,icon:a.jsx(JZ,{})}),a.jsx(oe,{"aria-label":e("common.unpin",{defaultValue:"Unpin"}),tooltip:e("common.unpin",{defaultValue:"Unpin"}),size:"sm",variant:"solid",onClick:c,icon:a.jsx(pMe,{})})]})]}),a.jsx(j8,{color:r,onChange:l,withNumberInput:!0,withSwatches:!0})]})}):null});Rue.displayName="PinnedFillColorPickerOverlay";const Oue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M($U),s=h.useCallback(()=>{t(jwe())},[t]);return a.jsxs(te,{children:[a.jsx(ne,{m:0,flexGrow:1,children:e("controlLayers.bboxOverlay")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})});Oue.displayName="CanvasSettingsBboxOverlaySwitch";const Nue=h.memo(()=>{const{t:e}=T(),t=Tt(),n=h.useCallback(()=>{t.cache.clearAll()},[t]);return a.jsx(he,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.clearCaches")})});Nue.displayName="CanvasSettingsClearCachesButton";const Fue=h.memo(()=>{const{t:e}=T(),t=Q(),n=h.useCallback(()=>{t(Tp())},[t]);return a.jsx(he,{onClick:n,size:"sm",children:e("controlLayers.clearHistory")})});Fue.displayName="CanvasSettingsClearHistoryButton";const Git=ve(Oi,e=>e.clipToBbox),Bue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(Git),s=h.useCallback(i=>t(Ewe(i.target.checked)),[t]);return a.jsxs(te,{w:"full",children:[a.jsx(ne,{flexGrow:1,children:e("controlLayers.clipToBbox")}),a.jsx(us,{isChecked:n,onChange:s})]})});Bue.displayName="CanvasSettingsClipToBboxCheckbox";const zue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(q2),s=h.useCallback(()=>{t(Awe())},[t]);return a.jsxs(te,{children:[a.jsx(ne,{m:0,flexGrow:1,children:e("controlLayers.dynamicGrid")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})});zue.displayName="CanvasSettingsDynamicGridSwitch";const Vue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(Pwe),s=h.useCallback(()=>{t(Twe())},[t]);return a.jsxs(te,{w:"full",children:[a.jsx(ne,{flexGrow:1,children:e("controlLayers.settings.snapToGrid.label")}),a.jsx(us,{isChecked:n,onChange:s})]})});Vue.displayName="CanvasSettingsSnapToGrid";const Hit=ve(Oi,e=>e.invertScrollForToolWidth),$ue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(Hit),s=h.useCallback(i=>{t(Dwe(i.target.checked))},[t]);return a.jsxs(te,{w:"full",children:[a.jsx(ne,{flexGrow:1,children:e("controlLayers.settings.invertBrushSizeScrollDirection")}),a.jsx(us,{isChecked:n,onChange:s})]})});$ue.displayName="CanvasSettingsInvertScrollCheckbox";const Gue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(U2),s=h.useCallback(()=>{t(BU())},[t]);return a.jsxs(te,{children:[a.jsx(ne,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedLayerPreview")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})});Gue.displayName="CanvasSettingsIsolatedLayerPreviewSwitch";const Hue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(JA),s=h.useCallback(()=>{t(Mwe())},[t]);return a.jsxs(te,{children:[a.jsx(ne,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedStagingPreview")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})});Hue.displayName="CanvasSettingsIsolatedStagingPreviewSwitch";const Wue=h.memo(()=>{const{t:e}=T(),t=Tt(),n=h.useCallback(()=>{t.logDebugInfo()},[t]);return a.jsx(he,{onClick:n,size:"sm",children:e("controlLayers.logDebugInfo")})});Wue.displayName="CanvasSettingsLogDebugInfoButton";const Uue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(Lwe),s=h.useCallback(()=>{t(Rwe())},[t]);return a.jsxs(te,{w:"full",children:[a.jsx(ne,{flexGrow:1,children:e("controlLayers.outputOnlyMaskedRegions")}),a.jsx(us,{isChecked:n,onChange:s})]})});Uue.displayName="CanvasSettingsOutputOnlyMaskedRegionsCheckbox";const que=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(FU),s=h.useCallback(()=>t(Owe()),[t]);return a.jsxs(te,{w:"full",children:[a.jsx(ne,{flexGrow:1,children:e("controlLayers.settings.preserveMask.label")}),a.jsx(us,{isChecked:n,onChange:s})]})});que.displayName="CanvasSettingsPreserveMaskCheckbox";const Kue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(Nwe),s=h.useCallback(()=>{t(Fwe())},[t]);return a.jsxs(te,{w:"full",children:[a.jsx(ne,{flexGrow:1,children:e("controlLayers.settings.pressureSensitivity")}),a.jsx(us,{isChecked:n,onChange:s})]})});Kue.displayName="CanvasSettingsPressureSensitivityCheckbox";const Zue=h.memo(()=>{const{t:e}=T(),t=Tt(),n=h.useCallback(()=>{for(const s of t.getAllAdapters())s.transformer.requestRectCalculation()},[t]);return a.jsx(he,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.recalculateRects")})});Zue.displayName="CanvasSettingsRecalculateRectsButton";const Xue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(ZU),s=h.useCallback(()=>{t(Bwe())},[t]);return a.jsxs(te,{children:[a.jsx(ne,{m:0,flexGrow:1,children:e("controlLayers.ruleOfThirds")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})});Xue.displayName="CanvasSettingsRuleOfThirdsSwitch";const Yue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(ZD),s=h.useCallback(()=>{t(zwe())},[t]);return a.jsxs(te,{w:"full",children:[a.jsx(ne,{flexGrow:1,children:e("controlLayers.settings.saveAllImagesToGallery.label")}),a.jsx(us,{isChecked:n,onChange:s})]})});Yue.displayName="CanvasSettingsSaveAllImagesToGalleryCheckbox";const Wit=ve(Oi,e=>e.showHUD),Que=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(Wit),s=h.useCallback(()=>{t(Vwe())},[t]);return a.jsxs(te,{children:[a.jsx(ne,{m:0,flexGrow:1,children:e("controlLayers.showHUD")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})});Que.displayName="CanvasSettingsShowHUDSwitch";const Jue=h.memo(()=>{const{t:e}=T(),t=Q(),n=M($we),s=h.useCallback(()=>{t(Gwe())},[t]);return a.jsxs(te,{children:[a.jsx(ne,{m:0,flexGrow:1,children:e("controlLayers.showProgressOnCanvas")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:s})]})});Jue.displayName="CanvasSettingsShowProgressOnCanvas";const ehe=h.memo(()=>{const{t:e}=T();return a.jsxs(yi,{isLazy:!0,children:[a.jsx(Ni,{children:a.jsx(oe,{"aria-label":e("common.settingsLabel"),icon:a.jsx(f1,{}),variant:"link",alignSelf:"stretch"})}),a.jsx(Ls,{children:a.jsxs(bi,{maxW:"280px",children:[a.jsx(hr,{}),a.jsx(Fi,{children:a.jsxs(A,{direction:"column",gap:2,children:[a.jsxs(A,{direction:"column",gap:1,children:[a.jsxs(A,{align:"center",gap:2,children:[a.jsx(Je,{as:RMe,boxSize:4}),a.jsx(q,{fontWeight:"bold",fontSize:"sm",color:"base.100",children:e("hotkeys.canvas.settings.behavior")})]}),a.jsx($ue,{}),a.jsx(Kue,{}),a.jsx(que,{}),a.jsx(Bue,{}),a.jsx(Uue,{}),a.jsx(Yue,{})]}),a.jsx(vt,{}),a.jsxs(A,{direction:"column",gap:1,children:[a.jsxs(A,{align:"center",gap:2,color:"base.200",children:[a.jsx(Je,{as:LMe,boxSize:4}),a.jsx(q,{fontWeight:"bold",fontSize:"sm",children:e("hotkeys.canvas.settings.display")})]}),a.jsx(Jue,{}),a.jsx(Hue,{}),a.jsx(Gue,{}),a.jsx(Oue,{}),a.jsx(Que,{})]}),a.jsx(vt,{}),a.jsxs(A,{direction:"column",gap:1,children:[a.jsxs(A,{align:"center",gap:2,color:"base.200",children:[a.jsx(Je,{as:FMe,boxSize:4}),a.jsx(q,{fontWeight:"bold",fontSize:"sm",children:e("hotkeys.canvas.settings.grid")})]}),a.jsx(Vue,{}),a.jsx(zue,{}),a.jsx(Xue,{})]}),a.jsx(Uit,{})]})})]})})]})});ehe.displayName="CanvasSettingsPopover";const Uit=()=>{const{t:e}=T();return Jr()?a.jsxs(a.Fragment,{children:[a.jsx(vt,{}),a.jsxs(A,{direction:"column",gap:1,children:[a.jsxs(A,{align:"center",gap:2,color:"base.200",children:[a.jsx(Je,{as:TMe,boxSize:4}),a.jsx(q,{fontWeight:"bold",fontSize:"sm",children:e("hotkeys.canvas.settings.debug")})]}),a.jsx(Nue,{}),a.jsx(Zue,{}),a.jsx(Wue,{}),a.jsx(Fue,{})]})]}):null},qit=ve(Oi,e=>e.activeColor),Kit=ve(Oi,e=>e.bgColor),Zit=ve(Oi,e=>e.fgColor),the=h.memo(()=>{const{t:e}=T(),t=jo(),n=M(Hwe),s=M(qit),i=M(Kit),o=M(Zit),{activeColor:r,tooltip:l,bgColorzIndex:c,fgColorzIndex:d}=h.useMemo(()=>s==="bgColor"?{activeColor:i,tooltip:e("controlLayers.fill.bgFillColor"),bgColorzIndex:2,fgColorzIndex:1}:{activeColor:o,tooltip:e("controlLayers.fill.fgFillColor"),bgColorzIndex:1,fgColorzIndex:2},[s,i,o,e]),u=Q(),p=h.useCallback(g=>{u(s==="bgColor"?zM(g):VM(g))},[s,u]),m=h.useCallback(()=>{t.onClose()},[t]),f=h.useCallback(()=>{n?u(eP(!1)):(u(eP(!0)),t.onClose())},[u,t,n]);return Be({id:"setFillColorsToDefault",category:"canvas",callback:()=>u(Wwe()),options:{preventDefault:!0},dependencies:[u]}),Be({id:"toggleFillColor",category:"canvas",callback:()=>u(eq()),options:{preventDefault:!0},dependencies:[u]}),a.jsxs(yi,{isLazy:!0,isOpen:!n&&t.isOpen,onOpen:t.onOpen,onClose:m,closeOnBlur:!0,closeOnEsc:!0,returnFocusOnClose:!0,children:[a.jsx(Ni,{children:a.jsx(A,{role:"button","aria-label":e("controlLayers.fill.fillColor"),tabIndex:-1,minW:8,w:8,h:8,children:a.jsx(He,{label:l,children:a.jsxs(A,{alignItems:"center",justifyContent:"center",position:"relative",w:"full",h:"full",children:[a.jsx(ke,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:Bo(i),position:"absolute",top:"0",left:"0",zIndex:c}),a.jsx(ke,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:Bo(o),position:"absolute",top:"2",left:"2",zIndex:d})]})})})}),a.jsx(Ls,{children:a.jsxs(bi,{minW:96,children:[a.jsx(hr,{}),a.jsx(Fi,{minH:64,children:a.jsxs(A,{direction:"column",gap:2,children:[a.jsx(A,{justifyContent:"flex-end",alignItems:"center",children:a.jsx(oe,{"aria-label":n?"Unpin color picker":"Pin color picker",tooltip:n?"Unpin":"Pin",size:"sm",variant:n?"solid":"ghost",onClick:f,icon:a.jsx(hMe,{})})}),a.jsx(j8,{color:r,onChange:p,withNumberInput:!0,withSwatches:!0})]})})]})})]})});the.displayName="ToolFillColorPicker";const nhe=e=>`${e} px`;function she(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function ih(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function ihe(e){return`${String(she(e))} px`}const ohe=[ih(1),ih(50),ih(200),ih(600)],ahe=ih(50),rhe=280,lhe=h.memo(({localValue:e,onChangeSlider:t,onChangeInput:n,onKeyDown:s,onBlur:i})=>{const o=h.useCallback((r,l)=>{n(l)},[n]);return a.jsxs(yi,{children:[a.jsx(te,{w:"min-content",gap:2,overflow:"hidden",children:a.jsx(f_,{children:a.jsxs(SM,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:e,onChange:o,onBlur:i,w:76,format:nhe,defaultValue:50,onKeyDown:s,clampValueOnBlur:!1,children:[a.jsx(kM,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),a.jsx(Ni,{children:a.jsx(oe,{"aria-label":"open-slider",icon:a.jsx(Do,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})}),a.jsx(Ls,{children:a.jsxs(bi,{w:200,pt:0,pb:2,px:4,children:[a.jsx(hr,{}),a.jsx(Fi,{children:a.jsx(it,{min:0,max:100,value:ih(e),onChange:t,defaultValue:ahe,marks:ohe,formatValue:ihe,alwaysShowMarks:!0})})]})})]})});lhe.displayName="DropDownToolWidthPickerComponent";const che=h.memo(({localValue:e,onChangeSlider:t,onChangeInput:n,onKeyDown:s,onBlur:i})=>a.jsxs(A,{w:rhe,gap:4,children:[a.jsx(it,{w:200,h:"unset",min:0,max:100,value:ih(e),onChange:t,defaultValue:ahe,marks:ohe,formatValue:ihe,alwaysShowMarks:!0}),a.jsx(Pe,{w:28,variant:"outline",min:1,max:600,value:e,onChange:n,onBlur:i,onKeyDown:s,format:nhe,defaultValue:50})]}));che.displayName="SliderToolWidthPickerComponent";const Xit=ve(Oi,e=>e.brushWidth),Yit=ve(Oi,e=>e.eraserWidth),dhe=h.memo(()=>{const e=h.useRef(null),t=Q(),n=Xr("brush"),s=Xr("eraser"),i=h.useMemo(()=>n||s,[n,s]),o=M(Xit),r=M(Yit),l=h.useMemo(()=>n?o:s?r:0,[n,s,o,r]),[c,d]=h.useState(l),[u,p]=h.useState(null);h.useEffect(()=>{const w=e.current;if(!w)return;const _=new ResizeObserver(S=>{for(let I of S)I.contentRect.width>rhe?p("slider"):p("dropdown")});return _.observe(w),()=>{_.disconnect()}},[]);const m=h.useCallback(w=>{n?t(YU(w)):s&&t(QU(w))},[n,s,t]),f=h.useCallback(w=>{m(fi(Math.round(w),1,600))},[m]),g=h.useCallback(()=>{let w=Math.round(l*1.15);w===l&&(w+=1),f(w)},[f,l]),v=h.useCallback(()=>{let w=Math.round(l*.85);w===l&&(w-=1),f(w)},[f,l]),b=h.useCallback(w=>{f(she(w))},[f]),C=h.useCallback(w=>{d(w)},[]),y=h.useCallback(()=>{isNaN(Number(c))?(f(50),d(50)):f(c)},[c,f]),x=h.useCallback(w=>{w.key==="Enter"&&y()},[y]);return h.useEffect(()=>{d(l)},[l]),Be({id:"decrementToolWidth",category:"canvas",callback:v,options:{enabled:i},dependencies:[v,i]}),Be({id:"incrementToolWidth",category:"canvas",callback:g,options:{enabled:i},dependencies:[g,i]}),a.jsxs(A,{ref:e,alignItems:"center",h:"full",flexGrow:1,flexShrink:1,justifyContent:"flex-start",px:4,children:[u==="slider"&&a.jsx(che,{localValue:c,onChangeSlider:b,onChangeInput:C,onBlur:y,onKeyDown:x}),u==="dropdown"&&a.jsx(lhe,{localValue:c,onChangeSlider:b,onChangeInput:C,onBlur:y,onKeyDown:x})]})});dhe.displayName="ToolWidthPicker";const uhe=h.memo(()=>{const{t:e}=T(),t=Tt(),n=xt(),s=So("canvas"),i=h.useCallback(()=>{t.tool.tools.bbox.fitToLayers(),t.stage.fitLayersToStage()},[t.tool.tools.bbox,t.stage]);return Be({id:"fitBboxToLayers",category:"canvas",callback:()=>{t.tool.tools.bbox.fitToLayers(),t.stage.fitLayersToStage()},options:{enabled:s&&!n,preventDefault:!0},dependencies:[s,n]}),a.jsx(oe,{onClick:i,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.fitBboxToLayers"),tooltip:e("controlLayers.fitBboxToLayers"),icon:a.jsx(gMe,{}),isDisabled:n})});uhe.displayName="CanvasToolbarFitBboxToLayersButton";const Qit=()=>{const e=Tt(),t=M(IU);return h.useCallback(()=>{const s=e.compositor.getVisibleRectOfType("inpaint_mask");if(s.height===0||s.width===0)return;const o=t+8,r={x:s.x-o,y:s.y-o,width:s.width+o*2,height:s.height+o*2},l=e.stateApi.getBboxGridSize(),c=GU(r,l);e.stateApi.setGenerationBbox(c)},[e,t])},hhe=h.memo(()=>{const{t:e}=T(),t=xt(),n=Qit(),i=Dee("inpaint_mask")>0,o=h.useCallback(()=>{n()},[n]);return Be({id:"fitBboxToMasks",category:"canvas",callback:n,options:{enabled:!t&&i},dependencies:[n,t,i]}),a.jsx(oe,{onClick:o,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.fitBboxToMasks"),tooltip:e("controlLayers.fitBboxToMasks"),icon:a.jsx(EMe,{}),isDisabled:t||!i})});hhe.displayName="CanvasToolbarFitBboxToMasksButton";const phe=h.memo(()=>{const{t:e}=T();return a.jsxs(An,{placement:"bottom-end",children:[a.jsx(Pn,{as:oe,"aria-label":e("controlLayers.newSession"),icon:a.jsx(Q_,{}),variant:"link",alignSelf:"stretch"}),a.jsx(Zt,{children:a.jsx(x8,{})})]})});phe.displayName="CanvasToolbarNewSessionMenuButton";const fhe=h.memo(()=>{const{t:e}=T(),t=Q(),n=xt(),s=M(tq),i=h.useCallback(()=>{t(nq())},[t]);return a.jsx(oe,{"aria-label":e("hotkeys.canvas.redo.title"),tooltip:e("hotkeys.canvas.redo.title"),onClick:i,icon:a.jsx(_De,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});fhe.displayName="CanvasToolbarRedoButton";const mhe=h.memo(()=>{const{t:e}=T(),t=Tt(),n=So("canvas"),s=h.useCallback(()=>{t.stage.fitLayersToStage()},[t.stage]);return Be({id:"fitLayersToCanvas",category:"canvas",callback:()=>t.stage.fitLayersToStage(),options:{enabled:n,preventDefault:!0},dependencies:[n]}),Be({id:"fitBboxToCanvas",category:"canvas",callback:()=>t.stage.fitBboxToStage(),options:{enabled:n,preventDefault:!0},dependencies:[n]}),Be({id:"setZoomTo100Percent",category:"canvas",callback:()=>t.stage.setScale(1),options:{enabled:n,preventDefault:!0},dependencies:[n]}),Be({id:"setZoomTo200Percent",category:"canvas",callback:()=>t.stage.setScale(2),options:{enabled:n,preventDefault:!0},dependencies:[n]}),Be({id:"setZoomTo400Percent",category:"canvas",callback:()=>t.stage.setScale(4),options:{enabled:n,preventDefault:!0},dependencies:[n]}),Be({id:"setZoomTo800Percent",category:"canvas",callback:()=>t.stage.setScale(8),options:{enabled:n,preventDefault:!0},dependencies:[n]}),a.jsx(oe,{tooltip:e("hotkeys.canvas.fitLayersToCanvas.title"),"aria-label":e("hotkeys.canvas.fitLayersToCanvas.title"),onClick:s,icon:a.jsx(X_,{}),variant:"link",alignSelf:"stretch"})});mhe.displayName="CanvasToolbarResetViewButton";const ghe=h.memo(()=>{const{t:e}=T(),t=Jr(),n=xt(),s=lse(),i=cse();return a.jsx(oe,{variant:"link",alignSelf:"stretch",onClick:t?i:s,icon:a.jsx(Ol,{}),"aria-label":e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),colorScheme:"invokeBlue",tooltip:e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),isDisabled:n})});ghe.displayName="CanvasToolbarSaveToGalleryButton";function Jit(e){return isNaN(Number(e))?"":`${Vh(Number(e),2).toLocaleString()}%`}function vhe(e){return e<=40?10+90*e/40:e<=70?100+400*(e-40)/30:500+1500*(e-70)/30}function Uu(e){return e<=100?(e-10)*40/90:e<=500?40+(e-100)*30/400:70+(e-500)*30/1500}function eot(e){return String(vhe(e))}const fD=[Uu(10),Uu(50),Uu(100),Uu(500),Uu(2e3)],tot=Uu(100),not=fD.slice(1,fD.length-1),sot={paddingInlineEnd:7,_focusVisible:{zIndex:0}},yhe=h.memo(()=>{const e=Tt(),t=le(e.stage.$scale),[n,s]=h.useState(t*100),i=h.useCallback(c=>{let d=c;_M.get()||(d=ZW(c,not,2));const u=vhe(d);e.stage.setScale(u/100)},[e]),o=h.useCallback(()=>{if(isNaN(Number(n))){e.stage.setScale(1),s(100);return}e.stage.setScale(n/100)},[e,n]),r=h.useCallback((c,d)=>{s(d)},[]),l=h.useCallback(c=>{c.key==="Enter"&&o()},[o]);return h.useEffect(()=>{s(t*100)},[t]),a.jsxs(A,{alignItems:"center",children:[a.jsx(xhe,{}),a.jsxs(yi,{isLazy:!0,lazyBehavior:"unmount",children:[a.jsx(f_,{children:a.jsxs(SM,{variant:"outline",display:"flex",alignItems:"center",min:e.stage.config.MIN_SCALE*100,max:e.stage.config.MAX_SCALE*100,value:n,onChange:r,onBlur:o,w:"76px",format:Jit,defaultValue:100,onKeyDown:l,clampValueOnBlur:!1,children:[a.jsx(kM,{title:"",sx:sot}),a.jsx(Ni,{children:a.jsx(oe,{"aria-label":"open-slider",icon:a.jsx(Do,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})}),a.jsx(Ls,{children:a.jsxs(bi,{w:200,pt:0,pb:2,px:4,children:[a.jsx(hr,{}),a.jsx(Fi,{children:a.jsx(it,{min:0,max:100,value:Uu(n),onChange:i,defaultValue:tot,marks:fD,formatValue:eot,alwaysShowMarks:!0})})]})})]}),a.jsx(Che,{})]})});yhe.displayName="CanvasToolbarScale";const bhe=[.1,.15,.2,.25,.5,.75,1,1.5,2,2.5,5,7.5,10,15,20],xhe=h.memo(()=>{const e=Tt(),t=le(e.stage.$scale),n=h.useCallback(()=>{const s=e.stage.$scale.get(),i=bhe.slice().reverse().find(o=>o<s)??e.stage.config.MIN_SCALE;e.stage.setScale(Math.max(i,e.stage.config.MIN_SCALE))},[e.stage]);return a.jsx(oe,{onClick:n,icon:a.jsx(uX,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t<=e.stage.config.MIN_SCALE})});xhe.displayName="ZoomOutButton";const Che=h.memo(()=>{const e=Tt(),t=le(e.stage.$scale),n=h.useCallback(()=>{const s=e.stage.$scale.get(),i=bhe.find(o=>o>s)??e.stage.config.MAX_SCALE;e.stage.setScale(Math.min(i,e.stage.config.MAX_SCALE))},[e.stage]);return a.jsx(oe,{onClick:n,icon:a.jsx(hX,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t>=e.stage.config.MAX_SCALE})});Che.displayName="ZoomInButton";const whe=h.memo(()=>{const{t:e}=T(),t=Q(),n=xt(),s=M(sq),i=h.useCallback(()=>{t(iq())},[t]);return a.jsx(oe,{"aria-label":e("hotkeys.canvas.undo.title"),tooltip:e("hotkeys.canvas.undo.title"),onClick:i,icon:a.jsx(Gs,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});whe.displayName="CanvasToolbarUndoButton";function _he(){mn(_he.name);const e=Q(),t=M($n),n=xt(),s=h.useCallback(()=>{t===null||n||Yy()!=="layers"||e(bM({entityIdentifier:t}))},[e,n,t]);Be({id:"deleteSelected",category:"canvas",callback:s,dependencies:[s]})}const iot=()=>{const e=Q(),[t,n]=h.useState(null),[s,i]=h.useState(null),o=M($n),r=M(Uwe);h.useEffect(()=>{s?.id!==o?.id&&(n(s),i(o))},[s,o]);const l=h.useCallback(()=>{r?s?.id!==r.id?(n(s),i(r),e(pf({entityIdentifier:r}))):t&&(i(t),e(pf({entityIdentifier:t}))):t!==null&&s!==null&&(n(s),i(t),e(pf({entityIdentifier:t})))},[r,s,e,t]);Be({id:"quickSwitch",category:"canvas",callback:l,dependencies:[l]})},oot=()=>{mn("useCanvasFilterHotkey");const e=M($n),t=VS(e);Be({id:"filterSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})},aot=()=>{mn("useCanvasInvertMaskHotkey");const e=M($n),t=xt(),n=Nie(),s=h.useMemo(()=>!(!e||!wM(e)||t),[e,t]);Be({id:"invertMask",category:"canvas",callback:n,options:{enabled:s,preventDefault:!0},dependencies:[n,s]})};function She(){mn(She.name);const e=Q(),t=M($n),n=xt(),s=ac(t),i=tl(t),o=h.useCallback(()=>{t===null||s===null||(s.bufferRenderer.clearBuffer(),e(XU({entityIdentifier:t})))},[s,e,t]),r=h.useMemo(()=>t!==null&&XA(t),[t]);Be({id:"resetSelected",category:"canvas",callback:o,options:{enabled:r&&!n&&!i},dependencies:[r,n,i,o]})}const rot=()=>{const e=Tt(),t=h.useCallback(()=>{e.tool.tools.bbox.toggleBboxVisibility()},[e]);Be({id:"toggleBbox",category:"canvas",callback:t,dependencies:[t]})},lot=()=>{const e=Q(),t=h.useCallback(()=>{e(XW())},[e]);Be({id:"toggleNonRasterLayers",category:"canvas",callback:t,dependencies:[t]})},cot=()=>{mn("useCanvasTransformHotkey");const e=M($n),t=W6(e);Be({id:"transformSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})},dot=()=>{mn("useCanvasUndoRedo");const e=o_(),t=xt(),n=M(sq),s=h.useCallback(()=>{e(iq())},[e]);Be({id:"undo",category:"canvas",callback:s,options:{enabled:n&&!t,preventDefault:!0},dependencies:[n,t,s]});const i=M(tq),o=h.useCallback(()=>{e(nq())},[e]);Be({id:"redo",category:"canvas",callback:o,options:{enabled:i&&!t,preventDefault:!0},dependencies:[i,o,t]})},uot=Yn(rt,e=>{const t=e.selectedEntityIdentifier,n=oq(e);let s=null;if(!t)s=n[0]??null;else{const i=n.findIndex(o=>o.id===t.id);s=n[(i+1)%n.length]??null}return s?xa(s):null}),hot=Yn(rt,e=>{const t=e.selectedEntityIdentifier,n=oq(e);let s=null;if(!t)s=n[0]??null;else{const i=n.findIndex(o=>o.id===t.id);s=n[(i-1+n.length)%n.length]??null}return s?xa(s):null}),pot=()=>{mn("useNextPrevEntityHotkeys");const e=Q(),t=M(uot),n=M(hot),s=h.useCallback(()=>{t&&e(pf({entityIdentifier:t}))},[e,t]),i=h.useCallback(()=>{n&&e(pf({entityIdentifier:n}))},[e,n]);Ul([""],i,{preventDefault:!0,ignoreModifiers:!0},[i]),Be({category:"canvas",id:"prevEntity",callback:i,options:{preventDefault:!0},dependencies:[i]}),Ul([""],s,{preventDefault:!0,ignoreModifiers:!0},[s]),Be({category:"canvas",id:"nextEntity",callback:s,options:{preventDefault:!0},dependencies:[s]})},khe=h.memo(()=>{const e=Xr("brush"),t=Xr("eraser"),n=h.useMemo(()=>e||t,[e,t]);return She(),_he(),dot(),iot(),pot(),cot(),oot(),aot(),lot(),rot(),a.jsxs(A,{w:"full",gap:2,alignItems:"center",px:2,children:[a.jsxs(A,{alignItems:"center",h:"full",flexGrow:1,children:[a.jsx(the,{}),n&&a.jsx(dhe,{})]}),a.jsxs(A,{alignItems:"center",h:"full",children:[a.jsx(yhe,{}),a.jsx(mhe,{}),a.jsx(uhe,{}),a.jsx(hhe,{})]}),a.jsx(vt,{orientation:"vertical"}),a.jsxs(A,{alignItems:"center",h:"full",children:[a.jsx(ghe,{}),a.jsx(whe,{}),a.jsx(fhe,{}),a.jsx(phe,{}),a.jsx(ehe,{})]})]})});khe.displayName="CanvasToolbar";const fot=Ds(["fill","contain","cover"]),Ihe=h.memo(({adapter:e})=>{const{t}=T(),[n,s]=h.useState("contain"),i=le(e.transformer.$isProcessing),o=h.useCallback(()=>{if(n==="contain"){e.transformer.fitToBboxContain();return}if(n==="cover"){e.transformer.fitToBboxCover();return}if(n==="fill"){e.transformer.fitToBboxFill();return}ae(!1)},[e.transformer,n]),r=h.useMemo(()=>[{value:"contain",label:t("controlLayers.transform.fitModeContain")},{value:"cover",label:t("controlLayers.transform.fitModeCover")},{value:"fill",label:t("controlLayers.transform.fitModeFill")}],[t]),l=h.useMemo(()=>r.find(d=>d.value===n)??null,[r,n]),c=h.useCallback(d=>{d&&s(fot.parse(d.value))},[]);return a.jsxs(A,{gap:4,w:"full",children:[a.jsxs(te,{maxW:64,children:[a.jsx(ne,{m:0,children:t("controlLayers.transform.fitMode")}),a.jsx(pt,{options:r,value:l,onChange:c,isSearchable:!1,isClearable:!1})]}),a.jsx(he,{size:"sm",onClick:o,isDisabled:i,loadingText:t("controlLayers.transform.fitToBbox"),variant:"ghost",children:t("controlLayers.transform.fitToBbox")})]})});Ihe.displayName="TransformFitToBboxButtons";const jhe=h.memo(({adapter:e})=>{const{t}=T(),n=h.useRef(null);Qy("canvas",n,{focusOnMount:!0});const s=So("canvas"),i=le(e.transformer.$isProcessing),o=le(e.transformer.$silentTransform);return Be({id:"applyTransform",category:"canvas",callback:e.transformer.applyTransform,options:{enabled:!i&&s},dependencies:[e.transformer,i,s]}),Be({id:"cancelTransform",category:"canvas",callback:e.transformer.stopTransform,options:{enabled:!i&&s},dependencies:[e.transformer,i,s]}),o?null:a.jsxs(A,{ref:n,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[a.jsxs(A,{w:"full",gap:4,children:[a.jsx(Pt,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.transform.transform")}),a.jsx(At,{}),a.jsx(Ck,{})]}),a.jsx(Ihe,{adapter:e}),a.jsxs(zn,{isAttached:!1,size:"sm",w:"full",alignItems:"center",children:[i&&a.jsx(ao,{ms:3,boxSize:5,color:"base.600"}),a.jsx(At,{}),a.jsx(he,{onClick:e.transformer.resetTransform,isDisabled:i,loadingText:t("controlLayers.transform.reset"),variant:"ghost",children:t("controlLayers.transform.reset")}),a.jsx(he,{onClick:e.transformer.applyTransform,isDisabled:i,loadingText:t("controlLayers.transform.apply"),variant:"ghost",children:t("controlLayers.transform.apply")}),a.jsx(he,{onClick:e.transformer.stopTransform,isDisabled:i,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.transform.cancel")})]})]})});jhe.displayName="TransformContent";const mot=()=>{const e=Tt(),t=le(e.stateApi.$transformingAdapter);return t?a.jsx(jhe,{adapter:t}):null},got={circle:{transitionProperty:"none",transitionDuration:"0s"},position:"absolute",top:2,right:2},Ehe=h.memo(({itemId:e,status:t,...n})=>{const{progressEvent:s}=F8(e);return t!=="in_progress"?null:a.jsx(He,{label:Mit(s),children:a.jsx(W2,{size:"14px",color:"invokeBlue.500",thickness:14,isIndeterminate:!s||s.percentage===null,value:s?.percentage?s.percentage*100:void 0,sx:got,...n})})});Ehe.displayName="QueueItemCircularProgress";const Ahe=h.memo(({itemId:e,...t})=>{const{progressImage:n,imageLoaded:s}=F8(e);return!n||s?null:a.jsx(Nn,{objectFit:"contain",maxH:"full",maxW:"full",draggable:!1,src:n.dataURL,width:n.width,height:n.height,...t})});Ahe.displayName="QueueItemProgressImage";const Phe=h.memo(({item:e,...t})=>{const{progressImage:n}=F8(e.item_id);return n?null:e.status==="pending"?a.jsx(q,{fontSize:"xs",pointerEvents:"none",userSelect:"none",fontWeight:"semibold",color:"base.300",...t,children:"Pending"}):e.status==="canceled"?a.jsx(q,{fontSize:"xs",pointerEvents:"none",userSelect:"none",fontWeight:"semibold",color:"warning.300",...t,children:"Canceled"}):e.status==="failed"?a.jsx(q,{fontSize:"xs",pointerEvents:"none",userSelect:"none",fontWeight:"semibold",color:"error.300",...t,children:"Failed"}):e.status==="in_progress"?a.jsx(q,{fontSize:"xs",pointerEvents:"none",userSelect:"none",fontWeight:"semibold",color:"invokeBlue.300",...t,children:"In Progress"}):e.status==="completed"?a.jsx(q,{fontSize:"xs",pointerEvents:"none",userSelect:"none",fontWeight:"semibold",color:"invokeGreen.300",...t,children:"Completed"}):null});Phe.displayName="QueueItemStatusLabel";const The=h.memo(({number:e,...t})=>a.jsx(q,{pointerEvents:"none",userSelect:"none",filter:Lit,...t,children:`#${e}`}));The.displayName="QueueItemNumber";const vot={cursor:"pointer",userSelect:"none",pos:"relative",alignItems:"center",justifyContent:"center",flexShrink:0,h:"full",aspectRatio:"1/1",borderWidth:2,borderRadius:"base",bg:"base.900",overflow:"hidden",'&[data-selected="true"]':{borderColor:"invokeBlue.300"}},Dhe=h.memo(({item:e,index:t})=>{const n=Ta(),s=Q(),i=h.useMemo(()=>n.buildIsSelectedComputed(e.item_id),[n,e.item_id]),o=le(i),r=Fit(e.item_id),l=M($M),c=h.useCallback(()=>{n.select(e.item_id)},[n,e.item_id]),d=h.useCallback(()=>{l!=="off"&&(s(J0("off")),pe({title:"Auto-Switch Disabled"}))},[l,s]),u=h.useCallback(()=>{n.onImageLoaded(e.item_id)},[n,e.item_id]);return a.jsxs(A,{id:Due(t),sx:vot,"data-selected":o,onClick:c,onDoubleClick:d,children:[a.jsx(Phe,{item:e,position:"absolute",margin:"auto"}),r&&a.jsx(lc,{imageDTO:r,position:"absolute",onLoad:u}),a.jsx(Ahe,{itemId:e.item_id,position:"absolute"}),a.jsx(The,{number:t+1,position:"absolute",top:0,left:1}),a.jsx(Ehe,{itemId:e.item_id,status:e.status,position:"absolute",top:1,right:2})]})});Dhe.displayName="QueueItemPreviewMini";const yot=Ft("system").child({filePath:"features/controlLayers/components/StagingArea/StagingAreaItemsList.tsx"}),bot={width:"100%",height:"72px"},xot=(e,t,n,s)=>{if(s.endIndex===0)return;const i=t.querySelector(`#${Due(e)}`);if(!i){e>s.endIndex?n.scrollToIndex({index:e,behavior:"auto",align:"end"}):e<s.startIndex?n.scrollToIndex({index:e,behavior:"auto",align:"start"}):yot.debug(`Unable to find queue item at index ${e} but it is in the rendered range ${s.startIndex}-${s.endIndex}`);return}const o=i.getBoundingClientRect(),r=t.getBoundingClientRect();o.left<r.left?n.scrollToIndex({index:e,behavior:"auto",align:"start"}):o.right>r.right&&n.scrollToIndex({index:e,behavior:"auto",align:"end"})},Cot=e=>{const[t,n]=h.useState(null),[s,i]=SS({defer:!0,events:{initialized(o){const{viewport:r}=o.elements();r.style.overflowX="var(--os-viewport-overflow-x)",r.style.overflowY="var(--os-viewport-overflow-y)",r.style.textAlign="center"}},options:{scrollbars:{visibility:"auto",autoHide:"scroll",autoHideDelay:1300,theme:"os-theme-dark"},overflow:{y:"hidden",x:"scroll"}}});return h.useEffect(()=>{const{current:o}=e;return t&&o&&s({target:o,elements:{viewport:t}}),()=>{i()?.destroy()}},[t,s,i,e]),n},Mhe=h.memo(()=>{const e=Tt(),t=Ta(),n=h.useRef(null),s=h.useRef({startIndex:0,endIndex:0}),i=h.useRef(null),o=le(t.$items),r=Cot(i);h.useEffect(()=>e.stagingArea.connectToSession(t.$items,t.$selectedItem),[e,t.$progressData,t.$items,t.$selectedItem]),h.useEffect(()=>t.$selectedItemIndex.listen(c=>{c!==null&&n.current&&i.current&&xot(c,i.current,n.current,s.current)}),[t.$selectedItemIndex]);const l=h.useCallback(c=>{s.current=c},[]);return a.jsx(ke,{"data-overlayscrollbars-initialize":"",ref:i,position:"relative",w:"full",h:"full",children:a.jsx(Doe,{ref:n,data:o,horizontalDirection:!0,style:bot,computeItemKey:wot,increaseViewportBy:2048,itemContent:_ot,components:kot,rangeChanged:l,scrollerRef:r})})});Mhe.displayName="StagingAreaItemsList";const wot=(e,t)=>t.item_id,_ot=(e,t)=>a.jsx(Dhe,{item:t,index:e},`${t.item_id}-mini`),Sot={"& > * + *":{pl:2},'&[data-disabled="true"]':{filter:"grayscale(1) opacity(0.5)"}},kot={List:rm(({context:e,...t},n)=>{const s=Tt(),i=le(s.stagingArea.$shouldShowStagedImage);return a.jsx(A,{ref:n,sx:Sot,"data-disabled":!i,...t})})},Iot={withToast:!0},Lhe=()=>{const e=le(ks),[t,{isLoading:n}]=qwe(),{t:s}=T();return{trigger:h.useCallback(async(o,r)=>{const{withToast:l}={...Iot,...r};try{await t({destination:o}).unwrap(),l&&pe({id:"QUEUE_CANCEL_SUCCEEDED",title:s("queue.cancelSucceeded"),status:"success"})}catch{l&&pe({id:"QUEUE_CANCEL_FAILED",title:s("queue.cancelFailed"),status:"error"})}},[s,t]),isLoading:n,isDisabled:!e}},Rhe=h.memo(()=>{const e=Ta(),t=Tt(),n=le(t.stagingArea.$shouldShowStagedImage),s=So("canvas"),i=Lhe(),o=le(e.$acceptSelectedIsEnabled),{t:r}=T();return Ul(["enter"],e.acceptSelected,{preventDefault:!0,enabled:s&&n&&o},[e.acceptSelected,s,n,o]),a.jsx(oe,{tooltip:`${r("common.accept")} (Enter)`,"aria-label":`${r("common.accept")} (Enter)`,icon:a.jsx(Yc,{}),onClick:e.acceptSelected,colorScheme:"invokeBlue",isDisabled:!o||!n||i.isDisabled,isLoading:i.isLoading})});Rhe.displayName="StagingAreaToolbarAcceptButton";const Ohe=h.memo(()=>{const e=Tt(),t=le(e.stagingArea.$shouldShowStagedImage),n=Ta(),{t:s}=T(),i=Lhe();return a.jsx(oe,{tooltip:`${s("controlLayers.stagingArea.discardAll")} (Esc)`,"aria-label":s("controlLayers.stagingArea.discardAll"),icon:a.jsx(Ea,{}),onClick:n.discardAll,colorScheme:"error",isDisabled:i.isDisabled||!t,isLoading:i.isLoading})});Ohe.displayName="StagingAreaToolbarDiscardAllButton";const Nhe=h.memo(()=>{const e=Tt(),t=le(e.stagingArea.$shouldShowStagedImage),n=Ta(),s=gk(),i=le(n.$discardSelectedIsEnabled),{t:o}=T();return a.jsx(oe,{tooltip:o("controlLayers.stagingArea.discard"),"aria-label":o("controlLayers.stagingArea.discard"),icon:a.jsx(fn,{}),onClick:n.discardSelected,colorScheme:"invokeBlue",isDisabled:!i||s.isDisabled||!t,isLoading:s.isLoading})});Nhe.displayName="StagingAreaToolbarDiscardSelectedButton";const Fhe=h.memo(()=>{const e=Tt(),t=le(e.stagingArea.$shouldShowStagedImage),n=Ta(),s=le(n.$selectedItem),i=le(n.$itemCount),o=h.useMemo(()=>i>0&&s!==null?`${s.index+1} of ${i}`:"0 of 0",[i,s]);return a.jsx(he,{colorScheme:"base",pointerEvents:"none",minW:28,isDisabled:!t,children:o})});Fhe.displayName="StagingAreaToolbarImageCountButton";const Wx={image_category:"general",is_intermediate:!0,silent:!0},Bhe=h.memo(()=>{const e=Tt(),{t}=T(),n=Ta(),s=le(n.$selectedItemImageDTO),i=Ze(),o=le(e.stagingArea.$shouldShowStagedImage),r=h.useCallback(()=>{pe({id:"SENT_TO_CANVAS",title:t("toast.sentToCanvas"),status:"success"})},[t]),l=h.useCallback(async()=>{if(!s)return;const{dispatch:p,getState:m}=i,f=await L0(s.image_name,Wx);Ar({imageDTO:f,type:"raster_layer",dispatch:p,getState:m,overrides:{isEnabled:!1}}),r()},[s,i,r]),c=h.useCallback(async()=>{if(!s)return;const{dispatch:p,getState:m}=i,f=await L0(s.image_name,Wx);Ar({imageDTO:f,type:"control_layer",dispatch:p,getState:m,overrides:{isEnabled:!1}}),r()},[s,i,r]),d=h.useCallback(async()=>{if(!s)return;const{dispatch:p,getState:m}=i,f=await L0(s.image_name,Wx);Ar({imageDTO:f,type:"inpaint_mask",dispatch:p,getState:m,overrides:{isEnabled:!1}}),r()},[s,i,r]),u=h.useCallback(async()=>{if(!s)return;const{dispatch:p,getState:m}=i,f=await L0(s.image_name,Wx);Ar({imageDTO:f,type:"regional_guidance",dispatch:p,getState:m,overrides:{isEnabled:!1}}),r()},[s,i,r]);return a.jsxs(Ya,{title:"New Layer From Image",children:[a.jsx(be,{icon:a.jsx(vo,{}),onClickCapture:d,isDisabled:!s||!o,children:t("controlLayers.inpaintMask")}),a.jsx(be,{icon:a.jsx(vo,{}),onClickCapture:u,isDisabled:!s||!o,children:t("controlLayers.regionalGuidance")}),a.jsx(be,{icon:a.jsx(vo,{}),onClickCapture:c,isDisabled:!s||!o,children:t("controlLayers.controlLayer")}),a.jsx(be,{icon:a.jsx(vo,{}),onClickCapture:l,isDisabled:!s||!o,children:t("controlLayers.rasterLayer")})]})});Bhe.displayName="StagingAreaToolbarNewLayerFromImageMenuItems";const zhe=h.memo(()=>{const e=Tt(),t=le(e.stagingArea.$shouldShowStagedImage);return a.jsxs(An,{children:[a.jsx(Pn,{tooltip:"Image Actions",as:oe,icon:a.jsx(GDe,{}),colorScheme:"invokeBlue",isDisabled:!t}),a.jsx(Zt,{children:a.jsx(Bhe,{})})]})});zhe.displayName="StagingAreaToolbarMenu";const Vhe=h.memo(()=>{const e=Tt(),t=le(e.stagingArea.$shouldShowStagedImage),n=Ta(),s=le(n.$itemCount),i=So("canvas"),{t:o}=T(),r=h.useCallback(()=>{n.selectNext()},[n]);return Ul(["right"],n.selectNext,{preventDefault:!0,enabled:i&&t&&s>1},[i,t,s,n.selectNext]),a.jsx(oe,{tooltip:`${o("controlLayers.stagingArea.next")} (Right)`,"aria-label":`${o("controlLayers.stagingArea.next")} (Right)`,icon:a.jsx(EDe,{}),onClick:r,colorScheme:"invokeBlue",isDisabled:s<=1||!t})});Vhe.displayName="StagingAreaToolbarNextButton";const $he=h.memo(()=>{const e=Tt(),t=le(e.stagingArea.$shouldShowStagedImage),n=Ta(),s=le(n.$itemCount),i=So("canvas"),{t:o}=T(),r=h.useCallback(()=>{n.selectPrev()},[n]);return Ul(["left"],n.selectPrev,{preventDefault:!0,enabled:i&&t&&s>1},[i,t,s,n.selectPrev]),a.jsx(oe,{tooltip:`${o("controlLayers.stagingArea.previous")} (Left)`,"aria-label":`${o("controlLayers.stagingArea.previous")} (Left)`,icon:a.jsx(kDe,{}),onClick:r,colorScheme:"invokeBlue",isDisabled:s<=1||!t})});$he.displayName="StagingAreaToolbarPrevButton";const P$="SAVE_STAGING_AREA_IMAGE_TO_GALLERY",Ghe=h.memo(()=>{const e=Tt(),t=M(ko),n=Ta(),s=le(n.$selectedItemImageDTO),i=le(e.stagingArea.$shouldShowStagedImage),{t:o}=T(),r=h.useCallback(async()=>{if(!s)return;(await Kn(async()=>{await L0(s.image_name,{image_category:"general",is_intermediate:!1,board_id:t==="none"?void 0:t,silent:!0})})).isOk()?pe({id:P$,title:o("controlLayers.savedToGalleryOk"),status:"success"}):pe({id:P$,title:o("controlLayers.savedToGalleryError"),status:"error"})},[t,s,o]);return a.jsx(oe,{tooltip:o("controlLayers.stagingArea.saveToGallery"),"aria-label":o("controlLayers.stagingArea.saveToGallery"),icon:a.jsx(Ol,{}),onClick:r,colorScheme:"invokeBlue",isDisabled:!s||!i})});Ghe.displayName="StagingAreaToolbarSaveSelectedToGalleryButton";const Hhe=h.memo(()=>{const e=Tt(),t=le(e.stagingArea.$shouldShowStagedImage),{t:n}=T(),s=h.useCallback(()=>{e.stagingArea.$shouldShowStagedImage.set(!e.stagingArea.$shouldShowStagedImage.get())},[e.stagingArea.$shouldShowStagedImage]);return a.jsx(oe,{tooltip:n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"aria-label":n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"data-alert":!t,icon:t?a.jsx(bu,{}):a.jsx($4,{}),onClick:s,colorScheme:"invokeBlue"})});Hhe.displayName="StagingAreaToolbarToggleShowResultsButton";const Whe=h.memo(()=>{const e=Tt(),t=le(e.stagingArea.$shouldShowStagedImage),n=M($M),s=Q(),i=h.useCallback(()=>{s(J0("off"))},[s]),o=h.useCallback(()=>{s(J0("switch_on_start"))},[s]),r=h.useCallback(()=>{s(J0("switch_on_finish"))},[s]);return a.jsxs(a.Fragment,{children:[a.jsx(oe,{"aria-label":"Do not auto-switch",tooltip:"Do not auto-switch",icon:a.jsx(rMe,{}),colorScheme:n==="off"?"invokeBlue":"base",onClick:i,isDisabled:!t}),a.jsx(oe,{"aria-label":"Switch on start",tooltip:"Switch on start",icon:a.jsx(Y_,{}),colorScheme:n==="switch_on_start"?"invokeBlue":"base",onClick:o,isDisabled:!t}),a.jsx(oe,{"aria-label":"Switch on finish",tooltip:"Switch on finish",icon:a.jsx(NDe,{}),colorScheme:n==="switch_on_finish"?"invokeBlue":"base",onClick:r,isDisabled:!t})]})});Whe.displayName="StagingAreaAutoSwitchButtons";const Uhe=h.memo(()=>{const e=Ta();return Ul("meta+left",e.selectFirst,{preventDefault:!0}),Ul("meta+right",e.selectLast,{preventDefault:!0}),a.jsxs(A,{gap:2,children:[a.jsxs(zn,{borderRadius:"base",shadow:"dark-lg",children:[a.jsx($he,{}),a.jsx(Fhe,{}),a.jsx(Vhe,{})]}),a.jsxs(zn,{borderRadius:"base",shadow:"dark-lg",children:[a.jsx(Rhe,{}),a.jsx(Hhe,{}),a.jsx(Ghe,{}),a.jsx(zhe,{}),a.jsx(Nhe,{})]}),a.jsx(zn,{borderRadius:"base",shadow:"dark-lg",children:a.jsx(Whe,{})}),a.jsx(zn,{borderRadius:"base",shadow:"dark-lg",children:a.jsx(Ohe,{})})]})});Uhe.displayName="StagingAreaToolbar";const qhe=h.memo(()=>Io()?a.jsxs(A,{position:"absolute",flexDir:"column",bottom:2,gap:2,align:"center",justify:"center",left:2,right:2,children:[a.jsx(Mhe,{}),a.jsx(Uhe,{})]}):null);qhe.displayName="StagingArea";const mD=h.memo(()=>a.jsx(fa,{children:a.jsxs(Zt,{children:[a.jsx(Ude,{}),a.jsx(Gde,{})]})}));mD.displayName="MenuContent";const jot={position:"relative",w:"full",h:"full",borderRadius:"base",overflow:"hidden",bg:"base.900",'&[data-dynamic-grid="true"]':{bg:"base.850"}},Khe=h.memo(()=>{const e=M(q2),t=M(Kwe),n=M(aq),s=h.useCallback(()=>a.jsx(mD,{}),[]);return a.jsx(Lue,{sessionId:n,children:a.jsxs(A,{borderRadius:"base",position:"relative",flexDirection:"column",height:"full",width:"full",gap:2,alignItems:"center",justifyContent:"center",overflow:"hidden",children:[a.jsx(fa,{children:a.jsx(khe,{})}),a.jsx(vt,{}),a.jsx(p_,{renderMenu:s,withLongPress:!1,children:i=>a.jsxs(A,{ref:i,sx:jot,"data-dynamic-grid":e,children:[a.jsx(xue,{}),a.jsxs(fa,{children:[a.jsxs(A,{position:"absolute",flexDir:"column",top:1,insetInlineStart:1,pointerEvents:"none",gap:2,alignItems:"flex-start",children:[a.jsx(Rue,{}),t&&a.jsx(gue,{}),a.jsx(Fde,{}),a.jsx(zde,{}),a.jsx(Nde,{}),a.jsx(j3,{}),a.jsx(Ode,{})]}),a.jsx(A,{position:"absolute",top:1,insetInlineEnd:1,children:a.jsxs(An,{children:[a.jsx(Pn,{as:oe,icon:a.jsx(MMe,{}),colorScheme:"base"}),a.jsx(mD,{})]})}),a.jsx(Vde,{position:"absolute",insetInlineEnd:2,bottom:2})]})]})}),a.jsx(fa,{children:a.jsx(qhe,{})}),a.jsx(A,{position:"absolute",bottom:4,children:a.jsxs(fa,{children:[a.jsx(hue,{}),a.jsx(mot,{}),a.jsx(Tue,{})]})}),a.jsx(fa,{children:a.jsx(qde,{})})]})})});Khe.displayName="CanvasWorkspacePanel";const Zhe=()=>{const{currentQueueItemDestination:e}=GG(void 0,{selectFromResult:({data:t})=>({currentQueueItemDestination:t?.destination??null})});return e},Xhe=h.memo(e=>{const{t}=T(),n=GM(),s=Zhe(),i=h.useRef(null),o=h.useCallback(()=>{e.api.isActive||e.api.setActive()},[e.api]);Bm(o,i,300);const r=h.useCallback(()=>{tu(e.params.focusRegion)},[e.params.focusRegion]);return a.jsxs(A,{ref:i,position:"relative",alignItems:"center",h:"full",onPointerDown:r,children:[a.jsx(q,{userSelect:"none",px:4,children:t(e.params.i18nKey)}),s==="canvas"&&n&&a.jsx(vk,{position:"absolute",bottom:0,left:0,right:0,h:1,borderRadius:"none"})]})});Xhe.displayName="DockviewTabCanvasViewer";const Yhe=h.memo(e=>{const{t}=T(),n=GM(),s=M(aq),i=Zhe(),o=h.useRef(null),r=h.useCallback(()=>{e.api.isActive||e.api.setActive()},[e.api]);Bm(r,o,300);const l=h.useCallback(()=>{tu(e.params.focusRegion)},[e.params.focusRegion]);return a.jsxs(A,{ref:o,position:"relative",alignItems:"center",h:"full",onPointerDown:l,children:[a.jsx(q,{userSelect:"none",px:4,children:t(e.params.i18nKey)}),i===s&&n&&a.jsx(vk,{position:"absolute",bottom:0,left:0,right:0,h:1,borderRadius:"none"})]})});Yhe.displayName="DockviewTabCanvasWorkspace";const Eot={generate:K4,canvas:nc,upscaling:Sm,workflows:h1,models:u1,queue:U4},ab=h.memo(e=>{const{t}=T(),n=h.useRef(null),s=M(un),i=h.useCallback(()=>{e.api.isActive||e.api.setActive()},[e.api]);Bm(i,n,300);const o=h.useCallback(()=>{tu(e.params.focusRegion)},[e.params.focusRegion]);return a.jsxs(A,{ref:n,alignItems:"center",h:"full",px:4,gap:3,onPointerDown:o,children:[a.jsx(Je,{as:Eot[s],color:"invokeYellow.300",boxSize:5}),a.jsx(q,{userSelect:"none",children:t(e.params.i18nKey)})]})});ab.displayName="DockviewTabLaunchpad";const rb=h.memo(()=>(Be({category:"app",id:"toggleLeftPanel",callback:Ne.toggleLeftPanel}),Be({category:"app",id:"toggleRightPanel",callback:Ne.toggleRightPanel}),Be({category:"app",id:"resetPanelLayout",callback:Ne.resetLeftAndRightPanels}),Be({category:"app",id:"togglePanels",callback:Ne.toggleLeftAndRightPanels}),null));rb.displayName="PanelHotkeysLogical";const Aot={[yu]:ab,[QK]:Xhe,[JK]:Yhe},Pot={[ka]:vs(vce),[Zn]:vs(Khe),[cs]:vs(tb)},Tot=(e,t)=>{Ne.registerContainer(e,"main",t,()=>{const n=t.addPanel({id:ka,component:ka,title:ye("ui.panels.launchpad"),tabComponent:yu,params:{tab:e,focusRegion:"launchpad",i18nKey:"ui.panels.launchpad"}});t.addPanel({id:Zn,component:Zn,title:ye("ui.panels.canvas"),tabComponent:JK,params:{tab:e,focusRegion:"canvas",i18nKey:"ui.panels.canvas"},position:{direction:"within",referencePanel:n.id}}),t.addPanel({id:cs,component:cs,title:ye("ui.panels.imageViewer"),tabComponent:QK,params:{tab:e,focusRegion:"viewer",i18nKey:"ui.panels.imageViewer"},position:{direction:"within",referencePanel:n.id}}),n.api.setActive()})},Qhe=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Tot(e,n)},[e]);return a.jsxs(a.Fragment,{children:[a.jsx(t1,{disableDnd:!0,locked:!0,disableFloatingGroups:!0,dndEdges:!1,components:Pot,onReady:t,theme:mk,tabComponents:Aot}),a.jsx(zle,{}),a.jsx(nb,{}),a.jsx(rb,{})]})});Qhe.displayName="MainPanel";const Dot={[Ia]:vs(U1),[ja]:vs(X1),[xP]:vs(Uie)},Mot=(e,t)=>{Ne.registerContainer(e,"right",t,()=>{const n=t.addPanel({id:ja,component:ja,minimumWidth:Pi,minimumHeight:s1,params:{tab:e,focusRegion:"gallery"}}),s=t.addPanel({id:Ia,component:Ia,minimumHeight:n1,params:{tab:e,focusRegion:"boards"},position:{direction:"above",referencePanel:n.id}});t.addPanel({id:xP,component:xP,minimumHeight:rAe,params:{tab:e,focusRegion:"layers"},position:{direction:"below",referencePanel:n.id}}),n.api.setSize({height:i1}),s.api.setSize({height:lAe})})},Jhe=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Mot(e,n)},[e]);return a.jsx(Eo,{className:"dockview-theme-invoke",orientation:Ke.VERTICAL,components:Dot,onReady:t})});Jhe.displayName="RightPanel";const Lot={[lr]:vs(Rde)},Rot=(e,t)=>{Ne.registerContainer(e,"left",t,()=>{t.addPanel({id:lr,component:lr,params:{tab:e,focusRegion:"settings"}})})},epe=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Rot(e,n)},[e]);return a.jsx(Eo,{className:"dockview-theme-invoke",orientation:Ke.VERTICAL,components:Lot,onReady:t})});epe.displayName="LeftPanel";const Oot={[qi]:epe,[rr]:Qhe,[Ki]:Jhe},Not=(e,t)=>{Ne.registerContainer(e,"root",t,()=>{const n=t.addPanel({id:rr,component:rr,priority:Hn.High}),s=t.addPanel({id:qi,component:qi,minimumWidth:ma,priority:Hn.Low,position:{direction:"left",referencePanel:n.id}}),i=t.addPanel({id:Ki,component:Ki,minimumWidth:Pi,priority:Hn.Low,position:{direction:"right",referencePanel:n.id}});s.api.setSize({width:ma}),i.api.setSize({width:Pi})})},tpe=h.memo(()=>{const e=h.useCallback(({api:t})=>{Not("canvas",t)},[]);return h.useEffect(()=>()=>{Ne.unregisterTab("canvas")},[]),a.jsx(Zm,{tab:"canvas",children:a.jsx(Eo,{className:"dockview-theme-invoke",components:Oot,onReady:e,orientation:Ke.VERTICAL})})});tpe.displayName="CanvasTabAutoLayout";const kk=h.memo(e=>{const{t}=T(),n=h.useRef(null),s=h.useCallback(()=>{e.api.isActive||e.api.setActive()},[e.api]);Bm(s,n,300);const i=h.useCallback(()=>{tu(e.params.focusRegion)},[e.params.focusRegion]);return a.jsx(A,{ref:n,alignItems:"center",h:"full",onPointerDown:i,children:a.jsx(q,{userSelect:"none",px:4,children:t(e.params.i18nKey)})})});kk.displayName="DockviewTab";const Ik=h.memo(e=>{const{t}=T(),n=GM(),s=h.useRef(null),i=h.useCallback(()=>{e.api.isActive||e.api.setActive()},[e.api]);Bm(i,s,300);const o=h.useCallback(()=>{tu(e.params.focusRegion)},[e.params.focusRegion]);return a.jsxs(A,{ref:s,position:"relative",alignItems:"center",h:"full",onPointerDown:o,children:[a.jsx(q,{userSelect:"none",px:4,children:t(e.params.i18nKey)}),n&&a.jsx(vk,{position:"absolute",bottom:0,left:0,right:0,h:1,borderRadius:"none"})]})});Ik.displayName="DockviewTabProgress";const npe=h.memo(()=>{const{t:e}=T(),t=h.useCallback(()=>{Ne.switchToTab("canvas")},[]);return a.jsxs(ib,{heading:e("ui.launchpad.generateTitle"),children:[a.jsxs(Ms,{gridTemplateColumns:"1fr 1fr",gap:8,children:[a.jsx(v8,{}),a.jsx(A,{flexDir:"column",gap:2,justifyContent:"center",children:a.jsxs(q,{children:[e("ui.launchpad.modelGuideText")," ",a.jsx(he,{as:"a",variant:"link",href:"https://support.invoke.ai/support/solutions/articles/151000216086-model-guide",target:"_blank",rel:"noopener noreferrer",size:"sm",children:e("ui.launchpad.modelGuideLink")})]})})]}),a.jsx(b8,{}),a.jsx(y8,{}),a.jsxs(hu,{status:"info",borderRadius:"base",flexDir:"column",gap:2,overflow:"unset",children:[a.jsx(q,{fontSize:"md",fontWeight:"semibold",children:e("ui.launchpad.generate.canvasCalloutTitle")}),a.jsx(he,{variant:"link",onClick:t,children:e("ui.launchpad.generate.canvasCalloutLink")})]})]})});npe.displayName="GenerateLaunchpad";const spe=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(rq),s=h.useCallback(i=>{mM(i.target.value)&&t(Zwe({id:i.target.value}))},[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"paramAspect",children:a.jsx(ne,{children:e("parameters.aspect")})}),a.jsx(Mi,{size:"sm",value:n,onChange:s,cursor:"pointer",iconSize:"0.75rem",icon:a.jsx(Do,{}),children:TU.options.map(i=>a.jsx("option",{value:i,children:i},i))})]})});spe.displayName="DimensionsAspectRatioSelect";const di={sliderMin:64,sliderMax:1536,numberInputMin:64,numberInputMax:4096,fineStep:8,coarseStep:64},ipe=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(gu),s=M(y_),i=M(Bh),o=h.useCallback(l=>{t(LH({height:l}))},[t]),r=h.useMemo(()=>[di.sliderMin,n,di.sliderMax],[n]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"paramHeight",children:a.jsx(ne,{children:e("parameters.height")})}),a.jsx(it,{value:s,defaultValue:n,onChange:o,min:di.sliderMin,max:di.sliderMax,step:di.coarseStep,fineStep:i,marks:r}),a.jsx(Pe,{value:s,defaultValue:n,onChange:o,min:di.numberInputMin,max:di.numberInputMax,step:di.coarseStep,fineStep:i})]})});ipe.displayName="DimensionsHeight";const ope=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(lq),s=h.useCallback(()=>{t(Xwe())},[t]);return a.jsx(oe,{tooltip:e("parameters.lockAspectRatio"),"aria-label":e("parameters.lockAspectRatio"),onClick:s,variant:n?"outline":"ghost",size:"sm",icon:n?a.jsx(X4,{}):a.jsx(H4,{})})});ope.displayName="DimensionsLockAspectRatioButton";const ape=h.memo(()=>{const e=M(b_),t=M(y_),n=M(Ywe),[s,i]=Qce(),o=h.useMemo(()=>{if(!i)return{width:0,height:0};let r=e,l=t;return e>t?(r=i.width,l=r/n):(l=i.height,r=l*n),{width:r,height:l}},[i,e,t,n]);return a.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",ref:s,children:a.jsx(A,{position:"relative",borderRadius:"base",borderColor:"base.600",borderWidth:"3px",width:`${o.width}px`,height:`${o.height}px`,alignItems:"center",justifyContent:"center",children:a.jsxs(Ms,{borderRadius:"base",position:"absolute",top:0,right:0,bottom:0,left:0,gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"1fr 1fr 1fr",gap:"1px",bg:"base.700",children:[a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"}),a.jsx(_t,{bg:"base.800"})]})})})});ape.displayName="DimensionsPreview";const rpe=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(b_),s=M(y_),i=M(gu),o=h.useMemo(()=>DU(n,s,i),[s,n,i]),r=h.useMemo(()=>MU(n,s,i),[s,n,i]),l=h.useCallback(()=>{t(CM())},[t]),c=h.useMemo(()=>e(o?"parameters.setToOptimalSizeTooSmall":r?"parameters.setToOptimalSizeTooLarge":"parameters.setToOptimalSize"),[r,o,e]);return a.jsx(oe,{tooltip:c,"aria-label":e("parameters.setToOptimalSize"),onClick:l,variant:"ghost",size:"sm",icon:a.jsx(Em,{}),colorScheme:o||r?"warning":"base"})});rpe.displayName="DimensionsSetOptimalSizeButton";const lpe=h.memo(()=>{const{t:e}=T(),t=Q(),n=h.useCallback(()=>{t(Qwe())},[t]);return a.jsx(oe,{tooltip:e("parameters.swapDimensions"),"aria-label":e("parameters.swapDimensions"),onClick:n,variant:"ghost",size:"sm",icon:a.jsx(QZ,{})})});lpe.displayName="DimensionsSwapButton";const ui={sliderMin:64,sliderMax:1536,numberInputMin:64,numberInputMax:4096,fineStep:8,coarseStep:64},cpe=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(b_),s=M(gu),i=M(Bh),o=h.useCallback(l=>{t(TH({width:l}))},[t]),r=h.useMemo(()=>[ui.sliderMin,s,ui.sliderMax],[s]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"paramWidth",children:a.jsx(ne,{children:e("parameters.width")})}),a.jsx(it,{value:n,onChange:o,defaultValue:s,min:ui.sliderMin,max:ui.sliderMax,step:ui.coarseStep,fineStep:i,marks:r}),a.jsx(Pe,{value:n,onChange:o,defaultValue:s,min:ui.numberInputMin,max:ui.numberInputMax,step:ui.coarseStep,fineStep:i})]})});cpe.displayName="Dimensions";const dpe=h.memo(()=>a.jsxs(A,{gap:4,alignItems:"center",children:[a.jsx(A,{gap:4,flexDirection:"column",width:"full",children:a.jsxs(Ys,{formLabelProps:Fot,children:[a.jsxs(A,{gap:4,children:[a.jsx(spe,{}),a.jsx(lpe,{}),a.jsx(ope,{}),a.jsx(rpe,{})]}),a.jsx(cpe,{}),a.jsx(ipe,{})]})}),a.jsx(A,{w:"108px",h:"108px",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"center",children:a.jsx(ape,{})})]}));dpe.displayName="Dimensions";const Fot={minW:10},Bot=Yn([b_,y_,rq,lq,qy],(e,t,n,s,i)=>{const o=[];return o.push(`${e}${t}`),o.push(n),s&&o.push("locked"),i||o.push("Manual Seed"),o.length===0?os:o}),upe=h.memo(()=>{const{t:e}=T(),t=M(Bot),{isOpen:n,onToggle:s}=sd({id:"image-settings-generate-tab",defaultIsOpen:!0});return a.jsx(Kc,{label:e("accordions.image.title"),badges:t,isOpen:n,onToggle:s,children:a.jsxs(A,{px:4,pt:4,pb:4,w:"full",h:"full",flexDir:"column","data-testid":"image-settings-accordion",children:[a.jsx(dpe,{}),a.jsx(xk,{py:3})]})})});upe.displayName="GenerateTabImageSettingsAccordion";const T$={height:"100%",width:"100%"},hpe=h.memo(()=>{const e=M(NU),t=M(h_),n=le(Af);return a.jsxs(A,{w:"full",h:"full",flexDir:"column",gap:2,children:[a.jsx(M8,{}),a.jsx(A,{w:"full",h:"full",position:"relative",children:a.jsxs(ke,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[n&&a.jsx(ti,{defer:!0,style:T$,options:iu.options,children:a.jsx(A,{gap:2,flexDirection:"column",h:"full",w:"full",children:a.jsx(D8,{})})}),a.jsx(ti,{defer:!0,style:T$,options:iu.options,children:a.jsxs(A,{gap:2,flexDirection:"column",h:"full",w:"full",children:[a.jsx(k8,{}),a.jsx(upe,{}),a.jsx(P8,{}),e&&a.jsx(T8,{}),!t&&a.jsx(I8,{})]})})]})})]})});hpe.displayName="ParametersPanelGenerate";const ppe=h.memo(()=>a.jsxs(A,{flexDir:"column",w:"full",h:"full",gap:2,children:[a.jsx(yk,{}),a.jsx(ke,{position:"relative",w:"full",h:"full",children:a.jsx(hpe,{})})]}));ppe.displayName="GenerateTabLeftPanel";const zot={[F_]:kk,[fm]:Ik,[yu]:ab},Vot={[ka]:vs(npe),[cs]:vs(tb)},$ot=(e,t)=>{Ne.registerContainer(e,"main",t,()=>{const n=t.addPanel({id:ka,component:ka,title:ye("ui.panels.launchpad"),tabComponent:yu,params:{tab:e,focusRegion:"launchpad",i18nKey:"ui.panels.launchpad"}});t.addPanel({id:cs,component:cs,title:ye("ui.panels.imageViewer"),tabComponent:fm,params:{tab:e,focusRegion:"viewer",i18nKey:"ui.panels.imageViewer"},position:{direction:"within",referencePanel:n.id}}),n.api.setActive()})},fpe=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{$ot(e,n)},[e]);return a.jsxs(a.Fragment,{children:[a.jsx(t1,{disableDnd:!0,locked:!0,disableFloatingGroups:!0,dndEdges:!1,tabComponents:zot,components:Vot,onReady:t,theme:mk}),a.jsx(fk,{}),a.jsx(nb,{}),a.jsx(rb,{})]})});fpe.displayName="MainPanel";const Got={[Ia]:vs(U1),[ja]:vs(X1)},Hot=(e,t)=>{Ne.registerContainer(e,"right",t,()=>{const n=t.addPanel({id:ja,component:ja,minimumWidth:Pi,minimumHeight:s1,params:{tab:e,focusRegion:"gallery"}}),s=t.addPanel({id:Ia,component:Ia,minimumHeight:n1,params:{tab:e,focusRegion:"boards"},position:{direction:"above",referencePanel:n.id}});n.api.setSize({height:i1}),s.api.setSize({height:B_})})},mpe=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Hot(e,n)},[e]);return a.jsx(Eo,{className:"dockview-theme-invoke",orientation:Ke.VERTICAL,components:Got,onReady:t})});mpe.displayName="RightPanel";const Wot={[lr]:vs(ppe)},Uot=(e,t)=>{Ne.registerContainer(e,"left",t,()=>{t.addPanel({id:lr,component:lr,params:{tab:e,focusRegion:"settings"}})})},gpe=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Uot(e,n)},[e]);return a.jsx(Eo,{className:"dockview-theme-invoke",orientation:Ke.VERTICAL,components:Wot,onReady:t})});gpe.displayName="LeftPanel";const qot={[qi]:gpe,[rr]:fpe,[Ki]:mpe},Kot=(e,t)=>{Ne.registerContainer(e,"root",t,()=>{const n=t.addPanel({id:rr,component:rr,priority:Hn.High}),s=t.addPanel({id:qi,component:qi,minimumWidth:ma,position:{direction:"left",referencePanel:n.id}}),i=t.addPanel({id:Ki,component:Ki,minimumWidth:Pi,position:{direction:"right",referencePanel:n.id}});s.api.setSize({width:ma}),i.api.setSize({width:Pi})})},vpe=h.memo(()=>{const e=h.useCallback(({api:t})=>{Kot("generate",t)},[]);return h.useEffect(()=>()=>{Ne.unregisterTab("generate")},[]),a.jsx(Zm,{tab:"generate",children:a.jsx(Eo,{className:"dockview-theme-invoke",components:qot,onReady:e,orientation:Ke.VERTICAL})})});vpe.displayName="GenerateTabAutoLayout";const ype=h.memo(({isOpen:e,onClose:t,onConfirm:n,modelCount:s,isDeleting:i=!1})=>{const{t:o}=T(),r=h.useRef(null);return a.jsx(gM,{isOpen:e,onClose:t,leastDestructiveRef:r,isCentered:!0,children:a.jsx(ro,{children:a.jsxs(n_,{children:[a.jsx(lo,{fontSize:"lg",fontWeight:"bold",children:o("modelManager.deleteModels",{count:s})}),a.jsx(vi,{children:a.jsxs(A,{flexDir:"column",gap:3,children:[a.jsx(q,{children:o("modelManager.deleteModelsConfirm",{count:s,defaultValue:`Are you sure you want to delete ${s} model(s)? This action cannot be undone.`})}),a.jsx(q,{fontWeight:"semibold",color:"error.400",children:o("modelManager.deleteWarning",{defaultValue:"Models in your Invoke models directory will be permanently deleted from disk."})})]})}),a.jsxs(Qr,{children:[a.jsx(he,{ref:r,onClick:t,isDisabled:i,children:o("common.cancel")}),a.jsx(he,{colorScheme:"error",onClick:n,ml:3,isLoading:i,children:o("common.delete")})]})]})})})});ype.displayName="BulkDeleteModelsModal";const B8=h.memo(({loadingMessage:e})=>a.jsx(A,{flexDirection:"column",gap:4,borderRadius:"base",p:4,bg:"base.800",children:a.jsxs(A,{justifyContent:"center",alignItems:"center",flexDirection:"column",p:4,gap:8,children:[a.jsx(ao,{}),a.jsx(q,{variant:"subtext",children:e||"Fetching..."})]})}));B8.displayName="FetchingModelsLoader";const Zot=({base:e})=>a.jsx(Bi,{flexGrow:0,flexShrink:0,colorScheme:dU[e],variant:"subtle",h:"min-content",children:cU[e]}),bpe=h.memo(Zot),Xot={diffusers:"diffusers",lycoris:"lycoris",checkpoint:"checkpoint",invokeai:"internal",embedding_file:"embedding",embedding_folder:"embedding",t5_encoder:"t5_encoder",qwen3_encoder:"qwen3_encoder",bnb_quantized_int8b:"bnb_quantized_int8b",bnb_quantized_nf4b:"quantized",gguf_quantized:"gguf",omi:"omi",unknown:"unknown",olive:"olive",onnx:"onnx"},Yot={diffusers:"base",omi:"base",lycoris:"base",checkpoint:"orange",invokeai:"base",embedding_file:"base",embedding_folder:"base",t5_encoder:"base",qwen3_encoder:"base",bnb_quantized_int8b:"base",bnb_quantized_nf4b:"base",gguf_quantized:"base",unknown:"red",olive:"base",onnx:"base"},Qot=({format:e})=>a.jsx(Bi,{flexGrow:0,colorScheme:Yot[e],variant:"subtle",children:Xot[e]}),Jot=h.memo(Qot),jk=h.memo(({showLabel:e=!0,modelConfig:t})=>{const{t:n}=T(),s=Q(),i=Ft("models").child({filePath:"features/modelManagerV2/subpanels/ModelPanel/ModelDeleteButton.tsx"}),[o]=Jwe(),{isOpen:r,onOpen:l,onClose:c}=jo(),d=h.useCallback(p=>{p.stopPropagation(),l()},[l]),u=h.useCallback(()=>{o({key:t.key}).unwrap().then(()=>{s(x_(null)),pe({id:"MODEL_DELETED",title:`${n("modelManager.modelDeleted")}: ${t.name}`,status:"success"})}).catch(p=>{i.error("Error deleting model",p),pe({id:"MODEL_DELETE_FAILED",title:`${n("modelManager.modelDeleteFailed")}: ${t.name}`,status:"error"})})},[o,t.key,t.name,s,n,i]);return a.jsxs(a.Fragment,{children:[e?a.jsx(he,{className:"delete-button",size:"sm",leftIcon:a.jsx(Ea,{}),colorScheme:"error",onClick:d,flexShrink:0,children:n("modelManager.delete")}):a.jsx(oe,{className:"delete-button",onClick:d,icon:a.jsx(Ea,{size:16}),"aria-label":n("modelManager.deleteConfig"),colorScheme:"error"}),a.jsx(Ko,{isOpen:r,onClose:c,title:n("modelManager.deleteModel"),acceptCallback:u,acceptButtonText:n("modelManager.delete"),useInert:!1,children:a.jsxs(A,{rowGap:4,flexDirection:"column",children:[a.jsx(q,{fontWeight:"bold",children:n("modelManager.deleteMsg1")}),a.jsx(q,{children:n("modelManager.deleteMsg2")})]})})]})});jk.displayName="ModelDeleteButton";const eat=ec("label"),tat={paddingInlineStart:10,paddingInlineEnd:3,paddingBlock:2,position:"relative",rounded:"base","&:after,&:before":{content:"''",position:"absolute",pointerEvents:"none"},"&:after":{h:"1px",bottom:"-0.5px",insetInline:3,bg:"base.850"},_hover:{bg:"base.850","& .delete-button":{opacity:1}},"& .delete-button":{opacity:0},"&[aria-selected='false']:hover:before":{bg:"base.750"},"&[aria-selected='true']":{bg:"base.800","& .delete-button":{opacity:1}},"&[aria-selected='true']:before":{bg:"invokeBlue.300"}},nat=({model:e})=>{const{t}=T(),n=Q(),s=h.useMemo(()=>ve(e_e,u=>u.selectedModelKey===e.key),[e.key]),i=M(s),r=M(HM).includes(e.key),l=h.useCallback(u=>{u.ctrlKey||u.metaKey?n(nR(e.key)):n(x_(e.key))},[e.key,n]),c=h.useCallback(u=>{u.stopPropagation(),n(nR(e.key))},[e.key,n]),d=h.useCallback(u=>{u.stopPropagation()},[]);return a.jsxs(A,{position:"relative",children:[a.jsx(eat,{display:"flex",alignItems:"start",h:"full",position:"absolute",zIndex:2,paddingInlineStart:3,paddingInlineEnd:1,paddingBlock:3,cursor:"pointer",onClick:d,children:a.jsx(us,{"aria-label":t("modelManager.selectModel"),isChecked:r,onChange:c})}),a.jsxs(A,{sx:tat,role:"row","aria-selected":i,justifyContent:"flex-start",w:"full",alignItems:"flex-start",gap:2,cursor:"pointer",onClick:l,children:[a.jsxs(A,{gap:2,w:"full",h:"full",minW:0,children:[a.jsx(rce,{image_url:e.cover_image}),a.jsxs(A,{alignItems:"flex-start",flexDir:"column",w:"full",minW:0,children:[a.jsxs(A,{gap:2,w:"full",alignItems:"flex-start",children:[a.jsx(q,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",children:e.name}),a.jsx(q,{variant:"subtext",fontStyle:"italic",children:g8(e.file_size)}),a.jsx(At,{})]}),a.jsx(q,{variant:"subtext",noOfLines:1,children:e.description||"No Description"}),a.jsxs(A,{gap:1,mt:1,children:[a.jsx(bpe,{base:e.base}),a.jsx(Jot,{format:e.format})]})]})]}),a.jsx(A,{mt:1,children:a.jsx(jk,{modelConfig:e,showLabel:!1})})]})]})},sat=h.memo(nat),iat={bg:"base.900",pb:3,pl:3},oat={gap:0,p:0,bg:"base.900",borderRadius:"0",zIndex:0},xpe=h.memo(e=>{const{title:t,modelList:n}=e;return n.length===0?null:a.jsx(xl,{title:t,contentSx:oat,headingSx:iat,children:n.map(s=>a.jsx(sat,{model:s},s.key))})});xpe.displayName="ModelListWrapper";const uA=Ft("models").child({filePath:"features/modelManagerV2/subpanels/ModelManagerPanel/ModelList.tsx"}),[Cpe]=lS(!1),aat=()=>{const e=Q(),t=M(C_),n=M(WM),s=M(HM),{t:i}=T(),o=tm(),{isOpen:r,close:l}=Cpe(),[c,d]=h.useState(!1),{data:u,isLoading:p}=Fh(),[m]=t_e(),f=h.useMemo(()=>{const v=$l.selectAll(u??{ids:[],entities:{}}),b=lat(v,n,t),C=[],y=b.length;let x=0;for(const{i18nKey:w,filter:_}of cq){const S=b.filter(_);x+=S.length,C.push({i18nKey:w,configs:S})}if(x!==y){const w={total:y,renderedTotal:x,difference:y-x};uA.warn(w,"ModelList: Not all models were categorized - ensure all possible models are covered in MODEL_CATEGORIES")}return{total:y,byCategory:C}},[u,t,n]),g=h.useCallback(async()=>{d(!0);try{const v=await m({keys:s}).unwrap();e(n_e()),e(x_(null)),l(),v.failed.length===0?o({id:"BULK_DELETE_SUCCESS",title:i("modelManager.modelsDeleted",{count:v.deleted.length,defaultValue:`Successfully deleted ${v.deleted.length} model(s)`}),status:"success"}):v.deleted.length===0?o({id:"BULK_DELETE_FAILED",title:i("modelManager.modelsDeleteFailed",{defaultValue:"Failed to delete models"}),description:i("modelManager.someModelsFailedToDelete",{count:v.failed.length,defaultValue:`${v.failed.length} model(s) could not be deleted`}),status:"error"}):o({id:"BULK_DELETE_PARTIAL",title:i("modelManager.modelsDeletedPartial",{defaultValue:"Partially completed"}),description:i("modelManager.someModelsDeleted",{deleted:v.deleted.length,failed:v.failed.length,defaultValue:`${v.deleted.length} deleted, ${v.failed.length} failed`}),status:"warning"}),uA.info(`Bulk delete completed: ${v.deleted.length} deleted, ${v.failed.length} failed`)}catch(v){uA.error({error:cn(v)},"Bulk delete error"),o({id:"BULK_DELETE_ERROR",title:i("modelManager.modelsDeleteError",{defaultValue:"Error deleting models"}),status:"error"})}finally{d(!1)}},[m,s,e,l,o,i]);return a.jsxs(a.Fragment,{children:[a.jsx(A,{flexDirection:"column",w:"full",h:"full",children:a.jsx(Hs,{children:a.jsxs(A,{flexDirection:"column",w:"full",h:"full",gap:4,children:[p&&a.jsx(B8,{loadingMessage:"Loading..."}),f.byCategory.map(({i18nKey:v,configs:b})=>a.jsx(xpe,{title:i(v),modelList:b},v)),!p&&f.total===0&&a.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:a.jsx(q,{children:i("modelManager.noMatchingModels")})})]})})}),a.jsx(ype,{isOpen:r,onClose:l,onConfirm:g,modelCount:s.length,isDeleting:c})]})},rat=h.memo(aat),lat=(e,t,n)=>e.filter(s=>{const i=s.name.toLowerCase().includes(t.toLowerCase())||s.base.toLowerCase().includes(t.toLowerCase())||s.type.toLowerCase().includes(t.toLowerCase())||s.description?.toLowerCase().includes(t.toLowerCase())||s.format.toLowerCase().includes(t.toLowerCase()),o=cat(s,n);return i&&o}),cat=(e,t)=>t==="refiner"?e.base==="sdxl-refiner":t==="main"&&e.base==="sdxl-refiner"?!1:t?e.type===t:!0,dat={alignItems:"center",justifyContent:"space-between",width:"100%"},wpe=h.memo(({sx:e})=>{const t=Q(),n=M(C_),s=M(HM),i=M(WM),{data:o}=Fh(),r=Cpe(),l=h.useCallback(()=>{r.open()},[r]),c=h.useMemo(()=>{const f=$l.selectAll(o??{ids:[],entities:{}});return uat(f,i,n).map(v=>v.key)},[o,i,n]),{allSelected:d,someSelected:u}=h.useMemo(()=>{if(c.length===0)return{allSelected:!1,someSelected:!1};const f=new Set(s),g=c.filter(v=>f.has(v)).length;return{allSelected:g===c.length,someSelected:g>0&&g<c.length}},[c,s]),p=h.useCallback(()=>{if(d){const f=new Set(c),g=s.filter(v=>!f.has(v));t(sR(g))}else{const f=new Set(s);c.forEach(g=>f.add(g)),t(sR(Array.from(f)))}},[d,c,s,t]),m=s.length;return a.jsxs(A,{sx:{...dat,sx:e},children:[a.jsx(us,{isChecked:d,isIndeterminate:u,onChange:p,isDisabled:c.length===0,"aria-label":ye("modelManager.selectAll"),children:a.jsx(q,{variant:"subtext1",color:"base.400",children:ye("modelManager.selectAll")})}),a.jsxs(A,{alignItems:"center",gap:4,children:[a.jsxs(q,{variant:"subtext",color:"base.400",children:[m," ",ye("common.selected")]}),a.jsxs(An,{placement:"bottom-end",children:[a.jsx(Pn,{as:he,disabled:m===0,size:"sm",rightIcon:a.jsx(Do,{}),flexShrink:0,variant:"outline",children:ye("modelManager.actions")}),a.jsx(Zt,{children:a.jsx(be,{icon:a.jsx(Ea,{}),onClick:l,color:"error.300",children:ye("modelManager.deleteModels",{count:m})})})]})]})]})});wpe.displayName="ModelListBulkActions";const uat=(e,t,n)=>e.filter(s=>{const i=s.name.toLowerCase().includes(t.toLowerCase())||s.base.toLowerCase().includes(t.toLowerCase())||s.type.toLowerCase().includes(t.toLowerCase())||s.description?.toLowerCase().includes(t.toLowerCase())||s.format.toLowerCase().includes(t.toLowerCase()),o=hat(s,n);return i&&o}),hat=(e,t)=>t==="refiner"?e.base==="sdxl-refiner":t==="main"&&e.base==="sdxl-refiner"?!1:t?e.type===t:!0,_pe=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(C_),s=h.useCallback(()=>{t(dq(null))},[t]);return a.jsxs(An,{placement:"bottom-end",children:[a.jsx(Pn,{as:he,size:"sm",rightIcon:a.jsx(KDe,{}),children:e(n?s_e[n].i18nKey:"modelManager.allModels")}),a.jsxs(Zt,{children:[a.jsx(be,{onClick:s,children:e("modelManager.allModels")}),cq.map(i=>a.jsx(Spe,{data:i},i.category))]})]})});_pe.displayName="ModelTypeFilter";const Spe=h.memo(({data:e})=>{const{t}=T(),n=Q(),s=M(C_),i=h.useCallback(()=>{n(dq(e.category))},[e.category,n]);return a.jsx(be,{bg:s===e.category?"base.700":"transparent",onClick:i,children:t(e.i18nKey)})});Spe.displayName="ModelMenuItem";const kpe=h.memo(()=>{const e=Q(),t=M(WM),n=h.useCallback(i=>{e(iR(i.target.value))},[e]),s=h.useCallback(()=>{e(iR(""))},[e]);return a.jsxs(A,{flexDirection:"column",gap:2,bg:"base.800",p:3,pb:2,rounded:"base",children:[a.jsxs(A,{gap:2,alignItems:"center",children:[a.jsx(A,{alignItems:"center",w:"100%",children:a.jsxs(tc,{children:[a.jsx(Nt,{placeholder:ye("modelManager.search"),value:t||"","data-testid":"board-search-input",onChange:n}),!!t?.length&&a.jsx(Hr,{h:"full",pe:2,children:a.jsx(oe,{size:"sm",variant:"link","aria-label":ye("boards.clearSearch"),icon:a.jsx(fn,{}),onClick:s})})]})}),a.jsx(A,{shrink:0,children:a.jsx(_pe,{})})]}),a.jsx(wpe,{})]})});kpe.displayName="ModelListNavigation";const pat={flexDir:"column",p:4,gap:4,borderRadius:"base",w:"50%",minWidth:"360px",h:"full"},Ipe=h.memo(()=>{const{t:e}=T(),t=Q(),n=h.useCallback(()=>{t(x_(null))},[t]),s=M(Zy);return a.jsxs(A,{sx:pat,children:[a.jsxs(A,{w:"full",gap:4,justifyContent:"space-between",alignItems:"center",children:[a.jsx(Pt,{fontSize:"xl",py:1,children:e("common.modelManager")}),!!s&&a.jsx(he,{size:"sm",colorScheme:"invokeYellow",leftIcon:a.jsx(Sn,{}),onClick:n,children:e("modelManager.addModels")})]}),a.jsxs(A,{flexDir:"column",gap:4,w:"full",h:"full",children:[a.jsx(kpe,{}),a.jsx(rat,{})]})]})});Ipe.displayName="ModelManager";const gD=e=>[e,...e.dependencies||[]],jpe=()=>{const{modelList:e}=Fh(void 0,{selectFromResult:({data:s})=>({modelList:s?$l.selectAll(s):os})}),t=h.useCallback(({source:s,name:i,base:o,type:r,is_installed:l,previous_names:c})=>e.some(d=>l||s===d.source||o===d.base&&(i===d.name||c?.includes(i))&&r===d.type),[e]),n=h.useCallback(s=>{const{name:i,base:o,type:r,source:l,description:c,format:d}=s;return{config:{name:i,base:o,type:r,description:c,format:d},source:l}},[]);return{getIsInstalled:t,buildModelInstallArg:n}},Epe=()=>{const[e]=uq(),{getIsInstalled:t,buildModelInstallArg:n}=jpe(),{t:s}=T(),i=h.useCallback(r=>{const l=mIe(r.models,gD),c=fK(l,(p,m)=>p.source===m.source||p.name===m.name&&p.base===m.base&&p.type===m.type),d=c.filter(pK(t)).map(n),u=c.filter(t).map(n);return{install:d,skip:u}},[t,n]);return{installBundle:h.useCallback(r=>{const l=i(r);if(l.install.length===0){pe({status:"info",title:s("modelManager.bundleAlreadyInstalled"),description:s("modelManager.bundleAlreadyInstalledDesc",{bundleName:r.name})});return}l.install.forEach(e);let c=s("modelManager.installingXModels",{count:l.install.length});l.skip.length>1&&(c+=s("modelManager.skippingXDuplicates",{count:l.skip.length-1})),pe({status:"info",title:s("modelManager.installingBundle"),description:c})},[i,e,s]),getModelsToInstall:i}},z8=e=>{const{getModelsToInstall:t}=Epe(),n=h.useMemo(()=>e.models.length,[e.models.length]),s=h.useMemo(()=>t(e).install,[e,t]),i=h.useMemo(()=>t(e).skip,[e,t]);return{total:n,skip:i,install:s}},Ape=({bundle:e,...t})=>{const{installBundle:n}=Epe(),{install:s}=z8(e),{isOpen:i,onOpen:o,onClose:r}=jo(),l=h.useCallback(d=>{d.stopPropagation(),o()},[o]),c=h.useCallback(()=>{n(e)},[n,e]);return a.jsxs(a.Fragment,{children:[a.jsxs(he,{display:"flex",justifyContent:"space-between",gap:2,onClick:l,isDisabled:s.length===0,...t,children:[a.jsx("span",{children:e.name}),a.jsx(Wh,{size:"16px"})]}),a.jsx(Ko,{isOpen:i,onClose:r,title:ye("modelManager.installBundle"),acceptCallback:c,acceptButtonText:ye("modelManager.install"),useInert:!1,children:a.jsxs(A,{rowGap:4,flexDirection:"column",children:[a.jsx(q,{fontWeight:"bold",children:ye("modelManager.installBundleMsg1",{bundleName:e.name})}),a.jsx(q,{children:ye("modelManager.installBundleMsg2",{count:s.length})}),a.jsx(Li,{children:s.map((d,u)=>a.jsx(rn,{wordBreak:"break-all",children:a.jsx(q,{children:d.config.name})},u))})]})})]})},Ppe=h.memo(({bundle:e})=>{const{t}=T(),{total:n,install:s,skip:i}=z8(e);return a.jsxs(A,{flexDir:"column",p:1,gap:2,children:[a.jsx(q,{children:t("modelManager.includesNModels",{n})}),s.length===0&&a.jsxs(A,{flexDir:"column",children:[a.jsxs(q,{fontWeight:"semibold",children:[t("modelManager.allNModelsInstalled",{count:n}),"."]}),a.jsx(Li,{children:i.map((o,r)=>a.jsx(rn,{wordBreak:"break-all",children:o.config.name},r))})]}),s.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs(A,{flexDir:"column",children:[a.jsxs(q,{fontWeight:"semibold",children:[t("modelManager.nToInstall",{count:s.length}),":"]}),a.jsx(Li,{children:s.map((o,r)=>a.jsx(rn,{wordBreak:"break-all",children:o.config.name},r))})]}),a.jsxs(A,{flexDir:"column",children:[a.jsxs(q,{fontWeight:"semibold",children:[t("modelManager.nAlreadyInstalled",{count:i.length}),":"]}),a.jsx(Li,{children:i.map((o,r)=>a.jsx(rn,{wordBreak:"break-all",children:o.config.name},r))})]})]})]})});Ppe.displayName="StarterBundleTooltipContent";const tg=()=>{const{t:e}=T(),[t,n]=uq();return[h.useCallback(({source:i,inplace:o,config:r,onSuccess:l,onError:c})=>{r||={},t({source:i,inplace:o,config:r}).unwrap().then(d=>{l&&l(),pe({id:"MODEL_INSTALL_QUEUED",title:e("toast.modelAddedSimple"),status:"success"})}).catch(d=>{c&&c(d),d&&pe({id:"MODEL_INSTALL_QUEUE_FAILED",title:`${d.data.detail} `,status:"error"})})},[t,e]),n]},V8=h.memo(({handleInstall:e,isInstalled:t})=>{const{t:n}=T();return a.jsx(A,{gap:2,shrink:0,pt:1,children:t?a.jsx(Bi,{variant:"subtle",colorScheme:"green",display:"flex",gap:1,alignItems:"center",borderRadius:"base",h:"24px",children:a.jsx(Yc,{size:"14px"})}):a.jsx(he,{onClick:e,rightIcon:a.jsx(Sn,{size:"14px"}),textTransform:"uppercase",letterSpacing:"wider",fontSize:"9px",size:"sm",children:n("modelManager.install")})})});V8.displayName="ModelResultItemActions";const fat={alignItems:"start",justifyContent:"space-between",w:"100%",py:2,px:1,gap:2,borderBottomWidth:"1px",borderColor:"base.700"},Tpe=h.memo(({starterModel:e})=>{const{t}=T(),{getIsInstalled:n,buildModelInstallArg:s}=jpe(),i=h.useMemo(()=>gD(e).every(n),[n,e]),o=h.useMemo(()=>gD(e).filter(pK(n)).map(s),[n,e,s]),[r]=tg(),l=h.useCallback(()=>{o.forEach(r),pe({status:"info",title:t("modelManager.installingModel"),description:t("modelManager.installingXModels",{count:o.length})})},[o,r,t]);return a.jsxs(A,{sx:fat,children:[a.jsxs(A,{fontSize:"sm",flexDir:"column",children:[a.jsx(q,{fontWeight:"semibold",children:e.name}),a.jsx(q,{variant:"subtext",children:e.description}),a.jsxs(A,{gap:1,py:1,alignItems:"center",children:[a.jsx(Bi,{h:"min-content",children:e.type.replaceAll("_"," ")}),a.jsx(bpe,{base:e.base})]})]}),a.jsx(V8,{handleInstall:l,isInstalled:i})]})});Tpe.displayName="StarterModelsResultItem";const Dpe=h.memo(({results:e})=>{const{t}=T(),[n,s]=h.useState(""),i=h.useMemo(()=>e.starter_models.filter(l=>{const c=n.trim().toLowerCase(),d=[l.name.toLowerCase(),l.type.toLowerCase().replaceAll("_"," "),l.description.toLowerCase(),l.base.toLowerCase()];return l.type==="spandrel_image_to_image"&&(d.push("upscale"),d.push("post-processing"),d.push("postprocessing"),d.push("post processing")),d.some(u=>u.includes(c))}),[e,n]),o=h.useCallback(l=>{s(l.target.value)},[]),r=h.useCallback(()=>{s("")},[]);return a.jsxs(A,{flexDir:"column",gap:3,height:"100%",children:[a.jsxs(A,{gap:3,direction:"column",children:[hq(e.starter_bundles)>0&&a.jsxs(A,{gap:4,alignItems:"center",justifyContent:"space-between",p:4,borderWidth:"1px",rounded:"base",children:[a.jsxs(A,{gap:2,alignItems:"center",children:[a.jsx(q,{color:"base.200",fontWeight:"semibold",children:t("modelManager.starterBundles")}),a.jsx(He,{label:t("modelManager.starterBundleHelpText"),children:a.jsx(A,{alignItems:"center",children:a.jsx(Je,{as:km,color:"base.200"})})})]}),a.jsx(A,{gap:2,children:Wr(e.starter_bundles,l=>a.jsx(Ape,{bundle:l,tooltip:a.jsx(Ppe,{bundle:l}),size:"sm"},l.name))})]}),a.jsxs(tc,{w:"100%",size:"xs",children:[a.jsx(Nt,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:o,size:"xs"}),n&&a.jsx(Hr,{h:"full",pe:2,children:a.jsx(oe,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:a.jsx(fn,{}),onClick:r,flexShrink:0})})]})]}),a.jsx(A,{height:"100%",layerStyle:"second",borderRadius:"base",px:2,children:a.jsx(Hs,{children:a.jsx(A,{flexDir:"column",children:i.map(l=>a.jsx(Tpe,{starterModel:l},l.source))})})})]})});Dpe.displayName="StarterModelsResults";const Mpe=h.memo(()=>{const{isLoading:e,data:t}=pq(),{t:n}=T();return a.jsxs(A,{flexDir:"column",height:"100%",gap:3,children:[e&&a.jsx(B8,{loadingMessage:n("common.loading")}),t&&a.jsx(Dpe,{results:t})]})});Mpe.displayName="StarterModelsForm";function Lpe(e){return fe({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M1.4446 11.5059c0 1.1021.1673 2.1585.4847 3.1563-.0378-.0028-.0691-.0058-.1058-.0058-.4209 0-.8015.16-1.0704.4512-.3454.3737-.4984.8335-.4316 1.293a1.576 1.576 0 0 0 .2148.5978c-.2319.1864-.4018.4456-.4844.7578-.0646.2448-.131.7543.2149 1.2794a1.4552 1.4552 0 0 0-.0625.1055c-.208.3923-.2207.8372-.0371 1.25.2783.6258.9696 1.1175 2.3126 1.6467.8356.3292 1.5988.5411 1.6056.543 1.1046.2847 2.104.4277 2.969.4277 1.4173 0 2.4754-.3849 3.1525-1.1446 1.538.2651 2.791.1403 3.592.006.6773.7555 1.7332 1.1387 3.1467 1.1387.8649 0 1.8643-.143 2.969-.4278.0068-.0019.77-.2138 1.6056-.543 1.343-.5292 2.0343-1.0208 2.3126-1.6466.1836-.4129.171-.8577-.037-1.25a1.4685 1.4685 0 0 0-.0626-.1056c.346-.525.2795-1.0346.2149-1.2793-.0826-.3122-.2525-.5714-.4844-.7579.11-.1816.1831-.3788.2148-.5977.0669-.4595-.0862-.9193-.4316-1.293-.2688-.2913-.6495-.4513-1.0704-.4513-.0209 0-.0376.0008-.0588.0018.3162-.9966.4846-2.0518.4846-3.1523 0-5.807-4.7362-10.5144-10.5789-10.5144-5.8426 0-10.5788 4.7073-10.5788 10.5144Zm10.5788-9.4831c5.2727 0 9.5476 4.246 9.5476 9.483a9.4201 9.4201 0 0 1-.2696 2.2365c-.0039-.0047-.0079-.011-.0117-.0156-.274-.3255-.6679-.5059-1.1075-.5059-.352 0-.714.1155-1.0763.3438-.2403.1517-.5058.422-.7793.7598-.2534-.3492-.608-.5832-1.0137-.6465a1.5174 1.5174 0 0 0-.2344-.0176c-.9263 0-1.4828.7993-1.6935 1.5177-.1046.2426-.6065 1.3482-1.3614 2.0978-1.1681 1.1601-1.4458 2.3534-.8396 3.6382-.843.1029-1.5836.0927-2.365-.006.5906-1.212.3626-2.4388-.8426-3.6322-.755-.7496-1.2568-1.8552-1.3614-2.0978-.2107-.7184-.7673-1.5177-1.6935-1.5177-.078 0-.1568.0054-.2344.0176-.4057.0633-.7604.2973-1.0137.6465-.2735-.3379-.539-.6081-.7794-.7598-.3622-.2283-.7243-.3438-1.0762-.3438-.4266 0-.8094.171-1.0821.4786a9.4208 9.4208 0 0 1-.2598-2.1936c0-5.237 4.2749-9.483 9.5475-9.483zM8.6443 7.0036c-.4838.0043-.9503.2667-1.1934.7227-.3536.6633-.1006 1.4873.5645 1.84.351.1862.4883-.5261.836-.6485.3107-.1095.841.399 1.0078.086.3536-.6634.1025-1.4874-.5625-1.84a1.3659 1.3659 0 0 0-.6524-.1602Zm6.8403 0c-.2199-.002-.4426.05-.6504.1602-.665.3526-.9181 1.1766-.5645 1.84.1669.313.6971-.1955 1.0079-.086.3476.1224.4867.8347.838.6485.6649-.3527.916-1.1767.5624-1.84-.243-.456-.7096-.7184-1.1934-.7227Zm-9.7565 1.418a.8768.8768 0 0 0-.877.877c0 .4846.3925.877.877.877a.8768.8768 0 0 0 .877-.877.8768.8768 0 0 0-.877-.877zm12.6434 0c-.4845 0-.879.3925-.879.877 0 .4846.3945.877.879.877a.8768.8768 0 0 0 .877-.877.8768.8768 0 0 0-.877-.877zM8.7927 11.459c-.179-.003-.2793.1107-.2793.416 0 .8097.3874 2.125 1.4279 2.924.207-.7123 1.3453-1.2832 1.5079-1.2012.2315.1167.2191.4417.6074.7266.3884-.285.374-.6098.6056-.7266.1627-.082 1.3009.4889 1.5079 1.2012 1.0404-.799 1.4278-2.1144 1.4278-2.924 0-1.2212-1.583.6402-3.5413.6485-1.4686-.0061-2.7266-1.0558-3.2639-1.0645zM4.312 14.4768c.5792.365 1.6964 2.2751 2.1056 3.0177.1371.2488.371.3536.582.3536.4188 0 .7465-.4138.0391-.9395-1.0636-.791-.6914-2.0846-.1836-2.1642a.4302.4302 0 0 1 .0664-.004c.4616 0 .666.7892.666.7892s.5959 1.4898 1.6213 2.508c.942.9356 1.062 1.703.4961 2.6661-.0164-.004-.0159.0236-.1484.2149-.1853.2673-.4322.4688-.7188.6152-.5062.2269-1.1397.2696-1.7833.2696-1.037 0-2.1017-.1824-2.6975-.336-.0293-.0075-3.6505-.9567-3.1916-1.8224.0771-.1454.2033-.2031.3633-.2031.6463 0 1.823.9551 2.3283.9551.113 0 .196-.0865.2285-.2031.2249-.8045-3.2787-1.0522-2.9846-2.1642.0519-.1967.193-.2757.3907-.2754.854 0 2.7704 1.4923 3.172 1.4923.0307 0 .0525-.0085.0645-.0274.2012-.3227.1096-.5865-1.3087-1.4395-1.4182-.8533-2.4315-1.329-1.8653-1.9416.0651-.0707.1574-.1015.2695-.1015.8611.0002 2.8948 1.84 2.8948 1.84s.5487.5683.8809.5683c.0762 0 .1416-.0315.1855-.1054.2355-.3946-2.1858-2.2183-2.3224-2.971-.0926-.51.0641-.7676.3555-.7676-.0006.008.1701-.0285.4942.1759zm16.2257.5918c-.1366.7526-2.5579 2.5764-2.3224 2.9709.044.074.1092.1055.1855.1055.3321 0 .881-.5684.881-.5684s2.0336-1.8397 2.8947-1.84c.1121 0 .2044.0308.2695.1016.5662.6125-.447 1.0882-1.8653 1.9415-1.4183.853-1.51 1.1168-1.3087 1.4396.012.0188.0337.0273.0644.0273.4016 0 2.3181-1.4923 3.1721-1.4923.1977-.0002.3388.0787.3907.2754.294 1.112-3.2095 1.3597-2.9846 2.1642.0325.1166.1156.2032.2285.2032.5054 0 1.682-.9552 2.3283-.9552.16 0 .2862.0577.3633.2032.459.8656-3.1623 1.8149-3.1916 1.8224-.5958.1535-1.6605.336-2.6975.336-.6351 0-1.261-.0409-1.7638-.2599-.2949-.1472-.5488-.3516-.7383-.625-.0411-.0682-.1026-.1476-.1426-.205-.5726-.9679-.455-1.7371.4903-2.676 1.0254-1.0182 1.6212-2.508 1.6212-2.508s.2044-.7891.666-.7891a.4318.4318 0 0 1 .0665.0039c.5078.0796.88 1.3732-.1836 2.1642-.7074.5257-.3797.9395.039.9395.211 0 .445-.1047.5821-.3535.4092-.7426 1.5264-2.6527 2.1056-3.0178.5588-.3524.99-.1816.8497.5918z"},child:[]}]})(e)}const mat=()=>{const{t:e}=T(),{currentData:t}=_H(),n=h.useMemo(()=>{switch(t){case"invalid":return e("modelManager.hfTokenInvalidErrorMessage");case"unknown":return e("modelManager.hfTokenUnableToVerifyErrorMessage");case"valid":case void 0:return null;default:ae(!1,"Unexpected HF token status")}},[t,e]);return t?a.jsx(A,{borderRadius:"base",w:"full",children:a.jsxs(te,{isInvalid:!!n,orientation:"vertical",children:[a.jsx(ne,{children:e("modelManager.hfTokenLabel")}),n&&a.jsx(Ope,{}),!n&&a.jsx(Rpe,{}),a.jsx(Vo,{children:a.jsx(to,{label:e("modelManager.hfTokenHelperText"),href:"https://huggingface.co/settings/tokens"})}),a.jsx(zh,{children:n})]})}):null},gat=Array.from({length:37},()=>"a").join(""),Rpe=h.memo(()=>{const{t:e}=T(),[t,{isLoading:n}]=o_e(),s=h.useCallback(()=>{t().unwrap().then(()=>{pe({title:e("modelManager.hfTokenReset"),status:"info"})})},[t,e]);return a.jsxs(A,{gap:3,alignItems:"center",w:"full",children:[a.jsx(Nt,{type:"password",value:gat,isDisabled:!0}),a.jsx(he,{onClick:s,size:"sm",isLoading:n,children:e("common.reset")})]})});Rpe.displayName="ResetHFTokenButton";const Ope=h.memo(()=>{const{t:e}=T(),[t,n]=h.useState(""),[s,{isLoading:i}]=i_e(),o=h.useCallback(l=>{n(l.target.value)},[]),r=h.useCallback(()=>{s({token:t}).unwrap().then(l=>{switch(l){case"valid":n(""),pe({title:e("modelManager.hfTokenSaved"),status:"success"});break;case"invalid":case"unknown":default:pe({title:e("modelManager.hfTokenUnableToVerify"),status:"error"});break}})},[e,t,s]);return a.jsxs(A,{gap:3,alignItems:"center",w:"full",children:[a.jsx(Nt,{type:"password",value:t,onChange:o}),a.jsx(he,{onClick:r,size:"sm",isDisabled:t.trim().length===0,isLoading:i,children:e("common.save")})]})});Ope.displayName="SetHFTokenInput";const Npe=h.memo(({result:e})=>{const{t}=T(),[n]=tg(),s=h.useCallback(()=>{n({source:e})},[n,e]);return a.jsxs(A,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[a.jsxs(A,{fontSize:"sm",flexDir:"column",children:[a.jsx(q,{fontWeight:"semibold",children:e.split("/").slice(-1)[0]}),a.jsx(q,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:e})]}),a.jsx(oe,{"aria-label":t("modelManager.install"),icon:a.jsx(Sn,{}),onClick:s,size:"sm"})]})});Npe.displayName="HuggingFaceResultItem";const Fpe=h.memo(({results:e})=>{const{t}=T(),[n,s]=h.useState(""),[i]=tg(),o=h.useMemo(()=>e.filter(d=>d.split("/").slice(-1)[0]?.toLowerCase().includes(n.toLowerCase())),[e,n]),r=h.useCallback(d=>{s(d.target.value.trim())},[]),l=h.useCallback(()=>{s("")},[]),c=h.useCallback(()=>{for(const d of o)i({source:d})},[o,i]);return a.jsxs(a.Fragment,{children:[a.jsx(vt,{}),a.jsxs(A,{flexDir:"column",gap:3,height:"100%",children:[a.jsxs(A,{justifyContent:"space-between",alignItems:"center",children:[a.jsx(Pt,{size:"sm",children:t("modelManager.availableModels")}),a.jsxs(A,{alignItems:"center",gap:3,children:[a.jsx(he,{size:"sm",onClick:c,isDisabled:e.length===0,flexShrink:0,children:t("modelManager.installAll")}),a.jsxs(tc,{w:64,size:"xs",children:[a.jsx(Nt,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:r,size:"xs"}),n&&a.jsx(Hr,{h:"full",pe:2,children:a.jsx(oe,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:a.jsx(fn,{}),onClick:l})})]})]})]}),a.jsx(A,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:a.jsx(Hs,{children:a.jsx(A,{flexDir:"column",gap:3,children:o.map(d=>a.jsx(Npe,{result:d},d))})})})]})]})});Fpe.displayName="HuggingFaceResults";const Bpe=h.memo(()=>{const[e,t]=h.useState(""),[n,s]=h.useState(!1),[i,o]=h.useState(""),{t:r}=T(),[l,{isLoading:c,data:d}]=a_e(),[u]=tg(),p=h.useCallback(()=>{l(e).unwrap().then(f=>{f.is_diffusers?(u({source:e}),s(!1)):f.urls?.length===1&&f.urls[0]?(u({source:f.urls[0]}),s(!1)):s(!0)}).catch(f=>{o(f.data.detail||"")})},[l,u,e]),m=h.useCallback(f=>{t(f.target.value),o("")},[]);return a.jsxs(A,{flexDir:"column",height:"100%",gap:4,children:[a.jsxs(te,{isInvalid:!!i.length,w:"full",orientation:"vertical",flexShrink:0,children:[a.jsx(ne,{children:r("modelManager.huggingFaceRepoID")}),a.jsxs(A,{gap:3,alignItems:"center",w:"full",children:[a.jsx(Nt,{placeholder:r("modelManager.huggingFacePlaceholder"),value:e,onChange:m}),a.jsx(he,{onClick:p,isLoading:c,isDisabled:e.length===0,size:"sm",flexShrink:0,children:r("modelManager.installRepo")})]}),a.jsx(Vo,{children:r("modelManager.huggingFaceHelper")}),!!i.length&&a.jsx(zh,{children:i})]}),a.jsx(mat,{}),d&&d.urls&&n&&a.jsx(Fpe,{results:d.urls})]})});Bpe.displayName="HuggingFaceForm";const zpe=h.memo(()=>{const e=M(fq),t=Q(),[n,{isLoading:s}]=tg(),{register:i,handleSubmit:o,formState:r,reset:l}=Om({defaultValues:{location:""},mode:"onChange"}),c=h.useCallback(()=>l(void 0,{keepValues:!0}),[l]),d=h.useCallback(p=>{p?.location&&n({source:p.location,inplace:e,onSuccess:c,onError:c})},[n,c,e]),u=h.useCallback(p=>{t(mq(p.target.checked))},[t]);return a.jsx("form",{onSubmit:o(d),children:a.jsxs(A,{flexDir:"column",gap:4,children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:ye("modelManager.urlOrLocalPath")}),a.jsxs(A,{alignItems:"center",gap:3,w:"full",children:[a.jsx(Nt,{placeholder:ye("modelManager.simpleModelPlaceholder"),...i("location")}),a.jsx(he,{onClick:o(d),isDisabled:!r.dirtyFields.location,isLoading:s,size:"sm",children:ye("modelManager.install")})]}),a.jsx(Vo,{children:ye("modelManager.urlOrLocalPathHelper")})]}),a.jsx(te,{children:a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsxs(A,{gap:4,children:[a.jsx(us,{isChecked:e,onChange:u}),a.jsxs(ne,{children:[ye("modelManager.inplaceInstall")," (",ye("modelManager.localOnly"),")"]})]}),a.jsx(Vo,{children:ye("modelManager.inplaceInstallDesc")})]})})]})})});zpe.displayName="InstallModelForm";const Vpe=h.memo(({bundle:e})=>{const{t}=T(),{total:n,install:s,skip:i}=z8(e);return a.jsxs(A,{flexDir:"column",gap:1,p:1,children:[a.jsx(q,{children:t("modelManager.includesNModels",{n})}),s.length===0&&a.jsxs(q,{fontWeight:"semibold",children:[t("modelManager.allNModelsInstalled",{count:n}),"."]}),s.length>0&&a.jsx(q,{fontWeight:"semibold",children:t("modelManager.installedModelsCount",{installed:i.length,total:n})})]})});Vpe.displayName="StarterBundleTooltipContentCompact";const M2=h.memo(e=>{const{onClick:t,icon:n,title:s,description:i}=e;return a.jsxs(he,{onClick:t,variant:"outline",p:4,textAlign:"left",flexDir:"column",gap:2,h:"unset",children:[a.jsxs(A,{alignItems:"center",gap:4,w:"full",children:[a.jsx(Je,{as:n,boxSize:8,color:"base.300"}),a.jsx(Pt,{size:"sm",color:"base.100",children:s})]}),a.jsx(q,{lineHeight:"1.4",flex:"1",whiteSpace:"normal",wordBreak:"break-word",children:i})]})});M2.displayName="LaunchpadButton";const $pe=h.memo(()=>{const{t:e}=T(),{data:t}=pq(),n=h.useCallback(()=>{El("urlOrLocal")},[]),s=h.useCallback(()=>{El("huggingface")},[]),i=h.useCallback(()=>{El("scanFolder")},[]),o=h.useCallback(()=>{El("starterModels")},[]);return a.jsx(A,{flexDir:"column",height:"100%",gap:3,children:a.jsx(Hs,{children:a.jsxs(A,{flexDir:"column",gap:6,py:2,children:[a.jsxs(A,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsx(Pt,{size:"md",children:e("modelManager.launchpad.welcome")}),a.jsx(q,{color:"base.300",children:e("modelManager.launchpad.description")})]}),a.jsxs(A,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsx(Pt,{size:"sm",children:e("modelManager.launchpad.manualInstall")}),a.jsxs(Ms,{templateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:3,w:"full",children:[a.jsx(M2,{onClick:n,icon:cX,title:e("modelManager.urlOrLocalPath"),description:e("modelManager.launchpad.urlDescription")}),a.jsx(M2,{onClick:s,icon:Lpe,title:e("modelManager.huggingFace"),description:e("modelManager.launchpad.huggingFaceDescription")}),a.jsx(M2,{onClick:i,icon:J_,title:e("modelManager.scanFolder"),description:e("modelManager.launchpad.scanFolderDescription")})]})]}),t&&a.jsxs(A,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsx(Pt,{size:"sm",children:e("modelManager.launchpad.recommendedModels")}),a.jsx(q,{color:"base.300",children:e("modelManager.launchpad.bundleDescription")}),a.jsx(Ms,{templateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:2,w:"full",children:Wr(t.starter_bundles,r=>a.jsx(Ape,{size:"md",tooltip:a.jsx(Vpe,{bundle:r}),bundle:r,variant:"outline",p:4,h:"unset"},r.name))}),a.jsx(he,{onClick:o,variant:"link",size:"sm",leftIcon:a.jsx(eS,{}),colorScheme:"invokeBlue",children:e("modelManager.launchpad.exploreStarter")})]})]})})})});$pe.displayName="LaunchpadForm";const hA={waiting:{colorScheme:"cyan",translationKey:"queue.pending"},downloading:{colorScheme:"yellow",translationKey:"queue.in_progress"},downloads_done:{colorScheme:"yellow",translationKey:"queue.in_progress"},running:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},error:{colorScheme:"red",translationKey:"queue.failed"},cancelled:{colorScheme:"orange",translationKey:"queue.canceled"}},vat=({status:e})=>{const{t}=T();return!e||!Object.keys(hA).includes(e)?null:a.jsx(Bi,{textAlign:"center",w:"134px",colorScheme:hA[e].colorScheme,children:t(hA[e].translationKey)})},yat=h.memo(vat),D$=e=>{const t=["B","KB","MB","GB","TB"];let n=0;for(n;e>=1024&&n<4;n++)e/=1024;return`${e.toFixed(2)} ${t[n]}`},Gpe=h.memo(e=>{const{installJob:t}=e,[n]=r_e(),s=h.useCallback(()=>{n(t.id).unwrap().then(l=>{pe({id:"MODEL_INSTALL_CANCELED",title:ye("toast.modelImportCanceled"),status:"success"})}).catch(l=>{l&&pe({id:"MODEL_INSTALL_CANCEL_FAILED",title:`${l.data.detail} `,status:"error"})})},[n,t]),i=h.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url;case"local":return t.source.path;default:return ye("common.unknown")}},[t.source]),o=h.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url.split("/").slice(-1)[0]??ye("common.unknown");case"local":return t.source.path.split("\\").slice(-1)[0]??ye("common.unknown");default:return ye("common.unknown")}},[t.source]),r=h.useMemo(()=>t.status==="completed"||t.status==="error"||t.status==="cancelled"?100:st(t.bytes)||st(t.total_bytes)?null:t.total_bytes===0?0:t.bytes/t.total_bytes*100,[t.bytes,t.status,t.total_bytes]);return a.jsxs(A,{gap:3,w:"full",alignItems:"center",children:[a.jsx(He,{maxW:600,label:a.jsx(Hpe,{name:o,source:i,installJob:t}),children:a.jsxs(A,{gap:3,w:"full",alignItems:"center",children:[a.jsx(q,{w:96,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:o}),a.jsx(hU,{w:"full",flexGrow:1,value:r??0,isIndeterminate:r===null,"aria-label":ye("accessibility.invokeProgressBar"),h:2}),a.jsx(yat,{status:t.status})]})}),a.jsx(oe,{isDisabled:t.status!=="downloading"&&t.status!=="waiting"&&t.status!=="running",size:"xs",tooltip:ye("modelManager.cancel"),"aria-label":ye("modelManager.cancel"),icon:a.jsx(fn,{}),onClick:s,variant:"ghost"})]})});Gpe.displayName="ModelInstallQueueItem";const Hpe=h.memo(({name:e,source:t,installJob:n})=>{const s=h.useMemo(()=>n.status!=="downloading"||n.bytes===void 0||n.total_bytes===void 0?"":`${D$(n.bytes)} / ${D$(n.total_bytes)}`,[n.bytes,n.total_bytes,n.status]);return a.jsxs(a.Fragment,{children:[a.jsxs(A,{gap:3,justifyContent:"space-between",children:[a.jsx(q,{fontWeight:"semibold",children:e}),s&&a.jsx(q,{children:s})]}),a.jsx(q,{fontStyle:"italic",wordBreak:"break-all",children:t}),n.error_reason&&a.jsxs(q,{color:"error.500",children:[ye("queue.failed"),": ",n.error]})]})});Hpe.displayName="TooltipLabel";const Wpe=h.memo(()=>{const{data:e}=l_e(),[t]=c_e(),n=h.useCallback(()=>{t().unwrap().then(i=>{pe({id:"MODEL_INSTALL_QUEUE_PRUNED",title:ye("toast.prunedQueue"),status:"success"})}).catch(i=>{i&&pe({id:"MODEL_INSTALL_QUEUE_PRUNE_FAILED",title:`${i.data.detail} `,status:"error"})})},[t]),s=h.useMemo(()=>e?.some(i=>i.status==="cancelled"||i.status==="error"||i.status==="completed"),[e]);return a.jsxs(A,{flexDir:"column",p:3,h:"full",gap:3,children:[a.jsxs(A,{justifyContent:"space-between",alignItems:"center",children:[a.jsx(Pt,{size:"sm",children:ye("modelManager.installQueue")}),a.jsx(he,{size:"sm",isDisabled:!s,onClick:n,tooltip:ye("modelManager.pruneTooltip"),children:ye("modelManager.prune")})]}),a.jsx(ke,{layerStyle:"first",p:3,borderRadius:"base",w:"full",h:"full",children:a.jsx(Hs,{children:a.jsx(A,{flexDir:"column-reverse",gap:"2",w:"full",children:e?.map(i=>a.jsx(Gpe,{installJob:i},i.id))})})})]})});Wpe.displayName="ModelInstallQueue";const bat={alignItems:"center",justifyContent:"space-between",w:"100%",py:2,px:1,gap:3,borderBottomWidth:"1px",borderColor:"base.700"},Upe=h.memo(({result:e,installModel:t})=>{const n=h.useCallback(()=>{t(e.path)},[t,e]),s=h.useMemo(()=>{const o=e.path.replace(/\\/g,"/").replace(/\/+$/,""),r=o.lastIndexOf("/");return r===-1?o:o.slice(r+1)},[e.path]),i=e.path.split(/[/\\]/);return a.jsxs(A,{sx:bat,children:[a.jsxs(A,{fontSize:"sm",flexDir:"column",children:[a.jsx(q,{fontWeight:"semibold",children:s}),a.jsx(A,{flexWrap:"wrap",color:"base.200",children:i.map((o,r)=>a.jsxs(q,{variant:"subtext",children:[o,r<i.length-1&&"/"]},r))})]}),a.jsx(V8,{handleInstall:n,isInstalled:e.is_installed})]})});Upe.displayName="ScanModelResultItem";const qpe=h.memo(({results:e})=>{const t=M(fq),n=Q(),{t:s}=T(),[i,o]=h.useState(""),[r]=tg(),l=h.useMemo(()=>e.filter(f=>f.path.split("\\").slice(-1)[0]?.toLowerCase().includes(i.toLowerCase())),[e,i]),c=h.useCallback(f=>{o(f.target.value.trim())},[]),d=h.useCallback(f=>{n(mq(f.target.checked))},[n]),u=h.useCallback(()=>{o("")},[]),p=h.useCallback(()=>{for(const f of l)f.is_installed||r({source:f.path,inplace:t})},[l,r,t]),m=h.useCallback(f=>{r({source:f,inplace:t})},[r,t]);return a.jsxs(a.Fragment,{children:[a.jsx(vt,{}),a.jsxs(A,{flexDir:"column",gap:3,height:"100%",children:[a.jsxs(A,{justifyContent:"space-between",alignItems:"center",children:[a.jsx(Pt,{size:"sm",children:s("modelManager.scanResults")}),a.jsxs(A,{alignItems:"center",gap:3,children:[a.jsx(He,{label:s("modelManager.inplaceInstallDesc"),hasArrow:!0,children:a.jsxs(te,{w:"min-content",children:[a.jsx(ne,{m:0,children:s("modelManager.inplaceInstall")}),a.jsx(us,{isChecked:t,onChange:d,size:"md"})]})}),a.jsx(he,{size:"sm",onClick:p,isDisabled:l.length===0,children:s("modelManager.installAll")}),a.jsxs(tc,{w:64,size:"xs",children:[a.jsx(Nt,{placeholder:s("modelManager.search"),value:i,"data-testid":"board-search-input",onChange:c,size:"xs"}),i&&a.jsx(Hr,{h:"full",pe:2,children:a.jsx(oe,{size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:a.jsx(fn,{}),onClick:u,flexShrink:0})})]})]})]}),a.jsx(A,{height:"100%",layerStyle:"second",borderRadius:"base",px:2,children:a.jsx(Hs,{children:a.jsx(A,{flexDir:"column",children:l.map(f=>a.jsx(Upe,{result:f,installModel:m},f.path))})})})]})]})});qpe.displayName="ScanModelsResults";const xat=d_e(e=>e.scanPath),Kpe=h.memo(()=>{const e=M(xat),t=Q(),[n,s]=h.useState(""),{t:i}=T(),[o,{isLoading:r,data:l}]=u_e(),c=h.useCallback(()=>{o({scan_path:e}).unwrap().catch(u=>{u&&s(u.data.detail)})},[o,e]),d=h.useCallback(u=>{t(h_e(u.target.value)),s("")},[t]);return a.jsxs(A,{flexDir:"column",height:"100%",gap:3,children:[a.jsxs(te,{isInvalid:!!n.length,w:"full",orientation:"vertical",flexShrink:0,children:[a.jsx(ne,{children:i("common.folder")}),a.jsxs(A,{gap:3,alignItems:"center",w:"full",children:[a.jsx(Nt,{placeholder:i("modelManager.scanPlaceholder"),value:e,onChange:d}),a.jsx(he,{onClick:c,isLoading:r,isDisabled:e===void 0||e.length===0,size:"sm",flexShrink:0,children:i("modelManager.scanFolder")})]}),a.jsx(Vo,{children:i("modelManager.scanFolderHelper")}),!!n.length&&a.jsx(zh,{children:n})]}),l&&a.jsx(qpe,{results:l})]})});Kpe.displayName="ScanModelsForm";const A0={display:"flex",gap:2,px:2},Zpe=h.memo(()=>{const{t:e}=T(),t=le(MP),n=h.useCallback(()=>{window.open("https://support.invoke.ai/support/solutions/articles/151000170961-supported-models")},[]);return a.jsxs(A,{layerStyle:"first",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:4,children:[a.jsxs(A,{alignItems:"center",justifyContent:"space-between",children:[a.jsx(Pt,{fontSize:"xl",children:e("modelManager.addModel")}),a.jsx(he,{alignItems:"center",variant:"link",leftIcon:a.jsx(km,{}),onClick:n,children:a.jsx(q,{variant:"subtext",children:e("modelManager.learnMoreAboutSupportedModels")})})]}),a.jsxs(Vy,{variant:"line",height:"100%",display:"flex",flexDir:"column",index:t,onChange:MP.set,children:[a.jsxs($y,{children:[a.jsxs(Qs,{sx:A0,children:[a.jsx(u1,{}),e("modelManager.launchpadTab")]}),a.jsxs(Qs,{sx:A0,children:[a.jsx(nMe,{}),e("modelManager.urlOrLocalPath")]}),a.jsxs(Qs,{sx:A0,children:[a.jsx(Lpe,{}),e("modelManager.huggingFace")]}),a.jsxs(Qs,{sx:A0,children:[a.jsx(J_,{}),e("modelManager.scanFolder")]}),a.jsxs(Qs,{sx:A0,children:[a.jsx(CMe,{}),e("modelManager.starterModels")]})]}),a.jsxs(Gy,{height:"100%",children:[a.jsx(Js,{height:"100%",children:a.jsx($pe,{})}),a.jsx(Js,{children:a.jsx(zpe,{})}),a.jsx(Js,{height:"100%",children:a.jsx(Bpe,{})}),a.jsx(Js,{height:"100%",children:a.jsx(Kpe,{})}),a.jsx(Js,{height:"100%",children:a.jsx(Mpe,{})})]})]}),a.jsx(ke,{layerStyle:"second",borderRadius:"base",h:"50%",children:a.jsx(Wpe,{})})]})});Zpe.displayName="InstallModels";const M$={w:108,h:108,fontSize:36,borderRadius:"base",display:"flex",alignItems:"center",justifyContent:"center",bg:"base.800",borderWidth:"1px",borderStyle:"solid",borderColor:"base.700",flexShrink:0},Cat=({model_key:e,model_image:t})=>{const[n,s]=h.useState(t||null),{t:i}=T(),[o,r]=p_e(),[l]=f_e(),c=h.useCallback(m=>{const f=m[0];!f||!e||o({key:e,image:f}).unwrap().then(()=>{s(URL.createObjectURL(f)),pe({id:"MODEL_IMAGE_UPDATED",title:i("modelManager.modelImageUpdated"),status:"success"})}).catch(()=>{pe({id:"MODEL_IMAGE_UPDATE_FAILED",title:i("modelManager.modelImageUpdateFailed"),status:"error"})})},[e,i,o]),d=h.useCallback(()=>{e&&(s(null),l(e).unwrap().then(()=>{pe({id:"MODEL_IMAGE_DELETED",title:i("modelManager.modelImageDeleted"),status:"success"})}).catch(()=>{pe({id:"MODEL_IMAGE_DELETE_FAILED",title:i("modelManager.modelImageDeleteFailed"),status:"error"})}))},[e,i,l]),{getInputProps:u,getRootProps:p}=oc({accept:AS,onDropAccepted:c,noDrag:!0,multiple:!1});return n?a.jsxs(ke,{position:"relative",flexShrink:0,children:[a.jsx(Nn,{src:n,objectFit:"cover",objectPosition:"50% 50%",minWidth:108,borderRadius:"base",sx:M$}),a.jsx(oe,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:d,"aria-label":i("modelManager.deleteModelImage"),tooltip:i("modelManager.deleteModelImage"),icon:a.jsx(Gs,{}),size:"md",variant:"ghost"})]}):a.jsxs(a.Fragment,{children:[a.jsx(oe,{variant:"ghost","aria-label":i("modelManager.uploadImage"),tooltip:i("modelManager.uploadImage"),fontSize:36,icon:a.jsx(qo,{}),sx:M$,isLoading:r.isLoading,...p()}),a.jsx("input",{...u()})]})},wat=sn(Cat),$8=h.memo(({modelConfig:e,children:t})=>{const{t:n}=T();return a.jsxs(A,{alignItems:"flex-start",gap:4,children:[a.jsx(wat,{model_key:e.key,model_image:e.cover_image}),a.jsxs(A,{flexDir:"column",gap:1,flexGrow:1,minW:0,children:[a.jsxs(A,{gap:2,children:[a.jsx(Pt,{as:"h2",fontSize:"lg",noOfLines:1,wordBreak:"break-all",children:e.name}),a.jsx(At,{}),t]}),e.source&&a.jsxs(q,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:[n("modelManager.source"),": ",e.source]}),a.jsx(q,{noOfLines:3,children:e.description})]})]})});$8.displayName="ModelHeader";const L$=Gr(lU).map(([e,t])=>({label:t,value:e})),_at=({control:e})=>{const{field:t}=si({control:e,name:"base"}),n=h.useMemo(()=>L$.find(i=>i.value===t.value),[t.value]),s=h.useCallback(i=>{t.onChange(i?.value)},[t]);return a.jsx(pt,{value:n,options:L$,onChange:s})},Sat=sn(_at),R$=Gr(m_e).map(([e,t])=>({label:t,value:e})),kat=({control:e})=>{const{field:t}=si({control:e,name:"format"}),n=h.useMemo(()=>R$.find(i=>i.value===t.value),[t.value]),s=h.useCallback(i=>{t.onChange(i?.value)},[t]);return a.jsx(pt,{value:n,options:R$,onChange:s})},Iat=sn(kat),O$=Gr(g_e).map(([e,t])=>({label:t,value:e})),jat=({control:e})=>{const{field:t}=si({control:e,name:"type"}),n=h.useMemo(()=>O$.find(i=>i.value===t.value),[t.value]),s=h.useCallback(i=>{t.onChange(i?.value)},[t]);return a.jsx(pt,{value:n,options:O$,onChange:s})},Eat=sn(jat),N$=Gr(v_e).map(([e,t])=>({label:t,value:e})),Aat=({control:e})=>{const{field:t}=si({control:e,name:"variant"}),n=h.useMemo(()=>N$.find(i=>i.value===t.value),[t.value]),s=h.useCallback(i=>{t.onChange(i?.value)},[t]);return a.jsx(pt,{value:n,options:N$,onChange:s})},Pat=sn(Aat),F$=[{value:"none",label:"-"},{value:"epsilon",label:"epsilon"},{value:"v_prediction",label:"v_prediction"},{value:"sample",label:"sample"}],Tat=({control:e})=>{const{field:t}=si({control:e,name:"prediction_type"}),n=h.useMemo(()=>F$.find(i=>i.value===t.value),[t.value]),s=h.useCallback(i=>{i?.value==="none"?t.onChange(void 0):t.onChange(i?.value)},[t]);return a.jsx(pt,{value:n,options:F$,onChange:s})},Dat=sn(Tat),G8=h.memo(({modelConfig:e})=>{const{t}=T(),[n,{isLoading:s}]=y_e(),{isOpen:i,onOpen:o,onClose:r}=jo(),l=h.useCallback(()=>{if(!e||s)return;const c=`CONVERTING_MODEL_${e.key}`;pe({id:c,title:`${t("modelManager.convertingModelBegin")}: ${e.name}`,status:"info"}),n(e.key).unwrap().then(()=>{pe({id:c,title:`${t("modelManager.modelConverted")}: ${e.name}`,status:"success"})}).catch(()=>{pe({id:c,title:`${t("modelManager.modelConversionFailed")}: ${e.name}`,status:"error"})})},[e,s,t,n]);return a.jsxs(a.Fragment,{children:[a.jsxs(he,{variant:"outline",onClick:o,size:"sm","aria-label":t("modelManager.convertToDiffusers"),className:" modal-close-btn",isLoading:s,flexShrink:0,children:[" ",t("modelManager.convert")]}),a.jsx(Ko,{title:`${t("modelManager.convert")} ${e.name}`,acceptCallback:l,acceptButtonText:`${t("modelManager.convert")}`,isOpen:i,onClose:r,useInert:!1,children:a.jsxs(A,{flexDirection:"column",rowGap:4,children:[a.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText1")}),a.jsxs(Li,{children:[a.jsx(rn,{children:a.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText2")})}),a.jsx(rn,{children:a.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText3")})}),a.jsx(rn,{children:a.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText4")})}),a.jsx(rn,{children:a.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText5")})})]}),a.jsx(vt,{}),a.jsx(q,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText6")})]})})]})});G8.displayName="ModelConvertButton";const H8=h.memo(()=>{const{t:e}=T(),t=Q(),n=h.useCallback(()=>{t(tP("edit"))},[t]);return a.jsx(he,{size:"sm",leftIcon:a.jsx(Im,{}),colorScheme:"invokeYellow",onClick:n,flexShrink:0,children:e("modelManager.edit")})});H8.displayName="ModelEditButton";const pA={justifyContent:"space-between",alignItems:"center",gap:3,"&:not(:last-of-type)":{borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:"border"},p:3},Xpe=h.memo(({modelConfig:e,isEditing:t})=>{const{t:n}=T(),s=!t&&e.format==="checkpoint"&&e.type==="main";return a.jsxs(A,{flexDirection:"column",borderWidth:"1px",borderRadius:"base",children:[s&&a.jsxs(A,{sx:pA,children:[a.jsx(Pt,{size:"sm",color:"base.100",children:n("modelManager.convertToDiffusers")}),a.jsx(A,{py:1,children:a.jsx(G8,{modelConfig:e})})]}),!t&&a.jsxs(A,{sx:pA,children:[a.jsx(Pt,{size:"sm",color:"base.100",children:n("modelManager.edit")}),a.jsx(A,{py:1,children:a.jsx(H8,{})})]}),a.jsxs(A,{sx:pA,children:[a.jsx(Pt,{size:"sm",color:"error.200",children:n("modelManager.deleteModel")}),a.jsx(A,{py:1,children:a.jsx(jk,{modelConfig:e})})]})]})});Xpe.displayName="ModelFooter";const Mat={validate:e=>e&&e.trim().length>3||"Must be at least 3 characters"},Ype=h.memo(({modelConfig:e})=>{const{t}=T(),[n,{isLoading:s}]=dm(),i=Q(),o=Om({defaultValues:e,mode:"onChange"}),r=h.useCallback(c=>{const d={key:e.key,body:c};n(d).unwrap().then(u=>{o.reset(u,{keepDefaultValues:!0}),i(tP("view")),pe({id:"MODEL_UPDATED",title:t("modelManager.modelUpdated"),status:"success"})}).catch(u=>{o.reset(),pe({id:"MODEL_UPDATE_FAILED",title:t("modelManager.modelUpdateFailed"),status:"error"})})},[i,e.key,o,t,n]),l=h.useCallback(()=>{i(tP("view"))},[i]);return a.jsxs(A,{flexDir:"column",gap:4,children:[a.jsxs($8,{modelConfig:e,children:[a.jsx(he,{flexShrink:0,size:"sm",onClick:l,leftIcon:a.jsx(fn,{}),children:t("common.cancel")}),a.jsx(he,{flexShrink:0,size:"sm",colorScheme:"invokeYellow",leftIcon:a.jsx(Yc,{}),onClick:o.handleSubmit(r),isLoading:s,isDisabled:!!Object.keys(o.formState.errors).length,children:t("common.save")})]}),a.jsx(A,{flexDir:"column",h:"full",children:a.jsxs("form",{children:[a.jsx(A,{w:"full",justifyContent:"space-between",gap:4,alignItems:"center",children:a.jsxs(te,{flexDir:"column",alignItems:"flex-start",gap:1,isInvalid:!!o.formState.errors.name,children:[a.jsx(ne,{children:t("modelManager.modelName")}),a.jsx(Nt,{...o.register("name",Mat),size:"md"}),o.formState.errors.name?.message&&a.jsx(zh,{children:o.formState.errors.name?.message})]})}),a.jsxs(A,{flexDir:"column",gap:3,mt:"4",children:[a.jsx(A,{gap:"4",alignItems:"center",children:a.jsxs(te,{flexDir:"column",alignItems:"flex-start",gap:1,children:[a.jsx(ne,{children:t("modelManager.description")}),a.jsx(no,{...o.register("description"),minH:32})]})}),a.jsx(Pt,{as:"h3",fontSize:"md",mt:"4",children:t("modelManager.modelSettings")}),a.jsx(q,{variant:"subtext",color:"warning.300",children:t("modelManager.modelSettingsWarning")}),a.jsxs(cm,{columns:2,gap:4,children:[a.jsxs(te,{flexDir:"column",alignItems:"flex-start",gap:1,children:[a.jsx(ne,{children:t("modelManager.modelType")}),a.jsx(Eat,{control:o.control})]}),a.jsxs(te,{flexDir:"column",alignItems:"flex-start",gap:1,children:[a.jsx(ne,{children:t("modelManager.modelFormat")}),a.jsx(Iat,{control:o.control})]}),a.jsxs(te,{flexDir:"column",alignItems:"flex-start",gap:1,children:[a.jsx(ne,{children:t("modelManager.baseModel")}),a.jsx(Sat,{control:o.control})]}),a.jsxs(te,{flexDir:"column",alignItems:"flex-start",gap:1,children:[a.jsx(ne,{children:t("modelManager.variant")}),a.jsx(Pat,{control:o.control})]}),a.jsxs(te,{flexDir:"column",alignItems:"flex-start",gap:1,children:[a.jsx(ne,{children:t("modelManager.pathToConfig")}),a.jsx(Nt,{...o.register("config_path")})]}),a.jsxs(te,{flexDir:"column",alignItems:"flex-start",gap:1,children:[a.jsx(ne,{children:t("modelManager.predictionType")}),a.jsx(Dat,{control:o.control})]}),a.jsxs(te,{flexDir:"column",alignItems:"flex-start",gap:1,children:[a.jsx(ne,{children:t("modelManager.upcastAttention")}),a.jsx(us,{...o.register("upcast_attention")})]})]})]})]})}),a.jsx(Xpe,{modelConfig:e,isEditing:!0})]})});Ype.displayName="ModelEdit";const Lat=e=>h.useMemo(()=>({preprocessor:{isEnabled:!st(e?.default_settings?.preprocessor),value:e?.default_settings?.preprocessor||"none"}}),[e?.default_settings]),gr=UM(e=>{const{field:t}=si(e),n=h.useMemo(()=>!!t.value.isEnabled,[t.value]),s=h.useCallback(i=>{const o={...t.value,isEnabled:i.target.checked};t.onChange(o)},[t]);return a.jsx(mt,{size:"sm",isChecked:n,onChange:s})});gr.displayName="SettingToggle";const B$=[{label:"Canny",value:"canny_image_processor"},{label:"MLSD",value:"mlsd_image_processor"},{label:"Depth Anything",value:"depth_anything_image_processor"},{label:"Normal BAE",value:"normalbae_image_processor"},{label:"Pidi",value:"pidi_image_processor"},{label:"Lineart",value:"lineart_image_processor"},{label:"Lineart Anime",value:"lineart_anime_image_processor"},{label:"HED",value:"hed_image_processor"},{label:"Content Shuffle",value:"content_shuffle_image_processor"},{label:"DW OpenPose",value:"dw_openpose_image_processor"},{label:"MediaPipe Face",value:"mediapipe_face_processor"},{label:"ZoeDepth",value:"zoe_depth_image_processor"},{label:"Color Map",value:"color_map_image_processor"},{label:"None",value:"none"}],Qpe=h.memo(e=>{const{t}=T(),{field:n}=si(e),s=h.useCallback(r=>{if(!r)return;const l={...n.value,value:r.value};n.onChange(l)},[n]),i=h.useMemo(()=>B$.find(r=>r.value===n.value.value),[n]),o=h.useMemo(()=>!n.value.isEnabled,[n.value]);return a.jsxs(te,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"controlNetProcessor",children:a.jsx(ne,{children:t("controlLayers.filter.filter")})}),a.jsx(gr,{control:e.control,name:"preprocessor"})]}),a.jsx(pt,{isDisabled:o,value:i,options:B$,onChange:s})]})});Qpe.displayName="DefaultPreprocessor";const Jpe=h.memo(({modelConfig:e})=>{const{t}=T(),n=Lat(e),[s,{isLoading:i}]=dm(),{handleSubmit:o,control:r,formState:l,reset:c}=Om({defaultValues:n}),d=h.useCallback(u=>{const p={preprocessor:u.preprocessor.isEnabled?u.preprocessor.value:null};s({key:e.key,body:{default_settings:p}}).unwrap().then(m=>{pe({id:"DEFAULT_SETTINGS_SAVED",title:t("modelManager.defaultSettingsSaved"),status:"success"}),c(u)}).catch(m=>{m&&pe({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${m.data.detail} `,status:"error"})})},[s,e.key,t,c]);return a.jsxs(a.Fragment,{children:[a.jsxs(A,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[a.jsx(Pt,{fontSize:"md",children:t("modelManager.defaultSettings")}),a.jsx(he,{size:"sm",leftIcon:a.jsx(Yc,{}),colorScheme:"invokeYellow",isDisabled:!l.isDirty,onClick:o(d),isLoading:i,children:t("common.save")})]}),a.jsx(cm,{columns:2,gap:8,children:a.jsx(Qpe,{control:r,name:"preprocessor"})})]})});Jpe.displayName="ControlAdapterModelDefaultSettings";const Rat=e=>h.useMemo(()=>({weight:{isEnabled:!st(e?.default_settings?.weight),value:e?.default_settings?.weight??Ks.initial}}),[e?.default_settings]),Oat=[-1,0,1,2],efe=h.memo(e=>{const{field:t}=si(e),{t:n}=T(),s=h.useCallback(r=>{const l={...t.value,value:r};t.onChange(l)},[t]),i=h.useMemo(()=>t.value.value,[t.value]),o=h.useMemo(()=>!t.value.isEnabled,[t.value]);return a.jsxs(te,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"loraWeight",children:a.jsx(ne,{children:n("lora.weight")})}),a.jsx(gr,{control:e.control,name:"weight"})]}),a.jsxs(A,{w:"full",gap:4,children:[a.jsx(it,{value:i,min:Ks.sliderMin,max:Ks.sliderMax,step:Ks.coarseStep,fineStep:Ks.fineStep,onChange:s,marks:Oat,isDisabled:o}),a.jsx(Pe,{value:i,min:Ks.numberInputMin,max:Ks.numberInputMax,step:Ks.coarseStep,fineStep:Ks.fineStep,onChange:s,isDisabled:o})]})]})});efe.displayName="DefaultWeight";const tfe=h.memo(({modelConfig:e})=>{const{t}=T(),n=Rat(e),[s,{isLoading:i}]=dm(),{handleSubmit:o,control:r,formState:l,reset:c}=Om({defaultValues:n}),d=h.useCallback(u=>{const p={weight:u.weight.isEnabled?u.weight.value:null};s({key:e.key,body:{default_settings:p}}).unwrap().then(m=>{pe({id:"DEFAULT_SETTINGS_SAVED",title:t("modelManager.defaultSettingsSaved"),status:"success"}),c(u)}).catch(m=>{m&&pe({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${m.data.detail} `,status:"error"})})},[s,e.key,t,c]);return a.jsxs(a.Fragment,{children:[a.jsxs(A,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[a.jsx(Pt,{fontSize:"md",children:t("modelManager.defaultSettings")}),a.jsx(he,{size:"sm",leftIcon:a.jsx(Yc,{}),colorScheme:"invokeYellow",isDisabled:!l.isDirty,onClick:o(d),isLoading:i,children:t("common.save")})]}),a.jsx(cm,{columns:2,gap:8,children:a.jsx(efe,{control:r,name:"weight"})})]})});tfe.displayName="LoRAModelDefaultSettings";const vD=h.memo(({modelConfig:e})=>{const{t}=T(),[n,s]=h.useState(""),[i,{isLoading:o}]=dm(),r=h.useCallback(f=>{s(f.target.value)},[]),l=h.useMemo(()=>e?.trigger_phrases||[],[e]),c=h.useMemo(()=>{const f=[];return n.length&&l.includes(n)&&f.push("Phrase is already in list"),f},[n,l]),d=h.useCallback(async()=>{!n.length||l.includes(n)||(s(""),await i({key:e.key,body:{trigger_phrases:[...l,n]}}).unwrap())},[n,l,i,e.key]),u=h.useCallback(async f=>{const g=l.filter(v=>v!==f);await i({key:e.key,body:{trigger_phrases:g}}).unwrap()},[l,i,e]),p=h.useCallback(f=>{f.preventDefault(),d()},[d]),m=l.length>0;return a.jsxs(A,{flexDir:"column",w:"full",gap:"5",children:[a.jsx("form",{onSubmit:p,children:a.jsxs(te,{w:"full",isInvalid:!!c.length,orientation:"vertical",children:[a.jsx(ne,{children:t("modelManager.triggerPhrases")}),a.jsxs(A,{flexDir:"column",w:"full",children:[a.jsxs(A,{gap:"3",alignItems:"center",w:"full",children:[a.jsx(Nt,{value:n,onChange:r,placeholder:t("modelManager.typePhraseHere")}),a.jsx(he,{leftIcon:a.jsx(Sn,{}),size:"sm",onClick:d,isDisabled:!n||!!c.length,isLoading:o,children:t("common.add")})]}),c.map(f=>a.jsx(zh,{children:f},f))]})]})}),m&&a.jsx(A,{gap:"4",flexWrap:"wrap",children:l.map((f,g)=>a.jsxs(r_,{size:"md",py:2,px:4,bg:"base.700",children:[a.jsx(jM,{children:f}),a.jsx(l_,{onClick:u.bind(null,f),isDisabled:o})]},g))})]})});vD.displayName="TriggerPhrases";const nfe=e=>!!(e.startsWith("/")||e.length>1&&e[1]===":"||e.startsWith("\\\\")||e.startsWith("//")),Nat=e=>h.useMemo(()=>({vae:{isEnabled:!st(e?.default_settings?.vae),value:e?.default_settings?.vae??"default"},vaePrecision:{isEnabled:!st(e?.default_settings?.vae_precision),value:e?.default_settings?.vae_precision??"fp32"},scheduler:{isEnabled:!st(e?.default_settings?.scheduler),value:e?.default_settings?.scheduler??"dpmpp_3m_k"},steps:{isEnabled:!st(e?.default_settings?.steps),value:e?.default_settings?.steps??30},cfgScale:{isEnabled:!st(e?.default_settings?.cfg_scale),value:e?.default_settings?.cfg_scale??7},cfgRescaleMultiplier:{isEnabled:!st(e?.default_settings?.cfg_rescale_multiplier),value:e?.default_settings?.cfg_rescale_multiplier??0},width:{isEnabled:!st(e?.default_settings?.width),value:e?.default_settings?.width??512},height:{isEnabled:!st(e?.default_settings?.height),value:e?.default_settings?.height??512},guidance:{isEnabled:!st(e?.default_settings?.guidance),value:e?.default_settings?.guidance??4}}),[e]),sfe=h.memo(({control:e,optimalDimension:t})=>{const{field:n}=si({control:e,name:"height"}),{t:s}=T(),i=h.useMemo(()=>[di.sliderMin,t,di.sliderMax],[t]),o=h.useCallback(c=>{const d={...n.value,value:c};n.onChange(d)},[n]),r=h.useMemo(()=>n.value.value,[n.value]),l=h.useMemo(()=>!n.value.isEnabled,[n.value]);return a.jsxs(te,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"paramHeight",children:a.jsx(ne,{children:s("parameters.height")})}),a.jsx(gr,{control:e,name:"height"})]}),a.jsxs(A,{w:"full",gap:4,children:[a.jsx(it,{value:r,min:di.sliderMin,max:di.sliderMax,step:di.coarseStep,fineStep:di.fineStep,onChange:o,marks:i,isDisabled:l}),a.jsx(Pe,{value:r,min:di.numberInputMin,max:di.numberInputMax,step:di.coarseStep,fineStep:di.fineStep,onChange:o,isDisabled:l})]})]})});sfe.displayName="DefaultHeight";const ife=h.memo(({control:e,optimalDimension:t})=>{const{field:n}=si({control:e,name:"width"}),{t:s}=T(),i=h.useMemo(()=>[ui.sliderMin,t,ui.sliderMax],[t]),o=h.useCallback(c=>{const d={...n.value,value:c};n.onChange(d)},[n]),r=h.useMemo(()=>n.value.value,[n.value]),l=h.useMemo(()=>!n.value.isEnabled,[n.value]);return a.jsxs(te,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"paramWidth",children:a.jsx(ne,{children:s("parameters.width")})}),a.jsx(gr,{control:e,name:"width"})]}),a.jsxs(A,{w:"full",gap:4,children:[a.jsx(it,{value:r,min:ui.sliderMin,max:ui.sliderMax,step:ui.coarseStep,fineStep:ui.fineStep,onChange:o,marks:i,isDisabled:l}),a.jsx(Pe,{value:r,min:ui.numberInputMin,max:ui.numberInputMax,step:ui.coarseStep,fineStep:ui.fineStep,onChange:o,isDisabled:l})]})]})});ife.displayName="DefaultWidth";const ofe=h.memo(e=>{const{field:t}=si(e),{t:n}=T(),s=h.useCallback(r=>{const l={...t.value,value:r};t.onChange(l)},[t]),i=h.useMemo(()=>t.value.value,[t.value]),o=h.useMemo(()=>!t.value.isEnabled,[t.value]);return a.jsxs(te,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"paramCFGRescaleMultiplier",children:a.jsx(ne,{children:n("parameters.cfgRescaleMultiplier")})}),a.jsx(gr,{control:e.control,name:"cfgRescaleMultiplier"})]}),a.jsxs(A,{w:"full",gap:4,children:[a.jsx(it,{value:i,min:ci.sliderMin,max:ci.sliderMax,step:ci.coarseStep,fineStep:ci.fineStep,onChange:s,isDisabled:o,marks:!0}),a.jsx(Pe,{value:i,min:ci.numberInputMin,max:ci.numberInputMax,step:ci.coarseStep,fineStep:ci.fineStep,onChange:s,isDisabled:o})]})]})});ofe.displayName="DefaultCfgRescaleMultiplier";const afe=h.memo(e=>{const{field:t}=si(e),{t:n}=T(),s=h.useCallback(r=>{const l={...t.value,value:r};t.onChange(l)},[t]),i=h.useMemo(()=>t.value.value,[t.value]),o=h.useMemo(()=>!t.value.isEnabled,[t.value]);return a.jsxs(te,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"paramCFGScale",children:a.jsx(ne,{children:n("parameters.cfgScale")})}),a.jsx(gr,{control:e.control,name:"cfgScale"})]}),a.jsxs(A,{w:"full",gap:4,children:[a.jsx(it,{value:i,min:Es.sliderMin,max:Es.sliderMax,step:Es.coarseStep,fineStep:Es.fineStep,onChange:s,marks:hde,isDisabled:o}),a.jsx(Pe,{value:i,min:Es.numberInputMin,max:Es.numberInputMax,step:Es.coarseStep,fineStep:Es.fineStep,onChange:s,isDisabled:o})]})]})});afe.displayName="DefaultCfgScale";const rfe=h.memo(e=>{const{field:t}=si(e),{t:n}=T(),s=h.useCallback(r=>{const l={...t.value,value:r};t.onChange(l)},[t]),i=h.useMemo(()=>t.value.value,[t.value]),o=h.useMemo(()=>!t.value.isEnabled,[t.value]);return a.jsxs(te,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"paramGuidance",children:a.jsx(ne,{children:n("parameters.guidance")})}),a.jsx(gr,{control:e.control,name:"guidance"})]}),a.jsxs(A,{w:"full",gap:4,children:[a.jsx(it,{value:i,min:ps.sliderMin,max:ps.sliderMax,step:ps.coarseStep,fineStep:ps.fineStep,onChange:s,marks:pde,isDisabled:o}),a.jsx(Pe,{value:i,min:ps.numberInputMin,max:ps.numberInputMax,step:ps.coarseStep,fineStep:ps.fineStep,onChange:s,isDisabled:o})]})]})});rfe.displayName="DefaultGuidance";const lfe=h.memo(e=>{const{t}=T(),{field:n}=si(e),s=h.useCallback(r=>{if(!Uy(r?.value))return;const l={...n.value,value:r.value};n.onChange(l)},[n]),i=h.useMemo(()=>Hl.find(r=>r.value===n.value.value),[n]),o=h.useMemo(()=>!n.value.isEnabled,[n.value]);return a.jsxs(te,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"paramScheduler",children:a.jsx(ne,{children:t("parameters.scheduler")})}),a.jsx(gr,{control:e.control,name:"scheduler"})]}),a.jsx(pt,{isDisabled:o,value:i,options:Hl,onChange:s})]})});lfe.displayName="DefaultScheduler";const cfe=h.memo(e=>{const{field:t}=si(e),{t:n}=T(),s=h.useCallback(r=>{const l={...t.value,value:r};t.onChange(l)},[t]),i=h.useMemo(()=>t.value.value,[t.value]),o=h.useMemo(()=>!t.value.isEnabled,[t.value]);return a.jsxs(te,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"paramSteps",children:a.jsx(ne,{children:n("parameters.steps")})}),a.jsx(gr,{control:e.control,name:"steps"})]}),a.jsxs(A,{w:"full",gap:4,children:[a.jsx(it,{value:i,min:As.sliderMin,max:As.sliderMax,step:As.coarseStep,fineStep:As.fineStep,onChange:s,marks:mde,isDisabled:o}),a.jsx(Pe,{value:i,min:As.numberInputMin,max:As.numberInputMax,step:As.coarseStep,fineStep:As.fineStep,onChange:s,isDisabled:o})]})]})});cfe.displayName="DefaultSteps";const dfe=h.memo(e=>{const{t}=T(),{field:n}=si(e),s=M(Zy),{data:i}=om(s??Ri),[o]=CU(),r=h.useMemo(()=>{const u=o.filter(m=>m.base===i?.base).map(m=>({label:m.name,value:m.key}));return[{label:"Default VAE",value:"default"},...u]},[i?.base,o]),l=h.useCallback(u=>{const p=u?.value?u.value:"default",m={...n.value,value:p};n.onChange(m)},[n]),c=h.useMemo(()=>r.find(u=>u.value===n.value.value),[r,n.value]),d=h.useMemo(()=>!n.value.isEnabled,[n.value]);return a.jsxs(te,{flexDir:"column",gap:2,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"paramVAE",children:a.jsx(ne,{children:t("modelManager.vae")})}),a.jsx(gr,{control:e.control,name:"vae"})]}),a.jsx(pt,{isDisabled:d,value:c,options:r,onChange:l})]})});dfe.displayName="DefaultVae";const z$=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],ufe=h.memo(e=>{const{t}=T(),{field:n}=si(e),s=h.useCallback(r=>{if(!_U(r?.value))return;const l={...n.value,value:r.value};n.onChange(l)},[n]),i=h.useMemo(()=>z$.find(r=>r.value===n.value.value),[n]),o=h.useMemo(()=>!n.value.isEnabled,[n.value]);return a.jsxs(te,{flexDir:"column",gap:1,alignItems:"flex-start",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",children:[a.jsx(Ue,{feature:"paramVAEPrecision",children:a.jsx(ne,{children:t("modelManager.vaePrecision")})}),a.jsx(gr,{control:e.control,name:"vaePrecision"})]}),a.jsx(pt,{isDisabled:o,value:i,options:z$,onChange:s})]})});ufe.displayName="DefaultVaePrecision";const hfe=h.memo(({modelConfig:e})=>{const t=M(Zy),{t:n}=T(),s=h.useMemo(()=>e.base==="flux",[e]),i=Nat(e),o=h.useMemo(()=>{const f=e?.base;return tM(f??null)},[e]),[r,{isLoading:l}]=dm(),{handleSubmit:c,control:d,formState:u,reset:p}=Om({defaultValues:i}),m=h.useCallback(f=>{if(!t)return;const g={vae:f.vae.isEnabled?f.vae.value:null,vae_precision:f.vaePrecision.isEnabled?f.vaePrecision.value:null,cfg_scale:f.cfgScale.isEnabled?f.cfgScale.value:null,cfg_rescale_multiplier:f.cfgRescaleMultiplier.isEnabled?f.cfgRescaleMultiplier.value:null,steps:f.steps.isEnabled?f.steps.value:null,scheduler:f.scheduler.isEnabled?f.scheduler.value:null,width:f.width.isEnabled?f.width.value:null,height:f.height.isEnabled?f.height.value:null,guidance:f.guidance.isEnabled?f.guidance.value:null};r({key:t,body:{default_settings:g}}).unwrap().then(v=>{pe({id:"DEFAULT_SETTINGS_SAVED",title:n("modelManager.defaultSettingsSaved"),status:"success"}),p(f)}).catch(v=>{v&&pe({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${v.data.detail} `,status:"error"})})},[t,p,r,n]);return a.jsxs(a.Fragment,{children:[a.jsxs(A,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[a.jsx(Pt,{fontSize:"md",children:n("modelManager.defaultSettings")}),a.jsx(he,{size:"sm",leftIcon:a.jsx(Yc,{}),colorScheme:"invokeYellow",isDisabled:!u.isDirty,onClick:c(m),isLoading:l,children:n("common.save")})]}),a.jsxs(cm,{columns:2,gap:8,children:[a.jsx(dfe,{control:d,name:"vae"}),!s&&a.jsx(ufe,{control:d,name:"vaePrecision"}),!s&&a.jsx(lfe,{control:d,name:"scheduler"}),a.jsx(cfe,{control:d,name:"steps"}),s&&a.jsx(rfe,{control:d,name:"guidance"}),!s&&a.jsx(afe,{control:d,name:"cfgScale"}),!s&&a.jsx(ofe,{control:d,name:"cfgRescaleMultiplier"}),a.jsx(ife,{control:d,optimalDimension:o}),a.jsx(sfe,{control:d,optimalDimension:o})]})]})});hfe.displayName="MainModelDefaultSettings";const wr=h.memo(({label:e,value:t})=>a.jsxs(te,{flexDir:"column",alignItems:"flex-start",gap:0,children:[a.jsx(ne,{children:e}),a.jsx(q,{fontSize:"md",noOfLines:1,wordBreak:"break-all",children:t||"-"})]}));wr.displayName="ModelAttrView";const pfe=h.memo(({modelConfig:e})=>{const{t}=T(),[n,{isLoading:s}]=b_e(),i=h.useCallback(()=>{n({key:e.key}).unwrap().then(({type:o})=>{o==="unknown"&&pe({id:"MODEL_REIDENTIFY_UNKNOWN",title:t("modelManager.reidentifyUnknown"),status:"warning"}),pe({id:"MODEL_REIDENTIFY_SUCCESS",title:t("modelManager.reidentifySuccess"),status:"success"})}).catch(o=>{pe({id:"MODEL_REIDENTIFY_ERROR",title:t("modelManager.reidentifyError"),status:"error"})})},[e.key,n,t]);return a.jsx(he,{onClick:i,size:"sm","aria-label":t("modelManager.reidentifyTooltip"),tooltip:t("modelManager.reidentifyTooltip"),isLoading:s,flexShrink:0,leftIcon:a.jsx(Em,{}),children:t("modelManager.reidentify")})});pfe.displayName="ModelReidentifyButton";const ffe=h.memo(({modelConfig:e})=>{const{t}=T(),{isOpen:n,onOpen:s,onClose:i}=jo(),[o,{isLoading:r}]=dm(),[l,c]=h.useState(e.path),d=h.useCallback(()=>{c(e.path),s()},[e.path,s]),u=h.useCallback(v=>{c(v.target.value)},[]),p=h.useMemo(()=>nfe(l.trim()),[l]),m=h.useCallback(()=>{if(!l.trim()||l===e.path||!p){i();return}o({key:e.key,body:{path:l.trim()}}).unwrap().then(()=>{pe({id:"MODEL_PATH_UPDATED",title:t("modelManager.pathUpdated"),status:"success"}),i()}).catch(()=>{pe({id:"MODEL_PATH_UPDATE_FAILED",title:t("modelManager.pathUpdateFailed"),status:"error"})})},[l,e.path,e.key,o,i,t,p]),f=l.trim()!==e.path,g=f&&!p;return a.jsxs(a.Fragment,{children:[a.jsx(he,{onClick:d,size:"sm","aria-label":t("modelManager.updatePathTooltip"),tooltip:t("modelManager.updatePathTooltip"),flexShrink:0,leftIcon:a.jsx(bX,{}),children:t("modelManager.updatePath")}),a.jsxs(Zo,{isOpen:n,onClose:i,isCentered:!0,size:"lg",useInert:!1,children:[a.jsx(ro,{}),a.jsxs(Xo,{children:[a.jsx(lo,{children:t("modelManager.updatePath")}),a.jsx(Yr,{}),a.jsx(vi,{children:a.jsxs(A,{flexDirection:"column",gap:4,children:[a.jsx(q,{fontSize:"sm",color:"base.400",children:t("modelManager.updatePathDescription")}),a.jsxs(te,{children:[a.jsx(ne,{children:t("modelManager.currentPath")}),a.jsx(q,{fontSize:"sm",color:"base.300",wordBreak:"break-all",children:e.path})]}),a.jsxs(te,{isInvalid:g,children:[a.jsx(ne,{children:t("modelManager.newPath")}),a.jsx(Nt,{value:l,onChange:u,placeholder:t("modelManager.newPathPlaceholder")}),g&&a.jsx(zh,{children:t("modelManager.invalidPathFormat")})]})]})}),a.jsx(Qr,{children:a.jsxs(A,{gap:2,children:[a.jsx(he,{variant:"ghost",onClick:i,children:t("common.cancel")}),a.jsx(he,{colorScheme:"invokeYellow",onClick:m,isLoading:r,isDisabled:!f||g,children:t("common.save")})]})})]})]})]})});ffe.displayName="ModelUpdatePathButton";const Fat=(e,t)=>e.base==="any"||t.base==="any"?!0:e.base===t.base,mfe=e=>{switch(e){case"main":case"checkpoint":return"orange";case"lora":case"lycoris":return"purple";case"embedding":case"embedding_file":return"teal";case"vae":return"blue";case"controlnet":case"ip_adapter":case"t2i_adapter":return"cyan";case"onnx":case"bnb_quantized_int8b":case"bnb_quantized_nf4b":case"gguf_quantized":return"pink";case"t5_encoder":case"clip_embed":case"clip_vision":case"siglip":return"green";default:return"base"}},V$=e=>e.split("/")[1]?.trim().toLowerCase()||"",gfe=h.memo(({modelConfig:e})=>{const{t}=T(),[n,{isLoading:s}]=_He(),[i,{isLoading:o}]=SHe(),r=s||o,[l,c]=h.useState(""),{data:d}=Fh(),{data:u=[]}=wHe(e.key),p=h.useMemo(()=>new Set(u),[u]),m=h.useMemo(()=>["main","lora"],[]),f=h.useMemo(()=>new Set(["main|main","vae|vae","controlnet|controlnet","clip_vision|clip_vision","control_lora|control_lora","clip_embed|clip_embed","spandrel_image_to_image|spandrel_image_to_image","siglip|siglip","flux_redux|flux_redux"]),[]),g=h.useCallback((j,P)=>{const D=m.indexOf(j),O=m.indexOf(P);return(D===-1?99:D)-(O===-1?99:O)},[m]),v=h.useMemo(()=>{if(!d)return[];const j=(P,D)=>f.has(`${P}|${D}`)||f.has(`${D}|${P}`);return Object.values(d.entities).filter(P=>!!P&&P.key!==e.key&&!p.has(P.key)&&Fat(e,P)&&!j(e.type,P.type))},[d,e,p,f]),b=h.useMemo(()=>{const j=[];return l&&p.has(l)&&j.push("Item already promoted"),j},[l,p]),C=h.useCallback(async()=>{const j=v.find(P=>P.key===l);j&&(c(""),await n({model_key_1:e.key,model_key_2:j.key}))},[e,v,n,l]),{options:y,onChange:x,placeholder:w,noOptionsMessage:_}=Jh({modelConfigs:v,selectedModel:null,onChange:j=>{j&&c(j.key)},groupByType:!0}),S=h.useMemo(()=>y.flatMap(j=>j.options).find(j=>j.value===l)??null,[l,y]),I=h.useMemo(()=>[...y].sort((j,P)=>g(V$(j.label??""),V$(P.label??""))),[y,g]),k=h.useMemo(()=>{if(!d)return[];const j=[...u].map(D=>d.entities[D]).filter(D=>!!D);j.sort((D,O)=>g(D.type,O.type)||D.type.localeCompare(O.type)||D.name.localeCompare(O.name));const P=new Map;for(const D of j)P.has(D.type)||P.set(D.type,{type:D.type,label:D.type.replace(/_/g," ").replace(/\b\w/g,O=>O.toUpperCase()),color:mfe(D.type),models:[]}),P.get(D.type).models.push(D);return Array.from(P.values())},[d,u,g]),E=h.useMemo(()=>{const j=new Map;if(!d)return j;for(const P of k)for(const D of P.models)j.set(D.key,()=>{d.entities[D.key]&&i({model_key_1:e.key,model_key_2:D.key}).unwrap()});return j},[k,e.key,d,i]);return a.jsxs(A,{direction:"column",gap:"5",w:"full",children:[a.jsx(ne,{children:t("modelManager.relatedModels")}),a.jsxs(te,{isInvalid:b.length>0,children:[a.jsxs(A,{gap:"3",alignItems:"center",w:"full",children:[a.jsx(pt,{value:S,placeholder:w,options:I,onChange:x,noOptionsMessage:_}),a.jsx(he,{leftIcon:a.jsx(Sn,{}),size:"sm",onClick:C,isDisabled:!l||b.length>0,isLoading:r,children:t("common.add")})]}),b.map(j=>a.jsx(zh,{children:j},j))]}),k.length>0&&a.jsx(ke,{children:a.jsx(A,{gap:"2",flexWrap:"wrap",children:k.map((j,P)=>{const D=P<k.length-1;return a.jsxs(ke,{mb:4,children:[a.jsx(zat,{group:j,isLoading:r,removeHandlers:E}),D&&a.jsx(vt,{my:4,opacity:.3})]},j.type)})})})]})}),Bat=({model:e,onRemove:t,isLoading:n})=>a.jsxs(r_,{py:2,px:4,bg:`${mfe(e.type)}.700`,children:[a.jsx(He,{label:`${e.type}: ${e.name}`,hasArrow:!0,children:a.jsx(jM,{maxWidth:"50px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:e.name})}),a.jsx(l_,{onClick:t,isDisabled:n})]}),zat=({group:e,isLoading:t,removeHandlers:n})=>a.jsx(A,{gap:"2",flexWrap:"wrap",alignItems:"center",children:e.models.map(s=>a.jsx(Bat,{model:s,onRemove:n.get(s.key),isLoading:t},s.key))});gfe.displayName="RelatedModels";const vfe=h.memo(({modelConfig:e})=>{const{t}=T(),n=h.useMemo(()=>nfe(e.path),[e.path]),s=h.useMemo(()=>e.type==="main"&&e.base!=="sdxl-refiner"||e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="control_lora"||e.type==="main"||e.type==="lora",[e.base,e.type]);return a.jsxs(A,{flexDir:"column",gap:4,h:"full",children:[a.jsxs($8,{modelConfig:e,children:[n&&a.jsx(ffe,{modelConfig:e}),a.jsx(pfe,{modelConfig:e}),e.format==="checkpoint"&&e.type==="main"&&a.jsx(G8,{modelConfig:e}),a.jsx(H8,{}),a.jsx(jk,{modelConfig:e})]}),a.jsx(vt,{}),a.jsxs(A,{flexDir:"column",gap:4,children:[a.jsx(ke,{children:a.jsxs(cm,{columns:2,gap:4,children:[a.jsx(wr,{label:t("modelManager.baseModel"),value:e.base}),a.jsx(wr,{label:t("modelManager.modelType"),value:e.type}),a.jsx(wr,{label:t("modelManager.modelFormat"),value:e.format}),a.jsx(wr,{label:t("modelManager.path"),value:e.path}),a.jsx(wr,{label:t("modelManager.fileSize"),value:g8(e.file_size)}),e.type==="main"&&"variant"in e&&a.jsx(wr,{label:t("modelManager.variant"),value:e.variant}),e.type==="main"&&e.format==="diffusers"&&e.repo_variant&&a.jsx(wr,{label:t("modelManager.repoVariant"),value:e.repo_variant}),e.type==="main"&&e.format==="checkpoint"&&a.jsx(wr,{label:t("modelManager.pathToConfig"),value:e.config_path}),e.type==="main"&&e.format==="checkpoint"&&"prediction_type"in e&&a.jsx(wr,{label:t("modelManager.predictionType"),value:e.prediction_type}),e.type==="ip_adapter"&&e.format==="invokeai"&&a.jsx(wr,{label:t("modelManager.imageEncoderModelId"),value:e.image_encoder_model_id})]})}),s&&a.jsxs(a.Fragment,{children:[a.jsx(vt,{}),a.jsxs(ke,{children:[e.type==="main"&&e.base!=="sdxl-refiner"&&a.jsx(hfe,{modelConfig:e}),(e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="control_lora")&&a.jsx(Jpe,{modelConfig:e}),e.type==="lora"&&a.jsxs(a.Fragment,{children:[a.jsx(tfe,{modelConfig:e}),a.jsx(vD,{modelConfig:e})]}),e.type==="main"&&a.jsx(vD,{modelConfig:e})]})]}),a.jsx(vt,{}),a.jsx(ke,{overflowY:"auto",children:a.jsx(gfe,{modelConfig:e})})]})]})});vfe.displayName="ModelView";const yfe=h.memo(()=>{const{t:e}=T(),t=M(x_e),n=M(Zy),{data:s,isLoading:i}=Fh(),o=h.useMemo(()=>{if(!s||n===null)return null;const r=$l.selectById(s,n);return r||null},[s,n]);return i?a.jsx(m1,{label:e("common.loading")}):o?t==="view"?a.jsx(vfe,{modelConfig:o}):a.jsx(Ype,{modelConfig:o}):a.jsx(On,{label:e("common.somethingWentWrong"),icon:V4})});yfe.displayName="Model";const Vat={layerStyle:"first",p:4,borderRadius:"base",w:{base:"50%",lg:"75%","2xl":"85%"},h:"full",minWidth:"300px",overflow:"auto"},bfe=h.memo(()=>{const e=M(Zy);return a.jsx(ke,{sx:Vat,children:e?a.jsx(yfe,{},e):a.jsx(Zpe,{})})});bfe.displayName="ModelPane";const $at=()=>a.jsxs(A,{layerStyle:"body",w:"full",h:"full",gap:"2",p:2,children:[a.jsx(Ipe,{}),a.jsx(bfe,{})]}),Gat=h.memo($at),Hat={[CP]:Gat},Wat=(e,t)=>{Ne.registerContainer(e,"root",t,()=>{t.addPanel({id:CP,component:CP,priority:Hn.High})})},xfe=h.memo(()=>{const e=h.useCallback(({api:t})=>{Wat("models",t)},[]);return h.useEffect(()=>()=>{Ne.unregisterTab("models")},[]),a.jsx(Zm,{tab:"models",children:a.jsx(Eo,{className:"dockview-theme-invoke",components:Hat,onReady:e,orientation:Ke.VERTICAL})})});xfe.displayName="ModelsTabAutoLayout";const Uat=()=>{const{t:e}=T(),{data:t}=Xy(),n=le(ks),[s,{isLoading:i}]=C_e({fixedCacheKey:"clearInvocationCache"});return{trigger:h.useCallback(async()=>{try{await s().unwrap(),pe({id:"INVOCATION_CACHE_CLEAR_SUCCEEDED",title:e("invocationCache.clearSucceeded"),status:"success"})}catch{pe({id:"INVOCATION_CACHE_CLEAR_FAILED",title:e("invocationCache.clearFailed"),status:"error"})}},[s,e]),isLoading:i,isDisabled:!n||!t?.size}},qat=()=>{const{t:e}=T(),t=Uat();return a.jsx(he,{onClick:t.trigger,isDisabled:t.isDisabled,isLoading:t.isLoading,children:e("invocationCache.clear")})},Kat=h.memo(qat),Zat=({children:e,...t})=>a.jsx(w_e,{alignItems:"center",justifyContent:"center",w:"full",h:"full",layerStyle:"first",borderRadius:"base",py:2,px:3,gap:6,flexWrap:"nowrap",...t,children:e}),Cfe=h.memo(Zat),Xat={'&[aria-disabled="true"]':{color:"base.500"}},Yat=({label:e,value:t,isDisabled:n=!1,...s})=>a.jsxs(__e,{flexGrow:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap","aria-disabled":n,sx:Xat,...s,children:[a.jsx(S_e,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:e}),a.jsx(k_e,{children:t})]}),wl=h.memo(Yat),Qat=()=>{const{t:e}=T(),{data:t}=Xy(),n=le(ks),[s,{isLoading:i}]=I_e({fixedCacheKey:"disableInvocationCache"});return{trigger:h.useCallback(async()=>{try{await s().unwrap(),pe({id:"INVOCATION_CACHE_DISABLE_SUCCEEDED",title:e("invocationCache.disableSucceeded"),status:"success"})}catch{pe({id:"INVOCATION_CACHE_DISABLE_FAILED",title:e("invocationCache.disableFailed"),status:"error"})}},[s,e]),isLoading:i,cacheStatus:t,isDisabled:!t?.enabled||!n||t?.max_size===0}},Jat=()=>{const{t:e}=T(),{data:t}=Xy(),n=le(ks),[s,{isLoading:i}]=j_e({fixedCacheKey:"enableInvocationCache"});return{trigger:h.useCallback(async()=>{try{await s().unwrap(),pe({id:"INVOCATION_CACHE_ENABLE_SUCCEEDED",title:e("invocationCache.enableSucceeded"),status:"success"})}catch{pe({id:"INVOCATION_CACHE_ENABLE_FAILED",title:e("invocationCache.enableFailed"),status:"error"})}},[s,e]),isLoading:i,isDisabled:t?.enabled||!n||t?.max_size===0}},ert=()=>{const{t:e}=T(),{data:t}=Xy(),n=Jat(),s=Qat();return t?.enabled?a.jsx(he,{onClick:s.trigger,isDisabled:s.isDisabled,isLoading:s.isLoading,children:e("invocationCache.disable")}):a.jsx(he,{onClick:n.trigger,isDisabled:n.isDisabled,isLoading:n.isLoading,children:e("invocationCache.enable")})},trt=h.memo(ert),nrt=()=>{const{t:e}=T(),{data:t}=Xy(void 0);return a.jsxs(Cfe,{children:[a.jsx(wl,{isDisabled:!t?.enabled,label:e("invocationCache.cacheSize"),value:t?.size??0}),a.jsx(wl,{isDisabled:!t?.enabled,label:e("invocationCache.hits"),value:t?.hits??0}),a.jsx(wl,{isDisabled:!t?.enabled,label:e("invocationCache.misses"),value:t?.misses??0}),a.jsx(wl,{isDisabled:!t?.enabled,label:e("invocationCache.maxCacheSize"),value:t?.max_size??0}),a.jsxs(zn,{w:24,orientation:"vertical",size:"sm",children:[a.jsx(Kat,{}),a.jsx(trt,{})]})]})},srt=h.memo(nrt),irt=(e,t,n)=>{const s=new Set,i=new Set(t);for(const o of n)for(let r=o.startIndex;r<=o.endIndex;r++){const l=e[r];l&&!i.has(l)&&s.add(l)}return Array.from(s)},ort=({itemIds:e,enabled:t})=>{const n=Ze(),[s]=E_e(),[i,o]=h.useState(null),[r,l]=h.useState([]),c=h.useCallback((p,m)=>{if(!t)return;const f=mi.util.selectCachedArgsForQuery(n.getState(),"getQueueItem"),g=irt(m,f,p);g.length!==0&&(s({item_ids:g}),l([]))},[t,s,n]),d=wY(c,500),u=h.useCallback(p=>{o(p),l(m=>[...m,p])},[]);return h.useEffect(()=>{const p=i?[...r,i]:r;d(p,e)},[e,i,r,d]),{onRangeChanged:u}},$$={pending:{colorScheme:"cyan",translationKey:"queue.pending"},in_progress:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},failed:{colorScheme:"red",translationKey:"queue.failed"},canceled:{colorScheme:"orange",translationKey:"queue.canceled"}},art=({status:e})=>{const{t}=T();return a.jsx(Bi,{colorScheme:$$[e].colorScheme,children:t($$[e].translationKey)})},rrt=h.memo(art),wfe=e=>{const{t}=T();return t(e==="canvas"?"queue.canvas":e==="gallery"?"queue.gallery":"queue.other")},_fe=e=>{const{t}=T();return t(e==="generation"?"queue.generation":e==="workflows"?"queue.workflows":e==="upscaling"?"queue.upscaling":"queue.other")},Sfe=()=>{const e=le(ks),[t,{isLoading:n}]=A_e(),{t:s}=T();return{trigger:h.useCallback(async o=>{try{if(!(await t([o]).unwrap()).retried_item_ids.includes(o))throw new Error("Failed to retry item");pe({id:"QUEUE_RETRY_SUCCEEDED",title:s("queue.retrySucceeded"),status:"success"})}catch{pe({id:"QUEUE_RETRY_FAILED",title:s("queue.retryFailed"),status:"error"})}},[s,t]),isLoading:n,isDisabled:!e}},kfe=(e,t)=>Number(((Date.parse(t)-Date.parse(e))/1e3).toFixed(2)),zo={number:"2rem",statusBadge:"5.7rem",time:"4rem",origin_destination:"7rem",batchId:"5rem",fieldValues:"auto",createdAt:"9.5rem",actions:"auto"},lrt=e=>{const{isCanceled:t}=P_e({batch_id:e},{selectFromResult:({data:n})=>n?{isCanceled:n?.in_progress===0&&n?.pending===0}:{isCanceled:!0}});return t},crt=()=>{const e=le(ks),[t,{isLoading:n}]=T_e({fixedCacheKey:"cancelByBatchIds"}),{t:s}=T();return{trigger:h.useCallback(async o=>{try{await t({batch_ids:[o]}).unwrap(),pe({id:"CANCEL_BATCH_SUCCEEDED",title:s("queue.cancelBatchSucceeded"),status:"success"})}catch{pe({id:"CANCEL_BATCH_FAILED",title:s("queue.cancelBatchFailed"),status:"error"})}},[s,t]),isLoading:n,isDisabled:!e}},drt=({queueItem:e})=>{const{session_id:t,batch_id:n,item_id:s,origin:i,destination:o}=e,{t:r}=T(),l=lrt(n),c=crt(),d=gk(),u=Sfe(),{data:p}=D_e(s),m=_fe(i),f=wfe(o),g=h.useMemo(()=>{if(!p)return r("common.loading");if(!p.completed_at||!p.started_at)return r(`queue.${p.status}`);const w=kfe(p.started_at,p.completed_at);return p.status==="completed"?`${r("queue.completedIn")} ${w}${w===1?"":"s"}`:`${w}s`},[p,r]),v=h.useMemo(()=>!!p&&["canceled","completed","failed"].includes(p.status),[p]),b=h.useMemo(()=>!!p&&["canceled","failed"].includes(p.status),[p]),C=h.useCallback(()=>{c.trigger(n)},[c,n]),y=h.useCallback(()=>{d.trigger(s)},[d,s]),x=h.useCallback(()=>{u.trigger(s)},[u,s]);return a.jsxs(A,{layerStyle:"third",flexDir:"column",p:2,pt:0,borderRadius:"base",gap:2,children:[a.jsxs(A,{layerStyle:"second",p:2,gap:2,justifyContent:"space-between",alignItems:"center",borderRadius:"base",h:20,children:[a.jsx(jp,{label:r("queue.status"),data:g}),a.jsx(jp,{label:r("queue.origin"),data:m}),a.jsx(jp,{label:r("queue.destination"),data:f}),a.jsx(jp,{label:r("queue.item"),data:s}),a.jsx(jp,{label:r("queue.batch"),data:n}),a.jsx(jp,{label:r("queue.session"),data:t}),a.jsxs(zn,{size:"xs",orientation:"vertical",children:[!b&&a.jsx(he,{onClick:y,isLoading:d.isLoading,isDisabled:d.isDisabled||p?v:!0,"aria-label":r("queue.cancelItem"),leftIcon:a.jsx(fn,{}),colorScheme:"error",children:r("queue.cancelItem")}),b&&a.jsx(he,{onClick:x,isLoading:u.isLoading,isDisabled:u.isDisabled||!p,"aria-label":r("queue.retryItem"),leftIcon:a.jsx(Gs,{}),colorScheme:"invokeBlue",children:r("queue.retryItem")}),a.jsx(he,{onClick:C,isLoading:c.isLoading,isDisabled:c.isDisabled||l,"aria-label":r("queue.cancelBatch"),leftIcon:a.jsx(fn,{}),colorScheme:"error",children:r("queue.cancelBatch")})]})]}),(p?.error_traceback||p?.error_message)&&a.jsxs(A,{layerStyle:"second",p:3,gap:1,justifyContent:"space-between",alignItems:"flex-start",borderRadius:"base",flexDir:"column",children:[a.jsx(Pt,{size:"sm",color:"error.400",children:r("common.error")}),a.jsx("pre",{children:p?.error_traceback||p?.error_message})]}),a.jsx(A,{layerStyle:"second",h:512,w:"full",borderRadius:"base",alignItems:"center",justifyContent:"center",children:p?a.jsx(Xl,{label:"Queue Item",data:p,extraCopyActions:[{label:"Graph",getData:w=>jf(w,"session.graph")}]}):a.jsx(ao,{opacity:.5})})]})},urt=h.memo(drt),jp=({label:e,data:t})=>a.jsxs(A,{flexDir:"column",justifyContent:"flex-start",p:1,gap:1,overflow:"hidden",h:"full",w:"full",children:[a.jsx(Pt,{size:"md",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:e}),a.jsx(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t})]}),G$={bg:"base.700"},hrt={_hover:G$,"&[aria-selected='true']":G$},prt=({index:e,item:t})=>{const{t:n}=T(),[s,i]=h.useState(!1),o=h.useCallback(()=>i(v=>!v),[i]),r=gk(),l=h.useCallback(v=>{v.stopPropagation(),r.trigger(t.item_id)},[r,t.item_id]),c=Sfe(),d=h.useCallback(v=>{v.stopPropagation(),c.trigger(t.item_id)},[t.item_id,c]),u=h.useMemo(()=>!t.completed_at||!t.started_at?void 0:`${kfe(t.started_at,t.completed_at)}s`,[t]),p=h.useMemo(()=>["canceled","completed","failed"].includes(t.status),[t.status]),m=h.useMemo(()=>["canceled","failed"].includes(t.status),[t.status]),f=_fe(t.origin),g=wfe(t.destination);return a.jsxs(A,{flexDir:"column","aria-selected":s,fontSize:"sm",borderRadius:"base",justifyContent:"center",sx:hrt,"data-testid":"queue-item",children:[a.jsxs(A,{minH:9,alignItems:"center",gap:4,p:1.5,cursor:"pointer",onClick:o,children:[a.jsx(A,{w:zo.number,alignItems:"center",flexShrink:0,children:a.jsx(q,{variant:"subtext",children:e+1})}),a.jsx(A,{w:zo.createdAt,alignItems:"center",flexShrink:0,flexGrow:0,children:new Date(t.created_at).toLocaleString()}),a.jsx(A,{w:zo.statusBadge,alignItems:"center",flexShrink:0,children:a.jsx(rrt,{status:t.status})}),a.jsx(A,{w:zo.time,alignItems:"center",flexShrink:0,children:u||"-"}),a.jsx(A,{w:zo.origin_destination,flexShrink:0,children:a.jsxs(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:[f," / ",g]})}),a.jsx(A,{w:zo.batchId,flexShrink:0,children:a.jsx(q,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:t.batch_id})}),a.jsx(A,{overflow:"hidden",flexGrow:1,children:t.field_values&&a.jsx(A,{gap:2,w:"full",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:t.field_values.filter(v=>v.node_path!=="metadata_accumulator").map(({node_path:v,field_name:b,value:C})=>a.jsxs(q,{as:"span",children:[a.jsxs(q,{as:"span",fontWeight:"semibold",children:[v,".",b]}),": ",JSON.stringify(C)]},`${t.item_id}.${v}.${b}.${C}`))})}),a.jsx(A,{alignItems:"center",w:zo.actions,pe:3,children:a.jsxs(zn,{size:"xs",variant:"ghost",children:[!m&&a.jsx(oe,{onClick:l,isDisabled:p,isLoading:r.isLoading,"aria-label":n("queue.cancelItem"),icon:a.jsx(fn,{})}),m&&a.jsx(oe,{onClick:d,isLoading:c.isLoading,"aria-label":n("queue.retryItem"),icon:a.jsx(Gs,{})})]})})]}),a.jsx(mu,{in:s,transition:frt,unmountOnExit:!0,children:a.jsx(urt,{queueItem:t})})]})},frt={enter:{duration:.1},exit:{duration:.1}},mrt=h.memo(prt),W8=h.memo(e=>a.jsx(A,{h:9,w:"full",bg:"base.800",borderRadius:"base",alignItems:"center",justifyContent:"center",...e}));W8.displayName="QueueItemPlaceholder";const Ife=UM(rm((e,t)=>a.jsx(A,{...e,ref:t,flexDirection:"column",gap:.5,children:e.children})));Ife.displayName="QueueListComponent";const grt=({field:e,displayName:t,alignItems:n,ps:s,w:i,...o})=>a.jsxs(A,{paddingInlineStart:s,width:i,alignItems:n,...o,children:[a.jsx(q,{variant:"subtext",children:t}),!!e&&a.jsx(jfe,{})]}),Fu=h.memo(grt),jfe=h.memo(()=>{const{t:e}=T(),t=Q(),n=BW(M_e),s=h.useMemo(()=>e(n==="ASC"?"queue.sortOrderAscending":"queue.sortOrderDescending"),[n,e]),i=h.useMemo(()=>n==="ASC"?a.jsx(_Me,{}):a.jsx(wMe,{}),[n]),o=h.useCallback(()=>{t(n==="ASC"?oR("DESC"):oR("ASC"))},[n,t]);return a.jsx(oe,{size:"sm",variant:"link",alignSelf:"stretch",onClick:o,tooltip:s,"aria-label":e("queue.sortColumn"),icon:i})});jfe.displayName="ColumnSortIcon";const vrt=()=>{const{t:e}=T();return a.jsxs(A,{alignItems:"center",gap:4,p:1,pb:2,textTransform:"uppercase",fontWeight:"bold",fontSize:"sm",letterSpacing:1,children:[a.jsx(Fu,{displayName:"#",w:zo.number,alignItems:"center"}),a.jsx(Fu,{field:"created_at",displayName:e("queue.createdAt"),ps:.5,w:zo.createdAt,alignItems:"center"}),a.jsx(Fu,{displayName:e("queue.status"),ps:.5,w:zo.statusBadge,alignItems:"center"}),a.jsx(Fu,{displayName:e("queue.time"),ps:.5,w:zo.time,alignItems:"center"}),a.jsx(Fu,{displayName:`${e("queue.origin")} / ${e("queue.destination")}`,ps:.5,w:zo.origin_destination,alignItems:"center"}),a.jsx(Fu,{displayName:e("queue.batch"),ps:.5,w:zo.batchId,alignItems:"center"}),a.jsx(Fu,{displayName:e("queue.batchFieldValues"),ps:.5,w:zo.fieldValues,alignItems:"center",flexGrow:1})]})},yrt=h.memo(vrt),brt={refetchOnReconnect:!0,selectFromResult:({currentData:e,isLoading:t,isFetching:n})=>({item_ids:e?.item_ids??os,isLoading:t,isFetching:n})},xrt=()=>{const e=M(L_e),[t]=el(e,300),{item_ids:n,isLoading:s,isFetching:i}=R_e(t,brt);return{queryArgs:t,itemIds:n,isLoading:s,isFetching:i}},Crt=e=>{const[t,n]=h.useState(null),[s,i]=SS({defer:!0,events:{initialized(o){const{viewport:r}=o.elements();r.style.overflowX="var(--os-viewport-overflow-x)",r.style.overflowY="var(--os-viewport-overflow-y)"}},options:{scrollbars:{visibility:"auto",autoHide:"scroll",autoHideDelay:1300,theme:"os-theme-dark"}}});return h.useEffect(()=>{const{current:o}=e;return t&&o&&s({target:o,elements:{viewport:t}}),()=>{i()?.destroy()}},[t,s,i,e]),n},Efe=h.memo(({index:e,itemId:t})=>{const{currentData:n,isUninitialized:s}=mi.endpoints.getQueueItem.useQueryState(t);return mi.endpoints.getQueueItem.useQuerySubscription(t,{skip:s}),n?a.jsx(mrt,{index:e,item:n}):a.jsx(W8,{"item-id":t})});Efe.displayName="QueueItemAtPosition";const wrt=(e,t,n)=>`${JSON.stringify(n.queryArgs)}-${t??e}`,_rt=(e,t)=>a.jsx(Efe,{index:e,itemId:t}),Afe=e=>a.jsx(A,{children:a.jsx(W8,{})});Afe.displayName="ScrollSeekPlaceholderComponent";const Srt={List:Ife,ScrollSeekPlaceholder:Afe},krt={enter:e=>Math.abs(e)>2048,exit:e=>e===0},Irt=()=>{const e=h.useRef(null),t=h.useRef({startIndex:0,endIndex:0}),n=h.useRef(null),{t:s}=T(),{queryArgs:i,itemIds:o,isLoading:r}=xrt(),{onRangeChanged:l}=ort({itemIds:o,enabled:!r}),c=Crt(n),d=h.useCallback(p=>{t.current=p,l(p)},[l]),u=h.useMemo(()=>({queryArgs:i}),[i]);return r?a.jsx(m1,{}):o.length?a.jsxs(A,{w:"full",h:"full",flexDir:"column",children:[a.jsx(yrt,{}),a.jsx(A,{ref:n,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:a.jsx(Doe,{ref:e,context:u,data:o,increaseViewportBy:512,itemContent:_rt,computeItemKey:wrt,components:Srt,scrollerRef:c,scrollSeekConfiguration:krt,rangeChanged:d})})]}):a.jsx(A,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:a.jsx(Pt,{color:"base.500",children:s("queue.queueEmpty")})})},jrt=()=>{const{data:e}=ur(),{t}=T();return a.jsxs(Cfe,{"data-testid":"queue-status",children:[a.jsx(wl,{label:t("queue.in_progress"),value:e?.queue.in_progress??0}),a.jsx(wl,{label:t("queue.pending"),value:e?.queue.pending??0}),a.jsx(wl,{label:t("queue.completed"),value:e?.queue.completed??0}),a.jsx(wl,{label:t("queue.failed"),value:e?.queue.failed??0}),a.jsx(wl,{label:t("queue.canceled"),value:e?.queue.canceled??0}),a.jsx(wl,{label:t("queue.total"),value:e?.queue.total??0})]})},Ert=h.memo(jrt),Art=()=>{const[e,{isLoading:t}]=O_e(),{t:n}=T(),s=h.useCallback(async()=>{try{await e().unwrap(),pe({status:"success",title:n("modelCache.clearSucceeded")})}catch{pe({status:"error",title:n("modelCache.clearFailed")})}},[e,n]);return a.jsx(he,{size:"sm",colorScheme:"red",onClick:s,isLoading:t,children:n("modelCache.clear")})},Prt=h.memo(Art),Pfe=h.memo(e=>{const{t}=T(),n=a6();return a.jsx(he,{isDisabled:n.isDisabled,isLoading:n.isLoading,"aria-label":t("queue.clear"),tooltip:t("queue.clearTooltip"),leftIcon:a.jsx(Qc,{}),colorScheme:"error",onClick:n.openDialog,...e,children:t("queue.clear")})});Pfe.displayName="ClearQueueButton";const Trt=({label:e,tooltip:t,icon:n,onClick:s,isDisabled:i,colorScheme:o,asIconButton:r,isLoading:l,loadingText:c,sx:d})=>r?a.jsx(oe,{"aria-label":e,tooltip:t,icon:n,onClick:s,isDisabled:i,colorScheme:o,isLoading:l,sx:d,"data-testid":e}):a.jsx(he,{"aria-label":e,tooltip:t,leftIcon:n,onClick:s,isDisabled:i,colorScheme:o,isLoading:l,loadingText:c??e,flexGrow:1,sx:d,"data-testid":e,children:e}),U8=h.memo(Trt),Drt=({asIconButton:e})=>{const{t}=T(),n=wce();return a.jsx(U8,{asIconButton:e,label:t("queue.pause"),tooltip:t("queue.pauseTooltip"),isDisabled:n.isDisabled,isLoading:n.isLoading,icon:a.jsx(xX,{}),onClick:n.trigger,colorScheme:"gold"})},Mrt=h.memo(Drt),Lrt=()=>{const{t:e}=T(),t=le(ks),n=Tfe(),[s,{isLoading:i}]=rU({fixedCacheKey:"pruneQueue"});return{trigger:h.useCallback(async()=>{try{const r=await s().unwrap();pe({id:"PRUNE_SUCCEEDED",title:e("queue.pruneSucceeded",{item_count:r.deleted}),status:"success"})}catch{pe({id:"PRUNE_FAILED",title:e("queue.pruneFailed"),status:"error"})}},[s,e]),isLoading:i,isDisabled:!t||!n}},Tfe=()=>{const{finishedCount:e}=ur(void 0,{selectFromResult:({data:t})=>t?{finishedCount:t.queue.completed+t.queue.canceled+t.queue.failed}:{finishedCount:0}});return e},Rrt=({asIconButton:e})=>{const{t}=T(),n=Lrt(),s=Tfe();return a.jsx(U8,{onClick:n.trigger,isDisabled:n.isDisabled,isLoading:n.isLoading,asIconButton:e,label:t("queue.prune"),tooltip:t("queue.pruneTooltip",{item_count:s}),icon:a.jsx(RDe,{}),colorScheme:"invokeBlue"})},Ort=h.memo(Rrt),Nrt=({asIconButton:e})=>{const{t}=T(),n=_ce();return a.jsx(U8,{asIconButton:e,label:t("queue.resume"),tooltip:t("queue.resumeTooltip"),isDisabled:n.isDisabled,isLoading:n.isLoading,icon:a.jsx(CX,{}),onClick:n.trigger,colorScheme:"green"})},Frt=h.memo(Nrt),Brt=()=>a.jsxs(A,{flexDir:"column",layerStyle:"first",borderRadius:"base",p:2,gap:2,children:[a.jsxs(A,{gap:2,children:[a.jsxs(zn,{orientation:"vertical",size:"sm",children:[a.jsx(Frt,{}),a.jsx(Mrt,{})]}),a.jsxs(zn,{orientation:"vertical",size:"sm",children:[a.jsx(Ort,{}),a.jsx(Pfe,{})]})]}),a.jsx(Prt,{})]}),zrt=h.memo(Brt),Vrt=()=>a.jsxs(A,{borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:2,children:[a.jsxs(A,{gap:2,w:"full",children:[a.jsx(zrt,{}),a.jsx(Ert,{}),a.jsx(srt,{})]}),a.jsx(ke,{layerStyle:"first",p:2,borderRadius:"base",w:"full",h:"full",children:a.jsx(Irt,{})})]}),$rt=h.memo(Vrt),Grt=()=>a.jsx(A,{layerStyle:"body",w:"full",h:"full",p:2,children:a.jsx($rt,{})}),Hrt=h.memo(Grt),Wrt={[wP]:Hrt},Urt=(e,t)=>{Ne.registerContainer(e,"root",t,()=>{t.addPanel({id:wP,component:wP,priority:Hn.High})})},Dfe=h.memo(()=>{const e=h.useCallback(({api:t})=>{Urt("queue",t)},[]);return h.useEffect(()=>()=>{Ne.unregisterTab("queue")},[]),a.jsx(Zm,{tab:"queue",children:a.jsx(Eo,{className:"dockview-theme-invoke",components:Wrt,onReady:e,orientation:Ke.VERTICAL})})});Dfe.displayName="QueueTabAutoLayout";const Mfe=h.memo(()=>{const{t:e}=T(),t=Q(),n=M(gq),s=M(vq),i=M(yq),o=h.useMemo(()=>Hv.getData(),[]),r=h.useCallback(m=>{t(Mv(du(m)))},[t]),l=Yo({allowMultiple:!1,onUpload:r}),c=h.useCallback(()=>{t(R0(-5)),t(O0(5))},[t]),d=h.useCallback(()=>{t(R0(0)),t(O0(0))},[t]),u=h.useCallback(()=>{t(R0(5)),t(O0(-2))},[t]),p=h.useCallback(()=>{t(R0(8)),t(O0(-5))},[t]);return a.jsxs(ib,{heading:e("ui.launchpad.upscalingTitle"),children:[a.jsxs(sr,{...l.getUploadButtonProps(),position:"relative",gap:8,children:[n?a.jsxs(a.Fragment,{children:[a.jsx(Je,{as:xh,boxSize:8,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:e("ui.launchpad.upscaling.replaceImage.title")}),a.jsx(q,{color:"base.300",children:e("ui.launchpad.upscaling.replaceImage.description")})]}),a.jsxs(A,{position:"absolute",right:3,bottom:3,children:[a.jsx(qo,{}),a.jsx("input",{...l.getUploadInputProps()})]})]}):a.jsxs(a.Fragment,{children:[a.jsx(Je,{as:xh,boxSize:8,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:e("ui.launchpad.upscaling.uploadImage.title")}),a.jsx(q,{color:"base.300",children:e("ui.launchpad.upscaling.uploadImage.description")})]}),a.jsxs(A,{position:"absolute",right:3,bottom:3,children:[a.jsx(qo,{}),a.jsx("input",{...l.getUploadInputProps()})]})]}),a.jsx(ds,{dndTarget:Hv,dndTargetData:o,label:e("gallery.drop")})]}),n&&a.jsx(A,{bg:"base.800",p:4,borderRadius:"base",border:"1px solid",borderColor:"base.700",children:a.jsxs(q,{variant:"subtext",fontSize:"sm",lineHeight:"1.6",children:[a.jsx("strong",{children:e("ui.launchpad.upscaling.readyToUpscale.title")})," ",e("ui.launchpad.upscaling.readyToUpscale.description")]})}),a.jsxs(Ms,{gridTemplateColumns:"1fr 1fr",gap:8,alignItems:"start",children:[a.jsxs(ke,{children:[a.jsx(q,{fontWeight:"semibold",fontSize:"sm",mb:3,children:e("ui.launchpad.upscaling.creativityAndStructure.title")}),a.jsxs(zn,{size:"sm",orientation:"vertical",variant:"outline",w:"full",children:[a.jsx(he,{colorScheme:s===-5&&i===5?"invokeBlue":void 0,justifyContent:"center",onClick:c,leftIcon:a.jsx(xMe,{}),children:e("ui.launchpad.upscaling.creativityAndStructure.conservative")}),a.jsx(he,{colorScheme:s===0&&i===0?"invokeBlue":void 0,justifyContent:"center",onClick:d,leftIcon:a.jsx(vMe,{}),children:e("ui.launchpad.upscaling.creativityAndStructure.balanced")}),a.jsx(he,{colorScheme:s===5&&i===-2?"invokeBlue":void 0,justifyContent:"center",onClick:u,leftIcon:a.jsx(cMe,{}),children:e("ui.launchpad.upscaling.creativityAndStructure.creative")}),a.jsx(he,{colorScheme:s===8&&i===-5?"invokeBlue":void 0,justifyContent:"center",onClick:p,leftIcon:a.jsx(SMe,{}),children:e("ui.launchpad.upscaling.creativityAndStructure.artistic")})]})]}),a.jsxs(ke,{children:[a.jsx(q,{variant:"subtext",fontSize:"sm",lineHeight:"1.6",children:e("ui.launchpad.upscaling.helpText.promptAdvice")}),a.jsx(q,{variant:"subtext",fontSize:"sm",lineHeight:"1.6",mt:3,children:e("ui.launchpad.upscaling.helpText.styleAdvice")})]})]})]})});Mfe.displayName="UpscalingLaunchpadPanel";const Lfe=h.memo(()=>{const e=M(RM),t=M(LM);return a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsx(S8,{}),e&&t&&a.jsx(_8,{})]})});Lfe.displayName="UpscalePrompts";const qrt=ve(QD,Cq,(e,t)=>{if(!e.data||!t)return null;const n=$l.selectById(e.data,t.key);return!n||!N_e(n)?null:n}),Krt=()=>{const e=Q(),{t}=T(),n=M(qrt),s=M(qc),[i,{isLoading:o}]=bq(),r=h.useCallback(d=>{e(xq(d))},[e]),l=h.useMemo(()=>s?i.filter(d=>{const u=d.base===s,p=d.name.toLowerCase().includes("tile")||d.name.toLowerCase().includes("union");return u&&p}):[],[i,s]),c=h.useCallback(d=>{const u=s===d.base;return!!!s||!u},[s]);return a.jsxs(te,{isDisabled:!l.length,isInvalid:!l.length,minW:0,flexGrow:1,gap:2,children:[a.jsx(Ue,{feature:"controlNet",children:a.jsx(ne,{m:0,children:t("upscaling.tileControl")})}),a.jsx(sb,{pickerId:"tile-controlnet-model",modelConfigs:l,selectedModelConfig:n??void 0,onChange:r,getIsOptionDisabled:c,placeholder:t("common.placeholderSelectAModel"),noOptionsText:t("upscaling.missingTileControlNetModel"),isDisabled:o||!l.length,isInvalid:!l.length})]})},Zrt=h.memo(Krt),H$=128,Rfe=32,Ofe=256,Xrt=16,Yrt=512,W$=16,U$=8,Qrt=[Rfe,128,Ofe],Jrt=()=>{const e=M(F_e),t=Q(),{t:n}=T(),s=h.useCallback(i=>{t(B_e(i))},[t]);return a.jsxs(te,{children:[a.jsx(ne,{children:n("upscaling.tileOverlap")}),a.jsx(it,{value:e,defaultValue:H$,min:Rfe,max:Ofe,step:W$,fineStep:U$,onChange:s,marks:Qrt}),a.jsx(Pe,{value:e,defaultValue:H$,min:Xrt,max:Yrt,step:W$,fineStep:U$,onChange:s})]})},q$=1024,Nfe=512,Ffe=1536,elt=512,tlt=1536,K$=64,Z$=64,nlt=[Nfe,1024,Ffe],slt=()=>{const e=M(z_e),t=Q(),{t:n}=T(),s=h.useCallback(i=>{t(V_e(i))},[t]);return a.jsxs(te,{children:[a.jsx(ne,{children:n("upscaling.tileSize")}),a.jsx(it,{value:e,defaultValue:q$,min:Nfe,max:Ffe,step:K$,fineStep:Z$,onChange:s,marks:nlt}),a.jsx(Pe,{value:e,defaultValue:q$,min:elt,max:tlt,step:K$,fineStep:Z$,onChange:s})]})},Bfe=h.memo(()=>{const e=M(SU),{currentData:t}=om(e??Ri),n=M(Hc),s=M(u_),i=h.useMemo(()=>Yn([oo,Hc],(d,u)=>{const p=[];if(u){if(t){let m=t.name;d.vaePrecision==="fp16"&&(m+=` ${d.vaePrecision}`),p.push(m)}}else{if(t){let m=t.name;d.vaePrecision==="fp16"&&(m+=` ${d.vaePrecision}`),p.push(m)}else d.vaePrecision==="fp16"&&p.push(`VAE ${d.vaePrecision}`);d.clipSkip&&p.push(`Skip ${d.clipSkip}`),d.cfgRescaleMultiplier&&p.push(`Rescale ${d.cfgRescaleMultiplier}`),(d.seamlessXAxis||d.seamlessYAxis)&&p.push("seamless"),d.shouldRandomizeSeed||p.push("Manual Seed")}return p}),[t]),o=M(i),{t:r}=T(),{isOpen:l,onToggle:c}=sd({id:"'advanced-settings-upscaling",defaultIsOpen:!1});return a.jsx(Kc,{label:r("accordions.advanced.title"),badges:o,isOpen:l,onToggle:c,children:a.jsxs(A,{gap:4,alignItems:"center",p:4,flexDir:"column","data-testid":"advanced-settings-accordion",children:[a.jsxs(A,{gap:4,w:"full",children:[n?a.jsx(ode,{}):a.jsx(ade,{}),!n&&!s&&a.jsx(rde,{})]}),a.jsx(xk,{}),a.jsx(Zrt,{}),a.jsx(slt,{}),a.jsx(Jrt,{})]})})});Bfe.displayName="UpscaleTabAdvancedSettingsAccordion";const oa={initial:7,sliderMin:1,sliderMax:20,numberInputMin:1,numberInputMax:200,fineStep:.1,coarseStep:.5},ilt=[oa.sliderMin,Math.floor(oa.sliderMax/2),oa.sliderMax],olt=()=>{const e=M($_e),t=Q(),{t:n}=T(),s=h.useCallback(i=>t(G_e(i)),[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"paramCFGScale",children:a.jsx(ne,{children:n("parameters.cfgScale")})}),a.jsx(it,{value:e,defaultValue:oa.initial,min:oa.sliderMin,max:oa.sliderMax,step:oa.coarseStep,fineStep:oa.fineStep,onChange:s,marks:ilt}),a.jsx(Pe,{value:e,defaultValue:oa.initial,min:oa.numberInputMin,max:oa.numberInputMax,step:oa.coarseStep,fineStep:oa.fineStep,onChange:s})]})},alt=h.memo(olt),rlt=()=>{const e=Q(),{t}=T(),n=M(H_e),s=h.useCallback(o=>{Uy(o?.value)&&e(W_e(o.value))},[e]),i=h.useMemo(()=>Hl.find(o=>o.value===n),[n]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"paramScheduler",children:a.jsx(ne,{children:t("parameters.scheduler")})}),a.jsx(pt,{value:i,options:Hl,onChange:s})]})},llt=h.memo(rlt),clt={minW:"4rem"},zfe=h.memo(()=>{const{t:e}=T(),t=W1(),n=M(Hc),s=h.useMemo(()=>Yn(Hy,u=>{const p=u.loras.filter(g=>g.isEnabled).length,m=p?[`${p} ${e("models.concepts")}`]:os,f=t?[t.name,t.base]:os;return{loraTabBadges:m,accordionBadges:f}}),[t,e]),{loraTabBadges:i,accordionBadges:o}=M(s),{isOpen:r,onToggle:l}=bk({id:"generation-settings-advanced",defaultIsOpen:!1}),{isOpen:c,onToggle:d}=sd({id:"generation-settings-upscaling",defaultIsOpen:!1});return a.jsx(Kc,{label:e("accordions.generation.title"),badges:[...o,...i],isOpen:c,onToggle:d,children:a.jsxs(ke,{px:4,pt:4,"data-testid":"generation-accordion",children:[a.jsxs(A,{gap:4,flexDir:"column",pb:0,children:[a.jsx(A8,{}),a.jsx(ude,{}),a.jsx(E8,{})]}),a.jsx(v_,{label:e("accordions.advanced.options"),isOpen:r,onToggle:l,children:a.jsx(A,{gap:4,flexDir:"column",pb:4,children:a.jsxs(Ys,{formLabelProps:clt,children:[a.jsx(llt,{}),a.jsx(gde,{}),n&&t&&!IM(t)&&a.jsx(fde,{}),a.jsx(alt,{})]})})})]})})});zfe.displayName="UpscaleTabGenerationSettingsAccordion";const X$=0,Vfe=-10,$fe=10,dlt=-10,ult=10,Y$=1,Q$=1,hlt=[Vfe,0,$fe],plt=()=>{const e=M(vq),t=Q(),{t:n}=T(),s=h.useCallback(i=>{t(R0(i))},[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"creativity",children:a.jsx(ne,{children:n("upscaling.creativity")})}),a.jsx(it,{value:e,defaultValue:X$,min:Vfe,max:$fe,step:Y$,fineStep:Q$,onChange:s,marks:hlt}),a.jsx(Pe,{value:e,defaultValue:X$,min:dlt,max:ult,step:Y$,fineStep:Q$,onChange:s})]})},flt=h.memo(plt),mlt=()=>{const{t:e}=T(),[t,{isLoading:n}]=PM(),s=M(wq),i=Q(),o=h.useMemo(()=>{if(!(!t.length||!s))return t.find(m=>m.key===s?.key)?.description},[t,s]),r=h.useCallback(m=>{i(U_e(m))},[i]),{options:l,value:c,onChange:d,placeholder:u,noOptionsMessage:p}=nl({modelConfigs:t,onChange:r,selectedModel:s,isLoading:n});return a.jsxs(te,{orientation:"vertical",children:[a.jsx(Ue,{feature:"upscaleModel",children:a.jsx(ne,{children:e("upscaling.upscaleModel")})}),a.jsx(A,{w:"full",alignItems:"center",gap:2,children:a.jsx(He,{label:o,children:a.jsx(ke,{w:"full",children:a.jsx(pt,{value:c,placeholder:u,options:l,onChange:d,noOptionsMessage:p,isDisabled:l.length===0})})})})]})},glt=h.memo(mlt),J$=0,Gfe=-10,Hfe=10,vlt=-10,ylt=10,eG=1,tG=1,blt=[Gfe,0,Hfe],xlt=()=>{const e=M(yq),t=Q(),{t:n}=T(),s=h.useCallback(i=>{t(O0(i))},[t]);return a.jsxs(te,{children:[a.jsx(Ue,{feature:"structure",children:a.jsx(ne,{children:n("upscaling.structure")})}),a.jsx(it,{value:e,defaultValue:J$,min:Gfe,max:Hfe,step:eG,fineStep:tG,onChange:s,marks:blt}),a.jsx(Pe,{value:e,defaultValue:J$,min:vlt,max:ylt,step:eG,fineStep:tG,onChange:s})]})},Clt=h.memo(xlt),wlt=[2,4,8],nG=e=>`${e}x`,Wfe=h.memo(()=>{const e=Q(),{t}=T(),n=M(q_e),s=h.useCallback(i=>{e(K_e(i))},[e]);return a.jsxs(te,{orientation:"vertical",gap:0,children:[a.jsx(Ue,{feature:"scale",children:a.jsx(ne,{m:0,children:t("upscaling.scale")})}),a.jsxs(A,{w:"full",gap:4,children:[a.jsx(it,{min:2,max:8,value:n,onChange:s,marks:wlt,formatValue:nG,defaultValue:4}),a.jsx(Pe,{maxW:20,value:n,onChange:s,defaultValue:4,min:1,max:16,step:.5,format:nG})]})]})});Wfe.displayName="UpscaleScaleSlider";const _lt=()=>{const e=Q(),t=M(gq),n=Jd(t?.image_name),s=h.useMemo(()=>Hv.getData(),[]),i=h.useCallback(()=>{e(Mv(null))},[e]),o=h.useCallback(r=>{e(Mv(du(r)))},[e]);return a.jsx(A,{justifyContent:"flex-start",children:a.jsxs(A,{position:"relative",w:36,h:36,alignItems:"center",justifyContent:"center",children:[!n&&a.jsx(C1,{w:"full",h:"full",isError:!n,onUpload:o,fontSize:36}),n&&a.jsxs(a.Fragment,{children:[a.jsx(lc,{imageDTO:n,borderRadius:"base"}),a.jsx(A,{position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1,children:a.jsx(nr,{onClick:i,icon:a.jsx(Gs,{size:16}),tooltip:ye("common.reset")})}),a.jsx(q,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:0,left:0,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",borderBottomStartRadius:"base",pointerEvents:"none",children:`${n.width}x${n.height}`})]}),a.jsx(ds,{dndTarget:Hv,dndTargetData:s,label:ye("gallery.drop")})]})})},Slt=()=>{const{t:e}=T(),t=M(Fy),n=M(wq),s=M(Cq),i=Q(),[o,{isLoading:r}]=bq();h.useEffect(()=>{const u=o.find(p=>p.base===t?.base&&p.name.toLowerCase().includes("tile"));s?.key!==u?.key&&i(xq(u||null))},[i,t?.base,o,s?.key]);const l=h.useMemo(()=>t&&["sd-1","sdxl"].includes(t.base),[t]),c=h.useMemo(()=>{const u=[];return l&&(t||u.push(e("upscaling.mainModelDesc")),s||u.push(e("upscaling.tileControlNetModelDesc")),n||u.push(e("upscaling.upscaleModelDesc"))),u},[l,t,s,n,e]),d=h.useCallback(()=>{Ne.switchToTab("models"),El("launchpad")},[]);return l&&c.length===0||r?null:a.jsxs(A,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:[!l&&a.jsx(q,{children:e("upscaling.incompatibleBaseModelDesc")}),c.length>0&&a.jsx(q,{children:a.jsx(Bn,{i18nKey:"upscaling.missingModelsWarning",components:{LinkComponent:a.jsx(he,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:d})}})}),c.length>0&&a.jsx(Li,{children:c.map(u=>a.jsx(rn,{children:u},u))})]})},klt=Yn([GD],e=>{const{upscaleModel:t,upscaleInitialImage:n,scale:s}=e,i=[];if(t&&i.push(t.name),n){const o=t?z2(t.base):z2(null),r=Pf(n.width*s,o),l=Pf(n.height*s,o);i.push(`${r}${l}`)}return{badges:i}}),Ufe=h.memo(()=>{const{t:e}=T(),{badges:t}=M(klt),{isOpen:n,onToggle:s}=sd({id:"upscale-settings",defaultIsOpen:!0}),{isOpen:i,onToggle:o}=bk({id:"upscale-settings-advanced",defaultIsOpen:!1});return a.jsx(Kc,{label:e("upscaling.upscale"),badges:t,isOpen:n,onToggle:s,children:a.jsxs(A,{pt:4,px:4,w:"full",h:"full",flexDir:"column","data-testid":"upscale-settings-accordion",children:[a.jsxs(A,{flexDir:"column",gap:4,children:[a.jsxs(A,{gap:4,children:[a.jsx(_lt,{}),a.jsxs(A,{direction:"column",w:"full",alignItems:"center",gap:2,minW:0,children:[a.jsx(glt,{}),a.jsx(Wfe,{})]})]}),a.jsx(Slt,{})]}),a.jsx(v_,{label:e("accordions.advanced.options"),isOpen:i,onToggle:o,children:a.jsxs(A,{gap:4,pb:4,flexDir:"column",children:[a.jsx(flt,{}),a.jsx(Clt,{})]})})]})})});Ufe.displayName="UpscaleSettingsAccordion";const sG={height:"100%",width:"100%"},qfe=h.memo(()=>{const e=le(Af);return a.jsxs(A,{w:"full",h:"full",flexDir:"column",gap:2,children:[a.jsx(M8,{}),a.jsx(A,{w:"full",h:"full",position:"relative",children:a.jsxs(ke,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[e&&a.jsx(ti,{defer:!0,style:sG,options:iu.options,children:a.jsx(A,{gap:2,flexDirection:"column",h:"full",w:"full",children:a.jsx(D8,{})})}),a.jsx(ti,{defer:!0,style:sG,options:iu.options,children:a.jsxs(A,{gap:2,flexDirection:"column",h:"full",w:"full",children:[a.jsx(Lfe,{}),a.jsx(Ufe,{}),a.jsx(zfe,{}),a.jsx(Bfe,{})]})})]})})]})});qfe.displayName="ParametersPanelUpscale";const Kfe=h.memo(()=>a.jsxs(A,{flexDir:"column",w:"full",h:"full",gap:2,children:[a.jsx(yk,{}),a.jsx(ke,{position:"relative",w:"full",h:"full",children:a.jsx(qfe,{})})]}));Kfe.displayName="UpscalingTabLeftPanel";const Ilt={[F_]:kk,[fm]:Ik,[yu]:ab},jlt={[ka]:vs(Mfe),[cs]:vs(tb)},Elt=(e,t)=>{Ne.registerContainer(e,"main",t,()=>{const n=t.addPanel({id:ka,component:ka,title:ye("ui.panels.launchpad"),tabComponent:yu,params:{tab:e,focusRegion:"launchpad",i18nKey:"ui.panels.launchpad"}});t.addPanel({id:cs,component:cs,title:ye("ui.panels.imageViewer"),tabComponent:fm,params:{tab:e,focusRegion:"viewer",i18nKey:"ui.panels.imageViewer"},position:{direction:"within",referencePanel:n.id}}),n.api.setActive()})},Zfe=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Elt(e,n)},[e]);return a.jsxs(a.Fragment,{children:[a.jsx(t1,{disableDnd:!0,locked:!0,disableFloatingGroups:!0,dndEdges:!1,tabComponents:Ilt,components:jlt,onReady:t,theme:mk}),a.jsx(fk,{}),a.jsx(nb,{}),a.jsx(rb,{})]})});Zfe.displayName="MainPanel";const Alt={[Ia]:vs(U1),[ja]:vs(X1)},Plt=(e,t)=>{Ne.registerContainer(e,"right",t,()=>{const n=t.addPanel({id:ja,component:ja,minimumWidth:Pi,minimumHeight:s1,params:{tab:e,focusRegion:"gallery"}}),s=t.addPanel({id:Ia,component:Ia,minimumHeight:n1,params:{tab:e,focusRegion:"boards"},position:{direction:"above",referencePanel:n.id}});n.api.setSize({height:i1}),s.api.setSize({height:B_})})},Xfe=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Plt(e,n)},[e]);return a.jsx(Eo,{className:"dockview-theme-invoke",orientation:Ke.VERTICAL,components:Alt,onReady:t})});Xfe.displayName="RightPanel";const Tlt={[lr]:vs(Kfe)},Dlt=(e,t)=>{Ne.registerContainer(e,"left",t,()=>{t.addPanel({id:lr,component:lr,params:{tab:e,focusRegion:"settings"}})})},Yfe=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Dlt(e,n)},[e]);return a.jsx(Eo,{className:"dockview-theme-invoke",orientation:Ke.VERTICAL,components:Tlt,onReady:t})});Yfe.displayName="LeftPanel";const Mlt={[qi]:Yfe,[rr]:Zfe,[Ki]:Xfe},Llt=(e,t)=>{Ne.registerContainer(e,"root",t,()=>{const n=t.addPanel({id:rr,component:rr,priority:Hn.High}),s=t.addPanel({id:qi,component:qi,minimumWidth:ma,position:{direction:"left",referencePanel:n.id}}),i=t.addPanel({id:Ki,component:Ki,minimumWidth:Pi,position:{direction:"right",referencePanel:n.id}});s.api.setSize({width:ma}),i.api.setSize({width:Pi})})},Qfe=h.memo(()=>{const e=h.useCallback(({api:t})=>{Llt("upscaling",t)},[]);return h.useEffect(()=>()=>{Ne.unregisterTab("upscaling")},[]),a.jsx(Zm,{tab:"upscaling",children:a.jsx(Eo,{className:"dockview-theme-invoke",components:Mlt,onReady:e,orientation:Ke.VERTICAL})})});Qfe.displayName="UpscalingTabAutoLayout";var iG=1,Rlt=.9,Olt=.8,Nlt=.17,fA=.1,mA=.999,Flt=.9999,Blt=.99,zlt=/[\\\/_+.#"@\[\(\{&]/,Vlt=/[\\\/_+.#"@\[\(\{&]/g,$lt=/[\s-]/,Jfe=/[\s-]/g;function yD(e,t,n,s,i,o,r){if(o===t.length)return i===e.length?iG:Blt;var l=`${i},${o}`;if(r[l]!==void 0)return r[l];for(var c=s.charAt(o),d=n.indexOf(c,i),u=0,p,m,f,g;d>=0;)p=yD(e,t,n,s,d+1,o+1,r),p>u&&(d===i?p*=iG:zlt.test(e.charAt(d-1))?(p*=Olt,f=e.slice(i,d-1).match(Vlt),f&&i>0&&(p*=Math.pow(mA,f.length))):$lt.test(e.charAt(d-1))?(p*=Rlt,g=e.slice(i,d-1).match(Jfe),g&&i>0&&(p*=Math.pow(mA,g.length))):(p*=Nlt,i>0&&(p*=Math.pow(mA,d-i))),e.charAt(d)!==t.charAt(o)&&(p*=Flt)),(p<fA&&n.charAt(d-1)===s.charAt(o+1)||s.charAt(o+1)===s.charAt(o)&&n.charAt(d-1)!==s.charAt(o))&&(m=yD(e,t,n,s,d+1,o+2,r),m*fA>p&&(p=m*fA)),p>u&&(u=p),d=n.indexOf(c,d+1);return r[l]=u,u}function oG(e){return e.toLowerCase().replace(Jfe," ")}function Glt(e,t,n){return e=n&&n.length>0?`${e+" "+n.join(" ")}`:e,yD(e,t,oG(e),oG(t),0,0,{})}function qd(e,t,{checkForDefaultPrevented:n=!0}={}){return function(i){if(e?.(i),n===!1||!i.defaultPrevented)return t?.(i)}}function aG(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Ph(...e){return t=>{let n=!1;const s=e.map(i=>{const o=aG(i,t);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let i=0;i<s.length;i++){const o=s[i];typeof o=="function"?o():aG(e[i],null)}}}}function op(...e){return h.useCallback(Ph(...e),e)}function Hlt(e,t){const n=h.createContext(t),s=o=>{const{children:r,...l}=o,c=h.useMemo(()=>l,Object.values(l));return a.jsx(n.Provider,{value:c,children:r})};s.displayName=e+"Provider";function i(o){const r=h.useContext(n);if(r)return r;if(t!==void 0)return t;throw new Error(`\`${o}\` must be used within \`${e}\``)}return[s,i]}function Wlt(e,t=[]){let n=[];function s(o,r){const l=h.createContext(r),c=n.length;n=[...n,r];const d=p=>{const{scope:m,children:f,...g}=p,v=m?.[e]?.[c]||l,b=h.useMemo(()=>g,Object.values(g));return a.jsx(v.Provider,{value:b,children:f})};d.displayName=o+"Provider";function u(p,m){const f=m?.[e]?.[c]||l,g=h.useContext(f);if(g)return g;if(r!==void 0)return r;throw new Error(`\`${p}\` must be used within \`${o}\``)}return[d,u]}const i=()=>{const o=n.map(r=>h.createContext(r));return function(l){const c=l?.[e]||o;return h.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return i.scopeName=e,[s,Ult(i,...t)]}function Ult(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const s=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(o){const r=s.reduce((l,{useScope:c,scopeName:d})=>{const p=c(o)[`__scope${d}`];return{...l,...p}},{});return h.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}var Iy=globalThis?.document?h.useLayoutEffect:()=>{},qlt=AM[" useId ".trim().toString()]||(()=>{}),Klt=0;function Bc(e){const[t,n]=h.useState(qlt());return Iy(()=>{n(s=>s??String(Klt++))},[e]),t?`radix-${t}`:""}var Zlt=AM[" useInsertionEffect ".trim().toString()]||Iy;function Xlt({prop:e,defaultProp:t,onChange:n=()=>{},caller:s}){const[i,o,r]=Ylt({defaultProp:t,onChange:n}),l=e!==void 0,c=l?e:i;{const u=h.useRef(e!==void 0);h.useEffect(()=>{const p=u.current;p!==l&&console.warn(`${s} is changing from ${p?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,s])}const d=h.useCallback(u=>{if(l){const p=Qlt(u)?u(e):u;p!==e&&r.current?.(p)}else o(u)},[l,e,o,r]);return[c,d]}function Ylt({defaultProp:e,onChange:t}){const[n,s]=h.useState(e),i=h.useRef(n),o=h.useRef(t);return Zlt(()=>{o.current=t},[t]),h.useEffect(()=>{i.current!==n&&(o.current?.(n),i.current=n)},[n,i]),[n,s,o]}function Qlt(e){return typeof e=="function"}function eme(e){const t=Jlt(e),n=h.forwardRef((s,i)=>{const{children:o,...r}=s,l=h.Children.toArray(o),c=l.find(tct);if(c){const d=c.props.children,u=l.map(p=>p===c?h.Children.count(d)>1?h.Children.only(null):h.isValidElement(d)?d.props.children:null:p);return a.jsx(t,{...r,ref:i,children:h.isValidElement(d)?h.cloneElement(d,void 0,u):null})}return a.jsx(t,{...r,ref:i,children:o})});return n.displayName=`${e}.Slot`,n}function Jlt(e){const t=h.forwardRef((n,s)=>{const{children:i,...o}=n;if(h.isValidElement(i)){const r=sct(i),l=nct(o,i.props);return i.type!==h.Fragment&&(l.ref=s?Ph(s,r):r),h.cloneElement(i,l)}return h.Children.count(i)>1?h.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var ect=Symbol("radix.slottable");function tct(e){return h.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===ect}function nct(e,t){const n={...t};for(const s in t){const i=e[s],o=t[s];/^on[A-Z]/.test(s)?i&&o?n[s]=(...l)=>{const c=o(...l);return i(...l),c}:i&&(n[s]=i):s==="style"?n[s]={...i,...o}:s==="className"&&(n[s]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function sct(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var ict=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],$i=ict.reduce((e,t)=>{const n=eme(`Primitive.${t}`),s=h.forwardRef((i,o)=>{const{asChild:r,...l}=i,c=r?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),a.jsx(c,{...l,ref:o})});return s.displayName=`Primitive.${t}`,{...e,[t]:s}},{});function oct(e,t){e&&pu.flushSync(()=>e.dispatchEvent(t))}function jy(e){const t=h.useRef(e);return h.useEffect(()=>{t.current=e}),h.useMemo(()=>(...n)=>t.current?.(...n),[])}function act(e,t=globalThis?.document){const n=jy(e);h.useEffect(()=>{const s=i=>{i.key==="Escape"&&n(i)};return t.addEventListener("keydown",s,{capture:!0}),()=>t.removeEventListener("keydown",s,{capture:!0})},[n,t])}var rct="DismissableLayer",bD="dismissableLayer.update",lct="dismissableLayer.pointerDownOutside",cct="dismissableLayer.focusOutside",rG,tme=h.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),nme=h.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:o,onInteractOutside:r,onDismiss:l,...c}=e,d=h.useContext(tme),[u,p]=h.useState(null),m=u?.ownerDocument??globalThis?.document,[,f]=h.useState({}),g=op(t,I=>p(I)),v=Array.from(d.layers),[b]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),C=v.indexOf(b),y=u?v.indexOf(u):-1,x=d.layersWithOutsidePointerEventsDisabled.size>0,w=y>=C,_=hct(I=>{const k=I.target,E=[...d.branches].some(j=>j.contains(k));!w||E||(i?.(I),r?.(I),I.defaultPrevented||l?.())},m),S=pct(I=>{const k=I.target;[...d.branches].some(j=>j.contains(k))||(o?.(I),r?.(I),I.defaultPrevented||l?.())},m);return act(I=>{y===d.layers.size-1&&(s?.(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},m),h.useEffect(()=>{if(u)return n&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(rG=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),lG(),()=>{n&&d.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=rG)}},[u,m,n,d]),h.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),lG())},[u,d]),h.useEffect(()=>{const I=()=>f({});return document.addEventListener(bD,I),()=>document.removeEventListener(bD,I)},[]),a.jsx($i.div,{...c,ref:g,style:{pointerEvents:x?w?"auto":"none":void 0,...e.style},onFocusCapture:qd(e.onFocusCapture,S.onFocusCapture),onBlurCapture:qd(e.onBlurCapture,S.onBlurCapture),onPointerDownCapture:qd(e.onPointerDownCapture,_.onPointerDownCapture)})});nme.displayName=rct;var dct="DismissableLayerBranch",uct=h.forwardRef((e,t)=>{const n=h.useContext(tme),s=h.useRef(null),i=op(t,s);return h.useEffect(()=>{const o=s.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),a.jsx($i.div,{...e,ref:i})});uct.displayName=dct;function hct(e,t=globalThis?.document){const n=jy(e),s=h.useRef(!1),i=h.useRef(()=>{});return h.useEffect(()=>{const o=l=>{if(l.target&&!s.current){let c=function(){sme(lct,n,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(t.removeEventListener("click",i.current),i.current=c,t.addEventListener("click",i.current,{once:!0})):c()}else t.removeEventListener("click",i.current);s.current=!1},r=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(r),t.removeEventListener("pointerdown",o),t.removeEventListener("click",i.current)}},[t,n]),{onPointerDownCapture:()=>s.current=!0}}function pct(e,t=globalThis?.document){const n=jy(e),s=h.useRef(!1);return h.useEffect(()=>{const i=o=>{o.target&&!s.current&&sme(cct,n,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",i),()=>t.removeEventListener("focusin",i)},[t,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function lG(){const e=new CustomEvent(bD);document.dispatchEvent(e)}function sme(e,t,n,{discrete:s}){const i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),s?oct(i,o):i.dispatchEvent(o)}var gA="focusScope.autoFocusOnMount",vA="focusScope.autoFocusOnUnmount",cG={bubbles:!1,cancelable:!0},fct="FocusScope",ime=h.forwardRef((e,t)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...r}=e,[l,c]=h.useState(null),d=jy(i),u=jy(o),p=h.useRef(null),m=op(t,v=>c(v)),f=h.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;h.useEffect(()=>{if(s){let v=function(x){if(f.paused||!l)return;const w=x.target;l.contains(w)?p.current=w:vd(p.current,{select:!0})},b=function(x){if(f.paused||!l)return;const w=x.relatedTarget;w!==null&&(l.contains(w)||vd(p.current,{select:!0}))},C=function(x){if(document.activeElement===document.body)for(const _ of x)_.removedNodes.length>0&&vd(l)};document.addEventListener("focusin",v),document.addEventListener("focusout",b);const y=new MutationObserver(C);return l&&y.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",b),y.disconnect()}}},[s,l,f.paused]),h.useEffect(()=>{if(l){uG.add(f);const v=document.activeElement;if(!l.contains(v)){const C=new CustomEvent(gA,cG);l.addEventListener(gA,d),l.dispatchEvent(C),C.defaultPrevented||(mct(xct(ome(l)),{select:!0}),document.activeElement===v&&vd(l))}return()=>{l.removeEventListener(gA,d),setTimeout(()=>{const C=new CustomEvent(vA,cG);l.addEventListener(vA,u),l.dispatchEvent(C),C.defaultPrevented||vd(v??document.body,{select:!0}),l.removeEventListener(vA,u),uG.remove(f)},0)}}},[l,d,u,f]);const g=h.useCallback(v=>{if(!n&&!s||f.paused)return;const b=v.key==="Tab"&&!v.altKey&&!v.ctrlKey&&!v.metaKey,C=document.activeElement;if(b&&C){const y=v.currentTarget,[x,w]=gct(y);x&&w?!v.shiftKey&&C===w?(v.preventDefault(),n&&vd(x,{select:!0})):v.shiftKey&&C===x&&(v.preventDefault(),n&&vd(w,{select:!0})):C===y&&v.preventDefault()}},[n,s,f.paused]);return a.jsx($i.div,{tabIndex:-1,...r,ref:m,onKeyDown:g})});ime.displayName=fct;function mct(e,{select:t=!1}={}){const n=document.activeElement;for(const s of e)if(vd(s,{select:t}),document.activeElement!==n)return}function gct(e){const t=ome(e),n=dG(t,e),s=dG(t.reverse(),e);return[n,s]}function ome(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const i=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||i?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function dG(e,t){for(const n of e)if(!vct(n,{upTo:t}))return n}function vct(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function yct(e){return e instanceof HTMLInputElement&&"select"in e}function vd(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&yct(e)&&t&&e.select()}}var uG=bct();function bct(){let e=[];return{add(t){const n=e[0];t!==n&&n?.pause(),e=hG(e,t),e.unshift(t)},remove(t){e=hG(e,t),e[0]?.resume()}}}function hG(e,t){const n=[...e],s=n.indexOf(t);return s!==-1&&n.splice(s,1),n}function xct(e){return e.filter(t=>t.tagName!=="A")}var Cct="Portal",ame=h.forwardRef((e,t)=>{const{container:n,...s}=e,[i,o]=h.useState(!1);Iy(()=>o(!0),[]);const r=n||i&&globalThis?.document?.body;return r?HD.createPortal(a.jsx($i.div,{...s,ref:t}),r):null});ame.displayName=Cct;function wct(e,t){return h.useReducer((n,s)=>t[n][s]??n,e)}var Ek=e=>{const{present:t,children:n}=e,s=_ct(t),i=typeof n=="function"?n({present:s.isPresent}):h.Children.only(n),o=op(s.ref,Sct(i));return typeof n=="function"||s.isPresent?h.cloneElement(i,{ref:o}):null};Ek.displayName="Presence";function _ct(e){const[t,n]=h.useState(),s=h.useRef(null),i=h.useRef(e),o=h.useRef("none"),r=e?"mounted":"unmounted",[l,c]=wct(r,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return h.useEffect(()=>{const d=Ux(s.current);o.current=l==="mounted"?d:"none"},[l]),Iy(()=>{const d=s.current,u=i.current;if(u!==e){const m=o.current,f=Ux(d);e?c("MOUNT"):f==="none"||d?.display==="none"?c("UNMOUNT"):c(u&&m!==f?"ANIMATION_OUT":"UNMOUNT"),i.current=e}},[e,c]),Iy(()=>{if(t){let d;const u=t.ownerDocument.defaultView??window,p=f=>{const v=Ux(s.current).includes(f.animationName);if(f.target===t&&v&&(c("ANIMATION_END"),!i.current)){const b=t.style.animationFillMode;t.style.animationFillMode="forwards",d=u.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=b)})}},m=f=>{f.target===t&&(o.current=Ux(s.current))};return t.addEventListener("animationstart",m),t.addEventListener("animationcancel",p),t.addEventListener("animationend",p),()=>{u.clearTimeout(d),t.removeEventListener("animationstart",m),t.removeEventListener("animationcancel",p),t.removeEventListener("animationend",p)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:h.useCallback(d=>{s.current=d?getComputedStyle(d):null,n(d)},[])}}function Ux(e){return e?.animationName||"none"}function Sct(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var yA=0;function kct(){h.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??pG()),document.body.insertAdjacentElement("beforeend",e[1]??pG()),yA++,()=>{yA===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),yA--}},[])}function pG(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var L2="right-scroll-bar-position",R2="width-before-scroll-bar",Ict="with-scroll-bars-hidden",jct="--removed-body-scroll-bar-size";function bA(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Ect(e,t){var n=h.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(s){var i=n.value;i!==s&&(n.value=s,n.callback(s,i))}}}})[0];return n.callback=t,n.facade}var Act=typeof window<"u"?h.useLayoutEffect:h.useEffect,fG=new WeakMap;function Pct(e,t){var n=Ect(null,function(s){return e.forEach(function(i){return bA(i,s)})});return Act(function(){var s=fG.get(n);if(s){var i=new Set(s),o=new Set(e),r=n.current;i.forEach(function(l){o.has(l)||bA(l,null)}),o.forEach(function(l){i.has(l)||bA(l,r)})}fG.set(n,e)},[e]),n}function Tct(e){return e}function Dct(e,t){t===void 0&&(t=Tct);var n=[],s=!1,i={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(o){var r=t(o,s);return n.push(r),function(){n=n.filter(function(l){return l!==r})}},assignSyncMedium:function(o){for(s=!0;n.length;){var r=n;n=[],r.forEach(o)}n={push:function(l){return o(l)},filter:function(){return n}}},assignMedium:function(o){s=!0;var r=[];if(n.length){var l=n;n=[],l.forEach(o),r=n}var c=function(){var u=r;r=[],u.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),n={push:function(u){r.push(u),d()},filter:function(u){return r=r.filter(u),n}}}};return i}function Mct(e){e===void 0&&(e={});var t=Dct(null);return t.options=Il({async:!0,ssr:!1},e),t}var rme=function(e){var t=e.sideCar,n=oJ(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return h.createElement(s,Il({},n))};rme.isSideCarExport=!0;function Lct(e,t){return e.useMedium(t),rme}var lme=Mct(),xA=function(){},Ak=h.forwardRef(function(e,t){var n=h.useRef(null),s=h.useState({onScrollCapture:xA,onWheelCapture:xA,onTouchMoveCapture:xA}),i=s[0],o=s[1],r=e.forwardProps,l=e.children,c=e.className,d=e.removeScrollBar,u=e.enabled,p=e.shards,m=e.sideCar,f=e.noRelative,g=e.noIsolation,v=e.inert,b=e.allowPinchZoom,C=e.as,y=C===void 0?"div":C,x=e.gapMode,w=oJ(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),_=m,S=Pct([n,t]),I=Il(Il({},w),i);return h.createElement(h.Fragment,null,u&&h.createElement(_,{sideCar:lme,removeScrollBar:d,shards:p,noRelative:f,noIsolation:g,inert:v,setCallbacks:o,allowPinchZoom:!!b,lockRef:n,gapMode:x}),r?h.cloneElement(h.Children.only(l),Il(Il({},I),{ref:S})):h.createElement(y,Il({},I,{className:c,ref:S}),l))});Ak.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Ak.classNames={fullWidth:R2,zeroRight:L2};var Rct=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Oct(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Rct();return t&&e.setAttribute("nonce",t),e}function Nct(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function Fct(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var Bct=function(){var e=0,t=null;return{add:function(n){e==0&&(t=Oct())&&(Nct(t,n),Fct(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},zct=function(){var e=Bct();return function(t,n){h.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},cme=function(){var e=zct(),t=function(n){var s=n.styles,i=n.dynamic;return e(s,i),null};return t},Vct={left:0,top:0,right:0,gap:0},CA=function(e){return parseInt(e||"",10)||0},$ct=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],s=t[e==="padding"?"paddingTop":"marginTop"],i=t[e==="padding"?"paddingRight":"marginRight"];return[CA(n),CA(s),CA(i)]},Gct=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Vct;var t=$ct(e),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-n+t[2]-t[0])}},Hct=cme(),kf="data-scroll-locked",Wct=function(e,t,n,s){var i=e.left,o=e.top,r=e.right,l=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(Ict,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(l,"px ").concat(s,`;
  }
  body[`).concat(kf,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(r,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(L2,` {
    right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(R2,` {
    margin-right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(L2," .").concat(L2,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(R2," .").concat(R2,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(kf,`] {
    `).concat(jct,": ").concat(l,`px;
  }
`)},mG=function(){var e=parseInt(document.body.getAttribute(kf)||"0",10);return isFinite(e)?e:0},Uct=function(){h.useEffect(function(){return document.body.setAttribute(kf,(mG()+1).toString()),function(){var e=mG()-1;e<=0?document.body.removeAttribute(kf):document.body.setAttribute(kf,e.toString())}},[])},qct=function(e){var t=e.noRelative,n=e.noImportant,s=e.gapMode,i=s===void 0?"margin":s;Uct();var o=h.useMemo(function(){return Gct(i)},[i]);return h.createElement(Hct,{styles:Wct(o,!t,i,n?"":"!important")})},xD=!1;if(typeof window<"u")try{var qx=Object.defineProperty({},"passive",{get:function(){return xD=!0,!0}});window.addEventListener("test",qx,qx),window.removeEventListener("test",qx,qx)}catch{xD=!1}var Ep=xD?{passive:!1}:!1,Kct=function(e){return e.tagName==="TEXTAREA"},dme=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!Kct(e)&&n[t]==="visible")},Zct=function(e){return dme(e,"overflowY")},Xct=function(e){return dme(e,"overflowX")},gG=function(e,t){var n=t.ownerDocument,s=t;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var i=ume(e,s);if(i){var o=hme(e,s),r=o[1],l=o[2];if(r>l)return!0}s=s.parentNode}while(s&&s!==n.body);return!1},Yct=function(e){var t=e.scrollTop,n=e.scrollHeight,s=e.clientHeight;return[t,n,s]},Qct=function(e){var t=e.scrollLeft,n=e.scrollWidth,s=e.clientWidth;return[t,n,s]},ume=function(e,t){return e==="v"?Zct(t):Xct(t)},hme=function(e,t){return e==="v"?Yct(t):Qct(t)},Jct=function(e,t){return e==="h"&&t==="rtl"?-1:1},edt=function(e,t,n,s,i){var o=Jct(e,window.getComputedStyle(t).direction),r=o*s,l=n.target,c=t.contains(l),d=!1,u=r>0,p=0,m=0;do{if(!l)break;var f=hme(e,l),g=f[0],v=f[1],b=f[2],C=v-b-o*g;(g||C)&&ume(e,l)&&(p+=C,m+=g);var y=l.parentNode;l=y&&y.nodeType===Node.DOCUMENT_FRAGMENT_NODE?y.host:y}while(!c&&l!==document.body||c&&(t.contains(l)||t===l));return(u&&Math.abs(p)<1||!u&&Math.abs(m)<1)&&(d=!0),d},Kx=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},vG=function(e){return[e.deltaX,e.deltaY]},yG=function(e){return e&&"current"in e?e.current:e},tdt=function(e,t){return e[0]===t[0]&&e[1]===t[1]},ndt=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},sdt=0,Ap=[];function idt(e){var t=h.useRef([]),n=h.useRef([0,0]),s=h.useRef(),i=h.useState(sdt++)[0],o=h.useState(cme)[0],r=h.useRef(e);h.useEffect(function(){r.current=e},[e]),h.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var v=WNe([e.lockRef.current],(e.shards||[]).map(yG),!0).filter(Boolean);return v.forEach(function(b){return b.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),v.forEach(function(b){return b.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var l=h.useCallback(function(v,b){if("touches"in v&&v.touches.length===2||v.type==="wheel"&&v.ctrlKey)return!r.current.allowPinchZoom;var C=Kx(v),y=n.current,x="deltaX"in v?v.deltaX:y[0]-C[0],w="deltaY"in v?v.deltaY:y[1]-C[1],_,S=v.target,I=Math.abs(x)>Math.abs(w)?"h":"v";if("touches"in v&&I==="h"&&S.type==="range")return!1;var k=gG(I,S);if(!k)return!0;if(k?_=I:(_=I==="v"?"h":"v",k=gG(I,S)),!k)return!1;if(!s.current&&"changedTouches"in v&&(x||w)&&(s.current=_),!_)return!0;var E=s.current||_;return edt(E,b,v,E==="h"?x:w)},[]),c=h.useCallback(function(v){var b=v;if(!(!Ap.length||Ap[Ap.length-1]!==o)){var C="deltaY"in b?vG(b):Kx(b),y=t.current.filter(function(_){return _.name===b.type&&(_.target===b.target||b.target===_.shadowParent)&&tdt(_.delta,C)})[0];if(y&&y.should){b.cancelable&&b.preventDefault();return}if(!y){var x=(r.current.shards||[]).map(yG).filter(Boolean).filter(function(_){return _.contains(b.target)}),w=x.length>0?l(b,x[0]):!r.current.noIsolation;w&&b.cancelable&&b.preventDefault()}}},[]),d=h.useCallback(function(v,b,C,y){var x={name:v,delta:b,target:C,should:y,shadowParent:odt(C)};t.current.push(x),setTimeout(function(){t.current=t.current.filter(function(w){return w!==x})},1)},[]),u=h.useCallback(function(v){n.current=Kx(v),s.current=void 0},[]),p=h.useCallback(function(v){d(v.type,vG(v),v.target,l(v,e.lockRef.current))},[]),m=h.useCallback(function(v){d(v.type,Kx(v),v.target,l(v,e.lockRef.current))},[]);h.useEffect(function(){return Ap.push(o),e.setCallbacks({onScrollCapture:p,onWheelCapture:p,onTouchMoveCapture:m}),document.addEventListener("wheel",c,Ep),document.addEventListener("touchmove",c,Ep),document.addEventListener("touchstart",u,Ep),function(){Ap=Ap.filter(function(v){return v!==o}),document.removeEventListener("wheel",c,Ep),document.removeEventListener("touchmove",c,Ep),document.removeEventListener("touchstart",u,Ep)}},[]);var f=e.removeScrollBar,g=e.inert;return h.createElement(h.Fragment,null,g?h.createElement(o,{styles:ndt(i)}):null,f?h.createElement(qct,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function odt(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const adt=Lct(lme,idt);var pme=h.forwardRef(function(e,t){return h.createElement(Ak,Il({},e,{ref:t,sideCar:adt}))});pme.classNames=Ak.classNames;var rdt=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Pp=new WeakMap,Zx=new WeakMap,Xx={},wA=0,fme=function(e){return e&&(e.host||fme(e.parentNode))},ldt=function(e,t){return t.map(function(n){if(e.contains(n))return n;var s=fme(n);return s&&e.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},cdt=function(e,t,n,s){var i=ldt(t,Array.isArray(e)?e:[e]);Xx[n]||(Xx[n]=new WeakMap);var o=Xx[n],r=[],l=new Set,c=new Set(i),d=function(p){!p||l.has(p)||(l.add(p),d(p.parentNode))};i.forEach(d);var u=function(p){!p||c.has(p)||Array.prototype.forEach.call(p.children,function(m){if(l.has(m))u(m);else try{var f=m.getAttribute(s),g=f!==null&&f!=="false",v=(Pp.get(m)||0)+1,b=(o.get(m)||0)+1;Pp.set(m,v),o.set(m,b),r.push(m),v===1&&g&&Zx.set(m,!0),b===1&&m.setAttribute(n,"true"),g||m.setAttribute(s,"true")}catch(C){console.error("aria-hidden: cannot operate on ",m,C)}})};return u(t),l.clear(),wA++,function(){r.forEach(function(p){var m=Pp.get(p)-1,f=o.get(p)-1;Pp.set(p,m),o.set(p,f),m||(Zx.has(p)||p.removeAttribute(s),Zx.delete(p)),f||p.removeAttribute(n)}),wA--,wA||(Pp=new WeakMap,Pp=new WeakMap,Zx=new WeakMap,Xx={})}},ddt=function(e,t,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(e)?e:[e]),i=rdt(e);return i?(s.push.apply(s,Array.from(i.querySelectorAll("[aria-live], script"))),cdt(s,i,n,"aria-hidden")):function(){return null}},Pk="Dialog",[mme,M0t]=Wlt(Pk),[udt,sl]=mme(Pk),gme=e=>{const{__scopeDialog:t,children:n,open:s,defaultOpen:i,onOpenChange:o,modal:r=!0}=e,l=h.useRef(null),c=h.useRef(null),[d,u]=Xlt({prop:s,defaultProp:i??!1,onChange:o,caller:Pk});return a.jsx(udt,{scope:t,triggerRef:l,contentRef:c,contentId:Bc(),titleId:Bc(),descriptionId:Bc(),open:d,onOpenChange:u,onOpenToggle:h.useCallback(()=>u(p=>!p),[u]),modal:r,children:n})};gme.displayName=Pk;var vme="DialogTrigger",hdt=h.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,i=sl(vme,n),o=op(t,i.triggerRef);return a.jsx($i.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":Z8(i.open),...s,ref:o,onClick:qd(e.onClick,i.onOpenToggle)})});hdt.displayName=vme;var q8="DialogPortal",[pdt,yme]=mme(q8,{forceMount:void 0}),bme=e=>{const{__scopeDialog:t,forceMount:n,children:s,container:i}=e,o=sl(q8,t);return a.jsx(pdt,{scope:t,forceMount:n,children:h.Children.map(s,r=>a.jsx(Ek,{present:n||o.open,children:a.jsx(ame,{asChild:!0,container:i,children:r})}))})};bme.displayName=q8;var hw="DialogOverlay",xme=h.forwardRef((e,t)=>{const n=yme(hw,e.__scopeDialog),{forceMount:s=n.forceMount,...i}=e,o=sl(hw,e.__scopeDialog);return o.modal?a.jsx(Ek,{present:s||o.open,children:a.jsx(mdt,{...i,ref:t})}):null});xme.displayName=hw;var fdt=eme("DialogOverlay.RemoveScroll"),mdt=h.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,i=sl(hw,n);return a.jsx(pme,{as:fdt,allowPinchZoom:!0,shards:[i.contentRef],children:a.jsx($i.div,{"data-state":Z8(i.open),...s,ref:t,style:{pointerEvents:"auto",...s.style}})})}),Th="DialogContent",Cme=h.forwardRef((e,t)=>{const n=yme(Th,e.__scopeDialog),{forceMount:s=n.forceMount,...i}=e,o=sl(Th,e.__scopeDialog);return a.jsx(Ek,{present:s||o.open,children:o.modal?a.jsx(gdt,{...i,ref:t}):a.jsx(vdt,{...i,ref:t})})});Cme.displayName=Th;var gdt=h.forwardRef((e,t)=>{const n=sl(Th,e.__scopeDialog),s=h.useRef(null),i=op(t,n.contentRef,s);return h.useEffect(()=>{const o=s.current;if(o)return ddt(o)},[]),a.jsx(wme,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:qd(e.onCloseAutoFocus,o=>{o.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:qd(e.onPointerDownOutside,o=>{const r=o.detail.originalEvent,l=r.button===0&&r.ctrlKey===!0;(r.button===2||l)&&o.preventDefault()}),onFocusOutside:qd(e.onFocusOutside,o=>o.preventDefault())})}),vdt=h.forwardRef((e,t)=>{const n=sl(Th,e.__scopeDialog),s=h.useRef(!1),i=h.useRef(!1);return a.jsx(wme,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{e.onCloseAutoFocus?.(o),o.defaultPrevented||(s.current||n.triggerRef.current?.focus(),o.preventDefault()),s.current=!1,i.current=!1},onInteractOutside:o=>{e.onInteractOutside?.(o),o.defaultPrevented||(s.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const r=o.target;n.triggerRef.current?.contains(r)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}})}),wme=h.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:o,...r}=e,l=sl(Th,n),c=h.useRef(null),d=op(t,c);return kct(),a.jsxs(a.Fragment,{children:[a.jsx(ime,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:i,onUnmountAutoFocus:o,children:a.jsx(nme,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":Z8(l.open),...r,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),a.jsxs(a.Fragment,{children:[a.jsx(Cdt,{titleId:l.titleId}),a.jsx(_dt,{contentRef:c,descriptionId:l.descriptionId})]})]})}),K8="DialogTitle",ydt=h.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,i=sl(K8,n);return a.jsx($i.h2,{id:i.titleId,...s,ref:t})});ydt.displayName=K8;var _me="DialogDescription",bdt=h.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,i=sl(_me,n);return a.jsx($i.p,{id:i.descriptionId,...s,ref:t})});bdt.displayName=_me;var Sme="DialogClose",xdt=h.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,i=sl(Sme,n);return a.jsx($i.button,{type:"button",...s,ref:t,onClick:qd(e.onClick,()=>i.onOpenChange(!1))})});xdt.displayName=Sme;function Z8(e){return e?"open":"closed"}var kme="DialogTitleWarning",[L0t,Ime]=Hlt(kme,{contentName:Th,titleName:K8,docsSlug:"dialog"}),Cdt=({titleId:e})=>{const t=Ime(kme),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return h.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},wdt="DialogDescriptionWarning",_dt=({contentRef:e,descriptionId:t})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Ime(wdt).contentName}}.`;return h.useEffect(()=>{const i=e.current?.getAttribute("aria-describedby");t&&i&&(document.getElementById(t)||console.warn(s))},[s,e,t]),null},Sdt=gme,kdt=bme,Idt=xme,jdt=Cme,P0='[cmdk-group=""]',_A='[cmdk-group-items=""]',Edt='[cmdk-group-heading=""]',jme='[cmdk-item=""]',bG=`${jme}:not([aria-disabled="true"])`,CD="cmdk-item-select",Up="data-value",Adt=(e,t,n)=>Glt(e,t,n),Eme=h.createContext(void 0),lb=()=>h.useContext(Eme),Ame=h.createContext(void 0),X8=()=>h.useContext(Ame),Pme=h.createContext(void 0),Y8=h.forwardRef((e,t)=>{let n=qp(()=>{var W,R;return{search:"",value:(R=(W=e.value)!=null?W:e.defaultValue)!=null?R:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),s=qp(()=>new Set),i=qp(()=>new Map),o=qp(()=>new Map),r=qp(()=>new Set),l=Lme(e),{label:c,children:d,value:u,onValueChange:p,filter:m,shouldFilter:f,loop:g,disablePointerSelection:v=!1,vimBindings:b=!0,...C}=e,y=Bc(),x=Bc(),w=Bc(),_=h.useRef(null),S=Ndt();Dh(()=>{if(u!==void 0){let W=u.trim();n.current.value=W,I.emit()}},[u]),Dh(()=>{S(6,O)},[]);let I=h.useMemo(()=>({subscribe:W=>(r.current.add(W),()=>r.current.delete(W)),snapshot:()=>n.current,setState:(W,R,G)=>{var H,$,z,B;if(!Object.is(n.current[W],R)){if(n.current[W]=R,W==="search")D(),j(),S(1,P);else if(W==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let Y=document.getElementById(w);Y?Y.focus():(H=document.getElementById(y))==null||H.focus()}if(S(7,()=>{var Y;n.current.selectedItemId=(Y=N())==null?void 0:Y.id,I.emit()}),G||S(5,O),(($=l.current)==null?void 0:$.value)!==void 0){let Y=R??"";(B=(z=l.current).onValueChange)==null||B.call(z,Y);return}}I.emit()}},emit:()=>{r.current.forEach(W=>W())}}),[]),k=h.useMemo(()=>({value:(W,R,G)=>{var H;R!==((H=o.current.get(W))==null?void 0:H.value)&&(o.current.set(W,{value:R,keywords:G}),n.current.filtered.items.set(W,E(R,G)),S(2,()=>{j(),I.emit()}))},item:(W,R)=>(s.current.add(W),R&&(i.current.has(R)?i.current.get(R).add(W):i.current.set(R,new Set([W]))),S(3,()=>{D(),j(),n.current.value||P(),I.emit()}),()=>{o.current.delete(W),s.current.delete(W),n.current.filtered.items.delete(W);let G=N();S(4,()=>{D(),G?.getAttribute("id")===W&&P(),I.emit()})}),group:W=>(i.current.has(W)||i.current.set(W,new Set),()=>{o.current.delete(W),i.current.delete(W)}),filter:()=>l.current.shouldFilter,label:c||e["aria-label"],getDisablePointerSelection:()=>l.current.disablePointerSelection,listId:y,inputId:w,labelId:x,listInnerRef:_}),[]);function E(W,R){var G,H;let $=(H=(G=l.current)==null?void 0:G.filter)!=null?H:Adt;return W?$(W,n.current.search,R):0}function j(){if(!n.current.search||l.current.shouldFilter===!1)return;let W=n.current.filtered.items,R=[];n.current.filtered.groups.forEach(H=>{let $=i.current.get(H),z=0;$.forEach(B=>{let Y=W.get(B);z=Math.max(Y,z)}),R.push([H,z])});let G=_.current;F().sort((H,$)=>{var z,B;let Y=H.getAttribute("id"),ie=$.getAttribute("id");return((z=W.get(ie))!=null?z:0)-((B=W.get(Y))!=null?B:0)}).forEach(H=>{let $=H.closest(_A);$?$.appendChild(H.parentElement===$?H:H.closest(`${_A} > *`)):G.appendChild(H.parentElement===G?H:H.closest(`${_A} > *`))}),R.sort((H,$)=>$[1]-H[1]).forEach(H=>{var $;let z=($=_.current)==null?void 0:$.querySelector(`${P0}[${Up}="${encodeURIComponent(H[0])}"]`);z?.parentElement.appendChild(z)})}function P(){let W=F().find(G=>G.getAttribute("aria-disabled")!=="true"),R=W?.getAttribute(Up);I.setState("value",R||void 0)}function D(){var W,R,G,H;if(!n.current.search||l.current.shouldFilter===!1){n.current.filtered.count=s.current.size;return}n.current.filtered.groups=new Set;let $=0;for(let z of s.current){let B=(R=(W=o.current.get(z))==null?void 0:W.value)!=null?R:"",Y=(H=(G=o.current.get(z))==null?void 0:G.keywords)!=null?H:[],ie=E(B,Y);n.current.filtered.items.set(z,ie),ie>0&&$++}for(let[z,B]of i.current)for(let Y of B)if(n.current.filtered.items.get(Y)>0){n.current.filtered.groups.add(z);break}n.current.filtered.count=$}function O(){var W,R,G;let H=N();H&&(((W=H.parentElement)==null?void 0:W.firstChild)===H&&((G=(R=H.closest(P0))==null?void 0:R.querySelector(Edt))==null||G.scrollIntoView({block:"nearest"})),H.scrollIntoView({block:"nearest"}))}function N(){var W;return(W=_.current)==null?void 0:W.querySelector(`${jme}[aria-selected="true"]`)}function F(){var W;return Array.from(((W=_.current)==null?void 0:W.querySelectorAll(bG))||[])}function X(W){let R=F()[W];R&&I.setState("value",R.getAttribute(Up))}function L(W){var R;let G=N(),H=F(),$=H.findIndex(B=>B===G),z=H[$+W];(R=l.current)!=null&&R.loop&&(z=$+W<0?H[H.length-1]:$+W===H.length?H[0]:H[$+W]),z&&I.setState("value",z.getAttribute(Up))}function V(W){let R=N(),G=R?.closest(P0),H;for(;G&&!H;)G=W>0?Rdt(G,P0):Odt(G,P0),H=G?.querySelector(bG);H?I.setState("value",H.getAttribute(Up)):L(W)}let K=()=>X(F().length-1),U=W=>{W.preventDefault(),W.metaKey?K():W.altKey?V(1):L(1)},Z=W=>{W.preventDefault(),W.metaKey?X(0):W.altKey?V(-1):L(-1)};return h.createElement($i.div,{ref:t,tabIndex:-1,...C,"cmdk-root":"",onKeyDown:W=>{var R;(R=C.onKeyDown)==null||R.call(C,W);let G=W.nativeEvent.isComposing||W.keyCode===229;if(!(W.defaultPrevented||G))switch(W.key){case"n":case"j":{b&&W.ctrlKey&&U(W);break}case"ArrowDown":{U(W);break}case"p":case"k":{b&&W.ctrlKey&&Z(W);break}case"ArrowUp":{Z(W);break}case"Home":{W.preventDefault(),X(0);break}case"End":{W.preventDefault(),K();break}case"Enter":{W.preventDefault();let H=N();if(H){let $=new Event(CD);H.dispatchEvent($)}}}}},h.createElement("label",{"cmdk-label":"",htmlFor:k.inputId,id:k.labelId,style:Bdt},c),Tk(e,W=>h.createElement(Ame.Provider,{value:I},h.createElement(Eme.Provider,{value:k},W))))}),Tme=h.forwardRef((e,t)=>{var n,s;let i=Bc(),o=h.useRef(null),r=h.useContext(Pme),l=lb(),c=Lme(e),d=(s=(n=c.current)==null?void 0:n.forceMount)!=null?s:r?.forceMount;Dh(()=>{if(!d)return l.item(i,r?.id)},[d]);let u=Rme(i,o,[e.value,e.children,o],e.keywords),p=X8(),m=lu(S=>S.value&&S.value===u.current),f=lu(S=>d||l.filter()===!1?!0:S.search?S.filtered.items.get(i)>0:!0);h.useEffect(()=>{let S=o.current;if(!(!S||e.disabled))return S.addEventListener(CD,g),()=>S.removeEventListener(CD,g)},[f,e.onSelect,e.disabled]);function g(){var S,I;v(),(I=(S=c.current).onSelect)==null||I.call(S,u.current)}function v(){p.setState("value",u.current,!0)}if(!f)return null;let{disabled:b,value:C,onSelect:y,forceMount:x,keywords:w,..._}=e;return h.createElement($i.div,{ref:Ph(o,t),..._,id:i,"cmdk-item":"",role:"option","aria-disabled":!!b,"aria-selected":!!m,"data-disabled":!!b,"data-selected":!!m,onPointerMove:b||l.getDisablePointerSelection()?void 0:v,onClick:b?void 0:g},e.children)}),Pdt=h.forwardRef((e,t)=>{let{heading:n,children:s,forceMount:i,...o}=e,r=Bc(),l=h.useRef(null),c=h.useRef(null),d=Bc(),u=lb(),p=lu(f=>i||u.filter()===!1?!0:f.search?f.filtered.groups.has(r):!0);Dh(()=>u.group(r),[]),Rme(r,l,[e.value,e.heading,c]);let m=h.useMemo(()=>({id:r,forceMount:i}),[i]);return h.createElement($i.div,{ref:Ph(l,t),...o,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},n&&h.createElement("div",{ref:c,"cmdk-group-heading":"","aria-hidden":!0,id:d},n),Tk(e,f=>h.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?d:void 0},h.createElement(Pme.Provider,{value:m},f))))}),Tdt=h.forwardRef((e,t)=>{let{alwaysRender:n,...s}=e,i=h.useRef(null),o=lu(r=>!r.search);return!n&&!o?null:h.createElement($i.div,{ref:Ph(i,t),...s,"cmdk-separator":"",role:"separator"})}),Ddt=h.forwardRef((e,t)=>{let{onValueChange:n,...s}=e,i=e.value!=null,o=X8(),r=lu(d=>d.search),l=lu(d=>d.selectedItemId),c=lb();return h.useEffect(()=>{e.value!=null&&o.setState("search",e.value)},[e.value]),h.createElement($i.input,{ref:t,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":c.listId,"aria-labelledby":c.labelId,"aria-activedescendant":l,id:c.inputId,type:"text",value:i?e.value:r,onChange:d=>{i||o.setState("search",d.target.value),n?.(d.target.value)}})}),Dme=h.forwardRef((e,t)=>{let{children:n,label:s="Suggestions",...i}=e,o=h.useRef(null),r=h.useRef(null),l=lu(d=>d.selectedItemId),c=lb();return h.useEffect(()=>{if(r.current&&o.current){let d=r.current,u=o.current,p,m=new ResizeObserver(()=>{p=requestAnimationFrame(()=>{let f=d.offsetHeight;u.style.setProperty("--cmdk-list-height",f.toFixed(1)+"px")})});return m.observe(d),()=>{cancelAnimationFrame(p),m.unobserve(d)}}},[]),h.createElement($i.div,{ref:Ph(o,t),...i,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":l,"aria-label":s,id:c.listId},Tk(e,d=>h.createElement("div",{ref:Ph(r,c.listInnerRef),"cmdk-list-sizer":""},d)))}),Mdt=h.forwardRef((e,t)=>{let{open:n,onOpenChange:s,overlayClassName:i,contentClassName:o,container:r,...l}=e;return h.createElement(Sdt,{open:n,onOpenChange:s},h.createElement(kdt,{container:r},h.createElement(Idt,{"cmdk-overlay":"",className:i}),h.createElement(jdt,{"aria-label":e.label,"cmdk-dialog":"",className:o},h.createElement(Y8,{ref:t,...l}))))}),Mme=h.forwardRef((e,t)=>lu(n=>n.filtered.count===0)?h.createElement($i.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),Ldt=h.forwardRef((e,t)=>{let{progress:n,children:s,label:i="Loading...",...o}=e;return h.createElement($i.div,{ref:t,...o,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":i},Tk(e,r=>h.createElement("div",{"aria-hidden":!0},r)))});Object.assign(Y8,{List:Dme,Item:Tme,Input:Ddt,Group:Pdt,Separator:Tdt,Dialog:Mdt,Empty:Mme,Loading:Ldt});function Rdt(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}}function Odt(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function Lme(e){let t=h.useRef(e);return Dh(()=>{t.current=e}),t}var Dh=typeof window>"u"?h.useEffect:h.useLayoutEffect;function qp(e){let t=h.useRef();return t.current===void 0&&(t.current=e()),t}function lu(e){let t=X8(),n=()=>e(t.snapshot());return h.useSyncExternalStore(t.subscribe,n,n)}function Rme(e,t,n,s=[]){let i=h.useRef(),o=lb();return Dh(()=>{var r;let l=(()=>{var d;for(let u of n){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(d=u.current.textContent)==null?void 0:d.trim():i.current}})(),c=s.map(d=>d.trim());o.value(e,l,c),(r=t.current)==null||r.setAttribute(Up,l),i.current=l}),i}var Ndt=()=>{let[e,t]=h.useState(),n=qp(()=>new Map);return Dh(()=>{n.current.forEach(s=>s()),n.current=new Map},[e]),(s,i)=>{n.current.set(s,i),t({})}};function Fdt(e){let t=e.type;return typeof t=="function"?t(e.props):"render"in t?t.render(e.props):e}function Tk({asChild:e,children:t},n){return e&&h.isValidElement(t)?h.cloneElement(Fdt(t),{ref:t.ref},n(t.props.children)):n(t)}var Bdt={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const zdt=e=>{const t=Kd();return{...lM,id:t,type:"current_image",position:e,data:{id:t,type:"current_image",isOpen:!0,label:"Current Image"}}},Vdt=e=>{const t=Kd();return{...lM,id:t,type:"notes",position:e,data:{id:t,isOpen:!0,label:"Notes",notes:"",type:"notes"}}},$dt=()=>{const e=le(ni);return h.useCallback(t=>{const n=sv.get();ae(n!==null);let s=window.innerWidth/2,i=window.innerHeight/2;const o=document.querySelector("#workflow-editor")?.getBoundingClientRect();o&&(s=o.width/2-Qd/2+o.left,i=o.height/2-Qd/2+o.top);const r=n.screenToFlowPosition({x:s,y:i});if(t==="current_image")return zdt(r);if(t==="notes")return Vdt(r);const l=e[t];return ZX(r,l)},[e])},Ome=(e,t,n)=>{let s=t,i=n;for(;e.find(o=>o.position.x===s&&o.position.y===i);)s=Math.floor(s+50),i=Math.floor(i+50);return{x:s,y:i}},Nme=(e,t)=>{const n="originalType"in e?zc(e,"originalType"):e,s="originalType"in t?zc(t,"originalType"):t,i="originalType"in e?e.originalType:null,o="originalType"in t?t.originalType:null;return!!(yo(n,s)||o&&yo(n,o)||i&&yo(i,s)||i&&o&&yo(i,o))},Gdt=(e,t,n,s)=>{const i=n.find(c=>c.target===s&&c.targetHandle==="item");if(!i?.sourceHandle)return null;const o=t.find(c=>c.id===i.source);if(!o)return null;const r=e[o.data.type];if(!r)return null;const l=r.outputs[i.sourceHandle];return l?l.type:null};var Hdt=cr();const xG=Xf(Hdt),Wdt=(e,t,n,s)=>{const i=new xG.Graph;return n.forEach(o=>{i.setNode(o.id)}),s.forEach(o=>{i.setEdge(o.source,o.target)}),i.setEdge(e,t),!xG.alg.isAcyclic(i)},Fme=(e,t)=>{if(Nme(e,t))return!0;if(e.batch!==t.batch)return!1;const n=e.name==="CollectionItemField"&&!Mp(t),s=Tb(e)&&t.name==="CollectionItemField",i=xd(t)&&e.name===t.name,o=e.name==="CollectionField"&&!Tb(t),r=t.name==="CollectionField"&&Mp(e),l=Tb(e),c=Tb(t),d=l&&c,u=l&&xd(t),p=Mp(e)&&Mp(t),m=Mp(e)&&xd(t),f=xd(e)&&xd(t),g=d||p||m||f||u,v=e.name==="IntegerField"&&t.name==="FloatField",b=e.name==="IntegerField"&&t.name==="StringField",C=e.name==="FloatField"&&t.name==="StringField",y=g&&(v||b||C),x=t.name==="AnyField";return n||s||i||o||r||y||x},Udt=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle&&t.source===e.source&&t.sourceHandle===e.sourceHandle,qdt=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle,cb=(e,t,n,s,i,o=!0)=>{if(e.source===e.target)return"nodes.cannotConnectToSelf";if(o){const r=n.filter(f=>f.id!==i?.id);if(r.some(Udt(e)))return"nodes.cannotDuplicateConnection";const l=t.find(f=>f.id===e.source);if(!l)return"nodes.missingNode";const c=t.find(f=>f.id===e.target);if(!c)return"nodes.missingNode";const d=s[l.data.type];if(!d)return"nodes.missingInvocationTemplate";const u=s[c.data.type];if(!u)return"nodes.missingInvocationTemplate";const p=d.outputs[e.sourceHandle];if(!p)return"nodes.missingFieldTemplate";const m=u.inputs[e.targetHandle];if(!m)return"nodes.missingFieldTemplate";if(m.input==="direct")return"nodes.cannotConnectToDirectInput";if(c.data.type==="collect"&&e.targetHandle==="item"){const f=Gdt(s,t,n,c.id);if(f&&!Nme(p.type,f))return"nodes.cannotMixAndMatchCollectionItemTypes"}if(r.find(qdt(e))&&m.type.name!=="CollectionItemField")return"nodes.inputMayOnlyHaveOneConnection";if(!Fme(p.type,m.type))return"nodes.fieldTypesMustMatch"}return Wdt(e.source,e.target,t,n)?"nodes.connectionWouldCreateCycle":null},Bme=(e,t,n,s,i,o,r,l)=>{if(e===n)return null;if(t&&s)return{source:e,sourceHandle:t,target:n,targetHandle:s};if(t&&!s){const d=Kdt(e,t,n,i,o,r,l)[0];return d?{source:e,sourceHandle:t,target:n,targetHandle:d.name}:null}if(!t&&s){const d=Zdt(n,s,e,i,o,r,l)[0];return d?{source:e,sourceHandle:d.name,target:n,targetHandle:s}:null}return null},Kdt=(e,t,n,s,i,o,r)=>{const l=s.find(f=>f.id===e),c=s.find(f=>f.id===n);if(!l||!c)return[];const d=o[l.data.type],u=o[c.data.type];return!d||!u?[]:d.outputs[t]?Wr(u.inputs).filter(f=>{const g={source:e,sourceHandle:t,target:n,targetHandle:f.name};return cb(g,s,i,o,r,!0)===null}):[]},Zdt=(e,t,n,s,i,o,r)=>{const l=s.find(f=>f.id===e),c=s.find(f=>f.id===n);if(!c||!l)return[];const d=o[c.data.type],u=o[l.data.type];return!d||!u?[]:u.inputs[t]?Wr(d.outputs).filter(f=>{const g={source:n,sourceHandle:f.name,target:e,targetHandle:t};return cb(g,s,i,o,r,!0)===null}):[]},Xdt=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:i}=e;return`reactflow__edge-${t}${n||""}-${s}${i||""}`},pw=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:i}=e;return ae(t&&n&&s&&i,"Invalid connection"),{source:t,sourceHandle:n,target:s,targetHandle:i,id:Xdt({source:t,sourceHandle:n,target:s,targetHandle:i})}},Ydt=()=>{const{t:e}=T(),t=Ze(),n=$dt(),s=le(ni),i=le(pa);return h.useCallback(r=>{const l=n(r);if(!l){const f=e("nodes.unknownNode",{nodeType:r});pe({status:"error",title:f});return}const c=qM.get(),{nodes:d,edges:u}=Xn(t.getState());l.position=Ome(d,c?.x??l.position.x,c?.y??l.position.y),l.selected=!0;const p=[{type:"add",item:l}],m=[];if(d.forEach(({id:f,selected:g})=>{g&&p.push({type:"select",id:f,selected:!1})}),u.forEach(({id:f,selected:g})=>{g&&m.push({type:"select",id:f,selected:!1})}),p.length>0&&t.dispatch(gh(p)),m.length>0&&t.dispatch(Ml(m)),i&&eo(l)){const f=vh.get(),{handleType:g}=i,v=g==="source"?i.nodeId:l.id,b=g==="source"?i.handleId:null,C=g==="target"?i.nodeId:l.id,y=g==="target"?i.handleId:null,{nodes:x,edges:w}=Xn(t.getState()),_=Bme(v,b,C,y,x,w,s,f);if(_){const S=pw(_);t.dispatch(Ml([{type:"add",item:S}]))}}},[n,i,t,e,s])},Qdt={"[cmdk-root]":{w:"full",h:"full"},"[cmdk-list]":{w:"full",h:"full"}},zme=h.memo(()=>{const{t:e}=T(),t=h.useRef(null),[n,s]=h.useState(""),i=Ydt(),o=M(un),[r]=el(n,300),l=le(ff),c=h.useCallback(()=>{ff.set(!0)},[]),d=h.useCallback(()=>{ff.set(!1)},[]);Be({id:"addNode",category:"workflows",callback:c,options:{enabled:o==="workflows",preventDefault:!0},dependencies:[c,o]});const u=h.useCallback(f=>{s(f.target.value)},[]),p=h.useCallback(()=>{d(),s(""),pa.set(null)},[d]),m=h.useCallback(f=>{i(f),p()},[i,p]);return a.jsxs(Zo,{isOpen:l,onClose:p,useInert:!1,initialFocusRef:t,size:"xl",isCentered:!0,children:[a.jsx(ro,{}),a.jsx(Xo,{h:"512",maxH:"70%",children:a.jsx(vi,{p:2,h:"full",sx:Qdt,children:a.jsx(Y8,{loop:!0,shouldFilter:!1,children:a.jsxs(A,{flexDir:"column",h:"full",gap:2,children:[a.jsx(Nt,{ref:t,value:n,onChange:u,placeholder:e("nodes.nodeSearch")}),a.jsx(ke,{w:"full",h:"full",children:a.jsxs(Hs,{children:[a.jsx(Mme,{children:a.jsx(On,{position:"absolute",top:0,right:0,bottom:0,left:0,icon:null,label:"No matching items"})}),a.jsx(Dme,{children:a.jsx(Vme,{searchTerm:r,onSelect:m})})]})})]})})})})]})});zme.displayName="AddNodeCmdk";const Jdt={'&[data-selected="true"]':{bg:"base.700"}},eut=Ut(ni,e=>Object.values(e).filter(t=>t.classification!=="deprecated")),tut=I_(e=>new RegExp(e.trim().replace(/[-[\]{}()*+!<=:?./\\^$|#,]/g,"").split(" ").join(".*"),"gi")),SA=I_((e,t)=>{const n=tut(t);if(!t||e.title.includes(t)||n.test(e.title)||e.type.includes(t)||n.test(e.type)||e.description.includes(t)||n.test(e.description)||e.nodePack.includes(t)||n.test(e.nodePack)||e.classification.includes(t)||n.test(e.classification))return!0;for(const s of e.tags)if(s.includes(t)||n.test(s))return!0;return!1},(e,t)=>`${e.type}-${t}`),Vme=h.memo(({searchTerm:e,onSelect:t})=>{const{t:n}=T(),s=le(eut),i=le(pa),o=h.useMemo(()=>({type:"current_image",title:n("nodes.currentImage"),description:n("nodes.currentImageDescription"),tags:["progress","image","current"],classification:"stable",nodePack:"invokeai"}),[n]),r=h.useMemo(()=>({type:"notes",title:n("nodes.notes"),description:n("nodes.notesDescription"),tags:["notes"],classification:"stable",nodePack:"invokeai"}),[n]),l=h.useMemo(()=>{const c=[];if(i){for(const d of s)if(SA(d,e)){const u=i.handleType==="source"?d.inputs:d.outputs;for(const[p,m]of Gr(u)){const f=i.handleType==="source"?i.fieldTemplate.type:m.type,g=i.handleType==="target"?i.fieldTemplate.type:m.type;if(Fme(f,g)){c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack});break}}}}else{for(const d of s)SA(d,e)&&c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack});for(const d of[o,r])SA(d,e)&&c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack})}return c},[i,s,e,o,r]);return a.jsx(a.Fragment,{children:l.map(c=>a.jsx(Tme,{value:c.value,onSelect:t,asChild:!0,children:a.jsxs(A,{role:"button",flexDir:"column",sx:Jdt,py:1,px:2,borderRadius:"base",children:[a.jsxs(A,{alignItems:"center",gap:2,children:[c.classification==="beta"&&a.jsx(Je,{boxSize:4,color:"invokeYellow.300",as:lX}),c.classification==="prototype"&&a.jsx(Je,{boxSize:4,color:"invokeRed.300",as:G4}),c.classification==="internal"&&a.jsx(Je,{boxSize:4,color:"invokePurple.300",as:sX}),c.classification==="special"&&a.jsx(Je,{boxSize:4,color:"invokeGreen.300",as:tS}),a.jsx(q,{fontWeight:"semibold",children:c.label}),a.jsx(At,{}),a.jsx(q,{variant:"subtext",fontWeight:"semibold",children:c.nodePack})]}),c.description&&a.jsx(q,{color:"base.200",children:c.description})]})},c.value))})});Vme.displayName="CommandListItems";const nut=Yn(Xn,e=>({name:e.name,description:e.description,notes:e.notes,author:e.author,tags:e.tags})),sut=()=>{const{name:e,description:t,notes:n,author:s,tags:i}=M(nut),{t:o}=T();return a.jsxs(A,{flexDir:"column",gap:"2",children:[!!e.length&&a.jsxs(ke,{children:[a.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowName")}),a.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:e})]}),!!s.length&&a.jsxs(ke,{children:[a.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowAuthor")}),a.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:s})]}),!!i.length&&a.jsxs(ke,{children:[a.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowTags")}),a.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:i})]}),!!t.length&&a.jsxs(ke,{children:[a.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowDescription")}),a.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:t})]}),!!n.length&&a.jsxs(ke,{children:[a.jsx(q,{fontWeight:"semibold",children:o("nodes.workflowNotes")}),a.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:n})]})]})},iut=h.memo(sut),$me=()=>{const e=le(ni),t=h.useMemo(()=>ve(Uo,s=>s.some(i=>{if(!eo(i))return!1;const o=e[i.data.type];return o?g1(i.data,o):!1})),[e]);return M(t)},out=()=>{const{t:e}=T();return a.jsx(A,{flexDir:"column",gap:"2",children:a.jsxs(A,{flexDir:"column",gap:"2",children:[a.jsx(q,{fontWeight:"semibold",children:e("toast.loadedWithWarnings")}),a.jsxs(A,{flexDir:"column",children:[a.jsxs(q,{children:[e("common.toResolve"),":"]}),a.jsxs(q,{children:[e("nodes.editMode")," >> ",e("nodes.updateAllNodes")," >> ",e("common.save")]})]})]})})},aut=()=>$me()?a.jsx(He,{label:a.jsx(out,{}),children:a.jsx(A,{h:"full",alignItems:"center",gap:"2",children:a.jsx(Je,{color:"warning.400",as:jm})})}):a.jsx(a.Fragment,{}),rut=()=>{const{t:e}=T(),t=M(w_),n=_m(),s=M(Zc);return a.jsxs(A,{gap:"1",alignItems:"center",children:[t.length?a.jsx(He,{label:a.jsx(iut,{}),placement:"top",children:a.jsx(q,{fontSize:"lg",userSelect:"none",noOfLines:1,wordBreak:"break-all",fontWeight:"semibold",children:t})}):a.jsx(q,{fontSize:"lg",fontStyle:"italic",fontWeight:"semibold",children:e("workflows.unnamedWorkflow")}),n&&s==="edit"&&a.jsx(He,{label:e("nodes.newWorkflowDesc2"),children:a.jsx(A,{children:a.jsx(Je,{as:DMe,boxSize:"20px",color:"invokeYellow.500"})})}),a.jsx(aut,{})]})},Gme=h.memo(()=>{const e=M(w_);return a.jsx(A,{gap:2,top:2,left:"50%",transform:"translateX(-50%)",position:"absolute",pointerEvents:"none",children:!!e.length&&a.jsx(rut,{})})});Gme.displayName="TopCenterPanel";const lut=()=>{const{t:e}=T(),t=h.useCallback(()=>{ff.set(!0)},[]);return a.jsx(oe,{tooltip:e("nodes.addNodeToolTip"),"aria-label":e("nodes.addNode"),icon:a.jsx(Sn,{}),onClick:t,pointerEvents:"auto"})},cut=h.memo(lut),dut=Ft("workflows").child({filePath:"features/nodes/components/flow/panels/TopPanel/UpdateNodesButton.tsx"}),uut=()=>{const e=Ze(),{t}=T();return h.useCallback(()=>{const s=Uo(e.getState()),i=ni.get();let o=0;s.filter(eo).forEach(r=>{const l=i[r.data.type];if(!l){o++;return}if(g1(r.data,l))try{const c=XX(r,l);e.dispatch(gh([{type:"remove",id:c.id},{type:"add",item:c}]))}catch(c){c instanceof SH&&o++}}),o?(dut.warn(t("nodes.unableToUpdateNodes",{count:o})),pe({id:"UNABLE_TO_UPDATE_NODES",title:t("nodes.unableToUpdateNodes",{count:o})})):pe({id:"ALL_NODES_UPDATED",title:t("nodes.allNodesUpdated"),status:"success"})},[e,t])},hut=()=>{const{t:e}=T(),t=$me(),n=uut();return t?a.jsx(oe,{tooltip:e("nodes.updateAllNodes"),"aria-label":e("nodes.updateAllNodes"),icon:a.jsx(jm,{}),onClick:n,pointerEvents:"auto",colorScheme:"warning"}):null},put=h.memo(hut),Hme=h.memo(()=>a.jsx(A,{gap:2,top:2,left:2,position:"absolute",alignItems:"flex-start",pointerEvents:"none",children:a.jsxs(A,{gap:"2",children:[a.jsx(cut,{}),a.jsx(put,{})]})}));Hme.displayName="TopLeftPanel";const fut=()=>{const e=Q(),{t}=T(),{isOpen:n,onOpen:s,onClose:i}=jo(),o=_m(),r=h.useCallback(()=>{e(uW()),pe({id:"WORKFLOW_CLEARED",title:t("workflows.workflowCleared"),status:"success"}),i()},[e,i,t]),l=h.useCallback(()=>{if(o){r();return}s()},[o,r,s]);return a.jsxs(a.Fragment,{children:[a.jsx(oe,{tooltip:t("nodes.clearWorkflow"),"aria-label":t("nodes.clearWorkflow"),icon:a.jsx(Y4,{}),onClick:l,pointerEvents:"auto"}),a.jsx(Ko,{isOpen:n,onClose:i,title:t("nodes.clearWorkflow"),acceptCallback:r,useInert:!1,children:a.jsxs(A,{flexDir:"column",gap:2,children:[a.jsx(q,{children:t("nodes.clearWorkflowDesc")}),a.jsx(q,{variant:"subtext",children:t("nodes.clearWorkflowDesc2")})]})})]})},mut=h.memo(fut),gut=e=>!!e.id&&e.meta.category!=="default",vut=()=>{const{t:e}=T(),t=Q(),n=aee(),[s,{isLoading:i,isError:o}]=eDe(),r=tm(),l=h.useRef();return{saveWorkflow:h.useCallback(async d=>{l.current=r({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{await s(d).unwrap(),t(D8e()),t(bW({formFieldInitialValues:n()})),r.update(l.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{r.isActive(`auth-error-toast-${d1.endpoints.updateWorkflow.name}`)?r.close(l.current):r.update(l.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0})}},[r,e,t,n,s]),isLoading:i,isError:o}},Q8=()=>{const e=a4(),{saveWorkflow:t}=vut();return h.useCallback(()=>{const s=e();gut(s)?t(s):ree(s)},[e,t])},yut=()=>{const{t:e}=T(),t=_m(),n=Q8();return a.jsx(oe,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:a.jsx(Ol,{}),isDisabled:!t,onClick:n,pointerEvents:"auto"})},but=h.memo(yut),xut=()=>{const{t:e}=T(),[t]=Z_e(),n=h.useCallback(()=>{t()},[t]);return a.jsx(he,{leftIcon:a.jsx(PDe,{}),tooltip:e("nodes.reloadNodeTemplates"),"aria-label":e("nodes.reloadNodeTemplates"),onClick:n,children:e("nodes.reloadNodeTemplates")})},Cut=h.memo(xut),wut={flexGrow:1},[Wme]=qh(!1),_ut=()=>{const e=Q(),t=Wme(),n=M(_q),s=M(Sq),i=M(kq),o=M(__),r=M(Iq),l=M(jq),c=h.useCallback(v=>{e(X_e(v.target.checked))},[e]),d=h.useCallback(v=>{e(Y_e(v.target.checked))},[e]),u=h.useCallback(v=>{e(Q_e(v.target.checked))},[e]),p=h.useCallback(v=>{e(J_e(v.target.checked))},[e]),m=h.useCallback(v=>{e(eSe(v.target.checked))},[e]),f=h.useCallback(v=>{e(tSe(v.target.checked))},[e]),{t:g}=T();return a.jsxs(Zo,{isOpen:t.isTrue,onClose:t.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[a.jsx(ro,{}),a.jsxs(Xo,{children:[a.jsx(lo,{children:g("nodes.workflowSettings")}),a.jsx(Yr,{}),a.jsx(vi,{children:a.jsxs(A,{flexDirection:"column",gap:4,py:4,children:[a.jsx(Pt,{size:"sm",children:g("parameters.general")}),a.jsxs(Ys,{orientation:"vertical",formLabelProps:wut,children:[a.jsxs(te,{children:[a.jsxs(A,{w:"full",children:[a.jsx(ne,{children:g("nodes.animatedEdges")}),a.jsx(mt,{onChange:d,isChecked:o})]}),a.jsx(Vo,{children:g("nodes.animatedEdgesHelp")})]}),a.jsx(vt,{}),a.jsxs(te,{children:[a.jsxs(A,{w:"full",children:[a.jsx(ne,{children:g("nodes.snapToGrid")}),a.jsx(mt,{isChecked:n,onChange:u})]}),a.jsx(Vo,{children:g("nodes.snapToGridHelp")})]}),a.jsx(vt,{}),a.jsxs(te,{children:[a.jsxs(A,{w:"full",children:[a.jsx(ne,{children:g("nodes.colorCodeEdges")}),a.jsx(mt,{isChecked:i,onChange:p})]}),a.jsx(Vo,{children:g("nodes.colorCodeEdgesHelp")})]}),a.jsx(vt,{}),a.jsxs(te,{children:[a.jsxs(A,{w:"full",children:[a.jsx(ne,{children:g("nodes.fullyContainNodes")}),a.jsx(mt,{isChecked:s===nP.Full,onChange:m})]}),a.jsx(Vo,{children:g("nodes.fullyContainNodesHelp")})]}),a.jsx(vt,{}),a.jsxs(te,{children:[a.jsxs(A,{w:"full",children:[a.jsx(ne,{children:g("nodes.showEdgeLabels")}),a.jsx(mt,{isChecked:r,onChange:f})]}),a.jsx(Vo,{children:g("nodes.showEdgeLabelsHelp")})]}),a.jsx(vt,{}),a.jsx(Pt,{size:"sm",pt:4,children:g("common.advanced")}),a.jsxs(te,{children:[a.jsxs(A,{w:"full",children:[a.jsx(ne,{children:g("nodes.validateConnections")}),a.jsx(mt,{isChecked:l,onChange:c})]}),a.jsx(Vo,{children:g("nodes.validateConnectionsHelp")})]}),a.jsx(vt,{})]}),a.jsx(Cut,{})]})})]})]})},Sut=h.memo(_ut),Ume=h.memo(()=>{const e=Wme(),{t}=T();return a.jsxs(A,{gap:2,top:2,right:2,position:"absolute",alignItems:"flex-end",pointerEvents:"none",children:[a.jsx(mut,{}),a.jsx(but,{}),a.jsx(oe,{pointerEvents:"auto","aria-label":t("workflows.workflowEditorMenu"),icon:a.jsx(f1,{}),onClick:e.setTrue})]})});Ume.displayName="TopRightPanel";const O2=De(null),J8=e=>{const[t,n]=h.useState(!1);h.useEffect(()=>O2.subscribe(r=>{n(r===e)}),[t,e]);const s=h.useCallback(()=>{O2.set(e)},[e]),i=h.useCallback(()=>{O2.set(null)},[]);return{isMouseOverNode:t,handleMouseOver:s,handleMouseOut:i}},kA=De(null),eL=e=>{const[t,n]=h.useState(!1);h.useEffect(()=>kA.subscribe(r=>{n(r===e)}),[t,e]);const s=h.useCallback(()=>{kA.set(e)},[e]),i=h.useCallback(()=>{kA.set(null)},[]);return{isMouseOverFormField:t,handleMouseOver:s,handleMouseOut:i}},kut=()=>{const e=Ze(),t=le(ni),n=KM(),s=h.useCallback((l,{nodeId:c,handleId:d,handleType:u})=>{ae(c&&d&&u,"Invalid connection start event");const m=Uo(e.getState()).find(b=>b.id===c);if(!m)return;const f=t[m.data.type];if(!f)return;const v=f[u==="source"?"outputs":"inputs"][d];v&&pa.set({nodeId:c,handleId:d,handleType:u,fieldTemplate:v})},[e,t]),i=h.useCallback(l=>{const{dispatch:c}=e,d=pw(l);c(Ml([{type:"add",item:d}])),n([d.source,d.target]),pa.set(null)},[e,n]),o=h.useCallback(()=>{const{dispatch:l}=e,c=pa.get(),d=vh.get(),u=O2.get();if(d&&!u||Zp.get()){pa.set(null);return}if(!c)return;const{nodes:p,edges:m}=Xn(e.getState());if(u){const{handleType:f}=c,g=f==="source"?c.nodeId:u,v=f==="source"?c.handleId:null,b=f==="target"?c.nodeId:u,C=f==="target"?c.handleId:null,y=Bme(g,v,b,C,p,m,t,d);if(y){const x=pw(y),w=[{type:"add",item:x}],_=[x.source,x.target];d&&(Zp.set(!0),w.push({type:"remove",id:d.id}),_.push(d.source,d.target)),l(Ml(w)),n(_)}pa.set(null)}else ff.set(!0)},[e,t,n]);return h.useMemo(()=>({onConnectStart:s,onConnect:i,onConnectEnd:o}),[s,i,o])},Iut=()=>{const e=Ze(),t=le(ni),n=M(jq);return h.useCallback(({source:i,sourceHandle:o,target:r,targetHandle:l})=>{if(!(i&&o&&r&&l))return!1;const c=vh.get(),{nodes:d,edges:u}=Xn(e.getState());return cb({source:i,sourceHandle:o,target:r,targetHandle:l},d,u,t,c,n)===null},[t,n,e])},Yx=Ft("workflows").child({filePath:"features/nodes/hooks/useNodeCopyPaste.ts"}),jut=()=>{const{getState:e}=uu(),{nodes:t,edges:n}=Xn(e()),s=t.filter(r=>r.selected),i=n.filter(r=>r.selected),o=n.filter(r=>s.some(l=>l.id===r.target));Eq.set(s),Aq.set(i),Pq.set(o)},qme=e=>{const{getState:t,dispatch:n}=uu(),{nodes:s,edges:i}=Xn(t()),o=ni.get(),r=qM.get(),l=It(Eq.get());let c=It(Aq.get());if(e){const x=It(Pq.get());c=fK([...c,...x],yo)}const d=l.map(x=>x.position.x),u=l.map(x=>x.position.y),p=Math.min(...d),m=Math.min(...u),f=r?r.x-p:50,g=r?r.y-m:50;l.forEach(x=>{const{x:w,y:_}=Ome(s,x.position.x+f,x.position.y+g);x.position.x=w,x.position.y=_,x.selected=!0;const S=Kd();for(const I of c)I.source===x.id?I.source=S:I.target===x.id&&(I.target=S);x.id=S,x.data.id=S}),c.forEach(x=>{x.id=Kd()});const v=[],b=[];s.forEach(({id:x,selected:w})=>{w&&v.push({type:"select",id:x,selected:!1})}),l.forEach(x=>{v.push({type:"add",item:x})}),i.forEach(({id:x,selected:w})=>{w&&b.push({type:"select",id:x,selected:!1})});const C=[...s,...l],y=[...i];c.forEach(x=>{if(x.type==="collapsed"){const{type:w,source:_,target:S}=x;if(C.find(I=>I.id===x.source)===void 0||C.find(I=>I.id===x.target)===void 0){Yx.warn({edge:{type:w,source:_,target:S}},`Invalid collapsed edge, cannot paste: ${ye("nodes.missingSourceOrTargetNode")}`);return}}else if(x.type==="default"){const{type:w,source:_,sourceHandle:S,target:I,targetHandle:k}=x;if(!S||!k){Yx.warn({edge:{type:w,source:_,sourceHandle:S,target:I,targetHandle:k}},`Invalid edge, cannot paste: ${ye("nodes.missingSourceOrTargetHandle")}`);return}const E=cb({source:_,sourceHandle:S,target:I,targetHandle:k},C,y,o,null,!0);if(E!==null){Yx.warn({edge:{source:_,sourceHandle:S,target:I,targetHandle:k}},`Invalid edge, cannot paste: ${ye(E)}`);return}}else{const{type:w}=x;Yx.warn({edge:{type:w}},"Invalid edge type, cannot paste");return}b.push({type:"add",item:x}),y.push(x)}),v.length>0&&n(gh(v)),b.length>0&&n(Ml(b))},Eut=()=>{qme(!1)},Aut=()=>{qme(!0)},Put={copySelection:jut,pasteSelection:Eut,pasteSelectionWithEdges:Aut},Tut=()=>Put,Dk=e=>{if(!e)return Nr("base.500");const t=nSe[e.name];return Nr(t||"base.500")},Dut={opacity:.8},Mut=({fromX:e,fromY:t,fromPosition:n,toX:s,toY:i,toPosition:o})=>{const r=le(pa),l=M(kq),c=M(__),d=h.useMemo(()=>l&&r?Dk(r.fieldTemplate.type):Nr("base.500"),[r,l]),u=h.useMemo(()=>c?"react-flow__custom_connection-path animated":"react-flow__custom_connection-path",[c]),p={sourceX:e,sourceY:t,sourcePosition:n,targetX:s,targetY:i,targetPosition:o},[m]=ZM(p);return a.jsx("g",{children:a.jsx("path",{fill:"none",stroke:d,strokeWidth:2,className:u,d:m,style:Dut})})},Lut=h.memo(Mut),Kme=(e,t)=>ve(Uo,n=>{const s=n.find(o=>o.id===e),i=n.find(o=>o.id===t);return!!(s?.selected||i?.selected)}),Rut=(e,t,n,s,i)=>ve(Uo,cH,(o,r)=>{const{shouldColorEdges:l}=r;if(!l)return Nr("base.500");const c=o.find(g=>g.id===t),d=o.find(g=>g.id===s);if(!c||!n||!d||!i)return Nr("base.500");const u=e[c.data.type],p=eo(c)&&eo(d),m=u?.outputs[n],f=p?m?.type:void 0;return f?Dk(f):Nr("base.500")}),Out=(e,t,n,s,i)=>ve(Uo,o=>{const r=o.find(u=>u.id===t),l=o.find(u=>u.id===s);if(!r||!n||!l||!i)return null;const c=e[r.data.type],d=e[l.data.type];return`${c?.title||r.data?.label} -> ${d?.title||l.data?.label}`}),Nut=ec(Dq),Fut={strokeWidth:"3px !important",stroke:"base.500 !important",opacity:"0.5 !important",strokeDasharray:"none",'&[data-selected="true"]':{opacity:"1 !important"},'&[data-selected="true"], &[data-are-connected-nodes-selected="true"]':{strokeDasharray:"5 !important"},'&[data-should-animate-edges="true"]':{animation:"dashdraw 0.5s linear infinite !important"}},But={bg:"base.500",opacity:.5,shadow:"base",'&[data-selected="true"]':{opacity:1}},zut=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:i,targetPosition:o,markerEnd:r,data:l,selected:c=!1,source:d,target:u})=>{const p=M(__),m=h.useMemo(()=>Kme(d,u),[d,u]),f=M(m),[g,v,b]=ZM({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:s,targetPosition:o});return a.jsxs(a.Fragment,{children:[a.jsx(Nut,{path:g,markerEnd:r,sx:Fut,"data-selected":c,"data-are-connected-nodes-selected":f,"data-should-animate-edges":p}),l?.count!==void 0&&a.jsx(Tq,{children:a.jsx(ke,{position:"absolute",transform:`translate(-50%, -50%) translate(${v}px,${b}px)`,className:`edge-label-renderer__custom-edge ${bt} ${ar}`,zIndex:1001,children:a.jsx(Bi,{variant:"solid",sx:But,"data-selected":c,children:l.count})})})]})},Vut=h.memo(zut),$ut=ec(Dq),Gut={strokeWidth:"3px !important",opacity:"0.5 !important",strokeDasharray:"none",'&[data-selected="true"]':{opacity:"1 !important"},'&[data-should-animate-edges="true"]':{animation:"dashdraw 0.5s linear infinite !important",'&[data-selected="true"], &[data-are-connected-nodes-selected="true"]':{strokeDasharray:"5 !important"}}},Hut={pointerEvents:"all",position:"absolute",bg:"base.800",borderRadius:"base",borderWidth:1,opacity:.5,borderColor:"transparent",py:1,px:3,shadow:"md",'&[data-selected="true"]':{opacity:1,borderColor:void 0}},Wut={fontWeight:"semibold",color:"base.300",'&[data-selected="true"]':{color:"base.100"}},Uut=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:i,targetPosition:o,markerEnd:r,selected:l=!1,source:c,target:d,sourceHandleId:u,targetHandleId:p})=>{const m=le(ni),f=M(__),g=M(Iq),v=h.useMemo(()=>Kme(c,d),[c,d]),b=h.useMemo(()=>Rut(m,c,u,d,p),[m,c,u,d,p]),C=h.useMemo(()=>Out(m,c,u,d,p),[m,c,u,d,p]),y=M(v),x=M(b),w=M(C),[_,S,I]=ZM({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:s,targetPosition:o});return a.jsxs(a.Fragment,{children:[a.jsx($ut,{path:_,markerEnd:r,sx:Gut,stroke:`${x} !important`,"data-selected":l,"data-are-connected-nodes-selected":y,"data-should-animate-edges":f}),w&&g&&a.jsx(Tq,{children:a.jsx(A,{className:`${bt} ${ar}`,transform:`translate(-50%, -50%) translate(${S}px,${I}px)`,"data-selected":l,sx:Hut,children:a.jsx(q,{size:"sm",sx:Wut,"data-selected":l,children:w})})})]})},qut=h.memo(Uut),Kut=Ft("workflows").child({filePath:"features/nodes/hooks/useZoomToNode.ts"}),tL=e=>h.useCallback(()=>{const n=sv.get();if(!n){Kut.warn("No flow instance found, cannot zoom to node");return}n.fitView({duration:300,maxZoom:1.5,nodes:[{id:e}]})},[e]),Zme={h:"full",position:"relative",borderRadius:"base",transitionProperty:"none",cursor:"grab","--border-color":"var(--invoke-colors-base-500)","--border-color-selected":"var(--invoke-colors-blue-300)","--header-bg-color":"var(--invoke-colors-base-900)",'&[data-status="warning"]':{"--border-color":"var(--invoke-colors-warning-500)","--border-color-selected":"var(--invoke-colors-warning-500)","--header-bg-color":"var(--invoke-colors-warning-700)"},'&[data-status="error"]':{"--border-color":"var(--invoke-colors-error-500)","--border-color-selected":"var(--invoke-colors-error-500)","--header-bg-color":"var(--invoke-colors-error-700)"},"& .node-selection-overlay":{display:"block",position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",transitionProperty:"none",pointerEvents:"none",shadow:"0 0 0 1px var(--border-color)"},'&[data-is-mouse-over-node="true"] .node-selection-overlay':{display:"block"},'&[data-is-mouse-over-form-field="true"] .node-selection-overlay':{display:"block",bg:"invokeBlueAlpha.100"},_hover:{"& .node-selection-overlay":{display:"block",shadow:"0 0 0 1px var(--border-color-selected)"},'&[data-is-selected="true"] .node-selection-overlay':{display:"block",shadow:"0 0 0 2px var(--border-color-selected)"}},'&[data-is-selected="true"] .node-selection-overlay':{display:"block",shadow:"0 0 0 2px var(--border-color-selected)"}},Xme={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",pointerEvents:"none",zIndex:-1,shadow:"var(--invoke-shadows-xl), var(--invoke-shadows-base), var(--invoke-shadows-base)"},Yme={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"md",pointerEvents:"none",transitionProperty:"none",opacity:.7,zIndex:-1,display:"none",shadow:"0 0 0 2px var(--invoke-colors-yellow-400), 0 0 20px 2px var(--invoke-colors-orange-700)",'&[data-is-in-progress="true"]':{display:"block"}},Zut=e=>{const{nodeId:t,width:n,children:s,selected:i}=e,o=J8(t),r=tL(t),c=q_(t)?.status===Ui.enum.IN_PROGRESS,d=M(XM),u=im(),p=h.useCallback(m=>{m.target instanceof HTMLElement&&(m.target instanceof HTMLInputElement||m.target instanceof HTMLTextAreaElement||m.target instanceof HTMLSelectElement||m.target instanceof HTMLButtonElement||m.target instanceof HTMLAnchorElement||m.target.closest(`.${Xc}`)===null&&r())},[r]);return a.jsxs(ke,{onClick:u.onCloseGlobal,onDoubleClick:p,onMouseOver:o.handleMouseOver,onMouseOut:o.handleMouseOut,className:um,sx:Zme,width:n||Qd,opacity:d,"data-is-selected":i,children:[a.jsx(ke,{sx:Xme}),a.jsx(ke,{sx:Yme,"data-is-in-progress":c}),s,a.jsx(ke,{className:"node-selection-overlay"})]})},Qme=h.memo(Zut),Xut=e=>{const t=M(or),n=le(Sl),s=Jd(t);return n?.image?a.jsx(IA,{nodeProps:e,children:a.jsx(Nn,{src:n?.image.dataURL,w:"full",h:"full",objectFit:"contain",borderRadius:"base"})}):s?a.jsx(IA,{nodeProps:e,children:a.jsx(lc,{imageDTO:s,borderRadius:"base"})}):a.jsx(IA,{nodeProps:e,children:a.jsx(On,{})})},Yut=h.memo(Xut),IA=e=>{const[t,n]=h.useState(!1),s=h.useCallback(()=>{n(!0)},[]),i=h.useCallback(()=>{n(!1)},[]),{t:o}=T();return a.jsx(Qme,{nodeId:e.nodeProps.id,selected:e.nodeProps.selected,width:384,children:a.jsxs(A,{onMouseEnter:s,onMouseLeave:i,className:um,position:"relative",flexDirection:"column",aspectRatio:"1/1",children:[a.jsx(A,{layerStyle:"nodeHeader",borderTopRadius:"base",alignItems:"center",justifyContent:"center",h:8,children:a.jsx(q,{fontSize:"sm",fontWeight:"semibold",color:"base.200",children:o("nodes.currentImage")})}),a.jsxs(A,{layerStyle:"nodeBody",w:"full",h:"full",borderBottomRadius:"base",p:2,children:[e.children,t&&a.jsx(mle.div,{initial:Qut,animate:Jut,exit:eht,style:tht,children:a.jsx(Bae,{inset:2})},"nextPrevButtons")]})]})})},Qut={opacity:0},Jut={opacity:1,transition:{duration:.1}},eht={opacity:0,transition:{duration:.1}},tht={position:"absolute",top:40,left:-2,right:-2,bottom:0,pointerEvents:"none"},Jme=h.createContext(null),Us=(e,t,n)=>{let s=e.get(t);return s||(s=n(),e.set(t,s)),s},Jl=h.memo(({nodeId:e,children:t})=>{const n=le(ni),s=h.useMemo(()=>{const i=new Map,o=Us(i,"selectNodeSafe",()=>ve(Uo,k=>k.find(({id:E,type:j})=>j==="invocation"&&E===e)??null)),r=Us(i,"selectNodeDataSafe",()=>ve(o,k=>k?.data??null)),l=Us(i,"selectNodeTypeSafe",()=>ve(r,k=>k?.type??null)),c=Us(i,"selectNodeTemplateSafe",()=>ve(l,k=>k?n[k]??null:null)),d=Us(i,"selectNodeInputsSafe",()=>ve(r,k=>k?.inputs??null)),u=k=>Us(i,`buildSelectInputFieldSafe-${k}`,()=>ve(d,E=>E?.[k]??null)),p=k=>Us(i,`buildSelectInputFieldTemplateSafe-${k}`,()=>ve(c,E=>E?.inputs?.[k]??null)),m=k=>Us(i,`buildSelectOutputFieldTemplateSafe-${k}`,()=>ve(c,E=>E?.outputs?.[k]??null)),f=Us(i,"selectNodeOrThrow",()=>ve(Uo,k=>{const E=k.find(({id:j,type:P})=>P==="invocation"&&j===e);if(E===void 0)throw new Error(`Cannot find node with id ${e}`);return E})),g=Us(i,"selectNodeDataOrThrow",()=>ve(f,k=>k.data)),v=Us(i,"selectNodeTypeOrThrow",()=>ve(g,k=>k.type)),b=Us(i,"selectNodeTemplateOrThrow",()=>ve(v,k=>{const E=n[k];if(E===void 0)throw new Error(`Cannot find template for node with id ${e} with type ${k}`);return E})),C=Us(i,"selectNodeInputsOrThrow",()=>ve(g,k=>k.inputs)),y=k=>Us(i,`buildSelectInputFieldOrThrow-${k}`,()=>ve(C,E=>{const j=E[k];if(j===void 0)throw new Error(`Cannot find input field with name ${k} in node ${e}`);return j})),x=k=>Us(i,`buildSelectInputFieldTemplateOrThrow-${k}`,()=>ve(b,E=>{const j=E.inputs[k];if(j===void 0)throw new Error(`Cannot find input field template with name ${k} in node ${e}`);return j})),w=k=>Us(i,`buildSelectOutputFieldTemplateOrThrow-${k}`,()=>ve(b,E=>{const j=E.outputs[k];if(j===void 0)throw new Error(`Cannot find output field template with name ${k} in node ${e}`);return j})),_=k=>Us(i,`buildSelectIsInputFieldConnected-${k}`,()=>ve(YM,E=>E.some(j=>j.target===e&&j.targetHandle===k))),S=k=>Us(i,`buildSelectIsInputFieldAddedToForm-${k}`,()=>ve(Mq,E=>E.some(j=>j.data.fieldIdentifier.nodeId===e&&j.data.fieldIdentifier.fieldName===k))),I=Us(i,"selectNodeNeedsUpdate",()=>ve([r,c],(k,E)=>!k||!E?!1:g1(k,E)));return{nodeId:e,selectNodeSafe:o,selectNodeDataSafe:r,selectNodeTypeSafe:l,selectNodeTemplateSafe:c,selectNodeInputsSafe:d,buildSelectInputFieldSafe:u,buildSelectInputFieldTemplateSafe:p,buildSelectOutputFieldTemplateSafe:m,buildSelectIsInputFieldAddedToForm:S,selectNodeOrThrow:f,selectNodeDataOrThrow:g,selectNodeTypeOrThrow:v,selectNodeTemplateOrThrow:b,selectNodeInputsOrThrow:C,buildSelectInputFieldOrThrow:y,buildSelectInputFieldTemplateOrThrow:x,buildSelectOutputFieldTemplateOrThrow:w,buildSelectIsInputFieldConnected:_,selectNodeNeedsUpdate:I}},[e,n]);return a.jsx(Jme.Provider,{value:s,children:t})});Jl.displayName="InvocationNodeContextProvider";const yn=()=>{const e=h.useContext(Jme);if(!e)throw new Error("useInvocationNodeContext must be used within an InvocationNodeProvider");return e},nL=()=>{const e=yn(),t=le(Xu,{keys:[e.nodeId]})[e.nodeId];return t?t.length>0:!1},nht=e=>{const{nodeId:t,width:n,children:s,isMissingTemplate:i,selected:o}=e,r=yn(),l=M(r.selectNodeNeedsUpdate),c=J8(t),d=eL(t),u=tL(t),p=nL(),m=i||p,g=q_(t)?.status===Ui.enum.IN_PROGRESS,v=M(XM),b=im(),C=h.useCallback(y=>{y.target instanceof HTMLElement&&(y.target instanceof HTMLInputElement||y.target instanceof HTMLTextAreaElement||y.target instanceof HTMLSelectElement||y.target instanceof HTMLButtonElement||y.target instanceof HTMLAnchorElement||y.target.closest(`.${Xc}`)===null&&u())},[u]);return a.jsxs(ke,{onClick:b.onCloseGlobal,onDoubleClick:C,onMouseOver:c.handleMouseOver,onMouseOut:c.handleMouseOut,className:um,sx:Zme,width:n||Qd,opacity:v,"data-is-selected":o,"data-is-mouse-over-form-field":d.isMouseOverFormField,"data-status":m?"error":l?"warning":void 0,children:[a.jsx(ke,{sx:Xme}),a.jsx(ke,{sx:Yme,"data-is-in-progress":g}),s,a.jsx(ke,{className:"node-selection-overlay"})]})},CG=h.memo(nht),sht={position:"relative",minH:8,py:.5,alignItems:"center",w:"full",h:"full"},Mk=h.memo(({children:e})=>a.jsx(A,{sx:sht,children:e}));Mk.displayName="InputFieldWrapper";const iht=e=>{const t=yn(),n=h.useMemo(()=>ve(t.buildSelectInputFieldSafe(e),s=>!!s),[t,e]);return M(n)},oht=e=>{const t=yn(),n=h.useMemo(()=>ve([t.buildSelectInputFieldSafe(e),t.buildSelectInputFieldTemplateSafe(e)],(i,o)=>i?.label||o?.title||e),[e,t]);return M(n)},aht=e=>{const t=yn(),n=h.useMemo(()=>ve(t.buildSelectInputFieldTemplateSafe(e),s=>!!s),[t,e]);return M(n)},ap=h.memo(({nodeId:e,fieldName:t,children:n,fallback:s,formatLabel:i})=>{const o=iht(t),r=aht(t);return!r||!o?s!==void 0?s:a.jsx(ege,{nodeId:e,fieldName:t,formatLabel:i,hasInstance:o,hasTemplate:r}):n});ap.displayName="InputFieldGate";const ege=h.memo(({fieldName:e,formatLabel:t,hasTemplate:n,hasInstance:s})=>{const{t:i}=T(),o=oht(e),r=h.useMemo(()=>t?t(o):n&&!s?i("nodes.missingField_withName",{name:o}):!n&&s?i("nodes.unexpectedField_withName",{name:o}):i("nodes.unknownField_withName",{name:o}),[t,s,n,o,i]);return a.jsx(Mk,{children:a.jsx(A,{w:"full",px:1,py:1,children:a.jsx(q,{fontWeight:"semibold",color:"error.300",whiteSpace:"pre",children:r})})})});ege.displayName="Fallback";const rht={position:"relative",minH:8,py:.5,alignItems:"center",justifyContent:"flex-end"},sL=h.memo(({children:e})=>a.jsx(A,{sx:rht,children:e}));sL.displayName="OutputFieldWrapper";const lht=e=>{const t=yn(),n=h.useMemo(()=>ve([t.buildSelectOutputFieldTemplateSafe(e)],s=>s?.title||e),[e,t]);return M(n)},cht=e=>{const t=yn(),n=h.useMemo(()=>ve(t.buildSelectOutputFieldTemplateSafe(e),s=>!!s),[t,e]);return M(n)},tge=h.memo(({nodeId:e,fieldName:t,children:n})=>cht(t)?n:a.jsx(nge,{nodeId:e,fieldName:t}));tge.displayName="OutputFieldGate";const nge=h.memo(({fieldName:e})=>{const{t}=T(),n=lht(e);return a.jsx(sL,{children:a.jsx(te,{isInvalid:!0,alignItems:"stretch",justifyContent:"space-between",gap:2,h:"full",w:"full",children:a.jsx(ne,{display:"flex",alignItems:"center",h:"full",color:"error.300",mb:0,px:1,gap:2,children:t("nodes.unexpectedField_withName",{name:n})})})})});nge.displayName="Fallback";const dht=(e,t,n,s,i,o)=>ve(Xn,r=>{const{nodes:l,edges:c}=r;if(!i)return"nodes.noConnectionInProgress";if(s===i.handleType)return s==="source"?"nodes.cannotConnectOutputToOutput":"nodes.cannotConnectInputToInput";const d=s==="source"?t:i.nodeId,u=s==="source"?n:i.handleId,p=s==="target"?t:i.nodeId,m=s==="target"?n:i.handleId;return cb({source:d,sourceHandle:u,target:p,targetHandle:m},l,c,e,o)}),Lk=(e,t,n)=>{const s=le(pa),i=le(ni),o=le(vh),r=h.useMemo(()=>dht(i,e,t,n,s,o),[i,e,t,n,s,o]);return M(r)},Rk=(e,t,n)=>{const s=le(pa);return h.useMemo(()=>!s||s.nodeId!==e||s.handleId!==t?!1:n==="source"&&s.fieldTemplate.fieldKind==="output"||n==="target"&&s.fieldTemplate.fieldKind==="input",[t,n,e,s])},Ok=()=>le(sSe),iL=e=>{const t=yn(),n=h.useMemo(()=>t.buildSelectOutputFieldTemplateOrThrow(e),[t,e]);return M(n)},Nk=e=>{const{t}=T();return h.useMemo(()=>{const{name:s}=e;return Mp(e)?t("nodes.collectionFieldType",{name:s}):xd(e)?t("nodes.collectionOrScalarFieldType",{name:s}):t("nodes.singleFieldType",{name:s})},[e,t])},sge={position:"relative",width:"full",height:"full",borderStyle:"solid",borderWidth:4,pointerEvents:"none",'&[data-cardinality="SINGLE"]':{borderWidth:0},borderRadius:"100%",'&[data-is-model-field="true"], &[data-is-batch-field="true"]':{borderRadius:4},'&[data-is-batch-field="true"]':{transform:"rotate(45deg)"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="false"][data-is-connection-valid="false"]':{filter:"opacity(0.4) grayscale(0.7)",cursor:"not-allowed"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="true"][data-is-connection-valid="false"]':{cursor:"grab"},'&[data-is-connection-in-progress="false"] &[data-is-connection-valid="true"]':{cursor:"crosshair"}},ige={position:"absolute",width:"1rem",height:"1rem",zIndex:1,background:"none",border:"none",insetInlineEnd:"-0.5rem"},oge=h.memo(({nodeId:e,fieldName:t})=>{const n=iL(t),s=Nk(n.type),i=h.useMemo(()=>Dk(n.type),[n.type]),o=h.useMemo(()=>dM(n.type),[n.type]);return Ok()?a.jsx(rge,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o}):a.jsx(age,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})});oge.displayName="OutputFieldHandle";const age=h.memo(({fieldTemplate:e,fieldTypeName:t,fieldColor:n,isModelField:s})=>a.jsx(He,{label:t,placement:"start",openDelay:hm,children:a.jsx(jd,{type:"source",id:e.name,position:Ed.Right,style:ige,children:a.jsx(ke,{sx:sge,"data-cardinality":e.type.cardinality,"data-is-batch-field":e.type.batch,"data-is-model-field":s,"data-is-connection-in-progress":!1,"data-is-connection-start-field":!1,"data-is-connection-valid":!1,backgroundColor:e.type.cardinality==="SINGLE"?n:"base.900",borderColor:n})})}));age.displayName="IdleHandle";const rge=h.memo(({nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})=>{const{t:r}=T(),l=Rk(e,t,"target"),c=Lk(e,t,"target"),d=h.useMemo(()=>c!==null?r(c):s,[s,r,c]);return a.jsx(He,{label:d,placement:"start",openDelay:hm,children:a.jsx(jd,{type:"source",id:n.name,position:Ed.Right,style:ige,children:a.jsx(ke,{sx:sge,"data-cardinality":n.type.cardinality,"data-is-batch-field":n.type.batch,"data-is-model-field":o,"data-is-connection-in-progress":!0,"data-is-connection-start-field":l,"data-is-connection-valid":c===null,backgroundColor:n.type.cardinality==="SINGLE"?i:"base.900",borderColor:i})})})});rge.displayName="ConnectionInProgressHandle";const lge=h.memo(({fieldName:e})=>{const t=iL(e),n=Nk(t.type),{t:s}=T();return a.jsxs(A,{flexDir:"column",children:[a.jsx(q,{fontWeight:"semibold",children:t.title}),a.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:t.description}),a.jsxs(q,{children:[s("parameters.type"),": ",n]})]})});lge.displayName="OutputFieldTooltipContent";const oL=e=>{const t=yn(),n=h.useMemo(()=>t.buildSelectIsInputFieldConnected(e),[e,t]);return M(n)},uht={fontSize:"sm",color:"base.300",fontWeight:"semibold",pe:2,'&[data-is-disabled="true"]':{opacity:.5}},cge=h.memo(({nodeId:e,fieldName:t})=>{const n=iL(t),s=oL(t),i=Rk(e,t,"source"),o=Ok(),r=Lk(e,t,"source");return a.jsx(He,{label:a.jsx(lge,{nodeId:e,fieldName:t}),openDelay:hm,placement:"top",children:a.jsx(q,{"data-is-disabled":o&&r!==null&&!i||s,sx:uht,children:n.title})})});cge.displayName="OutputFieldTitle";const dge=h.memo(({nodeId:e,fieldName:t})=>a.jsxs(sL,{children:[a.jsx(cge,{nodeId:e,fieldName:t}),a.jsx(oge,{nodeId:e,fieldName:t})]}));dge.displayName="OutputFieldNodesEditorView";const hht=e=>e.input==="connection"&&!xd(e.type)||!Lq(e.type),pht=e=>(["any","direct"].includes(e.input)||xd(e.type))&&Lq(e.type),fht=()=>{const e=yn(),t=h.useMemo(()=>ve([e.selectNodeInputsOrThrow,e.selectNodeTemplateSafe],(n,s)=>{const i=new Set(Object.keys(n)),o=new Set(Object.keys(s?.inputs??{}));return Array.from(i.difference(o))}),[e]);return M(t)},mht=()=>{const e=yn(),t=h.useMemo(()=>ve([e.selectNodeTemplateSafe],n=>{const s=[];for(const[i,o]of Object.entries(n?.inputs??{}))pht(o)&&s.push(i);return s}),[e]);return M(t)},ght=()=>{const e=yn(),t=h.useMemo(()=>ve([e.selectNodeTemplateSafe],n=>{const s=[];for(const[i,o]of Object.entries(n?.inputs??{}))hht(o)&&s.push(i);return s}),[e]);return M(t)},vht=e=>{const t=e.filter(i=>!i.ui_hidden),n=t.filter(i=>!st(i.ui_order)).sort((i,o)=>(i.ui_order??0)-(o.ui_order??0)),s=t.filter(i=>st(i.ui_order));return n.concat(s).map(i=>i.name).filter(i=>i!=="is_intermediate")},yht=()=>{const e=yn(),t=h.useMemo(()=>ve([e.selectNodeTemplateOrThrow],n=>vht(Object.values(n.outputs))),[e]);return M(t)},Eu=()=>{const e=yn();return M(e.selectNodeTemplateOrThrow)},uge=()=>{const e=Eu();return h.useMemo(()=>!iSe(e.type)&&!oSe(e.type),[e])},hge=()=>{const e=yn();return M(e.selectNodeTemplateSafe)},aL=()=>{const e=hge();return h.useMemo(()=>xc(e?.outputs,n=>n.type.name==="ImageField"&&e?.type!=="image"),[e])},bht=()=>{const e=aL();return uge()&&e},Fk=e=>{const t=yn(),n=h.useMemo(()=>ve(t.buildSelectInputFieldSafe(e),s=>s?.description??""),[t,e]);return M(n)},pge=h.memo(({nodeId:e,fieldName:t})=>{const{t:n}=T();return a.jsxs(yi,{isLazy:!0,lazyBehavior:"unmount",children:[a.jsx(Ni,{children:a.jsx(oe,{variant:"ghost",tooltip:n("nodes.description"),"aria-label":n("nodes.description"),icon:a.jsx(lMe,{}),pointerEvents:"auto",size:"xs"})}),a.jsx(Ls,{children:a.jsx(bi,{p:2,w:256,children:a.jsx(fge,{nodeId:e,fieldName:t})})})]})});pge.displayName="InputFieldDescriptionPopover";const fge=h.memo(({nodeId:e,fieldName:t})=>{const n=Q(),{t:s}=T(),i=Fk(t),o=h.useCallback(r=>{n(Rq({nodeId:e,fieldName:t,val:r.target.value}))},[n,t,e]);return a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:s("nodes.description")}),a.jsx(no,{className:`${bt} ${ar} ${kn}`,fontSize:"sm",value:i??"",onChange:o,p:2,resize:"none",rows:5})]})});fge.displayName="Content";const dc=e=>{const t=yn(),n=h.useMemo(()=>t.buildSelectInputFieldTemplateOrThrow(e),[t,e]);return M(n)},mge={position:"relative",width:"full",height:"full",borderStyle:"solid",borderWidth:4,pointerEvents:"none",'&[data-cardinality="SINGLE"]':{borderWidth:0},borderRadius:"100%",'&[data-is-model-field="true"], &[data-is-batch-field="true"]':{borderRadius:4},'&[data-is-batch-field="true"]':{transform:"rotate(45deg)"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="false"][data-is-connection-valid="false"]':{filter:"opacity(0.4) grayscale(0.7)",cursor:"not-allowed"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="true"][data-is-connection-valid="false"]':{cursor:"grab"},'&[data-is-connection-in-progress="false"] &[data-is-connection-valid="true"]':{cursor:"crosshair"}},gge={position:"absolute",width:"1rem",height:"1rem",zIndex:1,background:"none",border:"none",insetInlineStart:"-0.5rem"},rL=h.memo(({nodeId:e,fieldName:t})=>{const n=dc(t),s=Nk(n.type),i=h.useMemo(()=>Dk(n.type),[n.type]),o=h.useMemo(()=>dM(n.type),[n.type]);return Ok()?a.jsx(yge,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o}):a.jsx(vge,{nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})});rL.displayName="InputFieldHandle";const vge=h.memo(({fieldTemplate:e,fieldTypeName:t,fieldColor:n,isModelField:s})=>a.jsx(He,{label:t,placement:"start",openDelay:hm,children:a.jsx(jd,{type:"target",id:e.name,position:Ed.Left,style:gge,children:a.jsx(ke,{sx:mge,"data-cardinality":e.type.cardinality,"data-is-batch-field":e.type.batch,"data-is-model-field":s,"data-is-connection-in-progress":!1,"data-is-connection-start-field":!1,"data-is-connection-valid":!1,backgroundColor:e.type.cardinality==="SINGLE"?n:"base.900",borderColor:n})})}));vge.displayName="IdleHandle";const yge=h.memo(({nodeId:e,fieldName:t,fieldTemplate:n,fieldTypeName:s,fieldColor:i,isModelField:o})=>{const{t:r}=T(),l=Rk(e,t,"target"),c=Lk(e,t,"target"),d=h.useMemo(()=>c!==null?r(c):s,[s,r,c]);return a.jsx(He,{label:d,placement:"start",openDelay:hm,children:a.jsx(jd,{type:"target",id:n.name,position:Ed.Left,style:gge,children:a.jsx(ke,{sx:mge,"data-cardinality":n.type.cardinality,"data-is-batch-field":n.type.batch,"data-is-model-field":o,"data-is-connection-in-progress":!0,"data-is-connection-start-field":l,"data-is-connection-valid":c===null,backgroundColor:n.type.cardinality==="SINGLE"?i:"base.900",borderColor:i})})})});yge.displayName="ConnectionInProgressHandle";const xht=e=>{const t=Q(),n=yn(),s=h.useMemo(()=>ve(n.buildSelectInputFieldTemplateOrThrow(e),c=>c.default),[n,e]),i=M(s),o=h.useMemo(()=>ve([n.buildSelectInputFieldOrThrow(e),s],(c,d)=>!yo(c.value,d)),[e,s,n]),r=M(o),l=h.useCallback(()=>{t(QM({nodeId:n.nodeId,fieldName:e,value:i}))},[t,e,i,n.nodeId]);return{defaultValue:i,isValueChanged:r,resetToDefaultValue:l}},bge=h.memo(({fieldName:e})=>{const{t}=T(),{isValueChanged:n,resetToDefaultValue:s}=xht(e);return a.jsx(oe,{variant:"ghost",tooltip:t("nodes.resetToDefaultValue"),"aria-label":t("nodes.resetToDefaultValue"),icon:a.jsx(Gs,{}),pointerEvents:"auto",size:"xs",onClick:s,isDisabled:!n})});bge.displayName="InputFieldResetToDefaultValueIconButton";const Cht={top:(e,t,n)=>{const s=Math.abs(t.y-e.top);if(!n)return s;const i=Math.min(e.height/4,10);return s<=i?0:1/0},right:(e,t,n)=>{const s=Math.abs(e.right-t.x);if(!n)return s;const i=Math.min(e.width/4,10);return s<=i?0:1/0},bottom:(e,t,n)=>{const s=Math.abs(e.bottom-t.y);if(!n)return s;const i=Math.min(e.height/4,10);return s<=i?0:1/0},left:(e,t,n)=>{const s=Math.abs(t.x-e.left);if(!n)return s;const i=Math.min(e.width/4,10);return s<=i?0:1/0},center:(e,t,n)=>{const s=e.left+e.width/2,i=e.top+e.height/2;return Math.sqrt((t.x-s)**2+(t.y-i)**2)}},xge=Symbol("centerWithClosestEdge");function Cge(e,{element:t,input:n,allowedCenterOrEdge:s}){const i={x:n.clientX,y:n.clientY},o=t.getBoundingClientRect(),r=s.includes("center"),c=s.map(d=>({edge:d,value:Cht[d](o,i,r)})).sort((d,u)=>d.value-u.value)[0]?.edge??null;return{...e,[xge]:c}}function wge(e){return e[xge]??null}const Cr=Ft("dnd").child({filePath:"features/nodes/components/sidePanel/builder/dnd-hooks.ts"}),_ge=Symbol("form-element"),oh=e=>({[_ge]:!0,element:e}),db=e=>_ge in e,Sge=Symbol("node-field"),wht=(e,t,n)=>({[Sge]:!0,nodeId:e,fieldName:t,fieldTemplate:n}),Bk=e=>Sge in e,_ht=e=>{const t=document.querySelector(`#${e}`);t instanceof HTMLElement&&Gne(t,Nr("base.800"))},lL=()=>{const e=Ze();return h.useCallback((n,s)=>{const i=S_(e.getState());return aSe(i,n,s)},[e])},Sht=()=>{const e=Ze();return h.useCallback(n=>{const s=S_(e.getState());return lSe(s,n)},[e])},kht=()=>{const e=Ze();return h.useCallback((n,s)=>{const i=S_(e.getState());return Object.values(i.elements).filter(Ly).some(o=>o.data.fieldIdentifier.nodeId===n&&o.data.fieldIdentifier.fieldName===s)},[e])},kge=()=>{const e=Ze();return h.useCallback(n=>{const s=S_(e.getState());return cSe(s,n)},[e])},Iht=()=>{const e=Ze();return h.useCallback(n=>{const{nodes:s}=Xn(e.getState());return rSe(s,n)},[e])},jht=e=>{if(Bk(e.data)){const{nodeId:t,fieldName:n,fieldTemplate:s}=e.data;return uM(t,n,s.type)}return db(e.data)?e.data.element:null},Eht=e=>db(e.data)?e.data.element:null,Aht=()=>{mn("useBuilderDndMonitor");const e=Q(),t=h.useCallback((o,r)=>{pu.flushSync(()=>{e(o)}),_ht(r)},[e]),n=lL(),s=Iht(),i=Sht();h.useEffect(()=>Gh({canMonitor:({source:o})=>db(o.data)||Bk(o.data),onDrop:({location:o,source:r})=>{const l=o.current.dropTargets[0];if(!l)return;const c=jht(r),d=Eht(l);if(!c||!d||c.id===d.id)return;const u=!i(c.id),p=wge(l.data);if(u)if(p==="center"){if(Cr.trace("Adding new element to empty container"),!Ga(d)){Cr.error(ts({target:l,source:r}),"Expected target to be a container");return}t(sP({element:c,parentId:d.id,index:0,initialValue:s(c)}),c.id);return}else{if(Cr.trace("Adding new element to container with children (dropped on edge of container child)"),d.parentId===void 0){Cr.error(ts({target:l,source:r}),"Expected target to have a parent");return}const m=n(d.parentId,Ga),f=m.data.children.indexOf(d.id),g=bT({startIndex:f+1,indexOfTarget:f,closestEdgeOfTarget:p,axis:m.data.layout==="row"?"horizontal":"vertical"});t(sP({element:c,parentId:m.id,index:g,initialValue:s(c)}),c.id);return}else if(p==="center"){if(Cr.trace("Reparenting element to an empty container"),!Ga(d)){Cr.error(ts({target:l,source:r}),"Expected target to be a container");return}t(aR({id:c.id,newParentId:d.id,index:0}),c.id);return}else if(d.parentId===c.parentId){if(Cr.trace("Moving element within container"),d.parentId===void 0){Cr.error(ts({target:l,source:r}),"Expected target to have a parent");return}const m=n(d.parentId,Ga),f=m.data.children.indexOf(c.id),g=m.data.children.indexOf(d.id),v=Pee({list:m.data.children,startIndex:f,indexOfTarget:g,closestEdgeOfTarget:p,axis:m.data.layout==="row"?"horizontal":"vertical"});t(iP({id:m.id,changes:{children:v}}),c.id);return}else if(d.parentId!==c.parentId){if(Cr.trace("Reparenting element to container with children (dropped on edge of container child)"),d.parentId===void 0){Cr.error(ts({target:l,source:r}),"Expected target to have a parent");return}const m=n(d.parentId,Ga),f=m.data.children.indexOf(d.id),g=bT({startIndex:m.data.children.length+1,indexOfTarget:f,closestEdgeOfTarget:p,axis:m.data.layout==="row"?"horizontal":"vertical"});t(aR({id:c.id,newParentId:m.id,index:g}),c.id);return}else Cr.error(ts({target:l,source:r}),"Unhandled drop event!")}}),[t,i,n,s])},ub=(e,t,n)=>{const s=Dht(e),[i,o]=h.useState(!1),[r,l]=h.useState(null),c=lL(),d=kge(),u=kht();return h.useEffect(()=>{s&&ae(!1,"Root element should not be draggable");const p=t.current,m=n.current;if(!(!p||!m))return zi(Hm(p),wm({element:p,dragHandle:m,getInitialData:()=>{const f=c(e);return oh(f)},onDragStart:()=>{o(!0)},onDrop:()=>{o(!1)}}),o1({element:p,getIsSticky:()=>!1,canDrop:({source:f})=>Bk(f.data)&&!u(f.data.nodeId,f.data.fieldName)?!0:db(f.data)?f.data.element.id!==c(e).parentId:!1,getData:({input:f})=>{const g=c(e),v=oh(g),b=d(g);return Cge(v,{element:p,input:f,allowedCenterOrEdge:b})},onDrag:({self:f,location:g,source:v})=>{const b=g.current.dropTargets.at(0)?.element;if(!b||b!==p){l(null);return}const C=wge(f.data);if(C==="center"&&v.element===p){l(null);return}l(C)},onDragLeave:()=>{l(null)},onDrop:()=>{l(null)}}))},[n,t,e,d,c,u,s]),[r,i]},Pht=e=>{const[t,n]=h.useState(!1),s=lL(),i=kge(),o=M(JM);return h.useEffect(()=>{const r=e.current;if(r)return zi(o1({element:r,getIsSticky:()=>!1,canDrop:({source:l})=>s(o,Ga).data.children.length!==0?!1:!!(Bk(l.data)||db(l.data)),getData:({input:l})=>{const c=s(o,Ga),d=oh(c);return Cge(d,{element:r,input:l,allowedCenterOrEdge:["center"]})},onDrag:()=>{n(!0)},onDragLeave:()=>{n(!1)},onDrop:()=>{n(!1)}}))},[e,i,s,o]),t},Tht=(e,t,n,s,i)=>{const[o,r]=h.useState(!1);return h.useEffect(()=>{const l=s.current,c=i.current;if(!(!l||!c))return zi(Hm(l),wm({element:l,dragHandle:c,getInitialData:()=>wht(e,t,n),onDragStart:()=>{r(!0)},onDrop:()=>{r(!1)}}))},[i,s,t,n,e]),o},Dht=e=>{const t=M(JM);return h.useMemo(()=>t===e,[t,e])},hb=e=>{const t=yn(),n=h.useMemo(()=>Ut(Xu,s=>{const i=s[t.nodeId];return i?i.some(r=>r.type==="field-error"&&r.fieldName===e):!1}),[t,e]);return le(n)},rp=e=>{const t=yn(),n=h.useMemo(()=>t.buildSelectInputFieldOrThrow(e),[t,e]);return M(n)},Mht=(e,t)=>{const n=Q(),s=M(JM),i=dc(t),o=rp(t),r=h.useMemo(()=>dSe(e,t),[e,t]),l=M(r),c=h.useMemo(()=>!!l,[l]),d=h.useCallback(()=>{const p=uM(e,t,i.type);n(sP({element:p,parentId:s,initialValue:o.value}))},[e,t,i.type,n,s,o.value]),u=h.useCallback(()=>{l&&n(Oq({id:l.id}))},[l,n]);return{isAddedToRoot:c,addNodeFieldToRoot:d,removeNodeFieldFromRoot:u}},Ige=h.memo(({nodeId:e,fieldName:t})=>{const{t:n}=T(),{isAddedToRoot:s,addNodeFieldToRoot:i,removeNodeFieldFromRoot:o}=Mht(e,t),r=h.useMemo(()=>n(s?"workflows.builder.removeFromForm":"workflows.builder.addToForm"),[s,n]),l=h.useMemo(()=>s?a.jsx(aMe,{}):a.jsx(Sn,{}),[s]),c=h.useCallback(()=>s?o():i(),[s,i,o]);return a.jsx(oe,{variant:"ghost",tooltip:r,"aria-label":r,icon:l,pointerEvents:"auto",size:"xs",onClick:c})});Ige.displayName="InputFieldAddRemoveFormRoot";const Lht=(e,t)=>Math.random()*(t-e+Number.EPSILON)+e,ng=(e,t,n)=>{const s=n?.min??t.min,i=n?.max??t.max,o=n?.step??t.step;if(o===void 0)return Math.min(Math.max(e,s),i);let r=Math.round(e/o)*o;return r<s?r=Math.ceil(s/o)*o:r>i&&(r=Math.floor(i/o)*o),Math.min(Math.max(r,s),i)},pb=(e,t,n,s={})=>{const{showShuffle:i,min:o,max:r,step:l}=s,c=Q(),d=h.useMemo(()=>l!==void 0?l:st(n.multipleOf)?.1:n.multipleOf,[n.multipleOf,l]),u=h.useMemo(()=>l!==void 0?l:st(n.multipleOf)?.01:n.multipleOf,[n.multipleOf,l]),p=h.useMemo(()=>{if(!st(n.multipleOf))return n.multipleOf},[n.multipleOf]),m=h.useMemo(()=>{let C=-Vr;return o!==void 0?C=o:st(n.minimum)?st(n.exclusiveMinimum)||(C=n.exclusiveMinimum+.01):C=n.minimum,k_(C,d)},[n.exclusiveMinimum,n.minimum,o,d]),f=h.useMemo(()=>{let C=Vr;return r!==void 0?C=r:st(n.maximum)?st(n.exclusiveMaximum)||(C=n.exclusiveMaximum-.01):C=n.maximum,Pf(C,d)},[n.exclusiveMaximum,n.maximum,r,d]),g=h.useCallback(C=>ng(C,{min:m,max:f,step:p},{min:o,max:r,step:l}),[f,m,r,o,l,p]),v=h.useCallback(C=>{c(Z2({nodeId:e,fieldName:t,value:C}))},[c,t,e]),b=h.useCallback(()=>{const C=Number((Math.round(Lht(m,f)/d)*d).toFixed(10));c(Z2({nodeId:e,fieldName:t,value:C}))},[c,t,e,m,f,d]);return{defaultValue:n.default,onChange:v,min:m,max:f,step:d,fineStep:u,constrainValue:g,showShuffle:i,randomizeValue:b}},wD=h.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:r,min:l,max:c,step:d,fineStep:u,constrainValue:p,showShuffle:m,randomizeValue:f}=pb(t,n.name,s,i),{t:g}=T();return a.jsxs(a.Fragment,{children:[a.jsx(Pe,{defaultValue:o,onChange:r,value:n.value,min:l,max:c,step:d,fineStep:u,className:bt,flex:"1 1 0",constrainValue:p,allowMath:!0}),m&&a.jsx(he,{size:"sm",isDisabled:!1,onClick:f,leftIcon:a.jsx(Uh,{}),flexShrink:0,children:g("workflows.builder.shuffle")})]})});wD.displayName="FloatFieldInput ";const jge=h.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:r,min:l,max:c,step:d,fineStep:u,constrainValue:p,showShuffle:m,randomizeValue:f}=pb(t,n.name,s,i),{t:g}=T();return a.jsxs(a.Fragment,{children:[a.jsx(it,{defaultValue:o,onChange:r,value:n.value,min:l,max:c,step:d,fineStep:u,className:bt,marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),a.jsx(Pe,{defaultValue:o,onChange:r,value:n.value,min:l,max:c,step:d,fineStep:u,className:bt,flex:"1 1 0",constrainValue:p,allowMath:!0}),m&&a.jsx(he,{size:"sm",isDisabled:!1,onClick:f,leftIcon:a.jsx(Uh,{}),flexShrink:0,children:g("workflows.builder.shuffle")})]})});jge.displayName="FloatFieldInputAndSlider ";const Ege=h.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:r,min:l,max:c,step:d,fineStep:u,showShuffle:p,randomizeValue:m}=pb(t,n.name,s,i),{t:f}=T();return a.jsxs(a.Fragment,{children:[a.jsx(it,{defaultValue:o,onChange:r,value:n.value,min:l,max:c,step:d,fineStep:u,className:bt,marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),p&&a.jsx(he,{size:"sm",isDisabled:!1,onClick:m,leftIcon:a.jsx(Uh,{}),flexShrink:0,children:f("workflows.builder.shuffle")})]})});Ege.displayName="FloatFieldSlider ";const Rht=mr({}).options,Oht={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},Age=h.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=Ze(),{t:o}=T(),r=hb(n.name),l=h.useCallback(v=>{i.dispatch(uSe({nodeId:t,fieldName:n.name,value:v}))},[n.name,t,i]),c=h.useCallback(v=>{const b=n.value?[...n.value]:[];b.splice(v,1),l(b)},[n.value,l]),d=h.useCallback((v,b)=>{const C=n.value?[...n.value]:[];C[v]=b,l(C)},[n.value,l]),u=h.useCallback(()=>{const v=n.value?[...n.value,0]:[0];l(v)},[n.value,l]),p=h.useMemo(()=>{let v=-Vr;return st(s.minimum)||(v=s.minimum),st(s.exclusiveMinimum)||(v=s.exclusiveMinimum+.01),v},[s.exclusiveMinimum,s.minimum]),m=h.useMemo(()=>{let v=Vr;return st(s.maximum)||(v=s.maximum),st(s.exclusiveMaximum)||(v=s.exclusiveMaximum-.01),v},[s.exclusiveMaximum,s.maximum]),f=h.useMemo(()=>st(s.multipleOf)?.1:s.multipleOf,[s.multipleOf]),g=h.useMemo(()=>st(s.multipleOf)?.01:s.multipleOf,[s.multipleOf]);return a.jsxs(A,{className:bt,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:Oht,"data-error":r,borderRadius:"base",flexDir:"column",gap:1,children:[a.jsx(he,{onClick:u,variant:"ghost",children:o("nodes.addItem")}),n.value&&n.value.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(vt,{}),a.jsx(ti,{className:kn,defer:!0,style:ic,options:Rht,children:a.jsx(Ms,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((v,b)=>a.jsx(Pge,{value:v,index:b,min:p,max:m,step:f,fineStep:g,onRemoveNumber:c,onChangeNumber:d},b))})})]})]})});Age.displayName="FloatFieldCollectionInputComponent";const Pge=h.memo(({value:e,index:t,min:n,max:s,step:i,fineStep:o,onRemoveNumber:r,onChangeNumber:l})=>{const{t:c}=T(),d=h.useCallback(()=>{r(t)},[t,r]),u=h.useCallback(p=>{l(t,p)},[t,l]);return a.jsxs(a.Fragment,{children:[a.jsx(_t,{children:a.jsxs(ne,{ps:1,m:0,children:[t+1,"."]})}),a.jsx(_t,{children:a.jsx(Pe,{onChange:u,value:e,min:n,max:s,step:i,fineStep:o,className:bt,flexGrow:1,allowMath:!0})}),a.jsx(_t,{children:a.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:d,icon:a.jsx(fn,{}),"aria-label":c("common.delete")})})]})});Pge.displayName="FloatListItemContent";const Tge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(r=>{t({...e,start:r})},[t,e]),i=h.useCallback(r=>{t({...e,step:r})},[t,e]),o=h.useCallback(r=>{t({...e,count:r})},[t,e]);return a.jsxs(A,{gap:2,alignItems:"flex-end",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.start")}),a.jsx(Pe,{value:e.start,onChange:s,min:-1/0,max:1/0,step:.01,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.step")}),a.jsx(Pe,{value:e.step,onChange:i,min:-1/0,max:1/0,step:.01,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.count")}),a.jsx(Pe,{value:e.count,onChange:o,min:1,max:1/0,allowMath:!0})]})]})});Tge.displayName="FloatGeneratorArithmeticSequenceSettings";const Dge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(r=>{t({...e,start:r})},[t,e]),i=h.useCallback(r=>{t({...e,end:r})},[t,e]),o=h.useCallback(r=>{t({...e,count:r})},[t,e]);return a.jsxs(A,{gap:2,alignItems:"flex-end",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.start")}),a.jsx(Pe,{value:e.start,onChange:s,min:-1/0,max:1/0,step:.01,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.end")}),a.jsx(Pe,{value:e.end,onChange:i,min:-1/0,max:1/0,step:.01,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.count")}),a.jsx(Pe,{value:e.count,onChange:o,min:1,max:1/0,allowMath:!0})]})]})});Dge.displayName="FloatGeneratorLinearDistributionSettings";const Nht=1024*128,sg=h.memo(({value:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(l=>{const c=l[0];if(!c)return;const d=new FileReader;d.onload=()=>{const u=d.result;Tf(u)&&t(u)},d.onerror=()=>{pe({title:"Failed to load file",status:"error"})},d.readAsText(c)},[t]),{getInputProps:i,getRootProps:o}=oc({accept:{"text/csv":[".csv"],"text/plain":[".txt"]},maxSize:Nht,onDropAccepted:s,noDrag:!0,multiple:!1}),r=h.useCallback(l=>{t(l.target.value)},[t]);return a.jsxs(te,{orientation:"vertical",position:"relative",alignItems:"stretch",children:[a.jsxs(ne,{m:0,display:"flex",alignItems:"center",children:[n("common.input"),a.jsx(At,{}),a.jsx(oe,{tooltip:n("nodes.generatorLoadFromFile"),"aria-label":n("nodes.generatorLoadFromFile"),icon:a.jsx(zMe,{}),variant:"link",...o()}),a.jsx("input",{...i()})]}),a.jsx(no,{className:`${bt} ${ar} ${kn}`,value:e,onChange:r,p:2,resize:"none",rows:5,fontSize:"sm"})]})});sg.displayName="GeneratorTextareaWithFileUpload";const Mge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=h.useCallback(o=>{t({...e,input:o})},[t,e]);return a.jsxs(A,{gap:2,flexDir:"column",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("nodes.splitOn")}),a.jsx(Nt,{value:e.splitOn,onChange:s})]}),a.jsx(sg,{value:e.input,onChange:i})]})});Mge.displayName="FloatGeneratorParseStringSettings";const Lge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(c=>{t({...e,min:c})},[t,e]),i=h.useCallback(c=>{t({...e,max:c})},[t,e]),o=h.useCallback(c=>{t({...e,count:c})},[t,e]),r=h.useCallback(()=>{t({...e,seed:st(e.seed)?0:null})},[t,e]),l=h.useCallback(c=>{t({...e,seed:c})},[t,e]);return a.jsx(A,{gap:2,flexDir:"column",children:a.jsxs(A,{gap:2,alignItems:"flex-end",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.min")}),a.jsx(Pe,{value:e.min,onChange:s,min:-1/0,max:1/0,step:.01,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.max")}),a.jsx(Pe,{value:e.max,onChange:i,min:-1/0,max:1/0,step:.01,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.count")}),a.jsx(Pe,{value:e.count,onChange:o,min:1,max:1/0,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsxs(ne,{alignItems:"center",justifyContent:"space-between",m:0,display:"flex",w:"full",children:[n("common.seed"),a.jsx(us,{onChange:r,isChecked:!st(e.seed)})]}),a.jsx(Pe,{isDisabled:st(e.seed),value:e.seed??"...",onChange:l,min:-1/0,max:1/0,allowMath:!0})]})]})})});Lge.displayName="FloatGeneratorUniformRandomDistributionSettings";const Fht=mr({}).options,Rge=h.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=T(),i=Q(),o=h.useCallback(d=>{i(rR({nodeId:t,fieldName:n.name,value:d}))},[i,n.name,t]),r=h.useCallback(d=>{const u=hSe(d.target.value);u&&i(rR({nodeId:t,fieldName:n.name,value:u}))},[i,n.name,t]),[l]=el(n,300),c=h.useMemo(()=>{if(l.value.type===eI&&st(l.value.seed)){const{count:u}=l.value;return`<${s("nodes.generatorNRandomValues",{count:u})}>`}const d=YG(l);return d.length===0?`<${s("nodes.generatorNoValues")}>`:d.map(u=>Vh(u,2)).join(", ")},[l,s]);return a.jsxs(A,{flexDir:"column",gap:2,flexGrow:1,children:[a.jsxs(Mi,{className:`${kn} ${bt}`,onChange:r,value:n.value.type,size:"sm",children:[a.jsx("option",{value:lR,children:s("nodes.arithmeticSequence")}),a.jsx("option",{value:cR,children:s("nodes.linearDistribution")}),a.jsx("option",{value:eI,children:s("nodes.uniformRandomDistribution")}),a.jsx("option",{value:dR,children:s("nodes.parseString")})]}),n.value.type===lR&&a.jsx(Tge,{state:n.value,onChange:o}),n.value.type===cR&&a.jsx(Dge,{state:n.value,onChange:o}),n.value.type===eI&&a.jsx(Lge,{state:n.value,onChange:o}),n.value.type===dR&&a.jsx(Mge,{state:n.value,onChange:o}),a.jsx(A,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:a.jsx(A,{w:"full",h:"auto",children:a.jsx(ti,{className:`${kn} ${bt}`,defer:!0,style:ic,options:Fht,children:a.jsx(q,{className:`${kn} ${bt}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:c})})})})]})});Rge.displayName="FloatGeneratorFieldInputComponent";const Bht=mr({}).options,zht={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},Oge=h.memo(e=>{const{t}=T(),{nodeId:n,field:s}=e,i=Ze(),o=hb(s.name),r=h.useMemo(()=>PP.getData({fieldIdentifier:{nodeId:n,fieldName:s.name}}),[s,n]),l=h.useCallback(d=>{i.dispatch(VA({nodeId:n,fieldName:s.name,value:d}))},[i,n,s.name]),c=h.useCallback(d=>{const u=s.value?[...s.value]:[];u.splice(d,1),i.dispatch(VA({nodeId:n,fieldName:s.name,value:u}))},[s.name,s.value,n,i]);return a.jsxs(A,{className:bt,position:"relative",w:"full",h:"full",minH:16,maxH:64,alignItems:"stretch",justifyContent:"center",children:[(!s.value||s.value.length===0)&&a.jsx(V7e,{w:"full",h:"auto",isError:o,onUpload:l,fontSize:24}),s.value&&s.value.length>0&&a.jsx(ke,{w:"full",h:"auto",p:1,sx:zht,"data-error":o,borderRadius:"base",children:a.jsx(ti,{className:kn,defer:!0,style:ic,options:Bht,children:a.jsx(Ms,{w:"full",h:"full",templateColumns:"repeat(4, 1fr)",gap:1,children:s.value.map((d,u)=>a.jsx(_t,{position:"relative",className:bt,children:a.jsx(Nge,{value:d,index:u,onRemoveImage:c})},u))})})}),a.jsx(ds,{dndTarget:PP,dndTargetData:r,label:t("gallery.drop")})]})});Oge.displayName="ImageFieldCollectionInputComponent";const Nge=h.memo(({value:e,index:t,onRemoveImage:n})=>{const s=eu(e.image_name),i=h.useCallback(()=>{n(t)},[t,n]);return s.isLoading?a.jsx(m1,{}):s.data?a.jsxs(a.Fragment,{children:[a.jsx(lc,{borderRadius:"base",imageDTO:s.data,asThumbnail:!0,objectFit:"contain",w:"full",h:"full",aspectRatio:"1/1",backgroundSize:8,backgroundImage:Qh}),a.jsx(nr,{onClick:i,icon:a.jsx(fn,{}),tooltip:"Remove Image from Collection",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]}):a.jsxs(a.Fragment,{children:[a.jsx(On,{icon:V4}),a.jsx(nr,{onClick:i,icon:a.jsx(fn,{}),tooltip:"Remove Image from Collection",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]})});Nge.displayName="ImageGridItemContent";const Fge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(o=>{t({...e,category:o})},[t,e]),i=h.useCallback(o=>{t({...e,board_id:o})},[t,e]);return a.jsxs(A,{gap:2,flexDir:"column",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.board")}),a.jsx($ht,{board_id:e.board_id,onChange:i})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("nodes.generatorImagesCategory")}),a.jsx(Ght,{category:e.category,onChange:s})]})]})});Fge.displayName="ImageGeneratorImagesFromBoardSettings";const Vht={include_archived:!1},$ht=({board_id:e,onChange:t})=>{const{t:n}=T(),s=Oh(Vht),i=h.useMemo(()=>s.data?s.data.map(c=>({label:c.board_name,value:c.board_id})):os,[s.data]),o=h.useCallback(c=>{c&&t(c.value)},[t]),r=h.useMemo(()=>i.find(c=>c.value===e)??null,[e,i]),l=h.useCallback(()=>n("boards.noMatching"),[n]);return a.jsx(pt,{className:`${kn} ${bt}`,value:r,options:i,onChange:o,placeholder:n("boards.selectBoard"),noOptionsMessage:l})},Ght=({category:e,onChange:t})=>{const{t:n}=T(),s=h.useMemo(()=>[{label:n("gallery.images"),value:"images"},{label:n("gallery.assets"),value:"assets"}],[n]),i=h.useCallback(l=>{!l||l.value!=="images"&&l.value!=="assets"||t(l.value)},[t]),o=h.useMemo(()=>s.find(l=>l.value===e),[s,e]),r=h.useCallback(()=>n("boards.noMatching"),[n]);return a.jsx(pt,{className:`${kn} ${bt}`,value:o,options:s,onChange:i,placeholder:n("boards.selectBoard"),noOptionsMessage:r})},Hht=mr({}).options,Bge=h.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=T(),i=Q(),o=h.useCallback(u=>{i(uR({nodeId:t,fieldName:n.name,value:u}))},[i,n.name,t]),r=h.useCallback(u=>{const p=pSe(u.target.value);i(uR({nodeId:t,fieldName:n.name,value:p}))},[i,n.name,t]),[l,c]=h.useState(null),d=h.useMemo(()=>pr(async u=>{const p=await qG(u,i);p.length===0?c(`<${s("nodes.generatorNoValues")}>`):c(`<${s("nodes.generatorImages",{count:p.length})}>`)},300),[i,s]);return h.useEffect(()=>{d(n)},[n,d]),a.jsxs(A,{flexDir:"column",gap:2,flexGrow:1,children:[a.jsx(Mi,{className:`${kn} ${bt}`,onChange:r,value:n.value.type,size:"sm",children:a.jsx("option",{value:hR,children:s("nodes.generatorImagesFromBoard")})}),n.value.type===hR&&a.jsx(Fge,{state:n.value,onChange:o}),a.jsx(A,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:a.jsx(A,{w:"full",h:"auto",children:a.jsx(ti,{className:`${kn} ${bt}`,defer:!0,style:ic,options:Hht,children:a.jsx(q,{className:`${kn} ${bt}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:l})})})})]})});Bge.displayName="ImageGeneratorFieldInputComponent";const Wht=mr({}).options,Uht={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},zge=h.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=Ze(),{t:o}=T(),r=hb(n.name),l=h.useCallback(v=>{i.dispatch(fSe({nodeId:t,fieldName:n.name,value:v}))},[n.name,t,i]),c=h.useCallback(v=>{const b=n.value?[...n.value]:[];b.splice(v,1),l(b)},[n.value,l]),d=h.useCallback((v,b)=>{const C=n.value?[...n.value]:[];C[v]=b,l(C)},[n.value,l]),u=h.useCallback(()=>{const v=n.value?[...n.value,0]:[0];l(v)},[n.value,l]),p=h.useMemo(()=>{let v=-Vr;return st(s.minimum)||(v=s.minimum),st(s.exclusiveMinimum)||(v=s.exclusiveMinimum+.01),v},[s.exclusiveMinimum,s.minimum]),m=h.useMemo(()=>{let v=Vr;return st(s.maximum)||(v=s.maximum),st(s.exclusiveMaximum)||(v=s.exclusiveMaximum-.01),v},[s.exclusiveMaximum,s.maximum]),f=h.useMemo(()=>st(s.multipleOf)?1:s.multipleOf,[s.multipleOf]),g=h.useMemo(()=>st(s.multipleOf)?1:s.multipleOf,[s.multipleOf]);return a.jsxs(A,{className:bt,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:Uht,"data-error":r,borderRadius:"base",flexDir:"column",gap:1,children:[a.jsx(he,{onClick:u,variant:"ghost",children:o("nodes.addItem")}),n.value&&n.value.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(vt,{}),a.jsx(ti,{className:kn,defer:!0,style:ic,options:Wht,children:a.jsx(Ms,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((v,b)=>a.jsx(Vge,{value:v,index:b,min:p,max:m,step:f,fineStep:g,onRemoveNumber:c,onChangeNumber:d},b))})})]})]})});zge.displayName="IntegerFieldCollectionInputComponent";const Vge=h.memo(({value:e,index:t,min:n,max:s,step:i,fineStep:o,onRemoveNumber:r,onChangeNumber:l})=>{const{t:c}=T(),d=h.useCallback(()=>{r(t)},[t,r]),u=h.useCallback(p=>{l(t,Math.floor(p))},[t,l]);return a.jsxs(a.Fragment,{children:[a.jsx(_t,{children:a.jsxs(ne,{ps:1,m:0,children:[t+1,"."]})}),a.jsx(_t,{children:a.jsx(Pe,{onChange:u,value:e,min:n,max:s,step:i,fineStep:o,className:bt,flexGrow:1,allowMath:!0})}),a.jsx(_t,{children:a.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:d,icon:a.jsx(fn,{}),"aria-label":c("common.delete")})})]})});Vge.displayName="IntegerListItemContent";const $ge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(r=>{t({...e,start:r})},[t,e]),i=h.useCallback(r=>{t({...e,step:r})},[t,e]),o=h.useCallback(r=>{t({...e,count:r})},[t,e]);return a.jsxs(A,{gap:2,alignItems:"flex-end",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.start")}),a.jsx(Pe,{value:e.start,onChange:s,min:-1/0,max:1/0,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.step")}),a.jsx(Pe,{value:e.step,onChange:i,min:-1/0,max:1/0,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.count")}),a.jsx(Pe,{value:e.count,onChange:o,min:1,max:1/0,allowMath:!0})]})]})});$ge.displayName="IntegerGeneratorArithmeticSequenceSettings";const Gge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(r=>{t({...e,start:r})},[t,e]),i=h.useCallback(r=>{t({...e,end:r})},[t,e]),o=h.useCallback(r=>{t({...e,count:r})},[t,e]);return a.jsxs(A,{gap:2,alignItems:"flex-end",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.start")}),a.jsx(Pe,{value:e.start,onChange:s,min:-1/0,max:1/0,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.end")}),a.jsx(Pe,{value:e.end,onChange:i,min:-1/0,max:1/0,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.count")}),a.jsx(Pe,{value:e.count,onChange:o,min:1,max:1/0,allowMath:!0})]})]})});Gge.displayName="IntegerGeneratorLinearDistributionSettings";const Hge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=h.useCallback(o=>{t({...e,input:o})},[t,e]);return a.jsxs(A,{gap:2,flexDir:"column",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("nodes.splitOn")}),a.jsx(Nt,{value:e.splitOn,onChange:s})]}),a.jsx(sg,{value:e.input,onChange:i})]})});Hge.displayName="IntegerGeneratorParseStringSettings";const Wge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(c=>{t({...e,min:c})},[t,e]),i=h.useCallback(c=>{t({...e,max:c})},[t,e]),o=h.useCallback(c=>{t({...e,count:c})},[t,e]),r=h.useCallback(()=>{t({...e,seed:st(e.seed)?0:null})},[t,e]),l=h.useCallback(c=>{t({...e,seed:c})},[t,e]);return a.jsx(A,{gap:2,flexDir:"column",children:a.jsxs(A,{gap:2,alignItems:"flex-end",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.min")}),a.jsx(Pe,{value:e.min,onChange:s,min:-1/0,max:1/0,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.max")}),a.jsx(Pe,{value:e.max,onChange:i,min:-1/0,max:1/0,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.count")}),a.jsx(Pe,{value:e.count,onChange:o,min:1,max:1/0,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsxs(ne,{alignItems:"center",justifyContent:"space-between",m:0,display:"flex",w:"full",children:[n("common.seed"),a.jsx(us,{onChange:r,isChecked:!st(e.seed)})]}),a.jsx(Pe,{isDisabled:st(e.seed),value:e.seed??"...",onChange:l,min:-1/0,max:1/0,allowMath:!0})]})]})})});Wge.displayName="IntegerGeneratorUniformRandomDistributionSettings";const qht=mr({}).options,Uge=h.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=T(),i=Q(),o=h.useCallback(d=>{i(pR({nodeId:t,fieldName:n.name,value:d}))},[i,n.name,t]),r=h.useCallback(d=>{const u=mSe(d.target.value);i(pR({nodeId:t,fieldName:n.name,value:u}))},[i,n.name,t]),[l]=el(n,300),c=h.useMemo(()=>{if(l.value.type===tI&&st(l.value.seed)){const{count:u}=l.value;return`<${s("nodes.generatorNRandomValues",{count:u})}>`}const d=JG(l);return d.length===0?`<${s("nodes.generatorNoValues")}>`:d.map(u=>Vh(u,2)).join(", ")},[l,s]);return a.jsxs(A,{flexDir:"column",gap:2,flexGrow:1,children:[a.jsxs(Mi,{className:`${kn} ${bt}`,onChange:r,value:n.value.type,size:"sm",children:[a.jsx("option",{value:fR,children:s("nodes.arithmeticSequence")}),a.jsx("option",{value:mR,children:s("nodes.linearDistribution")}),a.jsx("option",{value:tI,children:s("nodes.uniformRandomDistribution")}),a.jsx("option",{value:gR,children:s("nodes.parseString")})]}),n.value.type===fR&&a.jsx($ge,{state:n.value,onChange:o}),n.value.type===mR&&a.jsx(Gge,{state:n.value,onChange:o}),n.value.type===tI&&a.jsx(Wge,{state:n.value,onChange:o}),n.value.type===gR&&a.jsx(Hge,{state:n.value,onChange:o}),a.jsx(A,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:a.jsx(A,{w:"full",h:"auto",children:a.jsx(ti,{className:`${kn} ${bt}`,defer:!0,style:ic,options:qht,children:a.jsx(q,{className:`${kn} ${bt}`,fontFamily:"monospace",userSelect:"text",cursor:"text",children:c})})})})]})});Uge.displayName="IntegerGeneratorFieldInputComponent";const Kht=({value:e,modelConfigs:t,isLoadingConfigs:n,onChange:s,required:i,groupByType:o})=>{const{options:r,value:l,onChange:c,placeholder:d,noOptionsMessage:u}=Jh({modelConfigs:t,onChange:s,isLoading:n,selectedModel:e,groupByType:o});return a.jsx(te,{className:`${kn} ${bt}`,isDisabled:!r.length,isInvalid:!l&&i,gap:2,children:a.jsx(pt,{value:l,placeholder:i?d:`(Optional) ${d}`,options:r,onChange:c,noOptionsMessage:u})})},Zht=sn(Kht),Xht=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=Q(),{data:o,isLoading:r}=Fh(),l=h.useCallback(d=>{d&&i(gSe({nodeId:t,fieldName:n.name,value:d}))},[i,n.name,t]),c=h.useMemo(()=>o?!s.ui_model_base&&!s.ui_model_type?$l.selectAll(o):$l.selectAll(o).filter(d=>!(s.ui_model_base&&!s.ui_model_base.includes(d.base)||s.ui_model_type&&!s.ui_model_type.includes(d.type)||s.ui_model_variant&&"variant"in d&&d.variant&&!s.ui_model_variant.includes(d.variant)||s.ui_model_format&&!s.ui_model_format.includes(d.format))):os,[o,s]);return a.jsx(Zht,{value:n.value,modelConfigs:c,isLoadingConfigs:r,onChange:l,required:e.fieldTemplate.required,groupByType:!0})},Yht=h.memo(Xht),Qht=mr({}).options,Jht={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},qge=h.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=T(),i=Ze(),o=hb(n.name),r=h.useCallback(d=>{const u=n.value?[...n.value]:[];u.splice(d,1),i.dispatch(nI({nodeId:t,fieldName:n.name,value:u}))},[n.name,n.value,t,i]),l=h.useCallback((d,u)=>{const p=n.value?[...n.value]:[];p[d]=u,i.dispatch(nI({nodeId:t,fieldName:n.name,value:p}))},[n.name,n.value,t,i]),c=h.useCallback(()=>{const d=n.value?[...n.value,""]:[""];i.dispatch(nI({nodeId:t,fieldName:n.name,value:d}))},[n.name,n.value,t,i]);return a.jsxs(A,{className:bt,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:Jht,"data-error":o,borderRadius:"base",flexDir:"column",gap:1,children:[a.jsx(he,{onClick:c,variant:"ghost",children:s("nodes.addItem")}),n.value&&n.value.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(vt,{}),a.jsx(ti,{className:kn,defer:!0,style:ic,options:Qht,children:a.jsx(Ms,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((d,u)=>a.jsx(Kge,{value:d,index:u,onRemoveString:r,onChangeString:l},u))})})]})]})});qge.displayName="StringFieldCollectionInputComponent";const Kge=h.memo(({value:e,index:t,onRemoveString:n,onChangeString:s})=>{const{t:i}=T(),o=h.useCallback(()=>{n(t)},[t,n]),r=h.useCallback(l=>{s(t,l.target.value)},[t,s]);return a.jsxs(a.Fragment,{children:[a.jsx(_t,{children:a.jsxs(q,{variant:"subtext",textAlign:"center",minW:8,children:[t+1,"."]})}),a.jsx(_t,{children:a.jsx(Nt,{placeholder:i("workflows.emptyStringPlaceholder"),size:"sm",resize:"none",value:e,onChange:r})}),a.jsx(_t,{children:a.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",minW:8,minH:8,onClick:o,icon:a.jsx(fn,{}),"aria-label":i("common.delete")})})]})});Kge.displayName="ListItemContent";const Zge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(o=>{t({...e,input:o})},[t,e]),i=h.useCallback(o=>{t({...e,maxPrompts:o})},[t,e]);return a.jsxs(A,{gap:2,flexDir:"column",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("dynamicPrompts.maxPrompts")}),a.jsx(Pe,{value:e.maxPrompts,onChange:i,min:1,max:1e3,w:"full",allowMath:!0})]}),a.jsx(sg,{value:e.input,onChange:s})]})});Zge.displayName="StringGeneratorDynamicPromptsCombinatorialSettings";const Xge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(l=>{t({...e,input:l})},[t,e]),i=h.useCallback(l=>{t({...e,count:l})},[t,e]),o=h.useCallback(()=>{t({...e,seed:st(e.seed)?0:null})},[t,e]),r=h.useCallback(l=>{t({...e,seed:l})},[t,e]);return a.jsxs(A,{gap:2,flexDir:"column",children:[a.jsxs(A,{gap:2,children:[a.jsxs(te,{orientation:"vertical",children:[a.jsxs(ne,{alignItems:"center",justifyContent:"space-between",display:"flex",w:"full",pe:.5,children:[n("common.seed"),a.jsx(us,{onChange:o,isChecked:!st(e.seed)})]}),a.jsx(Pe,{isDisabled:st(e.seed),value:e.seed??"...",onChange:r,min:-1/0,max:1/0,allowMath:!0})]}),a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("common.count")}),a.jsx(Pe,{value:e.count,onChange:i,min:1,max:1e3,allowMath:!0})]})]}),a.jsx(sg,{value:e.input,onChange:s})]})});Xge.displayName="StringGeneratorDynamicPromptsRandomSettings";const Yge=h.memo(({state:e,onChange:t})=>{const{t:n}=T(),s=h.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=h.useCallback(o=>{t({...e,input:o})},[t,e]);return a.jsxs(A,{gap:2,flexDir:"column",children:[a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{children:n("nodes.splitOn")}),a.jsx(Nt,{value:e.splitOn,onChange:s})]}),a.jsx(sg,{value:e.input,onChange:i})]})});Yge.displayName="StringGeneratorParseStringSettings";const ept=mr({}).options,Qge=h.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=T(),i=Q(),o=h.useCallback(u=>{i(vR({nodeId:t,fieldName:n.name,value:u}))},[i,n.name,t]),r=h.useCallback(u=>{const p=vSe(u.target.value);i(vR({nodeId:t,fieldName:n.name,value:p}))},[i,n.name,t]),[l,c]=h.useState(null),d=h.useMemo(()=>pr(async u=>{const p=await ZG(u,i);p.length===0?c(`<${s("nodes.generatorNoValues")}>`):c(p.join(", "))},300),[i,s]);return h.useEffect(()=>{d(n)},[n,d]),a.jsxs(A,{flexDir:"column",gap:2,flexGrow:1,children:[a.jsxs(Mi,{className:`${kn} ${bt}`,onChange:r,value:n.value.type,size:"sm",children:[a.jsx("option",{value:yR,children:s("nodes.parseString")}),a.jsx("option",{value:bR,children:s("nodes.dynamicPromptsRandom")}),a.jsx("option",{value:xR,children:s("nodes.dynamicPromptsCombinatorial")})]}),n.value.type===yR&&a.jsx(Yge,{state:n.value,onChange:o}),n.value.type===bR&&a.jsx(Xge,{state:n.value,onChange:o}),n.value.type===xR&&a.jsx(Zge,{state:n.value,onChange:o}),a.jsx(A,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:a.jsx(A,{w:"full",h:"auto",children:a.jsx(ti,{className:`${kn} ${bt}`,defer:!0,style:ic,options:ept,children:a.jsx(q,{className:`${kn} ${bt}`,fontFamily:"monospace",userSelect:"text",cursor:"text",whiteSpace:"pre",children:l})})})})]})});Qge.displayName="StringGeneratorFieldInputComponent";const fb=(e,t,n,s={})=>{const{showShuffle:i,min:o,max:r,step:l}=s,c=Q(),d=h.useMemo(()=>l!==void 0?l:st(n.multipleOf)?1:n.multipleOf,[n.multipleOf,l]),u=h.useMemo(()=>l!==void 0?l:st(n.multipleOf)?1:n.multipleOf,[n.multipleOf,l]),p=h.useMemo(()=>{let b=-Vr;return o!==void 0?b=o:st(n.minimum)?st(n.exclusiveMinimum)||(b=n.exclusiveMinimum+1):b=n.minimum,k_(b,d)},[n.exclusiveMinimum,n.minimum,o,d]),m=h.useMemo(()=>{let b=Vr;return r!==void 0?b=r:st(n.maximum)?st(n.exclusiveMaximum)||(b=n.exclusiveMaximum-1):b=n.maximum,Pf(b,d)},[n.exclusiveMaximum,n.maximum,r,d]),f=h.useCallback(b=>ng(b,{min:p,max:m,step:d},{min:o,max:r,step:l}),[m,p,r,o,l,d]),g=h.useCallback(b=>{c(X2({nodeId:e,fieldName:t,value:b}))},[c,t,e]),v=h.useCallback(()=>{const b=Math.round(Ede(p,m)/d)*d;c(X2({nodeId:e,fieldName:t,value:b}))},[c,t,e,p,m,d]);return{defaultValue:n.default,onChange:g,min:p,max:m,step:d,fineStep:u,constrainValue:f,showShuffle:i,randomizeValue:v}},_D=h.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:r,min:l,max:c,step:d,fineStep:u,constrainValue:p,showShuffle:m,randomizeValue:f}=fb(t,n.name,s,i),{t:g}=T();return a.jsxs(a.Fragment,{children:[a.jsx(Pe,{defaultValue:o,onChange:r,value:n.value,min:l,max:c,step:d,fineStep:u,className:bt,flex:"1 1 0",constrainValue:p,allowMath:!0}),m&&a.jsx(he,{size:"sm",isDisabled:!1,onClick:f,leftIcon:a.jsx(Uh,{}),flexShrink:0,children:g("workflows.builder.shuffle")})]})});_D.displayName="IntegerFieldInput";const Jge=h.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:r,min:l,max:c,step:d,fineStep:u,constrainValue:p,showShuffle:m,randomizeValue:f}=fb(t,n.name,s,i),{t:g}=T();return a.jsxs(a.Fragment,{children:[a.jsx(it,{defaultValue:o,onChange:r,value:n.value,min:l,max:c,step:d,fineStep:u,className:bt,marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),a.jsx(Pe,{defaultValue:o,onChange:r,value:n.value,min:l,max:c,step:d,fineStep:u,className:bt,flex:"1 1 0",constrainValue:p,allowMath:!0}),m&&a.jsx(he,{size:"sm",isDisabled:!1,onClick:f,leftIcon:a.jsx(Uh,{}),flexShrink:0,children:g("workflows.builder.shuffle")})]})});Jge.displayName="IntegerFieldInputAndSlider";const e0e=h.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s,settings:i}=e,{defaultValue:o,onChange:r,min:l,max:c,step:d,fineStep:u,showShuffle:p,randomizeValue:m}=fb(t,n.name,s,i),{t:f}=T();return a.jsxs(a.Fragment,{children:[a.jsx(it,{defaultValue:o,onChange:r,value:n.value,min:l,max:c,step:d,fineStep:u,className:bt,marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),p&&a.jsx(he,{size:"sm",isDisabled:!1,onClick:m,leftIcon:a.jsx(Uh,{}),flexShrink:0,children:f("workflows.builder.shuffle")})]})});e0e.displayName="IntegerFieldSlider";const cL=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=Q(),o=h.useCallback(r=>{i(ySe({nodeId:t,fieldName:n.name,value:r.target.value}))},[i,n.name,t]);return{value:n.value,onChange:o,defaultValue:s.default}},t0e=h.memo(e=>{const{value:t,onChange:n}=cL(e);return a.jsx(Mi,{onChange:n,className:`${bt} ${ar} ${kn}`,isDisabled:e.settings.options.length===0,value:t,children:e.settings.options.map((s,i)=>a.jsx("option",{value:s.value,children:s.label||s.value||`Option ${i+1}`},`${i}_${s.value}`))})});t0e.displayName="StringFieldDropdown";const SD=h.memo(e=>{const{value:t,onChange:n}=cL(e),{t:s}=T();return a.jsx(Nt,{className:`${bt} ${ar} ${kn}`,placeholder:s("workflows.emptyStringPlaceholder"),value:t,onChange:n})});SD.displayName="StringFieldInput";const kD=h.memo(e=>{const{t}=T(),{value:n,onChange:s}=cL(e);return a.jsx(no,{className:`${bt} ${ar} ${kn}`,placeholder:t("workflows.emptyStringPlaceholder"),value:n,onChange:s,h:"full",fontSize:"sm",p:2})});kD.displayName="StringFieldTextarea";const tpt={include_archived:!0},npt=e=>e==="auto"||e==="none"?e:{board_id:e},spt=e=>{const{nodeId:t,field:n}=e,s=Q(),{t:i}=T(),o=Oh(tpt),r=h.useMemo(()=>({label:i("common.auto"),value:"auto"}),[i]),l=h.useMemo(()=>({label:`${i("common.none")} (${i("boards.uncategorized")})`,value:"none"}),[i]),c=h.useMemo(()=>{const m=[r,l];if(o.data)for(const f of o.data)m.push({label:f.board_name,value:f.board_id});return m},[r,o.data,l]),d=h.useCallback(m=>{if(!m)return;const f=npt(m.value);s(bSe({nodeId:t,fieldName:n.name,value:f}))},[s,n.name,t]),u=h.useMemo(()=>{const m=n.value;return!m||m==="auto"?r:m==="none"?l:c.find(g=>g.value===m.board_id)??r},[n.value,c,r,l]),p=h.useCallback(()=>i("boards.noMatching"),[i]);return a.jsx(pt,{className:`${kn} ${bt}`,value:u,options:c,onChange:d,placeholder:i("boards.selectBoard"),noOptionsMessage:p})},ipt=h.memo(spt),opt=e=>{const{nodeId:t,field:n}=e,s=Q(),i=h.useCallback(o=>{s(xSe({nodeId:t,fieldName:n.name,value:o.target.checked}))},[s,n.name,t]);return a.jsx(mt,{className:`${bt} ${Xc}`,onChange:i,isChecked:n.value})},apt=h.memo(opt),rpt={r:0,g:0,b:0,a:255},lpt=e=>{const{nodeId:t,field:n}=e,s=Q(),i=h.useMemo(()=>{if(!n.value)return rpt;const{r,g:l,b:c,a:d}=n.value;return{r,g:l,b:c,a:d/255}},[n.value]),o=h.useCallback(r=>{typeof r=="string"&&(r=kse(r,1));const{r:l,g:c,b:d,a:u}=r,p=Math.round(u*255);s(CSe({nodeId:t,fieldName:n.name,value:{r:l,g:c,b:d,a:p}}))},[s,n.name,t]);return a.jsxs(A,{flexDir:"column",gap:2,w:"full",children:[a.jsx(cWe,{style:{background:Nr("base.700"),color:Nr("base.100"),fontSize:12,paddingInlineStart:10,borderRadius:4,paddingBlock:4,outline:"none"},className:bt,color:k2(i,!0),onChange:o,prefixed:!0,alpha:!0}),a.jsx(Mie,{className:bt,color:i,onChange:o,style:{width:"100%"}})]})},cpt=h.memo(lpt),dpt=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=Q(),o=h.useCallback(r=>{i(wSe({nodeId:t,fieldName:n.name,value:r.target.value}))},[i,n.name,t]);return a.jsx(Mi,{className:`${kn} ${bt}`,onChange:o,value:n.value,size:"sm",children:s.options.map(r=>a.jsx("option",{value:r,children:s.ui_choice_labels?s.ui_choice_labels[r]:r},r))})},upt=h.memo(dpt),hpt=e=>{const{t}=T(),{nodeId:n,field:s,fieldTemplate:i}=e,o=Q(),r=le(ks),{currentData:l,isError:c}=eu(s.value?.image_name??Ri),d=h.useCallback(()=>{o(zA({nodeId:n,fieldName:s.name,value:void 0}))},[o,s.name,n]),u=h.useMemo(()=>AP.getData({fieldIdentifier:{nodeId:n,fieldName:s.name}},s.value?.image_name),[s,n]);h.useEffect(()=>{r&&c&&d()},[d,r,c]);const p=h.useCallback(m=>{o(zA({nodeId:n,fieldName:s.name,value:m}))},[o,s.name,n]);return a.jsxs(A,{position:"relative",className:bt,w:"full",h:32,alignItems:"stretch",children:[!l&&a.jsx(C1,{w:"full",h:"auto",isError:i.required&&!s.value,onUpload:p,fontSize:24}),l&&a.jsxs(a.Fragment,{children:[a.jsx(A,{borderRadius:"base",borderWidth:1,borderStyle:"solid",overflow:"hidden",children:a.jsx(lc,{imageDTO:l,asThumbnail:!0})}),a.jsx(q,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",insetInlineEnd:1,insetBlockEnd:1,opacity:.7,px:2,borderRadius:"base",pointerEvents:"none",children:`${l.width}x${l.height}`})]}),a.jsx(ds,{dndTarget:AP,dndTargetData:u,label:t("gallery.drop")})]})},ppt=h.memo(hpt),fpt=h.memo(()=>{const{t:e}=T();return a.jsx(A,{h:16,w:"full",alignItems:"center",justifyContent:"center",children:a.jsx(q,{fontSize:16,fontWeight:"semibold",children:e("gallery.dropOrUpload")})})});fpt.displayName="UploadElement";const mpt=e=>{const{nodeId:t,field:n}=e,s=Q(),i=h.useCallback(r=>{Uy(r?.value)&&s(_Se({nodeId:t,fieldName:n.name,value:r.value}))},[s,n.name,t]),o=h.useMemo(()=>Hl.find(r=>r.value===n?.value),[n?.value]);return a.jsx(te,{className:`${kn} ${bt} ${Xc}`,children:a.jsx(pt,{value:o,options:Hl,onChange:i})})},gpt=h.memo(mpt),vpt=e=>{const{nodeId:t,field:n}=e,s=Q(),{t:i}=T(),{data:o,isLoading:r}=lm(),l=h.useMemo(()=>{const p=[];if(o)for(const m of o)p.push({label:m.name,value:m.id});return p},[o]),c=h.useCallback(p=>{p&&s(SSe({nodeId:t,fieldName:n.name,value:{style_preset_id:p.value}}))},[s,n.name,t]),d=h.useMemo(()=>{const p=n.value;return p?l.find(m=>m.value===p.style_preset_id)??null:null},[n.value,l]),u=h.useCallback(()=>i("stylePresets.noMatchingPresets"),[i]);return a.jsx(pt,{className:`${kn} ${bt}`,value:d,options:l,onChange:c,placeholder:i(r?"common.loading":"stylePresets.selectPreset"),noOptionsMessage:u})},ypt=h.memo(vpt),zk=h.memo(({nodeId:e,fieldName:t,settings:n})=>{const s=rp(t),i=dc(t);if(sH(i))return FD(s)?a.jsx(qge,{nodeId:e,field:s,fieldTemplate:i}):null;if(Nq(i)){if(!kSe(s))return null;if(!n||n.type!=="string-field-config")return i.ui_component==="textarea"?a.jsx(kD,{nodeId:e,field:s,fieldTemplate:i}):a.jsx(SD,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="input")return a.jsx(SD,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="textarea")return a.jsx(kD,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="dropdown")return a.jsx(t0e,{nodeId:e,field:s,fieldTemplate:i,settings:n});ae(!1,"Unexpected settings")}if(ISe(i))return jSe(s)?a.jsx(apt,{nodeId:e,field:s,fieldTemplate:i}):null;if(B2(i)){if(!rH(s))return null;if(!n||n.type!=="integer-field-config")return a.jsx(_D,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input")return a.jsx(_D,{nodeId:e,field:s,fieldTemplate:i,settings:n});if(n.component==="slider")return a.jsx(e0e,{nodeId:e,field:s,fieldTemplate:i,settings:n});if(n.component==="number-input-and-slider")return a.jsx(Jge,{nodeId:e,field:s,fieldTemplate:i,settings:n});ae(!1,"Unexpected settings.component")}if(F2(i)){if(!aH(s))return null;if(!n||n.type!=="float-field-config")return a.jsx(wD,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input")return a.jsx(wD,{nodeId:e,field:s,fieldTemplate:i,settings:n});if(n.component==="slider")return a.jsx(Ege,{nodeId:e,field:s,fieldTemplate:i,settings:n});if(n.component==="number-input-and-slider")return a.jsx(jge,{nodeId:e,field:s,fieldTemplate:i,settings:n});ae(!1,"Unexpected settings.component")}return iH(i)?zD(s)?a.jsx(zge,{nodeId:e,field:s,fieldTemplate:i}):null:oH(i)?BD(s)?a.jsx(Age,{nodeId:e,field:s,fieldTemplate:i}):null:ESe(i)?ASe(s)?a.jsx(upt,{nodeId:e,field:s,fieldTemplate:i}):null:nH(i)?Py(s)?a.jsx(Oge,{nodeId:e,field:s,fieldTemplate:i}):null:PSe(i)?IH(s)?a.jsx(ppt,{nodeId:e,field:s,fieldTemplate:i}):null:WG(i)?ND(s)?a.jsx(ipt,{nodeId:e,field:s,fieldTemplate:i}):null:TSe(i)?DSe(s)?a.jsx(ypt,{nodeId:e,field:s,fieldTemplate:i}):null:MSe(i)?jH(s)?a.jsx(Yht,{nodeId:e,field:s,fieldTemplate:i}):null:LSe(i)?RSe(s)?a.jsx(cpt,{nodeId:e,field:s,fieldTemplate:i}):null:OSe(i)?NSe(s)?a.jsx(gpt,{nodeId:e,field:s,fieldTemplate:i}):null:FSe(i)?XG(s)?a.jsx(Rge,{nodeId:e,field:s,fieldTemplate:i}):null:BSe(i)?QG(s)?a.jsx(Uge,{nodeId:e,field:s,fieldTemplate:i}):null:zSe(i)?KG(s)?a.jsx(Qge,{nodeId:e,field:s,fieldTemplate:i}):null:VSe(i)&&UG(s)?a.jsx(Bge,{nodeId:e,field:s,fieldTemplate:i}):null});zk.displayName="InputFieldRenderer";const bpt=e=>{const t=yn(),n=h.useMemo(()=>Ut(Xu,s=>{const i=s[t.nodeId];if(!i)return os;const o=i.filter(r=>r.type==="field-error"&&r.fieldName===e);return o.length===0?os:o}),[t,e]);return le(n)},n0e=e=>{const t=yn(),n=h.useMemo(()=>t.buildSelectIsInputFieldAddedToForm(e),[t,e]);return M(n)},s0e=h.memo(({fieldName:e})=>{const{t}=T(),n=rp(e),s=dc(e),i=Nk(s.type),o=bpt(e),r=n0e(e),l=h.useMemo(()=>n.label&&s.title?`${n.label} (${s.title})`:n.label&&!s.title?n.label:s.title,[n,s]);return a.jsxs(A,{flexDir:"column",children:[a.jsxs(q,{fontWeight:"semibold",children:[l,r&&" (added to form)"]}),a.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:s.description}),a.jsxs(q,{children:[t("parameters.type"),": ",i]}),a.jsxs(q,{children:[t("common.input"),": ",i2(s.input)]}),o.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs(q,{color:"error.500",children:[t("common.error_withCount",{count:o.length}),":"]}),a.jsx(Li,{children:o.map(({issue:c})=>a.jsx(rn,{children:c},c))})]})]})});s0e.displayName="InputFieldTooltipContent";const xpt=e=>{const t=yn(),n=h.useMemo(()=>ve(t.buildSelectInputFieldTemplateOrThrow(e),s=>s.title),[t,e]);return M(n)},dL=e=>{const t=yn(),n=h.useMemo(()=>ve(t.buildSelectInputFieldSafe(e),s=>s?.label??""),[t,e]);return M(n)},Cpt={p:0,display:"flex",gap:1,alignItems:"center",fontWeight:"semibold",textAlign:"left",color:"base.300",_hover:{fontWeight:"semibold !important"},'&[data-is-added-to-form="true"]':{color:"blue.300"},'&[data-is-invalid="true"]':{color:"error.300"},'&[data-is-disabled="true"]':{opacity:.5}},uL=h.memo(e=>{const{nodeId:t,fieldName:n,isInvalid:s,isDragging:i}=e,o=h.useRef(null),r=dL(n),l=xpt(n),{t:c}=T(),d=oL(n),u=n0e(n),p=Rk(t,n,"target"),m=Ok(),f=Lk(t,n,"target"),g=Q(),v=h.useMemo(()=>l||c("nodes.unknownField"),[l,c]),b=h.useCallback(w=>{g(Fq({nodeId:t,fieldName:n,label:w}))},[g,t,n]),C=rc({value:r||v,defaultValue:v,onChange:b,inputRef:o}),y=h.useMemo(()=>m&&f!==null&&!p||d,[m,f,p,d]),x=h.useCallback(w=>{w.stopPropagation(),C.startEditing()},[C]);return C.isEditing?a.jsx(Nt,{ref:o,variant:"outline",...C.inputProps,_focusVisible:{borderRadius:"base",h:"unset",px:2}}):a.jsx(He,{label:a.jsx(s0e,{nodeId:t,fieldName:n}),openDelay:hm,placement:"top",isDisabled:i,children:a.jsxs(q,{className:Xc,sx:Cpt,noOfLines:1,"data-is-invalid":s,"data-is-disabled":y,"data-is-added-to-form":u,onDoubleClick:x,children:[C.value,u&&a.jsx(Je,{as:cX,color:s?"error.300":"blue.200",ml:1})]})})});uL.displayName="InputFieldTitle";const Vk=h.memo(({nodeId:e,fieldName:t})=>{const n=dc(t),s=hb(t),i=oL(t);return n.input==="connection"||i?a.jsx(i0e,{nodeId:e,fieldName:t,isInvalid:s,isConnected:i,fieldTemplate:n}):a.jsx(o0e,{nodeId:e,fieldName:t,isInvalid:s,isConnected:i,fieldTemplate:n})});Vk.displayName="InputFieldEditModeNodes";const i0e=h.memo(({nodeId:e,fieldName:t,isInvalid:n})=>a.jsxs(Mk,{children:[a.jsx(A,{px:2,children:a.jsx(uL,{nodeId:e,fieldName:t,isInvalid:n})}),a.jsx(rL,{nodeId:e,fieldName:t})]}));i0e.displayName="ConnectedOrConnectionField";const wpt={w:"full",px:2,flexDir:"column",gap:1,'&[data-is-dragging="true"]':{opacity:.3},pointerEvents:"auto",'&[data-is-connected="true"]':{pointerEvents:"none"},"& .direct-field-action-buttons":{display:"none"},_hover:{"& .direct-field-action-buttons":{display:"inline-flex"}}},o0e=h.memo(({nodeId:e,fieldName:t,isInvalid:n,isConnected:s,fieldTemplate:i})=>{const o=h.useRef(null),r=h.useRef(null),l=Tht(e,t,i,o,r);return a.jsxs(Mk,{children:[a.jsxs(A,{ref:o,sx:wpt,"data-is-connected":s,"data-is-dragging":l,children:[a.jsxs(A,{gap:1,children:[a.jsx(A,{className:bt,ref:r,children:a.jsx(uL,{nodeId:e,fieldName:t,isInvalid:n,isDragging:l})}),a.jsx(At,{}),a.jsxs(A,{className:"direct-field-action-buttons",children:[a.jsx(pge,{nodeId:e,fieldName:t}),a.jsx(bge,{nodeId:e,fieldName:t}),a.jsx(Ige,{nodeId:e,fieldName:t})]})]}),a.jsx(zk,{nodeId:e,fieldName:t})]}),i.input!=="direct"&&a.jsx(rL,{nodeId:e,fieldName:t})]})});o0e.displayName="DirectField";const _pt=()=>{const e=yn(),t=h.useMemo(()=>ve(e.selectNodeDataSafe,n=>n?.isIntermediate??!1),[e]);return M(t)},Spt=({nodeId:e})=>{const{t}=T(),n=Q(),s=aL(),i=_pt(),o=h.useCallback(r=>{n($Se({nodeId:e,isIntermediate:!r.target.checked}))},[n,e]);return s?a.jsxs(te,{className:ar,children:[a.jsxs(ne,{m:0,children:[t("nodes.saveToGallery")," "]}),a.jsx(us,{onChange:o,isChecked:!i})]}):null},kpt=h.memo(Spt),Ipt=()=>{const e=yn(),t=h.useMemo(()=>ve(e.selectNodeDataSafe,n=>n?.useCache??!1),[e]);return M(t)},jpt=({nodeId:e})=>{const t=Q(),n=Ipt(),s=h.useCallback(o=>{t(GSe({nodeId:e,useCache:o.target.checked}))},[t,e]),{t:i}=T();return a.jsxs(te,{className:Xc,children:[a.jsx(ne,{m:0,children:i("invocationCache.useCache")}),a.jsx(us,{className:ar,onChange:s,isChecked:n})]})},Ept=h.memo(jpt),wG={w:"unset"},Apt=({nodeId:e})=>{const t=aL(),n=uge();return a.jsx(A,{className:um,layerStyle:"nodeFooter",w:"full",borderBottomRadius:"base",gap:4,px:2,py:0,h:8,justifyContent:"space-between",children:a.jsxs(Ys,{formControlProps:wG,formLabelProps:wG,children:[n&&a.jsx(Ept,{nodeId:e}),n&&t&&a.jsx(kpt,{nodeId:e})]})})},Ppt=h.memo(Apt),Tpt=e=>h.useMemo(()=>{switch(e){case"Group 1":return"invokeGreen.300";case"Group 2":return"invokeBlue.300";case"Group 3":return"invokePurple.200";case"Group 4":return"invokeRed.300";case"Group 5":return"invokeYellow.300";default:return}},[e]),Dpt=e=>{const t=h.useMemo(()=>ve(Xn,s=>{const i=HSe(s,e);if(eo(i)&&$w(i))return i.data.inputs.batch_group_id?.value}),[e]);return M(t)},a0e=()=>{const e=yn(),t=h.useMemo(()=>ve(e.selectNodeTemplateSafe,n=>n?.title??""),[e]);return M(t)},hL=()=>{const e=yn(),t=h.useMemo(()=>ve(e.selectNodeDataSafe,n=>n?.label??""),[e]);return M(t)},Mpt={fontWeight:"semibold",'&[data-is-invalid="true"]':{color:"error.300"}},Lpt=({nodeId:e,title:t})=>{const n=Q(),s=nL(),i=hL(),o=Dpt(e),r=Tpt(o),l=a0e(),{t:c}=T(),d=h.useRef(null),u=h.useCallback(f=>{n(e4({nodeId:e,label:f}))},[n,e]),p=rc({value:i||t||l||c("nodes.problemSettingTitle"),defaultValue:t||l||c("nodes.problemSettingTitle"),onChange:u,inputRef:d}),m=h.useMemo(()=>o?o==="None"?`${p.value} (${c("nodes.noBatchGroup")})`:`${p.value} (${o})`:p.value,[o,p.value,c]);return a.jsxs(A,{overflow:"hidden",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:[!p.isEditing&&a.jsx(q,{className:Xc,sx:Mpt,noOfLines:1,color:r,"data-is-invalid":s,onDoubleClick:p.startEditing,children:m}),p.isEditing&&a.jsx(Nt,{className:bt,ref:d,...p.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},Rpt=h.memo(Lpt),Opt={transitionProperty:"transform",transitionDuration:"normal",transform:"rotate(180deg)",'&[data-is-open="true"]':{transform:"rotate(0deg)"}},Npt=({nodeId:e,isOpen:t})=>{const n=Q(),s=KM(),i=h.useCallback(()=>{n(WSe({nodeId:e,isOpen:!t})),s(e)},[n,t,e,s]);return a.jsx(oe,{className:`${bt} ${Xc}`,onClick:i,"aria-label":"Minimize",minW:8,w:8,h:8,variant:"link",icon:a.jsx(Je,{as:B4,sx:Opt,"data-is-open":t})})},pL=h.memo(Npt),Fpt=()=>{const e=Eu();return h.useMemo(()=>e.classification,[e])},Bpt=e=>{const t=Fpt();return!t||t==="stable"?null:a.jsx(He,{label:a.jsx(r0e,{classification:t}),placement:"top",shouldWrapChildren:!0,children:a.jsx(Vpt,{classification:t})})},zpt=h.memo(Bpt),r0e=h.memo(({classification:e})=>{const{t}=T();return e==="beta"?t("nodes.betaDesc"):e==="prototype"?t("nodes.prototypeDesc"):e==="internal"?t("nodes.internalDesc"):e==="special"?t("nodes.specialDesc"):null});r0e.displayName="ClassificationTooltipContent";const Vpt=({classification:e})=>e==="beta"?a.jsx(Je,{as:lX,display:"block",boxSize:4,color:"invokeYellow.300"}):e==="prototype"?a.jsx(Je,{as:G4,display:"block",boxSize:4,color:"invokeRed.300"}):e==="internal"?a.jsx(Je,{as:sX,display:"block",boxSize:4,color:"invokePurple.300"}):e==="special"?a.jsx(Je,{as:tS,display:"block",boxSize:4,color:"invokeGreen.300"}):null,_G={visibility:"hidden"},SG={borderWidth:0,borderRadius:"3px",width:"1rem",height:"1rem",backgroundColor:"var(--invoke-colors-base-600)",zIndex:-1},$pt=({nodeId:e})=>{const t=Eu();return t?a.jsxs(a.Fragment,{children:[a.jsx(jd,{type:"target",id:`${e}-collapsed-target`,isConnectable:!1,position:Ed.Left,style:SG}),Wr(t.inputs,n=>a.jsx(jd,{type:"target",id:n.name,isConnectable:!1,position:Ed.Left,style:_G},`${e}-${n.name}-collapsed-input-handle`)),a.jsx(jd,{type:"source",id:`${e}-collapsed-source`,isConnectable:!1,position:Ed.Right,style:SG}),Wr(t.outputs,n=>a.jsx(jd,{type:"source",id:n.name,isConnectable:!1,position:Ed.Right,style:_G},`${e}-${n.name}-collapsed-output-handle`))]}):null},Gpt=h.memo($pt),l0e=()=>{const e=yn(),t=h.useMemo(()=>ve(e.selectNodeDataSafe,n=>n?.notes??""),[e]);return M(t)},fL=()=>{const e=yn(),t=h.useMemo(()=>ve(e.selectNodeDataOrThrow,n=>n.version),[e]);return M(t)},c0e=h.memo(({nodeId:e})=>a.jsx(He,{label:a.jsx(d0e,{nodeId:e}),placement:"top",shouldWrapChildren:!0,children:a.jsx(Je,{as:km,display:"block",boxSize:4,w:8})}));c0e.displayName="InvocationNodeInfoIcon";const d0e=h.memo(e=>{const t=l0e(),n=hL(),s=fL(),i=Eu(),{t:o}=T(),r=h.useMemo(()=>n?`${n} (${i.title})`:i.title,[n,i.title]);return a.jsxs(A,{flexDir:"column",children:[a.jsx(q,{as:"span",fontWeight:"semibold",children:r}),a.jsxs(q,{opacity:.7,children:[o("nodes.nodePack"),": ",i.nodePack]}),a.jsx(q,{opacity:.7,fontStyle:"oblique 5deg",children:i.description}),a.jsx(Hpt,{nodeVersion:s,templateVersion:i.version}),t&&a.jsx(q,{children:t})]})});d0e.displayName="TooltipContent";const Hpt=({nodeVersion:e,templateVersion:t})=>{const{t:n}=T();return HP(e,t,"<")?a.jsxs(q,{as:"span",color:"error.500",children:[n("nodes.version")," ",e," (",n("nodes.updateNode"),")"]}):HP(e,t,">")?a.jsxs(q,{as:"span",color:"error.500",children:[n("nodes.version")," ",e," (",n("nodes.updateApp"),")"]}):a.jsxs(q,{as:"span",children:[n("nodes.version")," ",e]})},jA=3,kG={circle:{transitionProperty:"none",transitionDuration:"0s"},".chakra-progress__track":{stroke:"transparent"}},Wpt=({nodeId:e})=>{const t=q_(e);return t?a.jsx(He,{label:a.jsx(u0e,{nodeExecutionState:t}),placement:"top",children:a.jsx(A,{className:um,w:5,h:"full",alignItems:"center",justifyContent:"flex-end",children:a.jsx(h0e,{nodeExecutionState:t})})}):null},Upt=h.memo(Wpt),u0e=h.memo(({nodeExecutionState:e})=>{const{status:t,progress:n,progressImage:s}=e,{t:i}=T();return t===Ui.enum.PENDING?a.jsx(q,{children:i("queue.pending")}):t===Ui.enum.IN_PROGRESS?s?a.jsxs(A,{pos:"relative",pt:1.5,pb:.5,children:[a.jsx(Nn,{src:s.dataURL,w:32,h:32,borderRadius:"base",objectFit:"contain"}),n!==null&&a.jsxs(Bi,{variant:"solid",pos:"absolute",top:2.5,insetInlineEnd:1,children:[Math.round(n*100),"%"]})]}):n!==null?a.jsxs(q,{children:[i("nodes.executionStateInProgress")," (",Math.round(n*100),"%)"]}):a.jsx(q,{children:i("nodes.executionStateInProgress")}):t===Ui.enum.COMPLETED?a.jsx(q,{children:i("nodes.executionStateCompleted")}):t===Ui.enum.FAILED?a.jsx(q,{children:i("nodes.executionStateError")}):null});u0e.displayName="TooltipLabel";const h0e=h.memo(e=>{const{progress:t,status:n}=e.nodeExecutionState;return n===Ui.enum.PENDING?a.jsx(Je,{as:Z4,boxSize:jA,color:"base.300"}):n===Ui.enum.IN_PROGRESS?t===null?a.jsx(W2,{isIndeterminate:!0,size:"14px",color:"base.500",thickness:14,sx:kG}):a.jsx(W2,{value:Math.round(t*100),size:"14px",color:"base.500",thickness:14,sx:kG}):n===Ui.enum.COMPLETED?a.jsx(Je,{as:Yc,boxSize:jA,color:"ok.300"}):n===Ui.enum.FAILED?a.jsx(Je,{as:jm,boxSize:jA,color:"error.300"}):null});h0e.displayName="StatusIcon";const qpt={bg:"var(--header-bg-color)",borderTopRadius:"base",alignItems:"center",justifyContent:"space-between",h:8,textAlign:"center",borderBottomRadius:"base",'&[data-is-open="true"]':{borderBottomRadius:0}},Kpt=({nodeId:e,isOpen:t})=>{const n=nL();return a.jsxs(A,{sx:qpt,"data-is-open":t,"data-is-invalid":n,children:[a.jsx(pL,{nodeId:e,isOpen:t}),a.jsx(zpt,{nodeId:e}),a.jsx(Rpt,{nodeId:e}),a.jsxs(A,{alignItems:"center",children:[a.jsx(Upt,{nodeId:e}),a.jsx(c0e,{nodeId:e})]}),!t&&a.jsx(Gpt,{nodeId:e})]})},Zpt=h.memo(Kpt),Xpt={flexDirection:"column",w:"full",h:"full",py:2,gap:1,borderBottomRadius:"base",'&[data-with-footer="true"]':{borderBottomRadius:0},'&[data-with-footer="false"]':{pb:4}},Ypt=({nodeId:e,isOpen:t})=>{const n=bht();return a.jsxs(a.Fragment,{children:[a.jsx(Zpt,{nodeId:e,isOpen:t}),t&&a.jsxs(a.Fragment,{children:[a.jsx(A,{layerStyle:"nodeBody",sx:Xpt,"data-with-footer":n,children:a.jsxs(A,{flexDir:"column",px:2,w:"full",h:"full",children:[a.jsxs(Ms,{gridTemplateColumns:"1fr auto",gridAutoRows:"1fr",children:[a.jsx(p0e,{nodeId:e}),a.jsx(g0e,{nodeId:e})]}),a.jsx(f0e,{nodeId:e}),a.jsx(m0e,{nodeId:e})]})}),n&&a.jsx(Ppt,{nodeId:e})]})]})},Qpt=h.memo(Ypt),p0e=h.memo(({nodeId:e})=>{const t=ght();return a.jsx(a.Fragment,{children:t.map((n,s)=>a.jsx(_t,{gridColumnStart:1,gridRowStart:s+1,children:a.jsx(ap,{nodeId:e,fieldName:n,children:a.jsx(Vk,{nodeId:e,fieldName:n})})},`${e}.${n}.input-field`))})});p0e.displayName="ConnectionFields";const f0e=h.memo(({nodeId:e})=>{const t=mht();return a.jsx(a.Fragment,{children:t.map(n=>a.jsx(ap,{nodeId:e,fieldName:n,children:a.jsx(Vk,{nodeId:e,fieldName:n})},`${e}.${n}.input-field`))})});f0e.displayName="AnyOrDirectFields";const m0e=h.memo(({nodeId:e})=>{const t=fht();return a.jsx(a.Fragment,{children:t.map(n=>a.jsx(ap,{nodeId:e,fieldName:n,children:a.jsx(Vk,{nodeId:e,fieldName:n})},`${e}.${n}.input-field`))})});m0e.displayName="MissingFields";const g0e=h.memo(({nodeId:e})=>{const t=yht();return a.jsx(a.Fragment,{children:t.map((n,s)=>a.jsx(_t,{gridColumnStart:2,gridRowStart:s+1,children:a.jsx(tge,{nodeId:e,fieldName:n,children:a.jsx(dge,{nodeId:e,fieldName:n})})},`${e}.${n}.output-field`))})});g0e.displayName="OutputFields";const Jpt=()=>{const e=yn(),t=h.useMemo(()=>ve(e.selectNodeDataSafe,n=>n?.nodePack??null),[e]);return M(t)},eft=({nodeId:e,isOpen:t,label:n,type:s})=>{const{t:i}=T(),o=Jpt();return a.jsxs(a.Fragment,{children:[a.jsxs(A,{className:um,layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:t?0:"base",alignItems:"center",h:8,fontWeight:"semibold",fontSize:"sm",bg:"error.700",children:[a.jsx(pL,{nodeId:e,isOpen:t}),a.jsx(q,{w:"full",textAlign:"center",pe:8,children:n?`${n} (${s})`:s})]}),t&&a.jsx(A,{layerStyle:"nodeBody",userSelect:"auto",flexDirection:"column",w:"full",h:"full",p:4,gap:1,borderBottomRadius:"base",fontSize:"sm",children:a.jsxs(A,{gap:2,flexDir:"column",children:[a.jsxs(q,{as:"span",children:[i("nodes.unknownNodeType"),":"," ",a.jsx(q,{as:"span",fontWeight:"semibold",children:s})]}),o&&a.jsxs(q,{as:"span",children:[i("nodes.nodePack"),":"," ",a.jsx(q,{as:"span",fontWeight:"semibold",children:o})]})]})})]})},tft=h.memo(eft),nft=e=>{const{data:t,selected:n}=e,{id:s,type:i,isOpen:o,label:r}=t,l=le(ni),c=h.useMemo(()=>!!l[i],[l,i]),d=h.useMemo(()=>ve(Uo,p=>!!p.find(m=>m.id===s)),[s]);return M(d)?c?a.jsx(Jl,{nodeId:s,children:a.jsx(CG,{nodeId:s,selected:n,children:a.jsx(Qpt,{nodeId:s,isOpen:o})})}):a.jsx(Jl,{nodeId:s,children:a.jsx(CG,{nodeId:s,selected:n,isMissingTemplate:!0,children:a.jsx(tft,{nodeId:s,isOpen:o,label:r,type:i})})}):null},sft=h.memo(nft),ift=({nodeId:e,title:t})=>{const n=Q(),s=h.useMemo(()=>ve(Uo,d=>d.find(p=>p.id===e)?.data?.label??""),[e]),i=M(s),{t:o}=T(),r=h.useRef(null),l=h.useCallback(d=>{n(e4({nodeId:e,label:d}))},[n,e]),c=rc({value:i||t||o("nodes.problemSettingTitle"),defaultValue:t||o("nodes.problemSettingTitle"),onChange:l,inputRef:r});return a.jsxs(A,{overflow:"hidden",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:[!c.isEditing&&a.jsx(q,{className:Xc,fontWeight:"semibold",color:"base.200",onDoubleClick:c.startEditing,noOfLines:1,children:c.value}),c.isEditing&&a.jsx(Nt,{className:bt,ref:r,...c.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},oft=h.memo(ift),aft=e=>{const{id:t,data:n,selected:s}=e,{notes:i,isOpen:o}=n,r=Q(),l=h.useCallback(u=>{r(USe({nodeId:t,value:u.target.value}))},[r,t]),c=h.useMemo(()=>ve(Uo,u=>!!u.find(p=>p.id===t)),[t]);return M(c)?a.jsxs(Qme,{nodeId:t,selected:s,children:[a.jsxs(A,{layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:o?0:"base",alignItems:"center",justifyContent:"space-between",h:8,children:[a.jsx(pL,{nodeId:t,isOpen:o}),a.jsx(oft,{nodeId:t,title:"Notes"}),a.jsx(ke,{minW:8})]}),o&&a.jsx(a.Fragment,{children:a.jsx(A,{layerStyle:"nodeBody",className:ar,cursor:"auto",flexDirection:"column",borderBottomRadius:"base",w:"full",h:"full",p:2,gap:1,children:a.jsx(A,{className:ar,w:"full",h:"full",flexDir:"column",children:a.jsx(no,{className:bt,value:i,onChange:l,rows:8,resize:"none",fontSize:"sm"})})})})]}):null},rft=h.memo(aft),lft={collapsed:Vut,default:qut},cft={invocation:sft,current_image:Yut,notes:rft},dft={hideAttribution:!0},EA=[25,25],uft=e=>e.cancelConnection,v0e=h.memo(()=>{const e=Q(),t=M(Uo),n=M(YM),s=le(CR),i=M(_q),o=M(Sq),{onConnectStart:r,onConnect:l,onConnectEnd:c}=kut(),d=h.useRef(null),u=Iut(),p=KM();Qy("workflows",d);const[m]=YW("radii",["base"]),f=h.useMemo(()=>({borderRadius:m}),[m]),g=h.useCallback(k=>{e(gh(k));const E=sv.get();E&&GP.get()&&(GP.set(!1),E.fitView())},[e]),v=h.useCallback(k=>{k.length>0&&e(Ml(k))},[e]),b=h.useCallback((k,E)=>{CR.set(E)},[]),{onCloseGlobal:C}=im(),y=h.useCallback(()=>{C()},[C]),x=h.useCallback(k=>{sv.set(k),k.fitView()},[]),w=h.useCallback(k=>{d.current?.getBoundingClientRect()&&qM.set(sv.get()?.screenToFlowPosition({x:k.clientX,y:k.clientY})??null)},[]),_=h.useCallback((k,E,j)=>{vh.set(E),Zp.set(!1),sI.set(k)},[]),S=h.useCallback((k,E)=>{Zp.set(!0);const j=pw(E);e(Ml([{type:"remove",id:k.id},{type:"add",item:j}])),p([k.source,k.target,j.source,j.target])},[e,p]),I=h.useCallback((k,E,j)=>{const P=Zp.get(),D=sI.get()??{clientX:0,clientY:0},O=!("touches"in k)&&Math.hypot(k.clientX-D.clientX,k.clientY-D.clientY)>5;!P&&O&&e(Ml([{type:"remove",id:E.id}])),vh.set(null),Zp.set(!1),pa.set(null),sI.set(null)},[e]);return a.jsxs(a.Fragment,{children:[a.jsx(qSe,{id:"workflow-editor",ref:d,defaultViewport:s,nodeTypes:cft,edgeTypes:lft,nodes:t,edges:n,onInit:x,onMouseMove:w,onNodesChange:g,onEdgesChange:v,onReconnect:S,onReconnectStart:_,onReconnectEnd:I,onConnectStart:r,onConnect:l,onConnectEnd:c,onMoveEnd:b,connectionLineComponent:Lut,isValidConnection:u,minZoom:.1,snapToGrid:i,snapGrid:EA,connectionRadius:30,proOptions:dft,style:f,onPaneClick:y,deleteKeyCode:null,selectionMode:o==="full"?nP.Full:nP.Partial,elevateEdgesOnSelect:!0,nodeDragThreshold:1,noDragClassName:bt,noWheelClassName:kn,noPanClassName:ar,children:a.jsx(KSe,{gap:EA,offset:EA})}),a.jsx(y0e,{})]})});v0e.displayName="Flow";const y0e=h.memo(()=>{const e=M(ZSe),t=M(XSe),n=YSe(uft),s=Ze(),i=So("workflows"),{copySelection:o,pasteSelection:r,pasteSelectionWithEdges:l}=Tut();Be({id:"copySelection",category:"workflows",callback:o,options:{enabled:i,preventDefault:!0},dependencies:[o]});const c=h.useCallback(()=>{const{nodes:p,edges:m}=Xn(s.getState()),f=[],g=[];p.forEach(({id:v,selected:b})=>{b||f.push({type:"select",id:v,selected:!0})}),m.forEach(({id:v,selected:b})=>{b||g.push({type:"select",id:v,selected:!0})}),f.length>0&&s.dispatch(gh(f)),g.length>0&&s.dispatch(Ml(g))},[s]);Be({id:"selectAll",category:"workflows",callback:c,options:{enabled:i,preventDefault:!0},dependencies:[c,i]}),Be({id:"pasteSelection",category:"workflows",callback:r,options:{enabled:i,preventDefault:!0},dependencies:[r,i]}),Be({id:"pasteSelectionWithEdges",category:"workflows",callback:l,options:{enabled:i,preventDefault:!0},dependencies:[l,i]}),Be({id:"undo",category:"workflows",callback:()=>{s.dispatch(QSe())},options:{enabled:i&&e,preventDefault:!0},dependencies:[s,e,i]}),Be({id:"redo",category:"workflows",callback:()=>{s.dispatch(JSe())},options:{enabled:i&&t,preventDefault:!0},dependencies:[s,t,i]});const d=h.useCallback(()=>{vh.get()||(pa.set(null),ff.set(!1),n())},[n]);Ul("esc",d);const u=h.useCallback(()=>{const{nodes:p,edges:m}=Xn(s.getState()),f=[],g=[];p.filter(v=>v.selected).forEach(({id:v})=>{f.push({type:"remove",id:v})}),m.filter(v=>v.selected).forEach(({id:v})=>{g.push({type:"remove",id:v})}),f.length>0&&s.dispatch(gh(f)),g.length>0&&s.dispatch(Ml(g))},[s]);return Be({id:"deleteSelection",category:"workflows",callback:u,options:{preventDefault:!0,enabled:i},dependencies:[u,i]}),null});y0e.displayName="HotkeyIsolator";const hft=()=>{const e=Q(),t=M(XM),{t:n}=T(),s=h.useCallback(i=>{e(eke(i))},[e]);return a.jsx(A,{alignItems:"center",children:a.jsx(it,{"aria-label":n("nodes.nodeOpacity"),value:t,defaultValue:1,min:.5,max:1,step:.01,onChange:s,orientation:"vertical",h:"calc(100% - 0.5rem)"})})},pft=h.memo(hft),fft=200,mft=Qd,gft=e=>e.measured?.height?e.measured.height:tH(e)?fft:mft,vft=e=>e.measured?.width?e.measured.width:Qd,yft=()=>{const e=Ze(),t=M(Bq),n=M(zq),s=M(Vq),i=M($q),o=M(Gq);return h.useCallback(()=>{const l=e.getState(),c=Uo(l),d=YM(l),u=new xC.graphlib.Graph;u.setGraph({rankdir:i,nodesep:t,ranksep:n,ranker:s,align:o}),u.setDefaultEdgeLabel(()=>({}));const p=c.filter(w=>w.selected),m=p.length>1&&c.length>p.length,f=m?p:c,g={minX:1/0,minY:1/0};f.forEach(w=>{m&&(g.minX=Math.min(g.minX,w.position.x),g.minY=Math.min(g.minY,w.position.y)),u.setNode(w.id,{width:vft(w),height:gft(w)})});let v=d;if(m){const w=new Set(f.map(_=>_.id));v=d.filter(_=>w.has(_.source)&&w.has(_.target))}v.forEach(w=>{u.setEdge(w.source,w.target)}),xC.layout(u);const b={minX:1/0,minY:1/0};let C=0,y=0;m&&(f.forEach(w=>{const _=u.node(w.id),S=_.x-_.width/2,I=_.y-_.height/2;b.minX=Math.min(b.minX,S),b.minY=Math.min(b.minY,I)}),C=g.minX-b.minX,y=g.minY-b.minY);const x=f.map(w=>{const _=u.node(w.id),S=_.x-_.width/2,I=_.y-_.height/2,k={x:m?S+C:S,y:m?I+y:I};return{id:w.id,type:"position",position:k}});e.dispatch(gh(x))},[n,s,i,o,t,e])},[bft]=qh(!1),b0e=h.memo(()=>{const{t:e}=T(),{fitView:t}=Hq(),n=yft(),s=Q(),i=bft(),o=M(Vq),r=M(Bq),l=M(zq),c=M($q),d=M(Gq),u=h.useCallback(y=>{const x=tke.parse(y.target.value);s(nke(x))},[s]),p=h.useCallback(y=>{s(wR(y))},[s]),m=h.useCallback(y=>{s(wR(y))},[s]),f=h.useCallback(y=>{s(_R(y))},[s]),g=h.useCallback(y=>{s(_R(y))},[s]),v=h.useCallback(y=>{const x=ske.parse(y.target.value);s(ike(x))},[s]),b=h.useCallback(y=>{const x=oke.parse(y.target.value);s(ake(x))},[s]),C=h.useCallback(()=>{n(),t({duration:300}),i.setFalse()},[n,t,i]);return a.jsxs(yi,{isOpen:i.isTrue,onClose:i.setFalse,placement:"top",children:[a.jsx(Ni,{children:a.jsx(oe,{tooltip:e("nodes.layout.autoLayout"),"aria-label":e("nodes.layout.autoLayout"),icon:a.jsx(iMe,{}),onClick:i.toggle})}),a.jsx(Ls,{children:a.jsxs(bi,{children:[a.jsx(hr,{}),a.jsx(Fi,{children:a.jsxs(A,{direction:"column",gap:2,children:[a.jsxs(te,{children:[a.jsx(ne,{children:e("nodes.layout.layoutDirection")}),a.jsxs(Mi,{size:"sm",value:c,onChange:v,children:[a.jsx("option",{value:"LR",children:e("nodes.layout.layoutDirectionRight")}),a.jsx("option",{value:"TB",children:e("nodes.layout.layoutDirectionDown")})]})]}),a.jsxs(te,{children:[a.jsx(ne,{children:e("nodes.layout.layeringStrategy")}),a.jsxs(Mi,{size:"sm",value:o,onChange:u,children:[a.jsx("option",{value:"network-simplex",children:e("nodes.layout.networkSimplex")}),a.jsx("option",{value:"longest-path",children:e("nodes.layout.longestPath")})]})]}),a.jsxs(te,{children:[a.jsx(ne,{children:e("nodes.layout.alignment")}),a.jsxs(Mi,{size:"sm",value:d,onChange:b,children:[a.jsx("option",{value:"UL",children:e("nodes.layout.alignmentUL")}),a.jsx("option",{value:"DL",children:e("nodes.layout.alignmentDL")}),a.jsx("option",{value:"UR",children:e("nodes.layout.alignmentUR")}),a.jsx("option",{value:"DR",children:e("nodes.layout.alignmentDR")})]})]}),a.jsx(vt,{}),a.jsxs(te,{children:[a.jsx(ne,{children:e("nodes.layout.nodeSpacing")}),a.jsxs(Ms,{w:"full",gap:2,templateColumns:"1fr auto",children:[a.jsx(it,{min:0,max:200,value:r,onChange:p,marks:!0}),a.jsx(Pe,{value:r,min:0,max:200,onChange:m,w:24})]})]}),a.jsxs(te,{children:[a.jsx(ne,{children:e("nodes.layout.layerSpacing")}),a.jsxs(Ms,{w:"full",gap:2,templateColumns:"1fr auto",children:[a.jsx(it,{min:0,max:200,value:l,onChange:f,marks:!0}),a.jsx(Pe,{value:l,min:0,max:200,onChange:g,w:24})]})]}),a.jsx(vt,{}),a.jsx(he,{w:"full",onClick:C,children:e("common.apply")})]})})]})})]})});b0e.displayName="AutoLayoutPopover";const xft=()=>{const{t:e}=T(),{zoomIn:t,zoomOut:n,fitView:s}=Hq(),i=Q(),o=M(Wq),r=h.useCallback(()=>{t({duration:300})},[t]),l=h.useCallback(()=>{n({duration:300})},[n]),c=h.useCallback(()=>{s({duration:300})},[s]),d=h.useCallback(()=>{i(rke(!o))},[o,i]);return a.jsxs(zn,{orientation:"vertical",children:[a.jsx(oe,{tooltip:e("nodes.zoomInNodes"),"aria-label":e("nodes.zoomInNodes"),onClick:r,icon:a.jsx(hX,{})}),a.jsx(oe,{tooltip:e("nodes.zoomOutNodes"),"aria-label":e("nodes.zoomOutNodes"),onClick:l,icon:a.jsx(uX,{})}),a.jsx(oe,{tooltip:e("nodes.fitViewportNodes"),"aria-label":e("nodes.fitViewportNodes"),onClick:c,icon:a.jsx(Sm,{})}),a.jsx(b0e,{}),a.jsx(oe,{tooltip:e(o?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),"aria-label":e(o?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),isChecked:o,onClick:d,icon:a.jsx(oMe,{})})]})},Cft=h.memo(xft),wft=()=>a.jsxs(A,{gap:2,position:"absolute",bottom:2,insetInlineStart:2,children:[a.jsx(Cft,{}),a.jsx(pft,{})]}),_ft=h.memo(wft),Sft=ec(lke),kft={m:"0 !important",borderRadius:"base",backgroundColor:"base.500 !important",svg:{borderRadius:"inherit"}},Ift=()=>{const e=M(Wq);return a.jsx(A,{gap:2,position:"absolute",bottom:2,insetInlineEnd:2,children:e&&a.jsx(Sft,{pannable:!0,zoomable:!0,nodeBorderRadius:15,sx:kft,nodeColor:"var(--invoke-colors-base-600)",maskColor:"var(--invoke-colors-blackAlpha-600)"})})},jft=h.memo(Ift),Eft=()=>{const{data:e,isLoading:t}=Yw(),{t:n}=T();return a.jsx(cke,{children:a.jsxs(A,{bg:"base.900",display:"flex",position:"relative",width:"full",height:"full",alignItems:"center",justifyContent:"center",children:[e&&a.jsxs(a.Fragment,{children:[a.jsx(v0e,{}),a.jsx(zme,{}),a.jsx(Hme,{}),a.jsx(Gme,{}),a.jsx(Ume,{}),a.jsx(_ft,{}),a.jsx(jft,{})]}),a.jsx(Sut,{}),t&&a.jsx(On,{label:n("nodes.loadingNodes"),icon:h1})]})})},Aft=h.memo(Eft),Pft=ve(Xn,e=>dke(e)?.data),Tft=()=>{const{t:e}=T(),t=M(Pft),[n]=el(t,300);return n?a.jsx(Xl,{data:n,label:"Node Data",bg:"base.850",color:"base.200"}):a.jsx(On,{label:e("nodes.noNodeSelected"),icon:null})},Dft=h.memo(Tft),x0e=h.memo(({nodeId:e})=>{const t=Q(),{t:n}=T(),s=l0e(),i=h.useCallback(o=>{t(uke({nodeId:e,notes:o.target.value}))},[t,e]);return a.jsxs(te,{orientation:"vertical",h:"full",children:[a.jsx(ne,{children:n("nodes.notes")}),a.jsx(no,{value:s,onChange:i,rows:10,resize:"none",variant:"darkFilled"})]})});x0e.displayName="InvocationNodeNotesTextarea";const $k=h.memo(({fallback:e,children:t})=>hge()?a.jsx(a.Fragment,{children:t}):e);$k.displayName="TemplateGate";const Mft=()=>{const e=yn();return M(e.selectNodeTypeOrThrow)},Lft=()=>{const e=Mft(),t=fL(),n=Eu();return h.useMemo(()=>e!==n.type?!0:t!==n.version,[n.type,n.version,e,t])},Rft=({nodeId:e,title:t})=>{const n=Q(),s=hL(),i=a0e(),{t:o}=T(),r=h.useRef(null),l=h.useCallback(d=>{n(e4({nodeId:e,label:d}))},[n,e]),c=rc({value:s||t||i||o("nodes.problemSettingTitle"),defaultValue:t||i||o("nodes.problemSettingTitle"),onChange:l,inputRef:r});return a.jsxs(A,{w:"full",alignItems:"center",children:[!c.isEditing&&a.jsx(q,{size:"sm",fontWeight:"semibold",userSelect:"none",onDoubleClick:c.startEditing,children:c.value}),c.isEditing&&a.jsx(Nt,{ref:r,...c.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},Oft=h.memo(Rft),Nft=()=>{const{t:e}=T(),t=M(t4);return t?a.jsx(Jl,{nodeId:t,children:a.jsx($k,{nodeId:t,fallback:a.jsx(On,{label:e("nodes.noNodeSelected"),icon:null}),children:a.jsx(C0e,{nodeId:t})})}):a.jsx(On,{label:e("nodes.noNodeSelected"),icon:null})},Fft=h.memo(Nft),C0e=h.memo(({nodeId:e})=>{const{t}=T(),n=fL(),s=Eu(),i=Lft();return a.jsx(ke,{position:"relative",w:"full",h:"full",children:a.jsx(Hs,{children:a.jsxs(A,{flexDir:"column",position:"relative",w:"full",h:"full",gap:1,children:[a.jsxs(te,{children:[a.jsx(ne,{m:0,children:t("nodes.nodeName")}),a.jsx(Oft,{nodeId:e})]}),a.jsxs(hke,{children:[a.jsxs(te,{children:[a.jsx(ne,{m:0,children:t("nodes.nodeType")}),a.jsx(q,{fontSize:"sm",fontWeight:"semibold",children:s.title})]}),a.jsxs(te,{isInvalid:i,children:[a.jsx(ne,{m:0,children:t("nodes.nodeVersion")}),a.jsx(q,{fontSize:"sm",fontWeight:"semibold",children:n})]})]}),a.jsx(x0e,{nodeId:e})]})})})});C0e.displayName="Content";const Bft=({output:e})=>{const{image:t}=e,{currentData:n}=eu(t.image_name);return n?a.jsx(lc,{imageDTO:n,borderRadius:"base"}):null},zft=h.memo(Bft),Vft=()=>{const e=M(t4),{t}=T();return e?a.jsx(Jl,{nodeId:e,children:a.jsx($k,{nodeId:e,fallback:a.jsx(On,{label:t("nodes.noNodeSelected"),icon:null}),children:a.jsx(w0e,{nodeId:e})})}):a.jsx(On,{label:t("nodes.noNodeSelected"),icon:null})},$ft=h.memo(Vft),Gft=(e,t)=>`${e.type}-${t}`,w0e=h.memo(({nodeId:e})=>{const{t}=T(),n=Eu(),s=q_(e);return!s||s.outputs.length===0?a.jsx(On,{label:t("nodes.noOutputRecorded"),icon:null}):a.jsx(ke,{position:"relative",w:"full",h:"full",children:a.jsx(Hs,{children:a.jsx(A,{position:"relative",flexDir:"column",alignItems:"flex-start",p:1,gap:2,h:"full",w:"full",children:n.outputType==="image_output"?s.outputs.map((i,o)=>a.jsx(zft,{output:i},Gft(i,o))):a.jsx(Xl,{data:s.outputs,label:t("nodes.nodeOutputs"),bg:"base.850",color:"base.200"})})})})});w0e.displayName="Content";const Hft=()=>{const e=M(t4),{t}=T();return e?a.jsx(Jl,{nodeId:e,children:a.jsx($k,{nodeId:e,fallback:a.jsx(On,{label:t("nodes.noNodeSelected"),icon:null}),children:a.jsx(_0e,{nodeId:e})})}):a.jsx(On,{label:t("nodes.noNodeSelected"),icon:null})},Wft=h.memo(Hft),_0e=h.memo(e=>{const{t}=T(),n=Eu();return a.jsx(Xl,{data:n,label:t("nodes.nodeTemplate"),bg:"base.850",color:"base.200"})});_0e.displayName="Content";const Uft=()=>{const{t:e}=T();return a.jsxs(Vy,{variant:"enclosed",display:"flex",flexDir:"column",w:"full",h:"full",children:[a.jsxs($y,{children:[a.jsx(Qs,{children:e("common.details")}),a.jsx(Qs,{children:e("common.outputs")}),a.jsx(Qs,{children:e("common.data")}),a.jsx(Qs,{children:e("common.template")})]}),a.jsxs(Gy,{h:"full",pt:2,children:[a.jsx(Js,{h:"full",p:0,children:a.jsx(Fft,{})}),a.jsx(Js,{h:"full",p:0,children:a.jsx($ft,{})}),a.jsx(Js,{h:"full",p:0,children:a.jsx(Dft,{})}),a.jsx(Js,{h:"full",p:0,children:a.jsx(Wft,{})})]})]})},qft=h.memo(Uft),S0e=h.createContext(null),mb=h.memo(({id:e,layout:t,children:n})=>{const s=h.useMemo(()=>({id:e,layout:t}),[e,t]);return a.jsx(S0e.Provider,{value:s,children:n})});mb.displayName="ContainerContextProvider";const il=()=>{const e=h.useContext(S0e);return ae(e!==null,"useContainerContext must be used inside a ContainerContextProvider and cannot be used by the root container"),e},k0e=h.createContext(0),gb=h.memo(({depth:e,children:t})=>a.jsx(k0e.Provider,{value:e,children:t}));gb.displayName="DepthContextProvider";const Gk=()=>h.useContext(k0e),Kft={bg:"base.700",flexShrink:0,'&[data-parent-layout="column"]':{width:"100%",height:"1px"},'&[data-parent-layout="row"]':{height:"100%",width:"1px"}},I0e=h.memo(()=>{const e=il();return a.jsx(A,{sx:Kft,"data-parent-layout":e.layout})});I0e.displayName="DividerElementComponent";const fw={thickness:2,backgroundColor:"base.600"},Zft={display:"block",position:"absolute",zIndex:1,borderRadius:"full",pointerEvents:"none",background:fw.backgroundColor},Xft={horizontal:{height:`${fw.thickness}px`,left:2,right:2},vertical:{width:`${fw.thickness}px`,top:2,bottom:2}},Yft={top:"horizontal",bottom:"horizontal",left:"vertical",right:"vertical"},Qft={top:{top:"var(--local-line-offset)"},right:{right:"var(--local-line-offset)"},bottom:{bottom:"var(--local-line-offset)"},left:{left:"var(--local-line-offset)"}};function Jft({edge:e,gap:t="0px"}){const n=`calc(-0.5 * (${t} + ${fw.thickness}px))`,s=Yft[e];return a.jsx(ke,{sx:{...Zft,...Xft[s],...Qft[e],"--local-line-offset":n}})}const vb=({activeDropRegion:e,gap:t})=>!e||e==="center"?null:a.jsx(Jft,{edge:e,gap:t||"var(--invoke-space-2)"}),emt={w:"full",h:"full",borderWidth:1,borderRadius:"base",borderTopRadius:"unset",borderTop:"unset",borderColor:"baseAlpha.250",'&[data-depth="0"]':{borderColor:"baseAlpha.100"},'&[data-depth="1"]':{borderColor:"baseAlpha.150"},'&[data-depth="2"]':{borderColor:"baseAlpha.200"},'&[data-is-dragging="true"]':{opacity:.3}},ig=h.memo(({children:e,...t})=>{const n=Gk();return a.jsx(A,{sx:emt,"data-depth":n,...t,children:e})});ig.displayName="FormElementEditModeContent";const j0e=h.memo(({element:e})=>{const{id:t,data:n}=e,{layout:s}=n,{t:i}=T(),o=Q(),r=h.useCallback(()=>{o(iP({id:t,changes:{layout:"row"}}))},[o,t]),l=h.useCallback(()=>{o(iP({id:t,changes:{layout:"column"}}))},[o,t]);return a.jsxs(yi,{placement:"top",isLazy:!0,lazyBehavior:"unmount",children:[a.jsx(Ni,{children:a.jsx(oe,{"aria-label":"settings",icon:a.jsx(_X,{}),variant:"link",size:"sm",alignSelf:"stretch"})}),a.jsx(Ls,{children:a.jsxs(bi,{children:[a.jsx(hr,{}),a.jsx(Fi,{children:a.jsxs(te,{children:[a.jsx(ne,{m:0,children:i("workflows.builder.layout")}),a.jsxs(zn,{variant:"outline",size:"sm",children:[a.jsx(he,{onClick:r,colorScheme:s==="row"?"invokeBlue":"base",children:i("workflows.builder.row")}),a.jsx(he,{onClick:l,colorScheme:s==="column"?"invokeBlue":"base",children:i("workflows.builder.column")})]})]})})]})})]})});j0e.displayName="ContainerElementSettings";const E0e=h.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>a.jsxs(a.Fragment,{children:[a.jsx(A0e,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i}),a.jsx(P0e,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i}),a.jsx(T0e,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i}),a.jsx(D0e,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})]}));E0e.displayName="NodeFieldElementFloatSettings";const A0e=h.memo(({id:e,settings:t})=>{const{showShuffle:n}=t,{t:s}=T(),i=Q(),o=h.useCallback(()=>{const r={...t,showShuffle:!n};i(Fs({id:e,changes:{settings:r}}))},[i,e,t,n]);return a.jsxs(te,{children:[a.jsx(ne,{flex:1,children:s("workflows.builder.showShuffle")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:o})]})});A0e.displayName="SettingShuffle";const P0e=h.memo(({id:e,settings:t})=>{const{t:n}=T(),s=Q(),i=h.useCallback(o=>{const r={...t,component:Uq.parse(o.target.value)};s(Fs({id:e,changes:{settings:r}}))},[t,s,e]);return a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{flex:1,children:n("workflows.builder.component")}),a.jsxs(Mi,{value:t.component,onChange:i,size:"sm",children:[a.jsx("option",{value:"number-input",children:n("workflows.builder.numberInput")}),a.jsx("option",{value:"slider",children:n("workflows.builder.slider")}),a.jsx("option",{value:"number-input-and-slider",children:n("workflows.builder.both")})]})]})});P0e.displayName="SettingComponent";const T0e=h.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>{const{t:o}=T(),r=Q(),l=rp(s),c=pb(n,s,i),d=h.useCallback(()=>{const f={...t,min:t.min!==void 0?void 0:c.min};r(Fs({id:e,changes:{settings:f}}))},[t,r,c,e]),u=h.useCallback(f=>{const g={...t,min:f};r(Fs({id:e,changes:{settings:g}}));const v=ng(l.value,c,g);l.value!==v&&r(Z2({nodeId:n,fieldName:s,value:v}))},[t,r,l.value,s,c,e,n]),p=h.useMemo(()=>k_(c.min,c.step),[c.min,c.step]),m=h.useMemo(()=>(t.max??c.max)-c.step,[t.max,c.max,c.step]);return a.jsxs(te,{orientation:"vertical",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",alignItems:"center",children:[a.jsx(ne,{m:0,children:o("workflows.builder.minimum")}),a.jsx(mt,{isChecked:t.min!==void 0,onChange:d,size:"sm"})]}),a.jsx(Pe,{w:"full",isDisabled:t.min===void 0,value:t.min===void 0?`${c.min} (inherited)`:t.min,onChange:u,min:p,max:m,step:c.step})]})});T0e.displayName="SettingMin";const D0e=h.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>{const{t:o}=T(),r=Q(),l=rp(s),c=pb(n,s,i),d=h.useCallback(()=>{const f={...t,max:t.max!==void 0?void 0:c.max};r(Fs({id:e,changes:{settings:f}}))},[t,r,c,e]),u=h.useCallback(f=>{const g={...t,max:f};r(Fs({id:e,changes:{settings:g}}));const v=ng(l.value,c,g);l.value!==v&&r(Z2({nodeId:n,fieldName:s,value:v}))},[t,r,l.value,s,c,e,n]),p=h.useMemo(()=>(t.min??c.min)+c.step,[t.min,c.min,c.step]),m=h.useMemo(()=>Pf(c.max,c.step),[c.max,c.step]);return a.jsxs(te,{orientation:"vertical",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",alignItems:"center",children:[a.jsx(ne,{m:0,children:o("workflows.builder.maximum")}),a.jsx(mt,{isChecked:t.max!==void 0,onChange:d,size:"sm"})]}),a.jsx(Pe,{w:"full",isDisabled:t.max===void 0,value:t.max===void 0?`${c.max} (inherited)`:t.max,onChange:u,min:p,max:m,step:c.step})]})});D0e.displayName="SettingMax";const M0e=h.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>a.jsxs(a.Fragment,{children:[a.jsx(L0e,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i}),a.jsx(R0e,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i}),a.jsx(O0e,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i}),a.jsx(N0e,{id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})]}));M0e.displayName="NodeFieldElementIntegerSettings";const L0e=h.memo(({id:e,settings:t})=>{const{showShuffle:n}=t,{t:s}=T(),i=Q(),o=h.useCallback(()=>{const r={...t,showShuffle:!n};i(Fs({id:e,changes:{settings:r}}))},[i,e,t,n]);return a.jsxs(te,{children:[a.jsx(ne,{flex:1,children:s("workflows.builder.showShuffle")}),a.jsx(mt,{size:"sm",isChecked:n,onChange:o})]})});L0e.displayName="SettingShuffle";const R0e=h.memo(({id:e,settings:t})=>{const{t:n}=T(),s=Q(),i=h.useCallback(o=>{const r={...t,component:Uq.parse(o.target.value)};s(Fs({id:e,changes:{settings:r}}))},[t,s,e]);return a.jsxs(te,{orientation:"vertical",children:[a.jsx(ne,{flex:1,children:n("workflows.builder.component")}),a.jsxs(Mi,{value:t.component,onChange:i,size:"sm",children:[a.jsx("option",{value:"number-input",children:n("workflows.builder.numberInput")}),a.jsx("option",{value:"slider",children:n("workflows.builder.slider")}),a.jsx("option",{value:"number-input-and-slider",children:n("workflows.builder.both")})]})]})});R0e.displayName="SettingComponent";const O0e=h.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>{const{t:o}=T(),r=Q(),l=rp(s),c=fb(n,s,i),d=h.useCallback(()=>{const f={...t,min:t.min!==void 0?void 0:c.min};r(Fs({id:e,changes:{settings:f}}))},[t,r,c.min,e]),u=h.useCallback(f=>{const g={...t,min:f};r(Fs({id:e,changes:{settings:g}}));const v=ng(l.value,c,g);l.value!==v&&r(X2({nodeId:n,fieldName:s,value:v}))},[t,r,e,l,c,n,s]),p=h.useMemo(()=>k_(c.min,c.step),[c.min,c.step]),m=h.useMemo(()=>(t.max??c.max)-c.step,[t.max,c.max,c.step]);return a.jsxs(te,{orientation:"vertical",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",alignItems:"center",children:[a.jsx(ne,{m:0,children:o("workflows.builder.minimum")}),a.jsx(mt,{isChecked:t.min!==void 0,onChange:d,size:"sm"})]}),a.jsx(Pe,{w:"full",isDisabled:t.min===void 0,value:t.min??`${c.min} (inherited)`,onChange:u,min:p,max:m,step:c.step})]})});O0e.displayName="SettingMin";const N0e=h.memo(({id:e,settings:t,nodeId:n,fieldName:s,fieldTemplate:i})=>{const{t:o}=T(),r=Q(),l=rp(s),c=fb(n,s,i),d=h.useCallback(()=>{const f={...t,max:t.max!==void 0?void 0:c.max};r(Fs({id:e,changes:{settings:f}}))},[t,r,c.max,e]),u=h.useCallback(f=>{const g={...t,max:f};r(Fs({id:e,changes:{settings:g}}));const v=ng(l.value,c,g);l.value!==v&&r(X2({nodeId:n,fieldName:s,value:v}))},[t,r,l.value,s,c,e,n]),p=h.useMemo(()=>(t.min??c.min)+c.step,[t.min,c.min,c.step]),m=h.useMemo(()=>Pf(c.max,c.step),[c.max,c.step]);return a.jsxs(te,{orientation:"vertical",children:[a.jsxs(A,{justifyContent:"space-between",w:"full",alignItems:"center",children:[a.jsx(ne,{m:0,children:o("workflows.builder.maximum")}),a.jsx(mt,{isChecked:t.max!==void 0,onChange:d,size:"sm"})]}),a.jsx(Pe,{w:"full",isDisabled:t.max===void 0,value:t.max??`${c.max} (inherited)`,onChange:u,min:p,max:m,step:c.step})]})});N0e.displayName="SettingMax";const F0e=h.memo(({id:e,settings:t})=>{const{t:n}=T(),s=Q(),i=h.useCallback(o=>{const r=pke.parse(o.target.value);if(r!==t.component)if(r==="dropdown"){const l={...t,component:r,options:[oP()]};s(Fs({id:e,changes:{settings:l}}));return}else{const l=zc({...t,component:r},"options");s(Fs({id:e,changes:{settings:l}}))}},[t,s,e]);return a.jsxs(te,{children:[a.jsx(ne,{flex:1,children:n("workflows.builder.component")}),a.jsxs(Mi,{value:t.component,onChange:i,size:"sm",children:[a.jsx("option",{value:"input",children:n("workflows.builder.singleLine")}),a.jsx("option",{value:"textarea",children:n("workflows.builder.multiLine")}),a.jsx("option",{value:"dropdown",children:n("workflows.builder.dropdown")})]})]})});F0e.displayName="NodeFieldElementStringSettings";const B0e=h.memo(({element:e})=>{const{id:t,data:n}=e,{showDescription:s,fieldIdentifier:i}=n,{nodeId:o,fieldName:r}=i,l=dc(r),{t:c}=T(),d=Q(),u=h.useCallback(()=>{d(Fs({id:t,changes:{showDescription:!s}}))},[d,t,s]),p=h.useMemo(()=>n.settings?n.settings:B2(l)?fke():F2(l)?mke():Nq(l)?gke():null,[n.settings,l]);return a.jsxs(yi,{placement:"top",isLazy:!0,lazyBehavior:"unmount",children:[a.jsx(Ni,{children:a.jsx(oe,{"aria-label":"settings",icon:a.jsx(_X,{}),variant:"link",size:"sm",alignSelf:"stretch"})}),a.jsx(Ls,{children:a.jsxs(bi,{children:[a.jsx(hr,{}),a.jsx(Fi,{minW:48,children:a.jsxs(A,{w:"full",h:"full",gap:2,flexDir:"column",children:[a.jsxs(te,{children:[a.jsx(ne,{flex:1,children:c("workflows.builder.showDescription")}),a.jsx(mt,{size:"sm",isChecked:s,onChange:u})]}),p?.type==="integer-field-config"&&B2(l)&&a.jsx(M0e,{id:t,settings:p,nodeId:o,fieldName:r,fieldTemplate:l}),p?.type==="float-field-config"&&F2(l)&&a.jsx(E0e,{id:t,settings:p,nodeId:o,fieldName:r,fieldTemplate:l}),p?.type==="string-field-config"&&a.jsx(F0e,{id:t,settings:p})]})})]})})]})});B0e.displayName="NodeFieldElementSettings";const tmt={w:"full",ps:2,h:8,minH:8,maxH:8,borderTopRadius:"base",alignItems:"center",color:"base.500",bg:"baseAlpha.250",cursor:"grab",'&[data-depth="0"]':{bg:"baseAlpha.100"},'&[data-depth="1"]':{bg:"baseAlpha.150"},'&[data-depth="2"]':{bg:"baseAlpha.200"},'&[data-is-dragging="true"]':{opacity:.3},_hover:{bg:"baseAlpha.300"}},og=h.memo(({element:e,dragHandleRef:t,...n})=>{const s=Gk();return a.jsxs(A,{ref:t,sx:tmt,"data-depth":s,...n,children:[a.jsx($0e,{element:e}),a.jsx(At,{}),Ga(e)&&a.jsx(j0e,{element:e}),Ly(e)&&a.jsx(Jl,{nodeId:e.data.fieldIdentifier.nodeId,children:a.jsxs(ap,{nodeId:e.data.fieldIdentifier.nodeId,fieldName:e.data.fieldIdentifier.fieldName,fallback:null,children:[a.jsx(z0e,{element:e}),a.jsx(B0e,{element:e})]})}),a.jsx(V0e,{element:e})]})});og.displayName="FormElementEditModeHeader";const z0e=h.memo(({element:e})=>{const{t}=T(),{nodeId:n}=e.data.fieldIdentifier,s=tL(n),i=eL(n);return a.jsx(oe,{onMouseOver:i.handleMouseOver,onMouseOut:i.handleMouseOut,tooltip:t("workflows.builder.zoomToNode"),"aria-label":t("workflows.builder.zoomToNode"),onClick:s,icon:a.jsx(ZDe,{}),variant:"link",size:"sm",alignSelf:"stretch"})});z0e.displayName="ZoomToNodeButton";const V0e=h.memo(({element:e})=>{const{t}=T(),n=Q(),s=h.useCallback(()=>{n(Oq({id:e.id}))},[n,e.id]);return a.jsx(oe,{tooltip:t("common.delete"),"aria-label":t("common.delete"),onClick:s,icon:a.jsx(fn,{}),variant:"link",size:"sm",alignSelf:"stretch",colorScheme:"error"})});V0e.displayName="RemoveElementButton";const $0e=h.memo(({element:e})=>{const{t}=T(),n=h.useMemo(()=>Ga(e)&&e.data.layout==="column"?t("workflows.builder.containerColumnLayout"):Ga(e)&&e.data.layout==="row"?t("workflows.builder.containerRowLayout"):t(`workflows.builder.${jIe(e.type)}`),[e,t]);return a.jsx(q,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",userSelect:"none",children:n})});$0e.displayName="Label";const nmt={position:"relative",borderRadius:"base",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{w:"min-content",h:"full"},flexDir:"column"},G0e=h.memo(({el:e})=>{const t=h.useRef(null),n=h.useRef(null),[s,i]=ub(e.id,t,n),o=il(),{id:r}=e;return a.jsxs(A,{ref:t,id:r,className:qq,sx:nmt,"data-parent-layout":o.layout,children:[a.jsx(og,{dragHandleRef:n,element:e,"data-is-dragging":i}),a.jsx(ig,{"data-is-dragging":i,p:4,children:a.jsx(I0e,{})}),a.jsx(vb,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});G0e.displayName="DividerElementEditMode";const smt={bg:"base.700",flexShrink:0,'&[data-layout="column"]':{width:"100%",height:"1px"},'&[data-layout="row"]':{height:"100%",width:"1px"}},H0e=h.memo(({el:e})=>{const t=il(),{id:n}=e;return a.jsx(A,{id:n,className:qq,sx:smt,"data-layout":t?.layout||"column"})});H0e.displayName="DividerElementViewMode";const ag=e=>{const t=h.useMemo(()=>vke(e),[e]);return M(t)},W0e=h.memo(({id:e})=>{const t=ag(e),n=M(Zc);if(!(!t||!Kq(t)))return n==="view"?a.jsx(H0e,{el:t}):a.jsx(G0e,{el:t})});W0e.displayName="DividerElement";function ID(){return ID=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ID.apply(null,arguments)}function imt(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var omt=h.useLayoutEffect,amt=function(t){var n=ce.useRef(t);return omt(function(){n.current=t}),n},IG=function(t,n){if(typeof t=="function"){t(n);return}t.current=n},rmt=function(t,n){var s=ce.useRef();return ce.useCallback(function(i){t.current=i,s.current&&IG(s.current,null),s.current=n,n&&IG(n,i)},[n])},jG={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},lmt=function(t){Object.keys(jG).forEach(function(n){t.style.setProperty(n,jG[n],"important")})},EG=lmt,ho=null,AG=function(t,n){var s=t.scrollHeight;return n.sizingStyle.boxSizing==="border-box"?s+n.borderSize:s-n.paddingSize};function cmt(e,t,n,s){n===void 0&&(n=1),s===void 0&&(s=1/0),ho||(ho=document.createElement("textarea"),ho.setAttribute("tabindex","-1"),ho.setAttribute("aria-hidden","true"),EG(ho)),ho.parentNode===null&&document.body.appendChild(ho);var i=e.paddingSize,o=e.borderSize,r=e.sizingStyle,l=r.boxSizing;Object.keys(r).forEach(function(m){var f=m;ho.style[f]=r[f]}),EG(ho),ho.value=t;var c=AG(ho,e);ho.value=t,c=AG(ho,e),ho.value="x";var d=ho.scrollHeight-i,u=d*n;l==="border-box"&&(u=u+i+o),c=Math.max(u,c);var p=d*s;return l==="border-box"&&(p=p+i+o),c=Math.min(p,c),[c,d]}var PG=function(){},dmt=function(t,n){return t.reduce(function(s,i){return s[i]=n[i],s},{})},umt=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],hmt=!!document.documentElement.currentStyle,pmt=function(t){var n=window.getComputedStyle(t);if(n===null)return null;var s=dmt(umt,n),i=s.boxSizing;if(i==="")return null;hmt&&i==="border-box"&&(s.width=parseFloat(s.width)+parseFloat(s.borderRightWidth)+parseFloat(s.borderLeftWidth)+parseFloat(s.paddingRight)+parseFloat(s.paddingLeft)+"px");var o=parseFloat(s.paddingBottom)+parseFloat(s.paddingTop),r=parseFloat(s.borderBottomWidth)+parseFloat(s.borderTopWidth);return{sizingStyle:s,paddingSize:o,borderSize:r}},fmt=pmt;function mL(e,t,n){var s=amt(n);h.useLayoutEffect(function(){var i=function(r){return s.current(r)};if(e)return e.addEventListener(t,i),function(){return e.removeEventListener(t,i)}},[])}var mmt=function(t,n){mL(document.body,"reset",function(s){t.current.form===s.target&&n(s)})},gmt=function(t){mL(window,"resize",t)},vmt=function(t){mL(document.fonts,"loadingdone",t)},ymt=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],bmt=function(t,n){var s=t.cacheMeasurements,i=t.maxRows,o=t.minRows,r=t.onChange,l=r===void 0?PG:r,c=t.onHeightChange,d=c===void 0?PG:c,u=imt(t,ymt),p=u.value!==void 0,m=h.useRef(null),f=rmt(m,n),g=h.useRef(0),v=h.useRef(),b=function(){var x=m.current,w=s&&v.current?v.current:fmt(x);if(w){v.current=w;var _=cmt(w,x.value||x.placeholder||"x",o,i),S=_[0],I=_[1];g.current!==S&&(g.current=S,x.style.setProperty("height",S+"px","important"),d(S,{rowHeight:I}))}},C=function(x){p||b(),l(x)};return h.useLayoutEffect(b),mmt(m,function(){if(!p){var y=m.current.value;requestAnimationFrame(function(){var x=m.current;x&&y!==x.value&&b()})}}),gmt(b),vmt(b),h.createElement("textarea",ID({},u,{onChange:C,ref:f}))},xmt=h.forwardRef(bmt);const Cmt=ec(xmt),gL=UM(rm(({variant:e,...t},n)=>{const s=yke("Textarea",{variant:e});return a.jsx(Cmt,{__css:s,ref:n,...t})}));gL.displayName="AutosizeTextarea";const yb={a:{fontWeight:"semibold"},"a:hover":{textDecoration:"underline"}},bb={target:"_blank",rel:"noopener noreferrer",validate:e=>/^https?:\/\//.test(e)},wmt="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",_mt="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Mh=(e,t)=>{for(const n in t)e[n]=t[n];return e},jD="numeric",ED="ascii",AD="alpha",kv="asciinumeric",Q0="alphanumeric",PD="domain",U0e="emoji",Smt="scheme",kmt="slashscheme",AA="whitespace";function Imt(e,t){return e in t||(t[e]=[]),t[e]}function ah(e,t,n){t[jD]&&(t[kv]=!0,t[Q0]=!0),t[ED]&&(t[kv]=!0,t[AD]=!0),t[kv]&&(t[Q0]=!0),t[AD]&&(t[Q0]=!0),t[Q0]&&(t[PD]=!0),t[U0e]&&(t[PD]=!0);for(const s in t){const i=Imt(s,n);i.indexOf(e)<0&&i.push(e)}}function jmt(e,t){const n={};for(const s in t)t[s].indexOf(e)>=0&&(n[s]=!0);return n}function ha(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}ha.groups={};ha.prototype={accepts(){return!!this.t},go(e){const t=this,n=t.j[e];if(n)return n;for(let s=0;s<t.jr.length;s++){const i=t.jr[s][0],o=t.jr[s][1];if(o&&i.test(e))return o}return t.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,s){for(let i=0;i<e.length;i++)this.tt(e[i],t,n,s)},tr(e,t,n,s){s=s||ha.groups;let i;return t&&t.j?i=t:(i=new ha(t),n&&s&&ah(t,n,s)),this.jr.push([e,i]),i},ts(e,t,n,s){let i=this;const o=e.length;if(!o)return i;for(let r=0;r<o-1;r++)i=i.tt(e[r]);return i.tt(e[o-1],t,n,s)},tt(e,t,n,s){s=s||ha.groups;const i=this;if(t&&t.j)return i.j[e]=t,t;const o=t;let r,l=i.go(e);if(l?(r=new ha,Mh(r.j,l.j),r.jr.push.apply(r.jr,l.jr),r.jd=l.jd,r.t=l.t):r=new ha,o){if(s)if(r.t&&typeof r.t=="string"){const c=Mh(jmt(r.t,s),n);ah(o,c,s)}else n&&ah(o,n,s);r.t=o}return i.j[e]=r,r}};const Bt=(e,t,n,s,i)=>e.ta(t,n,s,i),ys=(e,t,n,s,i)=>e.tr(t,n,s,i),TG=(e,t,n,s,i)=>e.ts(t,n,s,i),Me=(e,t,n,s,i)=>e.tt(t,n,s,i),bc="WORD",TD="UWORD",q0e="ASCIINUMERICAL",K0e="ALPHANUMERICAL",Ey="LOCALHOST",DD="TLD",MD="UTLD",N2="SCHEME",Kp="SLASH_SCHEME",vL="NUM",LD="WS",yL="NL",Iv="OPENBRACE",jv="CLOSEBRACE",mw="OPENBRACKET",gw="CLOSEBRACKET",vw="OPENPAREN",yw="CLOSEPAREN",bw="OPENANGLEBRACKET",xw="CLOSEANGLEBRACKET",Cw="FULLWIDTHLEFTPAREN",ww="FULLWIDTHRIGHTPAREN",_w="LEFTCORNERBRACKET",Sw="RIGHTCORNERBRACKET",kw="LEFTWHITECORNERBRACKET",Iw="RIGHTWHITECORNERBRACKET",jw="FULLWIDTHLESSTHAN",Ew="FULLWIDTHGREATERTHAN",Aw="AMPERSAND",Pw="APOSTROPHE",Tw="ASTERISK",bd="AT",Dw="BACKSLASH",Mw="BACKTICK",Lw="CARET",Id="COLON",bL="COMMA",Rw="DOLLAR",gl="DOT",Ow="EQUALS",xL="EXCLAMATION",Fa="HYPHEN",Ev="PERCENT",Nw="PIPE",Fw="PLUS",Bw="POUND",Av="QUERY",CL="QUOTE",Z0e="FULLWIDTHMIDDLEDOT",wL="SEMI",vl="SLASH",Pv="TILDE",zw="UNDERSCORE",X0e="EMOJI",Vw="SYM";var Y0e=Object.freeze({__proto__:null,ALPHANUMERICAL:K0e,AMPERSAND:Aw,APOSTROPHE:Pw,ASCIINUMERICAL:q0e,ASTERISK:Tw,AT:bd,BACKSLASH:Dw,BACKTICK:Mw,CARET:Lw,CLOSEANGLEBRACKET:xw,CLOSEBRACE:jv,CLOSEBRACKET:gw,CLOSEPAREN:yw,COLON:Id,COMMA:bL,DOLLAR:Rw,DOT:gl,EMOJI:X0e,EQUALS:Ow,EXCLAMATION:xL,FULLWIDTHGREATERTHAN:Ew,FULLWIDTHLEFTPAREN:Cw,FULLWIDTHLESSTHAN:jw,FULLWIDTHMIDDLEDOT:Z0e,FULLWIDTHRIGHTPAREN:ww,HYPHEN:Fa,LEFTCORNERBRACKET:_w,LEFTWHITECORNERBRACKET:kw,LOCALHOST:Ey,NL:yL,NUM:vL,OPENANGLEBRACKET:bw,OPENBRACE:Iv,OPENBRACKET:mw,OPENPAREN:vw,PERCENT:Ev,PIPE:Nw,PLUS:Fw,POUND:Bw,QUERY:Av,QUOTE:CL,RIGHTCORNERBRACKET:Sw,RIGHTWHITECORNERBRACKET:Iw,SCHEME:N2,SEMI:wL,SLASH:vl,SLASH_SCHEME:Kp,SYM:Vw,TILDE:Pv,TLD:DD,UNDERSCORE:zw,UTLD:MD,UWORD:TD,WORD:bc,WS:LD});const vc=/[a-z]/,T0=new RegExp("\\p{L}","u"),PA=new RegExp("\\p{Emoji}","u"),yc=/\d/,TA=/\s/,DG="\r",DA=`
`,Emt="",Amt="",MA="";let Qx=null,Jx=null;function Pmt(e=[]){const t={};ha.groups=t;const n=new ha;Qx==null&&(Qx=MG(wmt)),Jx==null&&(Jx=MG(_mt)),Me(n,"'",Pw),Me(n,"{",Iv),Me(n,"}",jv),Me(n,"[",mw),Me(n,"]",gw),Me(n,"(",vw),Me(n,")",yw),Me(n,"<",bw),Me(n,">",xw),Me(n,"",Cw),Me(n,"",ww),Me(n,"",_w),Me(n,"",Sw),Me(n,"",kw),Me(n,"",Iw),Me(n,"",jw),Me(n,"",Ew),Me(n,"&",Aw),Me(n,"*",Tw),Me(n,"@",bd),Me(n,"`",Mw),Me(n,"^",Lw),Me(n,":",Id),Me(n,",",bL),Me(n,"$",Rw),Me(n,".",gl),Me(n,"=",Ow),Me(n,"!",xL),Me(n,"-",Fa),Me(n,"%",Ev),Me(n,"|",Nw),Me(n,"+",Fw),Me(n,"#",Bw),Me(n,"?",Av),Me(n,'"',CL),Me(n,"/",vl),Me(n,";",wL),Me(n,"~",Pv),Me(n,"_",zw),Me(n,"\\",Dw),Me(n,"",Z0e);const s=ys(n,yc,vL,{[jD]:!0});ys(s,yc,s);const i=ys(s,vc,q0e,{[kv]:!0}),o=ys(s,T0,K0e,{[Q0]:!0}),r=ys(n,vc,bc,{[ED]:!0});ys(r,yc,i),ys(r,vc,r),ys(i,yc,i),ys(i,vc,i);const l=ys(n,T0,TD,{[AD]:!0});ys(l,vc),ys(l,yc,o),ys(l,T0,l),ys(o,yc,o),ys(o,vc),ys(o,T0,o);const c=Me(n,DA,yL,{[AA]:!0}),d=Me(n,DG,LD,{[AA]:!0}),u=ys(n,TA,LD,{[AA]:!0});Me(n,MA,u),Me(d,DA,c),Me(d,MA,u),ys(d,TA,u),Me(u,DG),Me(u,DA),ys(u,TA,u),Me(u,MA,u);const p=ys(n,PA,X0e,{[U0e]:!0});Me(p,"#"),ys(p,PA,p),Me(p,Emt,p);const m=Me(p,Amt);Me(m,"#"),ys(m,PA,p);const f=[[vc,r],[yc,i]],g=[[vc,null],[T0,l],[yc,o]];for(let v=0;v<Qx.length;v++)fd(n,Qx[v],DD,bc,f);for(let v=0;v<Jx.length;v++)fd(n,Jx[v],MD,TD,g);ah(DD,{tld:!0,ascii:!0},t),ah(MD,{utld:!0,alpha:!0},t),fd(n,"file",N2,bc,f),fd(n,"mailto",N2,bc,f),fd(n,"http",Kp,bc,f),fd(n,"https",Kp,bc,f),fd(n,"ftp",Kp,bc,f),fd(n,"ftps",Kp,bc,f),ah(N2,{scheme:!0,ascii:!0},t),ah(Kp,{slashscheme:!0,ascii:!0},t),e=e.sort((v,b)=>v[0]>b[0]?1:-1);for(let v=0;v<e.length;v++){const b=e[v][0],y=e[v][1]?{[Smt]:!0}:{[kmt]:!0};b.indexOf("-")>=0?y[PD]=!0:vc.test(b)?yc.test(b)?y[kv]=!0:y[ED]=!0:y[jD]=!0,TG(n,b,b,y)}return TG(n,"localhost",Ey,{ascii:!0}),n.jd=new ha(Vw),{start:n,tokens:Mh({groups:t},Y0e)}}function Q0e(e,t){const n=Tmt(t.replace(/[A-Z]/g,l=>l.toLowerCase())),s=n.length,i=[];let o=0,r=0;for(;r<s;){let l=e,c=null,d=0,u=null,p=-1,m=-1;for(;r<s&&(c=l.go(n[r]));)l=c,l.accepts()?(p=0,m=0,u=l):p>=0&&(p+=n[r].length,m++),d+=n[r].length,o+=n[r].length,r++;o-=p,r-=m,d-=p,i.push({t:u.t,v:t.slice(o-d,o),s:o-d,e:o})}return i}function Tmt(e){const t=[],n=e.length;let s=0;for(;s<n;){let i=e.charCodeAt(s),o,r=i<55296||i>56319||s+1===n||(o=e.charCodeAt(s+1))<56320||o>57343?e[s]:e.slice(s,s+2);t.push(r),s+=r.length}return t}function fd(e,t,n,s,i){let o;const r=t.length;for(let l=0;l<r-1;l++){const c=t[l];e.j[c]?o=e.j[c]:(o=new ha(s),o.jr=i.slice(),e.j[c]=o),e=o}return o=new ha(n),o.jr=i.slice(),e.j[t[r-1]]=o,o}function MG(e){const t=[],n=[];let s=0,i="0123456789";for(;s<e.length;){let o=0;for(;i.indexOf(e[s+o])>=0;)o++;if(o>0){t.push(n.join(""));for(let r=parseInt(e.substring(s,s+o),10);r>0;r--)n.pop();s+=o}else n.push(e[s]),s++}return t}const Zf={defaultProtocol:"http",events:null,format:LG,formatHref:LG,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Hk(e,t=null){let n=Mh({},Zf);e&&(n=Mh(n,e instanceof Hk?e.o:e));const s=n.ignoreTags,i=[];for(let o=0;o<s.length;o++)i.push(s[o].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=i}Hk.prototype={o:Zf,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,t,n){const s=t!=null;let i=this.o[e];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:Zf[e],typeof i=="function"&&s&&(i=i(t,n))):typeof i=="function"&&s&&(i=i(t,n.t,n)),i)},getObj(e,t,n){let s=this.o[e];return typeof s=="function"&&t!=null&&(s=s(t,n.t,n)),s},render(e){const t=e.render(this);return(this.get("render",null,e)||this.defaultRender)(t,e.t,e)}};function LG(e){return e}var J0e=Object.freeze({__proto__:null,Options:Hk,assign:Mh,defaults:Zf});function eve(e,t){this.t="token",this.v=e,this.tk=t}eve.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const t=this.toString(),n=e.get("truncate",t,this),s=e.get("format",t,this);return n&&s.length>n?s.substring(0,n)+"":s},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=Zf.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const t=this,n=this.toHref(e.get("defaultProtocol")),s=e.get("formatHref",n,this),i=e.get("tagName",n,t),o=this.toFormattedString(e),r={},l=e.get("className",n,t),c=e.get("target",n,t),d=e.get("rel",n,t),u=e.getObj("attributes",n,t),p=e.getObj("events",n,t);return r.href=s,l&&(r.class=l),c&&(r.target=c),d&&(r.rel=d),u&&Mh(r,u),{tagName:i,attributes:r,content:o,eventListeners:p}}};function Wk(e,t){class n extends eve{constructor(i,o){super(i,o),this.t=e}}for(const s in t)n.prototype[s]=t[s];return n.t=e,n}const RG=Wk("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),OG=Wk("text"),Dmt=Wk("nl"),e2=Wk("url",{isLink:!0,toHref(e=Zf.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==Ey&&e[1].t===Id}}),La=e=>new ha(e);function Mmt({groups:e}){const t=e.domain.concat([Aw,Tw,bd,Dw,Mw,Lw,Rw,Ow,Fa,vL,Ev,Nw,Fw,Bw,vl,Vw,Pv,zw]),n=[Pw,Id,bL,gl,xL,Ev,Av,CL,wL,bw,xw,Iv,jv,gw,mw,vw,yw,Cw,ww,_w,Sw,kw,Iw,jw,Ew],s=[Aw,Pw,Tw,Dw,Mw,Lw,Rw,Ow,Fa,Iv,jv,Ev,Nw,Fw,Bw,Av,vl,Vw,Pv,zw],i=La(),o=Me(i,Pv);Bt(o,s,o),Bt(o,e.domain,o);const r=La(),l=La(),c=La();Bt(i,e.domain,r),Bt(i,e.scheme,l),Bt(i,e.slashscheme,c),Bt(r,s,o),Bt(r,e.domain,r);const d=Me(r,bd);Me(o,bd,d),Me(l,bd,d),Me(c,bd,d);const u=Me(o,gl);Bt(u,s,o),Bt(u,e.domain,o);const p=La();Bt(d,e.domain,p),Bt(p,e.domain,p);const m=Me(p,gl);Bt(m,e.domain,p);const f=La(RG);Bt(m,e.tld,f),Bt(m,e.utld,f),Me(d,Ey,f);const g=Me(p,Fa);Me(g,Fa,g),Bt(g,e.domain,p),Bt(f,e.domain,p),Me(f,gl,m),Me(f,Fa,g);const v=Me(f,Id);Bt(v,e.numeric,RG);const b=Me(r,Fa),C=Me(r,gl);Me(b,Fa,b),Bt(b,e.domain,r),Bt(C,s,o),Bt(C,e.domain,r);const y=La(e2);Bt(C,e.tld,y),Bt(C,e.utld,y),Bt(y,e.domain,r),Bt(y,s,o),Me(y,gl,C),Me(y,Fa,b),Me(y,bd,d);const x=Me(y,Id),w=La(e2);Bt(x,e.numeric,w);const _=La(e2),S=La();Bt(_,t,_),Bt(_,n,S),Bt(S,t,_),Bt(S,n,S),Me(y,vl,_),Me(w,vl,_);const I=Me(l,Id),k=Me(c,Id),E=Me(k,vl),j=Me(E,vl);Bt(l,e.domain,r),Me(l,gl,C),Me(l,Fa,b),Bt(c,e.domain,r),Me(c,gl,C),Me(c,Fa,b),Bt(I,e.domain,_),Me(I,vl,_),Me(I,Av,_),Bt(j,e.domain,_),Bt(j,t,_),Me(j,vl,_);const P=[[Iv,jv],[mw,gw],[vw,yw],[bw,xw],[Cw,ww],[_w,Sw],[kw,Iw],[jw,Ew]];for(let D=0;D<P.length;D++){const[O,N]=P[D],F=Me(_,O);Me(S,O,F),Me(F,N,_);const X=La(e2);Bt(F,t,X);const L=La();Bt(F,n),Bt(X,t,X),Bt(X,n,L),Bt(L,t,X),Bt(L,n,L),Me(X,N,_),Me(L,N,_)}return Me(i,Ey,y),Me(i,yL,Dmt),{start:i,tokens:Y0e}}function Lmt(e,t,n){let s=n.length,i=0,o=[],r=[];for(;i<s;){let l=e,c=null,d=null,u=0,p=null,m=-1;for(;i<s&&!(c=l.go(n[i].t));)r.push(n[i++]);for(;i<s&&(d=c||l.go(n[i].t));)c=null,l=d,l.accepts()?(m=0,p=l):m>=0&&m++,i++,u++;if(m<0)i-=u,i<s&&(r.push(n[i]),i++);else{r.length>0&&(o.push(LA(OG,t,r)),r=[]),i-=m,u-=m;const f=p.t,g=n.slice(i-u,i);o.push(LA(f,t,g))}}return r.length>0&&o.push(LA(OG,t,r)),o}function LA(e,t,n){const s=n[0].s,i=n[n.length-1].e,o=t.slice(s,i);return new e(o,n)}const Gi={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Rmt(){Gi.scanner=Pmt(Gi.customSchemes);for(let e=0;e<Gi.tokenQueue.length;e++)Gi.tokenQueue[e][1]({scanner:Gi.scanner});Gi.parser=Mmt(Gi.scanner.tokens);for(let e=0;e<Gi.pluginQueue.length;e++)Gi.pluginQueue[e][1]({scanner:Gi.scanner,parser:Gi.parser});return Gi.initialized=!0,Gi}function tve(e){return Gi.initialized||Rmt(),Lmt(Gi.parser.start,e,Q0e(Gi.scanner.start,e))}tve.scan=Q0e;function Omt(e,t,n){const s=tve(e),i=[];for(let o=0;o<s.length;o++){const r=s[o];if(r.t==="nl"&&t.get("nl2br")){const l=`__linkify-el-${n.elementId++}`;i.push(h.createElement("br",{key:l}))}else if(!r.isLink||!t.check(r))i.push(r.toString());else{let l=t.render(r);if(!("key"in l.props)){const c=`__linkify-el-${n.elementId++}`,d=J0e.assign({key:c},l.props);l=h.cloneElement(l,d)}i.push(l)}}return i}function nve(e,t,n){if(h.Children.count(e.props.children)===0)return e;const s=[];h.Children.forEach(e.props.children,r=>{typeof r=="string"?s.push.apply(s,Omt(r,t,n)):h.isValidElement(r)?typeof r.type=="string"&&t.ignoreTags.indexOf(r.type.toUpperCase())>=0?s.push(r):s.push(nve(r,t,n)):s.push(r)});const i=`__linkify-el-${n.elementId++}`,o=J0e.assign({key:i},e.props);return h.cloneElement(e,o,s)}const xb=e=>{let t=0;const n=({tagName:c,attributes:d,content:u})=>(d.key=`__linkify-lnk-${t++}`,d.class&&(d.className=d.class,delete d.class),h.createElement(c,d,u)),s={key:"__linkify-wrapper"};for(const c in e)c!=="options"&&c!=="as"&&c!=="tagName"&&c!=="children"&&(s[c]=e[c]);const i=new Hk(e.options,n),o=e.as||e.tagName||h.Fragment||"span",r=e.children,l=h.createElement(o,s,r);return nve(l,i,{elementId:0})},Nmt={fontWeight:"bold",fontSize:"2xl",whiteSpace:"pre-wrap",'&[data-is-empty="true"]':{opacity:.3},...yb},_L=h.memo(({content:e,...t})=>{const{t:n}=T();return a.jsx(q,{sx:Nmt,"data-is-empty":e==="",...t,children:a.jsx(xb,{options:bb,children:e||n("workflows.builder.headingPlaceholder")})})});_L.displayName="HeadingElementContent";const sve=h.memo(({el:e})=>{const{t}=T(),n=Q(),{id:s,data:i}=e,{content:o}=i,r=h.useRef(null),l=h.useCallback(d=>{n(bke({id:s,changes:{content:d}}))},[n,s]),c=rc({value:o,defaultValue:"",onChange:l,inputRef:r});return c.isEditing?a.jsx(gL,{ref:r,placeholder:t("workflows.builder.headingPlaceholder"),...c.inputProps,variant:"outline",overflowWrap:"anywhere",w:"full",minRows:1,maxRows:10,resize:"none",p:1,px:2,fontWeight:"bold",fontSize:"2xl",_focusVisible:{borderRadius:"base",h:"unset"}}):a.jsx(_L,{content:c.value,onDoubleClick:c.startEditing})});sve.displayName="HeadingElementContentEditable";const Fmt={position:"relative",borderRadius:"base",minW:32,'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 0 0"},flexDir:"column"},ive=h.memo(({el:e})=>{const t=h.useRef(null),n=h.useRef(null),[s,i]=ub(e.id,t,n),o=il(),{id:r}=e;return a.jsxs(A,{ref:t,id:r,className:Zq,sx:Fmt,"data-parent-layout":o.layout,children:[a.jsx(og,{dragHandleRef:n,element:e,"data-is-dragging":i}),a.jsx(ig,{"data-is-dragging":i,p:4,children:a.jsx(sve,{el:e})}),a.jsx(vb,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});ive.displayName="HeadingElementEditMode";const Bmt={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},ove=h.memo(({el:e})=>{const{id:t,data:n}=e,{content:s}=n,i=il();return a.jsx(A,{id:t,className:Zq,sx:Bmt,"data-parent-layout":i.layout,children:a.jsx(_L,{content:s})})});ove.displayName="HeadingElementViewMode";const ave=h.memo(({id:e})=>{const t=ag(e),n=M(Zc);return!t||!Xq(t)?null:n==="view"?a.jsx(ove,{el:t}):a.jsx(ive,{el:t})});ave.displayName="HeadingElement";const rve=h.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=Q(),i=Fk(n.fieldName),o=dc(n.fieldName),r=h.useRef(null),l=h.useCallback(d=>{s(Rq({nodeId:n.nodeId,fieldName:n.fieldName,val:d}))},[s,n.fieldName,n.nodeId]),c=rc({value:i||o.description,defaultValue:o.description,inputRef:r,onChange:l});return c.isEditing?a.jsx(no,{ref:r,variant:"outline",fontSize:"sm",p:1,px:2,_focusVisible:{borderRadius:"base",h:"unset"},...c.inputProps}):a.jsx(Vo,{onDoubleClick:c.startEditing,sx:yb,children:a.jsx(xb,{options:bb,children:c.value})})});rve.displayName="NodeFieldElementDescriptionEditable";const RA=Symbol("uniqueNonexistentValue"),zmt=(e,t,n)=>{const s=Q(),i=h.useMemo(()=>ve(Xn,d=>e in d.formFieldInitialValues?d.formFieldInitialValues[e]:RA),[e]),o=M(i),r=h.useMemo(()=>ve(Xn,d=>{if(o===RA)return!1;const u=d.nodes.find(m=>m.id===t);if(!eo(u))return;const p=u.data.inputs[n]?.value;return!yo(p,o)}),[n,o,t]),l=M(r),c=h.useCallback(()=>{o!==RA&&s(QM({nodeId:t,fieldName:n,value:o}))},[s,n,t,o]);return{initialValue:o,isValueChanged:l,resetToInitialValue:c}},SL=h.memo(({element:e})=>{const{t}=T(),{id:n,data:s}=e,{nodeId:i,fieldName:o}=s.fieldIdentifier,{isValueChanged:r,resetToInitialValue:l}=zmt(n,i,o);return r?a.jsx(oe,{variant:"link",size:"sm",alignSelf:"stretch",tooltip:t("nodes.resetToDefaultValue"),"aria-label":t("nodes.resetToDefaultValue"),icon:a.jsx(Gs,{}),onClick:l,isDisabled:!r}):null});SL.displayName="NodeFieldElementResetToInitialValueIconButton";const lve=h.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=Q(),i=dL(n.fieldName),o=dc(n.fieldName),r=h.useRef(null),l=h.useCallback(d=>{s(Fq({nodeId:n.nodeId,fieldName:n.fieldName,label:d}))},[s,n.fieldName,n.nodeId]),c=rc({value:i||o.title,defaultValue:o.title,inputRef:r,onChange:l});return c.isEditing?a.jsx(Nt,{ref:r,variant:"outline",p:1,px:2,_focusVisible:{borderRadius:"base",h:"unset"},...c.inputProps}):a.jsxs(A,{w:"full",gap:4,children:[a.jsx(ne,{onDoubleClick:c.startEditing,cursor:"text",children:c.value}),a.jsx(At,{}),a.jsx(SL,{element:e})]})});lve.displayName="NodeFieldElementLabelEditable";const Vmt=mr({}).options,cve=h.memo(({id:e,settings:t})=>{const{t:n}=T(),s=Q(),i=h.useCallback(d=>{const u=[...t.options];u.splice(d,1),s(Fs({id:e,changes:{settings:{...t,options:u}}}))},[t,s,e]),o=h.useCallback((d,u)=>{if(!t.options[d])return;const p={...t.options[d],value:u},m=[...t.options];m[d]=p,s(Fs({id:e,changes:{settings:{...t,options:m}}}))},[s,e,t]),r=h.useCallback((d,u)=>{if(!t.options[d])return;const p={...t.options[d],label:u},m=[...t.options];m[d]=p,s(Fs({id:e,changes:{settings:{...t,options:m}}}))},[s,e,t]),l=h.useCallback(()=>{const d=[...t.options,oP()];s(Fs({id:e,changes:{settings:{...t,options:d}}}))},[s,e,t]),c=h.useCallback(()=>{const d=[oP()];s(Fs({id:e,changes:{settings:{...t,options:d}}}))},[s,e,t]);return a.jsxs(A,{className:bt,position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,children:[a.jsxs(zn,{isAttached:!1,w:"full",children:[a.jsx(he,{onClick:l,variant:"ghost",flex:1,leftIcon:a.jsx(Sn,{}),children:n("workflows.builder.addOption")}),a.jsx(he,{onClick:c,variant:"ghost",flex:1,leftIcon:a.jsx(Gs,{}),children:n("workflows.builder.resetOptions")})]}),t.options.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(vt,{}),a.jsx(ti,{className:kn,defer:!0,style:ic,options:Vmt,children:a.jsxs(Ms,{gap:1,gridTemplateColumns:"auto 1fr 1fr auto",gridTemplateRows:"auto 1fr",alignItems:"center",children:[a.jsx(_t,{minW:8,children:a.jsx(q,{textAlign:"center",variant:"subtext",children:"#"})}),a.jsx(_t,{children:a.jsx(q,{textAlign:"center",variant:"subtext",children:n("common.label")})}),a.jsx(_t,{children:a.jsx(q,{textAlign:"center",variant:"subtext",children:n("common.value")})}),a.jsx(_t,{}),t.options.map(({value:d,label:u},p)=>a.jsx(dve,{value:d,label:u,index:p,onRemoveOption:i,onChangeOptionValue:o,onChangeOptionLabel:r,isRemoveDisabled:t.options.length<=1},p))]})})]})]})});cve.displayName="NodeFieldElementStringDropdownSettings";const dve=h.memo(({value:e,label:t,index:n,onRemoveOption:s,onChangeOptionValue:i,onChangeOptionLabel:o,isRemoveDisabled:r})=>{const{t:l}=T(),c=h.useCallback(()=>{s(n)},[n,s]),d=h.useCallback(p=>{i(n,p.target.value)},[n,i]),u=h.useCallback(p=>{o(n,p.target.value)},[n,o]);return a.jsxs(a.Fragment,{children:[a.jsx(_t,{children:a.jsxs(q,{variant:"subtext",textAlign:"center",children:[n+1,"."]})}),a.jsx(_t,{children:a.jsx(Nt,{size:"sm",resize:"none",placeholder:"label",value:t,onChange:u})}),a.jsx(_t,{children:a.jsx(Nt,{size:"sm",resize:"none",placeholder:"value",value:e,onChange:d})}),a.jsx(_t,{children:a.jsx(oe,{tabIndex:-1,size:"sm",variant:"link",minW:8,minH:8,onClick:c,isDisabled:r,icon:a.jsx(fn,{}),"aria-label":l("common.delete")})})]})});dve.displayName="ListItemContent";const $mt={position:"relative",borderRadius:"base",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0"},flexDir:"column"},uve=h.memo(({el:e})=>{const t=h.useRef(null),n=h.useRef(null),[s,i]=ub(e.id,t,n),o=il(),{id:r}=e;return a.jsxs(A,{ref:t,id:r,className:Yq,sx:$mt,"data-parent-layout":o.layout,children:[a.jsx(hve,{dragHandleRef:n,el:e,isDragging:i}),a.jsx(pve,{nodeId:e.data.fieldIdentifier.nodeId}),a.jsx(vb,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});uve.displayName="NodeFieldElementEditMode";const hve=h.memo(({el:e,dragHandleRef:t,isDragging:n})=>{const{id:s,data:i}=e,{fieldIdentifier:o,showDescription:r}=i;return a.jsxs(a.Fragment,{children:[a.jsx(og,{dragHandleRef:t,element:e,"data-is-dragging":n}),a.jsx(ig,{"data-is-dragging":n,p:4,children:a.jsx(Jl,{nodeId:o.nodeId,children:a.jsx(ap,{nodeId:o.nodeId,fieldName:o.fieldName,children:a.jsxs(te,{flex:"1 1 0",orientation:"vertical",children:[a.jsx(lve,{el:e}),a.jsx(A,{w:"full",gap:4,children:a.jsx(zk,{nodeId:o.nodeId,fieldName:o.fieldName,settings:i.settings})}),r&&a.jsx(rve,{el:e}),i.settings?.type==="string-field-config"&&i.settings.component==="dropdown"&&a.jsxs(a.Fragment,{children:[a.jsx(vt,{}),a.jsx(cve,{id:s,settings:i.settings})]})]})})})})]})});hve.displayName="NodeFieldElementEditModeContent";const Gmt={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",transitionProperty:"none",pointerEvents:"none",display:"none",'&[data-is-mouse-over-node-or-form-field="true"]':{display:"block",bg:"invokeBlueAlpha.100"}},pve=h.memo(({nodeId:e})=>{const t=J8(e),n=eL(e);return a.jsx(ke,{sx:Gmt,"data-is-mouse-over-node-or-form-field":t.isMouseOverNode||n.isMouseOverFormField})});pve.displayName="NodeFieldElementOverlay";const fve=h.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=dL(n.fieldName),i=dc(n.fieldName),o=h.useMemo(()=>s||i.title,[s,i.title]);return a.jsxs(A,{w:"full",gap:4,children:[a.jsx(ne,{children:o}),a.jsx(At,{}),a.jsx(SL,{element:e})]})});fve.displayName="NodeFieldElementLabel";const Hmt=e=>{const t=yn(),n=h.useMemo(()=>t.buildSelectInputFieldTemplateSafe(e),[t,e]);return M(n)},Wmt={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32},'&[data-with-description="false"]':{pb:2}},Umt=()=>{const{t:e}=T();return h.useCallback(n=>e("nodes.unknownFieldEditWorkflowToFix_withName",{name:n}),[e])},mve=h.memo(({el:e})=>{const{id:t,data:n}=e,{fieldIdentifier:s,showDescription:i}=n,o=Fk(s.fieldName),r=Hmt(s.fieldName),l=il(),c=Umt(),d=h.useMemo(()=>o||r?.description||"",[o,r?.description]);return a.jsx(A,{id:t,className:Yq,sx:Wmt,"data-parent-layout":l.layout,"data-with-description":i&&!!d,children:a.jsx(ap,{nodeId:e.data.fieldIdentifier.nodeId,fieldName:e.data.fieldIdentifier.fieldName,formatLabel:c,children:a.jsx(gve,{el:e})})})});mve.displayName="NodeFieldElementViewMode";const gve=h.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n,showDescription:s}=t,i=Fk(n.fieldName),o=dc(n.fieldName),r=h.useMemo(()=>i||o.description,[i,o.description]);return a.jsxs(te,{flex:"1 1 0",orientation:"vertical",children:[a.jsx(fve,{el:e}),a.jsx(A,{w:"full",gap:4,children:a.jsx(zk,{nodeId:n.nodeId,fieldName:n.fieldName,settings:t.settings})}),s&&r&&a.jsx(Vo,{sx:yb,children:a.jsx(xb,{options:bb,children:r})})]})});gve.displayName="NodeFieldElementViewModeContent";const vve=h.memo(({id:e})=>{const t=ag(e),n=M(Zc);return!t||!Ly(t)?null:n==="view"?a.jsx(Jl,{nodeId:t.data.fieldIdentifier.nodeId,children:a.jsx(mve,{el:t})}):a.jsx(Jl,{nodeId:t.data.fieldIdentifier.nodeId,children:a.jsx(uve,{el:t})})});vve.displayName="NodeFieldElement";const qmt={fontSize:"md",whiteSpace:"pre-wrap",overflowWrap:"anywhere",'&[data-is-empty="true"]':{opacity:.3},...yb},kL=h.memo(({content:e,...t})=>{const{t:n}=T();return a.jsx(q,{sx:qmt,"data-is-empty":e==="",...t,children:a.jsx(xb,{options:bb,children:e||n("workflows.builder.textPlaceholder")})})});kL.displayName="TextElementContent";const yve=h.memo(({el:e})=>{const{t}=T(),n=Q(),{id:s,data:i}=e,{content:o}=i,r=h.useRef(null),l=h.useCallback(d=>{n(xke({id:s,changes:{content:d}}))},[n,s]),c=rc({value:o,defaultValue:"",onChange:l,inputRef:r});return c.isEditing?a.jsx(gL,{ref:r,placeholder:t("workflows.builder.textPlaceholder"),...c.inputProps,fontSize:"md",variant:"outline",overflowWrap:"anywhere",w:"full",minRows:1,maxRows:10,resize:"none",p:2}):a.jsx(kL,{content:c.value,onDoubleClick:c.startEditing})});yve.displayName="TextElementContentEditable";const Kmt={position:"relative",borderRadius:"base",minW:32,'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 0 0"},flexDir:"column"},bve=h.memo(({el:e})=>{const t=h.useRef(null),n=h.useRef(null),[s,i]=ub(e.id,t,n),o=il(),{id:r}=e;return a.jsxs(A,{ref:t,id:r,className:Qq,sx:Kmt,"data-parent-layout":o.layout,children:[a.jsx(og,{dragHandleRef:n,element:e,"data-is-dragging":i}),a.jsx(ig,{"data-is-dragging":i,p:4,children:a.jsx(yve,{el:e})}),a.jsx(vb,{activeDropRegion:s,gap:"var(--invoke-space-4)"})]})});bve.displayName="TextElementEditMode";const Zmt={'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},xve=h.memo(({el:e})=>{const{id:t,data:n}=e,{content:s}=n,i=il();return a.jsx(A,{id:t,className:Qq,sx:Zmt,"data-parent-layout":i.layout,children:a.jsx(kL,{content:s})})});xve.displayName="TextElementViewMode";const Cve=h.memo(({id:e})=>{const t=ag(e),n=M(Zc);return!t||!Jq(t)?null:n==="view"?a.jsx(xve,{el:t}):a.jsx(bve,{el:t})});Cve.displayName="TextElement";const wve=h.memo(({id:e})=>{const t=ag(e),n=M(Zc);return!t||!Ga(t)?null:n==="view"?a.jsx(_ve,{el:t}):a.jsx(Sve,{el:t})});wve.displayName="ContainerElementComponent";const Xmt={gap:2,'&[data-self-layout="column"]':{flexDir:"column",alignItems:"stretch"},'&[data-self-layout="row"]':{flexDir:"row",alignItems:"flex-start",overflowX:"auto",overflowY:"visible",h:"min-content",flexShrink:0},'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",minW:32}},_ve=h.memo(({el:e})=>{const{t}=T(),n=Gk(),s=il(),{id:i,data:o}=e,{children:r,layout:l}=o;return a.jsx(gb,{depth:n+1,children:a.jsx(mb,{id:i,layout:l,children:a.jsxs(A,{id:i,className:nK,sx:Xmt,"data-self-layout":l,"data-depth":n,"data-parent-layout":s.layout,children:[r.map(c=>a.jsx(Cb,{id:c},c)),r.length===0&&a.jsx(A,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:a.jsx(q,{variant:"subtext",children:t("workflows.builder.containerPlaceholder")})})]})})})});_ve.displayName="ContainerElementComponentViewMode";const Ymt={borderRadius:"base",position:"relative",'&[data-active-drop-region="center"]':{opacity:1,bg:"base.850"},flexDir:"column",'&[data-parent-layout="column"]':{w:"full",h:"min-content"},'&[data-parent-layout="row"]':{flex:"1 1 0",h:"min-content"}},Qmt={gap:4,p:4,flex:"1 1 0",'&[data-self-layout="column"]':{flexDir:"column"},'&[data-self-layout="row"]':{flexDir:"row",overflowX:"auto"}},Sve=h.memo(({el:e})=>{const t=Gk(),n=h.useRef(null),s=h.useRef(null),i=h.useRef(null),[o,r]=ub(e.id,n,s),{id:l,data:c}=e,{children:d,layout:u}=c,p=il();return h.useEffect(()=>{const m=i.current;if(m&&u!=="column")return B5({element:m})},[u]),a.jsx(gb,{depth:t+1,children:a.jsx(mb,{id:l,layout:u,children:a.jsxs(A,{id:l,ref:n,className:nK,sx:Ymt,"data-depth":t,"data-parent-layout":p.layout,"data-active-drop-region":o,children:[a.jsx(og,{dragHandleRef:s,element:e,"data-is-dragging":r}),a.jsx(ig,{"data-is-dragging":r,children:a.jsxs(A,{ref:i,sx:Qmt,"data-self-layout":u,children:[d.map(m=>a.jsx(Cb,{id:m},m)),d.length===0&&a.jsx(Ave,{})]})}),a.jsx(vb,{activeDropRegion:o,gap:"var(--invoke-space-4)"})]})})})});Sve.displayName="ContainerElementComponentEditMode";const kve={position:"relative",alignItems:"center",borderRadius:"base",w:"full",h:"full",gap:2,display:"flex",flex:1,maxW:"768px",'&[data-self-layout="column"]':{flexDir:"column",alignItems:"stretch"},'&[data-self-layout="row"]':{flexDir:"row",alignItems:"flex-start"}},Ive=h.memo(()=>{const e=M(eK),{id:t,data:n}=e,{children:s,layout:i}=n;return a.jsx(gb,{depth:0,children:a.jsx(mb,{id:t,layout:i,children:a.jsx(ke,{id:t,className:tK,sx:kve,"data-self-layout":i,"data-depth":0,children:s.map(o=>a.jsx(Cb,{id:o},o))})})})});Ive.displayName="RootContainerElementViewMode";const Jmt={...kve,gap:4,'&[data-is-dragging-over="true"]':{opacity:1,bg:"base.850"}},jve=h.memo(()=>{const e=M(eK),{id:t,data:n}=e,{children:s,layout:i}=n,o=h.useRef(null),r=Pht(o);return a.jsx(gb,{depth:0,children:a.jsx(mb,{id:t,layout:i,children:a.jsxs(A,{ref:o,id:t,className:tK,sx:Jmt,"data-self-layout":i,"data-depth":0,"data-is-dragging-over":r,children:[s.map(l=>a.jsx(Cb,{id:l},l)),s.length===0&&a.jsx(Eve,{})]})})})});jve.displayName="RootContainerElementEditMode";const Eve=h.memo(()=>{const{t:e}=T();return a.jsx(A,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:a.jsx(q,{variant:"subtext",children:e("workflows.builder.emptyRootPlaceholderEditMode")})})});Eve.displayName="RootPlaceholder";const Ave=h.memo(()=>{const{t:e}=T();return a.jsx(A,{p:8,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:a.jsx(q,{variant:"subtext",children:e("workflows.builder.containerPlaceholder")})})});Ave.displayName="NonRootPlaceholder";const Cb=h.memo(({id:e})=>{const t=ag(e);if(!t)return null;if(Ga(t))return a.jsx(wve,{id:e},e);if(Ly(t))return a.jsx(vve,{id:e},e);if(Kq(t))return a.jsx(W0e,{id:e},e);if(Xq(t))return a.jsx(ave,{id:e},e);if(Jq(t))return a.jsx(Cve,{id:e},e);ae(!1,`Unhandled type for element with id ${e}`)});Cb.displayName="FormElementComponent";const egt=()=>{const e=Ze();return h.useCallback(()=>{const n=Cke(e.getState()),s=Mq(e.getState());for(const i of s){if(!(i.id in n))continue;const{nodeId:o,fieldName:r}=i.data.fieldIdentifier;e.dispatch(QM({nodeId:o,fieldName:r,value:n[i.id]}))}},[e])},Pve=h.memo(()=>{const{t:e}=T(),t=Ze(),n=egt(),s=h.useCallback(()=>{t.dispatch(wke())},[t]);return a.jsxs(An,{placement:"bottom-end",children:[a.jsx(Pn,{as:oe,icon:a.jsx($De,{}),variant:"ghost",size:"sm"}),a.jsxs(Zt,{children:[a.jsx(be,{icon:a.jsx(Gs,{}),onClick:n,children:e("workflows.builder.resetAllNodeFields")}),a.jsx(be,{isDestructive:!0,icon:a.jsx(Qc,{}),onClick:s,children:e("workflows.builder.deleteAllElements")})]})]})});Pve.displayName="WorkflowBuilderEditMenu";const tgt={pt:3,w:"full",'&[data-is-empty="true"]':{pt:0}},Tve=h.memo(()=>{const{t:e}=T();return Aht(),a.jsx(A,{justifyContent:"center",w:"full",h:"full",children:a.jsxs(A,{flexDir:"column",w:"full",maxW:"768px",gap:2,children:[a.jsxs(A,{w:"full",alignItems:"center",gap:2,pt:3,children:[a.jsx(t2,{type:"container",children:e("workflows.builder.container")}),a.jsx(t2,{type:"divider",children:e("workflows.builder.divider")}),a.jsx(t2,{type:"heading",children:e("workflows.builder.heading")}),a.jsx(t2,{type:"text",children:e("workflows.builder.text")}),a.jsx(he,{size:"sm",variant:"ghost",tooltip:e("workflows.builder.nodeFieldTooltip"),children:e("workflows.builder.nodeField")}),a.jsx(At,{}),a.jsx(Pve,{})]}),a.jsx(Hs,{children:a.jsx(Dve,{})})]})})});Tve.displayName="WorkflowBuilder";const Dve=h.memo(()=>{const{t:e}=T(),t=M(sK),n=Yw(),s=le(Jw);return n.isLoading||!s?a.jsx(On,{label:e("nodes.loadingNodes"),icon:null}):a.jsx(A,{sx:tgt,"data-is-empty":t,children:a.jsx(jve,{})})});Dve.displayName="WorkflowBuilderContent";const ngt=(e,t)=>{const[n,s]=h.useState(!1);return h.useEffect(()=>{const i=t.current;if(i)return zi(Hm(i),wm({element:i,getInitialData:()=>{if(e==="container"){const o=_ke("row",[]);return oh(o)}if(e==="divider"){const o=Ske();return oh(o)}if(e==="heading"){const o=kke("");return oh(o)}if(e==="text"){const o=Ike("");return oh(o)}ae(!1)},onDragStart:()=>{s(!0)},onDrop:()=>{s(!1)}}))},[t,e]),n},sgt={cursor:"grab",borderStyle:"dashed",_active:{borderStyle:"dashed"},_disabled:{borderStyle:"dashed",opacity:.5}},t2=({type:e,children:t})=>{const n=h.useRef(null),s=ngt(e,n);return a.jsx(he,{as:"div",ref:n,size:"sm",isDisabled:s,variant:"outline",sx:sgt,children:t})},igt=({imageUrl:e,onChange:t})=>{const[n,s]=h.useState(null),i=h.useCallback(async u=>{if(!u){s(null);return}try{const p=await kS(u);if(p){const m=new File([p],"workflow.png",{type:"image/png"});s(m)}}catch{s(null)}},[]);h.useEffect(()=>{i(e)},[e,i]);const{t:o}=T(),r=h.useCallback(u=>{const p=u[0];p&&(s(p),t(URL.createObjectURL(p)))},[t]),l=h.useCallback(()=>{s(null),t(null)},[t]),{getInputProps:c,getRootProps:d}=oc({accept:AS,onDropAccepted:r,noDrag:!0,multiple:!1});return n?a.jsxs(ke,{position:"relative",flexShrink:0,children:[a.jsx(Nn,{src:URL.createObjectURL(n),objectFit:"cover",objectPosition:"50% 50%",w:100,h:100,borderRadius:"base"}),a.jsx(oe,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:l,"aria-label":o("stylePresets.deleteImage"),tooltip:o("stylePresets.deleteImage"),icon:a.jsx(Gs,{}),size:"md",variant:"ghost"})]}):a.jsxs(a.Fragment,{children:[a.jsx(He,{label:o("stylePresets.uploadImage"),children:a.jsx(A,{as:he,w:100,h:100,opacity:.3,borderRadius:"base",alignItems:"center",justifyContent:"center",flexShrink:0,...d(),children:a.jsx(Je,{as:p1,w:8,h:8})})}),a.jsx("input",{...c()})]})},ogt=({workflowId:e,thumbnailUrl:t})=>{const{t:n}=T(),[s,i]=h.useState(null),[o,r]=h.useState(!1),[l,{isLoading:c}]=nDe(),[d,{isLoading:u}]=sDe(),p=h.useCallback(f=>{i(f),r(!0)},[]),m=h.useCallback(async()=>{try{if(s){const f=await kS(s);if(!f)return;const g=new File([f],"workflow_thumbnail.png",{type:"image/png"});await l({workflow_id:e,image:g}).unwrap()}else await d(e).unwrap();r(!1),pe({status:"success",title:"Workflow thumbnail updated"})}catch{pe({status:"error",title:"Failed to update thumbnail"})}},[d,l,e,s]);return a.jsxs(A,{alignItems:"center",gap:4,children:[a.jsx(igt,{imageUrl:t,onChange:p}),a.jsx(he,{size:"sm",isLoading:c||u,onClick:m,isDisabled:!o||!e,children:n("common.saveChanges")})]})},agt=()=>{const e=M(nM),t=M(w_),n=M(iK),s=M(jke),i=M(Eke),o=M(Ake),r=M(Pke),l=M(Tke),c=Q(),d=h.useCallback(C=>{c(yW(C.target.value))},[c]),u=h.useCallback(C=>{c(Dke(C.target.value))},[c]),p=h.useCallback(C=>{c(Mke(C.target.value))},[c]),m=h.useCallback(C=>{c(Lke(C.target.value))},[c]),f=h.useCallback(C=>{c(Rke(C.target.value))},[c]),g=h.useCallback(C=>{c(Oke(C.target.value))},[c]),v=h.useCallback(C=>{c(Nke(C.target.value))},[c]),{t:b}=T();return a.jsx(Hs,{children:a.jsx(A,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:a.jsxs(Ys,{orientation:"vertical",formControlProps:lgt,children:[a.jsxs(te,{children:[a.jsx(ne,{children:b("nodes.workflowName")}),a.jsx(Nt,{variant:"darkFilled",value:t,onChange:d})]}),a.jsx(cgt,{id:e}),a.jsxs(te,{children:[a.jsx(ne,{children:b("nodes.workflowVersion")}),a.jsx(Nt,{variant:"darkFilled",value:l,onChange:m})]}),a.jsxs(te,{children:[a.jsx(ne,{children:b("nodes.workflowAuthor")}),a.jsx(Nt,{variant:"darkFilled",value:i,onChange:u})]}),a.jsxs(te,{children:[a.jsx(ne,{children:b("nodes.workflowContact")}),a.jsx(Nt,{variant:"darkFilled",value:o,onChange:p})]}),a.jsxs(te,{children:[a.jsx(ne,{children:b("nodes.workflowTags")}),a.jsx(Nt,{variant:"darkFilled",value:r,onChange:g})]}),a.jsxs(te,{children:[a.jsx(ne,{children:b("nodes.workflowDescription")}),a.jsx(no,{variant:"darkFilled",onChange:f,value:n,fontSize:"sm",resize:"none",rows:3})]}),a.jsxs(te,{children:[a.jsx(ne,{children:b("nodes.workflowNotes")}),a.jsx(no,{variant:"darkFilled",onChange:v,value:s,fontSize:"sm",resize:"none",rows:10})]})]})})})},rgt=h.memo(agt),lgt={flexShrink:0},cgt=({id:e})=>{const{t}=T(),{data:n}=UZ(e??Ri);return n?n.workflow.meta.category==="default"&&n.thumbnail_url?a.jsxs(te,{children:[a.jsx(ne,{children:t("workflows.workflowThumbnail")}),a.jsx(ke,{position:"relative",flexShrink:0,children:a.jsx(Nn,{src:n.thumbnail_url,objectFit:"cover",objectPosition:"50% 50%",w:100,h:100,borderRadius:"base"})})]}):n.workflow.meta.category!=="default"?a.jsxs(te,{children:[a.jsx(ne,{children:t("workflows.workflowThumbnail")}),a.jsx(ogt,{thumbnailUrl:n.thumbnail_url,workflowId:n.workflow_id})]}):null:null},dgt=()=>{const e=le(iDe),{t}=T();return a.jsx(A,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:a.jsx(Xl,{data:e,label:t("nodes.workflow"),bg:"base.850",color:"base.200"})})},ugt=h.memo(dgt),hgt=()=>{const{t:e}=T();return a.jsxs(Vy,{variant:"enclosed",display:"flex",w:"full",h:"full",flexDir:"column",children:[a.jsxs($y,{children:[a.jsx(Qs,{children:e("workflows.builder.builder")}),a.jsx(Qs,{children:e("common.details")}),a.jsx(Qs,{children:"JSON"}),a.jsx(At,{})]}),a.jsxs(Gy,{h:"full",pt:2,children:[a.jsx(Js,{h:"full",p:0,children:a.jsx(Tve,{})}),a.jsx(Js,{h:"full",p:0,children:a.jsx(rgt,{})}),a.jsx(Js,{h:"full",p:0,children:a.jsx(ugt,{})})]})]})},pgt=h.memo(hgt),fgt={height:"100%",width:"100%"},Mve=h.memo(()=>{const e=h.useRef(null),t=h.useCallback(()=>{e.current&&e.current.setLayout([50,50])},[]);return a.jsx(ke,{position:"relative",w:"full",h:"full",children:a.jsxs(k3,{ref:e,id:"workflow-panel-group",autoSaveId:"workflow-panel-group",direction:"vertical",style:fgt,children:[a.jsx(vy,{id:"workflow",collapsible:!0,minSize:25,children:a.jsx(pgt,{})}),a.jsx(Iae,{onDoubleClick:t}),a.jsx(vy,{id:"inspector",collapsible:!0,minSize:25,children:a.jsx(qft,{})})]})})});Mve.displayName="EditModeLeftPanelContent";const Lve=h.memo(()=>{const e=M(iK);return e?a.jsx(He,{label:e,children:a.jsx(q,{color:"base.300",fontStyle:"italic",sx:yb,noOfLines:1,children:a.jsx(xb,{options:bb,children:e})})}):null});Lve.displayName="ActiveWorkflowDescription";const mgt=()=>{const e=Pm(),{t}=T(),n=M(w_);return a.jsx(he,{variant:"ghost",rightIcon:a.jsx(bX,{}),size:"sm",onClick:e.open,children:a.jsx(q,{display:"auto",noOfLines:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",wordBreak:"break-all",children:n||t("workflows.chooseWorkflowFromLibrary")})})},Rve=h.memo(()=>{const e=Q(),t=M(Zc),{t:n}=T(),s=h.useCallback(o=>{o.stopPropagation(),e(Gl("edit")),Ne.focusPanel("workflows",Zn)},[e]),i=h.useCallback(o=>{o.stopPropagation(),e(Gl("view")),Ne.focusPanel("workflows",cs)},[e]);return t==="view"?a.jsx(oe,{"aria-label":n("nodes.editMode"),tooltip:n("nodes.editMode"),onClick:s,icon:a.jsx(OMe,{}),variant:"ghost",size:"sm"}):a.jsx(oe,{"aria-label":n("nodes.viewMode"),tooltip:n("nodes.viewMode"),onClick:i,icon:a.jsx(bu,{}),variant:"ghost",size:"sm"})});Rve.displayName="WorkflowViewEditToggleButton";const ggt=()=>{const e=Q(),t=a4();return h.useCallback(()=>{const s=t(),i=new Blob([JSON.stringify(s,null,2)]),o=document.createElement("a");o.href=URL.createObjectURL(i),o.download=`${s.name||"My Workflow"}.json`,document.body.appendChild(o),o.click(),o.remove(),e(lY())},[t,e])},vgt=()=>{const{t:e}=T(),t=ggt();return a.jsx(be,{as:"button",icon:a.jsx(Wh,{}),onClick:t,children:e("workflows.downloadWorkflow")})},ygt=h.memo(vgt),bgt=()=>{const{t:e}=T(),t=le(ni),{onOpen:n}=oee();return a.jsx(be,{as:"button",icon:a.jsx(G4,{}),onClick:n,isDisabled:!hq(t),children:e("workflows.loadFromGraph")})},xgt=h.memo(bgt),Ove=h.memo(()=>{const{t:e}=T(),t=jS();return a.jsx(be,{as:"button",icon:a.jsx(Q_,{}),onClick:t.createWithDialog,children:e("nodes.newWorkflow")})});Ove.displayName="NewWorkflowMenuItem";const Cgt=()=>{const{t:e}=T(),t=a4(),n=h.useCallback(s=>{s.stopPropagation();const i=t();ree(i)},[t]);return a.jsx(be,{as:"button",icon:a.jsx(ws,{}),onClick:n,children:e("workflows.saveWorkflowAs")})},wgt=h.memo(Cgt),_gt=()=>{const{t:e}=T(),t=Q8(),n=_m();return a.jsx(be,{as:"button",isDisabled:!n,icon:a.jsx(Ol,{}),onClick:t,children:e("workflows.saveWorkflow")})},Sgt=h.memo(_gt),kgt=()=>{const{t:e}=T(),t=ed(),n=h.useCallback(([o])=>{o&&t({type:"file",data:o})},[t]),{getRootProps:s,getInputProps:i}=oc({accept:{"application/json":[".json"]},onDropAccepted:n,noDrag:!0,multiple:!1});return a.jsxs(be,{as:"button",icon:a.jsx(p1,{}),...s(),children:[e("workflows.uploadWorkflow"),a.jsx("input",{...i()})]})},Igt=h.memo(kgt),Nve=h.memo(()=>{const{t:e}=T(),{isOpen:t,onOpen:n,onClose:s}=jo(),i=Jr();return im(s),a.jsxs(An,{isOpen:t,onOpen:n,onClose:s,children:[a.jsx(Pn,{as:oe,"aria-label":e("workflows.workflowEditorMenu"),icon:a.jsx(Z4,{}),pointerEvents:"auto",size:"sm",variant:"ghost"}),a.jsxs(Zt,{pointerEvents:"auto",children:[a.jsx(Ove,{}),a.jsx(Igt,{}),a.jsx(Yi,{}),a.jsx(Sgt,{}),a.jsx(wgt,{}),a.jsx(ygt,{}),i&&a.jsx(Yi,{}),i&&a.jsx(xgt,{})]})]})});Nve.displayName="WorkflowLibraryMenu";const jgt=()=>{const{t:e}=T(),t=Q8();return a.jsx(oe,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:a.jsx(Ol,{}),onClick:t,pointerEvents:"auto",variant:"ghost",size:"sm"})},Egt=h.memo(jgt),Fve=h.memo(()=>{const e=M(Zc);return a.jsxs(A,{w:"full",alignItems:"center",gap:1,minW:0,children:[a.jsx(mgt,{}),a.jsx(At,{}),e==="edit"&&a.jsx(Egt,{}),a.jsx(Rve,{}),a.jsx(Nve,{})]})});Fve.displayName="ActiveWorkflowNameAndActions";const Agt=()=>cDe()?a.jsx(Pgt,{}):a.jsx(Tgt,{}),Pgt=()=>{const{t:e}=T(),t=Q(),n=Pm(),s=h.useCallback(()=>{t(Gl("edit"))},[t]);return a.jsx(A,{flexDir:"column",h:"full",w:"full",alignItems:"center",children:a.jsxs(A,{flexDir:"column",gap:8,w:"full",pt:"20vh",px:8,maxW:768,children:[a.jsxs(sr,{onClick:s,gap:8,children:[a.jsx(Je,{as:Sn,boxSize:6,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:e("nodes.newWorkflow")}),a.jsx(q,{color:"base.300",fontSize:"sm",children:e("ui.launchpad.createNewWorkflowFromScratch")})]})]}),a.jsxs(sr,{onClick:n.open,gap:8,children:[a.jsx(Je,{as:J_,boxSize:6,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:e("nodes.loadWorkflow")}),a.jsx(q,{color:"base.300",fontSize:"sm",children:e("ui.launchpad.browseAndLoadWorkflows")})]})]}),a.jsx(q,{textAlign:"center",fontSize:"sm",color:"base.400",children:a.jsx(Bn,{i18nKey:"nodes.workflowHelpText",size:"sm",components:Dgt})})]})})},Tgt=()=>{const{t:e}=T(),t=Q(),n=h.useCallback(()=>{t(Gl("edit"))},[t]);return a.jsx(A,{flexDir:"column",h:"full",w:"full",alignItems:"center",children:a.jsxs(A,{flexDir:"column",gap:8,w:"full",pt:"20vh",px:8,maxW:768,children:[a.jsx(q,{textAlign:"center",fontSize:"sm",color:"base.300",children:e("nodes.noFieldsViewMode")}),a.jsxs(sr,{onClick:n,gap:8,children:[a.jsx(Je,{as:Sn,boxSize:6,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:e("nodes.edit")}),a.jsx(q,{color:"base.300",fontSize:"sm",children:"Switch to edit mode to build workflows"})]})]})]})})},Dgt={LinkComponent:a.jsx(aM,{fontSize:"sm",fontWeight:"semibold",href:"https://support.invoke.ai/support/solutions/articles/151000159663-example-workflows",target:"_blank"})},Bve=h.memo(()=>a.jsx(ke,{position:"relative",w:"full",h:"full",children:a.jsx(Hs,{children:a.jsx(zve,{})})}));Bve.displayName="ViewModeLeftPanelContent";const zve=h.memo(()=>{const{isLoading:e}=Yw(),t=le(Jw),n=M(sK);return e||!t?a.jsx(On,{label:ye("nodes.loadingNodes"),icon:null}):n?a.jsx(Agt,{}):a.jsx(A,{w:"full",justifyContent:"center",children:a.jsx(Ive,{})})});zve.displayName=" ViewModeLeftPanelContentInner";const Mgt=()=>{const e=M(Zc);return a.jsxs(A,{flexDir:"column",w:"full",h:"full",gap:2,children:[a.jsx(yk,{}),a.jsxs(A,{w:"full",h:"full",gap:2,flexDir:"column",children:[a.jsx(Fve,{}),e==="view"&&a.jsx(Lve,{}),e==="view"&&a.jsx(Bve,{}),e==="edit"&&a.jsx(Mve,{})]})]})},Lgt=h.memo(Mgt),Vve=h.memo(()=>{const{t:e}=T(),t=Pm(),n=jS(),s=h.useCallback(()=>{t.open()},[t]),i=h.useCallback(()=>{n.createWithDialog()},[n]),o=ed(),r=h.useCallback(([c])=>{c&&o({type:"file",data:c})},[o]),l=oc({accept:{"application/json":[".json"]},onDropAccepted:r,noDrag:!0,multiple:!1});return a.jsxs(ib,{heading:e("ui.launchpad.workflowsTitle"),children:[a.jsx(q,{variant:"subtext",fontSize:"md",lineHeight:"1.6",children:e("ui.launchpad.workflows.description")}),a.jsx(q,{children:a.jsx(he,{as:"a",variant:"link",href:"https://support.invoke.ai/support/solutions/articles/151000189610-getting-started-with-workflows-denoise-latents",target:"_blank",rel:"noopener noreferrer",size:"sm",children:e("ui.launchpad.workflows.learnMoreLink")})}),a.jsxs(A,{flexDir:"column",gap:8,children:[a.jsxs(sr,{onClick:s,position:"relative",gap:8,children:[a.jsx(Je,{as:J_,boxSize:8,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:e("ui.launchpad.workflows.browseTemplates.title")}),a.jsx(q,{color:"base.300",children:e("ui.launchpad.workflows.browseTemplates.description")})]})]}),a.jsxs(sr,{onClick:i,position:"relative",gap:8,children:[a.jsx(Je,{as:Q_,boxSize:8,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:e("ui.launchpad.workflows.createNew.title")}),a.jsx(q,{color:"base.300",children:e("ui.launchpad.workflows.createNew.description")})]})]}),a.jsxs(sr,{...l.getRootProps(),position:"relative",gap:8,children:[a.jsx(Je,{as:qo,boxSize:8,color:"base.500"}),a.jsxs(A,{flexDir:"column",alignItems:"flex-start",gap:2,children:[a.jsx(Pt,{size:"sm",children:e("ui.launchpad.workflows.loadFromFile.title")}),a.jsx(q,{color:"base.300",children:e("ui.launchpad.workflows.loadFromFile.description")})]}),a.jsxs(A,{position:"absolute",right:3,bottom:3,children:[a.jsx(qo,{}),a.jsx("input",{...l.getInputProps()})]})]})]})]})});Vve.displayName="WorkflowsLaunchpadPanel";const Rgt={[F_]:kk,[fm]:Ik,[yu]:ab},Ogt={[ka]:vs(Vve),[Zn]:vs(Aft),[cs]:vs(tb)},Ngt=(e,t)=>{Ne.registerContainer(e,"main",t,()=>{const n=t.addPanel({id:ka,component:ka,title:ye("ui.panels.launchpad"),tabComponent:yu,params:{tab:e,focusRegion:"launchpad",i18nKey:"ui.panels.launchpad"}});t.addPanel({id:Zn,component:Zn,title:ye("ui.panels.workflowEditor"),tabComponent:F_,params:{tab:e,focusRegion:"workflows",i18nKey:"ui.panels.workflowEditor"},position:{direction:"within",referencePanel:n.id}}),t.addPanel({id:cs,component:cs,title:ye("ui.panels.imageViewer"),tabComponent:fm,params:{tab:e,focusRegion:"viewer",i18nKey:"ui.panels.imageViewer"},position:{direction:"within",referencePanel:n.id}}),n.api.setActive()})},$ve=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Ngt(e,n)},[e]);return a.jsxs(a.Fragment,{children:[a.jsx(t1,{disableDnd:!0,locked:!0,disableFloatingGroups:!0,dndEdges:!1,tabComponents:Rgt,components:Ogt,onReady:t,theme:mk}),a.jsx(fk,{}),a.jsx(nb,{}),a.jsx(rb,{})]})});$ve.displayName="MainPanel";const Fgt={[Ia]:vs(U1),[ja]:vs(X1)},Bgt=(e,t)=>{Ne.registerContainer(e,"right",t,()=>{const n=t.addPanel({id:ja,component:ja,minimumWidth:Pi,minimumHeight:s1,params:{tab:e,focusRegion:"gallery"}}),s=t.addPanel({id:Ia,component:Ia,minimumHeight:n1,params:{tab:e,focusRegion:"boards"},position:{direction:"above",referencePanel:n.id}});n.api.setSize({height:i1}),s.api.setSize({height:B_})})},Gve=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Bgt(e,n)},[e]);return a.jsx(Eo,{className:"dockview-theme-invoke",orientation:Ke.VERTICAL,components:Fgt,onReady:t})});Gve.displayName="RightPanel";const zgt={[lr]:vs(Lgt)},Vgt=(e,t)=>{Ne.registerContainer(e,"left",t,()=>{t.addPanel({id:lr,component:lr,params:{tab:e,focusRegion:"settings"}})})},Hve=h.memo(()=>{const{tab:e}=Qo(),t=h.useCallback(({api:n})=>{Vgt(e,n)},[e]);return a.jsx(Eo,{className:"dockview-theme-invoke",orientation:Ke.VERTICAL,components:zgt,onReady:t})});Hve.displayName="LeftPanel";const $gt={[qi]:Hve,[rr]:$ve,[Ki]:Gve},Ggt=(e,t)=>{Ne.registerContainer(e,"root",t,()=>{const n=t.addPanel({id:rr,component:rr,priority:Hn.High}),s=t.addPanel({id:qi,component:qi,minimumWidth:ma,position:{direction:"left",referencePanel:n.id}}),i=t.addPanel({id:Ki,component:Ki,minimumWidth:Pi,position:{direction:"right",referencePanel:n.id}});s.api.setSize({width:ma}),i.api.setSize({width:Pi})})},Wve=h.memo(()=>{const e=h.useCallback(({api:t})=>{Ggt("workflows",t)},[]);return h.useEffect(()=>()=>{Ne.unregisterTab("workflows")},[]),a.jsx(Zm,{tab:"workflows",children:a.jsx(Eo,{className:"dockview-theme-invoke",components:$gt,onReady:e,orientation:Ke.VERTICAL})})});Wve.displayName="WorkflowsTabAutoLayout";const Uve=h.memo(()=>a.jsxs(A,{position:"relative",w:"full",h:"full",overflow:"hidden",children:[a.jsx(jee,{}),a.jsx(qve,{})]}));Uve.displayName="AppContent";const qve=h.memo(()=>{const e=M(un);return a.jsxs(A,{position:"relative",w:"full",h:"full",overflow:"hidden",children:[e==="generate"&&a.jsx(vpe,{}),e==="canvas"&&a.jsx(tpe,{}),e==="upscaling"&&a.jsx(Qfe,{}),e==="workflows"&&a.jsx(Wve,{}),e==="models"&&a.jsx(xfe,{}),e==="queue"&&a.jsx(Dfe,{}),a.jsx(Kve,{})]})});qve.displayName="TabContent";const Kve=h.memo(()=>le(Ne.$isLoading)?a.jsx(oK,{}):null);Kve.displayName="SwitchingTabsLoader";const Hgt=h.createContext(null),OA={didCatch:!1,error:null};class Wgt extends h.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=OA}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var n,s,i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];(n=(s=this.props).onReset)===null||n===void 0||n.call(s,{args:o,reason:"imperative-api"}),this.setState(OA)}}componentDidCatch(t,n){var s,i;(s=(i=this.props).onError)===null||s===void 0||s.call(i,t,n)}componentDidUpdate(t,n){const{didCatch:s}=this.state,{resetKeys:i}=this.props;if(s&&n.error!==null&&Ugt(t.resetKeys,i)){var o,r;(o=(r=this.props).onReset)===null||o===void 0||o.call(r,{next:i,prev:t.resetKeys,reason:"keys"}),this.setState(OA)}}render(){const{children:t,fallbackRender:n,FallbackComponent:s,fallback:i}=this.props,{didCatch:o,error:r}=this.state;let l=t;if(o){const c={error:r,resetErrorBoundary:this.resetErrorBoundary};if(typeof n=="function")l=n(c);else if(s)l=h.createElement(s,c);else if(i!==void 0)l=i;else throw r}return h.createElement(Hgt.Provider,{value:{didCatch:o,error:r,resetErrorBoundary:this.resetErrorBoundary}},l)}}function Ugt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e.length!==t.length||e.some((n,s)=>!Object.is(n,t[s]))}function qgt(e={}){let t;if(e.repoUrl)t=e.repoUrl;else if(e.user&&e.repo)t=`https://github.com/${e.user}/${e.repo}`;else throw new Error("You need to specify either the `repoUrl` option or both the `user` and `repo` options");const n=new URL(`${t}/issues/new`),s=["body","title","labels","template","milestone","assignee","projects","type"];for(const i of s){let o=e[i];if(o!==void 0){if(i==="labels"||i==="projects"){if(!Array.isArray(o))throw new TypeError(`The \`${i}\` option should be an array`);o=o.join(",")}n.searchParams.set(i,o)}}return n.toString()}const Kgt=({error:e,resetErrorBoundary:t})=>{const{t:n}=T(),s=Rm(),i=h.useCallback(()=>{const r=JSON.stringify(cn(e),null,2);s.writeText(`\`\`\`
${r}
\`\`\``,()=>{pe({id:"ERROR_COPIED",title:n("toast.errorCopied")})})},[s,e,n]),o=h.useMemo(()=>qgt({user:"invoke-ai",repo:"InvokeAI",template:"BUG_REPORT.yml",title:`[bug]: ${e.name}: ${e.message}`}),[e.message,e.name]);return a.jsx(A,{layerStyle:"body",w:"100dvw",h:"100dvh",alignItems:"center",justifyContent:"center",p:4,children:a.jsxs(A,{layerStyle:"first",flexDir:"column",borderRadius:"base",justifyContent:"center",gap:8,p:16,children:[a.jsxs(A,{alignItems:"center",gap:"2",children:[a.jsx(Nn,{src:uee,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"}),a.jsx(Pt,{fontSize:"2xl",children:n("common.somethingWentWrong")})]}),a.jsx(A,{layerStyle:"second",px:8,py:4,gap:4,borderRadius:"base",justifyContent:"space-between",alignItems:"center",children:a.jsxs(q,{fontWeight:"semibold",color:"error.400",children:[e.name,": ",e.message]})}),a.jsxs(A,{gap:4,children:[a.jsx(he,{leftIcon:a.jsx(Gs,{}),onClick:t,children:n("accessibility.resetUI")}),a.jsx(he,{leftIcon:a.jsx(ws,{}),onClick:i,children:n("common.copyError")}),a.jsx(aM,{href:o,isExternal:!0,children:a.jsx(he,{leftIcon:a.jsx(Z_,{}),children:n("accessibility.createIssue")})})]})]})})},Zgt=h.memo(Kgt),Xgt=e=>Vke({...SR,direction:e,shadows:{...SR.shadows,selected:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-500), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)",hoverSelected:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-400), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)",hoverUnselected:"inset 0px 0px 0px 2px var(--invoke-colors-invokeBlue-300), inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-800)",selectedForCompare:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-300), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)",hoverSelectedForCompare:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-200), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"}});function Ygt({children:e}){const t=le(vK),n=h.useMemo(()=>Xgt(t),[t]);return a.jsx(Fke,{theme:n,toastOptions:Bke,children:a.jsx(zke,{children:e})})}const Qgt=h.memo(Ygt),Jgt=()=>(wW(),location.reload(),!1),e0t=()=>{const e=le(Ne.$isConnected);return a.jsx(Qgt,{children:a.jsxs(Wgt,{onReset:Jgt,FallbackComponent:Zgt,children:[a.jsx(ke,{id:"invoke-app-wrapper",w:"100dvw",h:"100dvh",position:"relative",overflow:"hidden",children:e?a.jsx(Uve,{}):a.jsx(oK,{})}),a.jsx(UX,{}),a.jsx(dee,{})]})})},R0t=h.memo(e0t);export{R0t as default};
